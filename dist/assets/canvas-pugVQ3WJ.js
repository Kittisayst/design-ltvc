const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.es-DJzR0Tj3.js","./style-BE8_YOlf.js","./style-IiRIOnc9.css"])))=>i.map(i=>d[i]);
import"./style-BE8_YOlf.js";function iK(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const a=Object.getOwnPropertyDescriptor(s,r);a&&Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function L_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function aK(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){var r=!1;try{r=this instanceof s}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var GA={exports:{}},wb={};var PP;function oK(){if(PP)return wb;PP=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,a){var o=null;if(a!==void 0&&(o=""+a),r.key!==void 0&&(o=""+r.key),"key"in r){a={};for(var l in r)l!=="key"&&(a[l]=r[l])}else a=r;return r=a.ref,{$$typeof:n,type:s,key:o,ref:r!==void 0?r:null,props:a}}return wb.Fragment=e,wb.jsx=t,wb.jsxs=t,wb}var zP;function lK(){return zP||(zP=1,GA.exports=oK()),GA.exports}var P=lK(),qA={exports:{}},Tn={};var BP;function cK(){if(BP)return Tn;BP=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function g(Y){return Y===null||typeof Y!="object"?null:(Y=m&&Y[m]||Y["@@iterator"],typeof Y=="function"?Y:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,x={};function S(Y,B,G){this.props=Y,this.context=B,this.refs=x,this.updater=G||b}S.prototype.isReactComponent={},S.prototype.setState=function(Y,B){if(typeof Y!="object"&&typeof Y!="function"&&Y!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Y,B,"setState")},S.prototype.forceUpdate=function(Y){this.updater.enqueueForceUpdate(this,Y,"forceUpdate")};function C(){}C.prototype=S.prototype;function A(Y,B,G){this.props=Y,this.context=B,this.refs=x,this.updater=G||b}var k=A.prototype=new C;k.constructor=A,v(k,S.prototype),k.isPureReactComponent=!0;var O=Array.isArray;function F(){}var $={H:null,A:null,T:null,S:null},M=Object.prototype.hasOwnProperty;function R(Y,B,G){var J=G.ref;return{$$typeof:n,type:Y,key:B,ref:J!==void 0?J:null,props:G}}function z(Y,B){return R(Y.type,B,Y.props)}function I(Y){return typeof Y=="object"&&Y!==null&&Y.$$typeof===n}function j(Y){var B={"=":"=0",":":"=2"};return"$"+Y.replace(/[=:]/g,function(G){return B[G]})}var H=/\/+/g;function q(Y,B){return typeof Y=="object"&&Y!==null&&Y.key!=null?j(""+Y.key):B.toString(36)}function re(Y){switch(Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason;default:switch(typeof Y.status=="string"?Y.then(F,F):(Y.status="pending",Y.then(function(B){Y.status==="pending"&&(Y.status="fulfilled",Y.value=B)},function(B){Y.status==="pending"&&(Y.status="rejected",Y.reason=B)})),Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason}}throw Y}function X(Y,B,G,J,oe){var de=typeof Y;(de==="undefined"||de==="boolean")&&(Y=null);var ge=!1;if(Y===null)ge=!0;else switch(de){case"bigint":case"string":case"number":ge=!0;break;case"object":switch(Y.$$typeof){case n:case e:ge=!0;break;case d:return ge=Y._init,X(ge(Y._payload),B,G,J,oe)}}if(ge)return oe=oe(Y),ge=J===""?"."+q(Y,0):J,O(oe)?(G="",ge!=null&&(G=ge.replace(H,"$&/")+"/"),X(oe,B,G,"",function(Fe){return Fe})):oe!=null&&(I(oe)&&(oe=z(oe,G+(oe.key==null||Y&&Y.key===oe.key?"":(""+oe.key).replace(H,"$&/")+"/")+ge)),B.push(oe)),1;ge=0;var Ae=J===""?".":J+":";if(O(Y))for(var Ce=0;Ce<Y.length;Ce++)J=Y[Ce],de=Ae+q(J,Ce),ge+=X(J,B,G,de,oe);else if(Ce=g(Y),typeof Ce=="function")for(Y=Ce.call(Y),Ce=0;!(J=Y.next()).done;)J=J.value,de=Ae+q(J,Ce++),ge+=X(J,B,G,de,oe);else if(de==="object"){if(typeof Y.then=="function")return X(re(Y),B,G,J,oe);throw B=String(Y),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(Y).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.")}return ge}function ne(Y,B,G){if(Y==null)return Y;var J=[],oe=0;return X(Y,J,"","",function(de){return B.call(G,de,oe++)}),J}function Q(Y){if(Y._status===-1){var B=Y._result;B=B(),B.then(function(G){(Y._status===0||Y._status===-1)&&(Y._status=1,Y._result=G)},function(G){(Y._status===0||Y._status===-1)&&(Y._status=2,Y._result=G)}),Y._status===-1&&(Y._status=0,Y._result=B)}if(Y._status===1)return Y._result.default;throw Y._result}var he=typeof reportError=="function"?reportError:function(Y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var B=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Y=="object"&&Y!==null&&typeof Y.message=="string"?String(Y.message):String(Y),error:Y});if(!window.dispatchEvent(B))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Y);return}console.error(Y)},ye={map:ne,forEach:function(Y,B,G){ne(Y,function(){B.apply(this,arguments)},G)},count:function(Y){var B=0;return ne(Y,function(){B++}),B},toArray:function(Y){return ne(Y,function(B){return B})||[]},only:function(Y){if(!I(Y))throw Error("React.Children.only expected to receive a single React element child.");return Y}};return Tn.Activity=p,Tn.Children=ye,Tn.Component=S,Tn.Fragment=t,Tn.Profiler=r,Tn.PureComponent=A,Tn.StrictMode=s,Tn.Suspense=c,Tn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Tn.__COMPILER_RUNTIME={__proto__:null,c:function(Y){return $.H.useMemoCache(Y)}},Tn.cache=function(Y){return function(){return Y.apply(null,arguments)}},Tn.cacheSignal=function(){return null},Tn.cloneElement=function(Y,B,G){if(Y==null)throw Error("The argument must be a React element, but you passed "+Y+".");var J=v({},Y.props),oe=Y.key;if(B!=null)for(de in B.key!==void 0&&(oe=""+B.key),B)!M.call(B,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&B.ref===void 0||(J[de]=B[de]);var de=arguments.length-2;if(de===1)J.children=G;else if(1<de){for(var ge=Array(de),Ae=0;Ae<de;Ae++)ge[Ae]=arguments[Ae+2];J.children=ge}return R(Y.type,oe,J)},Tn.createContext=function(Y){return Y={$$typeof:o,_currentValue:Y,_currentValue2:Y,_threadCount:0,Provider:null,Consumer:null},Y.Provider=Y,Y.Consumer={$$typeof:a,_context:Y},Y},Tn.createElement=function(Y,B,G){var J,oe={},de=null;if(B!=null)for(J in B.key!==void 0&&(de=""+B.key),B)M.call(B,J)&&J!=="key"&&J!=="__self"&&J!=="__source"&&(oe[J]=B[J]);var ge=arguments.length-2;if(ge===1)oe.children=G;else if(1<ge){for(var Ae=Array(ge),Ce=0;Ce<ge;Ce++)Ae[Ce]=arguments[Ce+2];oe.children=Ae}if(Y&&Y.defaultProps)for(J in ge=Y.defaultProps,ge)oe[J]===void 0&&(oe[J]=ge[J]);return R(Y,de,oe)},Tn.createRef=function(){return{current:null}},Tn.forwardRef=function(Y){return{$$typeof:l,render:Y}},Tn.isValidElement=I,Tn.lazy=function(Y){return{$$typeof:d,_payload:{_status:-1,_result:Y},_init:Q}},Tn.memo=function(Y,B){return{$$typeof:u,type:Y,compare:B===void 0?null:B}},Tn.startTransition=function(Y){var B=$.T,G={};$.T=G;try{var J=Y(),oe=$.S;oe!==null&&oe(G,J),typeof J=="object"&&J!==null&&typeof J.then=="function"&&J.then(F,he)}catch(de){he(de)}finally{B!==null&&G.types!==null&&(B.types=G.types),$.T=B}},Tn.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Tn.use=function(Y){return $.H.use(Y)},Tn.useActionState=function(Y,B,G){return $.H.useActionState(Y,B,G)},Tn.useCallback=function(Y,B){return $.H.useCallback(Y,B)},Tn.useContext=function(Y){return $.H.useContext(Y)},Tn.useDebugValue=function(){},Tn.useDeferredValue=function(Y,B){return $.H.useDeferredValue(Y,B)},Tn.useEffect=function(Y,B){return $.H.useEffect(Y,B)},Tn.useEffectEvent=function(Y){return $.H.useEffectEvent(Y)},Tn.useId=function(){return $.H.useId()},Tn.useImperativeHandle=function(Y,B,G){return $.H.useImperativeHandle(Y,B,G)},Tn.useInsertionEffect=function(Y,B){return $.H.useInsertionEffect(Y,B)},Tn.useLayoutEffect=function(Y,B){return $.H.useLayoutEffect(Y,B)},Tn.useMemo=function(Y,B){return $.H.useMemo(Y,B)},Tn.useOptimistic=function(Y,B){return $.H.useOptimistic(Y,B)},Tn.useReducer=function(Y,B,G){return $.H.useReducer(Y,B,G)},Tn.useRef=function(Y){return $.H.useRef(Y)},Tn.useState=function(Y){return $.H.useState(Y)},Tn.useSyncExternalStore=function(Y,B,G){return $.H.useSyncExternalStore(Y,B,G)},Tn.useTransition=function(){return $.H.useTransition()},Tn.version="19.2.3",Tn}var jP;function rO(){return jP||(jP=1,qA.exports=cK()),qA.exports}var ct=rO();const Ps=L_(ct);var XA={exports:{}},xb={},YA={exports:{}},KA={};var UP;function uK(){return UP||(UP=1,(function(n){function e(X,ne){var Q=X.length;X.push(ne);e:for(;0<Q;){var he=Q-1>>>1,ye=X[he];if(0<r(ye,ne))X[he]=ne,X[Q]=ye,Q=he;else break e}}function t(X){return X.length===0?null:X[0]}function s(X){if(X.length===0)return null;var ne=X[0],Q=X.pop();if(Q!==ne){X[0]=Q;e:for(var he=0,ye=X.length,Y=ye>>>1;he<Y;){var B=2*(he+1)-1,G=X[B],J=B+1,oe=X[J];if(0>r(G,Q))J<ye&&0>r(oe,G)?(X[he]=oe,X[J]=Q,he=J):(X[he]=G,X[B]=Q,he=B);else if(J<ye&&0>r(oe,Q))X[he]=oe,X[J]=Q,he=J;else break e}}return ne}function r(X,ne){var Q=X.sortIndex-ne.sortIndex;return Q!==0?Q:X.id-ne.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,p=null,m=3,g=!1,b=!1,v=!1,x=!1,S=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function k(X){for(var ne=t(u);ne!==null;){if(ne.callback===null)s(u);else if(ne.startTime<=X)s(u),ne.sortIndex=ne.expirationTime,e(c,ne);else break;ne=t(u)}}function O(X){if(v=!1,k(X),!b)if(t(c)!==null)b=!0,F||(F=!0,j());else{var ne=t(u);ne!==null&&re(O,ne.startTime-X)}}var F=!1,$=-1,M=5,R=-1;function z(){return x?!0:!(n.unstable_now()-R<M)}function I(){if(x=!1,F){var X=n.unstable_now();R=X;var ne=!0;try{e:{b=!1,v&&(v=!1,C($),$=-1),g=!0;var Q=m;try{t:{for(k(X),p=t(c);p!==null&&!(p.expirationTime>X&&z());){var he=p.callback;if(typeof he=="function"){p.callback=null,m=p.priorityLevel;var ye=he(p.expirationTime<=X);if(X=n.unstable_now(),typeof ye=="function"){p.callback=ye,k(X),ne=!0;break t}p===t(c)&&s(c),k(X)}else s(c);p=t(c)}if(p!==null)ne=!0;else{var Y=t(u);Y!==null&&re(O,Y.startTime-X),ne=!1}}break e}finally{p=null,m=Q,g=!1}ne=void 0}}finally{ne?j():F=!1}}}var j;if(typeof A=="function")j=function(){A(I)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,q=H.port2;H.port1.onmessage=I,j=function(){q.postMessage(null)}}else j=function(){S(I,0)};function re(X,ne){$=S(function(){X(n.unstable_now())},ne)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(X){X.callback=null},n.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<X?Math.floor(1e3/X):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_next=function(X){switch(m){case 1:case 2:case 3:var ne=3;break;default:ne=m}var Q=m;m=ne;try{return X()}finally{m=Q}},n.unstable_requestPaint=function(){x=!0},n.unstable_runWithPriority=function(X,ne){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Q=m;m=X;try{return ne()}finally{m=Q}},n.unstable_scheduleCallback=function(X,ne,Q){var he=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?he+Q:he):Q=he,X){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=Q+ye,X={id:d++,callback:ne,priorityLevel:X,startTime:Q,expirationTime:ye,sortIndex:-1},Q>he?(X.sortIndex=Q,e(u,X),t(c)===null&&X===t(u)&&(v?(C($),$=-1):v=!0,re(O,Q-he))):(X.sortIndex=ye,e(c,X),b||g||(b=!0,F||(F=!0,j()))),X},n.unstable_shouldYield=z,n.unstable_wrapCallback=function(X){var ne=m;return function(){var Q=m;m=ne;try{return X.apply(this,arguments)}finally{m=Q}}}})(KA)),KA}var VP;function hK(){return VP||(VP=1,YA.exports=uK()),YA.exports}var ZA={exports:{}},wa={};var WP;function dK(){if(WP)return wa;WP=1;var n=rO();function e(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(c,u,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:c,containerInfo:u,implementation:d}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(c,u){if(c==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return wa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,wa.createPortal=function(c,u){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return a(c,u,null,d)},wa.flushSync=function(c){var u=o.T,d=s.p;try{if(o.T=null,s.p=2,c)return c()}finally{o.T=u,s.p=d,s.d.f()}},wa.preconnect=function(c,u){typeof c=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(c,u))},wa.prefetchDNS=function(c){typeof c=="string"&&s.d.D(c)},wa.preinit=function(c,u){if(typeof c=="string"&&u&&typeof u.as=="string"){var d=u.as,p=l(d,u.crossOrigin),m=typeof u.integrity=="string"?u.integrity:void 0,g=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;d==="style"?s.d.S(c,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:g}):d==="script"&&s.d.X(c,{crossOrigin:p,integrity:m,fetchPriority:g,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},wa.preinitModule=function(c,u){if(typeof c=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var d=l(u.as,u.crossOrigin);s.d.M(c,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(c)},wa.preload=function(c,u){if(typeof c=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var d=u.as,p=l(d,u.crossOrigin);s.d.L(c,d,{crossOrigin:p,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},wa.preloadModule=function(c,u){if(typeof c=="string")if(u){var d=l(u.as,u.crossOrigin);s.d.m(c,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(c)},wa.requestFormReset=function(c){s.d.r(c)},wa.unstable_batchedUpdates=function(c,u){return c(u)},wa.useFormState=function(c,u,d){return o.H.useFormState(c,u,d)},wa.useFormStatus=function(){return o.H.useHostTransitionStatus()},wa.version="19.2.3",wa}var HP;function fK(){if(HP)return ZA.exports;HP=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ZA.exports=dK(),ZA.exports}var GP;function pK(){if(GP)return xb;GP=1;var n=hK(),e=rO(),t=fK();function s(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)f+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function a(h){var f=h,y=h;if(h.alternate)for(;f.return;)f=f.return;else{h=f;do f=h,(f.flags&4098)!==0&&(y=f.return),h=f.return;while(h)}return f.tag===3?y:null}function o(h){if(h.tag===13){var f=h.memoizedState;if(f===null&&(h=h.alternate,h!==null&&(f=h.memoizedState)),f!==null)return f.dehydrated}return null}function l(h){if(h.tag===31){var f=h.memoizedState;if(f===null&&(h=h.alternate,h!==null&&(f=h.memoizedState)),f!==null)return f.dehydrated}return null}function c(h){if(a(h)!==h)throw Error(s(188))}function u(h){var f=h.alternate;if(!f){if(f=a(h),f===null)throw Error(s(188));return f!==h?null:h}for(var y=h,w=f;;){var T=y.return;if(T===null)break;var E=T.alternate;if(E===null){if(w=T.return,w!==null){y=w;continue}break}if(T.child===E.child){for(E=T.child;E;){if(E===y)return c(T),h;if(E===w)return c(T),f;E=E.sibling}throw Error(s(188))}if(y.return!==w.return)y=T,w=E;else{for(var W=!1,ae=T.child;ae;){if(ae===y){W=!0,y=T,w=E;break}if(ae===w){W=!0,w=T,y=E;break}ae=ae.sibling}if(!W){for(ae=E.child;ae;){if(ae===y){W=!0,y=E,w=T;break}if(ae===w){W=!0,w=E,y=T;break}ae=ae.sibling}if(!W)throw Error(s(189))}}if(y.alternate!==w)throw Error(s(190))}if(y.tag!==3)throw Error(s(188));return y.stateNode.current===y?h:f}function d(h){var f=h.tag;if(f===5||f===26||f===27||f===6)return h;for(h=h.child;h!==null;){if(f=d(h),f!==null)return f;h=h.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),A=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function j(h){return h===null||typeof h!="object"?null:(h=I&&h[I]||h["@@iterator"],typeof h=="function"?h:null)}var H=Symbol.for("react.client.reference");function q(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===H?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case v:return"Fragment";case S:return"Profiler";case x:return"StrictMode";case O:return"Suspense";case F:return"SuspenseList";case R:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case b:return"Portal";case A:return h.displayName||"Context";case C:return(h._context.displayName||"Context")+".Consumer";case k:var f=h.render;return h=h.displayName,h||(h=f.displayName||f.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case $:return f=h.displayName||null,f!==null?f:q(h.type)||"Memo";case M:f=h._payload,h=h._init;try{return q(h(f))}catch{}}return null}var re=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},he=[],ye=-1;function Y(h){return{current:h}}function B(h){0>ye||(h.current=he[ye],he[ye]=null,ye--)}function G(h,f){ye++,he[ye]=h.current,h.current=f}var J=Y(null),oe=Y(null),de=Y(null),ge=Y(null);function Ae(h,f){switch(G(de,f),G(oe,h),G(J,null),f.nodeType){case 9:case 11:h=(h=f.documentElement)&&(h=h.namespaceURI)?oP(h):0;break;default:if(h=f.tagName,f=f.namespaceURI)f=oP(f),h=lP(f,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}B(J),G(J,h)}function Ce(){B(J),B(oe),B(de)}function Fe(h){h.memoizedState!==null&&G(ge,h);var f=J.current,y=lP(f,h.type);f!==y&&(G(oe,h),G(J,y))}function Ge(h){oe.current===h&&(B(J),B(oe)),ge.current===h&&(B(ge),gb._currentValue=Q)}var ot,ut;function pt(h){if(ot===void 0)try{throw Error()}catch(y){var f=y.stack.trim().match(/\n( *(at )?)/);ot=f&&f[1]||"",ut=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ot+h+ut}var ce=!1;function rt(h,f){if(!h||ce)return"";ce=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(f){var tt=function(){throw Error()};if(Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(He){var Ue=He}Reflect.construct(h,[],tt)}else{try{tt.call()}catch(He){Ue=He}h.call(tt.prototype)}}else{try{throw Error()}catch(He){Ue=He}(tt=h())&&typeof tt.catch=="function"&&tt.catch(function(){})}}catch(He){if(He&&Ue&&typeof He.stack=="string")return[He.stack,Ue.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=w.DetermineComponentFrameRoot(),W=E[0],ae=E[1];if(W&&ae){var we=W.split(`
`),je=ae.split(`
`);for(T=w=0;w<we.length&&!we[w].includes("DetermineComponentFrameRoot");)w++;for(;T<je.length&&!je[T].includes("DetermineComponentFrameRoot");)T++;if(w===we.length||T===je.length)for(w=we.length-1,T=je.length-1;1<=w&&0<=T&&we[w]!==je[T];)T--;for(;1<=w&&0<=T;w--,T--)if(we[w]!==je[T]){if(w!==1||T!==1)do if(w--,T--,0>T||we[w]!==je[T]){var Ze=`
`+we[w].replace(" at new "," at ");return h.displayName&&Ze.includes("<anonymous>")&&(Ze=Ze.replace("<anonymous>",h.displayName)),Ze}while(1<=w&&0<=T);break}}}finally{ce=!1,Error.prepareStackTrace=y}return(y=h?h.displayName||h.name:"")?pt(y):""}function At(h,f){switch(h.tag){case 26:case 27:case 5:return pt(h.type);case 16:return pt("Lazy");case 13:return h.child!==f&&f!==null?pt("Suspense Fallback"):pt("Suspense");case 19:return pt("SuspenseList");case 0:case 15:return rt(h.type,!1);case 11:return rt(h.type.render,!1);case 1:return rt(h.type,!0);case 31:return pt("Activity");default:return""}}function yt(h){try{var f="",y=null;do f+=At(h,y),y=h,h=h.return;while(h);return f}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}var nt=Object.prototype.hasOwnProperty,xt=n.unstable_scheduleCallback,vt=n.unstable_cancelCallback,Tt=n.unstable_shouldYield,Lt=n.unstable_requestPaint,Yt=n.unstable_now,mn=n.unstable_getCurrentPriorityLevel,Jt=n.unstable_ImmediatePriority,bn=n.unstable_UserBlockingPriority,cn=n.unstable_NormalPriority,Et=n.unstable_LowPriority,fn=n.unstable_IdlePriority,zt=n.log,Ks=n.unstable_setDisableYieldValue,Cn=null,Qt=null;function un(h){if(typeof zt=="function"&&Ks(h),Qt&&typeof Qt.setStrictMode=="function")try{Qt.setStrictMode(Cn,h)}catch{}}var Un=Math.clz32?Math.clz32:on,en=Math.log,Is=Math.LN2;function on(h){return h>>>=0,h===0?32:31-(en(h)/Is|0)|0}var gn=256,Ss=262144,An=4194304;function Gt(h){var f=h&42;if(f!==0)return f;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return h&261888;case 262144:case 524288:case 1048576:case 2097152:return h&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function Qn(h,f,y){var w=h.pendingLanes;if(w===0)return 0;var T=0,E=h.suspendedLanes,W=h.pingedLanes;h=h.warmLanes;var ae=w&134217727;return ae!==0?(w=ae&~E,w!==0?T=Gt(w):(W&=ae,W!==0?T=Gt(W):y||(y=ae&~h,y!==0&&(T=Gt(y))))):(ae=w&~E,ae!==0?T=Gt(ae):W!==0?T=Gt(W):y||(y=w&~h,y!==0&&(T=Gt(y)))),T===0?0:f!==0&&f!==T&&(f&E)===0&&(E=T&-T,y=f&-f,E>=y||E===32&&(y&4194048)!==0)?f:T}function Qo(h,f){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&f)===0}function Mi(h,f){switch(h){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zl(){var h=An;return An<<=1,(An&62914560)===0&&(An=4194304),h}function bo(h){for(var f=[],y=0;31>y;y++)f.push(h);return f}function Kt(h,f){h.pendingLanes|=f,f!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function wc(h,f,y,w,T,E){var W=h.pendingLanes;h.pendingLanes=y,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=y,h.entangledLanes&=y,h.errorRecoveryDisabledLanes&=y,h.shellSuspendCounter=0;var ae=h.entanglements,we=h.expirationTimes,je=h.hiddenUpdates;for(y=W&~y;0<y;){var Ze=31-Un(y),tt=1<<Ze;ae[Ze]=0,we[Ze]=-1;var Ue=je[Ze];if(Ue!==null)for(je[Ze]=null,Ze=0;Ze<Ue.length;Ze++){var He=Ue[Ze];He!==null&&(He.lane&=-536870913)}y&=~tt}w!==0&&Bl(h,w,0),E!==0&&T===0&&h.tag!==0&&(h.suspendedLanes|=E&~(W&~f))}function Bl(h,f,y){h.pendingLanes|=f,h.suspendedLanes&=~f;var w=31-Un(f);h.entangledLanes|=f,h.entanglements[w]=h.entanglements[w]|1073741824|y&261930}function za(h,f){var y=h.entangledLanes|=f;for(h=h.entanglements;y;){var w=31-Un(y),T=1<<w;T&f|h[w]&f&&(h[w]|=f),y&=~T}}function Ba(h,f){var y=f&-f;return y=(y&42)!==0?1:Xs(y),(y&(h.suspendedLanes|f))!==0?0:y}function Xs(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function Tr(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function ii(){var h=ne.p;return h!==0?h:(h=window.event,h===void 0?32:OP(h.type))}function Tu(h,f){var y=ne.p;try{return ne.p=h,f()}finally{ne.p=y}}var ia=Math.random().toString(36).slice(2),Cs="__reactFiber$"+ia,Zs="__reactProps$"+ia,Pi="__reactContainer$"+ia,ja="__reactEvents$"+ia,vo="__reactListeners$"+ia,Ah="__reactHandles$"+ia,el="__reactResources$"+ia,tl="__reactMarker$"+ia;function Nu(h){delete h[Cs],delete h[Zs],delete h[ja],delete h[vo],delete h[Ah]}function nl(h){var f=h[Cs];if(f)return f;for(var y=h.parentNode;y;){if(f=y[Pi]||y[Cs]){if(y=f.alternate,f.child!==null||y!==null&&y.child!==null)for(h=mP(h);h!==null;){if(y=h[Cs])return y;h=mP(h)}return f}h=y,y=h.parentNode}return null}function sl(h){if(h=h[Cs]||h[Pi]){var f=h.tag;if(f===5||f===6||f===13||f===31||f===26||f===27||f===3)return h}return null}function Eh(h){var f=h.tag;if(f===5||f===26||f===27||f===6)return h.stateNode;throw Error(s(33))}function jl(h){var f=h[el];return f||(f=h[el]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function br(h){h[tl]=!0}var dp=new Set,Ua={};function rl(h,f){xc(h,f),xc(h+"Capture",f)}function xc(h,f){for(Ua[h]=f,h=0;h<f.length;h++)dp.add(f[h])}var fp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pp={},mp={};function gg(h){return nt.call(mp,h)?!0:nt.call(pp,h)?!1:fp.test(h)?mp[h]=!0:(pp[h]=!0,!1)}function Va(h,f,y){if(gg(f))if(y===null)h.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":h.removeAttribute(f);return;case"boolean":var w=f.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){h.removeAttribute(f);return}}h.setAttribute(f,""+y)}}function Sc(h,f,y){if(y===null)h.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(f);return}h.setAttribute(f,""+y)}}function il(h,f,y,w){if(w===null)h.removeAttribute(y);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(y);return}h.setAttributeNS(f,y,""+w)}}function cs(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function gp(h){var f=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Ul(h,f,y){var w=Object.getOwnPropertyDescriptor(h.constructor.prototype,f);if(!h.hasOwnProperty(f)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var T=w.get,E=w.set;return Object.defineProperty(h,f,{configurable:!0,get:function(){return T.call(this)},set:function(W){y=""+W,E.call(this,W)}}),Object.defineProperty(h,f,{enumerable:w.enumerable}),{getValue:function(){return y},setValue:function(W){y=""+W},stopTracking:function(){h._valueTracker=null,delete h[f]}}}}function Au(h){if(!h._valueTracker){var f=gp(h)?"checked":"value";h._valueTracker=Ul(h,f,""+h[f])}}function yp(h){if(!h)return!1;var f=h._valueTracker;if(!f)return!0;var y=f.getValue(),w="";return h&&(w=gp(h)?h.checked?"true":"false":h.value),h=w,h!==y?(f.setValue(h),!0):!1}function aa(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var Vr=/[\n"\\]/g;function Nr(h){return h.replace(Vr,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function zd(h,f,y,w,T,E,W,ae){h.name="",W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?h.type=W:h.removeAttribute("type"),f!=null?W==="number"?(f===0&&h.value===""||h.value!=f)&&(h.value=""+cs(f)):h.value!==""+cs(f)&&(h.value=""+cs(f)):W!=="submit"&&W!=="reset"||h.removeAttribute("value"),f!=null?bp(h,W,cs(f)):y!=null?bp(h,W,cs(y)):w!=null&&h.removeAttribute("value"),T==null&&E!=null&&(h.defaultChecked=!!E),T!=null&&(h.checked=T&&typeof T!="function"&&typeof T!="symbol"),ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?h.name=""+cs(ae):h.removeAttribute("name")}function yg(h,f,y,w,T,E,W,ae){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(h.type=E),f!=null||y!=null){if(!(E!=="submit"&&E!=="reset"||f!=null)){Au(h);return}y=y!=null?""+cs(y):"",f=f!=null?""+cs(f):y,ae||f===h.value||(h.value=f),h.defaultValue=f}w=w??T,w=typeof w!="function"&&typeof w!="symbol"&&!!w,h.checked=ae?h.checked:!!w,h.defaultChecked=!!w,W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(h.name=W),Au(h)}function bp(h,f,y){f==="number"&&aa(h.ownerDocument)===h||h.defaultValue===""+y||(h.defaultValue=""+y)}function oa(h,f,y,w){if(h=h.options,f){f={};for(var T=0;T<y.length;T++)f["$"+y[T]]=!0;for(y=0;y<h.length;y++)T=f.hasOwnProperty("$"+h[y].value),h[y].selected!==T&&(h[y].selected=T),T&&w&&(h[y].defaultSelected=!0)}else{for(y=""+cs(y),f=null,T=0;T<h.length;T++){if(h[T].value===y){h[T].selected=!0,w&&(h[T].defaultSelected=!0);return}f!==null||h[T].disabled||(f=h[T])}f!==null&&(f.selected=!0)}}function vp(h,f,y){if(f!=null&&(f=""+cs(f),f!==h.value&&(h.value=f),y==null)){h.defaultValue!==f&&(h.defaultValue=f);return}h.defaultValue=y!=null?""+cs(y):""}function wp(h,f,y,w){if(f==null){if(w!=null){if(y!=null)throw Error(s(92));if(re(w)){if(1<w.length)throw Error(s(93));w=w[0]}y=w}y==null&&(y=""),f=y}y=cs(f),h.defaultValue=y,w=h.textContent,w===y&&w!==""&&w!==null&&(h.value=w),Au(h)}function al(h,f){if(f){var y=h.firstChild;if(y&&y===h.lastChild&&y.nodeType===3){y.nodeValue=f;return}}h.textContent=f}var Ih=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bg(h,f,y){var w=f.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?w?h.setProperty(f,""):f==="float"?h.cssFloat="":h[f]="":w?h.setProperty(f,y):typeof y!="number"||y===0||Ih.has(f)?f==="float"?h.cssFloat=y:h[f]=(""+y).trim():h[f]=y+"px"}function vg(h,f,y){if(f!=null&&typeof f!="object")throw Error(s(62));if(h=h.style,y!=null){for(var w in y)!y.hasOwnProperty(w)||f!=null&&f.hasOwnProperty(w)||(w.indexOf("--")===0?h.setProperty(w,""):w==="float"?h.cssFloat="":h[w]="");for(var T in f)w=f[T],f.hasOwnProperty(T)&&y[T]!==w&&bg(h,T,w)}else for(var E in f)f.hasOwnProperty(E)&&bg(h,E,f[E])}function xp(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ya(h){return wg.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}function ol(){}var Cc=null;function Oh(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Eu=null,rn=null;function xg(h){var f=sl(h);if(f&&(h=f.stateNode)){var y=h[Zs]||null;e:switch(h=f.stateNode,f.type){case"input":if(zd(h,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),f=y.name,y.type==="radio"&&f!=null){for(y=h;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Nr(""+f)+'"][type="radio"]'),f=0;f<y.length;f++){var w=y[f];if(w!==h&&w.form===h.form){var T=w[Zs]||null;if(!T)throw Error(s(90));zd(w,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(f=0;f<y.length;f++)w=y[f],w.form===h.form&&yp(w)}break e;case"textarea":vp(h,y.value,y.defaultValue);break e;case"select":f=y.value,f!=null&&oa(h,!!y.multiple,f,!1)}}}var Cp=!1;function Sg(h,f,y){if(Cp)return h(f,y);Cp=!0;try{var w=h(f);return w}finally{if(Cp=!1,(Eu!==null||rn!==null)&&(Mx(),Eu&&(f=Eu,h=rn,rn=Eu=null,xg(f),h)))for(f=0;f<h.length;f++)xg(h[f])}}function Wa(h,f){var y=h.stateNode;if(y===null)return null;var w=y[Zs]||null;if(w===null)return null;y=w[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(h=h.type,w=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!w;break e;default:h=!1}if(h)return null;if(y&&typeof y!="function")throw Error(s(231,f,typeof y));return y}var wi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_p=!1;if(wi)try{var Dh={};Object.defineProperty(Dh,"passive",{get:function(){_p=!0}}),window.addEventListener("test",Dh,Dh),window.removeEventListener("test",Dh,Dh)}catch{_p=!1}var Ha=null,$h=null,Vl=null;function Cg(){if(Vl)return Vl;var h,f=$h,y=f.length,w,T="value"in Ha?Ha.value:Ha.textContent,E=T.length;for(h=0;h<y&&f[h]===T[h];h++);var W=y-h;for(w=1;w<=W&&f[y-w]===T[E-w];w++);return Vl=T.slice(h,1<w?1-w:void 0)}function wo(h){var f=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&f===13&&(h=13)):h=f,h===10&&(h=13),32<=h||h===13?h:0}function Bd(){return!0}function jd(){return!1}function ai(h){function f(y,w,T,E,W){this._reactName=y,this._targetInst=T,this.type=w,this.nativeEvent=E,this.target=W,this.currentTarget=null;for(var ae in h)h.hasOwnProperty(ae)&&(y=h[ae],this[ae]=y?y(E):E[ae]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Bd:jd,this.isPropagationStopped=jd,this}return p(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Bd)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Bd)},persist:function(){},isPersistent:Bd}),f}var Wl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xo=ai(Wl),_c=p({},Wl,{view:0,detail:0}),Ud=ai(_c),Rh,kc,Tc,Lh=p({},_c,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hn,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Tc&&(Tc&&h.type==="mousemove"?(Rh=h.screenX-Tc.screenX,kc=h.screenY-Tc.screenY):kc=Rh=0,Tc=h),Rh)},movementY:function(h){return"movementY"in h?h.movementY:kc}}),kp=ai(Lh),Nc=p({},Lh,{dataTransfer:0}),Ac=ai(Nc),_g=p({},_c,{relatedTarget:0}),Ec=ai(_g),kg=p({},Wl,{animationName:0,elapsedTime:0,pseudoElement:0}),D=ai(kg),K=p({},Wl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),me=ai(K),xe=p({},Wl,{data:0}),De=ai(xe),Je={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},it={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jt(h){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(h):(h=Dt[h])?!!f[h]:!1}function hn(){return jt}var _n=p({},_c,{key:function(h){if(h.key){var f=Je[h.key]||h.key;if(f!=="Unidentified")return f}return h.type==="keypress"?(h=wo(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?it[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hn,charCode:function(h){return h.type==="keypress"?wo(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?wo(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),es=ai(_n),Js=p({},Lh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vr=ai(Js),Os=p({},_c,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hn}),Wr=ai(Os),Ar=p({},Wl,{propertyName:0,elapsedTime:0,pseudoElement:0}),xi=ai(Ar),Ic=p({},Lh,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),ll=ai(Ic),Oc=p({},Wl,{newState:0,oldState:0}),Tp=ai(Oc),Vd=[9,13,27,32],Hl=wi&&"CompositionEvent"in window,cl=null;wi&&"documentMode"in document&&(cl=document.documentMode);var Fh=wi&&"TextEvent"in window&&!cl,Dc=wi&&(!Hl||cl&&8<cl&&11>=cl),oi=" ",Iu=!1;function Ou(h,f){switch(h){case"keyup":return Vd.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wd(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var Gl=!1;function la(h,f){switch(h){case"compositionend":return Wd(f);case"keypress":return f.which!==32?null:(Iu=!0,oi);case"textInput":return h=f.data,h===oi&&Iu?null:h;default:return null}}function $c(h,f){if(Gl)return h==="compositionend"||!Hl&&Ou(h,f)?(h=Cg(),Vl=$h=Ha=null,Gl=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Dc&&f.locale!=="ko"?null:f.data;default:return null}}var Hd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Np(h){var f=h&&h.nodeName&&h.nodeName.toLowerCase();return f==="input"?!!Hd[h.type]:f==="textarea"}function Ga(h,f,y,w){Eu?rn?rn.push(w):rn=[w]:Eu=w,f=Wx(f,"onChange"),0<f.length&&(y=new xo("onChange","change",null,y,w),h.push({event:y,listeners:f}))}var ul=null,Rc=null;function Ap(h){tP(h,0)}function hl(h){var f=Eh(h);if(yp(f))return h}function Du(h,f){if(h==="change")return f}var ba=!1;if(wi){var ca;if(wi){var ql="oninput"in document;if(!ql){var Xl=document.createElement("div");Xl.setAttribute("oninput","return;"),ql=typeof Xl.oninput=="function"}ca=ql}else ca=!1;ba=ca&&(!document.documentMode||9<document.documentMode)}function Lc(){ul&&(ul.detachEvent("onpropertychange",Gd),Rc=ul=null)}function Gd(h){if(h.propertyName==="value"&&hl(Rc)){var f=[];Ga(f,Rc,h,Oh(h)),Sg(Ap,f)}}function qd(h,f,y){h==="focusin"?(Lc(),ul=f,Rc=y,ul.attachEvent("onpropertychange",Gd)):h==="focusout"&&Lc()}function wr(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return hl(Rc)}function Tg(h,f){if(h==="click")return hl(f)}function Yl(h,f){if(h==="input"||h==="change")return hl(f)}function Kl(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var Si=typeof Object.is=="function"?Object.is:Kl;function Fc(h,f){if(Si(h,f))return!0;if(typeof h!="object"||h===null||typeof f!="object"||f===null)return!1;var y=Object.keys(h),w=Object.keys(f);if(y.length!==w.length)return!1;for(w=0;w<y.length;w++){var T=y[w];if(!nt.call(f,T)||!Si(h[T],f[T]))return!1}return!0}function Xd(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Yd(h,f){var y=Xd(h);h=0;for(var w;y;){if(y.nodeType===3){if(w=h+y.textContent.length,h<=f&&w>=f)return{node:y,offset:f-h};h=w}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=Xd(y)}}function Mc(h,f){return h&&f?h===f?!0:h&&h.nodeType===3?!1:f&&f.nodeType===3?Mc(h,f.parentNode):"contains"in h?h.contains(f):h.compareDocumentPosition?!!(h.compareDocumentPosition(f)&16):!1:!1}function Pc(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var f=aa(h.document);f instanceof h.HTMLIFrameElement;){try{var y=typeof f.contentWindow.location.href=="string"}catch{y=!1}if(y)h=f.contentWindow;else break;f=aa(h.document)}return f}function Zl(h){var f=h&&h.nodeName&&h.nodeName.toLowerCase();return f&&(f==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||f==="textarea"||h.contentEditable==="true")}var Mh=wi&&"documentMode"in document&&11>=document.documentMode,qa=null,zc=null,zi=null,So=!1;function us(h,f,y){var w=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;So||qa==null||qa!==aa(w)||(w=qa,"selectionStart"in w&&Zl(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),zi&&Fc(zi,w)||(zi=w,w=Wx(zc,"onSelect"),0<w.length&&(f=new xo("onSelect","select",null,f,y),h.push({event:f,listeners:w}),f.target=qa)))}function ts(h,f){var y={};return y[h.toLowerCase()]=f.toLowerCase(),y["Webkit"+h]="webkit"+f,y["Moz"+h]="moz"+f,y}var Ds={animationend:ts("Animation","AnimationEnd"),animationiteration:ts("Animation","AnimationIteration"),animationstart:ts("Animation","AnimationStart"),transitionrun:ts("Transition","TransitionRun"),transitionstart:ts("Transition","TransitionStart"),transitioncancel:ts("Transition","TransitionCancel"),transitionend:ts("Transition","TransitionEnd")},xr={},Jl={};wi&&(Jl=document.createElement("div").style,"AnimationEvent"in window||(delete Ds.animationend.animation,delete Ds.animationiteration.animation,delete Ds.animationstart.animation),"TransitionEvent"in window||delete Ds.transitionend.transition);function dl(h){if(xr[h])return xr[h];if(!Ds[h])return h;var f=Ds[h],y;for(y in f)if(f.hasOwnProperty(y)&&y in Jl)return xr[h]=f[y];return h}var Ph=dl("animationend"),Ep=dl("animationiteration"),zy=dl("animationstart"),fx=dl("transitionrun"),px=dl("transitionstart"),mx=dl("transitioncancel"),By=dl("transitionend"),jy=new Map,zh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zh.push("scrollEnd");function Co(h,f){jy.set(h,f),rl(f,[h])}var Ip=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},Xa=[],Bh=0,Ng=0;function Op(){for(var h=Bh,f=Ng=Bh=0;f<h;){var y=Xa[f];Xa[f++]=null;var w=Xa[f];Xa[f++]=null;var T=Xa[f];Xa[f++]=null;var E=Xa[f];if(Xa[f++]=null,w!==null&&T!==null){var W=w.pending;W===null?T.next=T:(T.next=W.next,W.next=T),w.pending=T}E!==0&&$p(y,T,E)}}function Dp(h,f,y,w){Xa[Bh++]=h,Xa[Bh++]=f,Xa[Bh++]=y,Xa[Bh++]=w,Ng|=w,h.lanes|=w,h=h.alternate,h!==null&&(h.lanes|=w)}function Ag(h,f,y,w){return Dp(h,f,y,w),Bi(h)}function Bc(h,f){return Dp(h,null,null,f),Bi(h)}function $p(h,f,y){h.lanes|=y;var w=h.alternate;w!==null&&(w.lanes|=y);for(var T=!1,E=h.return;E!==null;)E.childLanes|=y,w=E.alternate,w!==null&&(w.childLanes|=y),E.tag===22&&(h=E.stateNode,h===null||h._visibility&1||(T=!0)),h=E,E=E.return;return h.tag===3?(E=h.stateNode,T&&f!==null&&(T=31-Un(y),h=E.hiddenUpdates,w=h[T],w===null?h[T]=[f]:w.push(f),f.lane=y|536870912),E):null}function Bi(h){if(50<cb)throw cb=0,gA=null,Error(s(185));for(var f=h.return;f!==null;)h=f,f=h.return;return h.tag===3?h.stateNode:null}var Ci={};function Eg(h,f,y,w){this.tag=h,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ji(h,f,y,w){return new Eg(h,f,y,w)}function Ig(h){return h=h.prototype,!(!h||!h.isReactComponent)}function _o(h,f){var y=h.alternate;return y===null?(y=ji(h.tag,f,h.key,h.mode),y.elementType=h.elementType,y.type=h.type,y.stateNode=h.stateNode,y.alternate=h,h.alternate=y):(y.pendingProps=f,y.type=h.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=h.flags&65011712,y.childLanes=h.childLanes,y.lanes=h.lanes,y.child=h.child,y.memoizedProps=h.memoizedProps,y.memoizedState=h.memoizedState,y.updateQueue=h.updateQueue,f=h.dependencies,y.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},y.sibling=h.sibling,y.index=h.index,y.ref=h.ref,y.refCleanup=h.refCleanup,y}function Rp(h,f){h.flags&=65011714;var y=h.alternate;return y===null?(h.childLanes=0,h.lanes=f,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=y.childLanes,h.lanes=y.lanes,h.child=y.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=y.memoizedProps,h.memoizedState=y.memoizedState,h.updateQueue=y.updateQueue,h.type=y.type,f=y.dependencies,h.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),h}function Kd(h,f,y,w,T,E){var W=0;if(w=h,typeof h=="function")Ig(h)&&(W=1);else if(typeof h=="string")W=qY(h,y,J.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case R:return h=ji(31,y,f,T),h.elementType=R,h.lanes=E,h;case v:return $u(y.children,T,E,f);case x:W=8,T|=24;break;case S:return h=ji(12,y,f,T|2),h.elementType=S,h.lanes=E,h;case O:return h=ji(13,y,f,T),h.elementType=O,h.lanes=E,h;case F:return h=ji(19,y,f,T),h.elementType=F,h.lanes=E,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case A:W=10;break e;case C:W=9;break e;case k:W=11;break e;case $:W=14;break e;case M:W=16,w=null;break e}W=29,y=Error(s(130,h===null?"null":typeof h,"")),w=null}return f=ji(W,y,f,T),f.elementType=h,f.type=w,f.lanes=E,f}function $u(h,f,y,w){return h=ji(7,h,w,f),h.lanes=y,h}function Lp(h,f,y){return h=ji(6,h,null,f),h.lanes=y,h}function Og(h){var f=ji(18,null,null,0);return f.stateNode=h,f}function Zd(h,f,y){return f=ji(4,h.children!==null?h.children:[],h.key,f),f.lanes=y,f.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},f}var Dg=new WeakMap;function ko(h,f){if(typeof h=="object"&&h!==null){var y=Dg.get(h);return y!==void 0?y:(f={value:h,source:f,stack:yt(f)},Dg.set(h,f),f)}return{value:h,source:f,stack:yt(f)}}var Jd=[],jh=0,$g=null,Fp=0,To=[],No=0,Ru=null,Ao=1,Eo="";function Ya(h,f){Jd[jh++]=Fp,Jd[jh++]=$g,$g=h,Fp=f}function gx(h,f,y){To[No++]=Ao,To[No++]=Eo,To[No++]=Ru,Ru=h;var w=Ao;h=Eo;var T=32-Un(w)-1;w&=~(1<<T),y+=1;var E=32-Un(f)+T;if(30<E){var W=T-T%5;E=(w&(1<<W)-1).toString(32),w>>=W,T-=W,Ao=1<<32-Un(f)+T|y<<T|w,Eo=E+h}else Ao=1<<E|y<<T|w,Eo=h}function Uy(h){h.return!==null&&(Ya(h,1),gx(h,1,0))}function Rg(h){for(;h===$g;)$g=Jd[--jh],Jd[jh]=null,Fp=Jd[--jh],Jd[jh]=null;for(;h===Ru;)Ru=To[--No],To[No]=null,Eo=To[--No],To[No]=null,Ao=To[--No],To[No]=null}function yx(h,f){To[No++]=Ao,To[No++]=Eo,To[No++]=Ru,Ao=f.id,Eo=f.overflow,Ru=h}var _i=null,Bs=null,Hn=!1,ua=null,or=!1,fl=Error(s(519));function Lu(h){var f=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Qd(ko(f,h)),fl}function Vy(h){var f=h.stateNode,y=h.type,w=h.memoizedProps;switch(f[Cs]=h,f[Zs]=w,y){case"dialog":qn("cancel",f),qn("close",f);break;case"iframe":case"object":case"embed":qn("load",f);break;case"video":case"audio":for(y=0;y<hb.length;y++)qn(hb[y],f);break;case"source":qn("error",f);break;case"img":case"image":case"link":qn("error",f),qn("load",f);break;case"details":qn("toggle",f);break;case"input":qn("invalid",f),yg(f,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0);break;case"select":qn("invalid",f);break;case"textarea":qn("invalid",f),wp(f,w.value,w.defaultValue,w.children)}y=w.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||f.textContent===""+y||w.suppressHydrationWarning===!0||iP(f.textContent,y)?(w.popover!=null&&(qn("beforetoggle",f),qn("toggle",f)),w.onScroll!=null&&qn("scroll",f),w.onScrollEnd!=null&&qn("scrollend",f),w.onClick!=null&&(f.onclick=ol),f=!0):f=!1,f||Lu(h,!0)}function jc(h){for(_i=h.return;_i;)switch(_i.tag){case 5:case 31:case 13:or=!1;return;case 27:case 3:or=!0;return;default:_i=_i.return}}function ki(h){if(h!==_i)return!1;if(!Hn)return jc(h),Hn=!0,!1;var f=h.tag,y;if((y=f!==3&&f!==27)&&((y=f===5)&&(y=h.type,y=!(y!=="form"&&y!=="button")||OA(h.type,h.memoizedProps)),y=!y),y&&Bs&&Lu(h),jc(h),f===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(s(317));Bs=pP(h)}else if(f===31){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(s(317));Bs=pP(h)}else f===27?(f=Bs,pf(h.type)?(h=FA,FA=null,Bs=h):Bs=f):Bs=_i?nc(h.stateNode.nextSibling):null;return!0}function Uh(){Bs=_i=null,Hn=!1}function Wy(){var h=ua;return h!==null&&(Lo===null?Lo=h:Lo.push.apply(Lo,h),ua=null),h}function Qd(h){ua===null?ua=[h]:ua.push(h)}var Lg=Y(null),Fu=null,Ql=null;function Mu(h,f,y){G(Lg,f._currentValue),f._currentValue=y}function Io(h){h._currentValue=Lg.current,B(Lg)}function ef(h,f,y){for(;h!==null;){var w=h.alternate;if((h.childLanes&f)!==f?(h.childLanes|=f,w!==null&&(w.childLanes|=f)):w!==null&&(w.childLanes&f)!==f&&(w.childLanes|=f),h===y)break;h=h.return}}function Vh(h,f,y,w){var T=h.child;for(T!==null&&(T.return=h);T!==null;){var E=T.dependencies;if(E!==null){var W=T.child;E=E.firstContext;e:for(;E!==null;){var ae=E;E=T;for(var we=0;we<f.length;we++)if(ae.context===f[we]){E.lanes|=y,ae=E.alternate,ae!==null&&(ae.lanes|=y),ef(E.return,y,h),w||(W=null);break e}E=ae.next}}else if(T.tag===18){if(W=T.return,W===null)throw Error(s(341));W.lanes|=y,E=W.alternate,E!==null&&(E.lanes|=y),ef(W,y,h),W=null}else W=T.child;if(W!==null)W.return=T;else for(W=T;W!==null;){if(W===h){W=null;break}if(T=W.sibling,T!==null){T.return=W.return,W=T;break}W=W.return}T=W}}function Pu(h,f,y,w){h=null;for(var T=f,E=!1;T!==null;){if(!E){if((T.flags&524288)!==0)E=!0;else if((T.flags&262144)!==0)break}if(T.tag===10){var W=T.alternate;if(W===null)throw Error(s(387));if(W=W.memoizedProps,W!==null){var ae=T.type;Si(T.pendingProps.value,W.value)||(h!==null?h.push(ae):h=[ae])}}else if(T===ge.current){if(W=T.alternate,W===null)throw Error(s(387));W.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(h!==null?h.push(gb):h=[gb])}T=T.return}h!==null&&Vh(f,h,y,w),f.flags|=262144}function Fg(h){for(h=h.firstContext;h!==null;){if(!Si(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function zu(h){Fu=h,Ql=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Ti(h){return bx(Fu,h)}function Mg(h,f){return Fu===null&&zu(h),bx(h,f)}function bx(h,f){var y=f._currentValue;if(f={context:f,memoizedValue:y,next:null},Ql===null){if(h===null)throw Error(s(308));Ql=f,h.dependencies={lanes:0,firstContext:f},h.flags|=524288}else Ql=Ql.next=f;return y}var LN=typeof AbortController<"u"?AbortController:function(){var h=[],f=this.signal={aborted:!1,addEventListener:function(y,w){h.push(w)}};this.abort=function(){f.aborted=!0,h.forEach(function(y){return y()})}},FN=n.unstable_scheduleCallback,MN=n.unstable_NormalPriority,Sr={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function tf(){return{controller:new LN,data:new Map,refCount:0}}function Mp(h){h.refCount--,h.refCount===0&&FN(MN,function(){h.controller.abort()})}var Pp=null,Pg=0,_=0,N=null;function L(h,f){if(Pp===null){var y=Pp=[];Pg=0,_=SA(),N={status:"pending",value:void 0,then:function(w){y.push(w)}}}return Pg++,f.then(V,V),f}function V(){if(--Pg===0&&Pp!==null){N!==null&&(N.status="fulfilled");var h=Pp;Pp=null,_=0,N=null;for(var f=0;f<h.length;f++)(0,h[f])()}}function Z(h,f){var y=[],w={status:"pending",value:null,reason:null,then:function(T){y.push(T)}};return h.then(function(){w.status="fulfilled",w.value=f;for(var T=0;T<y.length;T++)(0,y[T])(f)},function(T){for(w.status="rejected",w.reason=T,T=0;T<y.length;T++)(0,y[T])(void 0)}),w}var te=X.S;X.S=function(h,f){EM=Yt(),typeof f=="object"&&f!==null&&typeof f.then=="function"&&L(h,f),te!==null&&te(h,f)};var se=Y(null);function le(){var h=se.current;return h!==null?h:Us.pooledCache}function ue(h,f){f===null?G(se,se.current):G(se,f.pool)}function pe(){var h=le();return h===null?null:{parent:Sr._currentValue,pool:h}}var Te=Error(s(460)),ze=Error(s(474)),fe=Error(s(542)),Oe={then:function(){}};function Me(h){return h=h.status,h==="fulfilled"||h==="rejected"}function Ke(h,f,y){switch(y=h[y],y===void 0?h.push(f):y!==f&&(f.then(ol,ol),f=y),f.status){case"fulfilled":return f.value;case"rejected":throw h=f.reason,ht(h),h;default:if(typeof f.status=="string")f.then(ol,ol);else{if(h=Us,h!==null&&100<h.shellSuspendCounter)throw Error(s(482));h=f,h.status="pending",h.then(function(w){if(f.status==="pending"){var T=f;T.status="fulfilled",T.value=w}},function(w){if(f.status==="pending"){var T=f;T.status="rejected",T.reason=w}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw h=f.reason,ht(h),h}throw Xe=f,Te}}function Pe(h){try{var f=h._init;return f(h._payload)}catch(y){throw y!==null&&typeof y=="object"&&typeof y.then=="function"?(Xe=y,Te):y}}var Xe=null;function Qe(){if(Xe===null)throw Error(s(459));var h=Xe;return Xe=null,h}function ht(h){if(h===Te||h===fe)throw Error(s(483))}var st=null,Ft=0;function Ct(h){var f=Ft;return Ft+=1,st===null&&(st=[]),Ke(st,h,f)}function vn(h,f){f=f.props.ref,h.ref=f!==void 0?f:null}function Ot(h,f){throw f.$$typeof===m?Error(s(525)):(h=Object.prototype.toString.call(f),Error(s(31,h==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":h)))}function Vn(h){function f($e,Ee){if(h){var Be=$e.deletions;Be===null?($e.deletions=[Ee],$e.flags|=16):Be.push(Ee)}}function y($e,Ee){if(!h)return null;for(;Ee!==null;)f($e,Ee),Ee=Ee.sibling;return null}function w($e){for(var Ee=new Map;$e!==null;)$e.key!==null?Ee.set($e.key,$e):Ee.set($e.index,$e),$e=$e.sibling;return Ee}function T($e,Ee){return $e=_o($e,Ee),$e.index=0,$e.sibling=null,$e}function E($e,Ee,Be){return $e.index=Be,h?(Be=$e.alternate,Be!==null?(Be=Be.index,Be<Ee?($e.flags|=67108866,Ee):Be):($e.flags|=67108866,Ee)):($e.flags|=1048576,Ee)}function W($e){return h&&$e.alternate===null&&($e.flags|=67108866),$e}function ae($e,Ee,Be,et){return Ee===null||Ee.tag!==6?(Ee=Lp(Be,$e.mode,et),Ee.return=$e,Ee):(Ee=T(Ee,Be),Ee.return=$e,Ee)}function we($e,Ee,Be,et){var nn=Be.type;return nn===v?Ze($e,Ee,Be.props.children,et,Be.key):Ee!==null&&(Ee.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===M&&Pe(nn)===Ee.type)?(Ee=T(Ee,Be.props),vn(Ee,Be),Ee.return=$e,Ee):(Ee=Kd(Be.type,Be.key,Be.props,null,$e.mode,et),vn(Ee,Be),Ee.return=$e,Ee)}function je($e,Ee,Be,et){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Be.containerInfo||Ee.stateNode.implementation!==Be.implementation?(Ee=Zd(Be,$e.mode,et),Ee.return=$e,Ee):(Ee=T(Ee,Be.children||[]),Ee.return=$e,Ee)}function Ze($e,Ee,Be,et,nn){return Ee===null||Ee.tag!==7?(Ee=$u(Be,$e.mode,et,nn),Ee.return=$e,Ee):(Ee=T(Ee,Be),Ee.return=$e,Ee)}function tt($e,Ee,Be){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return Ee=Lp(""+Ee,$e.mode,Be),Ee.return=$e,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case g:return Be=Kd(Ee.type,Ee.key,Ee.props,null,$e.mode,Be),vn(Be,Ee),Be.return=$e,Be;case b:return Ee=Zd(Ee,$e.mode,Be),Ee.return=$e,Ee;case M:return Ee=Pe(Ee),tt($e,Ee,Be)}if(re(Ee)||j(Ee))return Ee=$u(Ee,$e.mode,Be,null),Ee.return=$e,Ee;if(typeof Ee.then=="function")return tt($e,Ct(Ee),Be);if(Ee.$$typeof===A)return tt($e,Mg($e,Ee),Be);Ot($e,Ee)}return null}function Ue($e,Ee,Be,et){var nn=Ee!==null?Ee.key:null;if(typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint")return nn!==null?null:ae($e,Ee,""+Be,et);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case g:return Be.key===nn?we($e,Ee,Be,et):null;case b:return Be.key===nn?je($e,Ee,Be,et):null;case M:return Be=Pe(Be),Ue($e,Ee,Be,et)}if(re(Be)||j(Be))return nn!==null?null:Ze($e,Ee,Be,et,null);if(typeof Be.then=="function")return Ue($e,Ee,Ct(Be),et);if(Be.$$typeof===A)return Ue($e,Ee,Mg($e,Be),et);Ot($e,Be)}return null}function He($e,Ee,Be,et,nn){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return $e=$e.get(Be)||null,ae(Ee,$e,""+et,nn);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case g:return $e=$e.get(et.key===null?Be:et.key)||null,we(Ee,$e,et,nn);case b:return $e=$e.get(et.key===null?Be:et.key)||null,je(Ee,$e,et,nn);case M:return et=Pe(et),He($e,Ee,Be,et,nn)}if(re(et)||j(et))return $e=$e.get(Be)||null,Ze(Ee,$e,et,nn,null);if(typeof et.then=="function")return He($e,Ee,Be,Ct(et),nn);if(et.$$typeof===A)return He($e,Ee,Be,Mg(Ee,et),nn);Ot(Ee,et)}return null}function $t($e,Ee,Be,et){for(var nn=null,fs=null,Ut=Ee,Rn=Ee=0,Jn=null;Ut!==null&&Rn<Be.length;Rn++){Ut.index>Rn?(Jn=Ut,Ut=null):Jn=Ut.sibling;var ps=Ue($e,Ut,Be[Rn],et);if(ps===null){Ut===null&&(Ut=Jn);break}h&&Ut&&ps.alternate===null&&f($e,Ut),Ee=E(ps,Ee,Rn),fs===null?nn=ps:fs.sibling=ps,fs=ps,Ut=Jn}if(Rn===Be.length)return y($e,Ut),Hn&&Ya($e,Rn),nn;if(Ut===null){for(;Rn<Be.length;Rn++)Ut=tt($e,Be[Rn],et),Ut!==null&&(Ee=E(Ut,Ee,Rn),fs===null?nn=Ut:fs.sibling=Ut,fs=Ut);return Hn&&Ya($e,Rn),nn}for(Ut=w(Ut);Rn<Be.length;Rn++)Jn=He(Ut,$e,Rn,Be[Rn],et),Jn!==null&&(h&&Jn.alternate!==null&&Ut.delete(Jn.key===null?Rn:Jn.key),Ee=E(Jn,Ee,Rn),fs===null?nn=Jn:fs.sibling=Jn,fs=Jn);return h&&Ut.forEach(function(vf){return f($e,vf)}),Hn&&Ya($e,Rn),nn}function ln($e,Ee,Be,et){if(Be==null)throw Error(s(151));for(var nn=null,fs=null,Ut=Ee,Rn=Ee=0,Jn=null,ps=Be.next();Ut!==null&&!ps.done;Rn++,ps=Be.next()){Ut.index>Rn?(Jn=Ut,Ut=null):Jn=Ut.sibling;var vf=Ue($e,Ut,ps.value,et);if(vf===null){Ut===null&&(Ut=Jn);break}h&&Ut&&vf.alternate===null&&f($e,Ut),Ee=E(vf,Ee,Rn),fs===null?nn=vf:fs.sibling=vf,fs=vf,Ut=Jn}if(ps.done)return y($e,Ut),Hn&&Ya($e,Rn),nn;if(Ut===null){for(;!ps.done;Rn++,ps=Be.next())ps=tt($e,ps.value,et),ps!==null&&(Ee=E(ps,Ee,Rn),fs===null?nn=ps:fs.sibling=ps,fs=ps);return Hn&&Ya($e,Rn),nn}for(Ut=w(Ut);!ps.done;Rn++,ps=Be.next())ps=He(Ut,$e,Rn,ps.value,et),ps!==null&&(h&&ps.alternate!==null&&Ut.delete(ps.key===null?Rn:ps.key),Ee=E(ps,Ee,Rn),fs===null?nn=ps:fs.sibling=ps,fs=ps);return h&&Ut.forEach(function(rK){return f($e,rK)}),Hn&&Ya($e,Rn),nn}function Fs($e,Ee,Be,et){if(typeof Be=="object"&&Be!==null&&Be.type===v&&Be.key===null&&(Be=Be.props.children),typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case g:e:{for(var nn=Be.key;Ee!==null;){if(Ee.key===nn){if(nn=Be.type,nn===v){if(Ee.tag===7){y($e,Ee.sibling),et=T(Ee,Be.props.children),et.return=$e,$e=et;break e}}else if(Ee.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===M&&Pe(nn)===Ee.type){y($e,Ee.sibling),et=T(Ee,Be.props),vn(et,Be),et.return=$e,$e=et;break e}y($e,Ee);break}else f($e,Ee);Ee=Ee.sibling}Be.type===v?(et=$u(Be.props.children,$e.mode,et,Be.key),et.return=$e,$e=et):(et=Kd(Be.type,Be.key,Be.props,null,$e.mode,et),vn(et,Be),et.return=$e,$e=et)}return W($e);case b:e:{for(nn=Be.key;Ee!==null;){if(Ee.key===nn)if(Ee.tag===4&&Ee.stateNode.containerInfo===Be.containerInfo&&Ee.stateNode.implementation===Be.implementation){y($e,Ee.sibling),et=T(Ee,Be.children||[]),et.return=$e,$e=et;break e}else{y($e,Ee);break}else f($e,Ee);Ee=Ee.sibling}et=Zd(Be,$e.mode,et),et.return=$e,$e=et}return W($e);case M:return Be=Pe(Be),Fs($e,Ee,Be,et)}if(re(Be))return $t($e,Ee,Be,et);if(j(Be)){if(nn=j(Be),typeof nn!="function")throw Error(s(150));return Be=nn.call(Be),ln($e,Ee,Be,et)}if(typeof Be.then=="function")return Fs($e,Ee,Ct(Be),et);if(Be.$$typeof===A)return Fs($e,Ee,Mg($e,Be),et);Ot($e,Be)}return typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint"?(Be=""+Be,Ee!==null&&Ee.tag===6?(y($e,Ee.sibling),et=T(Ee,Be),et.return=$e,$e=et):(y($e,Ee),et=Lp(Be,$e.mode,et),et.return=$e,$e=et),W($e)):y($e,Ee)}return function($e,Ee,Be,et){try{Ft=0;var nn=Fs($e,Ee,Be,et);return st=null,nn}catch(Ut){if(Ut===Te||Ut===fe)throw Ut;var fs=ji(29,Ut,null,$e.mode);return fs.lanes=et,fs.return=$e,fs}}}var js=Vn(!0),kn=Vn(!1),_t=!1;function mt(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qs(h,f){h=h.updateQueue,f.updateQueue===h&&(f.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function an(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function En(h,f,y){var w=h.updateQueue;if(w===null)return null;if(w=w.shared,(bs&2)!==0){var T=w.pending;return T===null?f.next=f:(f.next=T.next,T.next=f),w.pending=f,f=Bi(h),$p(h,null,y),f}return Dp(h,w,f,y),Bi(h)}function gs(h,f,y){if(f=f.updateQueue,f!==null&&(f=f.shared,(y&4194048)!==0)){var w=f.lanes;w&=h.pendingLanes,y|=w,f.lanes=y,za(h,y)}}function Hr(h,f){var y=h.updateQueue,w=h.alternate;if(w!==null&&(w=w.updateQueue,y===w)){var T=null,E=null;if(y=y.firstBaseUpdate,y!==null){do{var W={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};E===null?T=E=W:E=E.next=W,y=y.next}while(y!==null);E===null?T=E=f:E=E.next=f}else T=E=f;y={baseState:w.baseState,firstBaseUpdate:T,lastBaseUpdate:E,shared:w.shared,callbacks:w.callbacks},h.updateQueue=y;return}h=y.lastBaseUpdate,h===null?y.firstBaseUpdate=f:h.next=f,y.lastBaseUpdate=f}var Ni=!1;function $s(){if(Ni){var h=N;if(h!==null)throw h}}function Er(h,f,y,w){Ni=!1;var T=h.updateQueue;_t=!1;var E=T.firstBaseUpdate,W=T.lastBaseUpdate,ae=T.shared.pending;if(ae!==null){T.shared.pending=null;var we=ae,je=we.next;we.next=null,W===null?E=je:W.next=je,W=we;var Ze=h.alternate;Ze!==null&&(Ze=Ze.updateQueue,ae=Ze.lastBaseUpdate,ae!==W&&(ae===null?Ze.firstBaseUpdate=je:ae.next=je,Ze.lastBaseUpdate=we))}if(E!==null){var tt=T.baseState;W=0,Ze=je=we=null,ae=E;do{var Ue=ae.lane&-536870913,He=Ue!==ae.lane;if(He?(Zn&Ue)===Ue:(w&Ue)===Ue){Ue!==0&&Ue===_&&(Ni=!0),Ze!==null&&(Ze=Ze.next={lane:0,tag:ae.tag,payload:ae.payload,callback:null,next:null});e:{var $t=h,ln=ae;Ue=f;var Fs=y;switch(ln.tag){case 1:if($t=ln.payload,typeof $t=="function"){tt=$t.call(Fs,tt,Ue);break e}tt=$t;break e;case 3:$t.flags=$t.flags&-65537|128;case 0:if($t=ln.payload,Ue=typeof $t=="function"?$t.call(Fs,tt,Ue):$t,Ue==null)break e;tt=p({},tt,Ue);break e;case 2:_t=!0}}Ue=ae.callback,Ue!==null&&(h.flags|=64,He&&(h.flags|=8192),He=T.callbacks,He===null?T.callbacks=[Ue]:He.push(Ue))}else He={lane:Ue,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},Ze===null?(je=Ze=He,we=tt):Ze=Ze.next=He,W|=Ue;if(ae=ae.next,ae===null){if(ae=T.shared.pending,ae===null)break;He=ae,ae=He.next,He.next=null,T.lastBaseUpdate=He,T.shared.pending=null}}while(!0);Ze===null&&(we=tt),T.baseState=we,T.firstBaseUpdate=je,T.lastBaseUpdate=Ze,E===null&&(T.shared.lanes=0),cf|=W,h.lanes=W,h.memoizedState=tt}}function Ui(h,f){if(typeof h!="function")throw Error(s(191,h));h.call(f)}function Ir(h,f){var y=h.callbacks;if(y!==null)for(h.callbacks=null,h=0;h<y.length;h++)Ui(y[h],f)}var Pn=Y(null),rs=Y(0);function er(h,f){h=Qh,G(rs,h),G(Pn,f),Qh=h|f.baseLanes}function hs(){G(rs,Qh),G(Pn,Pn.current)}function Gr(){Qh=rs.current,B(Pn),B(rs)}var tr=Y(null),is=null;function Cr(h){var f=h.alternate;G(ns,ns.current&1),G(tr,h),is===null&&(f===null||Pn.current!==null||f.memoizedState!==null)&&(is=h)}function ys(h){G(ns,ns.current),G(tr,h),is===null&&(is=h)}function Or(h){h.tag===22?(G(ns,ns.current),G(tr,h),is===null&&(is=h)):Dr()}function Dr(){G(ns,ns.current),G(tr,tr.current)}function _s(h){B(tr),is===h&&(is=null),B(ns)}var ns=Y(0);function Vi(h){for(var f=h;f!==null;){if(f.tag===13){var y=f.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||RA(y)||LA(y)))return f}else if(f.tag===19&&(f.memoizedProps.revealOrder==="forwards"||f.memoizedProps.revealOrder==="backwards"||f.memoizedProps.revealOrder==="unstable_legacy-backwards"||f.memoizedProps.revealOrder==="together")){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var lr=0,Zt=null,tn=null,as=null,va=!1,Oo=!1,ha=!1,$r=0,Bu=0,ju=null,zg=0;function Rs(){throw Error(s(321))}function Hy(h,f){if(f===null)return!1;for(var y=0;y<f.length&&y<h.length;y++)if(!Si(h[y],f[y]))return!1;return!0}function Gy(h,f,y,w,T,E){return lr=E,Zt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,X.H=h===null||h.memoizedState===null?BF:HN,ha=!1,E=y(w,T),ha=!1,Oo&&(E=Uc(f,y,w,T)),Bg(h),E}function Bg(h){X.H=eb;var f=tn!==null&&tn.next!==null;if(lr=0,as=tn=Zt=null,va=!1,Bu=0,ju=null,f)throw Error(s(300));h===null||ci||(h=h.dependencies,h!==null&&Fg(h)&&(ci=!0))}function Uc(h,f,y,w){Zt=h;var T=0;do{if(Oo&&(ju=null),Bu=0,Oo=!1,25<=T)throw Error(s(301));if(T+=1,as=tn=null,h.updateQueue!=null){var E=h.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}X.H=jF,E=f(y,w)}while(Oo);return E}function PN(){var h=X.H,f=h.useState()[0];return f=typeof f.then=="function"?Uu(f):f,h=h.useState()[0],(tn!==null?tn.memoizedState:null)!==h&&(Zt.flags|=1024),f}function qy(){var h=$r!==0;return $r=0,h}function Xy(h,f,y){f.updateQueue=h.updateQueue,f.flags&=-2053,h.lanes&=~y}function jg(h){if(va){for(h=h.memoizedState;h!==null;){var f=h.queue;f!==null&&(f.pending=null),h=h.next}va=!1}lr=0,as=tn=Zt=null,Oo=!1,Bu=$r=0,ju=null}function li(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return as===null?Zt.memoizedState=as=h:as=as.next=h,as}function cr(){if(tn===null){var h=Zt.alternate;h=h!==null?h.memoizedState:null}else h=tn.next;var f=as===null?Zt.memoizedState:as.next;if(f!==null)as=f,tn=h;else{if(h===null)throw Zt.alternate===null?Error(s(467)):Error(s(310));tn=h,h={memoizedState:tn.memoizedState,baseState:tn.baseState,baseQueue:tn.baseQueue,queue:tn.queue,next:null},as===null?Zt.memoizedState=as=h:as=as.next=h}return as}function zp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Uu(h){var f=Bu;return Bu+=1,ju===null&&(ju=[]),h=Ke(ju,h,f),f=Zt,(as===null?f.memoizedState:as.next)===null&&(f=f.alternate,X.H=f===null||f.memoizedState===null?BF:HN),h}function nf(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return Uu(h);if(h.$$typeof===A)return Ti(h)}throw Error(s(438,String(h)))}function Wh(h){var f=null,y=Zt.updateQueue;if(y!==null&&(f=y.memoCache),f==null){var w=Zt.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(f={data:w.data.map(function(T){return T.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),y===null&&(y=zp(),Zt.updateQueue=y),y.memoCache=f,y=f.data[f.index],y===void 0)for(y=f.data[f.index]=Array(h),w=0;w<h;w++)y[w]=z;return f.index++,y}function ec(h,f){return typeof f=="function"?f(h):f}function Ug(h){var f=cr();return sf(f,tn,h)}function sf(h,f,y){var w=h.queue;if(w===null)throw Error(s(311));w.lastRenderedReducer=y;var T=h.baseQueue,E=w.pending;if(E!==null){if(T!==null){var W=T.next;T.next=E.next,E.next=W}f.baseQueue=T=E,w.pending=null}if(E=h.baseState,T===null)h.memoizedState=E;else{f=T.next;var ae=W=null,we=null,je=f,Ze=!1;do{var tt=je.lane&-536870913;if(tt!==je.lane?(Zn&tt)===tt:(lr&tt)===tt){var Ue=je.revertLane;if(Ue===0)we!==null&&(we=we.next={lane:0,revertLane:0,gesture:null,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null}),tt===_&&(Ze=!0);else if((lr&Ue)===Ue){je=je.next,Ue===_&&(Ze=!0);continue}else tt={lane:0,revertLane:je.revertLane,gesture:null,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},we===null?(ae=we=tt,W=E):we=we.next=tt,Zt.lanes|=Ue,cf|=Ue;tt=je.action,ha&&y(E,tt),E=je.hasEagerState?je.eagerState:y(E,tt)}else Ue={lane:tt,revertLane:je.revertLane,gesture:je.gesture,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},we===null?(ae=we=Ue,W=E):we=we.next=Ue,Zt.lanes|=tt,cf|=tt;je=je.next}while(je!==null&&je!==f);if(we===null?W=E:we.next=ae,!Si(E,h.memoizedState)&&(ci=!0,Ze&&(y=N,y!==null)))throw y;h.memoizedState=E,h.baseState=W,h.baseQueue=we,w.lastRenderedState=E}return T===null&&(w.lanes=0),[h.memoizedState,w.dispatch]}function Vg(h){var f=cr(),y=f.queue;if(y===null)throw Error(s(311));y.lastRenderedReducer=h;var w=y.dispatch,T=y.pending,E=f.memoizedState;if(T!==null){y.pending=null;var W=T=T.next;do E=h(E,W.action),W=W.next;while(W!==T);Si(E,f.memoizedState)||(ci=!0),f.memoizedState=E,f.baseQueue===null&&(f.baseState=E),y.lastRenderedState=E}return[E,w]}function Wg(h,f,y){var w=Zt,T=cr(),E=Hn;if(E){if(y===void 0)throw Error(s(407));y=y()}else y=f();var W=!Si((tn||T).memoizedState,y);if(W&&(T.memoizedState=y,ci=!0),T=T.queue,zN(Ky.bind(null,w,T,h),[h]),T.getSnapshot!==f||W||as!==null&&as.memoizedState.tag&1){if(w.flags|=2048,Gh(9,{destroy:void 0},Yy.bind(null,w,T,y,f),null),Us===null)throw Error(s(349));E||(lr&127)!==0||Vc(w,f,y)}return y}function Vc(h,f,y){h.flags|=16384,h={getSnapshot:f,value:y},f=Zt.updateQueue,f===null?(f=zp(),Zt.updateQueue=f,f.stores=[h]):(y=f.stores,y===null?f.stores=[h]:y.push(h))}function Yy(h,f,y,w){f.value=y,f.getSnapshot=w,vx(f)&&Zy(h)}function Ky(h,f,y){return y(function(){vx(f)&&Zy(h)})}function vx(h){var f=h.getSnapshot;h=h.value;try{var y=f();return!Si(h,y)}catch{return!0}}function Zy(h){var f=Bc(h,2);f!==null&&Fo(f,h,2)}function Vu(h){var f=li();if(typeof h=="function"){var y=h;if(h=y(),ha){un(!0);try{y()}finally{un(!1)}}}return f.memoizedState=f.baseState=h,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ec,lastRenderedState:h},f}function wx(h,f,y,w){return h.baseState=y,sf(h,tn,typeof w=="function"?w:ec)}function xx(h,f,y,w,T){if(kx(h))throw Error(s(485));if(h=f.action,h!==null){var E={payload:T,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(W){E.listeners.push(W)}};X.T!==null?y(!0):E.isTransition=!1,w(E),y=f.pending,y===null?(E.next=f.pending=E,Sx(f,E)):(E.next=y.next,f.pending=y.next=E)}}function Sx(h,f){var y=f.action,w=f.payload,T=h.state;if(f.isTransition){var E=X.T,W={};X.T=W;try{var ae=y(T,w),we=X.S;we!==null&&we(W,ae),Jy(h,f,ae)}catch(je){Hh(h,f,je)}finally{E!==null&&W.types!==null&&(E.types=W.types),X.T=E}}else try{E=y(T,w),Jy(h,f,E)}catch(je){Hh(h,f,je)}}function Jy(h,f,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(w){Cx(h,f,w)},function(w){return Hh(h,f,w)}):Cx(h,f,y)}function Cx(h,f,y){f.status="fulfilled",f.value=y,Hg(f),h.state=y,f=h.pending,f!==null&&(y=f.next,y===f?h.pending=null:(y=y.next,f.next=y,Sx(h,y)))}function Hh(h,f,y){var w=h.pending;if(h.pending=null,w!==null){w=w.next;do f.status="rejected",f.reason=y,Hg(f),f=f.next;while(f!==w)}h.action=null}function Hg(h){h=h.listeners;for(var f=0;f<h.length;f++)(0,h[f])()}function Bp(h,f){return f}function tc(h,f){if(Hn){var y=Us.formState;if(y!==null){e:{var w=Zt;if(Hn){if(Bs){t:{for(var T=Bs,E=or;T.nodeType!==8;){if(!E){T=null;break t}if(T=nc(T.nextSibling),T===null){T=null;break t}}E=T.data,T=E==="F!"||E==="F"?T:null}if(T){Bs=nc(T.nextSibling),w=T.data==="F!";break e}}Lu(w)}w=!1}w&&(f=y[0])}}return y=li(),y.memoizedState=y.baseState=f,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bp,lastRenderedState:f},y.queue=w,y=MF.bind(null,Zt,w),w.dispatch=y,w=Vu(!1),E=WN.bind(null,Zt,!1,w.queue),w=li(),T={state:f,dispatch:null,action:h,pending:null},w.queue=T,y=xx.bind(null,Zt,T,E,y),T.dispatch=y,w.memoizedState=h,[f,y,!1]}function Wc(h){var f=cr();return Hc(f,tn,h)}function Hc(h,f,y){if(f=sf(h,f,Bp)[0],h=Ug(ec)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var w=Uu(f)}catch(W){throw W===Te?fe:W}else w=f;f=cr();var T=f.queue,E=T.dispatch;return y!==f.memoizedState&&(Zt.flags|=2048,Gh(9,{destroy:void 0},Gg.bind(null,T,y),null)),[w,E,h]}function Gg(h,f){h.action=f}function qg(h){var f=cr(),y=tn;if(y!==null)return Hc(f,y,h);cr(),f=f.memoizedState,y=cr();var w=y.queue.dispatch;return y.memoizedState=h,[f,w,!1]}function Gh(h,f,y,w){return h={tag:h,create:y,deps:w,inst:f,next:null},f=Zt.updateQueue,f===null&&(f=zp(),Zt.updateQueue=f),y=f.lastEffect,y===null?f.lastEffect=h.next=h:(w=y.next,y.next=h,h.next=w,f.lastEffect=h),h}function _x(){return cr().memoizedState}function rf(h,f,y,w){var T=li();Zt.flags|=h,T.memoizedState=Gh(1|f,{destroy:void 0},y,w===void 0?null:w)}function af(h,f,y,w){var T=cr();w=w===void 0?null:w;var E=T.memoizedState.inst;tn!==null&&w!==null&&Hy(w,tn.memoizedState.deps)?T.memoizedState=Gh(f,E,y,w):(Zt.flags|=h,T.memoizedState=Gh(1|f,E,y,w))}function CF(h,f){rf(8390656,8,h,f)}function zN(h,f){af(2048,8,h,f)}function JX(h){Zt.flags|=4;var f=Zt.updateQueue;if(f===null)f=zp(),Zt.updateQueue=f,f.events=[h];else{var y=f.events;y===null?f.events=[h]:y.push(h)}}function _F(h){var f=cr().memoizedState;return JX({ref:f,nextImpl:h}),function(){if((bs&2)!==0)throw Error(s(440));return f.impl.apply(void 0,arguments)}}function kF(h,f){return af(4,2,h,f)}function TF(h,f){return af(4,4,h,f)}function NF(h,f){if(typeof f=="function"){h=h();var y=f(h);return function(){typeof y=="function"?y():f(null)}}if(f!=null)return h=h(),f.current=h,function(){f.current=null}}function AF(h,f,y){y=y!=null?y.concat([h]):null,af(4,4,NF.bind(null,f,h),y)}function BN(){}function EF(h,f){var y=cr();f=f===void 0?null:f;var w=y.memoizedState;return f!==null&&Hy(f,w[1])?w[0]:(y.memoizedState=[h,f],h)}function IF(h,f){var y=cr();f=f===void 0?null:f;var w=y.memoizedState;if(f!==null&&Hy(f,w[1]))return w[0];if(w=h(),ha){un(!0);try{h()}finally{un(!1)}}return y.memoizedState=[w,f],w}function jN(h,f,y){return y===void 0||(lr&1073741824)!==0&&(Zn&261930)===0?h.memoizedState=f:(h.memoizedState=y,h=OM(),Zt.lanes|=h,cf|=h,y)}function OF(h,f,y,w){return Si(y,f)?y:Pn.current!==null?(h=jN(h,y,w),Si(h,f)||(ci=!0),h):(lr&42)===0||(lr&1073741824)!==0&&(Zn&261930)===0?(ci=!0,h.memoizedState=y):(h=OM(),Zt.lanes|=h,cf|=h,f)}function DF(h,f,y,w,T){var E=ne.p;ne.p=E!==0&&8>E?E:8;var W=X.T,ae={};X.T=ae,WN(h,!1,f,y);try{var we=T(),je=X.S;if(je!==null&&je(ae,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var Ze=Z(we,w);Qy(h,f,Ze,gl(h))}else Qy(h,f,w,gl(h))}catch(tt){Qy(h,f,{then:function(){},status:"rejected",reason:tt},gl())}finally{ne.p=E,W!==null&&ae.types!==null&&(W.types=ae.types),X.T=W}}function QX(){}function UN(h,f,y,w){if(h.tag!==5)throw Error(s(476));var T=$F(h).queue;DF(h,T,f,Q,y===null?QX:function(){return RF(h),y(w)})}function $F(h){var f=h.memoizedState;if(f!==null)return f;f={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ec,lastRenderedState:Q},next:null};var y={};return f.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ec,lastRenderedState:y},next:null},h.memoizedState=f,h=h.alternate,h!==null&&(h.memoizedState=f),f}function RF(h){var f=$F(h);f.next===null&&(f=h.alternate.memoizedState),Qy(h,f.next.queue,{},gl())}function VN(){return Ti(gb)}function LF(){return cr().memoizedState}function FF(){return cr().memoizedState}function eY(h){for(var f=h.return;f!==null;){switch(f.tag){case 24:case 3:var y=gl();h=an(y);var w=En(f,h,y);w!==null&&(Fo(w,f,y),gs(w,f,y)),f={cache:tf()},h.payload=f;return}f=f.return}}function tY(h,f,y){var w=gl();y={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},kx(h)?PF(f,y):(y=Ag(h,f,y,w),y!==null&&(Fo(y,h,w),zF(y,f,w)))}function MF(h,f,y){var w=gl();Qy(h,f,y,w)}function Qy(h,f,y,w){var T={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null};if(kx(h))PF(f,T);else{var E=h.alternate;if(h.lanes===0&&(E===null||E.lanes===0)&&(E=f.lastRenderedReducer,E!==null))try{var W=f.lastRenderedState,ae=E(W,y);if(T.hasEagerState=!0,T.eagerState=ae,Si(ae,W))return Dp(h,f,T,0),Us===null&&Op(),!1}catch{}if(y=Ag(h,f,T,w),y!==null)return Fo(y,h,w),zF(y,f,w),!0}return!1}function WN(h,f,y,w){if(w={lane:2,revertLane:SA(),gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},kx(h)){if(f)throw Error(s(479))}else f=Ag(h,y,w,2),f!==null&&Fo(f,h,2)}function kx(h){var f=h.alternate;return h===Zt||f!==null&&f===Zt}function PF(h,f){Oo=va=!0;var y=h.pending;y===null?f.next=f:(f.next=y.next,y.next=f),h.pending=f}function zF(h,f,y){if((y&4194048)!==0){var w=f.lanes;w&=h.pendingLanes,y|=w,f.lanes=y,za(h,y)}}var eb={readContext:Ti,use:nf,useCallback:Rs,useContext:Rs,useEffect:Rs,useImperativeHandle:Rs,useLayoutEffect:Rs,useInsertionEffect:Rs,useMemo:Rs,useReducer:Rs,useRef:Rs,useState:Rs,useDebugValue:Rs,useDeferredValue:Rs,useTransition:Rs,useSyncExternalStore:Rs,useId:Rs,useHostTransitionStatus:Rs,useFormState:Rs,useActionState:Rs,useOptimistic:Rs,useMemoCache:Rs,useCacheRefresh:Rs};eb.useEffectEvent=Rs;var BF={readContext:Ti,use:nf,useCallback:function(h,f){return li().memoizedState=[h,f===void 0?null:f],h},useContext:Ti,useEffect:CF,useImperativeHandle:function(h,f,y){y=y!=null?y.concat([h]):null,rf(4194308,4,NF.bind(null,f,h),y)},useLayoutEffect:function(h,f){return rf(4194308,4,h,f)},useInsertionEffect:function(h,f){rf(4,2,h,f)},useMemo:function(h,f){var y=li();f=f===void 0?null:f;var w=h();if(ha){un(!0);try{h()}finally{un(!1)}}return y.memoizedState=[w,f],w},useReducer:function(h,f,y){var w=li();if(y!==void 0){var T=y(f);if(ha){un(!0);try{y(f)}finally{un(!1)}}}else T=f;return w.memoizedState=w.baseState=T,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:T},w.queue=h,h=h.dispatch=tY.bind(null,Zt,h),[w.memoizedState,h]},useRef:function(h){var f=li();return h={current:h},f.memoizedState=h},useState:function(h){h=Vu(h);var f=h.queue,y=MF.bind(null,Zt,f);return f.dispatch=y,[h.memoizedState,y]},useDebugValue:BN,useDeferredValue:function(h,f){var y=li();return jN(y,h,f)},useTransition:function(){var h=Vu(!1);return h=DF.bind(null,Zt,h.queue,!0,!1),li().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,f,y){var w=Zt,T=li();if(Hn){if(y===void 0)throw Error(s(407));y=y()}else{if(y=f(),Us===null)throw Error(s(349));(Zn&127)!==0||Vc(w,f,y)}T.memoizedState=y;var E={value:y,getSnapshot:f};return T.queue=E,CF(Ky.bind(null,w,E,h),[h]),w.flags|=2048,Gh(9,{destroy:void 0},Yy.bind(null,w,E,y,f),null),y},useId:function(){var h=li(),f=Us.identifierPrefix;if(Hn){var y=Eo,w=Ao;y=(w&~(1<<32-Un(w)-1)).toString(32)+y,f="_"+f+"R_"+y,y=$r++,0<y&&(f+="H"+y.toString(32)),f+="_"}else y=zg++,f="_"+f+"r_"+y.toString(32)+"_";return h.memoizedState=f},useHostTransitionStatus:VN,useFormState:tc,useActionState:tc,useOptimistic:function(h){var f=li();f.memoizedState=f.baseState=h;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=y,f=WN.bind(null,Zt,!0,y),y.dispatch=f,[h,f]},useMemoCache:Wh,useCacheRefresh:function(){return li().memoizedState=eY.bind(null,Zt)},useEffectEvent:function(h){var f=li(),y={impl:h};return f.memoizedState=y,function(){if((bs&2)!==0)throw Error(s(440));return y.impl.apply(void 0,arguments)}}},HN={readContext:Ti,use:nf,useCallback:EF,useContext:Ti,useEffect:zN,useImperativeHandle:AF,useInsertionEffect:kF,useLayoutEffect:TF,useMemo:IF,useReducer:Ug,useRef:_x,useState:function(){return Ug(ec)},useDebugValue:BN,useDeferredValue:function(h,f){var y=cr();return OF(y,tn.memoizedState,h,f)},useTransition:function(){var h=Ug(ec)[0],f=cr().memoizedState;return[typeof h=="boolean"?h:Uu(h),f]},useSyncExternalStore:Wg,useId:LF,useHostTransitionStatus:VN,useFormState:Wc,useActionState:Wc,useOptimistic:function(h,f){var y=cr();return wx(y,tn,h,f)},useMemoCache:Wh,useCacheRefresh:FF};HN.useEffectEvent=_F;var jF={readContext:Ti,use:nf,useCallback:EF,useContext:Ti,useEffect:zN,useImperativeHandle:AF,useInsertionEffect:kF,useLayoutEffect:TF,useMemo:IF,useReducer:Vg,useRef:_x,useState:function(){return Vg(ec)},useDebugValue:BN,useDeferredValue:function(h,f){var y=cr();return tn===null?jN(y,h,f):OF(y,tn.memoizedState,h,f)},useTransition:function(){var h=Vg(ec)[0],f=cr().memoizedState;return[typeof h=="boolean"?h:Uu(h),f]},useSyncExternalStore:Wg,useId:LF,useHostTransitionStatus:VN,useFormState:qg,useActionState:qg,useOptimistic:function(h,f){var y=cr();return tn!==null?wx(y,tn,h,f):(y.baseState=h,[h,y.queue.dispatch])},useMemoCache:Wh,useCacheRefresh:FF};jF.useEffectEvent=_F;function GN(h,f,y,w){f=h.memoizedState,y=y(w,f),y=y==null?f:p({},f,y),h.memoizedState=y,h.lanes===0&&(h.updateQueue.baseState=y)}var qN={enqueueSetState:function(h,f,y){h=h._reactInternals;var w=gl(),T=an(w);T.payload=f,y!=null&&(T.callback=y),f=En(h,T,w),f!==null&&(Fo(f,h,w),gs(f,h,w))},enqueueReplaceState:function(h,f,y){h=h._reactInternals;var w=gl(),T=an(w);T.tag=1,T.payload=f,y!=null&&(T.callback=y),f=En(h,T,w),f!==null&&(Fo(f,h,w),gs(f,h,w))},enqueueForceUpdate:function(h,f){h=h._reactInternals;var y=gl(),w=an(y);w.tag=2,f!=null&&(w.callback=f),f=En(h,w,y),f!==null&&(Fo(f,h,y),gs(f,h,y))}};function UF(h,f,y,w,T,E,W){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(w,E,W):f.prototype&&f.prototype.isPureReactComponent?!Fc(y,w)||!Fc(T,E):!0}function VF(h,f,y,w){h=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(y,w),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(y,w),f.state!==h&&qN.enqueueReplaceState(f,f.state,null)}function jp(h,f){var y=f;if("ref"in f){y={};for(var w in f)w!=="ref"&&(y[w]=f[w])}if(h=h.defaultProps){y===f&&(y=p({},y));for(var T in h)y[T]===void 0&&(y[T]=h[T])}return y}function WF(h){Ip(h)}function HF(h){console.error(h)}function GF(h){Ip(h)}function Tx(h,f){try{var y=h.onUncaughtError;y(f.value,{componentStack:f.stack})}catch(w){setTimeout(function(){throw w})}}function qF(h,f,y){try{var w=h.onCaughtError;w(y.value,{componentStack:y.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function XN(h,f,y){return y=an(y),y.tag=3,y.payload={element:null},y.callback=function(){Tx(h,f)},y}function XF(h){return h=an(h),h.tag=3,h}function YF(h,f,y,w){var T=y.type.getDerivedStateFromError;if(typeof T=="function"){var E=w.value;h.payload=function(){return T(E)},h.callback=function(){qF(f,y,w)}}var W=y.stateNode;W!==null&&typeof W.componentDidCatch=="function"&&(h.callback=function(){qF(f,y,w),typeof T!="function"&&(uf===null?uf=new Set([this]):uf.add(this));var ae=w.stack;this.componentDidCatch(w.value,{componentStack:ae!==null?ae:""})})}function nY(h,f,y,w,T){if(y.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(f=y.alternate,f!==null&&Pu(f,y,T,!0),y=tr.current,y!==null){switch(y.tag){case 31:case 13:return is===null?Px():y.alternate===null&&Rr===0&&(Rr=3),y.flags&=-257,y.flags|=65536,y.lanes=T,w===Oe?y.flags|=16384:(f=y.updateQueue,f===null?y.updateQueue=new Set([w]):f.add(w),vA(h,w,T)),!1;case 22:return y.flags|=65536,w===Oe?y.flags|=16384:(f=y.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([w])},y.updateQueue=f):(y=f.retryQueue,y===null?f.retryQueue=new Set([w]):y.add(w)),vA(h,w,T)),!1}throw Error(s(435,y.tag))}return vA(h,w,T),Px(),!1}if(Hn)return f=tr.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=T,w!==fl&&(h=Error(s(422),{cause:w}),Qd(ko(h,y)))):(w!==fl&&(f=Error(s(423),{cause:w}),Qd(ko(f,y))),h=h.current.alternate,h.flags|=65536,T&=-T,h.lanes|=T,w=ko(w,y),T=XN(h.stateNode,w,T),Hr(h,T),Rr!==4&&(Rr=2)),!1;var E=Error(s(520),{cause:w});if(E=ko(E,y),lb===null?lb=[E]:lb.push(E),Rr!==4&&(Rr=2),f===null)return!0;w=ko(w,y),y=f;do{switch(y.tag){case 3:return y.flags|=65536,h=T&-T,y.lanes|=h,h=XN(y.stateNode,w,h),Hr(y,h),!1;case 1:if(f=y.type,E=y.stateNode,(y.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(uf===null||!uf.has(E))))return y.flags|=65536,T&=-T,y.lanes|=T,T=XF(T),YF(T,h,y,w),Hr(y,T),!1}y=y.return}while(y!==null);return!1}var YN=Error(s(461)),ci=!1;function da(h,f,y,w){f.child=h===null?kn(f,null,y,w):js(f,h.child,y,w)}function KF(h,f,y,w,T){y=y.render;var E=f.ref;if("ref"in w){var W={};for(var ae in w)ae!=="ref"&&(W[ae]=w[ae])}else W=w;return zu(f),w=Gy(h,f,y,W,E,T),ae=qy(),h!==null&&!ci?(Xy(h,f,T),qh(h,f,T)):(Hn&&ae&&Uy(f),f.flags|=1,da(h,f,w,T),f.child)}function ZF(h,f,y,w,T){if(h===null){var E=y.type;return typeof E=="function"&&!Ig(E)&&E.defaultProps===void 0&&y.compare===null?(f.tag=15,f.type=E,JF(h,f,E,w,T)):(h=Kd(y.type,null,w,f,f.mode,T),h.ref=f.ref,h.return=f,f.child=h)}if(E=h.child,!sA(h,T)){var W=E.memoizedProps;if(y=y.compare,y=y!==null?y:Fc,y(W,w)&&h.ref===f.ref)return qh(h,f,T)}return f.flags|=1,h=_o(E,w),h.ref=f.ref,h.return=f,f.child=h}function JF(h,f,y,w,T){if(h!==null){var E=h.memoizedProps;if(Fc(E,w)&&h.ref===f.ref)if(ci=!1,f.pendingProps=w=E,sA(h,T))(h.flags&131072)!==0&&(ci=!0);else return f.lanes=h.lanes,qh(h,f,T)}return KN(h,f,y,w,T)}function QF(h,f,y,w){var T=w.children,E=h!==null?h.memoizedState:null;if(h===null&&f.stateNode===null&&(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),w.mode==="hidden"){if((f.flags&128)!==0){if(E=E!==null?E.baseLanes|y:y,h!==null){for(w=f.child=h.child,T=0;w!==null;)T=T|w.lanes|w.childLanes,w=w.sibling;w=T&~E}else w=0,f.child=null;return eM(h,f,E,y,w)}if((y&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},h!==null&&ue(f,E!==null?E.cachePool:null),E!==null?er(f,E):hs(),Or(f);else return w=f.lanes=536870912,eM(h,f,E!==null?E.baseLanes|y:y,y,w)}else E!==null?(ue(f,E.cachePool),er(f,E),Dr(),f.memoizedState=null):(h!==null&&ue(f,null),hs(),Dr());return da(h,f,T,y),f.child}function tb(h,f){return h!==null&&h.tag===22||f.stateNode!==null||(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.sibling}function eM(h,f,y,w,T){var E=le();return E=E===null?null:{parent:Sr._currentValue,pool:E},f.memoizedState={baseLanes:y,cachePool:E},h!==null&&ue(f,null),hs(),Or(f),h!==null&&Pu(h,f,w,!0),f.childLanes=T,null}function Nx(h,f){return f=Ex({mode:f.mode,children:f.children},h.mode),f.ref=h.ref,h.child=f,f.return=h,f}function tM(h,f,y){return js(f,h.child,null,y),h=Nx(f,f.pendingProps),h.flags|=2,_s(f),f.memoizedState=null,h}function sY(h,f,y){var w=f.pendingProps,T=(f.flags&128)!==0;if(f.flags&=-129,h===null){if(Hn){if(w.mode==="hidden")return h=Nx(f,w),f.lanes=536870912,tb(null,h);if(ys(f),(h=Bs)?(h=fP(h,or),h=h!==null&&h.data==="&"?h:null,h!==null&&(f.memoizedState={dehydrated:h,treeContext:Ru!==null?{id:Ao,overflow:Eo}:null,retryLane:536870912,hydrationErrors:null},y=Og(h),y.return=f,f.child=y,_i=f,Bs=null)):h=null,h===null)throw Lu(f);return f.lanes=536870912,null}return Nx(f,w)}var E=h.memoizedState;if(E!==null){var W=E.dehydrated;if(ys(f),T)if(f.flags&256)f.flags&=-257,f=tM(h,f,y);else if(f.memoizedState!==null)f.child=h.child,f.flags|=128,f=null;else throw Error(s(558));else if(ci||Pu(h,f,y,!1),T=(y&h.childLanes)!==0,ci||T){if(w=Us,w!==null&&(W=Ba(w,y),W!==0&&W!==E.retryLane))throw E.retryLane=W,Bc(h,W),Fo(w,h,W),YN;Px(),f=tM(h,f,y)}else h=E.treeContext,Bs=nc(W.nextSibling),_i=f,Hn=!0,ua=null,or=!1,h!==null&&yx(f,h),f=Nx(f,w),f.flags|=4096;return f}return h=_o(h.child,{mode:w.mode,children:w.children}),h.ref=f.ref,f.child=h,h.return=f,h}function Ax(h,f){var y=f.ref;if(y===null)h!==null&&h.ref!==null&&(f.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(s(284));(h===null||h.ref!==y)&&(f.flags|=4194816)}}function KN(h,f,y,w,T){return zu(f),y=Gy(h,f,y,w,void 0,T),w=qy(),h!==null&&!ci?(Xy(h,f,T),qh(h,f,T)):(Hn&&w&&Uy(f),f.flags|=1,da(h,f,y,T),f.child)}function nM(h,f,y,w,T,E){return zu(f),f.updateQueue=null,y=Uc(f,w,y,T),Bg(h),w=qy(),h!==null&&!ci?(Xy(h,f,E),qh(h,f,E)):(Hn&&w&&Uy(f),f.flags|=1,da(h,f,y,E),f.child)}function sM(h,f,y,w,T){if(zu(f),f.stateNode===null){var E=Ci,W=y.contextType;typeof W=="object"&&W!==null&&(E=Ti(W)),E=new y(w,E),f.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=qN,f.stateNode=E,E._reactInternals=f,E=f.stateNode,E.props=w,E.state=f.memoizedState,E.refs={},mt(f),W=y.contextType,E.context=typeof W=="object"&&W!==null?Ti(W):Ci,E.state=f.memoizedState,W=y.getDerivedStateFromProps,typeof W=="function"&&(GN(f,y,W,w),E.state=f.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(W=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),W!==E.state&&qN.enqueueReplaceState(E,E.state,null),Er(f,w,E,T),$s(),E.state=f.memoizedState),typeof E.componentDidMount=="function"&&(f.flags|=4194308),w=!0}else if(h===null){E=f.stateNode;var ae=f.memoizedProps,we=jp(y,ae);E.props=we;var je=E.context,Ze=y.contextType;W=Ci,typeof Ze=="object"&&Ze!==null&&(W=Ti(Ze));var tt=y.getDerivedStateFromProps;Ze=typeof tt=="function"||typeof E.getSnapshotBeforeUpdate=="function",ae=f.pendingProps!==ae,Ze||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(ae||je!==W)&&VF(f,E,w,W),_t=!1;var Ue=f.memoizedState;E.state=Ue,Er(f,w,E,T),$s(),je=f.memoizedState,ae||Ue!==je||_t?(typeof tt=="function"&&(GN(f,y,tt,w),je=f.memoizedState),(we=_t||UF(f,y,we,w,Ue,je,W))?(Ze||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(f.flags|=4194308)):(typeof E.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=w,f.memoizedState=je),E.props=w,E.state=je,E.context=W,w=we):(typeof E.componentDidMount=="function"&&(f.flags|=4194308),w=!1)}else{E=f.stateNode,Qs(h,f),W=f.memoizedProps,Ze=jp(y,W),E.props=Ze,tt=f.pendingProps,Ue=E.context,je=y.contextType,we=Ci,typeof je=="object"&&je!==null&&(we=Ti(je)),ae=y.getDerivedStateFromProps,(je=typeof ae=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(W!==tt||Ue!==we)&&VF(f,E,w,we),_t=!1,Ue=f.memoizedState,E.state=Ue,Er(f,w,E,T),$s();var He=f.memoizedState;W!==tt||Ue!==He||_t||h!==null&&h.dependencies!==null&&Fg(h.dependencies)?(typeof ae=="function"&&(GN(f,y,ae,w),He=f.memoizedState),(Ze=_t||UF(f,y,Ze,w,Ue,He,we)||h!==null&&h.dependencies!==null&&Fg(h.dependencies))?(je||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(w,He,we),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(w,He,we)),typeof E.componentDidUpdate=="function"&&(f.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof E.componentDidUpdate!="function"||W===h.memoizedProps&&Ue===h.memoizedState||(f.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||W===h.memoizedProps&&Ue===h.memoizedState||(f.flags|=1024),f.memoizedProps=w,f.memoizedState=He),E.props=w,E.state=He,E.context=we,w=Ze):(typeof E.componentDidUpdate!="function"||W===h.memoizedProps&&Ue===h.memoizedState||(f.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||W===h.memoizedProps&&Ue===h.memoizedState||(f.flags|=1024),w=!1)}return E=w,Ax(h,f),w=(f.flags&128)!==0,E||w?(E=f.stateNode,y=w&&typeof y.getDerivedStateFromError!="function"?null:E.render(),f.flags|=1,h!==null&&w?(f.child=js(f,h.child,null,T),f.child=js(f,null,y,T)):da(h,f,y,T),f.memoizedState=E.state,h=f.child):h=qh(h,f,T),h}function rM(h,f,y,w){return Uh(),f.flags|=256,da(h,f,y,w),f.child}var ZN={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function JN(h){return{baseLanes:h,cachePool:pe()}}function QN(h,f,y){return h=h!==null?h.childLanes&~y:0,f&&(h|=ml),h}function iM(h,f,y){var w=f.pendingProps,T=!1,E=(f.flags&128)!==0,W;if((W=E)||(W=h!==null&&h.memoizedState===null?!1:(ns.current&2)!==0),W&&(T=!0,f.flags&=-129),W=(f.flags&32)!==0,f.flags&=-33,h===null){if(Hn){if(T?Cr(f):Dr(),(h=Bs)?(h=fP(h,or),h=h!==null&&h.data!=="&"?h:null,h!==null&&(f.memoizedState={dehydrated:h,treeContext:Ru!==null?{id:Ao,overflow:Eo}:null,retryLane:536870912,hydrationErrors:null},y=Og(h),y.return=f,f.child=y,_i=f,Bs=null)):h=null,h===null)throw Lu(f);return LA(h)?f.lanes=32:f.lanes=536870912,null}var ae=w.children;return w=w.fallback,T?(Dr(),T=f.mode,ae=Ex({mode:"hidden",children:ae},T),w=$u(w,T,y,null),ae.return=f,w.return=f,ae.sibling=w,f.child=ae,w=f.child,w.memoizedState=JN(y),w.childLanes=QN(h,W,y),f.memoizedState=ZN,tb(null,w)):(Cr(f),eA(f,ae))}var we=h.memoizedState;if(we!==null&&(ae=we.dehydrated,ae!==null)){if(E)f.flags&256?(Cr(f),f.flags&=-257,f=tA(h,f,y)):f.memoizedState!==null?(Dr(),f.child=h.child,f.flags|=128,f=null):(Dr(),ae=w.fallback,T=f.mode,w=Ex({mode:"visible",children:w.children},T),ae=$u(ae,T,y,null),ae.flags|=2,w.return=f,ae.return=f,w.sibling=ae,f.child=w,js(f,h.child,null,y),w=f.child,w.memoizedState=JN(y),w.childLanes=QN(h,W,y),f.memoizedState=ZN,f=tb(null,w));else if(Cr(f),LA(ae)){if(W=ae.nextSibling&&ae.nextSibling.dataset,W)var je=W.dgst;W=je,w=Error(s(419)),w.stack="",w.digest=W,Qd({value:w,source:null,stack:null}),f=tA(h,f,y)}else if(ci||Pu(h,f,y,!1),W=(y&h.childLanes)!==0,ci||W){if(W=Us,W!==null&&(w=Ba(W,y),w!==0&&w!==we.retryLane))throw we.retryLane=w,Bc(h,w),Fo(W,h,w),YN;RA(ae)||Px(),f=tA(h,f,y)}else RA(ae)?(f.flags|=192,f.child=h.child,f=null):(h=we.treeContext,Bs=nc(ae.nextSibling),_i=f,Hn=!0,ua=null,or=!1,h!==null&&yx(f,h),f=eA(f,w.children),f.flags|=4096);return f}return T?(Dr(),ae=w.fallback,T=f.mode,we=h.child,je=we.sibling,w=_o(we,{mode:"hidden",children:w.children}),w.subtreeFlags=we.subtreeFlags&65011712,je!==null?ae=_o(je,ae):(ae=$u(ae,T,y,null),ae.flags|=2),ae.return=f,w.return=f,w.sibling=ae,f.child=w,tb(null,w),w=f.child,ae=h.child.memoizedState,ae===null?ae=JN(y):(T=ae.cachePool,T!==null?(we=Sr._currentValue,T=T.parent!==we?{parent:we,pool:we}:T):T=pe(),ae={baseLanes:ae.baseLanes|y,cachePool:T}),w.memoizedState=ae,w.childLanes=QN(h,W,y),f.memoizedState=ZN,tb(h.child,w)):(Cr(f),y=h.child,h=y.sibling,y=_o(y,{mode:"visible",children:w.children}),y.return=f,y.sibling=null,h!==null&&(W=f.deletions,W===null?(f.deletions=[h],f.flags|=16):W.push(h)),f.child=y,f.memoizedState=null,y)}function eA(h,f){return f=Ex({mode:"visible",children:f},h.mode),f.return=h,h.child=f}function Ex(h,f){return h=ji(22,h,null,f),h.lanes=0,h}function tA(h,f,y){return js(f,h.child,null,y),h=eA(f,f.pendingProps.children),h.flags|=2,f.memoizedState=null,h}function aM(h,f,y){h.lanes|=f;var w=h.alternate;w!==null&&(w.lanes|=f),ef(h.return,f,y)}function nA(h,f,y,w,T,E){var W=h.memoizedState;W===null?h.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:w,tail:y,tailMode:T,treeForkCount:E}:(W.isBackwards=f,W.rendering=null,W.renderingStartTime=0,W.last=w,W.tail=y,W.tailMode=T,W.treeForkCount=E)}function oM(h,f,y){var w=f.pendingProps,T=w.revealOrder,E=w.tail;w=w.children;var W=ns.current,ae=(W&2)!==0;if(ae?(W=W&1|2,f.flags|=128):W&=1,G(ns,W),da(h,f,w,y),w=Hn?Fp:0,!ae&&h!==null&&(h.flags&128)!==0)e:for(h=f.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&aM(h,y,f);else if(h.tag===19)aM(h,y,f);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===f)break e;for(;h.sibling===null;){if(h.return===null||h.return===f)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}switch(T){case"forwards":for(y=f.child,T=null;y!==null;)h=y.alternate,h!==null&&Vi(h)===null&&(T=y),y=y.sibling;y=T,y===null?(T=f.child,f.child=null):(T=y.sibling,y.sibling=null),nA(f,!1,T,y,E,w);break;case"backwards":case"unstable_legacy-backwards":for(y=null,T=f.child,f.child=null;T!==null;){if(h=T.alternate,h!==null&&Vi(h)===null){f.child=T;break}h=T.sibling,T.sibling=y,y=T,T=h}nA(f,!0,y,null,E,w);break;case"together":nA(f,!1,null,null,void 0,w);break;default:f.memoizedState=null}return f.child}function qh(h,f,y){if(h!==null&&(f.dependencies=h.dependencies),cf|=f.lanes,(y&f.childLanes)===0)if(h!==null){if(Pu(h,f,y,!1),(y&f.childLanes)===0)return null}else return null;if(h!==null&&f.child!==h.child)throw Error(s(153));if(f.child!==null){for(h=f.child,y=_o(h,h.pendingProps),f.child=y,y.return=f;h.sibling!==null;)h=h.sibling,y=y.sibling=_o(h,h.pendingProps),y.return=f;y.sibling=null}return f.child}function sA(h,f){return(h.lanes&f)!==0?!0:(h=h.dependencies,!!(h!==null&&Fg(h)))}function rY(h,f,y){switch(f.tag){case 3:Ae(f,f.stateNode.containerInfo),Mu(f,Sr,h.memoizedState.cache),Uh();break;case 27:case 5:Fe(f);break;case 4:Ae(f,f.stateNode.containerInfo);break;case 10:Mu(f,f.type,f.memoizedProps.value);break;case 31:if(f.memoizedState!==null)return f.flags|=128,ys(f),null;break;case 13:var w=f.memoizedState;if(w!==null)return w.dehydrated!==null?(Cr(f),f.flags|=128,null):(y&f.child.childLanes)!==0?iM(h,f,y):(Cr(f),h=qh(h,f,y),h!==null?h.sibling:null);Cr(f);break;case 19:var T=(h.flags&128)!==0;if(w=(y&f.childLanes)!==0,w||(Pu(h,f,y,!1),w=(y&f.childLanes)!==0),T){if(w)return oM(h,f,y);f.flags|=128}if(T=f.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),G(ns,ns.current),w)break;return null;case 22:return f.lanes=0,QF(h,f,y,f.pendingProps);case 24:Mu(f,Sr,h.memoizedState.cache)}return qh(h,f,y)}function lM(h,f,y){if(h!==null)if(h.memoizedProps!==f.pendingProps)ci=!0;else{if(!sA(h,y)&&(f.flags&128)===0)return ci=!1,rY(h,f,y);ci=(h.flags&131072)!==0}else ci=!1,Hn&&(f.flags&1048576)!==0&&gx(f,Fp,f.index);switch(f.lanes=0,f.tag){case 16:e:{var w=f.pendingProps;if(h=Pe(f.elementType),f.type=h,typeof h=="function")Ig(h)?(w=jp(h,w),f.tag=1,f=sM(null,f,h,w,y)):(f.tag=0,f=KN(null,f,h,w,y));else{if(h!=null){var T=h.$$typeof;if(T===k){f.tag=11,f=KF(null,f,h,w,y);break e}else if(T===$){f.tag=14,f=ZF(null,f,h,w,y);break e}}throw f=q(h)||h,Error(s(306,f,""))}}return f;case 0:return KN(h,f,f.type,f.pendingProps,y);case 1:return w=f.type,T=jp(w,f.pendingProps),sM(h,f,w,T,y);case 3:e:{if(Ae(f,f.stateNode.containerInfo),h===null)throw Error(s(387));w=f.pendingProps;var E=f.memoizedState;T=E.element,Qs(h,f),Er(f,w,null,y);var W=f.memoizedState;if(w=W.cache,Mu(f,Sr,w),w!==E.cache&&Vh(f,[Sr],y,!0),$s(),w=W.element,E.isDehydrated)if(E={element:w,isDehydrated:!1,cache:W.cache},f.updateQueue.baseState=E,f.memoizedState=E,f.flags&256){f=rM(h,f,w,y);break e}else if(w!==T){T=ko(Error(s(424)),f),Qd(T),f=rM(h,f,w,y);break e}else for(h=f.stateNode.containerInfo,h.nodeType===9?h=h.body:h=h.nodeName==="HTML"?h.ownerDocument.body:h,Bs=nc(h.firstChild),_i=f,Hn=!0,ua=null,or=!0,y=kn(f,null,w,y),f.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(Uh(),w===T){f=qh(h,f,y);break e}da(h,f,w,y)}f=f.child}return f;case 26:return Ax(h,f),h===null?(y=vP(f.type,null,f.pendingProps,null))?f.memoizedState=y:Hn||(y=f.type,h=f.pendingProps,w=Hx(de.current).createElement(y),w[Cs]=f,w[Zs]=h,fa(w,y,h),br(w),f.stateNode=w):f.memoizedState=vP(f.type,h.memoizedProps,f.pendingProps,h.memoizedState),null;case 27:return Fe(f),h===null&&Hn&&(w=f.stateNode=gP(f.type,f.pendingProps,de.current),_i=f,or=!0,T=Bs,pf(f.type)?(FA=T,Bs=nc(w.firstChild)):Bs=T),da(h,f,f.pendingProps.children,y),Ax(h,f),h===null&&(f.flags|=4194304),f.child;case 5:return h===null&&Hn&&((T=w=Bs)&&(w=RY(w,f.type,f.pendingProps,or),w!==null?(f.stateNode=w,_i=f,Bs=nc(w.firstChild),or=!1,T=!0):T=!1),T||Lu(f)),Fe(f),T=f.type,E=f.pendingProps,W=h!==null?h.memoizedProps:null,w=E.children,OA(T,E)?w=null:W!==null&&OA(T,W)&&(f.flags|=32),f.memoizedState!==null&&(T=Gy(h,f,PN,null,null,y),gb._currentValue=T),Ax(h,f),da(h,f,w,y),f.child;case 6:return h===null&&Hn&&((h=y=Bs)&&(y=LY(y,f.pendingProps,or),y!==null?(f.stateNode=y,_i=f,Bs=null,h=!0):h=!1),h||Lu(f)),null;case 13:return iM(h,f,y);case 4:return Ae(f,f.stateNode.containerInfo),w=f.pendingProps,h===null?f.child=js(f,null,w,y):da(h,f,w,y),f.child;case 11:return KF(h,f,f.type,f.pendingProps,y);case 7:return da(h,f,f.pendingProps,y),f.child;case 8:return da(h,f,f.pendingProps.children,y),f.child;case 12:return da(h,f,f.pendingProps.children,y),f.child;case 10:return w=f.pendingProps,Mu(f,f.type,w.value),da(h,f,w.children,y),f.child;case 9:return T=f.type._context,w=f.pendingProps.children,zu(f),T=Ti(T),w=w(T),f.flags|=1,da(h,f,w,y),f.child;case 14:return ZF(h,f,f.type,f.pendingProps,y);case 15:return JF(h,f,f.type,f.pendingProps,y);case 19:return oM(h,f,y);case 31:return sY(h,f,y);case 22:return QF(h,f,y,f.pendingProps);case 24:return zu(f),w=Ti(Sr),h===null?(T=le(),T===null&&(T=Us,E=tf(),T.pooledCache=E,E.refCount++,E!==null&&(T.pooledCacheLanes|=y),T=E),f.memoizedState={parent:w,cache:T},mt(f),Mu(f,Sr,T)):((h.lanes&y)!==0&&(Qs(h,f),Er(f,null,null,y),$s()),T=h.memoizedState,E=f.memoizedState,T.parent!==w?(T={parent:w,cache:w},f.memoizedState=T,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=T),Mu(f,Sr,w)):(w=E.cache,Mu(f,Sr,w),w!==T.cache&&Vh(f,[Sr],y,!0))),da(h,f,f.pendingProps.children,y),f.child;case 29:throw f.pendingProps}throw Error(s(156,f.tag))}function Xh(h){h.flags|=4}function rA(h,f,y,w,T){if((f=(h.mode&32)!==0)&&(f=!1),f){if(h.flags|=16777216,(T&335544128)===T)if(h.stateNode.complete)h.flags|=8192;else if(LM())h.flags|=8192;else throw Xe=Oe,ze}else h.flags&=-16777217}function cM(h,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!_P(f))if(LM())h.flags|=8192;else throw Xe=Oe,ze}function Ix(h,f){f!==null&&(h.flags|=4),h.flags&16384&&(f=h.tag!==22?zl():536870912,h.lanes|=f,Zg|=f)}function nb(h,f){if(!Hn)switch(h.tailMode){case"hidden":f=h.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?h.tail=null:y.sibling=null;break;case"collapsed":y=h.tail;for(var w=null;y!==null;)y.alternate!==null&&(w=y),y=y.sibling;w===null?f||h.tail===null?h.tail=null:h.tail.sibling=null:w.sibling=null}}function nr(h){var f=h.alternate!==null&&h.alternate.child===h.child,y=0,w=0;if(f)for(var T=h.child;T!==null;)y|=T.lanes|T.childLanes,w|=T.subtreeFlags&65011712,w|=T.flags&65011712,T.return=h,T=T.sibling;else for(T=h.child;T!==null;)y|=T.lanes|T.childLanes,w|=T.subtreeFlags,w|=T.flags,T.return=h,T=T.sibling;return h.subtreeFlags|=w,h.childLanes=y,f}function iY(h,f,y){var w=f.pendingProps;switch(Rg(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nr(f),null;case 1:return nr(f),null;case 3:return y=f.stateNode,w=null,h!==null&&(w=h.memoizedState.cache),f.memoizedState.cache!==w&&(f.flags|=2048),Io(Sr),Ce(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(h===null||h.child===null)&&(ki(f)?Xh(f):h===null||h.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Wy())),nr(f),null;case 26:var T=f.type,E=f.memoizedState;return h===null?(Xh(f),E!==null?(nr(f),cM(f,E)):(nr(f),rA(f,T,null,w,y))):E?E!==h.memoizedState?(Xh(f),nr(f),cM(f,E)):(nr(f),f.flags&=-16777217):(h=h.memoizedProps,h!==w&&Xh(f),nr(f),rA(f,T,h,w,y)),null;case 27:if(Ge(f),y=de.current,T=f.type,h!==null&&f.stateNode!=null)h.memoizedProps!==w&&Xh(f);else{if(!w){if(f.stateNode===null)throw Error(s(166));return nr(f),null}h=J.current,ki(f)?Vy(f):(h=gP(T,w,y),f.stateNode=h,Xh(f))}return nr(f),null;case 5:if(Ge(f),T=f.type,h!==null&&f.stateNode!=null)h.memoizedProps!==w&&Xh(f);else{if(!w){if(f.stateNode===null)throw Error(s(166));return nr(f),null}if(E=J.current,ki(f))Vy(f);else{var W=Hx(de.current);switch(E){case 1:E=W.createElementNS("http://www.w3.org/2000/svg",T);break;case 2:E=W.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;default:switch(T){case"svg":E=W.createElementNS("http://www.w3.org/2000/svg",T);break;case"math":E=W.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;case"script":E=W.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof w.is=="string"?W.createElement("select",{is:w.is}):W.createElement("select"),w.multiple?E.multiple=!0:w.size&&(E.size=w.size);break;default:E=typeof w.is=="string"?W.createElement(T,{is:w.is}):W.createElement(T)}}E[Cs]=f,E[Zs]=w;e:for(W=f.child;W!==null;){if(W.tag===5||W.tag===6)E.appendChild(W.stateNode);else if(W.tag!==4&&W.tag!==27&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===f)break e;for(;W.sibling===null;){if(W.return===null||W.return===f)break e;W=W.return}W.sibling.return=W.return,W=W.sibling}f.stateNode=E;e:switch(fa(E,T,w),T){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}w&&Xh(f)}}return nr(f),rA(f,f.type,h===null?null:h.memoizedProps,f.pendingProps,y),null;case 6:if(h&&f.stateNode!=null)h.memoizedProps!==w&&Xh(f);else{if(typeof w!="string"&&f.stateNode===null)throw Error(s(166));if(h=de.current,ki(f)){if(h=f.stateNode,y=f.memoizedProps,w=null,T=_i,T!==null)switch(T.tag){case 27:case 5:w=T.memoizedProps}h[Cs]=f,h=!!(h.nodeValue===y||w!==null&&w.suppressHydrationWarning===!0||iP(h.nodeValue,y)),h||Lu(f,!0)}else h=Hx(h).createTextNode(w),h[Cs]=f,f.stateNode=h}return nr(f),null;case 31:if(y=f.memoizedState,h===null||h.memoizedState!==null){if(w=ki(f),y!==null){if(h===null){if(!w)throw Error(s(318));if(h=f.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(s(557));h[Cs]=f}else Uh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;nr(f),h=!1}else y=Wy(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=y),h=!0;if(!h)return f.flags&256?(_s(f),f):(_s(f),null);if((f.flags&128)!==0)throw Error(s(558))}return nr(f),null;case 13:if(w=f.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(T=ki(f),w!==null&&w.dehydrated!==null){if(h===null){if(!T)throw Error(s(318));if(T=f.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(s(317));T[Cs]=f}else Uh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;nr(f),T=!1}else T=Wy(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=T),T=!0;if(!T)return f.flags&256?(_s(f),f):(_s(f),null)}return _s(f),(f.flags&128)!==0?(f.lanes=y,f):(y=w!==null,h=h!==null&&h.memoizedState!==null,y&&(w=f.child,T=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(T=w.alternate.memoizedState.cachePool.pool),E=null,w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(E=w.memoizedState.cachePool.pool),E!==T&&(w.flags|=2048)),y!==h&&y&&(f.child.flags|=8192),Ix(f,f.updateQueue),nr(f),null);case 4:return Ce(),h===null&&TA(f.stateNode.containerInfo),nr(f),null;case 10:return Io(f.type),nr(f),null;case 19:if(B(ns),w=f.memoizedState,w===null)return nr(f),null;if(T=(f.flags&128)!==0,E=w.rendering,E===null)if(T)nb(w,!1);else{if(Rr!==0||h!==null&&(h.flags&128)!==0)for(h=f.child;h!==null;){if(E=Vi(h),E!==null){for(f.flags|=128,nb(w,!1),h=E.updateQueue,f.updateQueue=h,Ix(f,h),f.subtreeFlags=0,h=y,y=f.child;y!==null;)Rp(y,h),y=y.sibling;return G(ns,ns.current&1|2),Hn&&Ya(f,w.treeForkCount),f.child}h=h.sibling}w.tail!==null&&Yt()>Lx&&(f.flags|=128,T=!0,nb(w,!1),f.lanes=4194304)}else{if(!T)if(h=Vi(E),h!==null){if(f.flags|=128,T=!0,h=h.updateQueue,f.updateQueue=h,Ix(f,h),nb(w,!0),w.tail===null&&w.tailMode==="hidden"&&!E.alternate&&!Hn)return nr(f),null}else 2*Yt()-w.renderingStartTime>Lx&&y!==536870912&&(f.flags|=128,T=!0,nb(w,!1),f.lanes=4194304);w.isBackwards?(E.sibling=f.child,f.child=E):(h=w.last,h!==null?h.sibling=E:f.child=E,w.last=E)}return w.tail!==null?(h=w.tail,w.rendering=h,w.tail=h.sibling,w.renderingStartTime=Yt(),h.sibling=null,y=ns.current,G(ns,T?y&1|2:y&1),Hn&&Ya(f,w.treeForkCount),h):(nr(f),null);case 22:case 23:return _s(f),Gr(),w=f.memoizedState!==null,h!==null?h.memoizedState!==null!==w&&(f.flags|=8192):w&&(f.flags|=8192),w?(y&536870912)!==0&&(f.flags&128)===0&&(nr(f),f.subtreeFlags&6&&(f.flags|=8192)):nr(f),y=f.updateQueue,y!==null&&Ix(f,y.retryQueue),y=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==y&&(f.flags|=2048),h!==null&&B(se),null;case 24:return y=null,h!==null&&(y=h.memoizedState.cache),f.memoizedState.cache!==y&&(f.flags|=2048),Io(Sr),nr(f),null;case 25:return null;case 30:return null}throw Error(s(156,f.tag))}function aY(h,f){switch(Rg(f),f.tag){case 1:return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 3:return Io(Sr),Ce(),h=f.flags,(h&65536)!==0&&(h&128)===0?(f.flags=h&-65537|128,f):null;case 26:case 27:case 5:return Ge(f),null;case 31:if(f.memoizedState!==null){if(_s(f),f.alternate===null)throw Error(s(340));Uh()}return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 13:if(_s(f),h=f.memoizedState,h!==null&&h.dehydrated!==null){if(f.alternate===null)throw Error(s(340));Uh()}return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 19:return B(ns),null;case 4:return Ce(),null;case 10:return Io(f.type),null;case 22:case 23:return _s(f),Gr(),h!==null&&B(se),h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 24:return Io(Sr),null;case 25:return null;default:return null}}function uM(h,f){switch(Rg(f),f.tag){case 3:Io(Sr),Ce();break;case 26:case 27:case 5:Ge(f);break;case 4:Ce();break;case 31:f.memoizedState!==null&&_s(f);break;case 13:_s(f);break;case 19:B(ns);break;case 10:Io(f.type);break;case 22:case 23:_s(f),Gr(),h!==null&&B(se);break;case 24:Io(Sr)}}function sb(h,f){try{var y=f.updateQueue,w=y!==null?y.lastEffect:null;if(w!==null){var T=w.next;y=T;do{if((y.tag&h)===h){w=void 0;var E=y.create,W=y.inst;w=E(),W.destroy=w}y=y.next}while(y!==T)}}catch(ae){Ts(f,f.return,ae)}}function of(h,f,y){try{var w=f.updateQueue,T=w!==null?w.lastEffect:null;if(T!==null){var E=T.next;w=E;do{if((w.tag&h)===h){var W=w.inst,ae=W.destroy;if(ae!==void 0){W.destroy=void 0,T=f;var we=y,je=ae;try{je()}catch(Ze){Ts(T,we,Ze)}}}w=w.next}while(w!==E)}}catch(Ze){Ts(f,f.return,Ze)}}function hM(h){var f=h.updateQueue;if(f!==null){var y=h.stateNode;try{Ir(f,y)}catch(w){Ts(h,h.return,w)}}}function dM(h,f,y){y.props=jp(h.type,h.memoizedProps),y.state=h.memoizedState;try{y.componentWillUnmount()}catch(w){Ts(h,f,w)}}function rb(h,f){try{var y=h.ref;if(y!==null){switch(h.tag){case 26:case 27:case 5:var w=h.stateNode;break;case 30:w=h.stateNode;break;default:w=h.stateNode}typeof y=="function"?h.refCleanup=y(w):y.current=w}}catch(T){Ts(h,f,T)}}function Wu(h,f){var y=h.ref,w=h.refCleanup;if(y!==null)if(typeof w=="function")try{w()}catch(T){Ts(h,f,T)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(T){Ts(h,f,T)}else y.current=null}function fM(h){var f=h.type,y=h.memoizedProps,w=h.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":y.autoFocus&&w.focus();break e;case"img":y.src?w.src=y.src:y.srcSet&&(w.srcset=y.srcSet)}}catch(T){Ts(h,h.return,T)}}function iA(h,f,y){try{var w=h.stateNode;AY(w,h.type,y,f),w[Zs]=f}catch(T){Ts(h,h.return,T)}}function pM(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&pf(h.type)||h.tag===4}function aA(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||pM(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&pf(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function oA(h,f,y){var w=h.tag;if(w===5||w===6)h=h.stateNode,f?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(h,f):(f=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,f.appendChild(h),y=y._reactRootContainer,y!=null||f.onclick!==null||(f.onclick=ol));else if(w!==4&&(w===27&&pf(h.type)&&(y=h.stateNode,f=null),h=h.child,h!==null))for(oA(h,f,y),h=h.sibling;h!==null;)oA(h,f,y),h=h.sibling}function Ox(h,f,y){var w=h.tag;if(w===5||w===6)h=h.stateNode,f?y.insertBefore(h,f):y.appendChild(h);else if(w!==4&&(w===27&&pf(h.type)&&(y=h.stateNode),h=h.child,h!==null))for(Ox(h,f,y),h=h.sibling;h!==null;)Ox(h,f,y),h=h.sibling}function mM(h){var f=h.stateNode,y=h.memoizedProps;try{for(var w=h.type,T=f.attributes;T.length;)f.removeAttributeNode(T[0]);fa(f,w,y),f[Cs]=h,f[Zs]=y}catch(E){Ts(h,h.return,E)}}var Yh=!1,ui=!1,lA=!1,gM=typeof WeakSet=="function"?WeakSet:Set,Wi=null;function oY(h,f){if(h=h.containerInfo,EA=Jx,h=Pc(h),Zl(h)){if("selectionStart"in h)var y={start:h.selectionStart,end:h.selectionEnd};else e:{y=(y=h.ownerDocument)&&y.defaultView||window;var w=y.getSelection&&y.getSelection();if(w&&w.rangeCount!==0){y=w.anchorNode;var T=w.anchorOffset,E=w.focusNode;w=w.focusOffset;try{y.nodeType,E.nodeType}catch{y=null;break e}var W=0,ae=-1,we=-1,je=0,Ze=0,tt=h,Ue=null;t:for(;;){for(var He;tt!==y||T!==0&&tt.nodeType!==3||(ae=W+T),tt!==E||w!==0&&tt.nodeType!==3||(we=W+w),tt.nodeType===3&&(W+=tt.nodeValue.length),(He=tt.firstChild)!==null;)Ue=tt,tt=He;for(;;){if(tt===h)break t;if(Ue===y&&++je===T&&(ae=W),Ue===E&&++Ze===w&&(we=W),(He=tt.nextSibling)!==null)break;tt=Ue,Ue=tt.parentNode}tt=He}y=ae===-1||we===-1?null:{start:ae,end:we}}else y=null}y=y||{start:0,end:0}}else y=null;for(IA={focusedElem:h,selectionRange:y},Jx=!1,Wi=f;Wi!==null;)if(f=Wi,h=f.child,(f.subtreeFlags&1028)!==0&&h!==null)h.return=f,Wi=h;else for(;Wi!==null;){switch(f=Wi,E=f.alternate,h=f.flags,f.tag){case 0:if((h&4)!==0&&(h=f.updateQueue,h=h!==null?h.events:null,h!==null))for(y=0;y<h.length;y++)T=h[y],T.ref.impl=T.nextImpl;break;case 11:case 15:break;case 1:if((h&1024)!==0&&E!==null){h=void 0,y=f,T=E.memoizedProps,E=E.memoizedState,w=y.stateNode;try{var $t=jp(y.type,T);h=w.getSnapshotBeforeUpdate($t,E),w.__reactInternalSnapshotBeforeUpdate=h}catch(ln){Ts(y,y.return,ln)}}break;case 3:if((h&1024)!==0){if(h=f.stateNode.containerInfo,y=h.nodeType,y===9)$A(h);else if(y===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":$A(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(s(163))}if(h=f.sibling,h!==null){h.return=f.return,Wi=h;break}Wi=f.return}}function yM(h,f,y){var w=y.flags;switch(y.tag){case 0:case 11:case 15:Zh(h,y),w&4&&sb(5,y);break;case 1:if(Zh(h,y),w&4)if(h=y.stateNode,f===null)try{h.componentDidMount()}catch(W){Ts(y,y.return,W)}else{var T=jp(y.type,f.memoizedProps);f=f.memoizedState;try{h.componentDidUpdate(T,f,h.__reactInternalSnapshotBeforeUpdate)}catch(W){Ts(y,y.return,W)}}w&64&&hM(y),w&512&&rb(y,y.return);break;case 3:if(Zh(h,y),w&64&&(h=y.updateQueue,h!==null)){if(f=null,y.child!==null)switch(y.child.tag){case 27:case 5:f=y.child.stateNode;break;case 1:f=y.child.stateNode}try{Ir(h,f)}catch(W){Ts(y,y.return,W)}}break;case 27:f===null&&w&4&&mM(y);case 26:case 5:Zh(h,y),f===null&&w&4&&fM(y),w&512&&rb(y,y.return);break;case 12:Zh(h,y);break;case 31:Zh(h,y),w&4&&wM(h,y);break;case 13:Zh(h,y),w&4&&xM(h,y),w&64&&(h=y.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(y=gY.bind(null,y),FY(h,y))));break;case 22:if(w=y.memoizedState!==null||Yh,!w){f=f!==null&&f.memoizedState!==null||ui,T=Yh;var E=ui;Yh=w,(ui=f)&&!E?Jh(h,y,(y.subtreeFlags&8772)!==0):Zh(h,y),Yh=T,ui=E}break;case 30:break;default:Zh(h,y)}}function bM(h){var f=h.alternate;f!==null&&(h.alternate=null,bM(f)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(f=h.stateNode,f!==null&&Nu(f)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var ur=null,Do=!1;function Kh(h,f,y){for(y=y.child;y!==null;)vM(h,f,y),y=y.sibling}function vM(h,f,y){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(Cn,y)}catch{}switch(y.tag){case 26:ui||Wu(y,f),Kh(h,f,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:ui||Wu(y,f);var w=ur,T=Do;pf(y.type)&&(ur=y.stateNode,Do=!1),Kh(h,f,y),fb(y.stateNode),ur=w,Do=T;break;case 5:ui||Wu(y,f);case 6:if(w=ur,T=Do,ur=null,Kh(h,f,y),ur=w,Do=T,ur!==null)if(Do)try{(ur.nodeType===9?ur.body:ur.nodeName==="HTML"?ur.ownerDocument.body:ur).removeChild(y.stateNode)}catch(E){Ts(y,f,E)}else try{ur.removeChild(y.stateNode)}catch(E){Ts(y,f,E)}break;case 18:ur!==null&&(Do?(h=ur,hP(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,y.stateNode),i0(h)):hP(ur,y.stateNode));break;case 4:w=ur,T=Do,ur=y.stateNode.containerInfo,Do=!0,Kh(h,f,y),ur=w,Do=T;break;case 0:case 11:case 14:case 15:of(2,y,f),ui||of(4,y,f),Kh(h,f,y);break;case 1:ui||(Wu(y,f),w=y.stateNode,typeof w.componentWillUnmount=="function"&&dM(y,f,w)),Kh(h,f,y);break;case 21:Kh(h,f,y);break;case 22:ui=(w=ui)||y.memoizedState!==null,Kh(h,f,y),ui=w;break;default:Kh(h,f,y)}}function wM(h,f){if(f.memoizedState===null&&(h=f.alternate,h!==null&&(h=h.memoizedState,h!==null))){h=h.dehydrated;try{i0(h)}catch(y){Ts(f,f.return,y)}}}function xM(h,f){if(f.memoizedState===null&&(h=f.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{i0(h)}catch(y){Ts(f,f.return,y)}}function lY(h){switch(h.tag){case 31:case 13:case 19:var f=h.stateNode;return f===null&&(f=h.stateNode=new gM),f;case 22:return h=h.stateNode,f=h._retryCache,f===null&&(f=h._retryCache=new gM),f;default:throw Error(s(435,h.tag))}}function Dx(h,f){var y=lY(h);f.forEach(function(w){if(!y.has(w)){y.add(w);var T=yY.bind(null,h,w);w.then(T,T)}})}function $o(h,f){var y=f.deletions;if(y!==null)for(var w=0;w<y.length;w++){var T=y[w],E=h,W=f,ae=W;e:for(;ae!==null;){switch(ae.tag){case 27:if(pf(ae.type)){ur=ae.stateNode,Do=!1;break e}break;case 5:ur=ae.stateNode,Do=!1;break e;case 3:case 4:ur=ae.stateNode.containerInfo,Do=!0;break e}ae=ae.return}if(ur===null)throw Error(s(160));vM(E,W,T),ur=null,Do=!1,E=T.alternate,E!==null&&(E.return=null),T.return=null}if(f.subtreeFlags&13886)for(f=f.child;f!==null;)SM(f,h),f=f.sibling}var Gc=null;function SM(h,f){var y=h.alternate,w=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:$o(f,h),Ro(h),w&4&&(of(3,h,h.return),sb(3,h),of(5,h,h.return));break;case 1:$o(f,h),Ro(h),w&512&&(ui||y===null||Wu(y,y.return)),w&64&&Yh&&(h=h.updateQueue,h!==null&&(w=h.callbacks,w!==null&&(y=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=y===null?w:y.concat(w))));break;case 26:var T=Gc;if($o(f,h),Ro(h),w&512&&(ui||y===null||Wu(y,y.return)),w&4){var E=y!==null?y.memoizedState:null;if(w=h.memoizedState,y===null)if(w===null)if(h.stateNode===null){e:{w=h.type,y=h.memoizedProps,T=T.ownerDocument||T;t:switch(w){case"title":E=T.getElementsByTagName("title")[0],(!E||E[tl]||E[Cs]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=T.createElement(w),T.head.insertBefore(E,T.querySelector("head > title"))),fa(E,w,y),E[Cs]=h,br(E),w=E;break e;case"link":var W=SP("link","href",T).get(w+(y.href||""));if(W){for(var ae=0;ae<W.length;ae++)if(E=W[ae],E.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&E.getAttribute("rel")===(y.rel==null?null:y.rel)&&E.getAttribute("title")===(y.title==null?null:y.title)&&E.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){W.splice(ae,1);break t}}E=T.createElement(w),fa(E,w,y),T.head.appendChild(E);break;case"meta":if(W=SP("meta","content",T).get(w+(y.content||""))){for(ae=0;ae<W.length;ae++)if(E=W[ae],E.getAttribute("content")===(y.content==null?null:""+y.content)&&E.getAttribute("name")===(y.name==null?null:y.name)&&E.getAttribute("property")===(y.property==null?null:y.property)&&E.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&E.getAttribute("charset")===(y.charSet==null?null:y.charSet)){W.splice(ae,1);break t}}E=T.createElement(w),fa(E,w,y),T.head.appendChild(E);break;default:throw Error(s(468,w))}E[Cs]=h,br(E),w=E}h.stateNode=w}else CP(T,h.type,h.stateNode);else h.stateNode=xP(T,w,h.memoizedProps);else E!==w?(E===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):E.count--,w===null?CP(T,h.type,h.stateNode):xP(T,w,h.memoizedProps)):w===null&&h.stateNode!==null&&iA(h,h.memoizedProps,y.memoizedProps)}break;case 27:$o(f,h),Ro(h),w&512&&(ui||y===null||Wu(y,y.return)),y!==null&&w&4&&iA(h,h.memoizedProps,y.memoizedProps);break;case 5:if($o(f,h),Ro(h),w&512&&(ui||y===null||Wu(y,y.return)),h.flags&32){T=h.stateNode;try{al(T,"")}catch($t){Ts(h,h.return,$t)}}w&4&&h.stateNode!=null&&(T=h.memoizedProps,iA(h,T,y!==null?y.memoizedProps:T)),w&1024&&(lA=!0);break;case 6:if($o(f,h),Ro(h),w&4){if(h.stateNode===null)throw Error(s(162));w=h.memoizedProps,y=h.stateNode;try{y.nodeValue=w}catch($t){Ts(h,h.return,$t)}}break;case 3:if(Xx=null,T=Gc,Gc=Gx(f.containerInfo),$o(f,h),Gc=T,Ro(h),w&4&&y!==null&&y.memoizedState.isDehydrated)try{i0(f.containerInfo)}catch($t){Ts(h,h.return,$t)}lA&&(lA=!1,CM(h));break;case 4:w=Gc,Gc=Gx(h.stateNode.containerInfo),$o(f,h),Ro(h),Gc=w;break;case 12:$o(f,h),Ro(h);break;case 31:$o(f,h),Ro(h),w&4&&(w=h.updateQueue,w!==null&&(h.updateQueue=null,Dx(h,w)));break;case 13:$o(f,h),Ro(h),h.child.flags&8192&&h.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(Rx=Yt()),w&4&&(w=h.updateQueue,w!==null&&(h.updateQueue=null,Dx(h,w)));break;case 22:T=h.memoizedState!==null;var we=y!==null&&y.memoizedState!==null,je=Yh,Ze=ui;if(Yh=je||T,ui=Ze||we,$o(f,h),ui=Ze,Yh=je,Ro(h),w&8192)e:for(f=h.stateNode,f._visibility=T?f._visibility&-2:f._visibility|1,T&&(y===null||we||Yh||ui||Up(h)),y=null,f=h;;){if(f.tag===5||f.tag===26){if(y===null){we=y=f;try{if(E=we.stateNode,T)W=E.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none";else{ae=we.stateNode;var tt=we.memoizedProps.style,Ue=tt!=null&&tt.hasOwnProperty("display")?tt.display:null;ae.style.display=Ue==null||typeof Ue=="boolean"?"":(""+Ue).trim()}}catch($t){Ts(we,we.return,$t)}}}else if(f.tag===6){if(y===null){we=f;try{we.stateNode.nodeValue=T?"":we.memoizedProps}catch($t){Ts(we,we.return,$t)}}}else if(f.tag===18){if(y===null){we=f;try{var He=we.stateNode;T?dP(He,!0):dP(we.stateNode,!1)}catch($t){Ts(we,we.return,$t)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===h)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break e;for(;f.sibling===null;){if(f.return===null||f.return===h)break e;y===f&&(y=null),f=f.return}y===f&&(y=null),f.sibling.return=f.return,f=f.sibling}w&4&&(w=h.updateQueue,w!==null&&(y=w.retryQueue,y!==null&&(w.retryQueue=null,Dx(h,y))));break;case 19:$o(f,h),Ro(h),w&4&&(w=h.updateQueue,w!==null&&(h.updateQueue=null,Dx(h,w)));break;case 30:break;case 21:break;default:$o(f,h),Ro(h)}}function Ro(h){var f=h.flags;if(f&2){try{for(var y,w=h.return;w!==null;){if(pM(w)){y=w;break}w=w.return}if(y==null)throw Error(s(160));switch(y.tag){case 27:var T=y.stateNode,E=aA(h);Ox(h,E,T);break;case 5:var W=y.stateNode;y.flags&32&&(al(W,""),y.flags&=-33);var ae=aA(h);Ox(h,ae,W);break;case 3:case 4:var we=y.stateNode.containerInfo,je=aA(h);oA(h,je,we);break;default:throw Error(s(161))}}catch(Ze){Ts(h,h.return,Ze)}h.flags&=-3}f&4096&&(h.flags&=-4097)}function CM(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var f=h;CM(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),h=h.sibling}}function Zh(h,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)yM(h,f.alternate,f),f=f.sibling}function Up(h){for(h=h.child;h!==null;){var f=h;switch(f.tag){case 0:case 11:case 14:case 15:of(4,f,f.return),Up(f);break;case 1:Wu(f,f.return);var y=f.stateNode;typeof y.componentWillUnmount=="function"&&dM(f,f.return,y),Up(f);break;case 27:fb(f.stateNode);case 26:case 5:Wu(f,f.return),Up(f);break;case 22:f.memoizedState===null&&Up(f);break;case 30:Up(f);break;default:Up(f)}h=h.sibling}}function Jh(h,f,y){for(y=y&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var w=f.alternate,T=h,E=f,W=E.flags;switch(E.tag){case 0:case 11:case 15:Jh(T,E,y),sb(4,E);break;case 1:if(Jh(T,E,y),w=E,T=w.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(je){Ts(w,w.return,je)}if(w=E,T=w.updateQueue,T!==null){var ae=w.stateNode;try{var we=T.shared.hiddenCallbacks;if(we!==null)for(T.shared.hiddenCallbacks=null,T=0;T<we.length;T++)Ui(we[T],ae)}catch(je){Ts(w,w.return,je)}}y&&W&64&&hM(E),rb(E,E.return);break;case 27:mM(E);case 26:case 5:Jh(T,E,y),y&&w===null&&W&4&&fM(E),rb(E,E.return);break;case 12:Jh(T,E,y);break;case 31:Jh(T,E,y),y&&W&4&&wM(T,E);break;case 13:Jh(T,E,y),y&&W&4&&xM(T,E);break;case 22:E.memoizedState===null&&Jh(T,E,y),rb(E,E.return);break;case 30:break;default:Jh(T,E,y)}f=f.sibling}}function cA(h,f){var y=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),h=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(h=f.memoizedState.cachePool.pool),h!==y&&(h!=null&&h.refCount++,y!=null&&Mp(y))}function uA(h,f){h=null,f.alternate!==null&&(h=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==h&&(f.refCount++,h!=null&&Mp(h))}function qc(h,f,y,w){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)_M(h,f,y,w),f=f.sibling}function _M(h,f,y,w){var T=f.flags;switch(f.tag){case 0:case 11:case 15:qc(h,f,y,w),T&2048&&sb(9,f);break;case 1:qc(h,f,y,w);break;case 3:qc(h,f,y,w),T&2048&&(h=null,f.alternate!==null&&(h=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==h&&(f.refCount++,h!=null&&Mp(h)));break;case 12:if(T&2048){qc(h,f,y,w),h=f.stateNode;try{var E=f.memoizedProps,W=E.id,ae=E.onPostCommit;typeof ae=="function"&&ae(W,f.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(we){Ts(f,f.return,we)}}else qc(h,f,y,w);break;case 31:qc(h,f,y,w);break;case 13:qc(h,f,y,w);break;case 23:break;case 22:E=f.stateNode,W=f.alternate,f.memoizedState!==null?E._visibility&2?qc(h,f,y,w):ib(h,f):E._visibility&2?qc(h,f,y,w):(E._visibility|=2,Xg(h,f,y,w,(f.subtreeFlags&10256)!==0||!1)),T&2048&&cA(W,f);break;case 24:qc(h,f,y,w),T&2048&&uA(f.alternate,f);break;default:qc(h,f,y,w)}}function Xg(h,f,y,w,T){for(T=T&&((f.subtreeFlags&10256)!==0||!1),f=f.child;f!==null;){var E=h,W=f,ae=y,we=w,je=W.flags;switch(W.tag){case 0:case 11:case 15:Xg(E,W,ae,we,T),sb(8,W);break;case 23:break;case 22:var Ze=W.stateNode;W.memoizedState!==null?Ze._visibility&2?Xg(E,W,ae,we,T):ib(E,W):(Ze._visibility|=2,Xg(E,W,ae,we,T)),T&&je&2048&&cA(W.alternate,W);break;case 24:Xg(E,W,ae,we,T),T&&je&2048&&uA(W.alternate,W);break;default:Xg(E,W,ae,we,T)}f=f.sibling}}function ib(h,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var y=h,w=f,T=w.flags;switch(w.tag){case 22:ib(y,w),T&2048&&cA(w.alternate,w);break;case 24:ib(y,w),T&2048&&uA(w.alternate,w);break;default:ib(y,w)}f=f.sibling}}var ab=8192;function Yg(h,f,y){if(h.subtreeFlags&ab)for(h=h.child;h!==null;)kM(h,f,y),h=h.sibling}function kM(h,f,y){switch(h.tag){case 26:Yg(h,f,y),h.flags&ab&&h.memoizedState!==null&&XY(y,Gc,h.memoizedState,h.memoizedProps);break;case 5:Yg(h,f,y);break;case 3:case 4:var w=Gc;Gc=Gx(h.stateNode.containerInfo),Yg(h,f,y),Gc=w;break;case 22:h.memoizedState===null&&(w=h.alternate,w!==null&&w.memoizedState!==null?(w=ab,ab=16777216,Yg(h,f,y),ab=w):Yg(h,f,y));break;default:Yg(h,f,y)}}function TM(h){var f=h.alternate;if(f!==null&&(h=f.child,h!==null)){f.child=null;do f=h.sibling,h.sibling=null,h=f;while(h!==null)}}function ob(h){var f=h.deletions;if((h.flags&16)!==0){if(f!==null)for(var y=0;y<f.length;y++){var w=f[y];Wi=w,AM(w,h)}TM(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)NM(h),h=h.sibling}function NM(h){switch(h.tag){case 0:case 11:case 15:ob(h),h.flags&2048&&of(9,h,h.return);break;case 3:ob(h);break;case 12:ob(h);break;case 22:var f=h.stateNode;h.memoizedState!==null&&f._visibility&2&&(h.return===null||h.return.tag!==13)?(f._visibility&=-3,$x(h)):ob(h);break;default:ob(h)}}function $x(h){var f=h.deletions;if((h.flags&16)!==0){if(f!==null)for(var y=0;y<f.length;y++){var w=f[y];Wi=w,AM(w,h)}TM(h)}for(h=h.child;h!==null;){switch(f=h,f.tag){case 0:case 11:case 15:of(8,f,f.return),$x(f);break;case 22:y=f.stateNode,y._visibility&2&&(y._visibility&=-3,$x(f));break;default:$x(f)}h=h.sibling}}function AM(h,f){for(;Wi!==null;){var y=Wi;switch(y.tag){case 0:case 11:case 15:of(8,y,f);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var w=y.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:Mp(y.memoizedState.cache)}if(w=y.child,w!==null)w.return=y,Wi=w;else e:for(y=h;Wi!==null;){w=Wi;var T=w.sibling,E=w.return;if(bM(w),w===y){Wi=null;break e}if(T!==null){T.return=E,Wi=T;break e}Wi=E}}}var cY={getCacheForType:function(h){var f=Ti(Sr),y=f.data.get(h);return y===void 0&&(y=h(),f.data.set(h,y)),y},cacheSignal:function(){return Ti(Sr).controller.signal}},uY=typeof WeakMap=="function"?WeakMap:Map,bs=0,Us=null,Gn=null,Zn=0,ks=0,pl=null,lf=!1,Kg=!1,hA=!1,Qh=0,Rr=0,cf=0,Vp=0,dA=0,ml=0,Zg=0,lb=null,Lo=null,fA=!1,Rx=0,EM=0,Lx=1/0,Fx=null,uf=null,Ai=0,hf=null,Jg=null,ed=0,pA=0,mA=null,IM=null,cb=0,gA=null;function gl(){return(bs&2)!==0&&Zn!==0?Zn&-Zn:X.T!==null?SA():ii()}function OM(){if(ml===0)if((Zn&536870912)===0||Hn){var h=Ss;Ss<<=1,(Ss&3932160)===0&&(Ss=262144),ml=h}else ml=536870912;return h=tr.current,h!==null&&(h.flags|=32),ml}function Fo(h,f,y){(h===Us&&(ks===2||ks===9)||h.cancelPendingCommit!==null)&&(Qg(h,0),df(h,Zn,ml,!1)),Kt(h,y),((bs&2)===0||h!==Us)&&(h===Us&&((bs&2)===0&&(Vp|=y),Rr===4&&df(h,Zn,ml,!1)),Hu(h))}function DM(h,f,y){if((bs&6)!==0)throw Error(s(327));var w=!y&&(f&127)===0&&(f&h.expiredLanes)===0||Qo(h,f),T=w?fY(h,f):bA(h,f,!0),E=w;do{if(T===0){Kg&&!w&&df(h,f,0,!1);break}else{if(y=h.current.alternate,E&&!hY(y)){T=bA(h,f,!1),E=!1;continue}if(T===2){if(E=f,h.errorRecoveryDisabledLanes&E)var W=0;else W=h.pendingLanes&-536870913,W=W!==0?W:W&536870912?536870912:0;if(W!==0){f=W;e:{var ae=h;T=lb;var we=ae.current.memoizedState.isDehydrated;if(we&&(Qg(ae,W).flags|=256),W=bA(ae,W,!1),W!==2){if(hA&&!we){ae.errorRecoveryDisabledLanes|=E,Vp|=E,T=4;break e}E=Lo,Lo=T,E!==null&&(Lo===null?Lo=E:Lo.push.apply(Lo,E))}T=W}if(E=!1,T!==2)continue}}if(T===1){Qg(h,0),df(h,f,0,!0);break}e:{switch(w=h,E=T,E){case 0:case 1:throw Error(s(345));case 4:if((f&4194048)!==f)break;case 6:df(w,f,ml,!lf);break e;case 2:Lo=null;break;case 3:case 5:break;default:throw Error(s(329))}if((f&62914560)===f&&(T=Rx+300-Yt(),10<T)){if(df(w,f,ml,!lf),Qn(w,0,!0)!==0)break e;ed=f,w.timeoutHandle=cP($M.bind(null,w,y,Lo,Fx,fA,f,ml,Vp,Zg,lf,E,"Throttled",-0,0),T);break e}$M(w,y,Lo,Fx,fA,f,ml,Vp,Zg,lf,E,null,-0,0)}}break}while(!0);Hu(h)}function $M(h,f,y,w,T,E,W,ae,we,je,Ze,tt,Ue,He){if(h.timeoutHandle=-1,tt=f.subtreeFlags,tt&8192||(tt&16785408)===16785408){tt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ol},kM(f,E,tt);var $t=(E&62914560)===E?Rx-Yt():(E&4194048)===E?EM-Yt():0;if($t=YY(tt,$t),$t!==null){ed=E,h.cancelPendingCommit=$t(jM.bind(null,h,f,E,y,w,T,W,ae,we,Ze,tt,null,Ue,He)),df(h,E,W,!je);return}}jM(h,f,E,y,w,T,W,ae,we)}function hY(h){for(var f=h;;){var y=f.tag;if((y===0||y===11||y===15)&&f.flags&16384&&(y=f.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var w=0;w<y.length;w++){var T=y[w],E=T.getSnapshot;T=T.value;try{if(!Si(E(),T))return!1}catch{return!1}}if(y=f.child,f.subtreeFlags&16384&&y!==null)y.return=f,f=y;else{if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function df(h,f,y,w){f&=~dA,f&=~Vp,h.suspendedLanes|=f,h.pingedLanes&=~f,w&&(h.warmLanes|=f),w=h.expirationTimes;for(var T=f;0<T;){var E=31-Un(T),W=1<<E;w[E]=-1,T&=~W}y!==0&&Bl(h,y,f)}function Mx(){return(bs&6)===0?(ub(0),!1):!0}function yA(){if(Gn!==null){if(ks===0)var h=Gn.return;else h=Gn,Ql=Fu=null,jg(h),st=null,Ft=0,h=Gn;for(;h!==null;)uM(h.alternate,h),h=h.return;Gn=null}}function Qg(h,f){var y=h.timeoutHandle;y!==-1&&(h.timeoutHandle=-1,OY(y)),y=h.cancelPendingCommit,y!==null&&(h.cancelPendingCommit=null,y()),ed=0,yA(),Us=h,Gn=y=_o(h.current,null),Zn=f,ks=0,pl=null,lf=!1,Kg=Qo(h,f),hA=!1,Zg=ml=dA=Vp=cf=Rr=0,Lo=lb=null,fA=!1,(f&8)!==0&&(f|=f&32);var w=h.entangledLanes;if(w!==0)for(h=h.entanglements,w&=f;0<w;){var T=31-Un(w),E=1<<T;f|=h[T],w&=~E}return Qh=f,Op(),y}function RM(h,f){Zt=null,X.H=eb,f===Te||f===fe?(f=Qe(),ks=3):f===ze?(f=Qe(),ks=4):ks=f===YN?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,pl=f,Gn===null&&(Rr=1,Tx(h,ko(f,h.current)))}function LM(){var h=tr.current;return h===null?!0:(Zn&4194048)===Zn?is===null:(Zn&62914560)===Zn||(Zn&536870912)!==0?h===is:!1}function FM(){var h=X.H;return X.H=eb,h===null?eb:h}function MM(){var h=X.A;return X.A=cY,h}function Px(){Rr=4,lf||(Zn&4194048)!==Zn&&tr.current!==null||(Kg=!0),(cf&134217727)===0&&(Vp&134217727)===0||Us===null||df(Us,Zn,ml,!1)}function bA(h,f,y){var w=bs;bs|=2;var T=FM(),E=MM();(Us!==h||Zn!==f)&&(Fx=null,Qg(h,f)),f=!1;var W=Rr;e:do try{if(ks!==0&&Gn!==null){var ae=Gn,we=pl;switch(ks){case 8:yA(),W=6;break e;case 3:case 2:case 9:case 6:tr.current===null&&(f=!0);var je=ks;if(ks=0,pl=null,e0(h,ae,we,je),y&&Kg){W=0;break e}break;default:je=ks,ks=0,pl=null,e0(h,ae,we,je)}}dY(),W=Rr;break}catch(Ze){RM(h,Ze)}while(!0);return f&&h.shellSuspendCounter++,Ql=Fu=null,bs=w,X.H=T,X.A=E,Gn===null&&(Us=null,Zn=0,Op()),W}function dY(){for(;Gn!==null;)PM(Gn)}function fY(h,f){var y=bs;bs|=2;var w=FM(),T=MM();Us!==h||Zn!==f?(Fx=null,Lx=Yt()+500,Qg(h,f)):Kg=Qo(h,f);e:do try{if(ks!==0&&Gn!==null){f=Gn;var E=pl;t:switch(ks){case 1:ks=0,pl=null,e0(h,f,E,1);break;case 2:case 9:if(Me(E)){ks=0,pl=null,zM(f);break}f=function(){ks!==2&&ks!==9||Us!==h||(ks=7),Hu(h)},E.then(f,f);break e;case 3:ks=7;break e;case 4:ks=5;break e;case 7:Me(E)?(ks=0,pl=null,zM(f)):(ks=0,pl=null,e0(h,f,E,7));break;case 5:var W=null;switch(Gn.tag){case 26:W=Gn.memoizedState;case 5:case 27:var ae=Gn;if(W?_P(W):ae.stateNode.complete){ks=0,pl=null;var we=ae.sibling;if(we!==null)Gn=we;else{var je=ae.return;je!==null?(Gn=je,zx(je)):Gn=null}break t}}ks=0,pl=null,e0(h,f,E,5);break;case 6:ks=0,pl=null,e0(h,f,E,6);break;case 8:yA(),Rr=6;break e;default:throw Error(s(462))}}pY();break}catch(Ze){RM(h,Ze)}while(!0);return Ql=Fu=null,X.H=w,X.A=T,bs=y,Gn!==null?0:(Us=null,Zn=0,Op(),Rr)}function pY(){for(;Gn!==null&&!Tt();)PM(Gn)}function PM(h){var f=lM(h.alternate,h,Qh);h.memoizedProps=h.pendingProps,f===null?zx(h):Gn=f}function zM(h){var f=h,y=f.alternate;switch(f.tag){case 15:case 0:f=nM(y,f,f.pendingProps,f.type,void 0,Zn);break;case 11:f=nM(y,f,f.pendingProps,f.type.render,f.ref,Zn);break;case 5:jg(f);default:uM(y,f),f=Gn=Rp(f,Qh),f=lM(y,f,Qh)}h.memoizedProps=h.pendingProps,f===null?zx(h):Gn=f}function e0(h,f,y,w){Ql=Fu=null,jg(f),st=null,Ft=0;var T=f.return;try{if(nY(h,T,f,y,Zn)){Rr=1,Tx(h,ko(y,h.current)),Gn=null;return}}catch(E){if(T!==null)throw Gn=T,E;Rr=1,Tx(h,ko(y,h.current)),Gn=null;return}f.flags&32768?(Hn||w===1?h=!0:Kg||(Zn&536870912)!==0?h=!1:(lf=h=!0,(w===2||w===9||w===3||w===6)&&(w=tr.current,w!==null&&w.tag===13&&(w.flags|=16384))),BM(f,h)):zx(f)}function zx(h){var f=h;do{if((f.flags&32768)!==0){BM(f,lf);return}h=f.return;var y=iY(f.alternate,f,Qh);if(y!==null){Gn=y;return}if(f=f.sibling,f!==null){Gn=f;return}Gn=f=h}while(f!==null);Rr===0&&(Rr=5)}function BM(h,f){do{var y=aY(h.alternate,h);if(y!==null){y.flags&=32767,Gn=y;return}if(y=h.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!f&&(h=h.sibling,h!==null)){Gn=h;return}Gn=h=y}while(h!==null);Rr=6,Gn=null}function jM(h,f,y,w,T,E,W,ae,we){h.cancelPendingCommit=null;do Bx();while(Ai!==0);if((bs&6)!==0)throw Error(s(327));if(f!==null){if(f===h.current)throw Error(s(177));if(E=f.lanes|f.childLanes,E|=Ng,wc(h,y,E,W,ae,we),h===Us&&(Gn=Us=null,Zn=0),Jg=f,hf=h,ed=y,pA=E,mA=T,IM=w,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,bY(cn,function(){return GM(),null})):(h.callbackNode=null,h.callbackPriority=0),w=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||w){w=X.T,X.T=null,T=ne.p,ne.p=2,W=bs,bs|=4;try{oY(h,f,y)}finally{bs=W,ne.p=T,X.T=w}}Ai=1,UM(),VM(),WM()}}function UM(){if(Ai===1){Ai=0;var h=hf,f=Jg,y=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||y){y=X.T,X.T=null;var w=ne.p;ne.p=2;var T=bs;bs|=4;try{SM(f,h);var E=IA,W=Pc(h.containerInfo),ae=E.focusedElem,we=E.selectionRange;if(W!==ae&&ae&&ae.ownerDocument&&Mc(ae.ownerDocument.documentElement,ae)){if(we!==null&&Zl(ae)){var je=we.start,Ze=we.end;if(Ze===void 0&&(Ze=je),"selectionStart"in ae)ae.selectionStart=je,ae.selectionEnd=Math.min(Ze,ae.value.length);else{var tt=ae.ownerDocument||document,Ue=tt&&tt.defaultView||window;if(Ue.getSelection){var He=Ue.getSelection(),$t=ae.textContent.length,ln=Math.min(we.start,$t),Fs=we.end===void 0?ln:Math.min(we.end,$t);!He.extend&&ln>Fs&&(W=Fs,Fs=ln,ln=W);var $e=Yd(ae,ln),Ee=Yd(ae,Fs);if($e&&Ee&&(He.rangeCount!==1||He.anchorNode!==$e.node||He.anchorOffset!==$e.offset||He.focusNode!==Ee.node||He.focusOffset!==Ee.offset)){var Be=tt.createRange();Be.setStart($e.node,$e.offset),He.removeAllRanges(),ln>Fs?(He.addRange(Be),He.extend(Ee.node,Ee.offset)):(Be.setEnd(Ee.node,Ee.offset),He.addRange(Be))}}}}for(tt=[],He=ae;He=He.parentNode;)He.nodeType===1&&tt.push({element:He,left:He.scrollLeft,top:He.scrollTop});for(typeof ae.focus=="function"&&ae.focus(),ae=0;ae<tt.length;ae++){var et=tt[ae];et.element.scrollLeft=et.left,et.element.scrollTop=et.top}}Jx=!!EA,IA=EA=null}finally{bs=T,ne.p=w,X.T=y}}h.current=f,Ai=2}}function VM(){if(Ai===2){Ai=0;var h=hf,f=Jg,y=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||y){y=X.T,X.T=null;var w=ne.p;ne.p=2;var T=bs;bs|=4;try{yM(h,f.alternate,f)}finally{bs=T,ne.p=w,X.T=y}}Ai=3}}function WM(){if(Ai===4||Ai===3){Ai=0,Lt();var h=hf,f=Jg,y=ed,w=IM;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Ai=5:(Ai=0,Jg=hf=null,HM(h,h.pendingLanes));var T=h.pendingLanes;if(T===0&&(uf=null),Tr(y),f=f.stateNode,Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(Cn,f,void 0,(f.current.flags&128)===128)}catch{}if(w!==null){f=X.T,T=ne.p,ne.p=2,X.T=null;try{for(var E=h.onRecoverableError,W=0;W<w.length;W++){var ae=w[W];E(ae.value,{componentStack:ae.stack})}}finally{X.T=f,ne.p=T}}(ed&3)!==0&&Bx(),Hu(h),T=h.pendingLanes,(y&261930)!==0&&(T&42)!==0?h===gA?cb++:(cb=0,gA=h):cb=0,ub(0)}}function HM(h,f){(h.pooledCacheLanes&=f)===0&&(f=h.pooledCache,f!=null&&(h.pooledCache=null,Mp(f)))}function Bx(){return UM(),VM(),WM(),GM()}function GM(){if(Ai!==5)return!1;var h=hf,f=pA;pA=0;var y=Tr(ed),w=X.T,T=ne.p;try{ne.p=32>y?32:y,X.T=null,y=mA,mA=null;var E=hf,W=ed;if(Ai=0,Jg=hf=null,ed=0,(bs&6)!==0)throw Error(s(331));var ae=bs;if(bs|=4,NM(E.current),_M(E,E.current,W,y),bs=ae,ub(0,!1),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(Cn,E)}catch{}return!0}finally{ne.p=T,X.T=w,HM(h,f)}}function qM(h,f,y){f=ko(y,f),f=XN(h.stateNode,f,2),h=En(h,f,2),h!==null&&(Kt(h,2),Hu(h))}function Ts(h,f,y){if(h.tag===3)qM(h,h,y);else for(;f!==null;){if(f.tag===3){qM(f,h,y);break}else if(f.tag===1){var w=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(uf===null||!uf.has(w))){h=ko(y,h),y=XF(2),w=En(f,y,2),w!==null&&(YF(y,w,f,h),Kt(w,2),Hu(w));break}}f=f.return}}function vA(h,f,y){var w=h.pingCache;if(w===null){w=h.pingCache=new uY;var T=new Set;w.set(f,T)}else T=w.get(f),T===void 0&&(T=new Set,w.set(f,T));T.has(y)||(hA=!0,T.add(y),h=mY.bind(null,h,f,y),f.then(h,h))}function mY(h,f,y){var w=h.pingCache;w!==null&&w.delete(f),h.pingedLanes|=h.suspendedLanes&y,h.warmLanes&=~y,Us===h&&(Zn&y)===y&&(Rr===4||Rr===3&&(Zn&62914560)===Zn&&300>Yt()-Rx?(bs&2)===0&&Qg(h,0):dA|=y,Zg===Zn&&(Zg=0)),Hu(h)}function XM(h,f){f===0&&(f=zl()),h=Bc(h,f),h!==null&&(Kt(h,f),Hu(h))}function gY(h){var f=h.memoizedState,y=0;f!==null&&(y=f.retryLane),XM(h,y)}function yY(h,f){var y=0;switch(h.tag){case 31:case 13:var w=h.stateNode,T=h.memoizedState;T!==null&&(y=T.retryLane);break;case 19:w=h.stateNode;break;case 22:w=h.stateNode._retryCache;break;default:throw Error(s(314))}w!==null&&w.delete(f),XM(h,y)}function bY(h,f){return xt(h,f)}var jx=null,t0=null,wA=!1,Ux=!1,xA=!1,ff=0;function Hu(h){h!==t0&&h.next===null&&(t0===null?jx=t0=h:t0=t0.next=h),Ux=!0,wA||(wA=!0,wY())}function ub(h,f){if(!xA&&Ux){xA=!0;do for(var y=!1,w=jx;w!==null;){if(h!==0){var T=w.pendingLanes;if(T===0)var E=0;else{var W=w.suspendedLanes,ae=w.pingedLanes;E=(1<<31-Un(42|h)+1)-1,E&=T&~(W&~ae),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(y=!0,JM(w,E))}else E=Zn,E=Qn(w,w===Us?E:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(E&3)===0||Qo(w,E)||(y=!0,JM(w,E));w=w.next}while(y);xA=!1}}function vY(){YM()}function YM(){Ux=wA=!1;var h=0;ff!==0&&IY()&&(h=ff);for(var f=Yt(),y=null,w=jx;w!==null;){var T=w.next,E=KM(w,f);E===0?(w.next=null,y===null?jx=T:y.next=T,T===null&&(t0=y)):(y=w,(h!==0||(E&3)!==0)&&(Ux=!0)),w=T}Ai!==0&&Ai!==5||ub(h),ff!==0&&(ff=0)}function KM(h,f){for(var y=h.suspendedLanes,w=h.pingedLanes,T=h.expirationTimes,E=h.pendingLanes&-62914561;0<E;){var W=31-Un(E),ae=1<<W,we=T[W];we===-1?((ae&y)===0||(ae&w)!==0)&&(T[W]=Mi(ae,f)):we<=f&&(h.expiredLanes|=ae),E&=~ae}if(f=Us,y=Zn,y=Qn(h,h===f?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),w=h.callbackNode,y===0||h===f&&(ks===2||ks===9)||h.cancelPendingCommit!==null)return w!==null&&w!==null&&vt(w),h.callbackNode=null,h.callbackPriority=0;if((y&3)===0||Qo(h,y)){if(f=y&-y,f===h.callbackPriority)return f;switch(w!==null&&vt(w),Tr(y)){case 2:case 8:y=bn;break;case 32:y=cn;break;case 268435456:y=fn;break;default:y=cn}return w=ZM.bind(null,h),y=xt(y,w),h.callbackPriority=f,h.callbackNode=y,f}return w!==null&&w!==null&&vt(w),h.callbackPriority=2,h.callbackNode=null,2}function ZM(h,f){if(Ai!==0&&Ai!==5)return h.callbackNode=null,h.callbackPriority=0,null;var y=h.callbackNode;if(Bx()&&h.callbackNode!==y)return null;var w=Zn;return w=Qn(h,h===Us?w:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),w===0?null:(DM(h,w,f),KM(h,Yt()),h.callbackNode!=null&&h.callbackNode===y?ZM.bind(null,h):null)}function JM(h,f){if(Bx())return null;DM(h,f,!0)}function wY(){DY(function(){(bs&6)!==0?xt(Jt,vY):YM()})}function SA(){if(ff===0){var h=_;h===0&&(h=gn,gn<<=1,(gn&261888)===0&&(gn=256)),ff=h}return ff}function QM(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:ya(""+h)}function eP(h,f){var y=f.ownerDocument.createElement("input");return y.name=f.name,y.value=f.value,h.id&&y.setAttribute("form",h.id),f.parentNode.insertBefore(y,f),h=new FormData(h),y.parentNode.removeChild(y),h}function xY(h,f,y,w,T){if(f==="submit"&&y&&y.stateNode===T){var E=QM((T[Zs]||null).action),W=w.submitter;W&&(f=(f=W[Zs]||null)?QM(f.formAction):W.getAttribute("formAction"),f!==null&&(E=f,W=null));var ae=new xo("action","action",null,w,T);h.push({event:ae,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(ff!==0){var we=W?eP(T,W):new FormData(T);UN(y,{pending:!0,data:we,method:T.method,action:E},null,we)}}else typeof E=="function"&&(ae.preventDefault(),we=W?eP(T,W):new FormData(T),UN(y,{pending:!0,data:we,method:T.method,action:E},E,we))},currentTarget:T}]})}}for(var CA=0;CA<zh.length;CA++){var _A=zh[CA],SY=_A.toLowerCase(),CY=_A[0].toUpperCase()+_A.slice(1);Co(SY,"on"+CY)}Co(Ph,"onAnimationEnd"),Co(Ep,"onAnimationIteration"),Co(zy,"onAnimationStart"),Co("dblclick","onDoubleClick"),Co("focusin","onFocus"),Co("focusout","onBlur"),Co(fx,"onTransitionRun"),Co(px,"onTransitionStart"),Co(mx,"onTransitionCancel"),Co(By,"onTransitionEnd"),xc("onMouseEnter",["mouseout","mouseover"]),xc("onMouseLeave",["mouseout","mouseover"]),xc("onPointerEnter",["pointerout","pointerover"]),xc("onPointerLeave",["pointerout","pointerover"]),rl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rl("onBeforeInput",["compositionend","keypress","textInput","paste"]),rl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_Y=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hb));function tP(h,f){f=(f&4)!==0;for(var y=0;y<h.length;y++){var w=h[y],T=w.event;w=w.listeners;e:{var E=void 0;if(f)for(var W=w.length-1;0<=W;W--){var ae=w[W],we=ae.instance,je=ae.currentTarget;if(ae=ae.listener,we!==E&&T.isPropagationStopped())break e;E=ae,T.currentTarget=je;try{E(T)}catch(Ze){Ip(Ze)}T.currentTarget=null,E=we}else for(W=0;W<w.length;W++){if(ae=w[W],we=ae.instance,je=ae.currentTarget,ae=ae.listener,we!==E&&T.isPropagationStopped())break e;E=ae,T.currentTarget=je;try{E(T)}catch(Ze){Ip(Ze)}T.currentTarget=null,E=we}}}}function qn(h,f){var y=f[ja];y===void 0&&(y=f[ja]=new Set);var w=h+"__bubble";y.has(w)||(nP(f,h,2,!1),y.add(w))}function kA(h,f,y){var w=0;f&&(w|=4),nP(y,h,w,f)}var Vx="_reactListening"+Math.random().toString(36).slice(2);function TA(h){if(!h[Vx]){h[Vx]=!0,dp.forEach(function(y){y!=="selectionchange"&&(_Y.has(y)||kA(y,!1,h),kA(y,!0,h))});var f=h.nodeType===9?h:h.ownerDocument;f===null||f[Vx]||(f[Vx]=!0,kA("selectionchange",!1,f))}}function nP(h,f,y,w){switch(OP(f)){case 2:var T=JY;break;case 8:T=QY;break;default:T=jA}y=T.bind(null,f,y,h),T=void 0,!_p||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(T=!0),w?T!==void 0?h.addEventListener(f,y,{capture:!0,passive:T}):h.addEventListener(f,y,!0):T!==void 0?h.addEventListener(f,y,{passive:T}):h.addEventListener(f,y,!1)}function NA(h,f,y,w,T){var E=w;if((f&1)===0&&(f&2)===0&&w!==null)e:for(;;){if(w===null)return;var W=w.tag;if(W===3||W===4){var ae=w.stateNode.containerInfo;if(ae===T)break;if(W===4)for(W=w.return;W!==null;){var we=W.tag;if((we===3||we===4)&&W.stateNode.containerInfo===T)return;W=W.return}for(;ae!==null;){if(W=nl(ae),W===null)return;if(we=W.tag,we===5||we===6||we===26||we===27){w=E=W;continue e}ae=ae.parentNode}}w=w.return}Sg(function(){var je=E,Ze=Oh(y),tt=[];e:{var Ue=jy.get(h);if(Ue!==void 0){var He=xo,$t=h;switch(h){case"keypress":if(wo(y)===0)break e;case"keydown":case"keyup":He=es;break;case"focusin":$t="focus",He=Ec;break;case"focusout":$t="blur",He=Ec;break;case"beforeblur":case"afterblur":He=Ec;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":He=kp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":He=Ac;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":He=Wr;break;case Ph:case Ep:case zy:He=D;break;case By:He=xi;break;case"scroll":case"scrollend":He=Ud;break;case"wheel":He=ll;break;case"copy":case"cut":case"paste":He=me;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":He=vr;break;case"toggle":case"beforetoggle":He=Tp}var ln=(f&4)!==0,Fs=!ln&&(h==="scroll"||h==="scrollend"),$e=ln?Ue!==null?Ue+"Capture":null:Ue;ln=[];for(var Ee=je,Be;Ee!==null;){var et=Ee;if(Be=et.stateNode,et=et.tag,et!==5&&et!==26&&et!==27||Be===null||$e===null||(et=Wa(Ee,$e),et!=null&&ln.push(db(Ee,et,Be))),Fs)break;Ee=Ee.return}0<ln.length&&(Ue=new He(Ue,$t,null,y,Ze),tt.push({event:Ue,listeners:ln}))}}if((f&7)===0){e:{if(Ue=h==="mouseover"||h==="pointerover",He=h==="mouseout"||h==="pointerout",Ue&&y!==Cc&&($t=y.relatedTarget||y.fromElement)&&(nl($t)||$t[Pi]))break e;if((He||Ue)&&(Ue=Ze.window===Ze?Ze:(Ue=Ze.ownerDocument)?Ue.defaultView||Ue.parentWindow:window,He?($t=y.relatedTarget||y.toElement,He=je,$t=$t?nl($t):null,$t!==null&&(Fs=a($t),ln=$t.tag,$t!==Fs||ln!==5&&ln!==27&&ln!==6)&&($t=null)):(He=null,$t=je),He!==$t)){if(ln=kp,et="onMouseLeave",$e="onMouseEnter",Ee="mouse",(h==="pointerout"||h==="pointerover")&&(ln=vr,et="onPointerLeave",$e="onPointerEnter",Ee="pointer"),Fs=He==null?Ue:Eh(He),Be=$t==null?Ue:Eh($t),Ue=new ln(et,Ee+"leave",He,y,Ze),Ue.target=Fs,Ue.relatedTarget=Be,et=null,nl(Ze)===je&&(ln=new ln($e,Ee+"enter",$t,y,Ze),ln.target=Be,ln.relatedTarget=Fs,et=ln),Fs=et,He&&$t)t:{for(ln=kY,$e=He,Ee=$t,Be=0,et=$e;et;et=ln(et))Be++;et=0;for(var nn=Ee;nn;nn=ln(nn))et++;for(;0<Be-et;)$e=ln($e),Be--;for(;0<et-Be;)Ee=ln(Ee),et--;for(;Be--;){if($e===Ee||Ee!==null&&$e===Ee.alternate){ln=$e;break t}$e=ln($e),Ee=ln(Ee)}ln=null}else ln=null;He!==null&&sP(tt,Ue,He,ln,!1),$t!==null&&Fs!==null&&sP(tt,Fs,$t,ln,!0)}}e:{if(Ue=je?Eh(je):window,He=Ue.nodeName&&Ue.nodeName.toLowerCase(),He==="select"||He==="input"&&Ue.type==="file")var fs=Du;else if(Np(Ue))if(ba)fs=Yl;else{fs=wr;var Ut=qd}else He=Ue.nodeName,!He||He.toLowerCase()!=="input"||Ue.type!=="checkbox"&&Ue.type!=="radio"?je&&xp(je.elementType)&&(fs=Du):fs=Tg;if(fs&&(fs=fs(h,je))){Ga(tt,fs,y,Ze);break e}Ut&&Ut(h,Ue,je),h==="focusout"&&je&&Ue.type==="number"&&je.memoizedProps.value!=null&&bp(Ue,"number",Ue.value)}switch(Ut=je?Eh(je):window,h){case"focusin":(Np(Ut)||Ut.contentEditable==="true")&&(qa=Ut,zc=je,zi=null);break;case"focusout":zi=zc=qa=null;break;case"mousedown":So=!0;break;case"contextmenu":case"mouseup":case"dragend":So=!1,us(tt,y,Ze);break;case"selectionchange":if(Mh)break;case"keydown":case"keyup":us(tt,y,Ze)}var Rn;if(Hl)e:{switch(h){case"compositionstart":var Jn="onCompositionStart";break e;case"compositionend":Jn="onCompositionEnd";break e;case"compositionupdate":Jn="onCompositionUpdate";break e}Jn=void 0}else Gl?Ou(h,y)&&(Jn="onCompositionEnd"):h==="keydown"&&y.keyCode===229&&(Jn="onCompositionStart");Jn&&(Dc&&y.locale!=="ko"&&(Gl||Jn!=="onCompositionStart"?Jn==="onCompositionEnd"&&Gl&&(Rn=Cg()):(Ha=Ze,$h="value"in Ha?Ha.value:Ha.textContent,Gl=!0)),Ut=Wx(je,Jn),0<Ut.length&&(Jn=new De(Jn,h,null,y,Ze),tt.push({event:Jn,listeners:Ut}),Rn?Jn.data=Rn:(Rn=Wd(y),Rn!==null&&(Jn.data=Rn)))),(Rn=Fh?la(h,y):$c(h,y))&&(Jn=Wx(je,"onBeforeInput"),0<Jn.length&&(Ut=new De("onBeforeInput","beforeinput",null,y,Ze),tt.push({event:Ut,listeners:Jn}),Ut.data=Rn)),xY(tt,h,je,y,Ze)}tP(tt,f)})}function db(h,f,y){return{instance:h,listener:f,currentTarget:y}}function Wx(h,f){for(var y=f+"Capture",w=[];h!==null;){var T=h,E=T.stateNode;if(T=T.tag,T!==5&&T!==26&&T!==27||E===null||(T=Wa(h,y),T!=null&&w.unshift(db(h,T,E)),T=Wa(h,f),T!=null&&w.push(db(h,T,E))),h.tag===3)return w;h=h.return}return[]}function kY(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function sP(h,f,y,w,T){for(var E=f._reactName,W=[];y!==null&&y!==w;){var ae=y,we=ae.alternate,je=ae.stateNode;if(ae=ae.tag,we!==null&&we===w)break;ae!==5&&ae!==26&&ae!==27||je===null||(we=je,T?(je=Wa(y,E),je!=null&&W.unshift(db(y,je,we))):T||(je=Wa(y,E),je!=null&&W.push(db(y,je,we)))),y=y.return}W.length!==0&&h.push({event:f,listeners:W})}var TY=/\r\n?/g,NY=/\u0000|\uFFFD/g;function rP(h){return(typeof h=="string"?h:""+h).replace(TY,`
`).replace(NY,"")}function iP(h,f){return f=rP(f),rP(h)===f}function Ls(h,f,y,w,T,E){switch(y){case"children":typeof w=="string"?f==="body"||f==="textarea"&&w===""||al(h,w):(typeof w=="number"||typeof w=="bigint")&&f!=="body"&&al(h,""+w);break;case"className":Sc(h,"class",w);break;case"tabIndex":Sc(h,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":Sc(h,y,w);break;case"style":vg(h,w,E);break;case"data":if(f!=="object"){Sc(h,"data",w);break}case"src":case"href":if(w===""&&(f!=="a"||y!=="href")){h.removeAttribute(y);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){h.removeAttribute(y);break}w=ya(""+w),h.setAttribute(y,w);break;case"action":case"formAction":if(typeof w=="function"){h.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(y==="formAction"?(f!=="input"&&Ls(h,f,"name",T.name,T,null),Ls(h,f,"formEncType",T.formEncType,T,null),Ls(h,f,"formMethod",T.formMethod,T,null),Ls(h,f,"formTarget",T.formTarget,T,null)):(Ls(h,f,"encType",T.encType,T,null),Ls(h,f,"method",T.method,T,null),Ls(h,f,"target",T.target,T,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){h.removeAttribute(y);break}w=ya(""+w),h.setAttribute(y,w);break;case"onClick":w!=null&&(h.onclick=ol);break;case"onScroll":w!=null&&qn("scroll",h);break;case"onScrollEnd":w!=null&&qn("scrollend",h);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(s(61));if(y=w.__html,y!=null){if(T.children!=null)throw Error(s(60));h.innerHTML=y}}break;case"multiple":h.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":h.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){h.removeAttribute("xlink:href");break}y=ya(""+w),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?h.setAttribute(y,""+w):h.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?h.setAttribute(y,""):h.removeAttribute(y);break;case"capture":case"download":w===!0?h.setAttribute(y,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?h.setAttribute(y,w):h.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?h.setAttribute(y,w):h.removeAttribute(y);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?h.removeAttribute(y):h.setAttribute(y,w);break;case"popover":qn("beforetoggle",h),qn("toggle",h),Va(h,"popover",w);break;case"xlinkActuate":il(h,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":il(h,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":il(h,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":il(h,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":il(h,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":il(h,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":il(h,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":il(h,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":il(h,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":Va(h,"is",w);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=Sp.get(y)||y,Va(h,y,w))}}function AA(h,f,y,w,T,E){switch(y){case"style":vg(h,w,E);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(s(61));if(y=w.__html,y!=null){if(T.children!=null)throw Error(s(60));h.innerHTML=y}}break;case"children":typeof w=="string"?al(h,w):(typeof w=="number"||typeof w=="bigint")&&al(h,""+w);break;case"onScroll":w!=null&&qn("scroll",h);break;case"onScrollEnd":w!=null&&qn("scrollend",h);break;case"onClick":w!=null&&(h.onclick=ol);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ua.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(T=y.endsWith("Capture"),f=y.slice(2,T?y.length-7:void 0),E=h[Zs]||null,E=E!=null?E[y]:null,typeof E=="function"&&h.removeEventListener(f,E,T),typeof w=="function")){typeof E!="function"&&E!==null&&(y in h?h[y]=null:h.hasAttribute(y)&&h.removeAttribute(y)),h.addEventListener(f,w,T);break e}y in h?h[y]=w:w===!0?h.setAttribute(y,""):Va(h,y,w)}}}function fa(h,f,y){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":qn("error",h),qn("load",h);var w=!1,T=!1,E;for(E in y)if(y.hasOwnProperty(E)){var W=y[E];if(W!=null)switch(E){case"src":w=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,f));default:Ls(h,f,E,W,y,null)}}T&&Ls(h,f,"srcSet",y.srcSet,y,null),w&&Ls(h,f,"src",y.src,y,null);return;case"input":qn("invalid",h);var ae=E=W=T=null,we=null,je=null;for(w in y)if(y.hasOwnProperty(w)){var Ze=y[w];if(Ze!=null)switch(w){case"name":T=Ze;break;case"type":W=Ze;break;case"checked":we=Ze;break;case"defaultChecked":je=Ze;break;case"value":E=Ze;break;case"defaultValue":ae=Ze;break;case"children":case"dangerouslySetInnerHTML":if(Ze!=null)throw Error(s(137,f));break;default:Ls(h,f,w,Ze,y,null)}}yg(h,E,ae,we,je,W,T,!1);return;case"select":qn("invalid",h),w=W=E=null;for(T in y)if(y.hasOwnProperty(T)&&(ae=y[T],ae!=null))switch(T){case"value":E=ae;break;case"defaultValue":W=ae;break;case"multiple":w=ae;default:Ls(h,f,T,ae,y,null)}f=E,y=W,h.multiple=!!w,f!=null?oa(h,!!w,f,!1):y!=null&&oa(h,!!w,y,!0);return;case"textarea":qn("invalid",h),E=T=w=null;for(W in y)if(y.hasOwnProperty(W)&&(ae=y[W],ae!=null))switch(W){case"value":w=ae;break;case"defaultValue":T=ae;break;case"children":E=ae;break;case"dangerouslySetInnerHTML":if(ae!=null)throw Error(s(91));break;default:Ls(h,f,W,ae,y,null)}wp(h,w,T,E);return;case"option":for(we in y)y.hasOwnProperty(we)&&(w=y[we],w!=null)&&(we==="selected"?h.selected=w&&typeof w!="function"&&typeof w!="symbol":Ls(h,f,we,w,y,null));return;case"dialog":qn("beforetoggle",h),qn("toggle",h),qn("cancel",h),qn("close",h);break;case"iframe":case"object":qn("load",h);break;case"video":case"audio":for(w=0;w<hb.length;w++)qn(hb[w],h);break;case"image":qn("error",h),qn("load",h);break;case"details":qn("toggle",h);break;case"embed":case"source":case"link":qn("error",h),qn("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(je in y)if(y.hasOwnProperty(je)&&(w=y[je],w!=null))switch(je){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,f));default:Ls(h,f,je,w,y,null)}return;default:if(xp(f)){for(Ze in y)y.hasOwnProperty(Ze)&&(w=y[Ze],w!==void 0&&AA(h,f,Ze,w,y,void 0));return}}for(ae in y)y.hasOwnProperty(ae)&&(w=y[ae],w!=null&&Ls(h,f,ae,w,y,null))}function AY(h,f,y,w){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,E=null,W=null,ae=null,we=null,je=null,Ze=null;for(He in y){var tt=y[He];if(y.hasOwnProperty(He)&&tt!=null)switch(He){case"checked":break;case"value":break;case"defaultValue":we=tt;default:w.hasOwnProperty(He)||Ls(h,f,He,null,w,tt)}}for(var Ue in w){var He=w[Ue];if(tt=y[Ue],w.hasOwnProperty(Ue)&&(He!=null||tt!=null))switch(Ue){case"type":E=He;break;case"name":T=He;break;case"checked":je=He;break;case"defaultChecked":Ze=He;break;case"value":W=He;break;case"defaultValue":ae=He;break;case"children":case"dangerouslySetInnerHTML":if(He!=null)throw Error(s(137,f));break;default:He!==tt&&Ls(h,f,Ue,He,w,tt)}}zd(h,W,ae,we,je,Ze,E,T);return;case"select":He=W=ae=Ue=null;for(E in y)if(we=y[E],y.hasOwnProperty(E)&&we!=null)switch(E){case"value":break;case"multiple":He=we;default:w.hasOwnProperty(E)||Ls(h,f,E,null,w,we)}for(T in w)if(E=w[T],we=y[T],w.hasOwnProperty(T)&&(E!=null||we!=null))switch(T){case"value":Ue=E;break;case"defaultValue":ae=E;break;case"multiple":W=E;default:E!==we&&Ls(h,f,T,E,w,we)}f=ae,y=W,w=He,Ue!=null?oa(h,!!y,Ue,!1):!!w!=!!y&&(f!=null?oa(h,!!y,f,!0):oa(h,!!y,y?[]:"",!1));return;case"textarea":He=Ue=null;for(ae in y)if(T=y[ae],y.hasOwnProperty(ae)&&T!=null&&!w.hasOwnProperty(ae))switch(ae){case"value":break;case"children":break;default:Ls(h,f,ae,null,w,T)}for(W in w)if(T=w[W],E=y[W],w.hasOwnProperty(W)&&(T!=null||E!=null))switch(W){case"value":Ue=T;break;case"defaultValue":He=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(s(91));break;default:T!==E&&Ls(h,f,W,T,w,E)}vp(h,Ue,He);return;case"option":for(var $t in y)Ue=y[$t],y.hasOwnProperty($t)&&Ue!=null&&!w.hasOwnProperty($t)&&($t==="selected"?h.selected=!1:Ls(h,f,$t,null,w,Ue));for(we in w)Ue=w[we],He=y[we],w.hasOwnProperty(we)&&Ue!==He&&(Ue!=null||He!=null)&&(we==="selected"?h.selected=Ue&&typeof Ue!="function"&&typeof Ue!="symbol":Ls(h,f,we,Ue,w,He));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ln in y)Ue=y[ln],y.hasOwnProperty(ln)&&Ue!=null&&!w.hasOwnProperty(ln)&&Ls(h,f,ln,null,w,Ue);for(je in w)if(Ue=w[je],He=y[je],w.hasOwnProperty(je)&&Ue!==He&&(Ue!=null||He!=null))switch(je){case"children":case"dangerouslySetInnerHTML":if(Ue!=null)throw Error(s(137,f));break;default:Ls(h,f,je,Ue,w,He)}return;default:if(xp(f)){for(var Fs in y)Ue=y[Fs],y.hasOwnProperty(Fs)&&Ue!==void 0&&!w.hasOwnProperty(Fs)&&AA(h,f,Fs,void 0,w,Ue);for(Ze in w)Ue=w[Ze],He=y[Ze],!w.hasOwnProperty(Ze)||Ue===He||Ue===void 0&&He===void 0||AA(h,f,Ze,Ue,w,He);return}}for(var $e in y)Ue=y[$e],y.hasOwnProperty($e)&&Ue!=null&&!w.hasOwnProperty($e)&&Ls(h,f,$e,null,w,Ue);for(tt in w)Ue=w[tt],He=y[tt],!w.hasOwnProperty(tt)||Ue===He||Ue==null&&He==null||Ls(h,f,tt,Ue,w,He)}function aP(h){switch(h){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function EY(){if(typeof performance.getEntriesByType=="function"){for(var h=0,f=0,y=performance.getEntriesByType("resource"),w=0;w<y.length;w++){var T=y[w],E=T.transferSize,W=T.initiatorType,ae=T.duration;if(E&&ae&&aP(W)){for(W=0,ae=T.responseEnd,w+=1;w<y.length;w++){var we=y[w],je=we.startTime;if(je>ae)break;var Ze=we.transferSize,tt=we.initiatorType;Ze&&aP(tt)&&(we=we.responseEnd,W+=Ze*(we<ae?1:(ae-je)/(we-je)))}if(--w,f+=8*(E+W)/(T.duration/1e3),h++,10<h)break}}if(0<h)return f/h/1e6}return navigator.connection&&(h=navigator.connection.downlink,typeof h=="number")?h:5}var EA=null,IA=null;function Hx(h){return h.nodeType===9?h:h.ownerDocument}function oP(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function lP(h,f){if(h===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&f==="foreignObject"?0:h}function OA(h,f){return h==="textarea"||h==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var DA=null;function IY(){var h=window.event;return h&&h.type==="popstate"?h===DA?!1:(DA=h,!0):(DA=null,!1)}var cP=typeof setTimeout=="function"?setTimeout:void 0,OY=typeof clearTimeout=="function"?clearTimeout:void 0,uP=typeof Promise=="function"?Promise:void 0,DY=typeof queueMicrotask=="function"?queueMicrotask:typeof uP<"u"?function(h){return uP.resolve(null).then(h).catch($Y)}:cP;function $Y(h){setTimeout(function(){throw h})}function pf(h){return h==="head"}function hP(h,f){var y=f,w=0;do{var T=y.nextSibling;if(h.removeChild(y),T&&T.nodeType===8)if(y=T.data,y==="/$"||y==="/&"){if(w===0){h.removeChild(T),i0(f);return}w--}else if(y==="$"||y==="$?"||y==="$~"||y==="$!"||y==="&")w++;else if(y==="html")fb(h.ownerDocument.documentElement);else if(y==="head"){y=h.ownerDocument.head,fb(y);for(var E=y.firstChild;E;){var W=E.nextSibling,ae=E.nodeName;E[tl]||ae==="SCRIPT"||ae==="STYLE"||ae==="LINK"&&E.rel.toLowerCase()==="stylesheet"||y.removeChild(E),E=W}}else y==="body"&&fb(h.ownerDocument.body);y=T}while(y);i0(f)}function dP(h,f){var y=h;h=0;do{var w=y.nextSibling;if(y.nodeType===1?f?(y._stashedDisplay=y.style.display,y.style.display="none"):(y.style.display=y._stashedDisplay||"",y.getAttribute("style")===""&&y.removeAttribute("style")):y.nodeType===3&&(f?(y._stashedText=y.nodeValue,y.nodeValue=""):y.nodeValue=y._stashedText||""),w&&w.nodeType===8)if(y=w.data,y==="/$"){if(h===0)break;h--}else y!=="$"&&y!=="$?"&&y!=="$~"&&y!=="$!"||h++;y=w}while(y)}function $A(h){var f=h.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var y=f;switch(f=f.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":$A(y),Nu(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}h.removeChild(y)}}function RY(h,f,y,w){for(;h.nodeType===1;){var T=y;if(h.nodeName.toLowerCase()!==f.toLowerCase()){if(!w&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(w){if(!h[tl])switch(f){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(E=h.getAttribute("rel"),E==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(E!==T.rel||h.getAttribute("href")!==(T.href==null||T.href===""?null:T.href)||h.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||h.getAttribute("title")!==(T.title==null?null:T.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(E=h.getAttribute("src"),(E!==(T.src==null?null:T.src)||h.getAttribute("type")!==(T.type==null?null:T.type)||h.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&E&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(f==="input"&&h.type==="hidden"){var E=T.name==null?null:""+T.name;if(T.type==="hidden"&&h.getAttribute("name")===E)return h}else return h;if(h=nc(h.nextSibling),h===null)break}return null}function LY(h,f,y){if(f==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!y||(h=nc(h.nextSibling),h===null))return null;return h}function fP(h,f){for(;h.nodeType!==8;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!f||(h=nc(h.nextSibling),h===null))return null;return h}function RA(h){return h.data==="$?"||h.data==="$~"}function LA(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState!=="loading"}function FY(h,f){var y=h.ownerDocument;if(h.data==="$~")h._reactRetry=f;else if(h.data!=="$?"||y.readyState!=="loading")f();else{var w=function(){f(),y.removeEventListener("DOMContentLoaded",w)};y.addEventListener("DOMContentLoaded",w),h._reactRetry=w}}function nc(h){for(;h!=null;h=h.nextSibling){var f=h.nodeType;if(f===1||f===3)break;if(f===8){if(f=h.data,f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"||f==="F!"||f==="F")break;if(f==="/$"||f==="/&")return null}}return h}var FA=null;function pP(h){h=h.nextSibling;for(var f=0;h;){if(h.nodeType===8){var y=h.data;if(y==="/$"||y==="/&"){if(f===0)return nc(h.nextSibling);f--}else y!=="$"&&y!=="$!"&&y!=="$?"&&y!=="$~"&&y!=="&"||f++}h=h.nextSibling}return null}function mP(h){h=h.previousSibling;for(var f=0;h;){if(h.nodeType===8){var y=h.data;if(y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"){if(f===0)return h;f--}else y!=="/$"&&y!=="/&"||f++}h=h.previousSibling}return null}function gP(h,f,y){switch(f=Hx(y),h){case"html":if(h=f.documentElement,!h)throw Error(s(452));return h;case"head":if(h=f.head,!h)throw Error(s(453));return h;case"body":if(h=f.body,!h)throw Error(s(454));return h;default:throw Error(s(451))}}function fb(h){for(var f=h.attributes;f.length;)h.removeAttributeNode(f[0]);Nu(h)}var sc=new Map,yP=new Set;function Gx(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var td=ne.d;ne.d={f:MY,r:PY,D:zY,C:BY,L:jY,m:UY,X:WY,S:VY,M:HY};function MY(){var h=td.f(),f=Mx();return h||f}function PY(h){var f=sl(h);f!==null&&f.tag===5&&f.type==="form"?RF(f):td.r(h)}var n0=typeof document>"u"?null:document;function bP(h,f,y){var w=n0;if(w&&typeof f=="string"&&f){var T=Nr(f);T='link[rel="'+h+'"][href="'+T+'"]',typeof y=="string"&&(T+='[crossorigin="'+y+'"]'),yP.has(T)||(yP.add(T),h={rel:h,crossOrigin:y,href:f},w.querySelector(T)===null&&(f=w.createElement("link"),fa(f,"link",h),br(f),w.head.appendChild(f)))}}function zY(h){td.D(h),bP("dns-prefetch",h,null)}function BY(h,f){td.C(h,f),bP("preconnect",h,f)}function jY(h,f,y){td.L(h,f,y);var w=n0;if(w&&h&&f){var T='link[rel="preload"][as="'+Nr(f)+'"]';f==="image"&&y&&y.imageSrcSet?(T+='[imagesrcset="'+Nr(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(T+='[imagesizes="'+Nr(y.imageSizes)+'"]')):T+='[href="'+Nr(h)+'"]';var E=T;switch(f){case"style":E=s0(h);break;case"script":E=r0(h)}sc.has(E)||(h=p({rel:"preload",href:f==="image"&&y&&y.imageSrcSet?void 0:h,as:f},y),sc.set(E,h),w.querySelector(T)!==null||f==="style"&&w.querySelector(pb(E))||f==="script"&&w.querySelector(mb(E))||(f=w.createElement("link"),fa(f,"link",h),br(f),w.head.appendChild(f)))}}function UY(h,f){td.m(h,f);var y=n0;if(y&&h){var w=f&&typeof f.as=="string"?f.as:"script",T='link[rel="modulepreload"][as="'+Nr(w)+'"][href="'+Nr(h)+'"]',E=T;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=r0(h)}if(!sc.has(E)&&(h=p({rel:"modulepreload",href:h},f),sc.set(E,h),y.querySelector(T)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(mb(E)))return}w=y.createElement("link"),fa(w,"link",h),br(w),y.head.appendChild(w)}}}function VY(h,f,y){td.S(h,f,y);var w=n0;if(w&&h){var T=jl(w).hoistableStyles,E=s0(h);f=f||"default";var W=T.get(E);if(!W){var ae={loading:0,preload:null};if(W=w.querySelector(pb(E)))ae.loading=5;else{h=p({rel:"stylesheet",href:h,"data-precedence":f},y),(y=sc.get(E))&&MA(h,y);var we=W=w.createElement("link");br(we),fa(we,"link",h),we._p=new Promise(function(je,Ze){we.onload=je,we.onerror=Ze}),we.addEventListener("load",function(){ae.loading|=1}),we.addEventListener("error",function(){ae.loading|=2}),ae.loading|=4,qx(W,f,w)}W={type:"stylesheet",instance:W,count:1,state:ae},T.set(E,W)}}}function WY(h,f){td.X(h,f);var y=n0;if(y&&h){var w=jl(y).hoistableScripts,T=r0(h),E=w.get(T);E||(E=y.querySelector(mb(T)),E||(h=p({src:h,async:!0},f),(f=sc.get(T))&&PA(h,f),E=y.createElement("script"),br(E),fa(E,"link",h),y.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},w.set(T,E))}}function HY(h,f){td.M(h,f);var y=n0;if(y&&h){var w=jl(y).hoistableScripts,T=r0(h),E=w.get(T);E||(E=y.querySelector(mb(T)),E||(h=p({src:h,async:!0,type:"module"},f),(f=sc.get(T))&&PA(h,f),E=y.createElement("script"),br(E),fa(E,"link",h),y.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},w.set(T,E))}}function vP(h,f,y,w){var T=(T=de.current)?Gx(T):null;if(!T)throw Error(s(446));switch(h){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(f=s0(y.href),y=jl(T).hoistableStyles,w=y.get(f),w||(w={type:"style",instance:null,count:0,state:null},y.set(f,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){h=s0(y.href);var E=jl(T).hoistableStyles,W=E.get(h);if(W||(T=T.ownerDocument||T,W={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(h,W),(E=T.querySelector(pb(h)))&&!E._p&&(W.instance=E,W.state.loading=5),sc.has(h)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},sc.set(h,y),E||GY(T,h,y,W.state))),f&&w===null)throw Error(s(528,""));return W}if(f&&w!==null)throw Error(s(529,""));return null;case"script":return f=y.async,y=y.src,typeof y=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=r0(y),y=jl(T).hoistableScripts,w=y.get(f),w||(w={type:"script",instance:null,count:0,state:null},y.set(f,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,h))}}function s0(h){return'href="'+Nr(h)+'"'}function pb(h){return'link[rel="stylesheet"]['+h+"]"}function wP(h){return p({},h,{"data-precedence":h.precedence,precedence:null})}function GY(h,f,y,w){h.querySelector('link[rel="preload"][as="style"]['+f+"]")?w.loading=1:(f=h.createElement("link"),w.preload=f,f.addEventListener("load",function(){return w.loading|=1}),f.addEventListener("error",function(){return w.loading|=2}),fa(f,"link",y),br(f),h.head.appendChild(f))}function r0(h){return'[src="'+Nr(h)+'"]'}function mb(h){return"script[async]"+h}function xP(h,f,y){if(f.count++,f.instance===null)switch(f.type){case"style":var w=h.querySelector('style[data-href~="'+Nr(y.href)+'"]');if(w)return f.instance=w,br(w),w;var T=p({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return w=(h.ownerDocument||h).createElement("style"),br(w),fa(w,"style",T),qx(w,y.precedence,h),f.instance=w;case"stylesheet":T=s0(y.href);var E=h.querySelector(pb(T));if(E)return f.state.loading|=4,f.instance=E,br(E),E;w=wP(y),(T=sc.get(T))&&MA(w,T),E=(h.ownerDocument||h).createElement("link"),br(E);var W=E;return W._p=new Promise(function(ae,we){W.onload=ae,W.onerror=we}),fa(E,"link",w),f.state.loading|=4,qx(E,y.precedence,h),f.instance=E;case"script":return E=r0(y.src),(T=h.querySelector(mb(E)))?(f.instance=T,br(T),T):(w=y,(T=sc.get(E))&&(w=p({},y),PA(w,T)),h=h.ownerDocument||h,T=h.createElement("script"),br(T),fa(T,"link",w),h.head.appendChild(T),f.instance=T);case"void":return null;default:throw Error(s(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(w=f.instance,f.state.loading|=4,qx(w,y.precedence,h));return f.instance}function qx(h,f,y){for(var w=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=w.length?w[w.length-1]:null,E=T,W=0;W<w.length;W++){var ae=w[W];if(ae.dataset.precedence===f)E=ae;else if(E!==T)break}E?E.parentNode.insertBefore(h,E.nextSibling):(f=y.nodeType===9?y.head:y,f.insertBefore(h,f.firstChild))}function MA(h,f){h.crossOrigin==null&&(h.crossOrigin=f.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=f.referrerPolicy),h.title==null&&(h.title=f.title)}function PA(h,f){h.crossOrigin==null&&(h.crossOrigin=f.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=f.referrerPolicy),h.integrity==null&&(h.integrity=f.integrity)}var Xx=null;function SP(h,f,y){if(Xx===null){var w=new Map,T=Xx=new Map;T.set(y,w)}else T=Xx,w=T.get(y),w||(w=new Map,T.set(y,w));if(w.has(h))return w;for(w.set(h,null),y=y.getElementsByTagName(h),T=0;T<y.length;T++){var E=y[T];if(!(E[tl]||E[Cs]||h==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var W=E.getAttribute(f)||"";W=h+W;var ae=w.get(W);ae?ae.push(E):w.set(W,[E])}}return w}function CP(h,f,y){h=h.ownerDocument||h,h.head.insertBefore(y,f==="title"?h.querySelector("head > title"):null)}function qY(h,f,y){if(y===1||f.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;return f.rel==="stylesheet"?(h=f.disabled,typeof f.precedence=="string"&&h==null):!0;case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function _P(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}function XY(h,f,y,w){if(y.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var T=s0(w.href),E=f.querySelector(pb(T));if(E){f=E._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(h.count++,h=Yx.bind(h),f.then(h,h)),y.state.loading|=4,y.instance=E,br(E);return}E=f.ownerDocument||f,w=wP(w),(T=sc.get(T))&&MA(w,T),E=E.createElement("link"),br(E);var W=E;W._p=new Promise(function(ae,we){W.onload=ae,W.onerror=we}),fa(E,"link",w),y.instance=E}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(y,f),(f=y.state.preload)&&(y.state.loading&3)===0&&(h.count++,y=Yx.bind(h),f.addEventListener("load",y),f.addEventListener("error",y))}}var zA=0;function YY(h,f){return h.stylesheets&&h.count===0&&Zx(h,h.stylesheets),0<h.count||0<h.imgCount?function(y){var w=setTimeout(function(){if(h.stylesheets&&Zx(h,h.stylesheets),h.unsuspend){var E=h.unsuspend;h.unsuspend=null,E()}},6e4+f);0<h.imgBytes&&zA===0&&(zA=62500*EY());var T=setTimeout(function(){if(h.waitingForImages=!1,h.count===0&&(h.stylesheets&&Zx(h,h.stylesheets),h.unsuspend)){var E=h.unsuspend;h.unsuspend=null,E()}},(h.imgBytes>zA?50:800)+f);return h.unsuspend=y,function(){h.unsuspend=null,clearTimeout(w),clearTimeout(T)}}:null}function Yx(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Zx(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var Kx=null;function Zx(h,f){h.stylesheets=null,h.unsuspend!==null&&(h.count++,Kx=new Map,f.forEach(KY,h),Kx=null,Yx.call(h))}function KY(h,f){if(!(f.state.loading&4)){var y=Kx.get(h);if(y)var w=y.get(null);else{y=new Map,Kx.set(h,y);for(var T=h.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<T.length;E++){var W=T[E];(W.nodeName==="LINK"||W.getAttribute("media")!=="not all")&&(y.set(W.dataset.precedence,W),w=W)}w&&y.set(null,w)}T=f.instance,W=T.getAttribute("data-precedence"),E=y.get(W)||w,E===w&&y.set(null,T),y.set(W,T),this.count++,w=Yx.bind(this),T.addEventListener("load",w),T.addEventListener("error",w),E?E.parentNode.insertBefore(T,E.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(T,h.firstChild)),f.state.loading|=4}}var gb={$$typeof:A,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function ZY(h,f,y,w,T,E,W,ae,we){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=bo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bo(0),this.hiddenUpdates=bo(null),this.identifierPrefix=w,this.onUncaughtError=T,this.onCaughtError=E,this.onRecoverableError=W,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=we,this.incompleteTransitions=new Map}function kP(h,f,y,w,T,E,W,ae,we,je,Ze,tt){return h=new ZY(h,f,y,W,we,je,Ze,tt,ae),f=1,E===!0&&(f|=24),E=ji(3,null,null,f),h.current=E,E.stateNode=h,f=tf(),f.refCount++,h.pooledCache=f,f.refCount++,E.memoizedState={element:w,isDehydrated:y,cache:f},mt(E),h}function TP(h){return h?(h=Ci,h):Ci}function NP(h,f,y,w,T,E){T=TP(T),w.context===null?w.context=T:w.pendingContext=T,w=an(f),w.payload={element:y},E=E===void 0?null:E,E!==null&&(w.callback=E),y=En(h,w,f),y!==null&&(Fo(y,h,f),gs(y,h,f))}function AP(h,f){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var y=h.retryLane;h.retryLane=y!==0&&y<f?y:f}}function BA(h,f){AP(h,f),(h=h.alternate)&&AP(h,f)}function EP(h){if(h.tag===13||h.tag===31){var f=Bc(h,67108864);f!==null&&Fo(f,h,67108864),BA(h,67108864)}}function IP(h){if(h.tag===13||h.tag===31){var f=gl();f=Xs(f);var y=Bc(h,f);y!==null&&Fo(y,h,f),BA(h,f)}}var Jx=!0;function JY(h,f,y,w){var T=X.T;X.T=null;var E=ne.p;try{ne.p=2,jA(h,f,y,w)}finally{ne.p=E,X.T=T}}function QY(h,f,y,w){var T=X.T;X.T=null;var E=ne.p;try{ne.p=8,jA(h,f,y,w)}finally{ne.p=E,X.T=T}}function jA(h,f,y,w){if(Jx){var T=UA(w);if(T===null)NA(h,f,w,Qx,y),DP(h,w);else if(tK(T,h,f,y,w))w.stopPropagation();else if(DP(h,w),f&4&&-1<eK.indexOf(h)){for(;T!==null;){var E=sl(T);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var W=Gt(E.pendingLanes);if(W!==0){var ae=E;for(ae.pendingLanes|=2,ae.entangledLanes|=2;W;){var we=1<<31-Un(W);ae.entanglements[1]|=we,W&=~we}Hu(E),(bs&6)===0&&(Lx=Yt()+500,ub(0))}}break;case 31:case 13:ae=Bc(E,2),ae!==null&&Fo(ae,E,2),Mx(),BA(E,2)}if(E=UA(w),E===null&&NA(h,f,w,Qx,y),E===T)break;T=E}T!==null&&w.stopPropagation()}else NA(h,f,w,null,y)}}function UA(h){return h=Oh(h),VA(h)}var Qx=null;function VA(h){if(Qx=null,h=nl(h),h!==null){var f=a(h);if(f===null)h=null;else{var y=f.tag;if(y===13){if(h=o(f),h!==null)return h;h=null}else if(y===31){if(h=l(f),h!==null)return h;h=null}else if(y===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;h=null}else f!==h&&(h=null)}}return Qx=h,null}function OP(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(mn()){case Jt:return 2;case bn:return 8;case cn:case Et:return 32;case fn:return 268435456;default:return 32}default:return 32}}var WA=!1,mf=null,gf=null,yf=null,yb=new Map,bb=new Map,bf=[],eK="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function DP(h,f){switch(h){case"focusin":case"focusout":mf=null;break;case"dragenter":case"dragleave":gf=null;break;case"mouseover":case"mouseout":yf=null;break;case"pointerover":case"pointerout":yb.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":bb.delete(f.pointerId)}}function vb(h,f,y,w,T,E){return h===null||h.nativeEvent!==E?(h={blockedOn:f,domEventName:y,eventSystemFlags:w,nativeEvent:E,targetContainers:[T]},f!==null&&(f=sl(f),f!==null&&EP(f)),h):(h.eventSystemFlags|=w,f=h.targetContainers,T!==null&&f.indexOf(T)===-1&&f.push(T),h)}function tK(h,f,y,w,T){switch(f){case"focusin":return mf=vb(mf,h,f,y,w,T),!0;case"dragenter":return gf=vb(gf,h,f,y,w,T),!0;case"mouseover":return yf=vb(yf,h,f,y,w,T),!0;case"pointerover":var E=T.pointerId;return yb.set(E,vb(yb.get(E)||null,h,f,y,w,T)),!0;case"gotpointercapture":return E=T.pointerId,bb.set(E,vb(bb.get(E)||null,h,f,y,w,T)),!0}return!1}function $P(h){var f=nl(h.target);if(f!==null){var y=a(f);if(y!==null){if(f=y.tag,f===13){if(f=o(y),f!==null){h.blockedOn=f,Tu(h.priority,function(){IP(y)});return}}else if(f===31){if(f=l(y),f!==null){h.blockedOn=f,Tu(h.priority,function(){IP(y)});return}}else if(f===3&&y.stateNode.current.memoizedState.isDehydrated){h.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}h.blockedOn=null}function eS(h){if(h.blockedOn!==null)return!1;for(var f=h.targetContainers;0<f.length;){var y=UA(h.nativeEvent);if(y===null){y=h.nativeEvent;var w=new y.constructor(y.type,y);Cc=w,y.target.dispatchEvent(w),Cc=null}else return f=sl(y),f!==null&&EP(f),h.blockedOn=y,!1;f.shift()}return!0}function RP(h,f,y){eS(h)&&y.delete(f)}function nK(){WA=!1,mf!==null&&eS(mf)&&(mf=null),gf!==null&&eS(gf)&&(gf=null),yf!==null&&eS(yf)&&(yf=null),yb.forEach(RP),bb.forEach(RP)}function tS(h,f){h.blockedOn===f&&(h.blockedOn=null,WA||(WA=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,nK)))}var nS=null;function LP(h){nS!==h&&(nS=h,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){nS===h&&(nS=null);for(var f=0;f<h.length;f+=3){var y=h[f],w=h[f+1],T=h[f+2];if(typeof w!="function"){if(VA(w||y)===null)continue;break}var E=sl(y);E!==null&&(h.splice(f,3),f-=3,UN(E,{pending:!0,data:T,method:y.method,action:w},w,T))}}))}function i0(h){function f(we){return tS(we,h)}mf!==null&&tS(mf,h),gf!==null&&tS(gf,h),yf!==null&&tS(yf,h),yb.forEach(f),bb.forEach(f);for(var y=0;y<bf.length;y++){var w=bf[y];w.blockedOn===h&&(w.blockedOn=null)}for(;0<bf.length&&(y=bf[0],y.blockedOn===null);)$P(y),y.blockedOn===null&&bf.shift();if(y=(h.ownerDocument||h).$$reactFormReplay,y!=null)for(w=0;w<y.length;w+=3){var T=y[w],E=y[w+1],W=T[Zs]||null;if(typeof E=="function")W||LP(y);else if(W){var ae=null;if(E&&E.hasAttribute("formAction")){if(T=E,W=E[Zs]||null)ae=W.formAction;else if(VA(T)!==null)continue}else ae=W.action;typeof ae=="function"?y[w+1]=ae:(y.splice(w,3),w-=3),LP(y)}}}function FP(){function h(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(W){return T=W})},focusReset:"manual",scroll:"manual"})}function f(){T!==null&&(T(),T=null),w||setTimeout(y,20)}function y(){if(!w&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var w=!1,T=null;return navigation.addEventListener("navigate",h),navigation.addEventListener("navigatesuccess",f),navigation.addEventListener("navigateerror",f),setTimeout(y,100),function(){w=!0,navigation.removeEventListener("navigate",h),navigation.removeEventListener("navigatesuccess",f),navigation.removeEventListener("navigateerror",f),T!==null&&(T(),T=null)}}}function HA(h){this._internalRoot=h}sS.prototype.render=HA.prototype.render=function(h){var f=this._internalRoot;if(f===null)throw Error(s(409));var y=f.current,w=gl();NP(y,w,h,f,null,null)},sS.prototype.unmount=HA.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var f=h.containerInfo;NP(h.current,2,null,h,null,null),Mx(),f[Pi]=null}};function sS(h){this._internalRoot=h}sS.prototype.unstable_scheduleHydration=function(h){if(h){var f=ii();h={blockedOn:null,target:h,priority:f};for(var y=0;y<bf.length&&f!==0&&f<bf[y].priority;y++);bf.splice(y,0,h),y===0&&$P(h)}};var MP=e.version;if(MP!=="19.2.3")throw Error(s(527,MP,"19.2.3"));ne.findDOMNode=function(h){var f=h._reactInternals;if(f===void 0)throw typeof h.render=="function"?Error(s(188)):(h=Object.keys(h).join(","),Error(s(268,h)));return h=u(f),h=h!==null?d(h):null,h=h===null?null:h.stateNode,h};var sK={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rS.isDisabled&&rS.supportsFiber)try{Cn=rS.inject(sK),Qt=rS}catch{}}return xb.createRoot=function(h,f){if(!r(h))throw Error(s(299));var y=!1,w="",T=WF,E=HF,W=GF;return f!=null&&(f.unstable_strictMode===!0&&(y=!0),f.identifierPrefix!==void 0&&(w=f.identifierPrefix),f.onUncaughtError!==void 0&&(T=f.onUncaughtError),f.onCaughtError!==void 0&&(E=f.onCaughtError),f.onRecoverableError!==void 0&&(W=f.onRecoverableError)),f=kP(h,1,!1,null,null,y,w,null,T,E,W,FP),h[Pi]=f.current,TA(h),new HA(f)},xb.hydrateRoot=function(h,f,y){if(!r(h))throw Error(s(299));var w=!1,T="",E=WF,W=HF,ae=GF,we=null;return y!=null&&(y.unstable_strictMode===!0&&(w=!0),y.identifierPrefix!==void 0&&(T=y.identifierPrefix),y.onUncaughtError!==void 0&&(E=y.onUncaughtError),y.onCaughtError!==void 0&&(W=y.onCaughtError),y.onRecoverableError!==void 0&&(ae=y.onRecoverableError),y.formState!==void 0&&(we=y.formState)),f=kP(h,1,!0,f,y??null,w,T,we,E,W,ae,FP),f.context=TP(null),y=f.current,w=gl(),w=Xs(w),T=an(w),T.callback=null,En(y,T,w),y=w,f.current.lanes=y,Kt(f,y),Hu(f),h[Pi]=f.current,TA(h),new sS(f)},xb.version="19.2.3",xb}var qP;function mK(){if(qP)return XA.exports;qP=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),XA.exports=pK(),XA.exports}var gK=mK();const yK=L_(gK);function ke(n,e,t){return(e=(function(s){var r=(function(a,o){if(typeof a!="object"||!a)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var c=l.call(a,o);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)})(s,"string");return typeof r=="symbol"?r:r+""})(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function XP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable}))),t.push.apply(t,s)}return t}function Ie(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?XP(Object(t),!0).forEach((function(s){ke(n,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):XP(Object(t)).forEach((function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))}))}return n}function ar(n,e){if(n==null)return{};var t,s,r=(function(o,l){if(o==null)return{};var c={};for(var u in o)if({}.hasOwnProperty.call(o,u)){if(l.indexOf(u)>=0)continue;c[u]=o[u]}return c})(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(s=0;s<a.length;s++)t=a[s],e.indexOf(t)>=0||{}.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}function _h(n,e){return e||(e=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(e)}}))}let YP=class{constructor(){ke(this,"browserShadowBlurConstant",1),ke(this,"DPI",96),ke(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),ke(this,"perfLimitSizeTotal",2097152),ke(this,"maxCacheSideLimit",4096),ke(this,"minCacheSideLimit",256),ke(this,"disableStyleCopyPaste",!1),ke(this,"enableGLFiltering",!0),ke(this,"textureSize",4096),ke(this,"forceGLPutImageData",!1),ke(this,"cachesBoundsOfCurve",!1),ke(this,"fontPaths",{}),ke(this,"NUM_FRACTION_DIGITS",4)}};const ds=new class extends YP{constructor(n){super(),this.configure(n)}configure(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,n)}addFonts(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=Ie(Ie({},this.fontPaths),n)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach((n=>{delete this.fontPaths[n]}))}clearFonts(){this.fontPaths={}}restoreDefaults(n){const e=new YP,t=n?.reduce(((s,r)=>(s[r]=e[r],s)),{})||e;this.configure(t)}},yd=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return console[n]("fabric",...t)};let nh=class extends Error{constructor(e,t){super("fabric: ".concat(e),t)}},iO=class extends nh{constructor(e){super("".concat(e," 'options.signal' is in 'aborted' state"))}},bK=class{},vK=class extends bK{testPrecision(e,t){const s="precision ".concat(t,` float;
void main(){}`),r=e.createShader(e.FRAGMENT_SHADER);return!!r&&(e.shaderSource(r,s),e.compileShader(r),!!e.getShaderParameter(r,e.COMPILE_STATUS))}queryWebGL(e){const t=e.getContext("webgl");t&&(this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((s=>this.testPrecision(t,s))),t.getExtension("WEBGL_lose_context").loseContext(),yd("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(e){return!!this.maxTextureSize&&this.maxTextureSize>=e}};const wK={};let KP;const mh=()=>KP||(KP={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new vK,dispose(){},copyPasteData:wK}),a1=()=>mh().document,o1=()=>mh().window,Tj=()=>{var n;return Math.max((n=ds.devicePixelRatio)!==null&&n!==void 0?n:o1().devicePixelRatio,1)},lv=new class{constructor(){ke(this,"boundsOfCurveCache",{}),this.charWidthsCache=new Map}getFontCache(n){let{fontFamily:e,fontStyle:t,fontWeight:s}=n;e=e.toLowerCase();const r=this.charWidthsCache;r.has(e)||r.set(e,new Map);const a=r.get(e),o="".concat(t.toLowerCase(),"_").concat((s+"").toLowerCase());return a.has(o)||a.set(o,new Map),a.get(o)}clearFontCache(n){n?this.charWidthsCache.delete((n||"").toLowerCase()):this.charWidthsCache=new Map}limitDimsByArea(n){const{perfLimitSizeTotal:e}=ds,t=Math.sqrt(e*n);return[Math.floor(t),Math.floor(e/t)]}},lE="6.9.1";function cm(){}const jf=Math.PI/2,bd=2*Math.PI,aO=Math.PI/180,io=Object.freeze([1,0,0,1,0,0]),oO=16,wf=.4477152502,In="center",ws="left",Uo="top",cE="bottom",Yr="right",no="none",lO=/\r?\n/,Nj="moving",F_="scaling",Aj="rotating",cO="rotate",Ej="skewing",xv="resizing",xK="modifyPoly",SK="modifyPath",yC="changed",M_="scale",ao="scaleX",Ol="scaleY",l1="skewX",c1="skewY",mi="fill",so="stroke",bC="modified",a0="json",JA="svg",Nt=new class{constructor(){this[a0]=new Map,this[JA]=new Map}has(n){return this[a0].has(n)}getClass(n){const e=this[a0].get(n);if(!e)throw new nh("No class registered for ".concat(n));return e}setClass(n,e){e?this[a0].set(e,n):(this[a0].set(n.type,n),this[a0].set(n.type.toLowerCase(),n))}getSVGClass(n){return this[JA].get(n)}setSVGClass(n,e){this[JA].set(e??n.type.toLowerCase(),n)}},vC=new class extends Array{remove(n){const e=this.indexOf(n);e>-1&&this.splice(e,1)}cancelAll(){const n=this.splice(0);return n.forEach((e=>e.abort())),n}cancelByCanvas(n){if(!n)return[];const e=this.filter((t=>{var s;return t.target===n||typeof t.target=="object"&&((s=t.target)===null||s===void 0?void 0:s.canvas)===n}));return e.forEach((t=>t.abort())),e}cancelByTarget(n){if(!n)return[];const e=this.filter((t=>t.target===n));return e.forEach((t=>t.abort())),e}};let CK=class{constructor(){ke(this,"__eventListeners",{})}on(e,t){if(this.__eventListeners||(this.__eventListeners={}),typeof e=="object")return Object.entries(e).forEach((s=>{let[r,a]=s;this.on(r,a)})),()=>this.off(e);if(t){const s=e;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(t),()=>this.off(s,t)}return()=>!1}once(e,t){if(typeof e=="object"){const s=[];return Object.entries(e).forEach((r=>{let[a,o]=r;s.push(this.once(a,o))})),()=>s.forEach((r=>r()))}if(t){const s=this.on(e,(function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t.call(this,...a),s()}));return s}return()=>!1}_removeEventListener(e,t){if(this.__eventListeners[e])if(t){const s=this.__eventListeners[e],r=s.indexOf(t);r>-1&&s.splice(r,1)}else this.__eventListeners[e]=[]}off(e,t){if(this.__eventListeners)if(e===void 0)for(const s in this.__eventListeners)this._removeEventListener(s);else typeof e=="object"?Object.entries(e).forEach((s=>{let[r,a]=s;this._removeEventListener(r,a)})):this._removeEventListener(e,t)}fire(e,t){var s;if(!this.__eventListeners)return;const r=(s=this.__eventListeners[e])===null||s===void 0?void 0:s.concat();if(r)for(let a=0;a<r.length;a++)r[a].call(this,t||{})}};const Zp=(n,e)=>{const t=n.indexOf(e);return t!==-1&&n.splice(t,1),n},du=n=>{if(n===0)return 1;switch(Math.abs(n)/jf){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},fu=n=>{if(n===0)return 0;const e=n/jf,t=Math.sign(n);switch(e){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(n)};let Ve=class Ka{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof e=="object"?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}add(e){return new Ka(this.x+e.x,this.y+e.y)}addEquals(e){return this.x+=e.x,this.y+=e.y,this}scalarAdd(e){return new Ka(this.x+e,this.y+e)}scalarAddEquals(e){return this.x+=e,this.y+=e,this}subtract(e){return new Ka(this.x-e.x,this.y-e.y)}subtractEquals(e){return this.x-=e.x,this.y-=e.y,this}scalarSubtract(e){return new Ka(this.x-e,this.y-e)}scalarSubtractEquals(e){return this.x-=e,this.y-=e,this}multiply(e){return new Ka(this.x*e.x,this.y*e.y)}scalarMultiply(e){return new Ka(this.x*e,this.y*e)}scalarMultiplyEquals(e){return this.x*=e,this.y*=e,this}divide(e){return new Ka(this.x/e.x,this.y/e.y)}scalarDivide(e){return new Ka(this.x/e,this.y/e)}scalarDivideEquals(e){return this.x/=e,this.y/=e,this}eq(e){return this.x===e.x&&this.y===e.y}lt(e){return this.x<e.x&&this.y<e.y}lte(e){return this.x<=e.x&&this.y<=e.y}gt(e){return this.x>e.x&&this.y>e.y}gte(e){return this.x>=e.x&&this.y>=e.y}lerp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return t=Math.max(Math.min(1,t),0),new Ka(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)}distanceFrom(e){const t=this.x-e.x,s=this.y-e.y;return Math.sqrt(t*t+s*s)}midPointFrom(e){return this.lerp(e)}min(e){return new Ka(Math.min(this.x,e.x),Math.min(this.y,e.y))}max(e){return new Ka(Math.max(this.x,e.x),Math.max(this.y,e.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(e,t){return this.x=e,this.y=t,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setFromPoint(e){return this.x=e.x,this.y=e.y,this}swap(e){const t=this.x,s=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=s}clone(){return new Ka(this.x,this.y)}rotate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:uO;const s=fu(e),r=du(e),a=this.subtract(t);return new Ka(a.x*r-a.y*s,a.x*s+a.y*r).add(t)}transform(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ka(e[0]*this.x+e[2]*this.y+(t?0:e[4]),e[1]*this.x+e[3]*this.y+(t?0:e[5]))}};const uO=new Ve(0,0),jS=n=>!!n&&Array.isArray(n._objects);function Ij(n){class e extends n{constructor(){super(...arguments),ke(this,"_objects",[])}_onObjectAdded(s){}_onObjectRemoved(s){}_onStackOrderChanged(s){}add(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];const o=this._objects.push(...r);return r.forEach((l=>this._onObjectAdded(l))),o}insertAt(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return this._objects.splice(s,0,...a),a.forEach((l=>this._onObjectAdded(l))),this._objects.length}remove(){const s=this._objects,r=[];for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return o.forEach((c=>{const u=s.indexOf(c);u!==-1&&(s.splice(u,1),r.push(c),this._onObjectRemoved(c))})),r}forEachObject(s){this.getObjects().forEach(((r,a,o)=>s(r,a,o)))}getObjects(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return r.length===0?[...this._objects]:this._objects.filter((o=>o.isType(...r)))}item(s){return this._objects[s]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(s,r){return!!this._objects.includes(s)||!!r&&this._objects.some((a=>a instanceof e&&a.contains(s,!0)))}complexity(){return this._objects.reduce(((s,r)=>s+=r.complexity?r.complexity():0),0)}sendObjectToBack(s){return!(!s||s===this._objects[0])&&(Zp(this._objects,s),this._objects.unshift(s),this._onStackOrderChanged(s),!0)}bringObjectToFront(s){return!(!s||s===this._objects[this._objects.length-1])&&(Zp(this._objects,s),this._objects.push(s),this._onStackOrderChanged(s),!0)}sendObjectBackwards(s,r){if(!s)return!1;const a=this._objects.indexOf(s);if(a!==0){const o=this.findNewLowerIndex(s,a,r);return Zp(this._objects,s),this._objects.splice(o,0,s),this._onStackOrderChanged(s),!0}return!1}bringObjectForward(s,r){if(!s)return!1;const a=this._objects.indexOf(s);if(a!==this._objects.length-1){const o=this.findNewUpperIndex(s,a,r);return Zp(this._objects,s),this._objects.splice(o,0,s),this._onStackOrderChanged(s),!0}return!1}moveObjectTo(s,r){return s!==this._objects[r]&&(Zp(this._objects,s),this._objects.splice(r,0,s),this._onStackOrderChanged(s),!0)}findNewLowerIndex(s,r,a){let o;if(a){o=r;for(let l=r-1;l>=0;--l)if(s.isOverlapping(this._objects[l])){o=l;break}}else o=r-1;return o}findNewUpperIndex(s,r,a){let o;if(a){o=r;for(let l=r+1;l<this._objects.length;++l)if(s.isOverlapping(this._objects[l])){o=l;break}}else o=r+1;return o}collectObjects(s){let{left:r,top:a,width:o,height:l}=s,{includeIntersecting:c=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u=[],d=new Ve(r,a),p=d.add(new Ve(o,l));for(let m=this._objects.length-1;m>=0;m--){const g=this._objects[m];g.selectable&&g.visible&&(c&&g.intersectsWithRect(d,p)||g.isContainedWithinRect(d,p)||c&&g.containsPoint(d)||c&&g.containsPoint(p))&&u.push(g)}return u}}return e}let Oj=class extends CK{_setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const t in e)this.set(t,e[t])}_setObject(e){for(const t in e)this._set(t,e[t])}set(e,t){return typeof e=="object"?this._setObject(e):this._set(e,t),this}_set(e,t){this[e]=t}toggle(e){const t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this}get(e){return this[e]}};function cv(n){return o1().requestAnimationFrame(n)}function Dj(n){return o1().cancelAnimationFrame(n)}let _K=0;const Uf=()=>_K++,gh=()=>{const n=a1().createElement("canvas");if(!n||n.getContext===void 0)throw new nh("Failed to create `canvas` element");return n},$j=()=>a1().createElement("img"),Dl=n=>{const e=gh();return e.width=n.width,e.height=n.height,e},hO=(n,e,t)=>n.toDataURL("image/".concat(e),t),dO=(n,e,t)=>new Promise(((s,r)=>{n.toBlob(s,"image/".concat(e),t)})),Mr=n=>n*aO,yh=n=>n/aO,Rj=n=>n.every(((e,t)=>e===io[t])),Ta=(n,e,t)=>new Ve(n).transform(e,t),jo=n=>{const e=1/(n[0]*n[3]-n[1]*n[2]),t=[e*n[3],-e*n[1],-e*n[2],e*n[0],0,0],{x:s,y:r}=new Ve(n[4],n[5]).transform(t,!0);return t[4]=-s,t[5]=-r,t},ei=(n,e,t)=>[n[0]*e[0]+n[2]*e[1],n[1]*e[0]+n[3]*e[1],n[0]*e[2]+n[2]*e[3],n[1]*e[2]+n[3]*e[3],t?0:n[0]*e[4]+n[2]*e[5]+n[4],t?0:n[1]*e[4]+n[3]*e[5]+n[5]],P_=(n,e)=>n.reduceRight(((t,s)=>s&&t?ei(s,t,e):s||t),void 0)||io.concat(),Lj=n=>{let[e,t]=n;return Math.atan2(t,e)},xm=n=>{const e=Lj(n),t=Math.pow(n[0],2)+Math.pow(n[1],2),s=Math.sqrt(t),r=(n[0]*n[3]-n[2]*n[1])/s,a=Math.atan2(n[0]*n[2]+n[1]*n[3],t);return{angle:yh(e),scaleX:s,scaleY:r,skewX:yh(a),skewY:0,translateX:n[4]||0,translateY:n[5]||0}},u1=function(n){return[1,0,0,1,n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Xm(){let{angle:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:e=0,y:t=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=Mr(n),r=du(s),a=fu(s);return[r,a,-a,r,e?e-(r*e-a*t):0,t?t-(a*e+r*t):0]}const z_=function(n){return[n,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:n,0,0]},Fj=n=>Math.tan(Mr(n)),fO=n=>[1,0,Fj(n),1,0,0],pO=n=>[1,Fj(n),0,1,0,0],dw=n=>{let{scaleX:e=1,scaleY:t=1,flipX:s=!1,flipY:r=!1,skewX:a=0,skewY:o=0}=n,l=z_(s?-e:e,r?-t:t);return a&&(l=ei(l,fO(a),!0)),o&&(l=ei(l,pO(o),!0)),l},Mj=n=>{const{translateX:e=0,translateY:t=0,angle:s=0}=n;let r=u1(e,t);s&&(r=ei(r,Xm({angle:s})));const a=dw(n);return Rj(a)||(r=ei(r,a)),r},uv=function(n){let{signal:e,crossOrigin:t=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((function(s,r){if(e&&e.aborted)return r(new iO("loadImage"));const a=$j();let o;e&&(o=function(c){a.src="",r(c)},e.addEventListener("abort",o,{once:!0}));const l=function(){a.onload=a.onerror=null,o&&e?.removeEventListener("abort",o),s(a)};n?(a.onload=l,a.onerror=function(){o&&e?.removeEventListener("abort",o),r(new nh("Error loading ".concat(a.src)))},t&&(a.crossOrigin=t),a.src=n):l()}))},M0=function(n){let{signal:e,reviver:t=cm}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(((s,r)=>{const a=[];e&&e.addEventListener("abort",r,{once:!0}),Promise.all(n.map((o=>Nt.getClass(o.type).fromObject(o,{signal:e}).then((l=>(t(o,l),a.push(l),l)))))).then(s).catch((o=>{a.forEach((l=>{l.dispose&&l.dispose()})),r(o)})).finally((()=>{e&&e.removeEventListener("abort",r)}))}))},fw=function(n){let{signal:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(((t,s)=>{const r=[];e&&e.addEventListener("abort",s,{once:!0});const a=Object.values(n).map((l=>l&&l.type&&Nt.has(l.type)?M0([l],{signal:e}).then((c=>{let[u]=c;return r.push(u),u})):l)),o=Object.keys(n);Promise.all(a).then((l=>l.reduce(((c,u,d)=>(c[o[d]]=u,c)),{}))).then(t).catch((l=>{r.forEach((c=>{c.dispose&&c.dispose()})),s(l)})).finally((()=>{e&&e.removeEventListener("abort",s)}))}))},Ym=function(n){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce(((e,t)=>(t in n&&(e[t]=n[t]),e)),{})},mO=(n,e)=>Object.keys(n).reduce(((t,s)=>(e(n[s],s,n)&&(t[s]=n[s]),t)),{}),Hs=(n,e)=>parseFloat(Number(n).toFixed(e)),P0=n=>"matrix("+n.map((e=>Hs(e,ds.NUM_FRACTION_DIGITS))).join(" ")+")",uc=n=>!!n&&n.toLive!==void 0,ZP=n=>!!n&&typeof n.toObject=="function",JP=n=>!!n&&n.offsetX!==void 0&&"source"in n,Jp=n=>!!n&&"multiSelectionStacking"in n;function Pj(n){const e=n&&su(n);let t=0,s=0;if(!n||!e)return{left:t,top:s};let r=n;const a=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;r&&(r.parentNode||r.host)&&(r=r.parentNode||r.host,r===e?(t=o.scrollLeft||a.scrollLeft||0,s=o.scrollTop||a.scrollTop||0):(t+=r.scrollLeft||0,s+=r.scrollTop||0),r.nodeType!==1||r.style.position!=="fixed"););return{left:t,top:s}}const su=n=>n.ownerDocument||null,zj=n=>{var e;return((e=n.ownerDocument)===null||e===void 0?void 0:e.defaultView)||null},Bj=function(n,e,t){let{width:s,height:r}=t,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;n.width=s,n.height=r,a>1&&(n.setAttribute("width",(s*a).toString()),n.setAttribute("height",(r*a).toString()),e.scale(a,a))},uE=(n,e)=>{let{width:t,height:s}=e;t&&(n.style.width=typeof t=="number"?"".concat(t,"px"):t),s&&(n.style.height=typeof s=="number"?"".concat(s,"px"):s)};function QP(n){return n.onselectstart!==void 0&&(n.onselectstart=()=>!1),n.style.userSelect=no,n}let jj=class{constructor(e){ke(this,"_originalCanvasStyle",void 0),ke(this,"lower",void 0);const t=this.createLowerCanvas(e);this.lower={el:t,ctx:t.getContext("2d")}}createLowerCanvas(e){const t=(s=e)&&s.getContext!==void 0?e:e&&a1().getElementById(e)||gh();var s;if(t.hasAttribute("data-fabric"))throw new nh("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=t.style.cssText,t.setAttribute("data-fabric","main"),t.classList.add("lower-canvas"),t}cleanupDOM(e){let{width:t,height:s}=e;const{el:r}=this.lower;r.classList.remove("lower-canvas"),r.removeAttribute("data-fabric"),r.setAttribute("width","".concat(t)),r.setAttribute("height","".concat(s)),r.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(e,t){const{el:s,ctx:r}=this.lower;Bj(s,r,e,t)}setCSSDimensions(e){uE(this.lower.el,e)}calcOffset(){return(function(e){var t;const s=e&&su(e),r={left:0,top:0};if(!s)return r;const a=((t=zj(e))===null||t===void 0?void 0:t.getComputedStyle(e,null))||{};r.left+=parseInt(a.borderLeftWidth,10)||0,r.top+=parseInt(a.borderTopWidth,10)||0,r.left+=parseInt(a.paddingLeft,10)||0,r.top+=parseInt(a.paddingTop,10)||0;let o={left:0,top:0};const l=s.documentElement;e.getBoundingClientRect!==void 0&&(o=e.getBoundingClientRect());const c=Pj(e);return{left:o.left+c.left-(l.clientLeft||0)+r.left,top:o.top+c.top-(l.clientTop||0)+r.top}})(this.lower.el)}dispose(){mh().dispose(this.lower.el),delete this.lower}};const kK={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...io]},TK=["objects"];let gO=class Uj extends Ij(Oj){get lowerCanvasEl(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.el}get contextContainer(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.ctx}static getDefaults(){return Uj.ownDefaults}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(t),this.initElements(e),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(e){this.elements=new jj(e)}add(){const e=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}insertAt(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const a=super.insertAt(e,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),a}remove(){const e=super.remove(...arguments);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}_onObjectAdded(e){e.canvas&&e.canvas!==this&&(yd("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),e.canvas.remove(e)),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e){e._set("canvas",void 0),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?Tj():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(e,t){return this.setDimensions({width:e},t)}setHeight(e,t){return this.setDimensions({height:e},t)}_setDimensionsImpl(e){let{cssOnly:t=!1,backstoreOnly:s=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t){const r=Ie({width:this.width,height:this.height},e);this.elements.setDimensions(r,this.getRetinaScaling()),this.hasLostContext=!0,this.width=r.width,this.height=r.height}s||this.elements.setCSSDimensions(e),this.calcOffset()}setDimensions(e,t){this._setDimensionsImpl(e,t),t&&t.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(e){this.viewportTransform=e,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(e,t){const s=e,r=[...this.viewportTransform],a=Ta(e,jo(r));r[0]=t,r[3]=t;const o=Ta(a,r);r[4]+=s.x-o.x,r[5]+=s.y-o.y,this.setViewportTransform(r)}setZoom(e){this.zoomToPoint(new Ve(0,0),e)}absolutePan(e){const t=[...this.viewportTransform];return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)}relativePan(e){return this.absolutePan(new Ve(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(e){e.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=cv((()=>this.renderAndReset())))}calcViewportBoundaries(){const e=this.width,t=this.height,s=jo(this.viewportTransform),r=Ta({x:0,y:0},s),a=Ta({x:e,y:t},s),o=r.min(a),l=r.max(a);return this.vptCoords={tl:o,tr:new Ve(l.x,o.y),bl:new Ve(o.x,l.y),br:l}}cancelRequestedRender(){this.nextRenderHandle&&(Dj(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(e){}renderCanvas(e,t){if(this.destroyed)return;const s=this.viewportTransform,r=this.clipPath;this.calcViewportBoundaries(),this.clearContext(e),e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.patternQuality="best",this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(e,t),e.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(e),r&&(r._set("canvas",this),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e,r)),this._renderOverlay(e),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(e),this.fire("after:render",{ctx:e}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(e,t){const s=this.viewportTransform;e.save(),e.transform(...s),e.globalCompositeOperation="destination-in",t.transform(e),e.scale(1/t.zoomX,1/t.zoomY),e.drawImage(t._cacheCanvas,-t.cacheTranslationX,-t.cacheTranslationY),e.restore()}_renderObjects(e,t){for(let s=0,r=t.length;s<r;++s)t[s]&&t[s].render(e)}_renderBackgroundOrOverlay(e,t){const s=this["".concat(t,"Color")],r=this["".concat(t,"Image")],a=this.viewportTransform,o=this["".concat(t,"Vpt")];if(!s&&!r)return;const l=uc(s);if(s){if(e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=l?s.toLive(e):s,o&&e.transform(...a),l){e.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const c=s.gradientTransform||s.patternTransform;c&&e.transform(...c)}e.fill(),e.restore()}if(r){e.save();const{skipOffscreen:c}=this;this.skipOffscreen=o,o&&e.transform(...a),r.render(e),this.skipOffscreen=c,e.restore()}}_renderBackground(e){this._renderBackgroundOrOverlay(e,"background")}_renderOverlay(e){this._renderBackgroundOrOverlay(e,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new Ve(this.width/2,this.height/2)}centerObjectH(e){return this._centerObject(e,new Ve(this.getCenterPoint().x,e.getCenterPoint().y))}centerObjectV(e){return this._centerObject(e,new Ve(e.getCenterPoint().x,this.getCenterPoint().y))}centerObject(e){return this._centerObject(e,this.getCenterPoint())}viewportCenterObject(e){return this._centerObject(e,this.getVpCenter())}viewportCenterObjectH(e){return this._centerObject(e,new Ve(this.getVpCenter().x,e.getCenterPoint().y))}viewportCenterObjectV(e){return this._centerObject(e,new Ve(e.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Ta(this.getCenterPoint(),jo(this.viewportTransform))}_centerObject(e,t){e.setXY(t,In,In),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(e){return this.toDatalessObject(e)}toObject(e){return this._toObjectMethod("toObject",e)}toJSON(){return this.toObject()}toDatalessObject(e){return this._toObjectMethod("toDatalessObject",e)}_toObjectMethod(e,t){const s=this.clipPath,r=s&&!s.excludeFromExport?this._toObject(s,e,t):null;return Ie(Ie(Ie({version:lE},Ym(this,t)),{},{objects:this._objects.filter((a=>!a.excludeFromExport)).map((a=>this._toObject(a,e,t)))},this.__serializeBgOverlay(e,t)),r?{clipPath:r}:null)}_toObject(e,t,s){let r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);const a=e[t](s);return this.includeDefaultValues||(e.includeDefaultValues=!!r),a}__serializeBgOverlay(e,t){const s={},r=this.backgroundImage,a=this.overlayImage,o=this.backgroundColor,l=this.overlayColor;return uc(o)?o.excludeFromExport||(s.background=o.toObject(t)):o&&(s.background=o),uc(l)?l.excludeFromExport||(s.overlay=l.toObject(t)):l&&(s.overlay=l),r&&!r.excludeFromExport&&(s.backgroundImage=this._toObject(r,e,t)),a&&!a.excludeFromExport&&(s.overlayImage=this._toObject(a,e,t)),s}toSVG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.reviver=t;const s=[];return this._setSVGPreamble(s,e),this._setSVGHeader(s,e),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",t),this._setSVGObjects(s,t),this.clipPath&&s.push(`</g>
`),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",t),s.push("</svg>"),s.join("")}_setSVGPreamble(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(e,t){const s=t.width||"".concat(this.width),r=t.height||"".concat(this.height),a=ds.NUM_FRACTION_DIGITS,o=t.viewBox;let l;if(o)l='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){const c=this.viewportTransform;l='viewBox="'.concat(Hs(-c[4]/c[0],a)," ").concat(Hs(-c[5]/c[3],a)," ").concat(Hs(this.width/c[0],a)," ").concat(Hs(this.height/c[3],a),'" ')}else l='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',r,'" ',l,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",lE,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),`</defs>
`)}createSVGClipPathMarkup(e){const t=this.clipPath;return t?(t.clipPathId="CLIPPATH_".concat(Uf()),'<clipPath id="'.concat(t.clipPathId,`" >
`).concat(t.toClipPathSVG(e.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map((e=>{const t=this["".concat(e,"Color")];if(uc(t)){const s=this["".concat(e,"Vpt")],r=this.viewportTransform,a={isType:()=>!1,width:this.width/(s?r[0]:1),height:this.height/(s?r[3]:1)};return t.toSVG(a,{additionalTransform:s?P0(r):""})}})).join("")}createSVGFontFacesMarkup(){const e=[],t={},s=ds.fontPaths;this._objects.forEach((function a(o){e.push(o),jS(o)&&o._objects.forEach(a)})),e.forEach((a=>{if(!(o=a)||typeof o._renderText!="function")return;var o;const{styles:l,fontFamily:c}=a;!t[c]&&s[c]&&(t[c]=!0,l&&Object.values(l).forEach((u=>{Object.values(u).forEach((d=>{let{fontFamily:p=""}=d;!t[p]&&s[p]&&(t[p]=!0)}))})))}));const r=Object.keys(t).map((a=>`		@font-face {
			font-family: '`.concat(a,`';
			src: url('`).concat(s[a],`');
		}
`))).join("");return r?`	<style type="text/css"><![CDATA[
`.concat(r,`]]></style>
`):""}_setSVGObjects(e,t){this.forEachObject((s=>{s.excludeFromExport||this._setSVGObject(e,s,t)}))}_setSVGObject(e,t,s){e.push(t.toSVG(s))}_setSVGBgOverlayImage(e,t,s){const r=this[t];r&&!r.excludeFromExport&&r.toSVG&&e.push(r.toSVG(s))}_setSVGBgOverlayColor(e,t){const s=this["".concat(t,"Color")];if(s)if(uc(s)){const r=s.repeat||"",a=this.width,o=this.height,l=this["".concat(t,"Vpt")]?P0(jo(this.viewportTransform)):"";e.push('<rect transform="'.concat(l," translate(").concat(a/2,",").concat(o/2,')" x="').concat(s.offsetX-a/2,'" y="').concat(s.offsetY-o/2,'" width="').concat(r!=="repeat-y"&&r!=="no-repeat"||!JP(s)?a:s.source.width,'" height="').concat(r!=="repeat-x"&&r!=="no-repeat"||!JP(s)?o:s.source.height,'" fill="url(#SVGID_').concat(s.id,`)"></rect>
`))}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',`></rect>
`)}loadFromJSON(e,t){let{signal:s}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!e)return Promise.reject(new nh("`json` is undefined"));const r=typeof e=="string"?JSON.parse(e):e,{objects:a=[]}=r,o=ar(r,TK),{backgroundImage:l,background:c,overlayImage:u,overlay:d,clipPath:p}=o,m=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([M0(a,{reviver:t,signal:s}),fw({backgroundImage:l,backgroundColor:c,overlayImage:u,overlayColor:d,clipPath:p},{signal:s})]).then((g=>{let[b,v]=g;return this.clear(),this.add(...b),this.set(o),this.set(v),this.renderOnAddRemove=m,this}))}clone(e){const t=this.toObject(e);return this.cloneWithoutData().loadFromJSON(t)}cloneWithoutData(){const e=Dl(this);return new this.constructor(e)}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:t="png",quality:s=1,multiplier:r=1,enableRetinaScaling:a=!1}=e,o=r*(a?this.getRetinaScaling():1);return hO(this.toCanvasElement(o,e),t,s)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:t="png",quality:s=1,multiplier:r=1,enableRetinaScaling:a=!1}=e,o=r*(a?this.getRetinaScaling():1);return dO(this.toCanvasElement(o,e),t,s)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:t,height:s,left:r,top:a,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=(t||this.width)*e,c=(s||this.height)*e,u=this.getZoom(),d=this.width,p=this.height,m=this.skipControlsDrawing,g=u*e,b=this.viewportTransform,v=[g,0,0,g,(b[4]-(r||0))*e,(b[5]-(a||0))*e],x=this.enableRetinaScaling,S=Dl({width:l,height:c}),C=o?this._objects.filter((A=>o(A))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=v,this.width=l,this.height=c,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(S.getContext("2d"),C),this.viewportTransform=b,this.width=d,this.height=p,this.calcViewportBoundaries(),this.enableRetinaScaling=x,this.skipControlsDrawing=m,S}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),vC.cancelByCanvas(this),this.disposed=!0,new Promise(((e,t)=>{const s=()=>{this.destroy(),e(!0)};s.kill=t,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?e(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((e=>e.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}};ke(gO,"ownDefaults",kK);const NK=["touchstart","touchmove","touchend"],Vj=n=>{const e=Pj(n.target),t=(function(s){const r=s.changedTouches;return r&&r[0]?r[0]:s})(n);return new Ve(t.clientX+e.left,t.clientY+e.top)},wC=n=>NK.includes(n.type)||n.pointerType==="touch",e6=n=>{n.preventDefault(),n.stopPropagation()},oh=n=>{let e=0,t=0,s=0,r=0;for(let a=0,o=n.length;a<o;a++){const{x:l,y:c}=n[a];(l>s||!a)&&(s=l),(l<e||!a)&&(e=l),(c>r||!a)&&(r=c),(c<t||!a)&&(t=c)}return{left:e,top:t,width:s-e,height:r-t}},AK=["translateX","translateY","scaleX","scaleY"],Wj=(n,e)=>z0(n,ei(e,n.calcOwnMatrix())),z0=(n,e)=>{const t=xm(e),{translateX:s,translateY:r,scaleX:a,scaleY:o}=t,l=ar(t,AK),c=new Ve(s,r);n.flipX=!1,n.flipY=!1,Object.assign(n,l),n.set({scaleX:a,scaleY:o}),n.setPositionByOrigin(c,In,In)},Hj=n=>{n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},yO=n=>({scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}),B_=(n,e,t)=>{const s=n/2,r=e/2,a=[new Ve(-s,-r),new Ve(s,-r),new Ve(-s,r),new Ve(s,r)].map((l=>l.transform(t))),o=oh(a);return new Ve(o.width,o.height)},pw=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:io;return ei(jo(arguments.length>1&&arguments[1]!==void 0?arguments[1]:io),n)},um=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:io,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:io;return n.transform(pw(e,t))},Gj=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:io,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:io;return n.transform(pw(e,t),!0)},hE=(n,e,t)=>{const s=pw(e,t);return z0(n,ei(s,n.calcOwnMatrix())),s},qj=(n,e)=>{var t;const{transform:{target:s}}=e;(t=s.canvas)===null||t===void 0||t.fire("object:".concat(n),Ie(Ie({},e),{},{target:s})),s.fire(n,e)},EK={left:-.5,top:-.5,center:0,bottom:.5,right:.5},hi=n=>typeof n=="string"?EK[n]:n-.5,xC="not-allowed";function Xj(n){return hi(n.originX)===hi(In)&&hi(n.originY)===hi(In)}function t6(n){return .5-hi(n)}const au=(n,e)=>n[e],Yj=(n,e,t,s)=>({e:n,transform:e,pointer:new Ve(t,s)});function Kj(n,e){const t=n.getTotalAngle()+yh(Math.atan2(e.y,e.x))+360;return Math.round(t%360/45)}function bO(n,e,t,s,r){var a;let{target:o,corner:l}=n;const c=o.controls[l],u=((a=o.canvas)===null||a===void 0?void 0:a.getZoom())||1,d=o.padding/u,p=(function(m,g,b,v){const x=m.getRelativeCenterPoint(),S=b!==void 0&&v!==void 0?m.translateToGivenOrigin(x,In,In,b,v):new Ve(m.left,m.top);return(m.angle?g.rotate(-Mr(m.angle),x):g).subtract(S)})(o,new Ve(s,r),e,t);return p.x>=d&&(p.x-=d),p.x<=-d&&(p.x+=d),p.y>=d&&(p.y-=d),p.y<=d&&(p.y+=d),p.x-=c.offsetX,p.y-=c.offsetY,p}const IK=(n,e,t,s)=>{const{target:r,offsetX:a,offsetY:o}=e,l=t-a,c=s-o,u=!au(r,"lockMovementX")&&r.left!==l,d=!au(r,"lockMovementY")&&r.top!==c;return u&&r.set(ws,l),d&&r.set(Uo,c),(u||d)&&qj(Nj,Yj(n,e,t,s)),u||d},SC=n=>n.replace(/\s+/g," "),n6={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},QA=(n,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+(e-n)*(2/3-t)*6:n),s6=(n,e,t,s)=>{n/=255,e/=255,t/=255;const r=Math.max(n,e,t),a=Math.min(n,e,t);let o,l;const c=(r+a)/2;if(r===a)o=l=0;else{const u=r-a;switch(l=c>.5?u/(2-r-a):u/(r+a),r){case n:o=(e-t)/u+(e<t?6:0);break;case e:o=(t-n)/u+2;break;case t:o=(n-e)/u+4}o/=6}return[Math.round(360*o),Math.round(100*l),Math.round(100*c),s]},r6=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(n)/(n.endsWith("%")?100:1)},iS=n=>Math.min(Math.round(n),255).toString(16).toUpperCase().padStart(2,"0"),i6=n=>{let[e,t,s,r=1]=n;const a=Math.round(.3*e+.59*t+.11*s);return[a,a,a,r]};let Ho=class ka{constructor(e){if(ke(this,"isUnrecognised",!1),e)if(e instanceof ka)this.setSource([...e._source]);else if(Array.isArray(e)){const[t,s,r,a=1]=e;this.setSource([t,s,r,a])}else this.setSource(this._tryParsingColor(e));else this.setSource([0,0,0,1])}_tryParsingColor(e){return(e=e.toLowerCase())in n6&&(e=n6[e]),e==="transparent"?[255,255,255,0]:ka.sourceFromHex(e)||ka.sourceFromRgb(e)||ka.sourceFromHsl(e)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(e){this._source=e}toRgb(){const[e,t,s]=this.getSource();return"rgb(".concat(e,",").concat(t,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[e,t,s]=s6(...this.getSource());return"hsl(".concat(e,",").concat(t,"%,").concat(s,"%)")}toHsla(){const[e,t,s,r]=s6(...this.getSource());return"hsla(".concat(e,",").concat(t,"%,").concat(s,"%,").concat(r,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[e,t,s,r]=this.getSource();return"".concat(iS(e)).concat(iS(t)).concat(iS(s)).concat(iS(Math.round(255*r)))}getAlpha(){return this.getSource()[3]}setAlpha(e){return this._source[3]=e,this}toGrayscale(){return this.setSource(i6(this.getSource())),this}toBlackWhite(e){const[t,,,s]=i6(this.getSource()),r=t<(e||127)?0:255;return this.setSource([r,r,r,s]),this}overlayWith(e){e instanceof ka||(e=new ka(e));const t=this.getSource(),s=e.getSource(),[r,a,o]=t.map(((l,c)=>Math.round(.5*l+.5*s[c])));return this.setSource([r,a,o,t[3]]),this}static fromRgb(e){return ka.fromRgba(e)}static fromRgba(e){return new ka(ka.sourceFromRgb(e))}static sourceFromRgb(e){const t=SC(e).match(/^rgba?\(\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d{0,3}(?:\.\d+)?%?)\s?)?\)$/i);if(t){const[s,r,a]=t.slice(1,4).map((o=>{const l=parseFloat(o);return o.endsWith("%")?Math.round(2.55*l):l}));return[s,r,a,r6(t[4])]}}static fromHsl(e){return ka.fromHsla(e)}static fromHsla(e){return new ka(ka.sourceFromHsl(e))}static sourceFromHsl(e){const t=SC(e).match(/^hsla?\(\s?([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d*(?:\.\d+)?%?)\s?)?\)$/i);if(!t)return;const s=(ka.parseAngletoDegrees(t[1])%360+360)%360/360,r=parseFloat(t[2])/100,a=parseFloat(t[3])/100;let o,l,c;if(r===0)o=l=c=a;else{const u=a<=.5?a*(r+1):a+r-a*r,d=2*a-u;o=QA(d,u,s+1/3),l=QA(d,u,s),c=QA(d,u,s-1/3)}return[Math.round(255*o),Math.round(255*l),Math.round(255*c),r6(t[4])]}static fromHex(e){return new ka(ka.sourceFromHex(e))}static sourceFromHex(e){if(e.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const t=e.slice(e.indexOf("#")+1);let s;s=t.length<=4?t.split("").map((c=>c+c)):t.match(/.{2}/g);const[r,a,o,l=255]=s.map((c=>parseInt(c,16)));return[r,a,o,l/255]}}static parseAngletoDegrees(e){const t=e.toLowerCase(),s=parseFloat(t);return t.includes("rad")?yh(s):t.includes("turn")?360*s:s}};const Ja=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:oO;const t=/\D{0,2}$/.exec(n),s=parseFloat(n),r=ds.DPI;switch(t?.[0]){case"mm":return s*r/25.4;case"cm":return s*r/2.54;case"in":return s*r;case"pt":return s*r/72;case"pc":return s*r/72*12;case"em":return s*e;default:return s}},vO=n=>{const[e,t]=n.trim().split(" "),[s,r]=(a=e)&&a!==no?[a.slice(1,4),a.slice(5,8)]:a===no?[a,a]:["Mid","Mid"];var a;return{meetOrSlice:t||"meet",alignX:s,alignY:r}},Sv=function(n,e){let t,s,r=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(e)if(e.toLive)t="url(#SVGID_".concat(e.id,")");else{const a=new Ho(e),o=a.getAlpha();t=a.toRgb(),o!==1&&(s=o.toString())}else t="none";return r?"".concat(n,": ").concat(t,"; ").concat(s?"".concat(n,"-opacity: ").concat(s,"; "):""):"".concat(n,'="').concat(t,'" ').concat(s?"".concat(n,'-opacity="').concat(s,'" '):"")};class Zj{getSvgStyles(e){const t=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):no,a=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",l=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",u=this.opacity!==void 0?this.opacity:"1",d=this.visible?"":" visibility: hidden;",p=e?"":this.getSvgFilter(),m=Sv(mi,this.fill);return[Sv(so,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",a,"; ","stroke-linejoin: ",l,"; ","stroke-miterlimit: ",c,"; ",m,"fill-rule: ",t,"; ","opacity: ",u,";",p,d].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'.concat(P0(s));return"".concat(r).concat(t,'" ')}_toSVG(e){return[""]}toSVG(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})}toClipPathSVG(e){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})}_createBaseClipPathSVGMarkup(e){let{reviver:t,additionalTransform:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),a=e.indexOf("COMMON_PARTS");return e[a]=r,t?t(e.join("")):e.join("")}_createBaseSVGMarkup(e){let{noStyle:t,reviver:s,withShadow:r,additionalTransform:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=t?"":'style="'.concat(this.getSvgStyles(),'" '),l=r?'style="'.concat(this.getSvgFilter(),'" '):"",c=this.clipPath,u=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",d=c&&c.absolutePositioned,p=this.stroke,m=this.fill,g=this.shadow,b=[],v=e.indexOf("COMMON_PARTS");let x;c&&(c.clipPathId="CLIPPATH_".concat(Uf()),x='<clipPath id="'.concat(c.clipPathId,`" >
`).concat(c.toClipPathSVG(s),`</clipPath>
`)),d&&b.push("<g ",l,this.getSvgCommons(),` >
`),b.push("<g ",this.getSvgTransform(!1),d?"":l+this.getSvgCommons(),` >
`);const S=[o,u,t?"":this.addPaintOrder()," ",a?'transform="'.concat(a,'" '):""].join("");return e[v]=S,uc(m)&&b.push(m.toSVG(this)),uc(p)&&b.push(p.toSVG(this)),g&&b.push(g.toSVG(this)),c&&b.push(x),b.push(e.join("")),b.push(`</g>
`),d&&b.push(`</g>
`),s?s(b.join("")):b.join("")}addPaintOrder(){return this.paintFirst!==mi?' paint-order="'.concat(this.paintFirst,'" '):""}}function j_(n){return new RegExp("^("+n.join("|")+")\\b","i")}const Sm="textDecorationThickness",Jj=["fontSize","fontWeight","fontFamily","fontStyle"],Qj=["underline","overline","linethrough"],e8=[...Jj,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],t8=[...e8,...Qj,"textBackgroundColor","direction",Sm],OK=[...Jj,...Qj,so,"strokeWidth",mi,"deltaY","textBackgroundColor",Sm],DK={_reNewline:lO,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:ws,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:ws,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[Sm]:66.667},Qu="justify",CC="justify-left",hv="justify-right",dv="justify-center";var a6,o6,l6;const ru=String.raw(a6||(a6=_h(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),e5=String.raw(o6||(o6=_h(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),dE="http://www.w3.org/2000/svg",$K=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+ru+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+ru+"))?\\s+(.*)"),RK={cx:ws,x:ws,r:"radius",cy:Uo,y:Uo,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":Sm},t5="font-size",n5="clip-path",LK=j_(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),FK=j_(["symbol","image","marker","pattern","view","svg"]),c6=j_(["symbol","g","a","svg","clipPath","defs"]),u6=new RegExp(String.raw(l6||(l6=_h(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),ru,e5,ru,e5,ru,e5,ru)),MK=new Ve(1,0),n8=new Ve,wO=(n,e)=>n.rotate(e),_C=(n,e)=>new Ve(e).subtract(n),kC=n=>n.distanceFrom(n8),TC=(n,e)=>Math.atan2(k0(n,e),r8(n,e)),s8=n=>TC(MK,n),U_=n=>n.eq(n8)?n:n.scalarDivide(kC(n)),xO=function(n){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return U_(new Ve(-n.y,n.x).scalarMultiply(e?1:-1))},k0=(n,e)=>n.x*e.y-n.y*e.x,r8=(n,e)=>n.x*e.x+n.y*e.y,fE=(n,e,t)=>{if(n.eq(e)||n.eq(t))return!0;const s=k0(e,t),r=k0(e,n),a=k0(t,n);return s>=0?r>=0&&a<=0:!(r<=0&&a>=0)},h6="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",d6=new RegExp("(?:\\s|^)"+h6+h6+"("+ru+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class lh{constructor(e){const t=typeof e=="string"?lh.parseShadow(e):e;Object.assign(this,lh.ownDefaults,t),this.id=Uf()}static parseShadow(e){const t=e.trim(),[,s=0,r=0,a=0]=(d6.exec(t)||[]).map((o=>parseFloat(o)||0));return{color:(t.replace(d6,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:r,blur:a}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(e){const t=wO(new Ve(this.offsetX,this.offsetY),Mr(-e.angle)),s=new Ho(this.color);let r=40,a=40;return e.width&&e.height&&(r=100*Hs((Math.abs(t.x)+this.blur)/e.width,ds.NUM_FRACTION_DIGITS)+20,a=100*Hs((Math.abs(t.y)+this.blur)/e.height,ds.NUM_FRACTION_DIGITS)+20),e.flipX&&(t.x*=-1),e.flipY&&(t.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(a,'%" height="').concat(100+2*a,'%" x="-').concat(r,'%" width="').concat(100+2*r,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Hs(this.blur?this.blur/2:0,ds.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Hs(t.x,ds.NUM_FRACTION_DIGITS),'" dy="').concat(Hs(t.y,ds.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const e={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},t=lh.ownDefaults;return this.includeDefaultValues?e:mO(e,((s,r)=>s!==t[r]))}static async fromObject(e){return new this(e)}}ke(lh,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),ke(lh,"type","shadow"),Nt.setClass(lh,"shadow");const Cm=(n,e,t)=>Math.max(n,Math.min(e,t)),PK=[Uo,ws,ao,Ol,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",l1,c1],Ad=[mi,so,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],zK={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:ws,originY:Uo,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:mi,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},s5=(n,e,t,s)=>(n<Math.abs(e)?(n=e,s=t/4):s=e===0&&n===0?t/bd*Math.asin(1):t/bd*Math.asin(e/n),{a:n,c:e,p:t,s}),f6=(n,e,t,s,r)=>n*Math.pow(2,10*(s-=1))*Math.sin((s*r-e)*bd/t),i8=(n,e,t,s)=>-t*Math.cos(n/s*jf)+t+e,pE=(n,e,t,s)=>(n/=s)<1/2.75?t*(7.5625*n*n)+e:n<2/2.75?t*(7.5625*(n-=1.5/2.75)*n+.75)+e:n<2.5/2.75?t*(7.5625*(n-=2.25/2.75)*n+.9375)+e:t*(7.5625*(n-=2.625/2.75)*n+.984375)+e,p6=(n,e,t,s)=>t-pE(s-n,0,t,s)+e;var BK=Object.freeze({__proto__:null,defaultEasing:i8,easeInBack:function(n,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return t*(n/=s)*n*((r+1)*n-r)+e},easeInBounce:p6,easeInCirc:(n,e,t,s)=>-t*(Math.sqrt(1-(n/=s)*n)-1)+e,easeInCubic:(n,e,t,s)=>t*(n/s)**3+e,easeInElastic:(n,e,t,s)=>{const r=t;let a=0;if(n===0)return e;if((n/=s)===1)return e+t;a||(a=.3*s);const{a:o,s:l,p:c}=s5(r,t,a,1.70158);return-f6(o,l,c,n,s)+e},easeInExpo:(n,e,t,s)=>n===0?e:t*2**(10*(n/s-1))+e,easeInOutBack:function(n,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return(n/=s/2)<1?t/2*(n*n*((1+(r*=1.525))*n-r))+e:t/2*((n-=2)*n*((1+(r*=1.525))*n+r)+2)+e},easeInOutBounce:(n,e,t,s)=>n<s/2?.5*p6(2*n,0,t,s)+e:.5*pE(2*n-s,0,t,s)+.5*t+e,easeInOutCirc:(n,e,t,s)=>(n/=s/2)<1?-t/2*(Math.sqrt(1-n**2)-1)+e:t/2*(Math.sqrt(1-(n-=2)*n)+1)+e,easeInOutCubic:(n,e,t,s)=>(n/=s/2)<1?t/2*n**3+e:t/2*((n-2)**3+2)+e,easeInOutElastic:(n,e,t,s)=>{const r=t;let a=0;if(n===0)return e;if((n/=s/2)===2)return e+t;a||(a=s*(.3*1.5));const{a:o,s:l,p:c,c:u}=s5(r,t,a,1.70158);return n<1?-.5*f6(o,l,c,n,s)+e:o*Math.pow(2,-10*(n-=1))*Math.sin((n*s-l)*bd/c)*.5+u+e},easeInOutExpo:(n,e,t,s)=>n===0?e:n===s?e+t:(n/=s/2)<1?t/2*2**(10*(n-1))+e:t/2*-(2**(-10*--n)+2)+e,easeInOutQuad:(n,e,t,s)=>(n/=s/2)<1?t/2*n**2+e:-t/2*(--n*(n-2)-1)+e,easeInOutQuart:(n,e,t,s)=>(n/=s/2)<1?t/2*n**4+e:-t/2*((n-=2)*n**3-2)+e,easeInOutQuint:(n,e,t,s)=>(n/=s/2)<1?t/2*n**5+e:t/2*((n-2)**5+2)+e,easeInOutSine:(n,e,t,s)=>-t/2*(Math.cos(Math.PI*n/s)-1)+e,easeInQuad:(n,e,t,s)=>t*(n/=s)*n+e,easeInQuart:(n,e,t,s)=>t*(n/=s)*n**3+e,easeInQuint:(n,e,t,s)=>t*(n/s)**5+e,easeInSine:(n,e,t,s)=>-t*Math.cos(n/s*jf)+t+e,easeOutBack:function(n,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return t*((n=n/s-1)*n*((r+1)*n+r)+1)+e},easeOutBounce:pE,easeOutCirc:(n,e,t,s)=>t*Math.sqrt(1-(n=n/s-1)*n)+e,easeOutCubic:(n,e,t,s)=>t*((n/s-1)**3+1)+e,easeOutElastic:(n,e,t,s)=>{const r=t;let a=0;if(n===0)return e;if((n/=s)===1)return e+t;a||(a=.3*s);const{a:o,s:l,p:c,c:u}=s5(r,t,a,1.70158);return o*2**(-10*n)*Math.sin((n*s-l)*bd/c)+u+e},easeOutExpo:(n,e,t,s)=>n===s?e+t:t*-(2**(-10*n/s)+1)+e,easeOutQuad:(n,e,t,s)=>-t*(n/=s)*(n-2)+e,easeOutQuart:(n,e,t,s)=>-t*((n=n/s-1)*n**3-1)+e,easeOutQuint:(n,e,t,s)=>t*((n/s-1)**5+1)+e,easeOutSine:(n,e,t,s)=>t*Math.sin(n/s*jf)+e});const jK=()=>!1;class SO{constructor(e){let{startValue:t,byValue:s,duration:r=500,delay:a=0,easing:o=i8,onStart:l=cm,onChange:c=cm,onComplete:u=cm,abort:d=jK,target:p}=e;ke(this,"_state","pending"),ke(this,"durationProgress",0),ke(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=r,this.delay=a,this.easing=o,this._onStart=l,this._onChange=c,this._onComplete=u,this._abort=d,this.target=p,this.startValue=t,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const e=t=>{this._state==="pending"&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>cv(e)),this.delay):cv(e)}tick(e){const t=(e||+new Date)-this.startTime,s=Math.min(t,this.duration);this.durationProgress=s/this.duration;const{value:r,valueProgress:a}=this.calculate(s);this.value=Object.freeze(r),this.valueProgress=a,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):t>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),cv(this.tick)))}register(){vC.push(this)}unregister(){vC.remove(this)}abort(){this._state="aborted",this.unregister()}}const UK=["startValue","endValue"];class VK extends SO{constructor(e){let{startValue:t=0,endValue:s=100}=e;super(Ie(Ie({},ar(e,UK)),{},{startValue:t,byValue:s-t}))}calculate(e){const t=this.easing(e,this.startValue,this.byValue,this.duration);return{value:t,valueProgress:Math.abs((t-this.startValue)/this.byValue)}}}const WK=["startValue","endValue"];class HK extends SO{constructor(e){let{startValue:t=[0],endValue:s=[100]}=e;super(Ie(Ie({},ar(e,WK)),{},{startValue:t,byValue:s.map(((r,a)=>r-t[a]))}))}calculate(e){const t=this.startValue.map(((s,r)=>this.easing(e,s,this.byValue[r],this.duration,r)));return{value:t,valueProgress:Math.abs((t[0]-this.startValue[0])/this.byValue[0])}}}const GK=["startValue","endValue","easing","onChange","onComplete","abort"],qK=(n,e,t,s)=>e+t*(1-Math.cos(n/s*jf)),r5=n=>n&&((e,t,s)=>n(new Ho(e).toRgba(),t,s));class XK extends SO{constructor(e){let{startValue:t,endValue:s,easing:r=qK,onChange:a,onComplete:o,abort:l}=e,c=ar(e,GK);const u=new Ho(t).getSource(),d=new Ho(s).getSource();super(Ie(Ie({},c),{},{startValue:u,byValue:d.map(((p,m)=>p-u[m])),easing:r,onChange:r5(a),onComplete:r5(o),abort:r5(l)}))}calculate(e){const[t,s,r,a]=this.startValue.map(((l,c)=>this.easing(e,l,this.byValue[c],this.duration,c))),o=[...[t,s,r].map(Math.round),Cm(0,a,1)];return{value:o,valueProgress:o.map(((l,c)=>this.byValue[c]!==0?Math.abs((l-this.startValue[c])/this.byValue[c]):0)).find((l=>l!==0))||0}}}function CO(n){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(n)?new HK(n):new VK(n);return e.start(),e}function a8(n){const e=new XK(n);return e.start(),e}class _r{constructor(e){this.status=e,this.points=[]}includes(e){return this.points.some((t=>t.eq(e)))}append(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.points=this.points.concat(t.filter((r=>!this.includes(r)))),this}static isPointContained(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(t.eq(s))return e.eq(t);if(t.x===s.x)return e.x===t.x&&(r||e.y>=Math.min(t.y,s.y)&&e.y<=Math.max(t.y,s.y));if(t.y===s.y)return e.y===t.y&&(r||e.x>=Math.min(t.x,s.x)&&e.x<=Math.max(t.x,s.x));{const a=_C(t,s),o=_C(t,e).divide(a);return r?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(e,t){const s=new Ve(e).setX(Math.min(e.x-1,...t.map((a=>a.x))));let r=0;for(let a=0;a<t.length;a++){const o=this.intersectSegmentSegment(t[a],t[(a+1)%t.length],e,s);if(o.includes(e))return!0;r+=+(o.status==="Intersection")}return r%2==1}static intersectLineLine(e,t,s,r){let a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const l=t.x-e.x,c=t.y-e.y,u=r.x-s.x,d=r.y-s.y,p=e.x-s.x,m=e.y-s.y,g=u*m-d*p,b=l*m-c*p,v=d*l-u*c;if(v!==0){const x=g/v,S=b/v;return(a||0<=x&&x<=1)&&(o||0<=S&&S<=1)?new _r("Intersection").append(new Ve(e.x+x*l,e.y+x*c)):new _r}if(g===0||b===0){const x=a||o||_r.isPointContained(e,s,r)||_r.isPointContained(t,s,r)||_r.isPointContained(s,e,t)||_r.isPointContained(r,e,t);return new _r(x?"Coincident":void 0)}return new _r("Parallel")}static intersectSegmentLine(e,t,s,r){return _r.intersectLineLine(e,t,s,r,!1,!0)}static intersectSegmentSegment(e,t,s,r){return _r.intersectLineLine(e,t,s,r,!1,!1)}static intersectLinePolygon(e,t,s){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const a=new _r,o=s.length;for(let l,c,u,d=0;d<o;d++){if(l=s[d],c=s[(d+1)%o],u=_r.intersectLineLine(e,t,l,c,r,!1),u.status==="Coincident")return u;a.append(...u.points)}return a.points.length>0&&(a.status="Intersection"),a}static intersectSegmentPolygon(e,t,s){return _r.intersectLinePolygon(e,t,s,!1)}static intersectPolygonPolygon(e,t){const s=new _r,r=e.length,a=[];for(let o=0;o<r;o++){const l=e[o],c=e[(o+1)%r],u=_r.intersectSegmentPolygon(l,c,t);u.status==="Coincident"?(a.push(u),s.append(l,c)):s.append(...u.points)}return a.length>0&&a.length===e.length?new _r("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(e,t,s){const r=t.min(s),a=t.max(s),o=new Ve(a.x,r.y),l=new Ve(r.x,a.y);return _r.intersectPolygonPolygon(e,[r,o,a,l])}}class YK extends Oj{getX(){return this.getXY().x}setX(e){this.setXY(this.getXY().setX(e))}getY(){return this.getXY().y}setY(e){this.setXY(this.getXY().setY(e))}getRelativeX(){return this.left}setRelativeX(e){this.left=e}getRelativeY(){return this.top}setRelativeY(e){this.top=e}getXY(){const e=this.getRelativeXY();return this.group?Ta(e,this.group.calcTransformMatrix()):e}setXY(e,t,s){this.group&&(e=Ta(e,jo(this.group.calcTransformMatrix()))),this.setRelativeXY(e,t,s)}getRelativeXY(){return new Ve(this.left,this.top)}setRelativeXY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(e,t,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:e,tr:t,br:s,bl:r}=this.aCoords||(this.aCoords=this.calcACoords()),a=[e,t,s,r];if(this.group){const o=this.group.calcTransformMatrix();return a.map((l=>Ta(l,o)))}return a}intersectsWithRect(e,t){return _r.intersectPolygonRectangle(this.getCoords(),e,t).status==="Intersection"}intersectsWithObject(e){const t=_r.intersectPolygonPolygon(this.getCoords(),e.getCoords());return t.status==="Intersection"||t.status==="Coincident"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)}isContainedWithinObject(e){return this.getCoords().every((t=>e.containsPoint(t)))}isContainedWithinRect(e,t){const{left:s,top:r,width:a,height:o}=this.getBoundingRect();return s>=e.x&&s+a<=t.x&&r>=e.y&&r+o<=t.y}isOverlapping(e){return this.intersectsWithObject(e)||this.isContainedWithinObject(e)||e.isContainedWithinObject(this)}containsPoint(e){return _r.isPointInPolygon(e,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return!!this.getCoords().some((s=>s.x<=t.x&&s.x>=e.x&&s.y<=t.y&&s.y>=e.y))||!!this.intersectsWithRect(e,t)||this.containsPoint(e.midPointFrom(t))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return this.intersectsWithRect(e,t)?!0:this.getCoords().every((s=>(s.x>=t.x||s.x<=e.x)&&(s.y>=t.y||s.y<=e.y)))&&this.containsPoint(e.midPointFrom(t))}getBoundingRect(){return oh(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(e){this._set(ao,e),this._set(Ol,e),this.setCoords()}scaleToWidth(e){const t=this.getBoundingRect().width/this.getScaledWidth();return this.scale(e/this.width/t)}scaleToHeight(e){const t=this.getBoundingRect().height/this.getScaledHeight();return this.scale(e/this.height/t)}getCanvasRetinaScaling(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.getRetinaScaling())||1}getTotalAngle(){return this.group?yh(Lj(this.calcTransformMatrix())):this.angle}getViewportTransform(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.viewportTransform)||io.concat()}calcACoords(){const e=Xm({angle:this.angle}),{x:t,y:s}=this.getRelativeCenterPoint(),r=u1(t,s),a=ei(r,e),o=this._getTransformedDimensions(),l=o.x/2,c=o.y/2;return{tl:Ta({x:-l,y:-c},a),tr:Ta({x:l,y:-c},a),bl:Ta({x:-l,y:c},a),br:Ta({x:l,y:c},a)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=[];return!e&&this.group&&(t=this.group.transformMatrixKey(e)),t.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,hi(this.originX),hi(this.originY)),t}calcTransformMatrix(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=this.calcOwnMatrix();if(e||!this.group)return t;const s=this.transformMatrixKey(e),r=this.matrixCache;return r&&r.key.every(((a,o)=>a===s[o]))?r.value:(this.group&&(t=ei(this.group.calcTransformMatrix(!1),t)),this.matrixCache={key:s,value:t},t)}calcOwnMatrix(){const e=this.transformMatrixKey(!0),t=this.ownMatrixCache;if(t&&t.key===e)return t.value;const s=this.getRelativeCenterPoint(),r={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},a=Mj(r);return this.ownMatrixCache={key:e,value:a},a}_getNonTransformedDimensions(){return new Ve(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(e){return this._getTransformedDimensions(e).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Ie({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},e),s=t.strokeWidth;let r=s,a=0;this.strokeUniform&&(r=0,a=s);const o=t.width+r,l=t.height+r;let c;return c=t.skewX===0&&t.skewY===0?new Ve(o*t.scaleX,l*t.scaleY):B_(o,l,dw(t)),c.scalarAdd(a)}translateToGivenOrigin(e,t,s,r,a){let o=e.x,l=e.y;const c=hi(r)-hi(t),u=hi(a)-hi(s);if(c||u){const d=this._getTransformedDimensions();o+=c*d.x,l+=u*d.y}return new Ve(o,l)}translateToCenterPoint(e,t,s){if(t===In&&s===In)return e;const r=this.translateToGivenOrigin(e,t,s,In,In);return this.angle?r.rotate(Mr(this.angle),e):r}translateToOriginPoint(e,t,s){const r=this.translateToGivenOrigin(e,In,In,t,s);return this.angle?r.rotate(Mr(this.angle),e):r}getCenterPoint(){const e=this.getRelativeCenterPoint();return this.group?Ta(e,this.group.calcTransformMatrix()):e}getRelativeCenterPoint(){return this.translateToCenterPoint(new Ve(this.left,this.top),this.originX,this.originY)}getPointByOrigin(e,t){return this.translateToOriginPoint(this.getRelativeCenterPoint(),e,t)}setPositionByOrigin(e,t,s){const r=this.translateToCenterPoint(e,t,s),a=this.translateToOriginPoint(r,this.originX,this.originY);this.set({left:a.x,top:a.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),ws,Uo)}}const KK=["type"],ZK=["extraParam"];let rd=class US extends YK{static getDefaults(){return US.ownDefaults}get type(){const e=this.constructor.type;return e==="FabricObject"?"object":e.toLowerCase()}set type(e){yd("warn","Setting type has no effect",e)}constructor(e){super(),ke(this,"_cacheContext",null),Object.assign(this,US.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=gh(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(e){const t=e.width,s=e.height,r=ds.maxCacheSideLimit,a=ds.minCacheSideLimit;if(t<=r&&s<=r&&t*s<=ds.perfLimitSizeTotal)return t<a&&(e.width=a),s<a&&(e.height=a),e;const o=t/s,[l,c]=lv.limitDimsByArea(o),u=Cm(a,l,r),d=Cm(a,c,r);return t>u&&(e.zoomX/=t/u,e.width=u,e.capped=!0),s>d&&(e.zoomY/=s/d,e.height=d,e.capped=!0),e}_getCacheCanvasDimensions(){const e=this.getTotalObjectScaling(),t=this._getTransformedDimensions({skewX:0,skewY:0}),s=t.x*e.x/this.scaleX,r=t.y*e.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(r+2),zoomX:e.x,zoomY:e.y,x:s,y:r}}_updateCacheCanvas(){const e=this._cacheCanvas,t=this._cacheContext,{width:s,height:r,zoomX:a,zoomY:o,x:l,y:c}=this._limitCacheSize(this._getCacheCanvasDimensions()),u=s!==e.width||r!==e.height,d=this.zoomX!==a||this.zoomY!==o;if(!e||!t)return!1;if(u||d){s!==e.width||r!==e.height?(e.width=s,e.height=r):(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height));const p=l/2,m=c/2;return this.cacheTranslationX=Math.round(e.width/2-p)+p,this.cacheTranslationY=Math.round(e.height/2-m)+m,t.translate(this.cacheTranslationX,this.cacheTranslationY),t.scale(a,o),this.zoomX=a,this.zoomY=o,!0}return!1}setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(e)}transform(e){const t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,s=this.calcTransformMatrix(!t);e.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new Ve(Math.abs(this.scaleX),Math.abs(this.scaleY));const e=xm(this.calcTransformMatrix());return new Ve(Math.abs(e.scaleX),Math.abs(e.scaleY))}getTotalObjectScaling(){const e=this.getObjectScaling();if(this.canvas){const t=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return e.scalarMultiply(t*s)}return e}getObjectOpacity(){let e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e}_constrainScale(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e===0?1e-4:e}_set(e,t){e!==ao&&e!==Ol||(t=this._constrainScale(t)),e===ao&&t<0?(this.flipX=!this.flipX,t*=-1):e==="scaleY"&&t<0?(this.flipY=!this.flipY,t*=-1):e!=="shadow"||!t||t instanceof lh||(t=new lh(t));const s=this[e]!==t;return this[e]=t,s&&this.constructor.cacheProperties.includes(e)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(e))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.drawObject(e,!1,{}),this.dirty=!1),e.restore())}drawSelectionBackground(e){}renderCache(e){if(e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:t,zoomY:s,cacheTranslationX:r,cacheTranslationY:a}=this,{width:o,height:l}=this._cacheCanvas;this.drawObject(this._cacheContext,e.forClipping,{zoomX:t,zoomY:s,cacheTranslationX:r,cacheTranslationY:a,width:o,height:l,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===so&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(e,t,s){e.save(),t.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",e.setTransform(1,0,0,1,0,0),e.drawImage(s,0,0),e.restore()}drawObject(e,t,s){const r=this.fill,a=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath,s),this.fill=r,this.stroke=a}createClipPathLayer(e,t){const s=Dl(t),r=s.getContext("2d");if(r.translate(t.cacheTranslationX,t.cacheTranslationY),r.scale(t.zoomX,t.zoomY),e._cacheCanvas=s,t.parentClipPaths.forEach((a=>{a.transform(r)})),t.parentClipPaths.push(e),e.absolutePositioned){const a=jo(this.calcTransformMatrix());r.transform(a[0],a[1],a[2],a[3],a[4],a[5])}return e.transform(r),e.drawObject(r,!0,t),s}_drawClipPath(e,t,s){if(!t)return;t._transformDone=!0;const r=this.createClipPathLayer(t,s);this.drawClipPathOnCache(e,t,r)}drawCacheOnCanvas(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const t=this._cacheCanvas,s=this._cacheContext;return!(!t||!s||e||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(t&&s&&!e&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),s.restore()),!0)}_renderBackground(e){if(!this.backgroundColor)return;const t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}_setOpacity(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity}_setStrokeStyles(e,t){const s=t.stroke;s&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,uc(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(e,s):(e.strokeStyle=s.toLive(e),this._applyPatternGradientTransform(e,s)):e.strokeStyle=t.stroke)}_setFillStyles(e,t){let{fill:s}=t;s&&(uc(s)?(e.fillStyle=s.toLive(e),this._applyPatternGradientTransform(e,s)):e.fillStyle=s)}_setClippingProperties(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"}_setLineDash(e,t){t&&t.length!==0&&e.setLineDash(t)}_setShadow(e){if(!this.shadow)return;const t=this.shadow,s=this.canvas,r=this.getCanvasRetinaScaling(),[a,,,o]=s?.viewportTransform||io,l=a*r,c=o*r,u=t.nonScaling?new Ve(1,1):this.getObjectScaling();e.shadowColor=t.color,e.shadowBlur=t.blur*ds.browserShadowBlurConstant*(l+c)*(u.x+u.y)/4,e.shadowOffsetX=t.offsetX*l*u.x,e.shadowOffsetY=t.offsetY*c*u.y}_removeShadow(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)}_applyPatternGradientTransform(e,t){if(!uc(t))return{offsetX:0,offsetY:0};const s=t.gradientTransform||t.patternTransform,r=-this.width/2+t.offsetX||0,a=-this.height/2+t.offsetY||0;return t.gradientUnits==="percentage"?e.transform(this.width,0,0,this.height,r,a):e.transform(1,0,0,1,r,a),s&&e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:r,offsetY:a}}_renderPaintInOrder(e){this.paintFirst===so?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))}_render(e){}_renderFill(e){this.fill&&(e.save(),this._setFillStyles(e,this),this.fillRule==="evenodd"?e.fill("evenodd"):e.fill(),e.restore())}_renderStroke(e){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform){const t=this.getObjectScaling();e.scale(1/t.x,1/t.y)}this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}}_applyPatternForTransformedGradient(e,t){var s;const r=this._limitCacheSize(this._getCacheCanvasDimensions()),a=this.getCanvasRetinaScaling(),o=r.x/this.scaleX/a,l=r.y/this.scaleY/a,c=Dl({width:Math.ceil(o),height:Math.ceil(l)}),u=c.getContext("2d");u&&(u.beginPath(),u.moveTo(0,0),u.lineTo(o,0),u.lineTo(o,l),u.lineTo(0,l),u.closePath(),u.translate(o/2,l/2),u.scale(r.zoomX/this.scaleX/a,r.zoomY/this.scaleY/a),this._applyPatternGradientTransform(u,t),u.fillStyle=t.toLive(e),u.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(a*this.scaleX/r.zoomX,a*this.scaleY/r.zoomY),e.strokeStyle=(s=u.createPattern(c,"no-repeat"))!==null&&s!==void 0?s:"")}_findCenterFromElement(){return new Ve(this.left+this.width/2,this.top+this.height/2)}clone(e){const t=this.toObject(e);return this.constructor.fromObject(t)}cloneAsImage(e){const t=this.toCanvasElement(e);return new(Nt.getClass("image"))(t)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=yO(this),s=this.group,r=this.shadow,a=Math.abs,o=e.enableRetinaScaling?Tj():1,l=(e.multiplier||1)*o,c=e.canvasProvider||(C=>new gO(C,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,e.withoutTransform&&Hj(this),e.withoutShadow&&(this.shadow=null),e.viewportTransform&&hE(this,this.getViewportTransform()),this.setCoords();const u=gh(),d=this.getBoundingRect(),p=this.shadow,m=new Ve;if(p){const C=p.blur,A=p.nonScaling?new Ve(1,1):this.getObjectScaling();m.x=2*Math.round(a(p.offsetX)+C)*a(A.x),m.y=2*Math.round(a(p.offsetY)+C)*a(A.y)}const g=d.width+m.x,b=d.height+m.y;u.width=Math.ceil(g),u.height=Math.ceil(b);const v=c(u);e.format==="jpeg"&&(v.backgroundColor="#fff"),this.setPositionByOrigin(new Ve(v.width/2,v.height/2),In,In);const x=this.canvas;v._objects=[this],this.set("canvas",v),this.setCoords();const S=v.toCanvasElement(l||1,e);return this.set("canvas",x),this.shadow=r,s&&(this.group=s),this.set(t),this.setCoords(),v._objects=[],v.destroy(),S}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hO(this.toCanvasElement(e),e.format||"png",e.quality||1)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return dO(this.toCanvasElement(e),e.format||"png",e.quality||1)}isType(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.includes(this.constructor.type)||t.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(e){const{centeredRotation:t,originX:s,originY:r}=this;if(t){const{x:a,y:o}=this.getRelativeCenterPoint();this.originX=In,this.originY=In,this.left=a,this.top=o}if(this.set("angle",e),t){const{x:a,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,r);this.left=a,this.top=o,this.originX=s,this.originY=r}}setOnGroup(){}_setupCompositeOperation(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}dispose(){vC.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&mh().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(e,t){return Object.entries(e).reduce(((s,r)=>{let[a,o]=r;return s[a]=this._animate(a,o,t),s}),{})}_animate(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=e.split("."),a=this.constructor.colorProperties.includes(r[r.length-1]),{abort:o,startValue:l,onChange:c,onComplete:u}=s,d=Ie(Ie({},s),{},{target:this,startValue:l??r.reduce(((p,m)=>p[m]),this),endValue:t,abort:o?.bind(this),onChange:(p,m,g)=>{r.reduce(((b,v,x)=>(x===r.length-1&&(b[v]=p),b[v])),this),c&&c(p,m,g)},onComplete:(p,m,g)=>{this.setCoords(),u&&u(p,m,g)}});return a?a8(d):CO(d)}isDescendantOf(e){const{parent:t,group:s}=this;return t===e||s===e||!!t&&t.isDescendantOf(e)||!!s&&s!==t&&s.isDescendantOf(e)}getAncestors(){const e=[];let t=this;do t=t.parent,t&&e.push(t);while(t);return e}findCommonAncestors(e){if(this===e)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const t=this.getAncestors(),s=e.getAncestors();if(t.length===0&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[e,...s.slice(0,s.length-1)],common:[this]};for(let r,a=0;a<t.length;a++){if(r=t[a],r===e)return{fork:[this,...t.slice(0,a)],otherFork:[],common:t.slice(a)};for(let o=0;o<s.length;o++){if(this===s[o])return{fork:[],otherFork:[e,...s.slice(0,o)],common:[this,...t]};if(r===s[o])return{fork:[this,...t.slice(0,a)],otherFork:[e,...s.slice(0,o)],common:t.slice(a)}}}return{fork:[this,...t],otherFork:[e,...s],common:[]}}hasCommonAncestors(e){const t=this.findCommonAncestors(e);return t&&!!t.common.length}isInFrontOf(e){if(this===e)return;const t=this.findCommonAncestors(e);if(t.fork.includes(e))return!0;if(t.otherFork.includes(this))return!1;const s=t.common[0]||this.canvas;if(!s)return;const r=t.fork.pop(),a=t.otherFork.pop(),o=s._objects.indexOf(r),l=s._objects.indexOf(a);return o>-1&&o>l}toObject(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(US.customProperties,this.constructor.customProperties||[]);let t;const s=ds.NUM_FRACTION_DIGITS,{clipPath:r,fill:a,stroke:o,shadow:l,strokeDashArray:c,left:u,top:d,originX:p,originY:m,width:g,height:b,strokeWidth:v,strokeLineCap:x,strokeDashOffset:S,strokeLineJoin:C,strokeUniform:A,strokeMiterLimit:k,scaleX:O,scaleY:F,angle:$,flipX:M,flipY:R,opacity:z,visible:I,backgroundColor:j,fillRule:H,paintFirst:q,globalCompositeOperation:re,skewX:X,skewY:ne}=this;r&&!r.excludeFromExport&&(t=r.toObject(e.concat("inverted","absolutePositioned")));const Q=ye=>Hs(ye,s),he=Ie(Ie({},Ym(this,e)),{},{type:this.constructor.type,version:lE,originX:p,originY:m,left:Q(u),top:Q(d),width:Q(g),height:Q(b),fill:ZP(a)?a.toObject():a,stroke:ZP(o)?o.toObject():o,strokeWidth:Q(v),strokeDashArray:c&&c.concat(),strokeLineCap:x,strokeDashOffset:S,strokeLineJoin:C,strokeUniform:A,strokeMiterLimit:Q(k),scaleX:Q(O),scaleY:Q(F),angle:Q($),flipX:M,flipY:R,opacity:Q(z),shadow:l&&l.toObject(),visible:I,backgroundColor:j,fillRule:H,paintFirst:q,globalCompositeOperation:re,skewX:Q(X),skewY:Q(ne)},t?{clipPath:t}:null);return this.includeDefaultValues?he:this._removeDefaultValues(he)}toDatalessObject(e){return this.toObject(e)}_removeDefaultValues(e){const t=this.constructor.getDefaults(),s=Object.keys(t).length>0?t:Object.getPrototypeOf(this);return mO(e,((r,a)=>{if(a===ws||a===Uo||a==="type")return!0;const o=s[a];return r!==o&&!(Array.isArray(r)&&Array.isArray(o)&&r.length===0&&o.length===0)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(e){let t=ar(e,KK),s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:r}=s,a=ar(s,ZK);return fw(t,a).then((o=>r?(delete o[r],new this(t[r],o)):new this(o)))}static fromObject(e,t){return this._fromObject(e,t)}};ke(rd,"stateProperties",PK),ke(rd,"cacheProperties",Ad),ke(rd,"ownDefaults",zK),ke(rd,"type","FabricObject"),ke(rd,"colorProperties",[mi,so,"backgroundColor"]),ke(rd,"customProperties",[]),Nt.setClass(rd),Nt.setClass(rd,"object");const h1=(n,e,t)=>(s,r,a,o)=>{const l=e(s,r,a,o);return l&&qj(n,Ie(Ie({},Yj(s,r,a,o)),t)),l};function d1(n){return(e,t,s,r)=>{const{target:a,originX:o,originY:l}=t,c=a.getRelativeCenterPoint(),u=a.translateToOriginPoint(c,o,l),d=n(e,t,s,r);return a.setPositionByOrigin(u,t.originX,t.originY),d}}const m6=h1(xv,d1(((n,e,t,s)=>{const r=bO(e,e.originX,e.originY,t,s);if(hi(e.originX)===hi(In)||hi(e.originX)===hi(Yr)&&r.x<0||hi(e.originX)===hi(ws)&&r.x>0){const{target:a}=e,o=a.strokeWidth/(a.strokeUniform?a.scaleX:1),l=Xj(e)?2:1,c=a.width,u=Math.abs(r.x*l/a.scaleX)-o;return a.set("width",Math.max(u,1)),c!==a.width}return!1})));function JK(n,e,t,s,r){s=s||{};const a=this.sizeX||s.cornerSize||r.cornerSize,o=this.sizeY||s.cornerSize||r.cornerSize,l=s.transparentCorners!==void 0?s.transparentCorners:r.transparentCorners,c=l?so:mi,u=!l&&(s.cornerStrokeColor||r.cornerStrokeColor);let d,p=e,m=t;n.save(),n.fillStyle=s.cornerColor||r.cornerColor||"",n.strokeStyle=s.cornerStrokeColor||r.cornerStrokeColor||"",a>o?(d=a,n.scale(1,o/a),m=t*a/o):o>a?(d=o,n.scale(a/o,1),p=e*o/a):d=a,n.beginPath(),n.arc(p,m,d/2,0,bd,!1),n[c](),u&&n.stroke(),n.restore()}function QK(n,e,t,s,r){s=s||{};const a=this.sizeX||s.cornerSize||r.cornerSize,o=this.sizeY||s.cornerSize||r.cornerSize,l=s.transparentCorners!==void 0?s.transparentCorners:r.transparentCorners,c=l?so:mi,u=!l&&(s.cornerStrokeColor||r.cornerStrokeColor),d=a/2,p=o/2;n.save(),n.fillStyle=s.cornerColor||r.cornerColor||"",n.strokeStyle=s.cornerStrokeColor||r.cornerStrokeColor||"",n.translate(e,t);const m=r.getTotalAngle();n.rotate(Mr(m)),n["".concat(c,"Rect")](-d,-p,a,o),u&&n.strokeRect(-d,-p,a,o),n.restore()}class Ei{constructor(e){ke(this,"visible",!0),ke(this,"actionName",M_),ke(this,"angle",0),ke(this,"x",0),ke(this,"y",0),ke(this,"offsetX",0),ke(this,"offsetY",0),ke(this,"sizeX",0),ke(this,"sizeY",0),ke(this,"touchSizeX",0),ke(this,"touchSizeY",0),ke(this,"cursorStyle","crosshair"),ke(this,"withConnection",!1),Object.assign(this,e)}shouldActivate(e,t,s,r){var a;let{tl:o,tr:l,br:c,bl:u}=r;return((a=t.canvas)===null||a===void 0?void 0:a.getActiveObject())===t&&t.isControlVisible(e)&&_r.isPointInPolygon(s,[o,l,c,u])}getActionHandler(e,t,s){return this.actionHandler}getMouseDownHandler(e,t,s){return this.mouseDownHandler}getMouseUpHandler(e,t,s){return this.mouseUpHandler}cursorStyleHandler(e,t,s){return t.cursorStyle}getActionName(e,t,s){return t.actionName}getVisibility(e,t){var s,r;return(s=(r=e._controlsVisibility)===null||r===void 0?void 0:r[t])!==null&&s!==void 0?s:this.visible}setVisibility(e,t,s){this.visible=e}positionHandler(e,t,s,r){return new Ve(this.x*e.x+this.offsetX,this.y*e.y+this.offsetY).transform(t)}calcCornerCoords(e,t,s,r,a,o){const l=P_([u1(s,r),Xm({angle:e}),z_((a?this.touchSizeX:this.sizeX)||t,(a?this.touchSizeY:this.sizeY)||t)]);return{tl:new Ve(-.5,-.5).transform(l),tr:new Ve(.5,-.5).transform(l),br:new Ve(.5,.5).transform(l),bl:new Ve(-.5,.5).transform(l)}}render(e,t,s,r,a){((r=r||{}).cornerStyle||a.cornerStyle)==="circle"?JK.call(this,e,t,s,r,a):QK.call(this,e,t,s,r,a)}}const eZ=(n,e,t)=>t.lockRotation?xC:e.cursorStyle,tZ=h1(Aj,d1(((n,e,t,s)=>{let{target:r,ex:a,ey:o,theta:l,originX:c,originY:u}=e;const d=r.translateToOriginPoint(r.getRelativeCenterPoint(),c,u);if(au(r,"lockRotation"))return!1;const p=Math.atan2(o-d.y,a-d.x),m=Math.atan2(s-d.y,t-d.x);let g=yh(m-p+l);if(r.snapAngle&&r.snapAngle>0){const v=r.snapAngle,x=r.snapThreshold||v,S=Math.ceil(g/v)*v,C=Math.floor(g/v)*v;Math.abs(g-C)<x?g=C:Math.abs(g-S)<x&&(g=S)}g<0&&(g=360+g),g%=360;const b=r.angle!==g;return r.angle=g,b})));function o8(n,e){const t=e.canvas,s=n[t.uniScaleKey];return t.uniformScaling&&!s||!t.uniformScaling&&s}function l8(n,e,t){const s=au(n,"lockScalingX"),r=au(n,"lockScalingY");if(s&&r||!e&&(s||r)&&t||s&&e==="x"||r&&e==="y")return!0;const{width:a,height:o,strokeWidth:l}=n;return a===0&&l===0&&e!=="y"||o===0&&l===0&&e!=="x"}const nZ=["e","se","s","sw","w","nw","n","ne","e"],$b=(n,e,t)=>{const s=o8(n,t);if(l8(t,e.x!==0&&e.y===0?"x":e.x===0&&e.y!==0?"y":"",s))return xC;const r=Kj(t,e);return"".concat(nZ[r],"-resize")};function _O(n,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const a=e.target,o=r.by,l=o8(n,a);let c,u,d,p,m,g;if(l8(a,o,l))return!1;if(e.gestureScale)u=e.scaleX*e.gestureScale,d=e.scaleY*e.gestureScale;else{if(c=bO(e,e.originX,e.originY,t,s),m=o!=="y"?Math.sign(c.x||e.signX||1):1,g=o!=="x"?Math.sign(c.y||e.signY||1):1,e.signX||(e.signX=m),e.signY||(e.signY=g),au(a,"lockScalingFlip")&&(e.signX!==m||e.signY!==g))return!1;if(p=a._getTransformedDimensions(),l&&!o){const x=Math.abs(c.x)+Math.abs(c.y),{original:S}=e,C=x/(Math.abs(p.x*S.scaleX/a.scaleX)+Math.abs(p.y*S.scaleY/a.scaleY));u=S.scaleX*C,d=S.scaleY*C}else u=Math.abs(c.x*a.scaleX/p.x),d=Math.abs(c.y*a.scaleY/p.y);Xj(e)&&(u*=2,d*=2),e.signX!==m&&o!=="y"&&(e.originX=t6(e.originX),u*=-1,e.signX=m),e.signY!==g&&o!=="x"&&(e.originY=t6(e.originY),d*=-1,e.signY=g)}const b=a.scaleX,v=a.scaleY;return o?(o==="x"&&a.set(ao,u),o==="y"&&a.set(Ol,d)):(!au(a,"lockScalingX")&&a.set(ao,u),!au(a,"lockScalingY")&&a.set(Ol,d)),b!==a.scaleX||v!==a.scaleY}const aS=h1(F_,d1(((n,e,t,s)=>_O(n,e,t,s)))),sZ=h1(F_,d1(((n,e,t,s)=>_O(n,e,t,s,{by:"x"})))),rZ=h1(F_,d1(((n,e,t,s)=>_O(n,e,t,s,{by:"y"})))),iZ=["target","ex","ey","skewingSide"],i5={x:{counterAxis:"y",scale:ao,skew:l1,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:Ol,skew:c1,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},aZ=["ns","nesw","ew","nwse"],oZ=(n,e,t)=>{if(e.x!==0&&au(t,"lockSkewingY")||e.y!==0&&au(t,"lockSkewingX"))return xC;const s=Kj(t,e)%4;return"".concat(aZ[s],"-resize")};function c8(n,e,t,s,r){const{target:a}=t,{counterAxis:o,origin:l,lockSkewing:c,skew:u,flip:d}=i5[n];if(au(a,c))return!1;const{origin:p,flip:m}=i5[o],g=hi(t[p])*(a[m]?-1:1),b=-Math.sign(g)*(a[d]?-1:1),v=.5*-((a[u]===0&&bO(t,In,In,s,r)[n]>0||a[u]>0?1:-1)*b)+.5;return h1(Ej,d1(((S,C,A,k)=>(function(O,F,$){let{target:M,ex:R,ey:z,skewingSide:I}=F,j=ar(F,iZ);const{skew:H}=i5[O],q=$.subtract(new Ve(R,z)).divide(new Ve(M.scaleX,M.scaleY))[O],re=M[H],X=j[H],ne=Math.tan(Mr(X)),Q=O==="y"?M._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:M._getTransformedDimensions({scaleX:1,scaleY:1}).y,he=2*q*I/Math.max(Q,1)+ne,ye=yh(Math.atan(he));M.set(H,ye);const Y=re!==M[H];if(Y&&O==="y"){const{skewX:B,scaleX:G}=M,J=M._getTransformedDimensions({skewY:re}),oe=M._getTransformedDimensions(),de=B!==0?J.x/oe.x:1;de!==1&&M.set(ao,de*G)}return Y})(n,C,new Ve(A,k)))))(e,Ie(Ie({},t),{},{[l]:v,skewingSide:b}),s,r)}const lZ=(n,e,t,s)=>c8("x",n,e,t,s),cZ=(n,e,t,s)=>c8("y",n,e,t,s);function V_(n,e){return n[e.canvas.altActionKey]}const oS=(n,e,t)=>{const s=V_(n,t);return e.x===0?s?l1:Ol:e.y===0?s?c1:ao:""},v0=(n,e,t)=>V_(n,t)?oZ(0,e,t):$b(n,e,t),g6=(n,e,t,s)=>V_(n,e.target)?cZ(n,e,t,s):sZ(n,e,t,s),y6=(n,e,t,s)=>V_(n,e.target)?lZ(n,e,t,s):rZ(n,e,t,s),u8=()=>({ml:new Ei({x:-.5,y:0,cursorStyleHandler:v0,actionHandler:g6,getActionName:oS}),mr:new Ei({x:.5,y:0,cursorStyleHandler:v0,actionHandler:g6,getActionName:oS}),mb:new Ei({x:0,y:.5,cursorStyleHandler:v0,actionHandler:y6,getActionName:oS}),mt:new Ei({x:0,y:-.5,cursorStyleHandler:v0,actionHandler:y6,getActionName:oS}),tl:new Ei({x:-.5,y:-.5,cursorStyleHandler:$b,actionHandler:aS}),tr:new Ei({x:.5,y:-.5,cursorStyleHandler:$b,actionHandler:aS}),bl:new Ei({x:-.5,y:.5,cursorStyleHandler:$b,actionHandler:aS}),br:new Ei({x:.5,y:.5,cursorStyleHandler:$b,actionHandler:aS}),mtr:new Ei({x:0,y:-.5,actionHandler:tZ,cursorStyleHandler:eZ,offsetY:-40,withConnection:!0,actionName:cO})}),uZ=()=>({mr:new Ei({x:.5,y:0,actionHandler:m6,cursorStyleHandler:v0,actionName:xv}),ml:new Ei({x:-.5,y:0,actionHandler:m6,cursorStyleHandler:v0,actionName:xv})}),hZ=()=>Ie(Ie({},u8()),uZ());class Cv extends rd{static getDefaults(){return Ie(Ie({},super.getDefaults()),Cv.ownDefaults)}constructor(e){super(),Object.assign(this,this.constructor.createControls(),Cv.ownDefaults),this.setOptions(e)}static createControls(){return{controls:u8()}}_updateCacheCanvas(){const e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){const t=e._currentTransform,s=t.target,r=t.action;if(this===s&&r&&r.startsWith(M_))return!1}return super._updateCacheCanvas()}getActiveControl(){const e=this.__corner;return e?{key:e,control:this.controls[e],coord:this.oCoords[e]}:void 0}findControl(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let r=s.length-1;r>=0;r--){const[a,o]=s[r],l=this.controls[a];if(l.shouldActivate(a,this,e,t?o.touchCorner:o.corner))return this.__corner=a,{key:a,control:l,coord:this.oCoords[a]}}}calcOCoords(){const e=this.getViewportTransform(),t=this.getCenterPoint(),s=u1(t.x,t.y),r=Xm({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),a=ei(s,r),o=ei(e,a),l=ei(o,[1/e[0],0,0,1/e[3],0,0]),c=this.group?xm(this.calcTransformMatrix()):void 0;c&&(c.scaleX=Math.abs(c.scaleX),c.scaleY=Math.abs(c.scaleY));const u=this._calculateCurrentDimensions(c),d={};return this.forEachControl(((p,m)=>{const g=p.positionHandler(u,l,this,p);d[m]=Object.assign(g,this._calcCornerCoords(p,g))})),d}_calcCornerCoords(e,t){const s=this.getTotalAngle();return{corner:e.calcCornerCoords(s,this.cornerSize,t.x,t.y,!1,this),touchCorner:e.calcCornerCoords(s,this.touchCornerSize,t.x,t.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(e){for(const t in this.controls)e(this.controls[t],t,this)}drawSelectionBackground(e){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;e.save();const t=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),r=this.getViewportTransform();e.translate(t.x,t.y),e.scale(1/r[0],1/r[3]),e.rotate(Mr(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-s.x/2,-s.y/2,s.x,s.y),e.restore()}strokeBorders(e,t){e.strokeRect(-t.x/2,-t.y/2,t.x,t.y)}_drawBorders(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Ie({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);e.save(),e.strokeStyle=r.borderColor,this._setLineDash(e,r.borderDashArray),this.strokeBorders(e,t),r.hasControls&&this.drawControlsConnectingLines(e,t),e.restore()}_renderControls(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:s,hasControls:r}=this,a=Ie({hasBorders:s,hasControls:r},t),o=this.getViewportTransform(),l=a.hasBorders,c=a.hasControls,u=ei(o,this.calcTransformMatrix()),d=xm(u);e.save(),e.translate(d.translateX,d.translateY),e.lineWidth=this.borderScaleFactor,this.group===this.parent&&(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(d.angle-=180),e.rotate(Mr(this.group?d.angle:this.angle)),l&&this.drawBorders(e,d,t),c&&this.drawControls(e,t),e.restore()}drawBorders(e,t,s){let r;if(s&&s.forActiveSelection||this.group){const a=B_(this.width,this.height,dw(t)),o=this.isStrokeAccountedForInDimensions()?uO:(this.strokeUniform?new Ve().scalarAdd(this.canvas?this.canvas.getZoom():1):new Ve(t.scaleX,t.scaleY)).scalarMultiply(this.strokeWidth);r=a.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else r=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(e,r,s)}drawControlsConnectingLines(e,t){let s=!1;e.beginPath(),this.forEachControl(((r,a)=>{r.withConnection&&r.getVisibility(this,a)&&(s=!0,e.moveTo(r.x*t.x,r.y*t.y),e.lineTo(r.x*t.x+r.offsetX,r.y*t.y+r.offsetY))})),s&&e.stroke()}drawControls(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:a,cornerColor:o}=this,l=Ie({cornerStrokeColor:r,cornerDashArray:a,cornerColor:o},t);e.setTransform(s,0,0,s,0,0),e.strokeStyle=e.fillStyle=l.cornerColor,this.transparentCorners||(e.strokeStyle=l.cornerStrokeColor),this._setLineDash(e,l.cornerDashArray),this.forEachControl(((c,u)=>{if(c.getVisibility(this,u)){const d=this.oCoords[u];c.render(e,d.x,d.y,l,this)}})),e.restore()}isControlVisible(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)}setControlVisible(e,t){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t}setControlsVisibility(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(e).forEach((t=>{let[s,r]=t;return this.setControlVisible(s,r)}))}clearContextTop(e){if(!this.canvas)return;const t=this.canvas.contextTop;if(!t)return;const s=this.canvas.viewportTransform;t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(t);const r=this.width+4,a=this.height+4;return t.clearRect(-r/2,-a/2,r,a),e||t.restore(),t}onDeselect(e){return!1}onSelect(e){return!1}shouldStartDragging(e){return!1}onDragStart(e){return!1}canDrop(e){return!1}renderDragSourceEffect(e){}renderDropTargetEffect(e){}}function h8(n,e){return e.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((s=>{s!=="constructor"&&Object.defineProperty(n.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}))})),n}ke(Cv,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Da extends Cv{}h8(Da,[Zj]),Nt.setClass(Da),Nt.setClass(Da,"object");const d8=(n,e,t,s)=>{const r=2*(s=Math.round(s))+1,{data:a}=n.getImageData(e-s,t-s,r,r);for(let o=3;o<a.length;o+=4)if(a[o]>0)return!1;return!0};class f8{constructor(e){this.options=e,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new Ve(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new Ve(1/this.options.scaleX,1/this.options.scaleY):new Ve(1,1)}createSideVector(e,t){const s=_C(e,t);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(e,t,s){return this.applySkew(e.add(this.calcOrthogonalProjection(e,t,s)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(e){const t=new Ve(e);return t.y+=t.x*Math.tan(Mr(this.options.skewY)),t.x+=t.y*Math.tan(Mr(this.options.skewX)),t}scaleUnitVector(e,t){return e.multiply(this.strokeUniformScalar).scalarMultiply(t)}}const dZ=new Ve;class T0 extends f8{static getOrthogonalRotationFactor(e,t){const s=t?TC(e,t):s8(e);return Math.abs(s)<jf?-1:1}constructor(e,t,s,r){super(r),ke(this,"AB",void 0),ke(this,"AC",void 0),ke(this,"alpha",void 0),ke(this,"bisector",void 0),this.A=new Ve(e),this.B=new Ve(t),this.C=new Ve(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=TC(this.AB,this.AC),this.bisector=U_(wO(this.AB.eq(dZ)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(e,t),a=xO(r),o=T0.getOrthogonalRotationFactor(a,this.bisector);return this.scaleUnitVector(a,s*o)}projectBevel(){const e=[];return(this.alpha%bd==0?[this.B]:[this.B,this.C]).forEach((t=>{e.push(this.projectOrthogonally(this.A,t)),e.push(this.projectOrthogonally(this.A,t,-this.strokeProjectionMagnitude))})),e}projectMiter(){const e=[],t=Math.abs(this.alpha),s=1/Math.sin(t/2),r=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),a=this.options.strokeUniform?kC(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return kC(r)/this.strokeProjectionMagnitude<=a&&e.push(this.applySkew(this.A.add(r))),e.push(...this.projectBevel()),e}projectRoundNoSkew(e,t){const s=[],r=new Ve(T0.getOrthogonalRotationFactor(this.bisector),T0.getOrthogonalRotationFactor(new Ve(this.bisector.y,this.bisector.x)));return[new Ve(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r),new Ve(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r)].forEach((a=>{fE(a,e,t)&&s.push(this.A.add(a))})),s}projectRoundWithSkew(e,t){const s=[],{skewX:r,skewY:a,scaleX:o,scaleY:l,strokeUniform:c}=this.options,u=new Ve(Math.tan(Mr(r)),Math.tan(Mr(a))),d=this.strokeProjectionMagnitude,p=c?d/l/Math.sqrt(1/l**2+1/o**2*u.y**2):d/Math.sqrt(1+u.y**2),m=new Ve(Math.sqrt(Math.max(d**2-p**2,0)),p),g=c?d/Math.sqrt(1+u.x**2*(1/l)**2/(1/o+1/o*u.x*u.y)**2):d/Math.sqrt(1+u.x**2/(1+u.x*u.y)**2),b=new Ve(g,Math.sqrt(Math.max(d**2-g**2,0)));return[b,b.scalarMultiply(-1),m,m.scalarMultiply(-1)].map((v=>this.applySkew(c?v.multiply(this.strokeUniformScalar):v))).forEach((v=>{fE(v,e,t)&&s.push(this.applySkew(this.A).add(v))})),s}projectRound(){const e=[];e.push(...this.projectBevel());const t=this.alpha%bd==0,s=this.applySkew(this.A),r=e[t?0:2].subtract(s),a=e[t?1:0].subtract(s),o=t?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),l=k0(r,o)>0,c=l?r:a,u=l?a:r;return this.isSkewed()?e.push(...this.projectRoundWithSkew(c,u)):e.push(...this.projectRoundNoSkew(c,u)),e}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((e=>({originPoint:this.A,projectedPoint:e,angle:this.alpha,bisector:this.bisector})))}}class b6 extends f8{constructor(e,t,s){super(s),this.A=new Ve(e),this.T=new Ve(t)}calcOrthogonalProjection(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(e,t);return this.scaleUnitVector(xO(r),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const e=[];if(!this.isSkewed()&&this.A.eq(this.T)){const t=new Ve(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.applySkew(this.A.add(t)),this.applySkew(this.A.subtract(t)))}else e.push(...new T0(this.A,this.T,this.T,this.options).projectRound());return e}projectSquare(){const e=[];if(this.A.eq(this.T)){const t=new Ve(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.A.add(t),this.A.subtract(t))}else{const t=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector(U_(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),r=this.A.add(s);e.push(r.add(t),r.subtract(t))}return e.map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((e=>({originPoint:this.A,projectedPoint:e})))}}const p8=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const s=[];if(n.length===0)return s;const r=n.reduce(((a,o)=>(a[a.length-1].eq(o)||a.push(new Ve(o)),a)),[new Ve(n[0])]);if(r.length===1)t=!0;else if(!t){const a=r[0],o=((l,c)=>{for(let u=l.length-1;u>=0;u--)if(c(l[u],u,l))return u;return-1})(r,(l=>!l.eq(a)));r.splice(o+1)}return r.forEach(((a,o,l)=>{let c,u;o===0?(u=l[1],c=t?a:l[l.length-1]):o===l.length-1?(c=l[o-1],u=t?a:l[0]):(c=l[o-1],u=l[o+1]),t&&l.length===1?s.push(...new b6(a,a,e).project()):!t||o!==0&&o!==l.length-1?s.push(...new T0(a,c,u,e).project()):s.push(...new b6(a,o===0?u:c,e).project())})),s},kO=n=>{const e={};return Object.keys(n).forEach((t=>{e[t]={},Object.keys(n[t]).forEach((s=>{e[t][s]=Ie({},n[t][s])}))})),e},m8=n=>n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let Sb;const W_=n=>{if(Sb||Sb||(Sb="Intl"in o1()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),Sb){const e=Sb.segment(n);return Array.from(e).map((t=>{let{segment:s}=t;return s}))}return fZ(n)},fZ=n=>{const e=[];for(let t,s=0;s<n.length;s++)(t=pZ(n,s))!==!1&&e.push(t);return e},pZ=(n,e)=>{const t=n.charCodeAt(e);if(isNaN(t))return"";if(t<55296||t>57343)return n.charAt(e);if(55296<=t&&t<=56319){if(n.length<=e+1)throw"High surrogate without following low surrogate";const r=n.charCodeAt(e+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return n.charAt(e)+n.charAt(e+1)}if(e===0)throw"Low surrogate without preceding high surrogate";const s=n.charCodeAt(e-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1};var mZ=Object.freeze({__proto__:null,capitalize:function(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return"".concat(n.charAt(0).toUpperCase()).concat(e?n.slice(1):n.slice(1).toLowerCase())},escapeXml:m8,graphemeSplit:W_});const H_=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return n.fill!==e.fill||n.stroke!==e.stroke||n.strokeWidth!==e.strokeWidth||n.fontSize!==e.fontSize||n.fontFamily!==e.fontFamily||n.fontWeight!==e.fontWeight||n.fontStyle!==e.fontStyle||n.textDecorationThickness!==e.textDecorationThickness||n.textBackgroundColor!==e.textBackgroundColor||n.deltaY!==e.deltaY||t&&(n.overline!==e.overline||n.underline!==e.underline||n.linethrough!==e.linethrough)},g8=(n,e)=>{const t=e.split(`
`),s=[];let r=-1,a={};n=kO(n);for(let o=0;o<t.length;o++){const l=W_(t[o]);if(n[o])for(let c=0;c<l.length;c++){r++;const u=n[o][c];u&&Object.keys(u).length>0&&(H_(a,u,!0)?s.push({start:r,end:r+1,style:u}):s[s.length-1].end++),a=u||{}}else r+=l.length,a={}}return s},y8=(n,e)=>{if(!Array.isArray(n))return kO(n);const t=e.split(lO),s={};let r=-1,a=0;for(let o=0;o<t.length;o++){const l=W_(t[o]);for(let c=0;c<l.length;c++)r++,n[a]&&n[a].start<=r&&r<n[a].end&&(s[o]=s[o]||{},s[o][c]=Ie({},n[a].style),r===n[a].end-1&&a++)}return s},tp=["display","transform",mi,"fill-opacity","fill-rule","opacity",so,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function v6(n,e){const t=n.nodeName,s=n.getAttribute("class"),r=n.getAttribute("id"),a="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+t,"i"),e=e.replace(o,""),r&&e.length&&(o=new RegExp("#"+r+a,"i"),e=e.replace(o,"")),s&&e.length){const l=s.split(" ");for(let c=l.length;c--;)o=new RegExp("\\."+l[c]+a,"i"),e=e.replace(o,"")}return e.length===0}function gZ(n,e){let t=!0;const s=v6(n,e.pop());return s&&e.length&&(t=(function(r,a){let o,l=!0;for(;r.parentElement&&r.parentElement.nodeType===1&&a.length;)l&&(o=a.pop()),l=v6(r=r.parentElement,o);return a.length===0})(n,e)),s&&t&&e.length===0}const yZ=n=>{var e;return(e=RK[n])!==null&&e!==void 0?e:n},bZ=new RegExp("(".concat(ru,")"),"gi"),vZ=n=>SC(n.replace(bZ," $1 ").replace(/,/gi," "));var w6,x6,S6,C6,_6,k6,T6;const Qa="(".concat(ru,")"),wZ=String.raw(w6||(w6=_h(["(skewX)(",")"],["(skewX)\\(","\\)"])),Qa),xZ=String.raw(x6||(x6=_h(["(skewY)(",")"],["(skewY)\\(","\\)"])),Qa),SZ=String.raw(S6||(S6=_h(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Qa,Qa,Qa),CZ=String.raw(C6||(C6=_h(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Qa,Qa),_Z=String.raw(_6||(_6=_h(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Qa,Qa),kZ=String.raw(k6||(k6=_h(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Qa,Qa,Qa,Qa,Qa,Qa),TO="(?:".concat(kZ,"|").concat(_Z,"|").concat(SZ,"|").concat(CZ,"|").concat(wZ,"|").concat(xZ,")"),TZ="(?:".concat(TO,"*)"),NZ=String.raw(T6||(T6=_h(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),TZ),AZ=new RegExp(NZ),EZ=new RegExp(TO),IZ=new RegExp(TO,"g");function NC(n){const e=[];if(!(n=vZ(n).replace(/\s*([()])\s*/gi,"$1"))||n&&!AZ.test(n))return[...io];for(const t of n.matchAll(IZ)){const s=EZ.exec(t[0]);if(!s)continue;let r=io;const a=s.filter((b=>!!b)),[,o,...l]=a,[c,u,d,p,m,g]=l.map((b=>parseFloat(b)));switch(o){case"translate":r=u1(c,u);break;case cO:r=Xm({angle:c},{x:u,y:d});break;case M_:r=z_(c,u);break;case l1:r=fO(c);break;case c1:r=pO(c);break;case"matrix":r=[c,u,d,p,m,g]}e.push(r)}return P_(e)}function OZ(n,e,t,s){const r=Array.isArray(e);let a,o=e;if(n!==mi&&n!==so||e!==no){if(n==="strokeUniform")return e==="non-scaling-stroke";if(n==="strokeDashArray")o=e===no?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(n==="transformMatrix")o=t&&t.transformMatrix?ei(t.transformMatrix,NC(e)):NC(e);else if(n==="visible")o=e!==no&&e!=="hidden",t&&t.visible===!1&&(o=!1);else if(n==="opacity")o=parseFloat(e),t&&t.opacity!==void 0&&(o*=t.opacity);else if(n==="textAnchor")o=e==="start"?ws:e==="end"?Yr:In;else if(n==="charSpacing"||n===Sm)a=Ja(e,s)/s*1e3;else if(n==="paintFirst"){const l=e.indexOf(mi),c=e.indexOf(so);o=mi,(l>-1&&c>-1&&c<l||l===-1&&c>-1)&&(o=so)}else{if(n==="href"||n==="xlink:href"||n==="font"||n==="id")return e;if(n==="imageSmoothing")return e==="optimizeQuality";a=r?e.map(Ja):Ja(e,s)}}else o="";return!r&&isNaN(a)?o:a}function DZ(n,e){const t=n.match($K);if(!t)return;const s=t[1],r=t[3],a=t[4],o=t[5],l=t[6];s&&(e.fontStyle=s),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),a&&(e.fontSize=Ja(a)),l&&(e.fontFamily=l),o&&(e.lineHeight=o==="normal"?1:o)}function mE(n,e){n.replace(/;\s*$/,"").split(";").forEach((t=>{if(!t)return;const[s,r]=t.split(":");e[s.trim().toLowerCase()]=r.trim()}))}function $Z(n){const e={},t=n.getAttribute("style");return t&&(typeof t=="string"?mE(t,e):(function(s,r){Object.entries(s).forEach((a=>{let[o,l]=a;l!==void 0&&(r[o.toLowerCase()]=l)}))})(t,e)),e}const RZ={stroke:"strokeOpacity",fill:"fillOpacity"};function Ed(n,e,t){if(!n)return{};let s,r={},a=oO;n.parentNode&&c6.test(n.parentNode.nodeName)&&(r=Ed(n.parentElement,e,t),r.fontSize&&(s=a=Ja(r.fontSize)));const o=Ie(Ie(Ie({},e.reduce(((u,d)=>{const p=n.getAttribute(d);return p&&(u[d]=p),u}),{})),(function(u){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p={};for(const m in d)gZ(u,m.split(" "))&&(p=Ie(Ie({},p),d[m]));return p})(n,t)),$Z(n));o[n5]&&n.setAttribute(n5,o[n5]),o[t5]&&(s=Ja(o[t5],a),o[t5]="".concat(s));const l={};for(const u in o){const d=yZ(u),p=OZ(d,o[u],r,s);l[d]=p}l&&l.font&&DZ(l.font,l);const c=Ie(Ie({},r),l);return c6.test(n.nodeName)?c:(function(u){const d=Da.getDefaults();return Object.entries(RZ).forEach((p=>{let[m,g]=p;if(u[g]===void 0||u[m]==="")return;if(u[m]===void 0){if(!d[m])return;u[m]=d[m]}if(u[m].indexOf("url(")===0)return;const b=new Ho(u[m]);u[m]=b.setAlpha(Hs(b.getAlpha()*u[g],2)).toRgba()})),u})(c)}const LZ=["left","top","width","height","visible"],b8=["rx","ry"];class wl extends Da{static getDefaults(){return Ie(Ie({},super.getDefaults()),wl.ownDefaults)}constructor(e){super(),Object.assign(this,wl.ownDefaults),this.setOptions(e),this._initRxRy()}_initRxRy(){const{rx:e,ry:t}=this;e&&!t?this.ry=e:t&&!e&&(this.rx=t)}_render(e){const{width:t,height:s}=this,r=-t/2,a=-s/2,o=this.rx?Math.min(this.rx,t/2):0,l=this.ry?Math.min(this.ry,s/2):0,c=o!==0||l!==0;e.beginPath(),e.moveTo(r+o,a),e.lineTo(r+t-o,a),c&&e.bezierCurveTo(r+t-wf*o,a,r+t,a+wf*l,r+t,a+l),e.lineTo(r+t,a+s-l),c&&e.bezierCurveTo(r+t,a+s-wf*l,r+t-wf*o,a+s,r+t-o,a+s),e.lineTo(r+o,a+s),c&&e.bezierCurveTo(r+wf*o,a+s,r,a+s-wf*l,r,a+s-l),e.lineTo(r,a+l),c&&e.bezierCurveTo(r,a+wf*l,r+wf*o,a,r+o,a),e.closePath(),this._renderPaintInOrder(e)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...b8,...e])}_toSVG(){const{width:e,height:t,rx:s,ry:r}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-e/2,'" y="').concat(-t/2,'" rx="').concat(s,'" ry="').concat(r,'" width="').concat(e,'" height="').concat(t,`" />
`)]}static async fromElement(e,t,s){const r=Ed(e,this.ATTRIBUTE_NAMES,s),{left:a=0,top:o=0,width:l=0,height:c=0,visible:u=!0}=r,d=ar(r,LZ);return new this(Ie(Ie(Ie({},t),d),{},{left:a,top:o,width:l,height:c,visible:!!(u&&l&&c)}))}}ke(wl,"type","Rect"),ke(wl,"cacheProperties",[...Ad,...b8]),ke(wl,"ownDefaults",{rx:0,ry:0}),ke(wl,"ATTRIBUTE_NAMES",[...tp,"x","y","rx","ry","width","height"]),Nt.setClass(wl),Nt.setSVGClass(wl);const pd="initialization",AC="added",NO="removed",EC="imperative",v8=(n,e)=>{const{strokeUniform:t,strokeWidth:s,width:r,height:a,group:o}=e,l=o&&o!==n?pw(o.calcTransformMatrix(),n.calcTransformMatrix()):null,c=l?e.getRelativeCenterPoint().transform(l):e.getRelativeCenterPoint(),u=!e.isStrokeAccountedForInDimensions(),d=t&&u?Gj(new Ve(s,s),void 0,n.calcTransformMatrix()):uO,p=!t&&u?s:0,m=B_(r+p,a+p,P_([l,e.calcOwnMatrix()],!0)).add(d).scalarDivide(2);return[c.subtract(m),c.add(m)]};class G_{calcLayoutResult(e,t){if(this.shouldPerformLayout(e))return this.calcBoundingBox(t,e)}shouldPerformLayout(e){let{type:t,prevStrategy:s,strategy:r}=e;return t===pd||t===EC||!!s&&r!==s}shouldLayoutClipPath(e){let{type:t,target:{clipPath:s}}=e;return t!==pd&&s&&!s.absolutePositioned}getInitialSize(e,t){return t.size}calcBoundingBox(e,t){const{type:s,target:r}=t;if(s===EC&&t.overrides)return t.overrides;if(e.length===0)return;const{left:a,top:o,width:l,height:c}=oh(e.map((p=>v8(r,p))).reduce(((p,m)=>p.concat(m)),[])),u=new Ve(l,c),d=new Ve(a,o).add(u.scalarDivide(2));if(s===pd){const p=this.getInitialSize(t,{size:u,center:d});return{center:d,relativeCorrection:new Ve(0,0),size:p}}return{center:d.transform(r.calcOwnMatrix()),size:u}}}ke(G_,"type","strategy");class gE extends G_{shouldPerformLayout(e){return!0}}ke(gE,"type","fit-content"),Nt.setClass(gE);const FZ=["strategy"],MZ=["target","strategy","bubbles","prevStrategy"],w8="layoutManager";class _v{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new gE;ke(this,"strategy",void 0),this.strategy=e,this._subscriptions=new Map}performLayout(e){const t=Ie(Ie({bubbles:!0,strategy:this.strategy},e),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(t);const s=this.getLayoutResult(t);s&&this.commitLayout(t,s),this.onAfterLayout(t,s),this._prevLayoutStrategy=t.strategy}attachHandlers(e,t){const{target:s}=t;return[bC,Nj,xv,Aj,F_,Ej,yC,xK,SK].map((r=>e.on(r,(a=>this.performLayout(r===bC?{type:"object_modified",trigger:r,e:a,target:s}:{type:"object_modifying",trigger:r,e:a,target:s})))))}subscribe(e,t){this.unsubscribe(e,t);const s=this.attachHandlers(e,t);this._subscriptions.set(e,s)}unsubscribe(e,t){(this._subscriptions.get(e)||[]).forEach((s=>s())),this._subscriptions.delete(e)}unsubscribeTargets(e){e.targets.forEach((t=>this.unsubscribe(t,e)))}subscribeTargets(e){e.targets.forEach((t=>this.subscribe(t,e)))}onBeforeLayout(e){const{target:t,type:s}=e,{canvas:r}=t;if(s===pd||s===AC?this.subscribeTargets(e):s===NO&&this.unsubscribeTargets(e),t.fire("layout:before",{context:e}),r&&r.fire("object:layout:before",{target:t,context:e}),s===EC&&e.deep){const a=ar(e,FZ);t.forEachObject((o=>o.layoutManager&&o.layoutManager.performLayout(Ie(Ie({},a),{},{bubbles:!1,target:o}))))}}getLayoutResult(e){const{target:t,strategy:s,type:r}=e,a=s.calcLayoutResult(e,t.getObjects());if(!a)return;const o=r===pd?new Ve:t.getRelativeCenterPoint(),{center:l,correction:c=new Ve,relativeCorrection:u=new Ve}=a,d=o.subtract(l).add(c).transform(r===pd?io:jo(t.calcOwnMatrix()),!0).add(u);return{result:a,prevCenter:o,nextCenter:l,offset:d}}commitLayout(e,t){const{target:s}=e,{result:{size:r},nextCenter:a}=t;var o,l;s.set({width:r.x,height:r.y}),this.layoutObjects(e,t),e.type===pd?s.set({left:(o=e.x)!==null&&o!==void 0?o:a.x+r.x*hi(s.originX),top:(l=e.y)!==null&&l!==void 0?l:a.y+r.y*hi(s.originY)}):(s.setPositionByOrigin(a,In,In),s.setCoords(),s.set("dirty",!0))}layoutObjects(e,t){const{target:s}=e;s.forEachObject((r=>{r.group===s&&this.layoutObject(e,t,r)})),e.strategy.shouldLayoutClipPath(e)&&this.layoutObject(e,t,s.clipPath)}layoutObject(e,t,s){let{offset:r}=t;s.set({left:s.left+r.x,top:s.top+r.y})}onAfterLayout(e,t){const{target:s,strategy:r,bubbles:a,prevStrategy:o}=e,l=ar(e,MZ),{canvas:c}=s;s.fire("layout:after",{context:e,result:t}),c&&c.fire("object:layout:after",{context:e,result:t,target:s});const u=s.parent;a&&u!=null&&u.layoutManager&&((l.path||(l.path=[])).push(s),u.layoutManager.performLayout(Ie(Ie({},l),{},{target:u}))),s.set("dirty",!0)}dispose(){const{_subscriptions:e}=this;e.forEach((t=>t.forEach((s=>s())))),e.clear()}toObject(){return{type:w8,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}Nt.setClass(_v,w8);const PZ=["type","objects","layoutManager"];class zZ extends _v{performLayout(){}}class Al extends Ij(Da){static getDefaults(){return Ie(Ie({},super.getDefaults()),Al.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ke(this,"_activeObjects",[]),ke(this,"__objectSelectionTracker",void 0),ke(this,"__objectSelectionDisposer",void 0),Object.assign(this,Al.ownDefaults),this.setOptions(t),this.groupInit(e,t)}groupInit(e,t){var s;this._objects=[...e],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((r=>{this.enterGroup(r,!1)})),this.layoutManager=(s=t.layoutManager)!==null&&s!==void 0?s:new _v,this.layoutManager.performLayout({type:pd,target:this,targets:[...e],x:t.left,y:t.top})}canEnterGroup(e){return e===this||this.isDescendantOf(e)?(yd("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(e)===-1||(yd("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(e){return e.filter(((t,s,r)=>this.canEnterGroup(t)&&r.indexOf(t)===s))}add(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=this._filterObjectsBeforeEnteringGroup(t),a=super.add(...r);return this._onAfterObjectsChange(AC,r),a}insertAt(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const a=this._filterObjectsBeforeEnteringGroup(s),o=super.insertAt(e,...a);return this._onAfterObjectsChange(AC,a),o}remove(){const e=super.remove(...arguments);return this._onAfterObjectsChange(NO,e),e}_onObjectAdded(e){this.enterGroup(e,!0),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e,t){this.exitGroup(e,t),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onAfterObjectsChange(e,t){this.layoutManager.performLayout({type:e,targets:t,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(e,t){const s=this[e];return super._set(e,t),e==="canvas"&&s!==t&&(this._objects||[]).forEach((r=>{r._set(e,t)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(e,t){let{target:s}=t;const r=this._activeObjects;if(e)r.push(s),this._set("dirty",!0);else if(r.length>0){const a=r.indexOf(s);a>-1&&(r.splice(a,1),this._set("dirty",!0))}}_watchObject(e,t){e&&this._watchObject(!1,t),e?(t.on("selected",this.__objectSelectionTracker),t.on("deselected",this.__objectSelectionDisposer)):(t.off("selected",this.__objectSelectionTracker),t.off("deselected",this.__objectSelectionDisposer))}enterGroup(e,t){e.group&&e.group.remove(e),e._set("parent",this),this._enterGroup(e,t)}_enterGroup(e,t){t&&z0(e,ei(jo(this.calcTransformMatrix()),e.calcTransformMatrix())),this._shouldSetNestedCoords()&&e.setCoords(),e._set("group",this),e._set("canvas",this.canvas),this._watchObject(!0,e);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===e||e.isDescendantOf(s))&&this._activeObjects.push(e)}exitGroup(e,t){this._exitGroup(e,t),e._set("parent",void 0),e._set("canvas",void 0)}_exitGroup(e,t){e._set("group",void 0),t||(z0(e,ei(this.calcTransformMatrix(),e.calcTransformMatrix())),e.setCoords()),this._watchObject(!1,e);const s=this._activeObjects.length>0?this._activeObjects.indexOf(e):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const e=Da.prototype.shouldCache.call(this);if(e){for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1}return e}willDrawShadow(){if(super.willDrawShadow())return!0;for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(e,t,s){this._renderBackground(e);for(let a=0;a<this._objects.length;a++){var r;const o=this._objects[a];(r=this.canvas)!==null&&r!==void 0&&r.preserveObjectStacking&&o.group!==this?(e.save(),e.transform(...jo(this.calcTransformMatrix())),o.render(e),e.restore()):o.group===this&&o.render(e)}this._drawClipPath(e,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((e=>e.setCoords()))}triggerLayout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(Ie({target:this,type:EC},e))}render(e){this._transformDone=!0,super.render(e),this._transformDone=!1}__serializeObjects(e,t){const s=this.includeDefaultValues;return this._objects.filter((function(r){return!r.excludeFromExport})).map((function(r){const a=r.includeDefaultValues;r.includeDefaultValues=s;const o=r[e||"toObject"](t);return r.includeDefaultValues=a,o}))}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.layoutManager.toObject();return Ie(Ie(Ie({},super.toObject(["subTargetCheck","interactive",...e])),t.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:t}:{}),{},{objects:this.__serializeObjects("toObject",e)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((e=>{this._watchObject(!1,e),e.dispose()})),super.dispose()}_createSVGBgRect(e){if(!this.backgroundColor)return"";const t=wl.prototype._toSVG.call(this),s=t.indexOf("COMMON_PARTS");t[s]='for="group" ';const r=t.join("");return e?e(r):r}_toSVG(e){const t=["<g ","COMMON_PARTS",` >
`],s=this._createSVGBgRect(e);s&&t.push("		",s);for(let r=0;r<this._objects.length;r++)t.push("		",this._objects[r].toSVG(e));return t.push(`</g>
`),t}getSvgStyles(){const e=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")}toClipPathSVG(e){const t=[],s=this._createSVGBgRect(e);s&&t.push("	",s);for(let r=0;r<this._objects.length;r++)t.push("	",this._objects[r].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}static fromObject(e,t){let{type:s,objects:r=[],layoutManager:a}=e,o=ar(e,PZ);return Promise.all([M0(r,t),fw(o,t)]).then((l=>{let[c,u]=l;const d=new this(c,Ie(Ie(Ie({},o),u),{},{layoutManager:new zZ}));if(a){const p=Nt.getClass(a.type),m=Nt.getClass(a.strategy);d.layoutManager=new p(new m)}else d.layoutManager=new _v;return d.layoutManager.subscribeTargets({type:pd,target:d,targets:d.getObjects()}),d.setCoords(),d}))}}ke(Al,"type","Group"),ke(Al,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),Nt.setClass(Al);const x8=(n,e)=>Math.min(e.width/n.width,e.height/n.height),S8=(n,e)=>Math.max(e.width/n.width,e.height/n.height),yE="\\s*,?\\s*",Cb="".concat(yE,"(").concat(ru,")"),BZ="".concat(Cb).concat(Cb).concat(Cb).concat(yE,"([01])").concat(yE,"([01])").concat(Cb).concat(Cb),jZ={m:"l",M:"L"},UZ=(n,e,t,s,r,a,o,l,c,u,d)=>{const p=du(n),m=fu(n),g=du(e),b=fu(e),v=t*r*g-s*a*b+o,x=s*r*g+t*a*b+l;return["C",u+c*(-t*r*m-s*a*p),d+c*(-s*r*m+t*a*p),v+c*(t*r*b+s*a*g),x+c*(s*r*b-t*a*g),v,x]},N6=(n,e,t,s)=>{const r=Math.atan2(e,n),a=Math.atan2(s,t);return a>=r?a-r:2*Math.PI-(r-a)};function bE(n,e,t,s,r,a,o,l){let c;if(ds.cachesBoundsOfCurve&&(c=[...arguments].join(),lv.boundsOfCurveCache[c]))return lv.boundsOfCurveCache[c];const u=Math.sqrt,d=Math.abs,p=[],m=[[0,0],[0,0]];let g=6*n-12*t+6*r,b=-3*n+9*t-9*r+3*o,v=3*t-3*n;for(let k=0;k<2;++k){if(k>0&&(g=6*e-12*s+6*a,b=-3*e+9*s-9*a+3*l,v=3*s-3*e),d(b)<1e-12){if(d(g)<1e-12)continue;const R=-v/g;0<R&&R<1&&p.push(R);continue}const O=g*g-4*v*b;if(O<0)continue;const F=u(O),$=(-g+F)/(2*b);0<$&&$<1&&p.push($);const M=(-g-F)/(2*b);0<M&&M<1&&p.push(M)}let x=p.length;const S=x,C=_8(n,e,t,s,r,a,o,l);for(;x--;){const{x:k,y:O}=C(p[x]);m[0][x]=k,m[1][x]=O}m[0][S]=n,m[1][S]=e,m[0][S+1]=o,m[1][S+1]=l;const A=[new Ve(Math.min(...m[0]),Math.min(...m[1])),new Ve(Math.max(...m[0]),Math.max(...m[1]))];return ds.cachesBoundsOfCurve&&(lv.boundsOfCurveCache[c]=A),A}const VZ=(n,e,t)=>{let[s,r,a,o,l,c,u,d]=t;const p=((m,g,b,v,x,S,C)=>{if(b===0||v===0)return[];let A=0,k=0,O=0;const F=Math.PI,$=C*aO,M=fu($),R=du($),z=.5*(-R*m-M*g),I=.5*(-R*g+M*m),j=b**2,H=v**2,q=I**2,re=z**2,X=j*H-j*q-H*re;let ne=Math.abs(b),Q=Math.abs(v);if(X<0){const Fe=Math.sqrt(1-X/(j*H));ne*=Fe,Q*=Fe}else O=(x===S?-1:1)*Math.sqrt(X/(j*q+H*re));const he=O*ne*I/Q,ye=-O*Q*z/ne,Y=R*he-M*ye+.5*m,B=M*he+R*ye+.5*g;let G=N6(1,0,(z-he)/ne,(I-ye)/Q),J=N6((z-he)/ne,(I-ye)/Q,(-z-he)/ne,(-I-ye)/Q);S===0&&J>0?J-=2*F:S===1&&J<0&&(J+=2*F);const oe=Math.ceil(Math.abs(J/F*2)),de=[],ge=J/oe,Ae=8/3*Math.sin(ge/4)*Math.sin(ge/4)/Math.sin(ge/2);let Ce=G+ge;for(let Fe=0;Fe<oe;Fe++)de[Fe]=UZ(G,Ce,R,M,ne,Q,Y,B,Ae,A,k),A=de[Fe][5],k=de[Fe][6],G=Ce,Ce+=ge;return de})(u-n,d-e,r,a,l,c,o);for(let m=0,g=p.length;m<g;m++)p[m][1]+=n,p[m][2]+=e,p[m][3]+=n,p[m][4]+=e,p[m][5]+=n,p[m][6]+=e;return p},C8=n=>{let e=0,t=0,s=0,r=0;const a=[];let o,l=0,c=0;for(const u of n){const d=[...u];let p;switch(d[0]){case"l":d[1]+=e,d[2]+=t;case"L":e=d[1],t=d[2],p=["L",e,t];break;case"h":d[1]+=e;case"H":e=d[1],p=["L",e,t];break;case"v":d[1]+=t;case"V":t=d[1],p=["L",e,t];break;case"m":d[1]+=e,d[2]+=t;case"M":e=d[1],t=d[2],s=d[1],r=d[2],p=["M",e,t];break;case"c":d[1]+=e,d[2]+=t,d[3]+=e,d[4]+=t,d[5]+=e,d[6]+=t;case"C":l=d[3],c=d[4],e=d[5],t=d[6],p=["C",d[1],d[2],l,c,e,t];break;case"s":d[1]+=e,d[2]+=t,d[3]+=e,d[4]+=t;case"S":o==="C"?(l=2*e-l,c=2*t-c):(l=e,c=t),e=d[3],t=d[4],p=["C",l,c,d[1],d[2],e,t],l=p[3],c=p[4];break;case"q":d[1]+=e,d[2]+=t,d[3]+=e,d[4]+=t;case"Q":l=d[1],c=d[2],e=d[3],t=d[4],p=["Q",l,c,e,t];break;case"t":d[1]+=e,d[2]+=t;case"T":o==="Q"?(l=2*e-l,c=2*t-c):(l=e,c=t),e=d[1],t=d[2],p=["Q",l,c,e,t];break;case"a":d[6]+=e,d[7]+=t;case"A":VZ(e,t,d).forEach((m=>a.push(m))),e=d[6],t=d[7];break;case"z":case"Z":e=s,t=r,p=["Z"]}p?(a.push(p),o=p[0]):o=""}return a},IC=(n,e,t,s)=>Math.sqrt((t-n)**2+(s-e)**2),_8=(n,e,t,s,r,a,o,l)=>c=>{const u=c**3,d=(g=>3*g**2*(1-g))(c),p=(g=>3*g*(1-g)**2)(c),m=(g=>(1-g)**3)(c);return new Ve(o*u+r*d+t*p+n*m,l*u+a*d+s*p+e*m)},k8=n=>n**2,T8=n=>2*n*(1-n),N8=n=>(1-n)**2,WZ=(n,e,t,s,r,a,o,l)=>c=>{const u=k8(c),d=T8(c),p=N8(c),m=3*(p*(t-n)+d*(r-t)+u*(o-r)),g=3*(p*(s-e)+d*(a-s)+u*(l-a));return Math.atan2(g,m)},HZ=(n,e,t,s,r,a)=>o=>{const l=k8(o),c=T8(o),u=N8(o);return new Ve(r*l+t*c+n*u,a*l+s*c+e*u)},GZ=(n,e,t,s,r,a)=>o=>{const l=1-o,c=2*(l*(t-n)+o*(r-t)),u=2*(l*(s-e)+o*(a-s));return Math.atan2(u,c)},A6=(n,e,t)=>{let s=new Ve(e,t),r=0;for(let a=1;a<=100;a+=1){const o=n(a/100);r+=IC(s.x,s.y,o.x,o.y),s=o}return r},qZ=(n,e)=>{let t,s=0,r=0,a={x:n.x,y:n.y},o=Ie({},a),l=.01,c=0;const u=n.iterator,d=n.angleFinder;for(;r<e&&l>1e-4;)o=u(s),c=s,t=IC(a.x,a.y,o.x,o.y),t+r>e?(s-=l,l/=2):(a=o,s+=l,r+=t);return Ie(Ie({},o),{},{angle:d(c)})},AO=n=>{let e,t,s=0,r=0,a=0,o=0,l=0;const c=[];for(const u of n){const d={x:r,y:a,command:u[0],length:0};switch(u[0]){case"M":t=d,t.x=o=r=u[1],t.y=l=a=u[2];break;case"L":t=d,t.length=IC(r,a,u[1],u[2]),r=u[1],a=u[2];break;case"C":e=_8(r,a,u[1],u[2],u[3],u[4],u[5],u[6]),t=d,t.iterator=e,t.angleFinder=WZ(r,a,u[1],u[2],u[3],u[4],u[5],u[6]),t.length=A6(e,r,a),r=u[5],a=u[6];break;case"Q":e=HZ(r,a,u[1],u[2],u[3],u[4]),t=d,t.iterator=e,t.angleFinder=GZ(r,a,u[1],u[2],u[3],u[4]),t.length=A6(e,r,a),r=u[3],a=u[4];break;case"Z":t=d,t.destX=o,t.destY=l,t.length=IC(r,a,o,l),r=o,a=l}s+=t.length,c.push(t)}return c.push({length:s,x:r,y:a}),c},A8=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:AO(n),s=0;for(;e-t[s].length>0&&s<t.length-2;)e-=t[s].length,s++;const r=t[s],a=e/r.length,o=n[s];switch(r.command){case"M":return{x:r.x,y:r.y,angle:0};case"Z":return Ie(Ie({},new Ve(r.x,r.y).lerp(new Ve(r.destX,r.destY),a)),{},{angle:Math.atan2(r.destY-r.y,r.destX-r.x)});case"L":return Ie(Ie({},new Ve(r.x,r.y).lerp(new Ve(o[1],o[2]),a)),{},{angle:Math.atan2(o[2]-r.y,o[1]-r.x)});case"C":case"Q":return qZ(r,e)}},XZ=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),E6=new RegExp(BZ,"g"),YZ=new RegExp(ru,"gi"),KZ={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},E8=n=>{var e;const t=[],s=(e=n.match(XZ))!==null&&e!==void 0?e:[];for(const r of s){const a=r[0];if(a==="z"||a==="Z"){t.push([a]);continue}const o=KZ[a.toLowerCase()];let l=[];if(a==="a"||a==="A"){E6.lastIndex=0;for(let c=null;c=E6.exec(r);)l.push(...c.slice(1))}else l=r.match(YZ)||[];for(let c=0;c<l.length;c+=o){const u=new Array(o),d=jZ[a];u[0]=c>0&&d?d:a;for(let p=0;p<o;p++)u[p+1]=parseFloat(l[c+p]);t.push(u)}}return t},I8=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=new Ve(n[0]),s=new Ve(n[1]),r=1,a=0;const o=[],l=n.length,c=l>2;let u;for(c&&(r=n[2].x<s.x?-1:n[2].x===s.x?0:1,a=n[2].y<s.y?-1:n[2].y===s.y?0:1),o.push(["M",t.x-r*e,t.y-a*e]),u=1;u<l;u++){if(!t.eq(s)){const d=t.midPointFrom(s);o.push(["Q",t.x,t.y,d.x,d.y])}t=n[u],u+1<n.length&&(s=n[u+1])}return c&&(r=t.x>n[u-2].x?1:t.x===n[u-2].x?0:-1,a=t.y>n[u-2].y?1:t.y===n[u-2].y?0:-1),o.push(["L",t.x+r*e,t.y+a*e]),o},EO=(n,e)=>n.map((t=>t.map(((s,r)=>r===0||e===void 0?s:Hs(s,e))).join(" "))).join(" ");function OC(n,e){const t=n.style;t&&e&&(typeof e=="string"?t.cssText+=";"+e:Object.entries(e).forEach((s=>{let[r,a]=s;return t.setProperty(r,a)})))}const ZZ=(n,e)=>Math.floor(Math.random()*(e-n+1))+n;function O8(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.onComplete||cm,s=new(o1()).XMLHttpRequest,r=e.signal,a=function(){s.abort()},o=function(){r&&r.removeEventListener("abort",a),s.onerror=s.ontimeout=cm};if(r&&r.aborted)throw new iO("request");return r&&r.addEventListener("abort",a,{once:!0}),s.onreadystatechange=function(){s.readyState===4&&(o(),t(s),s.onreadystatechange=cm)},s.onerror=s.ontimeout=o,s.open("get",n,!0),s.send(),s}const VS=(n,e)=>{let t=n._findCenterFromElement();n.transformMatrix&&((s=>{if(s.transformMatrix){const{scaleX:r,scaleY:a,angle:o,skewX:l}=xm(s.transformMatrix);s.flipX=!1,s.flipY=!1,s.set(ao,r),s.set(Ol,a),s.angle=o,s.skewX=l,s.skewY=0}})(n),t=t.transform(n.transformMatrix)),delete n.transformMatrix,e&&(n.scaleX*=e.scaleX,n.scaleY*=e.scaleY,n.cropX=e.cropX,n.cropY=e.cropY,t.x+=e.offsetLeft,t.y+=e.offsetTop,n.width=e.width,n.height=e.height),n.setPositionByOrigin(t,In,In)};var fr=Object.freeze({__proto__:null,addTransformToObject:Wj,animate:CO,animateColor:a8,applyTransformToObject:z0,calcAngleBetweenVectors:TC,calcDimensionsMatrix:dw,calcPlaneChangeMatrix:pw,calcVectorRotation:s8,cancelAnimFrame:Dj,capValue:Cm,composeMatrix:Mj,copyCanvasElement:n=>{var e;const t=Dl(n);return(e=t.getContext("2d"))===null||e===void 0||e.drawImage(n,0,0),t},cos:du,createCanvasElement:gh,createImage:$j,createRotateMatrix:Xm,createScaleMatrix:z_,createSkewXMatrix:fO,createSkewYMatrix:pO,createTranslateMatrix:u1,createVector:_C,crossProduct:k0,degreesToRadians:Mr,dotProduct:r8,ease:BK,enlivenObjectEnlivables:fw,enlivenObjects:M0,findScaleToCover:S8,findScaleToFit:x8,getBoundsOfCurve:bE,getOrthonormalVector:xO,getPathSegmentsInfo:AO,getPointOnPath:A8,getPointer:Vj,getRandomInt:ZZ,getRegularPolygonPath:(n,e)=>{const t=2*Math.PI/n;let s=-jf;n%2==0&&(s+=t/2);const r=new Array(n+1);for(let a=0;a<n;a++){const o=a*t+s,{x:l,y:c}=new Ve(du(o),fu(o)).scalarMultiply(e);r[a]=[a===0?"M":"L",l,c]}return r[n]=["Z"],r},getSmoothPathFromPoints:I8,getSvgAttributes:n=>{const e=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"])}return e},getUnitVector:U_,groupSVGElements:(n,e)=>n&&n.length===1?n[0]:new Al(n,e),hasStyleChanged:H_,invertTransform:jo,isBetweenVectors:fE,isIdentityMatrix:Rj,isTouchEvent:wC,isTransparent:d8,joinPath:EO,loadImage:uv,magnitude:kC,makeBoundingBoxFromPoints:oh,makePathSimpler:C8,matrixToSVG:P0,mergeClipPaths:(n,e)=>{var t;let s=n,r=e;s.inverted&&!r.inverted&&(s=e,r=n),hE(r,(t=r.group)===null||t===void 0?void 0:t.calcTransformMatrix(),s.calcTransformMatrix());const a=s.inverted&&r.inverted;return a&&(s.inverted=r.inverted=!1),new Al([s],{clipPath:r,inverted:a})},multiplyTransformMatrices:ei,multiplyTransformMatrixArray:P_,parsePath:E8,parsePreserveAspectRatioAttribute:vO,parseUnit:Ja,pick:Ym,projectStrokeOnPoints:p8,qrDecompose:xm,radiansToDegrees:yh,removeFromArray:Zp,removeTransformFromObject:(n,e)=>{const t=jo(e),s=ei(t,n.calcOwnMatrix());z0(n,s)},removeTransformMatrixForSvgParsing:VS,request:O8,requestAnimFrame:cv,resetObjectTransform:Hj,rotatePoint:(n,e,t)=>n.rotate(t,e),rotateVector:wO,saveObjectTransform:yO,sendObjectToPlane:hE,sendPointToPlane:um,sendVectorToPlane:Gj,setStyle:OC,sin:fu,sizeAfterTransform:B_,string:mZ,stylesFromArray:y8,stylesToArray:g8,toBlob:dO,toDataURL:hO,toFixed:Hs,transformPath:(n,e,t)=>(t&&(e=ei(e,[1,0,0,1,-t.x,-t.y])),n.map((s=>{const r=[...s];for(let a=1;a<s.length-1;a+=2){const{x:o,y:l}=Ta({x:s[a],y:s[a+1]},e);r[a]=o,r[a+1]=l}return r}))),transformPoint:Ta});class JZ extends jj{constructor(e){let{allowTouchScrolling:t=!1,containerClass:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),ke(this,"upper",void 0),ke(this,"container",void 0);const{el:r}=this.lower,a=this.createUpperCanvas();this.upper={el:a,ctx:a.getContext("2d")},this.applyCanvasStyle(r,{allowTouchScrolling:t}),this.applyCanvasStyle(a,{allowTouchScrolling:t,styles:{position:"absolute",left:"0",top:"0"}});const o=this.createContainerElement();o.classList.add(s),r.parentNode&&r.parentNode.replaceChild(o,r),o.append(r,a),this.container=o}createUpperCanvas(){const{el:e}=this.lower,t=gh();return t.className=e.className,t.classList.remove("lower-canvas"),t.classList.add("upper-canvas"),t.setAttribute("data-fabric","top"),t.style.cssText=e.style.cssText,t.setAttribute("draggable","true"),t}createContainerElement(){const e=a1().createElement("div");return e.setAttribute("data-fabric","wrapper"),OC(e,{position:"relative"}),QP(e),e}applyCanvasStyle(e,t){const{styles:s,allowTouchScrolling:r}=t;OC(e,Ie(Ie({},s),{},{"touch-action":r?"manipulation":no})),QP(e)}setDimensions(e,t){super.setDimensions(e,t);const{el:s,ctx:r}=this.upper;Bj(s,r,e,t)}setCSSDimensions(e){super.setCSSDimensions(e),uE(this.upper.el,e),uE(this.container,e)}cleanupDOM(e){const t=this.container,{el:s}=this.lower,{el:r}=this.upper;super.cleanupDOM(e),t.removeChild(r),t.removeChild(s),t.parentNode&&t.parentNode.replaceChild(s,t)}dispose(){super.dispose(),mh().dispose(this.upper.el),delete this.upper,delete this.container}}class q_ extends gO{constructor(){super(...arguments),ke(this,"targets",[]),ke(this,"_hoveredTargets",[]),ke(this,"_currentTransform",null),ke(this,"_groupSelector",null),ke(this,"contextTopDirty",!1)}static getDefaults(){return Ie(Ie({},super.getDefaults()),q_.ownDefaults)}get upperCanvasEl(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.el}get contextTop(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.ctx}get wrapperEl(){return this.elements.container}initElements(e){this.elements=new JZ(e,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(e){this._objectsToRender=void 0,super._onObjectAdded(e)}_onObjectRemoved(e){this._objectsToRender=void 0,e===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[e]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[e]}),e.fire("deselected",{target:e})),e===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(e)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const e=this._activeObject;return!this.preserveObjectStacking&&e?this._objects.filter((t=>!t.group&&t!==e)).concat(e):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()}renderTop(){const e=this.contextTop;this.clearContext(e),this.renderTopLayer(e),this.fire("after:render",{ctx:e})}setTargetFindTolerance(e){e=Math.round(e),this.targetFindTolerance=e;const t=this.getRetinaScaling(),s=Math.ceil((2*e+1)*t);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(t,t)}isTargetTransparent(e,t,s){const r=this.targetFindTolerance,a=this.pixelFindContext;this.clearContext(a),a.save(),a.translate(-t+r,-s+r),a.transform(...this.viewportTransform);const o=e.selectionBackgroundColor;e.selectionBackgroundColor="",e.render(a),e.selectionBackgroundColor=o,a.restore();const l=Math.round(r*this.getRetinaScaling());return d8(a,l,l,l)}_isSelectionKeyPressed(e){const t=this.selectionKey;return!!t&&(Array.isArray(t)?!!t.find((s=>!!s&&e[s]===!0)):e[t])}_shouldClearSelection(e,t){const s=this.getActiveObjects(),r=this._activeObject;return!!(!t||t&&r&&s.length>1&&s.indexOf(t)===-1&&r!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&r&&r!==t)}_shouldCenterTransform(e,t,s){if(!e)return;let r;return t===M_||t===ao||t===Ol||t===xv?r=this.centeredScaling||e.centeredScaling:t===cO&&(r=this.centeredRotation||e.centeredRotation),r?!s:s}_getOriginFromCorner(e,t){const s={x:e.originX,y:e.originY};return t&&(["ml","tl","bl"].includes(t)?s.x=Yr:["mr","tr","br"].includes(t)&&(s.x=ws),["tl","mt","tr"].includes(t)?s.y=cE:["bl","mb","br"].includes(t)&&(s.y=Uo)),s}_setupCurrentTransform(e,t,s){var r;const a=t.group?um(this.getScenePoint(e),void 0,t.group.calcTransformMatrix()):this.getScenePoint(e),{key:o="",control:l}=t.getActiveControl()||{},c=s&&l?(r=l.getActionHandler(e,t,l))===null||r===void 0?void 0:r.bind(l):IK,u=((g,b,v,x)=>{if(!b||!g)return"drag";const S=x.controls[b];return S.getActionName(v,S,x)})(s,o,e,t),d=e[this.centeredKey],p=this._shouldCenterTransform(t,u,d)?{x:In,y:In}:this._getOriginFromCorner(t,o),m={target:t,action:u,actionHandler:c,actionPerformed:!1,corner:o,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:a.x-t.left,offsetY:a.y-t.top,originX:p.x,originY:p.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,theta:Mr(t.angle),width:t.width,height:t.height,shiftKey:e.shiftKey,altKey:d,original:Ie(Ie({},yO(t)),{},{originX:p.x,originY:p.y})};this._currentTransform=m,this.fire("before:transform",{e,transform:m})}setCursor(e){this.upperCanvasEl.style.cursor=e}_drawSelection(e){const{x:t,y:s,deltaX:r,deltaY:a}=this._groupSelector,o=new Ve(t,s).transform(this.viewportTransform),l=new Ve(t+r,s+a).transform(this.viewportTransform),c=this.selectionLineWidth/2;let u=Math.min(o.x,l.x),d=Math.min(o.y,l.y),p=Math.max(o.x,l.x),m=Math.max(o.y,l.y);this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(u,d,p-u,m-d)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,u+=c,d+=c,p-=c,m-=c,Da.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(u,d,p-u,m-d))}findTarget(e){if(this.skipTargetFind)return;const t=this.getViewportPoint(e),s=this._activeObject,r=this.getActiveObjects();if(this.targets=[],s&&r.length>=1){if(s.findControl(t,wC(e))||r.length>1&&this.searchPossibleTargets([s],t))return s;if(s===this.searchPossibleTargets([s],t)){if(this.preserveObjectStacking){const a=this.targets;this.targets=[];const o=this.searchPossibleTargets(this._objects,t);return e[this.altSelectionKey]&&o&&o!==s?(this.targets=a,s):o}return s}}return this.searchPossibleTargets(this._objects,t)}_pointIsInObjectSelectionArea(e,t){let s=e.getCoords();const r=this.getZoom(),a=e.padding/r;if(a){const[o,l,c,u]=s,d=Math.atan2(l.y-o.y,l.x-o.x),p=du(d)*a,m=fu(d)*a,g=p+m,b=p-m;s=[new Ve(o.x-b,o.y-g),new Ve(l.x+g,l.y-b),new Ve(c.x+b,c.y+g),new Ve(u.x-g,u.y+b)]}return _r.isPointInPolygon(t,s)}_checkTarget(e,t){return!!(e&&e.visible&&e.evented&&this._pointIsInObjectSelectionArea(e,um(t,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing||!this.isTargetTransparent(e,t.x,t.y)))}_searchPossibleTargets(e,t){let s=e.length;for(;s--;){const r=e[s];if(this._checkTarget(r,t)){if(jS(r)&&r.subTargetCheck){const a=this._searchPossibleTargets(r._objects,t);a&&this.targets.push(a)}return r}}}searchPossibleTargets(e,t){const s=this._searchPossibleTargets(e,t);if(s&&jS(s)&&s.interactive&&this.targets[0]){const r=this.targets;for(let a=r.length-1;a>0;a--){const o=r[a];if(!jS(o)||!o.interactive)return o}return r[0]}return s}getViewportPoint(e){return this._pointer?this._pointer:this.getPointer(e,!0)}getScenePoint(e){return this._absolutePointer?this._absolutePointer:this.getPointer(e)}getPointer(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=this.upperCanvasEl,r=s.getBoundingClientRect();let a=Vj(e),o=r.width||0,l=r.height||0;o&&l||(Uo in r&&cE in r&&(l=Math.abs(r.top-r.bottom)),Yr in r&&ws in r&&(o=Math.abs(r.right-r.left))),this.calcOffset(),a.x=a.x-this._offset.left,a.y=a.y-this._offset.top,t||(a=um(a,void 0,this.viewportTransform));const c=this.getRetinaScaling();c!==1&&(a.x/=c,a.y/=c);const u=o===0||l===0?new Ve(1,1):new Ve(s.width/o,s.height/l);return a.multiply(u)}_setDimensionsImpl(e,t){this._resetTransformEventData(),super._setDimensionsImpl(e,t),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=gh(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const e=this._activeObject;return Jp(e)?e.getObjects():e?[e]:[]}_fireSelectionEvents(e,t){let s=!1,r=!1;const a=this.getActiveObjects(),o=[],l=[];e.forEach((c=>{a.includes(c)||(s=!0,c.fire("deselected",{e:t,target:c}),l.push(c))})),a.forEach((c=>{e.includes(c)||(s=!0,c.fire("selected",{e:t,target:c}),o.push(c))})),e.length>0&&a.length>0?(r=!0,s&&this.fire("selection:updated",{e:t,selected:o,deselected:l})):a.length>0?(r=!0,this.fire("selection:created",{e:t,selected:o})):e.length>0&&(r=!0,this.fire("selection:cleared",{e:t,deselected:l})),r&&(this._objectsToRender=void 0)}setActiveObject(e,t){const s=this.getActiveObjects(),r=this._setActiveObject(e,t);return this._fireSelectionEvents(s,t),r}_setActiveObject(e,t){const s=this._activeObject;return s!==e&&!(!this._discardActiveObject(t,e)&&this._activeObject)&&!e.onSelect({e:t})&&(this._activeObject=e,Jp(e)&&s!==e&&e.set("canvas",this),e.setCoords(),!0)}_discardActiveObject(e,t){const s=this._activeObject;return!!s&&!s.onDeselect({e,object:t})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(e),Jp(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(e){const t=this.getActiveObjects(),s=this.getActiveObject();t.length&&this.fire("before:selection:cleared",{e,deselected:[s]});const r=this._discardActiveObject(e);return this._fireSelectionEvents(t,e),r}endCurrentTransform(e){const t=this._currentTransform;this._finalizeCurrentTransform(e),t&&t.target&&(t.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(e){const t=this._currentTransform,s=t.target,r={e,target:s,transform:t,action:t.action};s._scaling&&(s._scaling=!1),s.setCoords(),t.actionPerformed&&(this.fire("object:modified",r),s.fire(bC,r))}setViewportTransform(e){super.setViewportTransform(e);const t=this._activeObject;t&&t.setCoords()}destroy(){const e=this._activeObject;Jp(e)&&(e.removeAll(),e.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(e){const t=this._activeObject;t&&t._renderControls(e)}_toObject(e,t,s){const r=this._realizeGroupTransformOnObject(e),a=super._toObject(e,t,s);return e.set(r),a}_realizeGroupTransformOnObject(e){const{group:t}=e;if(t&&Jp(t)&&this._activeObject===t){const s=Ym(e,["angle","flipX","flipY",ws,ao,Ol,l1,c1,Uo]);return Wj(e,t.calcOwnMatrix()),s}return{}}_setSVGObject(e,t,s){const r=this._realizeGroupTransformOnObject(t);super._setSVGObject(e,t,s),t.set(r)}}ke(q_,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class QZ{constructor(e){ke(this,"targets",[]),ke(this,"__disposer",void 0);const t=()=>{const{hiddenTextarea:r}=e.getActiveObject()||{};r&&r.focus()},s=e.upperCanvasEl;s.addEventListener("click",t),this.__disposer=()=>s.removeEventListener("click",t)}exitTextEditing(){this.target=void 0,this.targets.forEach((e=>{e.isEditing&&e.exitEditing()}))}add(e){this.targets.push(e)}remove(e){this.unregister(e),Zp(this.targets,e)}register(e){this.target=e}unregister(e){e===this.target&&(this.target=void 0)}onMouseMove(e){var t;!((t=this.target)===null||t===void 0)&&t.isEditing&&this.target.updateSelectionOnMouseMove(e)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const eJ=["target","oldTarget","fireCanvas","e"],yl={passive:!1},o0=(n,e)=>{const t=n.getViewportPoint(e),s=n.getScenePoint(e);return{viewportPoint:t,scenePoint:s,pointer:t,absolutePointer:s}},xf=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return n.addEventListener(...t)},rc=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return n.removeEventListener(...t)},tJ={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class vE extends q_{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),ke(this,"_isClick",void 0),ke(this,"textEditingManager",new QZ(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(xf,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(e,t){const s=this.upperCanvasEl,r=this._getEventPrefix();e(zj(s),"resize",this._onResize),e(s,r+"down",this._onMouseDown),e(s,"".concat(r,"move"),this._onMouseMove,yl),e(s,"".concat(r,"out"),this._onMouseOut),e(s,"".concat(r,"enter"),this._onMouseEnter),e(s,"wheel",this._onMouseWheel,{passive:!1}),e(s,"contextmenu",this._onContextMenu),e(s,"click",this._onClick),e(s,"dblclick",this._onClick),e(s,"dragstart",this._onDragStart),e(s,"dragend",this._onDragEnd),e(s,"dragover",this._onDragOver),e(s,"dragenter",this._onDragEnter),e(s,"dragleave",this._onDragLeave),e(s,"drop",this._onDrop),this.enablePointerEvents||e(s,"touchstart",this._onTouchStart,yl)}removeListeners(){this.addOrRemove(rc,"remove");const e=this._getEventPrefix(),t=su(this.upperCanvasEl);rc(t,"".concat(e,"up"),this._onMouseUp),rc(t,"touchend",this._onTouchEnd,yl),rc(t,"".concat(e,"move"),this._onMouseMove,yl),rc(t,"touchmove",this._onMouseMove,yl),clearTimeout(this._willAddMouseDown)}_onMouseWheel(e){this.__onMouseWheel(e)}_onMouseOut(e){const t=this._hoveredTarget,s=Ie({e},o0(this,e));this.fire("mouse:out",Ie(Ie({},s),{},{target:t})),this._hoveredTarget=void 0,t&&t.fire("mouseout",Ie({},s)),this._hoveredTargets.forEach((r=>{this.fire("mouse:out",Ie(Ie({},s),{},{target:r})),r&&r.fire("mouseout",Ie({},s))})),this._hoveredTargets=[]}_onMouseEnter(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",Ie({e},o0(this,e))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(e){this._isClick=!1;const t=this.getActiveObject();if(t&&t.onDragStart(e)){this._dragSource=t;const s={e,target:t};return this.fire("dragstart",s),t.fire("dragstart",s),void xf(this.upperCanvasEl,"drag",this._onDragProgress)}e6(e)}_renderDragEffects(e,t,s){let r=!1;const a=this._dropTarget;a&&a!==t&&a!==s&&(a.clearContextTop(),r=!0),t?.clearContextTop(),s!==t&&s?.clearContextTop();const o=this.contextTop;o.save(),o.transform(...this.viewportTransform),t&&(o.save(),t.transform(o),t.renderDragSourceEffect(e),o.restore(),r=!0),s&&(o.save(),s.transform(o),s.renderDropTargetEffect(e),o.restore(),r=!0),o.restore(),r&&(this.contextTopDirty=!0)}_onDragEnd(e){const t=!!e.dataTransfer&&e.dataTransfer.dropEffect!==no,s=t?this._activeObject:void 0,r={e,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:t,dropTarget:s};rc(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",r),this._dragSource&&this._dragSource.fire("dragend",r),delete this._dragSource,this._onMouseUp(e)}_onDragProgress(e){const t={e,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",t),this._dragSource&&this._dragSource.fire("drag",t)}findDragTargets(e){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(e)),targets:[...this.targets]}}_onDragOver(e){const t="dragover",{target:s,targets:r}=this.findDragTargets(e),a=this._dragSource,o={e,target:s,subTargets:r,dragSource:a,canDrop:!1,dropTarget:void 0};let l;this.fire(t,o),this._fireEnterLeaveEvents(s,o),s&&(s.canDrop(e)&&(l=s),s.fire(t,o));for(let c=0;c<r.length;c++){const u=r[c];u.canDrop(e)&&(l=u),u.fire(t,o)}this._renderDragEffects(e,a,l),this._dropTarget=l}_onDragEnter(e){const{target:t,targets:s}=this.findDragTargets(e),r={e,target:t,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",r),this._fireEnterLeaveEvents(t,r)}_onDragLeave(e){const t={e,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",t),this._fireEnterLeaveEvents(void 0,t),this._renderDragEffects(e,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(e){const{target:t,targets:s}=this.findDragTargets(e),r=this._basicEventHandler("drop:before",Ie({e,target:t,subTargets:s,dragSource:this._dragSource},o0(this,e)));r.didDrop=!1,r.dropTarget=void 0,this._basicEventHandler("drop",r),this.fire("drop:after",r)}_onContextMenu(e){const t=this.findTarget(e),s=this.targets||[],r=this._basicEventHandler("contextmenu:before",{e,target:t,subTargets:s});return this.stopContextMenu&&e6(e),this._basicEventHandler("contextmenu",r),!1}_onClick(e){const t=e.detail;t>3||t<2||(this._cacheTransformEventData(e),t==2&&e.type==="dblclick"&&this._handleEvent(e,"dblclick"),t==3&&this._handleEvent(e,"tripleclick"),this._resetTransformEventData())}getPointerId(e){const t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1}_isMainEvent(e){return e.isPrimary===!0||e.isPrimary!==!1&&(e.type==="touchend"&&e.touches.length===0||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(e){let t=!this.allowTouchScrolling;const s=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),(this.isDrawingMode||s&&this._target===s)&&(t=!0),t&&e.preventDefault(),this._resetTransformEventData();const r=this.upperCanvasEl,a=this._getEventPrefix(),o=su(r);xf(o,"touchend",this._onTouchEnd,yl),t&&xf(o,"touchmove",this._onMouseMove,yl),rc(r,"".concat(a,"down"),this._onMouseDown)}_onMouseDown(e){this.__onMouseDown(e),this._resetTransformEventData();const t=this.upperCanvasEl,s=this._getEventPrefix();rc(t,"".concat(s,"move"),this._onMouseMove,yl);const r=su(t);xf(r,"".concat(s,"up"),this._onMouseUp),xf(r,"".concat(s,"move"),this._onMouseMove,yl)}_onTouchEnd(e){if(e.touches.length>0)return;this.__onMouseUp(e),this._resetTransformEventData(),delete this.mainTouchId;const t=this._getEventPrefix(),s=su(this.upperCanvasEl);rc(s,"touchend",this._onTouchEnd,yl),rc(s,"touchmove",this._onMouseMove,yl),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{xf(this.upperCanvasEl,"".concat(t,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(e){this.__onMouseUp(e),this._resetTransformEventData();const t=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(e)){const r=su(this.upperCanvasEl);rc(r,"".concat(s,"up"),this._onMouseUp),rc(r,"".concat(s,"move"),this._onMouseMove,yl),xf(t,"".concat(s,"move"),this._onMouseMove,yl)}}_onMouseMove(e){const t=this.getActiveObject();!this.allowTouchScrolling&&(!t||!t.shouldStartDragging(e))&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(e){const t=this.getActiveObject();return!!t!=!!e||t&&e&&t!==e}__onMouseUp(e){var t;this._cacheTransformEventData(e),this._handleEvent(e,"up:before");const s=this._currentTransform,r=this._isClick,a=this._target,{button:o}=e;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(e,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);if(!this._isMainEvent(e))return;let l,c,u=!1;if(s&&(this._finalizeCurrentTransform(e),u=s.actionPerformed),!r){const d=a===this._activeObject;this.handleSelection(e),u||(u=this._shouldRender(a)||!d&&a===this._activeObject)}if(a){const d=a.findControl(this.getViewportPoint(e),wC(e)),{key:p,control:m}=d||{};if(c=p,a.selectable&&a!==this._activeObject&&a.activeOn==="up")this.setActiveObject(a,e),u=!0;else if(m){const g=m.getMouseUpHandler(e,a,m);g&&(l=this.getScenePoint(e),g.call(m,e,s,l.x,l.y))}a.isMoving=!1}if(s&&(s.target!==a||s.corner!==c)){const d=s.target&&s.target.controls[s.corner],p=d&&d.getMouseUpHandler(e,s.target,d);l=l||this.getScenePoint(e),p&&p.call(d,e,s,l.x,l.y)}this._setCursorFromEvent(e,a),this._handleEvent(e,"up"),this._groupSelector=null,this._currentTransform=null,a&&(a.__corner=void 0),u?this.requestRenderAll():r||(t=this._activeObject)!==null&&t!==void 0&&t.isEditing||this.renderTop()}_basicEventHandler(e,t){const{target:s,subTargets:r=[]}=t;this.fire(e,t),s&&s.fire(e,t);for(let a=0;a<r.length;a++)r[a]!==s&&r[a].fire(e,t);return t}_handleEvent(e,t,s){const r=this._target,a=this.targets||[],o=Ie(Ie(Ie({e,target:r,subTargets:a},o0(this,e)),{},{transform:this._currentTransform},t==="up:before"||t==="up"?{isClick:this._isClick,currentTarget:this.findTarget(e),currentSubTargets:this.targets}:{}),t==="down:before"||t==="down"?s:{});this.fire("mouse:".concat(t),o),r&&r.fire("mouse".concat(t),o);for(let l=0;l<a.length;l++)a[l]!==r&&a[l].fire("mouse".concat(t),o)}_onMouseDownInDrawingMode(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(e),this.requestRenderAll());const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(t,{e,pointer:t}),this._handleEvent(e,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(e){if(this._isCurrentlyDrawing){const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(t,{e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")}_onMouseUpInDrawingMode(e){const t=this.getScenePoint(e);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e,pointer:t}):this._isCurrentlyDrawing=!1,this._handleEvent(e,"up")}__onMouseDown(e){this._isClick=!0,this._cacheTransformEventData(e),this._handleEvent(e,"down:before");let t=this._target,s=!!t&&t===this._activeObject;const{button:r}=e;if(r)return(this.fireMiddleClick&&r===1||this.fireRightClick&&r===2)&&this._handleEvent(e,"down",{alreadySelected:s}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._isMainEvent(e)||this._currentTransform)return;let a=this._shouldRender(t),o=!1;if(this.handleMultiSelection(e,t)?(t=this._activeObject,o=!0,a=!0):this._shouldClearSelection(e,t)&&this.discardActiveObject(e),this.selection&&(!t||!t.selectable&&!t.isEditing&&t!==this._activeObject)){const l=this.getScenePoint(e);this._groupSelector={x:l.x,y:l.y,deltaY:0,deltaX:0}}if(s=!!t&&t===this._activeObject,t){t.selectable&&t.activeOn==="down"&&this.setActiveObject(t,e);const l=t.findControl(this.getViewportPoint(e),wC(e));if(t===this._activeObject&&(l||!o)){this._setupCurrentTransform(e,t,s);const c=l?l.control:void 0,u=this.getScenePoint(e),d=c&&c.getMouseDownHandler(e,t,c);d&&d.call(c,e,this._currentTransform,u.x,u.y)}}a&&(this._objectsToRender=void 0),this._handleEvent(e,"down",{alreadySelected:s}),a&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(e){this._resetTransformEventData(),this._pointer=this.getViewportPoint(e),this._absolutePointer=um(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)}__onMouseMove(e){if(this._isClick=!1,this._cacheTransformEventData(e),this._handleEvent(e,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!this._isMainEvent(e))return;const t=this._groupSelector;if(t){const s=this.getScenePoint(e);t.deltaX=s.x-t.x,t.deltaY=s.y-t.y,this.renderTop()}else if(this._currentTransform)this._transformObject(e);else{const s=this.findTarget(e);this._setCursorFromEvent(e,s),this._fireOverOutEvents(e,s)}this.textEditingManager.onMouseMove(e),this._handleEvent(e,"move"),this._resetTransformEventData()}_fireOverOutEvents(e,t){const s=this._hoveredTarget,r=this._hoveredTargets,a=this.targets,o=Math.max(r.length,a.length);this.fireSyntheticInOutEvents("mouse",{e,target:t,oldTarget:s,fireCanvas:!0});for(let l=0;l<o;l++)a[l]===t||r[l]&&r[l]===s||this.fireSyntheticInOutEvents("mouse",{e,target:a[l],oldTarget:r[l]});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(e,t){const s=this._draggedoverTarget,r=this._hoveredTargets,a=this.targets,o=Math.max(r.length,a.length);this.fireSyntheticInOutEvents("drag",Ie(Ie({},t),{},{target:e,oldTarget:s,fireCanvas:!0}));for(let l=0;l<o;l++)this.fireSyntheticInOutEvents("drag",Ie(Ie({},t),{},{target:a[l],oldTarget:r[l]}));this._draggedoverTarget=e}fireSyntheticInOutEvents(e,t){let{target:s,oldTarget:r,fireCanvas:a,e:o}=t,l=ar(t,eJ);const{targetIn:c,targetOut:u,canvasIn:d,canvasOut:p}=tJ[e],m=r!==s;if(r&&m){const g=Ie(Ie({},l),{},{e:o,target:r,nextTarget:s},o0(this,o));a&&this.fire(p,g),r.fire(u,g)}if(s&&m){const g=Ie(Ie({},l),{},{e:o,target:s,previousTarget:r},o0(this,o));a&&this.fire(d,g),s.fire(c,g)}}__onMouseWheel(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()}_transformObject(e){const t=this.getScenePoint(e),s=this._currentTransform,r=s.target,a=r.group?um(t,void 0,r.group.calcTransformMatrix()):t;s.shiftKey=e.shiftKey,s.altKey=!!this.centeredKey&&e[this.centeredKey],this._performTransformAction(e,s,a),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(e,t,s){const{action:r,actionHandler:a,target:o}=t,l=!!a&&a(e,t,s.x,s.y);l&&o.setCoords(),r==="drag"&&l&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||l}_setCursorFromEvent(e,t){if(!t)return void this.setCursor(this.defaultCursor);let s=t.hoverCursor||this.hoverCursor;const r=Jp(this._activeObject)?this._activeObject:null,a=(!r||t.group!==r)&&t.findControl(this.getViewportPoint(e));if(a){const o=a.control;this.setCursor(o.cursorStyleHandler(e,o,t))}else t.subTargetCheck&&this.targets.concat().reverse().map((o=>{s=o.hoverCursor||s})),this.setCursor(s)}handleMultiSelection(e,t){const s=this._activeObject,r=Jp(s);if(s&&this._isSelectionKeyPressed(e)&&this.selection&&t&&t.selectable&&(s!==t||r)&&(r||!t.isDescendantOf(s)&&!s.isDescendantOf(t))&&!t.onSelect({e})&&!s.getActiveControl()){if(r){const a=s.getObjects();if(t===s){const o=this.getViewportPoint(e);if(!(t=this.searchPossibleTargets(a,o)||this.searchPossibleTargets(this._objects,o))||!t.selectable)return!1}t.group===s?(s.remove(t),this._hoveredTarget=t,this._hoveredTargets=[...this.targets],s.size()===1&&this._setActiveObject(s.item(0),e)):(s.multiSelectAdd(t),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(a,e)}else{s.isEditing&&s.exitEditing();const a=new(Nt.getClass("ActiveSelection"))([],{canvas:this});a.multiSelectAdd(s,t),this._hoveredTarget=a,this._setActiveObject(a,e),this._fireSelectionEvents([s],e)}return!0}return!1}handleSelection(e){if(!this.selection||!this._groupSelector)return!1;const{x:t,y:s,deltaX:r,deltaY:a}=this._groupSelector,o=new Ve(t,s),l=o.add(new Ve(r,a)),c=o.min(l),u=o.max(l).subtract(c),d=this.collectObjects({left:c.x,top:c.y,width:u.x,height:u.y},{includeIntersecting:!this.selectionFullyContained}),p=o.eq(l)?d[0]?[d[0]]:[]:d.length>1?d.filter((m=>!m.onSelect({e}))).reverse():d;if(p.length===1)this.setActiveObject(p[0],e);else if(p.length>1){const m=Nt.getClass("ActiveSelection");this.setActiveObject(new m(p,{canvas:this}),e)}return this._groupSelector=null,!0}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;const{upper:s}=this.elements;s.ctx=void 0;const r=super.toCanvasElement(e,t);return s.ctx=s.el.getContext("2d"),r}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const D8={x1:0,y1:0,x2:0,y2:0},nJ=Ie(Ie({},D8),{},{r1:0,r2:0}),w0=(n,e)=>isNaN(n)&&typeof e=="number"?e:n;function $8(n){return n&&/%$/.test(n)&&Number.isFinite(parseFloat(n))}function R8(n,e){const t=typeof n=="number"?n:typeof n=="string"?parseFloat(n)/($8(n)?100:1):NaN;return Cm(0,w0(t,e),1)}const sJ=/\s*;\s*/,rJ=/\s*:\s*/;function iJ(n,e){let t,s;const r=n.getAttribute("style");if(r){const o=r.split(sJ);o[o.length-1]===""&&o.pop();for(let l=o.length;l--;){const[c,u]=o[l].split(rJ).map((d=>d.trim()));c==="stop-color"?t=u:c==="stop-opacity"&&(s=u)}}const a=new Ho(t||n.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:R8(n.getAttribute("offset"),0),color:a.toRgb(),opacity:w0(parseFloat(s||n.getAttribute("stop-opacity")||""),1)*a.getAlpha()*e}}function aJ(n,e){const t=[],s=n.getElementsByTagName("stop"),r=R8(e,1);for(let a=s.length;a--;)t.push(iJ(s[a],r));return t}function L8(n){return n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?"linear":"radial"}function F8(n){return n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Xc(n,e){return n.getAttribute(e)}function oJ(n,e){return(function(t,s){let r,{width:a,height:o,gradientUnits:l}=s;return Object.entries(t).reduce(((c,u)=>{let[d,p]=u;if(p==="Infinity")r=1;else if(p==="-Infinity")r=0;else{const m=typeof p=="string";r=m?parseFloat(p):p,m&&$8(p)&&(r*=.01,l==="pixels"&&(d!=="x1"&&d!=="x2"&&d!=="r2"||(r*=a),d!=="y1"&&d!=="y2"||(r*=o)))}return c[d]=r,c}),{})})(L8(n)==="linear"?(function(t){return{x1:Xc(t,"x1")||0,y1:Xc(t,"y1")||0,x2:Xc(t,"x2")||"100%",y2:Xc(t,"y2")||0}})(n):(function(t){return{x1:Xc(t,"fx")||Xc(t,"cx")||"50%",y1:Xc(t,"fy")||Xc(t,"cy")||"50%",r1:0,x2:Xc(t,"cx")||"50%",y2:Xc(t,"cy")||"50%",r2:Xc(t,"r")||"50%"}})(n),Ie(Ie({},e),{},{gradientUnits:F8(n)}))}class x0{constructor(e){const{type:t="linear",gradientUnits:s="pixels",coords:r={},colorStops:a=[],offsetX:o=0,offsetY:l=0,gradientTransform:c,id:u}=e||{};Object.assign(this,{type:t,gradientUnits:s,coords:Ie(Ie({},t==="radial"?nJ:D8),r),colorStops:a,offsetX:o,offsetY:l,gradientTransform:c,id:u?"".concat(u,"_").concat(Uf()):Uf()})}addColorStop(e){for(const t in e){const s=new Ho(e[t]);this.colorStops.push({offset:parseFloat(t),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(e){return Ie(Ie({},Ym(this,e)),{},{type:this.type,coords:Ie({},this.coords),colorStops:this.colorStops.map((t=>Ie({},t))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(e){let{additionalTransform:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=[],r=this.gradientTransform?this.gradientTransform.concat():io.concat(),a=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map((p=>Ie({},p))).sort(((p,m)=>p.offset-m.offset));let l=-this.offsetX,c=-this.offsetY;var u;a==="objectBoundingBox"?(l/=e.width,c/=e.height):(l+=e.width/2,c+=e.height/2),(u=e)&&typeof u._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(l-=e.pathOffset.x,c-=e.pathOffset.y),r[4]-=l,r[5]-=c;const d=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(a,'"'),'gradientTransform="'.concat(t?t+" ":"").concat(P0(r),'"'),""].join(" ");if(this.type==="linear"){const{x1:p,y1:m,x2:g,y2:b}=this.coords;s.push("<linearGradient ",d,' x1="',p,'" y1="',m,'" x2="',g,'" y2="',b,`">
`)}else if(this.type==="radial"){const{x1:p,y1:m,x2:g,y2:b,r1:v,r2:x}=this.coords,S=v>x;s.push("<radialGradient ",d,' cx="',S?p:g,'" cy="',S?m:b,'" r="',S?v:x,'" fx="',S?g:p,'" fy="',S?b:m,`">
`),S&&(o.reverse(),o.forEach((A=>{A.offset=1-A.offset})));const C=Math.min(v,x);if(C>0){const A=C/Math.max(v,x);o.forEach((k=>{k.offset+=A*(1-k.offset)}))}}return o.forEach((p=>{let{color:m,offset:g,opacity:b}=p;s.push("<stop ",'offset="',100*g+"%",'" style="stop-color:',m,b!==void 0?";stop-opacity: "+b:";",`"/>
`)})),s.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),s.join("")}toLive(e){const{x1:t,y1:s,x2:r,y2:a,r1:o,r2:l}=this.coords,c=this.type==="linear"?e.createLinearGradient(t,s,r,a):e.createRadialGradient(t,s,o,r,a,l);return this.colorStops.forEach((u=>{let{color:d,opacity:p,offset:m}=u;c.addColorStop(m,p!==void 0?new Ho(d).setAlpha(p).toRgba():d)})),c}static async fromObject(e){const{colorStops:t,gradientTransform:s}=e;return new this(Ie(Ie({},e),{},{colorStops:t?t.map((r=>Ie({},r))):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(e,t,s){const r=F8(e),a=t._findCenterFromElement();return new this(Ie({id:e.getAttribute("id")||void 0,type:L8(e),coords:oJ(e,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:aJ(e,s.opacity),gradientUnits:r,gradientTransform:NC(e.getAttribute("gradientTransform")||"")},r==="pixels"?{offsetX:t.width/2-a.x,offsetY:t.height/2-a.y}:{offsetX:0,offsetY:0}))}}ke(x0,"type","Gradient"),Nt.setClass(x0,"gradient"),Nt.setClass(x0,"linear"),Nt.setClass(x0,"radial");const lJ=["type","source","patternTransform"];class WS{get type(){return"pattern"}set type(e){yd("warn","Setting type has no effect",e)}constructor(e){ke(this,"repeat","repeat"),ke(this,"offsetX",0),ke(this,"offsetY",0),ke(this,"crossOrigin",""),this.id=Uf(),Object.assign(this,e)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(e){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?e.createPattern(this.source,this.repeat):null}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:t,crossOrigin:s}=this;return Ie(Ie({},Ym(this,e)),{},{type:"pattern",source:this.sourceToString(),repeat:t,crossOrigin:s,offsetX:Hs(this.offsetX,ds.NUM_FRACTION_DIGITS),offsetY:Hs(this.offsetY,ds.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(e){let{width:t,height:s}=e;const{source:r,repeat:a,id:o}=this,l=w0(this.offsetX/t,0),c=w0(this.offsetY/s,0),u=a==="repeat-y"||a==="no-repeat"?1+Math.abs(l||0):w0(r.width/t,0),d=a==="repeat-x"||a==="no-repeat"?1+Math.abs(c||0):w0(r.height/s,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(l,'" y="').concat(c,'" width="').concat(u,'" height="').concat(d,'">'),'<image x="0" y="0" width="'.concat(r.width,'" height="').concat(r.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(e,t){let{type:s,source:r,patternTransform:a}=e,o=ar(e,lJ);const l=await uv(r,Ie(Ie({},t),{},{crossOrigin:o.crossOrigin}));return new this(Ie(Ie({},o),{},{patternTransform:a&&a.slice(0),source:l}))}}ke(WS,"type","Pattern"),Nt.setClass(WS),Nt.setClass(WS,"pattern");class cJ{constructor(e){ke(this,"color","rgb(0, 0, 0)"),ke(this,"width",1),ke(this,"shadow",null),ke(this,"strokeLineCap","round"),ke(this,"strokeLineJoin","round"),ke(this,"strokeMiterLimit",10),ke(this,"strokeDashArray",null),ke(this,"limitedToCanvasSize",!1),this.canvas=e}_setBrushStyles(e){e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,e.setLineDash(this.strokeDashArray||[])}_saveAndTransform(e){const t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])}needsFullRender(){return new Ho(this.color).getAlpha()<1||!!this.shadow}_setShadow(){if(!this.shadow||!this.canvas)return;const e=this.canvas,t=this.shadow,s=e.contextTop,r=e.getZoom()*e.getRetinaScaling();s.shadowColor=t.color,s.shadowBlur=t.blur*r,s.shadowOffsetX=t.offsetX*r,s.shadowOffsetY=t.offsetY*r}_resetShadow(){const e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}_isOutSideCanvas(e){return e.x<0||e.x>this.canvas.getWidth()||e.y<0||e.y>this.canvas.getHeight()}}const uJ=["path","left","top"],hJ=["d"];class eh extends Da{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:s,left:r,top:a}=t,o=ar(t,uJ);super(),Object.assign(this,eh.ownDefaults),this.setOptions(o),this._setPath(e||[],!0),typeof r=="number"&&this.set(ws,r),typeof a=="number"&&this.set(Uo,a)}_setPath(e,t){this.path=C8(Array.isArray(e)?e:E8(e)),this.setBoundingBox(t)}_findCenterFromElement(){const e=this._calcBoundsFromPath();return new Ve(e.left+e.width/2,e.top+e.height/2)}_renderPathCommands(e){const t=-this.pathOffset.x,s=-this.pathOffset.y;e.beginPath();for(const r of this.path)switch(r[0]){case"L":e.lineTo(r[1]+t,r[2]+s);break;case"M":e.moveTo(r[1]+t,r[2]+s);break;case"C":e.bezierCurveTo(r[1]+t,r[2]+s,r[3]+t,r[4]+s,r[5]+t,r[6]+s);break;case"Q":e.quadraticCurveTo(r[1]+t,r[2]+s,r[3]+t,r[4]+s);break;case"Z":e.closePath()}}_render(e){this._renderPathCommands(e),this._renderPaintInOrder(e)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ie(Ie({},super.toObject(e)),{},{path:this.path.map((t=>t.slice()))})}toDatalessObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.toObject(e);return this.sourcePath&&(delete t.path,t.sourcePath=this.sourcePath),t}_toSVG(){const e=EO(this.path,ds.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(e,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const e=ds.NUM_FRACTION_DIGITS;return" translate(".concat(Hs(-this.pathOffset.x,e),", ").concat(Hs(-this.pathOffset.y,e),")")}toClipPathSVG(e){const t=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}toSVG(e){const t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{width:t,height:s,pathOffset:r}=this._calcDimensions();this.set({width:t,height:s,pathOffset:r}),e&&this.setPositionByOrigin(r,In,In)}_calcBoundsFromPath(){const e=[];let t=0,s=0,r=0,a=0;for(const o of this.path)switch(o[0]){case"L":r=o[1],a=o[2],e.push({x:t,y:s},{x:r,y:a});break;case"M":r=o[1],a=o[2],t=r,s=a;break;case"C":e.push(...bE(r,a,o[1],o[2],o[3],o[4],o[5],o[6])),r=o[5],a=o[6];break;case"Q":e.push(...bE(r,a,o[1],o[2],o[1],o[2],o[3],o[4])),r=o[3],a=o[4];break;case"Z":r=t,a=s}return oh(e)}_calcDimensions(){const e=this._calcBoundsFromPath();return Ie(Ie({},e),{},{pathOffset:new Ve(e.left+e.width/2,e.top+e.height/2)})}static fromObject(e){return this._fromObject(e,{extraParam:"path"})}static async fromElement(e,t,s){const r=Ed(e,this.ATTRIBUTE_NAMES,s),{d:a}=r;return new this(a,Ie(Ie(Ie({},ar(r,hJ)),t),{},{left:void 0,top:void 0}))}}ke(eh,"type","Path"),ke(eh,"cacheProperties",[...Ad,"path","fillRule"]),ke(eh,"ATTRIBUTE_NAMES",[...tp,"d"]),Nt.setClass(eh),Nt.setSVGClass(eh);class DC extends cJ{constructor(e){super(e),ke(this,"decimate",.4),ke(this,"drawStraightLine",!1),ke(this,"straightLineKey","shiftKey"),this._points=[],this._hasStraightLine=!1}needsFullRender(){return super.needsFullRender()||this._hasStraightLine}static drawSegment(e,t,s){const r=t.midPointFrom(s);return e.quadraticCurveTo(t.x,t.y,r.x,r.y),r}onMouseDown(e,t){let{e:s}=t;this.canvas._isMainEvent(s)&&(this.drawStraightLine=!!this.straightLineKey&&s[this.straightLineKey],this._prepareForDrawing(e),this._addPoint(e),this._render())}onMouseMove(e,t){let{e:s}=t;if(this.canvas._isMainEvent(s)&&(this.drawStraightLine=!!this.straightLineKey&&s[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(e))&&this._addPoint(e)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{const r=this._points,a=r.length,o=this.canvas.contextTop;this._saveAndTransform(o),this.oldEnd&&(o.beginPath(),o.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=DC.drawSegment(o,r[a-2],r[a-1]),o.stroke(),o.restore()}}onMouseUp(e){let{e:t}=e;return!this.canvas._isMainEvent(t)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)}_prepareForDrawing(e){this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)}_addPoint(e){return!(this._points.length>1&&e.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(e),!0)}_reset(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1}_render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.canvas.contextTop,t=this._points[0],s=this._points[1];if(this._saveAndTransform(e),e.beginPath(),this._points.length===2&&t.x===s.x&&t.y===s.y){const r=this.width/1e3;t.x-=r,s.x+=r}e.moveTo(t.x,t.y);for(let r=1;r<this._points.length;r++)DC.drawSegment(e,t,s),t=this._points[r],s=this._points[r+1];e.lineTo(t.x,t.y),e.stroke(),e.restore()}convertPointsToSVGPath(e){const t=this.width/1e3;return I8(e,t)}createPath(e){const t=new eh(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new lh(this.shadow)),t}decimatePoints(e,t){if(e.length<=2)return e;let s,r=e[0];const a=this.canvas.getZoom(),o=Math.pow(t/a,2),l=e.length-1,c=[r];for(let u=1;u<l-1;u++)s=Math.pow(r.x-e[u].x,2)+Math.pow(r.y-e[u].y,2),s>=o&&(r=e[u],c.push(r));return c.push(e[l]),c}_finalizeAndAddPath(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));const e=this.convertPointsToSVGPath(this._points);if((function(s){return EO(s)==="M 0 0 Q 0 0 0 0 L 0 0"})(e))return void this.canvas.requestRenderAll();const t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:t}),this.canvas.add(t),this.canvas.requestRenderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}}const dJ=["left","top","radius"],M8=["radius","startAngle","endAngle","counterClockwise"];class Yu extends Da{static getDefaults(){return Ie(Ie({},super.getDefaults()),Yu.ownDefaults)}constructor(e){super(),Object.assign(this,Yu.ownDefaults),this.setOptions(e)}_set(e,t){return super._set(e,t),e==="radius"&&this.setRadius(t),this}_render(e){e.beginPath(),e.arc(0,0,this.radius,Mr(this.startAngle),Mr(this.endAngle),this.counterClockwise),this._renderPaintInOrder(e)}getRadiusX(){return this.get("radius")*this.get(ao)}getRadiusY(){return this.get("radius")*this.get(Ol)}setRadius(e){this.radius=e,this.set({width:2*e,height:2*e})}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...M8,...e])}_toSVG(){const e=(this.endAngle-this.startAngle)%360;if(e===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:t}=this,s=Mr(this.startAngle),r=Mr(this.endAngle),a=du(s)*t,o=fu(s)*t,l=du(r)*t,c=fu(r)*t,u=e>180?1:0,d=this.counterClockwise?0:1;return['<path d="M '.concat(a," ").concat(o," A ").concat(t," ").concat(t," 0 ").concat(u," ").concat(d," ").concat(l," ").concat(c,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(e,t,s){const r=Ed(e,this.ATTRIBUTE_NAMES,s),{left:a=0,top:o=0,radius:l=0}=r;return new this(Ie(Ie({},ar(r,dJ)),{},{radius:l,left:a-l,top:o-l}))}static fromObject(e){return super._fromObject(e)}}ke(Yu,"type","Circle"),ke(Yu,"cacheProperties",[...Ad,...M8]),ke(Yu,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),ke(Yu,"ATTRIBUTE_NAMES",["cx","cy","r",...tp]),Nt.setClass(Yu),Nt.setSVGClass(Yu);const fJ=["x1","y1","x2","y2"],pJ=["x1","y1","x2","y2"],wE=["x1","x2","y1","y2"];class th extends Da{constructor(){let[e,t,s,r]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,th.ownDefaults),this.setOptions(a),this.x1=e,this.x2=s,this.y1=t,this.y2=r,this._setWidthHeight();const{left:o,top:l}=a;typeof o=="number"&&this.set(ws,o),typeof l=="number"&&this.set(Uo,l)}_setWidthHeight(){const{x1:e,y1:t,x2:s,y2:r}=this;this.width=Math.abs(s-e),this.height=Math.abs(r-t);const{left:a,top:o,width:l,height:c}=oh([{x:e,y:t},{x:s,y:r}]),u=new Ve(a+l/2,o+c/2);this.setPositionByOrigin(u,In,In)}_set(e,t){return super._set(e,t),wE.includes(e)&&this._setWidthHeight(),this}_render(e){e.beginPath();const t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;const s=e.strokeStyle;var r;uc(this.stroke)?e.strokeStyle=this.stroke.toLive(e):e.strokeStyle=(r=this.stroke)!==null&&r!==void 0?r:e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=s}_findCenterFromElement(){return new Ve((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ie(Ie({},super.toObject(e)),this.calcLinePoints())}_getNonTransformedDimensions(){const e=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(e.y-=this.strokeWidth),this.height===0&&(e.x-=this.strokeWidth)),e}calcLinePoints(){const{x1:e,x2:t,y1:s,y2:r,width:a,height:o}=this,l=e<=t?-1:1,c=s<=r?-1:1;return{x1:l*a/2,x2:l*-a/2,y1:c*o/2,y2:c*-o/2}}_toSVG(){const{x1:e,x2:t,y1:s,y2:r}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(e,'" y1="').concat(s,'" x2="').concat(t,'" y2="').concat(r,`" />
`)]}static async fromElement(e,t,s){const r=Ed(e,this.ATTRIBUTE_NAMES,s),{x1:a=0,y1:o=0,x2:l=0,y2:c=0}=r;return new this([a,o,l,c],ar(r,fJ))}static fromObject(e){let{x1:t,y1:s,x2:r,y2:a}=e,o=ar(e,pJ);return this._fromObject(Ie(Ie({},o),{},{points:[t,s,r,a]}),{extraParam:"points"})}}ke(th,"type","Line"),ke(th,"cacheProperties",[...Ad,...wE]),ke(th,"ATTRIBUTE_NAMES",tp.concat(wE)),Nt.setClass(th),Nt.setSVGClass(th);class Af extends Da{static getDefaults(){return Ie(Ie({},super.getDefaults()),Af.ownDefaults)}constructor(e){super(),Object.assign(this,Af.ownDefaults),this.setOptions(e)}_render(e){const t=this.width/2,s=this.height/2;e.beginPath(),e.moveTo(-t,s),e.lineTo(0,-s),e.lineTo(t,s),e.closePath(),this._renderPaintInOrder(e)}_toSVG(){const e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-e," ").concat(t,",0 ").concat(-t,",").concat(e," ").concat(t),'" />']}}ke(Af,"type","Triangle"),ke(Af,"ownDefaults",{width:100,height:100}),Nt.setClass(Af),Nt.setSVGClass(Af);const P8=["rx","ry"];class ad extends Da{static getDefaults(){return Ie(Ie({},super.getDefaults()),ad.ownDefaults)}constructor(e){super(),Object.assign(this,ad.ownDefaults),this.setOptions(e)}_set(e,t){switch(super._set(e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this}getRx(){return this.get("rx")*this.get(ao)}getRy(){return this.get("ry")*this.get(Ol)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...P8,...e])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,bd,!1),e.restore(),this._renderPaintInOrder(e)}static async fromElement(e,t,s){const r=Ed(e,this.ATTRIBUTE_NAMES,s);return r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,new this(r)}}function mJ(n){if(!n)return[];const e=n.replace(/,/g," ").trim().split(/\s+/),t=[];for(let s=0;s<e.length;s+=2)t.push({x:parseFloat(e[s]),y:parseFloat(e[s+1])});return t}ke(ad,"type","Ellipse"),ke(ad,"cacheProperties",[...Ad,...P8]),ke(ad,"ownDefaults",{rx:0,ry:0}),ke(ad,"ATTRIBUTE_NAMES",[...tp,"cx","cy","rx","ry"]),Nt.setClass(ad),Nt.setSVGClass(ad);const gJ=["left","top"],z8={exactBoundingBox:!1};class eu extends Da{static getDefaults(){return Ie(Ie({},super.getDefaults()),eu.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ke(this,"strokeDiff",void 0),Object.assign(this,eu.ownDefaults),this.setOptions(t),this.points=e;const{left:s,top:r}=t;this.initialized=!0,this.setBoundingBox(!0),typeof s=="number"&&this.set(ws,s),typeof r=="number"&&this.set(Uo,r)}isOpen(){return!0}_projectStrokeOnPoints(e){return p8(this.points,e,this.isOpen())}_calcDimensions(e){e=Ie({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},e||{});const t=this.exactBoundingBox?this._projectStrokeOnPoints(e).map((u=>u.projectedPoint)):this.points;if(t.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new Ve,strokeOffset:new Ve,strokeDiff:new Ve};const s=oh(t),r=dw(Ie(Ie({},e),{},{scaleX:1,scaleY:1})),a=oh(this.points.map((u=>Ta(u,r,!0)))),o=new Ve(this.scaleX,this.scaleY);let l=s.left+s.width/2,c=s.top+s.height/2;return this.exactBoundingBox&&(l-=c*Math.tan(Mr(this.skewX)),c-=l*Math.tan(Mr(this.skewY))),Ie(Ie({},s),{},{pathOffset:new Ve(l,c),strokeOffset:new Ve(a.left,a.top).subtract(new Ve(s.left,s.top)).multiply(o),strokeDiff:new Ve(s.width,s.height).subtract(new Ve(a.width,a.height)).multiply(o)})}_findCenterFromElement(){const e=oh(this.points);return new Ve(e.left+e.width/2,e.top+e.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{left:t,top:s,width:r,height:a,pathOffset:o,strokeOffset:l,strokeDiff:c}=this._calcDimensions();this.set({width:r,height:a,pathOffset:o,strokeOffset:l,strokeDiff:c}),e&&this.setPositionByOrigin(new Ve(t+r/2,s+a/2),In,In)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new Ve(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(e).some((l=>this.strokeUniform||this.constructor.layoutProperties.includes(l)))){var t,s;const{width:l,height:c}=this._calcDimensions(e);o=new Ve((t=e.width)!==null&&t!==void 0?t:l,(s=e.height)!==null&&s!==void 0?s:c)}else{var r,a;o=new Ve((r=e.width)!==null&&r!==void 0?r:this.width,(a=e.height)!==null&&a!==void 0?a:this.height)}return o.multiply(new Ve(e.scaleX||this.scaleX,e.scaleY||this.scaleY))}return super._getTransformedDimensions(e)}_set(e,t){const s=this.initialized&&this[e]!==t,r=super._set(e,t);return this.exactBoundingBox&&s&&((e===ao||e===Ol)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(e))&&this.setDimensions(),r}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ie(Ie({},super.toObject(e)),{},{points:this.points.map((t=>{let{x:s,y:r}=t;return{x:s,y:r}}))})}_toSVG(){const e=[],t=this.pathOffset.x,s=this.pathOffset.y,r=ds.NUM_FRACTION_DIGITS;for(let a=0,o=this.points.length;a<o;a++)e.push(Hs(this.points[a].x-t,r),",",Hs(this.points[a].y-s,r)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(e.join(""),`" />
`)]}_render(e){const t=this.points.length,s=this.pathOffset.x,r=this.pathOffset.y;if(t&&!isNaN(this.points[t-1].y)){e.beginPath(),e.moveTo(this.points[0].x-s,this.points[0].y-r);for(let a=0;a<t;a++){const o=this.points[a];e.lineTo(o.x-s,o.y-r)}!this.isOpen()&&e.closePath(),this._renderPaintInOrder(e)}}complexity(){return this.points.length}static async fromElement(e,t,s){return new this(mJ(e.getAttribute("points")),Ie(Ie({},ar(Ed(e,this.ATTRIBUTE_NAMES,s),gJ)),t))}static fromObject(e){return this._fromObject(e,{extraParam:"points"})}}ke(eu,"ownDefaults",z8),ke(eu,"type","Polyline"),ke(eu,"layoutProperties",[l1,c1,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),ke(eu,"cacheProperties",[...Ad,"points"]),ke(eu,"ATTRIBUTE_NAMES",[...tp]),Nt.setClass(eu),Nt.setSVGClass(eu);class Ef extends eu{isOpen(){return!1}}ke(Ef,"ownDefaults",z8),ke(Ef,"type","Polygon"),Nt.setClass(Ef),Nt.setSVGClass(Ef);class B8 extends Da{isEmptyStyles(e){if(!this.styles||e!==void 0&&!this.styles[e])return!0;const t=e===void 0?this.styles:{line:this.styles[e]};for(const s in t)for(const r in t[s])for(const a in t[s][r])return!1;return!0}styleHas(e,t){if(!this.styles||t!==void 0&&!this.styles[t])return!1;const s=t===void 0?this.styles:{0:this.styles[t]};for(const r in s)for(const a in s[r])if(s[r][a][e]!==void 0)return!0;return!1}cleanStyle(e){if(!this.styles)return!1;const t=this.styles;let s,r,a=0,o=!0,l=0;for(const c in t){s=0;for(const u in t[c]){const d=t[c][u]||{};a++,d[e]!==void 0?(r?d[e]!==r&&(o=!1):r=d[e],d[e]===this[e]&&delete d[e]):o=!1,Object.keys(d).length!==0?s++:delete t[c][u]}s===0&&delete t[c]}for(let c=0;c<this._textLines.length;c++)l+=this._textLines[c].length;o&&a===l&&(this[e]=r,this.removeStyle(e))}removeStyle(e){if(!this.styles)return;const t=this.styles;let s,r,a;for(r in t){for(a in s=t[r],s)delete s[a][e],Object.keys(s[a]).length===0&&delete s[a];Object.keys(s).length===0&&delete t[r]}}_extendStyles(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e);this._getLineStyle(s)||this._setLineStyle(s);const a=mO(Ie(Ie({},this._getStyleDeclaration(s,r)),t),(o=>o!==void 0));this._setStyleDeclaration(s,r,a)}getSelectionStyles(e,t,s){const r=[];for(let a=e;a<(t||e);a++)r.push(this.getStyleAtPosition(a,s));return r}getStyleAtPosition(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e);return t?this.getCompleteStyleDeclaration(s,r):this._getStyleDeclaration(s,r)}setSelectionStyles(e,t,s){for(let r=t;r<(s||t);r++)this._extendStyles(r,e);this._forceClearCache=!0}_getStyleDeclaration(e,t){var s;const r=this.styles&&this.styles[e];return r&&(s=r[t])!==null&&s!==void 0?s:{}}getCompleteStyleDeclaration(e,t){return Ie(Ie({},Ym(this,this.constructor._styleProperties)),this._getStyleDeclaration(e,t))}_setStyleDeclaration(e,t,s){this.styles[e][t]=s}_deleteStyleDeclaration(e,t){delete this.styles[e][t]}_getLineStyle(e){return!!this.styles[e]}_setLineStyle(e){this.styles[e]={}}_deleteLineStyle(e){delete this.styles[e]}}ke(B8,"_styleProperties",OK);const yJ=/  +/g,bJ=/"/g;function a5(n,e,t,s,r){return"		".concat((function(a,o){let{left:l,top:c,width:u,height:d}=o,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ds.NUM_FRACTION_DIGITS;const m=Sv(mi,a,!1),[g,b,v,x]=[l,c,u,d].map((S=>Hs(S,p)));return"<rect ".concat(m,' x="').concat(g,'" y="').concat(b,'" width="').concat(v,'" height="').concat(x,'"></rect>')})(n,{left:e,top:t,width:s,height:r}),`
`)}const vJ=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let o5;class Za extends B8{static getDefaults(){return Ie(Ie({},super.getDefaults()),Za.ownDefaults)}constructor(e,t){super(),ke(this,"__charBounds",[]),Object.assign(this,Za.ownDefaults),this.setOptions(t),this.styles||(this.styles={}),this.text=e,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const e=this.path;e&&(e.segmentsInfo=AO(e.path))}_splitText(){const e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Qu)&&this.enlargeSpaces()}enlargeSpaces(){let e,t,s,r,a,o,l;for(let c=0,u=this._textLines.length;c<u;c++)if((this.textAlign===Qu||c!==u-1&&!this.isEndOfWrapping(c))&&(r=0,a=this._textLines[c],t=this.getLineWidth(c),t<this.width&&(l=this.textLines[c].match(this._reSpacesAndTabs)))){s=l.length,e=(this.width-t)/s;for(let d=0;d<=a.length;d++)o=this.__charBounds[c][d],this._reSpaceAndTab.test(a[d])?(o.width+=e,o.kernedWidth+=e,o.left+=r,r+=e):o.left+=r}}isEndOfWrapping(e){return e===this._textLines.length-1}missingNewlineOffset(e){return 1}get2DCursorLocation(e,t){const s=t?this._unwrappedTextLines:this._textLines;let r;for(r=0;r<s.length;r++){if(e<=s[r].length)return{lineIndex:r,charIndex:e};e-=s[r].length+this.missingNewlineOffset(r,t)}return{lineIndex:r-1,charIndex:s[r-1].length<e?s[r-1].length:e}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const e=super._getCacheCanvasDimensions(),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e}_render(e){const t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")}_renderText(e){this.paintFirst===so?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))}_setTextStyles(e,t,s){if(e.textBaseline="alphabetic",this.path)switch(this.pathAlign){case In:e.textBaseline="middle";break;case"ascender":e.textBaseline=Uo;break;case"descender":e.textBaseline=cE}e.font=this._getFontDeclaration(t,s)}calcTextWidth(){let e=this.getLineWidth(0);for(let t=1,s=this._textLines.length;t<s;t++){const r=this.getLineWidth(t);r>e&&(e=r)}return e}_renderTextLine(e,t,s,r,a,o){this._renderChars(e,t,s,r,a,o)}_renderTextLinesBackground(e){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const t=e.fillStyle,s=this._getLeftOffset();let r=this._getTopOffset();for(let a=0,o=this._textLines.length;a<o;a++){const l=this.getHeightOfLine(a);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",a)){r+=l;continue}const c=this._textLines[a].length,u=this._getLineLeftOffset(a);let d,p,m=0,g=0,b=this.getValueOfPropertyAt(a,0,"textBackgroundColor");const v=this.getHeightOfLineImpl(a);for(let x=0;x<c;x++){const S=this.__charBounds[a][x];p=this.getValueOfPropertyAt(a,x,"textBackgroundColor"),this.path?(e.save(),e.translate(S.renderLeft,S.renderTop),e.rotate(S.angle),e.fillStyle=p,p&&e.fillRect(-S.width/2,-v*(1-this._fontSizeFraction),S.width,v),e.restore()):p!==b?(d=s+u+g,this.direction==="rtl"&&(d=this.width-d-m),e.fillStyle=b,b&&e.fillRect(d,r,m,v),g=S.left,m=S.width,b=p):m+=S.kernedWidth}p&&!this.path&&(d=s+u+g,this.direction==="rtl"&&(d=this.width-d-m),e.fillStyle=p,e.fillRect(d,r,m,v)),r+=l}e.fillStyle=t,this._removeShadow(e)}_measureChar(e,t,s,r){const a=lv.getFontCache(t),o=this._getFontDeclaration(t),l=s?s+e:e,c=s&&o===this._getFontDeclaration(r),u=t.fontSize/this.CACHE_FONT_SIZE;let d,p,m,g;if(s&&a.has(s)&&(m=a.get(s)),a.has(e)&&(g=d=a.get(e)),c&&a.has(l)&&(p=a.get(l),g=p-m),d===void 0||m===void 0||p===void 0){const b=(function(){return o5||(o5=Dl({width:0,height:0}).getContext("2d")),o5})();this._setTextStyles(b,t,!0),d===void 0&&(g=d=b.measureText(e).width,a.set(e,d)),m===void 0&&c&&s&&(m=b.measureText(s).width,a.set(s,m)),c&&p===void 0&&(p=b.measureText(l).width,a.set(l,p),g=p-m)}return{width:d*u,kernedWidth:g*u}}getHeightOfChar(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")}measureLine(e){const t=this._measureLine(e);return this.charSpacing!==0&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t}_measureLine(e){let t,s,r=0;const a=this.pathSide===Yr,o=this.path,l=this._textLines[e],c=l.length,u=new Array(c);this.__charBounds[e]=u;for(let d=0;d<c;d++){const p=l[d];s=this._getGraphemeBox(p,e,d,t),u[d]=s,r+=s.kernedWidth,t=p}if(u[c]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let d=0;const p=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case ws:d=a?p-r:0;break;case In:d=(p-r)/2;break;case Yr:d=a?0:p-r}d+=this.pathStartOffset*(a?-1:1);for(let m=a?c-1:0;a?m>=0:m<c;a?m--:m++)s=u[m],d>p?d%=p:d<0&&(d+=p),this._setGraphemeOnPath(d,s),d+=s.kernedWidth}return{width:r,numOfSpaces:0}}_setGraphemeOnPath(e,t){const s=e+t.kernedWidth/2,r=this.path,a=A8(r.path,s,r.segmentsInfo);t.renderLeft=a.x-r.pathOffset.x,t.renderTop=a.y-r.pathOffset.y,t.angle=a.angle+(this.pathSide===Yr?Math.PI:0)}_getGraphemeBox(e,t,s,r,a){const o=this.getCompleteStyleDeclaration(t,s),l=r?this.getCompleteStyleDeclaration(t,s-1):{},c=this._measureChar(e,o,r,l);let u,d=c.kernedWidth,p=c.width;this.charSpacing!==0&&(u=this._getWidthOfCharSpacing(),p+=u,d+=u);const m={width:p,left:0,height:o.fontSize,kernedWidth:d,deltaY:o.deltaY};if(s>0&&!a){const g=this.__charBounds[t][s-1];m.left=g.left+g.width+c.kernedWidth-c.width}return m}getHeightOfLineImpl(e){const t=this.__lineHeights;if(t[e])return t[e];let s=this.getHeightOfChar(e,0);for(let r=1,a=this._textLines[e].length;r<a;r++)s=Math.max(this.getHeightOfChar(e,r),s);return t[e]=s*this._fontSizeMult}getHeightOfLine(e){return this.getHeightOfLineImpl(e)*this.lineHeight}calcTextHeight(){let e=0;for(let t=0,s=this._textLines.length;t<s;t++)e+=t===s-1?this.getHeightOfLineImpl(t):this.getHeightOfLine(t);return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(e,t){e.save();let s=0;const r=this._getLeftOffset(),a=this._getTopOffset();for(let o=0,l=this._textLines.length;o<l;o++)this._renderTextLine(t,e,this._textLines[o],r+this._getLineLeftOffset(o),a+s+this.getHeightOfLineImpl(o),o),s+=this.getHeightOfLine(o);e.restore()}_renderTextFill(e){(this.fill||this.styleHas(mi))&&this._renderTextCommon(e,"fillText")}_renderTextStroke(e){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())}_renderChars(e,t,s,r,a,o){const l=this.textAlign.includes(Qu),c=this.path,u=!l&&this.charSpacing===0&&this.isEmptyStyles(o)&&!c,d=this.direction==="ltr",p=this.direction==="ltr"?1:-1,m=t.direction;let g,b,v,x,S,C="",A=0;if(t.save(),m!==this.direction&&(t.canvas.setAttribute("dir",d?"ltr":"rtl"),t.direction=d?"ltr":"rtl",t.textAlign=d?ws:Yr),a-=this.getHeightOfLineImpl(o)*this._fontSizeFraction,u)return this._renderChar(e,t,o,0,s.join(""),r,a),void t.restore();for(let k=0,O=s.length-1;k<=O;k++)x=k===O||this.charSpacing||c,C+=s[k],v=this.__charBounds[o][k],A===0?(r+=p*(v.kernedWidth-v.width),A+=v.width):A+=v.kernedWidth,l&&!x&&this._reSpaceAndTab.test(s[k])&&(x=!0),x||(g=g||this.getCompleteStyleDeclaration(o,k),b=this.getCompleteStyleDeclaration(o,k+1),x=H_(g,b,!1)),x&&(c?(t.save(),t.translate(v.renderLeft,v.renderTop),t.rotate(v.angle),this._renderChar(e,t,o,k,C,-A/2,0),t.restore()):(S=r,this._renderChar(e,t,o,k,C,S,a)),C="",g=b,r+=p*A,A=0);t.restore()}_applyPatternGradientTransformText(e){const t=this.width+this.strokeWidth,s=this.height+this.strokeWidth,r=Dl({width:t,height:s}),a=r.getContext("2d");return r.width=t,r.height=s,a.beginPath(),a.moveTo(0,0),a.lineTo(t,0),a.lineTo(t,s),a.lineTo(0,s),a.closePath(),a.translate(t/2,s/2),a.fillStyle=e.toLive(a),this._applyPatternGradientTransform(a,e),a.fill(),a.createPattern(r,"no-repeat")}handleFiller(e,t,s){let r,a;return uc(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?(r=-this.width/2,a=-this.height/2,e.translate(r,a),e[t]=this._applyPatternGradientTransformText(s),{offsetX:r,offsetY:a}):(e[t]=s.toLive(e),this._applyPatternGradientTransform(e,s)):(e[t]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(e,t){let{stroke:s,strokeWidth:r}=t;return e.lineWidth=r,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",s)}_setFillStyles(e,t){let{fill:s}=t;return this.handleFiller(e,"fillStyle",s)}_renderChar(e,t,s,r,a,o,l){const c=this._getStyleDeclaration(s,r),u=this.getCompleteStyleDeclaration(s,r),d=e==="fillText"&&u.fill,p=e==="strokeText"&&u.stroke&&u.strokeWidth;if(p||d){if(t.save(),t.font=this._getFontDeclaration(u),c.textBackgroundColor&&this._removeShadow(t),c.deltaY&&(l+=c.deltaY),d){const m=this._setFillStyles(t,u);t.fillText(a,o-m.offsetX,l-m.offsetY)}if(p){const m=this._setStrokeStyles(t,u);t.strokeText(a,o-m.offsetX,l-m.offsetY)}t.restore()}}setSuperscript(e,t){this._setScript(e,t,this.superscript)}setSubscript(e,t){this._setScript(e,t,this.subscript)}_setScript(e,t,s){const r=this.get2DCursorLocation(e,!0),a=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),o=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),l={fontSize:a*s.size,deltaY:o+a*s.baseline};this.setSelectionStyles(l,e,t)}_getLineLeftOffset(e){const t=this.getLineWidth(e),s=this.width-t,r=this.textAlign,a=this.direction,o=this.isEndOfWrapping(e);let l=0;return r===Qu||r===dv&&!o||r===hv&&!o||r===CC&&!o?0:(r===In&&(l=s/2),r===Yr&&(l=s),r===dv&&(l=s/2),r===hv&&(l=s),a==="rtl"&&(r===Yr||r===Qu||r===hv?l=0:r===ws||r===CC?l=-s:r!==In&&r!==dv||(l=-s/2)),l)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(e){if(this.__lineWidths[e]!==void 0)return this.__lineWidths[e];const{width:t}=this.measureLine(e);return this.__lineWidths[e]=t,t}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(e,t,s){var r;return(r=this._getStyleDeclaration(e,t)[s])!==null&&r!==void 0?r:this[s]}_renderTextDecoration(e,t){if(!this[t]&&!this.styleHas(t))return;let s=this._getTopOffset();const r=this._getLeftOffset(),a=this.path,o=this._getWidthOfCharSpacing(),l=t==="linethrough"?.5:t==="overline"?1:0,c=this.offsets[t];for(let u=0,d=this._textLines.length;u<d;u++){const p=this.getHeightOfLine(u);if(!this[t]&&!this.styleHas(t,u)){s+=p;continue}const m=this._textLines[u],g=p/this.lineHeight,b=this._getLineLeftOffset(u);let v=0,x=0,S=this.getValueOfPropertyAt(u,0,t),C=this.getValueOfPropertyAt(u,0,mi),A=this.getValueOfPropertyAt(u,0,Sm),k=S,O=C,F=A;const $=s+g*(1-this._fontSizeFraction);let M=this.getHeightOfChar(u,0),R=this.getValueOfPropertyAt(u,0,"deltaY");for(let j=0,H=m.length;j<H;j++){const q=this.__charBounds[u][j];k=this.getValueOfPropertyAt(u,j,t),O=this.getValueOfPropertyAt(u,j,mi),F=this.getValueOfPropertyAt(u,j,Sm);const re=this.getHeightOfChar(u,j),X=this.getValueOfPropertyAt(u,j,"deltaY");if(a&&k&&O){const ne=this.fontSize*F/1e3;e.save(),e.fillStyle=C,e.translate(q.renderLeft,q.renderTop),e.rotate(q.angle),e.fillRect(-q.kernedWidth/2,c*re+X-l*ne,q.kernedWidth,ne),e.restore()}else if((k!==S||O!==C||re!==M||F!==A||X!==R)&&x>0){const ne=this.fontSize*A/1e3;let Q=r+b+v;this.direction==="rtl"&&(Q=this.width-Q-x),S&&C&&A&&(e.fillStyle=C,e.fillRect(Q,$+c*M+R-l*ne,x,ne)),v=q.left,x=q.width,S=k,A=F,C=O,M=re,R=X}else x+=q.kernedWidth}let z=r+b+v;this.direction==="rtl"&&(z=this.width-z-x),e.fillStyle=O;const I=this.fontSize*F/1e3;k&&O&&F&&e.fillRect(z,$+c*M+R-l*I,x-o,I),s+=p}this._removeShadow(e)}_getFontDeclaration(){let{fontFamily:e=this.fontFamily,fontStyle:t=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:r=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;const o=e.includes("'")||e.includes('"')||e.includes(",")||Za.genericFonts.includes(e.toLowerCase())?e:'"'.concat(e,'"');return[t,s,"".concat(a?this.CACHE_FONT_SIZE:r,"px"),o].join(" ")}render(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(e)))}graphemeSplit(e){return W_(e)}_splitTextIntoLines(e){const t=e.split(this._reNewline),s=new Array(t.length),r=[`
`];let a=[];for(let o=0;o<t.length;o++)s[o]=this.graphemeSplit(t[o]),a=a.concat(s[o],r);return a.pop(),{_unwrappedLines:s,lines:t,graphemeText:a,graphemeLines:s}}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ie(Ie({},super.toObject([...t8,...e])),{},{styles:g8(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(e,t){const{textLayoutProperties:s}=this.constructor;super.set(e,t);let r=!1,a=!1;if(typeof e=="object")for(const o in e)o==="path"&&this.setPathInfo(),r=r||s.includes(o),a=a||o==="path";else r=s.includes(e),a=e==="path";return a&&this.setPathInfo(),r&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(e,t,s){const r=Ed(e,Za.ATTRIBUTE_NAMES,s),a=Ie(Ie({},t),r),{textAnchor:o=ws,textDecoration:l="",dx:c=0,dy:u=0,top:d=0,left:p=0,fontSize:m=oO,strokeWidth:g=1}=a,b=ar(a,vJ),v=new this(SC(e.textContent||"").trim(),Ie({left:p+c,top:d+u,underline:l.includes("underline"),overline:l.includes("overline"),linethrough:l.includes("line-through"),strokeWidth:0,fontSize:m},b)),x=v.getScaledHeight()/v.height,S=((v.height+v.strokeWidth)*v.lineHeight-v.height)*x,C=v.getScaledHeight()+S;let A=0;return o===In&&(A=v.getScaledWidth()/2),o===Yr&&(A=v.getScaledWidth()),v.set({left:v.left-A,top:v.top-(C-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:g}),v}static fromObject(e){return this._fromObject(Ie(Ie({},e),{},{styles:y8(e.styles||{},e.text)}),{extraParam:"text"})}}ke(Za,"textLayoutProperties",e8),ke(Za,"cacheProperties",[...Ad,...t8]),ke(Za,"ownDefaults",DK),ke(Za,"type","Text"),ke(Za,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),ke(Za,"ATTRIBUTE_NAMES",tp.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),h8(Za,[class extends Zj{_toSVG(){const n=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(n){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:n,noStyle:!0,withShadow:!0}),t=this.path;return t?e+t._createBaseSVGMarkup(t._toSVG(),{reviver:n,withShadow:!0,additionalTransform:P0(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(n){let{textBgRects:e,textSpans:t}=n;const s=this.getSvgTextDecoration(this);return[e.join(""),'		<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(bJ,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",s?'text-decoration="'.concat(s,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.join(""),`</text>
`]}_getSVGTextAndBg(n,e){const t=[],s=[];let r,a=n;this.backgroundColor&&s.push(...a5(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,l=this._textLines.length;o<l;o++)r=this._getLineLeftOffset(o),this.direction==="rtl"&&(r+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(s,o,e+r,a),this._setSVGTextLineText(t,o,e+r,a),a+=this.getHeightOfLine(o);return{textSpans:t,textBgRects:s}}_createTextCharSpan(n,e,t,s,r){const a=ds.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,n!==n.trim()||!!n.match(yJ)),l=o?'style="'.concat(o,'"'):"",c=e.deltaY,u=c?' dy="'.concat(Hs(c,a),'" '):"",{angle:d,renderLeft:p,renderTop:m,width:g}=r;let b="";if(p!==void 0){const v=g/2;d&&(b=' rotate="'.concat(Hs(yh(d),a),'"'));const x=Xm({angle:yh(d)});x[4]=p,x[5]=m;const S=new Ve(-v,0).transform(x);t=S.x,s=S.y}return'<tspan x="'.concat(Hs(t,a),'" y="').concat(Hs(s,a),'" ').concat(u).concat(b).concat(l,">").concat(m8(n),"</tspan>")}_setSVGTextLineText(n,e,t,s){const r=this.getHeightOfLine(e),a=this.textAlign.includes(Qu),o=this._textLines[e];let l,c,u,d,p,m="",g=0;s+=r*(1-this._fontSizeFraction)/this.lineHeight;for(let b=0,v=o.length-1;b<=v;b++)p=b===v||this.charSpacing||this.path,m+=o[b],u=this.__charBounds[e][b],g===0?(t+=u.kernedWidth-u.width,g+=u.width):g+=u.kernedWidth,a&&!p&&this._reSpaceAndTab.test(o[b])&&(p=!0),p||(l=l||this.getCompleteStyleDeclaration(e,b),c=this.getCompleteStyleDeclaration(e,b+1),p=H_(l,c,!0)),p&&(d=this._getStyleDeclaration(e,b),n.push(this._createTextCharSpan(m,d,t,s,u)),m="",l=c,this.direction==="rtl"?t-=g:t+=g,g=0)}_setSVGTextLineBg(n,e,t,s){const r=this._textLines[e],a=this.getHeightOfLine(e)/this.lineHeight;let o,l=0,c=0,u=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let d=0;d<r.length;d++){const{left:p,width:m,kernedWidth:g}=this.__charBounds[e][d];o=this.getValueOfPropertyAt(e,d,"textBackgroundColor"),o!==u?(u&&n.push(...a5(u,t+c,s,l,a)),c=p,l=m,u=o):l+=g}o&&n.push(...a5(u,t+c,s,l,a))}_getSVGLineTopOffset(n){let e,t=0;for(e=0;e<n;e++)t+=this.getHeightOfLine(e);const s=this.getHeightOfLine(e);return{lineTop:t,offset:(this._fontSizeMult-this._fontSizeFraction)*s/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(n){return"".concat(super.getSvgStyles(n)," text-decoration-thickness: ").concat(Hs(this.textDecorationThickness*this.getObjectScaling().y/10,ds.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(n,e){const{fontFamily:t,strokeWidth:s,stroke:r,fill:a,fontSize:o,fontStyle:l,fontWeight:c,deltaY:u,textDecorationThickness:d,linethrough:p,overline:m,underline:g}=n,b=this.getSvgTextDecoration({underline:g??this.underline,overline:m??this.overline,linethrough:p??this.linethrough}),v=d||this.textDecorationThickness;return[r?Sv(so,r):"",s?"stroke-width: ".concat(s,"; "):"",t?"font-family: ".concat(t.includes("'")||t.includes('"')?t:"'".concat(t,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",l?"font-style: ".concat(l,"; "):"",c?"font-weight: ".concat(c,"; "):"",b?"text-decoration: ".concat(b,"; text-decoration-thickness: ").concat(Hs(v*this.getObjectScaling().y/10,ds.NUM_FRACTION_DIGITS),"%; "):"",a?Sv(mi,a):"",u?"baseline-shift: ".concat(-u,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(n){return["overline","underline","line-through"].filter((e=>n[e.replace("-","")])).join(" ")}}]),Nt.setClass(Za),Nt.setSVGClass(Za);class wJ{constructor(e){ke(this,"target",void 0),ke(this,"__mouseDownInPlace",!1),ke(this,"__dragStartFired",!1),ke(this,"__isDraggingOver",!1),ke(this,"__dragStartSelection",void 0),ke(this,"__dragImageDisposer",void 0),ke(this,"_dispose",void 0),this.target=e;const t=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{t.forEach((s=>s())),this._dispose=void 0}}isPointerOverSelection(e){const t=this.target,s=t.getSelectionStartFromPointer(e);return t.isEditing&&s>=t.selectionStart&&s<=t.selectionEnd&&t.selectionStart<t.selectionEnd}start(e){return this.__mouseDownInPlace=this.isPointerOverSelection(e)}isActive(){return this.__mouseDownInPlace}end(e){const t=this.isActive();return t&&!this.__dragStartFired&&(this.target.setCursorByClick(e),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,t}getDragStartSelection(){return this.__dragStartSelection}setDragImage(e,t){var s;let{selectionStart:r,selectionEnd:a}=t;const o=this.target,l=o.canvas,c=new Ve(o.flipX?-1:1,o.flipY?-1:1),u=o._getCursorBoundaries(r),d=new Ve(u.left+u.leftOffset,u.top+u.topOffset).multiply(c).transform(o.calcTransformMatrix()),p=l.getScenePoint(e).subtract(d),m=o.getCanvasRetinaScaling(),g=o.getBoundingRect(),b=d.subtract(new Ve(g.left,g.top)),v=l.viewportTransform,x=b.add(p).transform(v,!0),S=o.backgroundColor,C=kO(o.styles);o.backgroundColor="";const A={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(A,0,r),o.setSelectionStyles(A,a,o.text.length),o.dirty=!0;const k=o.toCanvasElement({enableRetinaScaling:l.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=S,o.styles=C,o.dirty=!0,OC(k,{position:"fixed",left:"".concat(-k.width,"px"),border:no,width:"".concat(k.width/m,"px"),height:"".concat(k.height/m,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{k.remove()},su(e.target||this.target.hiddenTextarea).body.appendChild(k),(s=e.dataTransfer)===null||s===void 0||s.setDragImage(k,x.x,x.y)}onDragStart(e){this.__dragStartFired=!0;const t=this.target,s=this.isActive();if(s&&e.dataTransfer){const r=this.__dragStartSelection={selectionStart:t.selectionStart,selectionEnd:t.selectionEnd},a=t._text.slice(r.selectionStart,r.selectionEnd).join(""),o=Ie({text:t.text,value:a},r);e.dataTransfer.setData("text/plain",a),e.dataTransfer.setData("application/fabric",JSON.stringify({value:a,styles:t.getSelectionStyles(r.selectionStart,r.selectionEnd,!0)})),e.dataTransfer.effectAllowed="copyMove",this.setDragImage(e,o)}return t.abortCursorAnimation(),s}canDrop(e){if(this.target.editable&&!this.target.getActiveControl()&&!e.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const t=this.target.getSelectionStartFromPointer(e),s=this.__dragStartSelection;return t<s.selectionStart||t>s.selectionEnd}return!0}return!1}targetCanDrop(e){return this.target.canDrop(e)}dragEnterHandler(e){let{e:t}=e;const s=this.targetCanDrop(t);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(e){const{e:t}=e,s=this.targetCanDrop(t);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(t.preventDefault(),e.canDrop=!0,e.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(e){var t;const{e:s}=e,r=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let a=(t=s.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain");if(a&&!r){const o=this.target,l=o.canvas;let c=o.getSelectionStartFromPointer(s);const{styles:u}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},d=a[Math.max(0,a.length-1)],p=0;if(this.__dragStartSelection){const m=this.__dragStartSelection.selectionStart,g=this.__dragStartSelection.selectionEnd;c>m&&c<=g?c=m:c>g&&(c-=g-m),o.removeChars(m,g),delete this.__dragStartSelection}o._reNewline.test(d)&&(o._reNewline.test(o._text[c])||c===o._text.length)&&(a=a.trimEnd()),e.didDrop=!0,e.dropTarget=o,o.insertChars(a,u,c),l.setActiveObject(o),o.enterEditing(s),o.selectionStart=Math.min(c+p,o._text.length),o.selectionEnd=Math.min(o.selectionStart+a.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire(yC,{index:c+p,action:"drop"}),l.fire("text:changed",{target:o}),l.contextTopDirty=!0,l.requestRenderAll()}}dragEndHandler(e){let{e:t}=e;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const r=this.target,a=this.target.canvas,{selectionStart:o,selectionEnd:l}=this.__dragStartSelection,c=((s=t.dataTransfer)===null||s===void 0?void 0:s.dropEffect)||no;c===no?(r.selectionStart=o,r.selectionEnd=l,r._updateTextarea(),r.hiddenTextarea.focus()):(r.clearContextTop(),c==="move"&&(r.removeChars(o,l),r.selectionStart=r.selectionEnd=o,r.hiddenTextarea&&(r.hiddenTextarea.value=r.text),r._updateTextarea(),r.fire(yC,{index:o,action:"dragend"}),a.fire("text:changed",{target:r}),a.requestRenderAll()),r.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const I6=/[ \n\.,;!\?\-]/;class xJ extends Za{constructor(){super(...arguments),ke(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(e){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(e)}_animateCursor(e){let{toValue:t,duration:s,delay:r,onComplete:a}=e;return CO({startValue:this._currentCursorOpacity,endValue:t,duration:s,delay:r,onComplete:a,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(e){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(e||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var e;(e=this._currentTickCompleteState)===null||e===void 0||e.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(e){this.abortCursorAnimation(),this._tick(e?0:this.cursorDelay)}abortCursorAnimation(){let e=!1;[this._currentTickState,this._currentTickCompleteState].forEach((t=>{t&&!t.isDone()&&(e=!0,t.abort())})),this._currentCursorOpacity=1,e&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((e=>!e||e.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(e){let t=0,s=e-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)t++,s--;for(;/\S/.test(this._text[s])&&s>-1;)t++,s--;return e-t}findWordBoundaryRight(e){let t=0,s=e;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)t++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)t++,s++;return e+t}findLineBoundaryLeft(e){let t=0,s=e-1;for(;!/\n/.test(this._text[s])&&s>-1;)t++,s--;return e-t}findLineBoundaryRight(e){let t=0,s=e;for(;!/\n/.test(this._text[s])&&s<this._text.length;)t++,s++;return e+t}searchWordBoundary(e,t){const s=this._text;let r=e>0&&this._reSpace.test(s[e])&&(t===-1||!lO.test(s[e-1]))?e-1:e,a=s[r];for(;r>0&&r<s.length&&!I6.test(a);)r+=t,a=s[r];return t===-1&&I6.test(a)&&r++,r}selectWord(e){var t;e=(t=e)!==null&&t!==void 0?t:this.selectionStart;const s=this.searchWordBoundary(e,-1),r=Math.max(s,this.searchWordBoundary(e,1));this.selectionStart=s,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(e){var t;e=(t=e)!==null&&t!==void 0?t:this.selectionStart;const s=this.findLineBoundaryLeft(e),r=this.findLineBoundaryRight(e);this.selectionStart=s,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(e){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",e?{e}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(e){if(this.getActiveControl())return;const t=this.hiddenTextarea;su(t).activeElement!==t&&t.focus();const s=this.getSelectionStartFromPointer(e),r=this.selectionStart,a=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&r!==a||r!==s&&a!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===r&&this.selectionEnd===a||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(e,t,s){const r=s.slice(0,e),a=this.graphemeSplit(r).length;if(e===t)return{selectionStart:a,selectionEnd:a};const o=s.slice(e,t);return{selectionStart:a,selectionEnd:a+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(e,t,s){const r=s.slice(0,e).join("").length;return e===t?{selectionStart:r,selectionEnd:r}:{selectionStart:r,selectionEnd:r+s.slice(e,t).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const e=this.hiddenTextarea;this.text=e.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const t=this.fromStringToGraphemeSelection(e.selectionStart,e.selectionEnd,e.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),s=this.get2DCursorLocation(e),r=s.lineIndex,a=s.charIndex,o=this.getValueOfPropertyAt(r,a,"fontSize")*this.lineHeight,l=t.leftOffset,c=this.getCanvasRetinaScaling(),u=this.canvas.upperCanvasEl,d=u.width/c,p=u.height/c,m=d-o,g=p-o,b=new Ve(t.left+l,t.top+t.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new Ve(u.clientWidth/d,u.clientHeight/p));return b.x<0&&(b.x=0),b.x>m&&(b.x=m),b.y<0&&(b.y=0),b.y>g&&(b.y=g),b.x+=this.canvas._offset.left,b.y+=this.canvas._offset.top,{left:"".concat(b.x,"px"),top:"".concat(b.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const e=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const e=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),e&&this.fire(bC),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const e in this.styles)this._textLines[e]||delete this.styles[e]}removeStyleFromTo(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e,!0),{lineIndex:a,charIndex:o}=this.get2DCursorLocation(t,!0);if(s!==a){if(this.styles[s])for(let l=r;l<this._unwrappedTextLines[s].length;l++)delete this.styles[s][l];if(this.styles[a])for(let l=o;l<this._unwrappedTextLines[a].length;l++){const c=this.styles[a][l];c&&(this.styles[s]||(this.styles[s]={}),this.styles[s][r+l-o]=c)}for(let l=s+1;l<=a;l++)delete this.styles[l];this.shiftLineStyles(a,s-a)}else if(this.styles[s]){const l=this.styles[s],c=o-r;for(let u=r;u<o;u++)delete l[u];for(const u in this.styles[s]){const d=parseInt(u,10);d>=o&&(l[d-c]=l[u],delete l[u])}}}shiftLineStyles(e,t){const s=Object.assign({},this.styles);for(const r in this.styles){const a=parseInt(r,10);a>e&&(this.styles[a+t]=s[a],s[a-t]||delete this.styles[a])}}insertNewlineStyleObject(e,t,s,r){const a={},o=this._unwrappedTextLines[e].length,l=o===t;let c=!1;s||(s=1),this.shiftLineStyles(e,s);const u=this.styles[e]?this.styles[e][t===0?t:t-1]:void 0;for(const p in this.styles[e]){const m=parseInt(p,10);m>=t&&(c=!0,a[m-t]=this.styles[e][p],l&&t===0||delete this.styles[e][p])}let d=!1;for(c&&!l&&(this.styles[e+s]=a,d=!0),(d||o>t)&&s--;s>0;)r&&r[s-1]?this.styles[e+s]={0:Ie({},r[s-1])}:u?this.styles[e+s]={0:Ie({},u)}:delete this.styles[e+s],s--;this._forceClearCache=!0}insertCharStyleObject(e,t,s,r){this.styles||(this.styles={});const a=this.styles[e],o=a?Ie({},a):{};s||(s=1);for(const c in o){const u=parseInt(c,10);u>=t&&(a[u+s]=o[u],o[u-s]||delete a[u])}if(this._forceClearCache=!0,r){for(;s--;)Object.keys(r[s]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+s]=Ie({},r[s]));return}if(!a)return;const l=a[t?t-1:1];for(;l&&s--;)this.styles[e][t+s]=Ie({},l)}insertNewStyleBlock(e,t,s){const r=this.get2DCursorLocation(t,!0),a=[0];let o,l=0;for(let c=0;c<e.length;c++)e[c]===`
`?(l++,a[l]=0):a[l]++;for(a[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,a[0],s),s=s&&s.slice(a[0]+1)),l&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+a[0],l),o=1;o<l;o++)a[o]>0?this.insertCharStyleObject(r.lineIndex+o,0,a[o],s):s&&this.styles[r.lineIndex+o]&&s[0]&&(this.styles[r.lineIndex+o][0]=s[0]),s=s&&s.slice(a[o]+1);a[o]>0&&this.insertCharStyleObject(r.lineIndex+o,0,a[o],s)}removeChars(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e+1;this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;r>s&&this.removeStyleFromTo(s,r);const a=this.graphemeSplit(e);this.insertNewStyleBlock(a,s,t),this._text=[...this._text.slice(0,s),...a,...this._text.slice(r)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(e,t,s){s<=e?(t===e?this._selectionDirection=ws:this._selectionDirection===Yr&&(this._selectionDirection=ws,this.selectionEnd=e),this.selectionStart=s):s>e&&s<t?this._selectionDirection===Yr?this.selectionEnd=s:this.selectionStart=s:(t===e?this._selectionDirection=Yr:this._selectionDirection===ws&&(this._selectionDirection=Yr,this.selectionStart=t),this.selectionEnd=s)}}class SJ extends xJ{initHiddenTextarea(){const e=this.canvas&&su(this.canvas.getElement())||a1(),t=e.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off",name:"fabricTextarea"}).map((o=>{let[l,c]=o;return t.setAttribute(l,c)}));const{top:s,left:r,fontSize:a}=this._calcTextareaPosition();t.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(r,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(a,";"),(this.hiddenTextareaContainer||e.body).appendChild(t),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((o=>{let[l,c]=o;return t.addEventListener(l,this[c].bind(this))})),this.hiddenTextarea=t}blur(){this.abortCursorAnimation()}onKeyDown(e){if(!this.isEditing)return;const t=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(e){const t=this.fromPaste,{value:s,selectionStart:r,selectionEnd:a}=this.hiddenTextarea;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;const o=()=>{this.updateFromTextArea(),this.fire(yC),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void o();const l=this._splitTextIntoLines(s).graphemeText,c=this._text.length,u=l.length,d=this.selectionStart,p=this.selectionEnd,m=d!==p;let g,b,v,x,S=u-c;const C=this.fromStringToGraphemeSelection(r,a,s),A=d>C.selectionStart;m?(b=this._text.slice(d,p),S+=p-d):u<c&&(b=A?this._text.slice(p+S,p):this._text.slice(d,d-S));const k=l.slice(C.selectionEnd-S,C.selectionEnd);if(b&&b.length&&(k.length&&(g=this.getSelectionStyles(d,d+1,!1),g=k.map((()=>g[0]))),m?(v=d,x=p):A?(v=p-b.length,x=p):(v=p,x=p+b.length),this.removeStyleFromTo(v,x)),k.length){const{copyPasteData:O}=mh();t&&k.join("")===O.copiedText&&!ds.disableStyleCopyPaste&&(g=O.copiedTextStyle),this.insertNewStyleBlock(k,d,g)}o()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(e){let{target:t}=e;const{selectionStart:s,selectionEnd:r}=t;this.compositionStart=s,this.compositionEnd=r,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:e}=mh();e.copiedText=this.getSelectedText(),ds.disableStyleCopyPaste?e.copiedTextStyle=void 0:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(e,t){let s,r=this._getLineLeftOffset(e);return t>0&&(s=this.__charBounds[e][t-1],r+=s.left+s.width),r}getDownCursorOffset(e,t){const s=this._getSelectionForOffset(e,t),r=this.get2DCursorLocation(s),a=r.lineIndex;if(a===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-s;const o=r.charIndex,l=this._getWidthBeforeCursor(a,o),c=this._getIndexOnLine(a+1,l);return this._textLines[a].slice(o).length+c+1+this.missingNewlineOffset(a)}_getSelectionForOffset(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart}getUpCursorOffset(e,t){const s=this._getSelectionForOffset(e,t),r=this.get2DCursorLocation(s),a=r.lineIndex;if(a===0||e.metaKey||e.keyCode===33)return-s;const o=r.charIndex,l=this._getWidthBeforeCursor(a,o),c=this._getIndexOnLine(a-1,l),u=this._textLines[a].slice(0,o),d=this.missingNewlineOffset(a-1);return-this._textLines[a-1].length+c-u.length+(1-d)}_getIndexOnLine(e,t){const s=this._textLines[e];let r,a,o=this._getLineLeftOffset(e),l=0;for(let c=0,u=s.length;c<u;c++)if(r=this.__charBounds[e][c].width,o+=r,o>t){a=!0;const d=o-r,p=o,m=Math.abs(d-t);l=Math.abs(p-t)<m?c:c-1;break}return a||(l=s.length-1),l}moveCursorDown(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)}moveCursorUp(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",e)}_moveCursorUpOrDown(e,t){const s=this["get".concat(e,"CursorOffset")](t,this._selectionDirection===Yr);if(t.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),s!==0){const r=this.text.length;this.selectionStart=Cm(0,this.selectionStart,r),this.selectionEnd=Cm(0,this.selectionEnd,r),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(e){const t=this._selectionDirection===ws?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),e!==0}moveCursorWithoutShift(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0}moveCursorLeft(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",e)}_move(e,t,s){let r;if(e.altKey)r=this["findWordBoundary".concat(s)](this[t]);else{if(!e.metaKey&&e.keyCode!==35&&e.keyCode!==36)return this[t]+=s==="Left"?-1:1,!0;r=this["findLineBoundary".concat(s)](this[t])}return r!==void 0&&this[t]!==r&&(this[t]=r,!0)}_moveLeft(e,t){return this._move(e,t,"Left")}_moveRight(e,t){return this._move(e,t,"Right")}moveCursorLeftWithoutShift(e){let t=!0;return this._selectionDirection=ws,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t}moveCursorLeftWithShift(e){return this._selectionDirection===Yr&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=ws,this._moveLeft(e,"selectionStart")):void 0}moveCursorRight(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)}_moveCursorLeftOrRight(e,t){const s="moveCursor".concat(e).concat(t.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(e){return this._selectionDirection===ws&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=Yr,this._moveRight(e,"selectionEnd")):void 0}moveCursorRightWithoutShift(e){let t=!0;return this._selectionDirection=Yr,this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t}}const O6=n=>!!n.button;class CJ extends SJ{constructor(){super(...arguments),ke(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new wJ(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(e){return this.draggableTextDelegate.onDragStart(e)}canDrop(e){return this.draggableTextDelegate.canDrop(e)}doubleClickHandler(e){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}tripleClickHandler(e){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}_mouseDownHandler(e){let{e:t,alreadySelected:s}=e;this.canvas&&this.editable&&!O6(t)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(t)||(this.canvas.textEditingManager.register(this),s&&(this.inCompositionMode=!1,this.setCursorByClick(t)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=s||this.isEditing)))}mouseUpHandler(e){let{e:t,transform:s}=e;const r=this.draggableTextDelegate.end(t);if(this.canvas){this.canvas.textEditingManager.unregister(this);const a=this.canvas._activeObject;if(a&&a!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||O6(t)||r||this.selected&&!this.getActiveControl()&&(this.enterEditing(t),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(e){const t=this.getSelectionStartFromPointer(e),s=this.selectionStart,r=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(s,r,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(e){const t=this.canvas.getScenePoint(e).transform(jo(this.calcTransformMatrix())).add(new Ve(-this._getLeftOffset(),-this._getTopOffset()));let s=0,r=0,a=0;for(let u=0;u<this._textLines.length&&s<=t.y;u++)s+=this.getHeightOfLine(u),a=u,u>0&&(r+=this._textLines[u-1].length+this.missingNewlineOffset(u-1));let o=Math.abs(this._getLineLeftOffset(a));const l=this._textLines[a].length,c=this.__charBounds[a];for(let u=0;u<l;u++){const d=o+c[u].kernedWidth;if(t.x<=d){Math.abs(t.x-d)<=Math.abs(t.x-o)&&r++;break}o=d,r++}return Math.min(this.flipX?l-r:r,this._text.length)}}const lS="moveCursorUp",cS="moveCursorDown",uS="moveCursorLeft",hS="moveCursorRight",dS="exitEditing",D6=(n,e)=>{const t=e.getRetinaScaling();n.setTransform(t,0,0,t,0,0);const s=e.viewportTransform;n.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_J=Ie({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:dS,27:dS,33:lS,34:cS,35:hS,36:uS,37:uS,38:lS,39:hS,40:cS},keysMapRtl:{9:dS,27:dS,33:lS,34:cS,35:uS,36:hS,37:hS,38:lS,39:uS,40:cS},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class sh extends CJ{static getDefaults(){return Ie(Ie({},super.getDefaults()),sh.ownDefaults)}get type(){const e=super.type;return e==="itext"?"i-text":e}constructor(e,t){super(e,Ie(Ie({},sh.ownDefaults),t)),this.initBehavior()}_set(e,t){return this.isEditing&&this._savedProps&&e in this._savedProps?(this._savedProps[e]=t,this):(e==="canvas"&&(this.canvas instanceof vE&&this.canvas.textEditingManager.remove(this),t instanceof vE&&t.textEditingManager.add(this)),super._set(e,t))}setSelectionStart(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)}setSelectionEnd(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)}_updateAndFire(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(e,t,s)}setSelectionStyles(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(e,t,s)}get2DCursorLocation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(e,t)}render(e){super.render(e),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(e){const t=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(e);return this.isEditing=t,s}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const e=this.clearContextTop(!0);if(!e)return;const t=this._getCursorBoundaries(),s=this.findAncestorsWithClipPath(),r=s.length>0;let a,o=e;if(r){a=Dl(e.canvas),o=a.getContext("2d"),D6(o,this.canvas);const l=this.calcTransformMatrix();o.transform(l[0],l[1],l[2],l[3],l[4],l[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(o,t):this.renderCursor(o,t),r)for(const l of s){const c=l.clipPath,u=Dl(e.canvas),d=u.getContext("2d");if(D6(d,this.canvas),!c.absolutePositioned){const p=l.calcTransformMatrix();d.transform(p[0],p[1],p[2],p[3],p[4],p[5])}c.transform(d),c.drawObject(d,!0,{}),this.drawClipPathOnCache(o,c,u)}r&&(e.setTransform(1,0,0,1,0,0),e.drawImage(a,0,0)),this.canvas.contextTopDirty=!0,e.restore()}findAncestorsWithClipPath(){const e=[];let t=this;for(;t;)t.clipPath&&e.push(t),t=t.parent;return e}_getCursorBoundaries(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),r=this._getTopOffset(),a=this._getCursorBoundariesOffsets(e,t);return{left:s,top:r,leftOffset:a.left,topOffset:a.top}}_getCursorBoundariesOffsets(e,t){return t?this.__getCursorBoundariesOffsets(e):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(e)}__getCursorBoundariesOffsets(e){let t=0,s=0;const{charIndex:r,lineIndex:a}=this.get2DCursorLocation(e);for(let u=0;u<a;u++)t+=this.getHeightOfLine(u);const o=this._getLineLeftOffset(a),l=this.__charBounds[a][r];l&&(s=l.left),this.charSpacing!==0&&r===this._textLines[a].length&&(s-=this._getWidthOfCharSpacing());const c={top:t,left:o+(s>0?s:0)};return this.direction==="rtl"&&(this.textAlign===Yr||this.textAlign===Qu||this.textAlign===hv?c.left*=-1:this.textAlign===ws||this.textAlign===CC?c.left=o-(s>0?s:0):this.textAlign!==In&&this.textAlign!==dv||(c.left=o-(s>0?s:0))),c}renderCursorAt(e){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(e,!0),e)}renderCursor(e,t){this._renderCursor(e,t,this.selectionStart)}getCursorRenderingData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(e);const s=this.get2DCursorLocation(e),r=s.lineIndex,a=s.charIndex>0?s.charIndex-1:0,o=this.getValueOfPropertyAt(r,a,"fontSize"),l=this.getObjectScaling().x*this.canvas.getZoom(),c=this.cursorWidth/l,u=this.getValueOfPropertyAt(r,a,"deltaY"),d=t.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-o*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(r,a,"fill"),opacity:this._currentCursorOpacity,left:t.left+t.leftOffset-c/2,top:d+t.top+u,width:c,height:o}}_renderCursor(e,t,s){const{color:r,opacity:a,left:o,top:l,width:c,height:u}=this.getCursorRenderingData(s,t);e.fillStyle=r,e.globalAlpha=a,e.fillRect(o,l,c,u)}renderSelection(e,t){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(e,s,t)}renderDragSourceEffect(){const e=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,e,this._getCursorBoundaries(e.selectionStart,!0))}renderDropTargetEffect(e){const t=this.getSelectionStartFromPointer(e);this.renderCursorAt(t)}_renderSelection(e,t,s){const r=t.selectionStart,a=t.selectionEnd,o=this.textAlign.includes(Qu),l=this.get2DCursorLocation(r),c=this.get2DCursorLocation(a),u=l.lineIndex,d=c.lineIndex,p=l.charIndex<0?0:l.charIndex,m=c.charIndex<0?0:c.charIndex;for(let g=u;g<=d;g++){const b=this._getLineLeftOffset(g)||0;let v=this.getHeightOfLine(g),x=0,S=0,C=0;if(g===u&&(S=this.__charBounds[u][p].left),g>=u&&g<d)C=o&&!this.isEndOfWrapping(g)?this.width:this.getLineWidth(g)||5;else if(g===d)if(m===0)C=this.__charBounds[d][m].left;else{const $=this._getWidthOfCharSpacing();C=this.__charBounds[d][m-1].left+this.__charBounds[d][m-1].width-$}x=v,(this.lineHeight<1||g===d&&this.lineHeight>1)&&(v/=this.lineHeight);let A=s.left+b+S,k=v,O=0;const F=C-S;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",k=1,O=v):e.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===Yr||this.textAlign===Qu||this.textAlign===hv?A=this.width-A-F:this.textAlign===ws||this.textAlign===CC?A=s.left+b-C:this.textAlign!==In&&this.textAlign!==dv||(A=s.left+b-C)),e.fillRect(A,s.top+s.topOffset+O,F,k),s.topOffset+=x}}getCurrentCharFontSize(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")}getCurrentCharColor(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,mi)}_getCurrentCharIndex(){const e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}ke(sh,"ownDefaults",_J),ke(sh,"type","IText"),Nt.setClass(sh),Nt.setClass(sh,"i-text");class im extends sh{static getDefaults(){return Ie(Ie({},super.getDefaults()),im.ownDefaults)}constructor(e,t){super(e,Ie(Ie({},im.ownDefaults),t))}static createControls(){return{controls:hZ()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Qu)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(e){let t=0,s=0,r=0;const a={};for(let o=0;o<e.graphemeLines.length;o++)e.graphemeText[r]===`
`&&o>0?(s=0,r++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[r])&&o>0&&(s++,r++),a[o]={line:t,offset:s},r+=e.graphemeLines[o].length,s+=e.graphemeLines[o].length;return a}styleHas(e,t){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];s&&(t=s.line)}return super.styleHas(e,t)}isEmptyStyles(e){if(!this.styles)return!0;let t,s=0,r=e+1,a=!1;const o=this._styleMap[e],l=this._styleMap[e+1];o&&(e=o.line,s=o.offset),l&&(r=l.line,a=r===e,t=l.offset);const c=e===void 0?this.styles:{line:this.styles[e]};for(const u in c)for(const d in c[u]){const p=parseInt(d,10);if(p>=s&&(!a||p<t))for(const m in c[u][d])return!1}return!0}_getStyleDeclaration(e,t){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[e];if(!s)return{};e=s.line,t=s.offset+t}return super._getStyleDeclaration(e,t)}_setStyleDeclaration(e,t,s){const r=this._styleMap[e];super._setStyleDeclaration(r.line,r.offset+t,s)}_deleteStyleDeclaration(e,t){const s=this._styleMap[e];super._deleteStyleDeclaration(s.line,s.offset+t)}_getLineStyle(e){const t=this._styleMap[e];return!!this.styles[t.line]}_setLineStyle(e){const t=this._styleMap[e];super._setLineStyle(t.line)}_wrapText(e,t){this.isWrapping=!0;const s=this.getGraphemeDataForRender(e),r=[];for(let a=0;a<s.wordsData.length;a++)r.push(...this._wrapLine(a,t,s));return this.isWrapping=!1,r}getGraphemeDataForRender(e){const t=this.splitByGrapheme,s=t?"":" ";let r=0;return{wordsData:e.map(((a,o)=>{let l=0;const c=t?this.graphemeSplit(a):this.wordSplit(a);return c.length===0?[{word:[],width:0}]:c.map((u=>{const d=t?[u]:this.graphemeSplit(u),p=this._measureWord(d,o,l);return r=Math.max(p,r),l+=d.length+s.length,{word:d,width:p}}))})),largestWordWidth:r}}_measureWord(e,t){let s,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=0;for(let o=0,l=e.length;o<l;o++)a+=this._getGraphemeBox(e[o],t,o+r,s,!0).kernedWidth,s=e[o];return a}wordSplit(e){return e.split(this._wordJoiners)}_wrapLine(e,t,s){let{largestWordWidth:r,wordsData:a}=s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const l=this._getWidthOfCharSpacing(),c=this.splitByGrapheme,u=[],d=c?"":" ";let p=0,m=[],g=0,b=0,v=!0;t-=o;const x=Math.max(t,r,this.dynamicMinWidth),S=a[e];let C;for(g=0,C=0;C<S.length;C++){const{word:A,width:k}=S[C];g+=A.length,p+=b+k-l,p>x&&!v?(u.push(m),m=[],p=k,v=!0):p+=l,v||c||m.push(d),m=m.concat(A),b=c?0:this._measureWord([d],e,g),g++,v=!1}return C&&u.push(m),r+o>this.dynamicMinWidth&&(this.dynamicMinWidth=r-l+o),u}isEndOfWrapping(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line}missingNewlineOffset(e,t){return this.splitByGrapheme&&!t?this.isEndOfWrapping(e)?1:0:1}_splitTextIntoLines(e){const t=super._splitTextIntoLines(e),s=this._wrapText(t.lines,this.width),r=new Array(s.length);for(let a=0;a<s.length;a++)r[a]=s[a].join("");return t.lines=r,t.graphemeLines=s,t}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const e=new Map;for(const t in this._styleMap){const s=parseInt(t,10);if(this._textLines[s]){const r=this._styleMap[t].line;e.set("".concat(r),!0)}}for(const t in this.styles)e.has(t)||delete this.styles[t]}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...e])}}ke(im,"type","Textbox"),ke(im,"textLayoutProperties",[...sh.textLayoutProperties,"width"]),ke(im,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),Nt.setClass(im);class $6 extends G_{shouldPerformLayout(e){return!!e.target.clipPath&&super.shouldPerformLayout(e)}shouldLayoutClipPath(){return!1}calcLayoutResult(e,t){const{target:s}=e,{clipPath:r,group:a}=s;if(!r||!this.shouldPerformLayout(e))return;const{width:o,height:l}=oh(v8(s,r)),c=new Ve(o,l);if(r.absolutePositioned)return{center:um(r.getRelativeCenterPoint(),void 0,a?a.calcTransformMatrix():void 0),size:c};{const u=r.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(e)){const{center:d=new Ve,correction:p=new Ve}=this.calcBoundingBox(t,e)||{};return{center:d.add(u),correction:p.subtract(u),size:c}}return{center:s.getRelativeCenterPoint().add(u),size:c}}}}ke($6,"type","clip-path"),Nt.setClass($6);class R6 extends G_{getInitialSize(e,t){let{target:s}=e,{size:r}=t;return new Ve(s.width||r.x,s.height||r.y)}}ke(R6,"type","fixed"),Nt.setClass(R6);class kJ extends _v{subscribeTargets(e){const t=e.target;e.targets.reduce(((s,r)=>(r.parent&&s.add(r.parent),s)),new Set).forEach((s=>{s.layoutManager.subscribeTargets({target:s,targets:[t]})}))}unsubscribeTargets(e){const t=e.target,s=t.getObjects();e.targets.reduce(((r,a)=>(a.parent&&r.add(a.parent),r)),new Set).forEach((r=>{!s.some((a=>a.parent===r))&&r.layoutManager.unsubscribeTargets({target:r,targets:[t]})}))}}class iu extends Al{static getDefaults(){return Ie(Ie({},super.getDefaults()),iu.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,iu.ownDefaults),this.setOptions(t);const{left:s,top:r,layoutManager:a}=t;this.groupInit(e,{left:s,top:r,layoutManager:a??new kJ})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.multiSelectionStacking==="selection-order"?this.add(...t):t.forEach((r=>{const a=this._objects.findIndex((l=>l.isInFrontOf(r))),o=a===-1?this.size():a;this.insertAt(o,r)}))}canEnterGroup(e){return this.getObjects().some((t=>t.isDescendantOf(e)||e.isDescendantOf(t)))?(yd("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(e)}enterGroup(e,t){e.parent&&e.parent===e.group?e.parent._exitGroup(e):e.group&&e.parent!==e.group&&e.group.remove(e),this._enterGroup(e,t)}exitGroup(e,t){this._exitGroup(e,t),e.parent&&e.parent._enterGroup(e,!0)}_onAfterObjectsChange(e,t){super._onAfterObjectsChange(e,t);const s=new Set;t.forEach((r=>{const{parent:a}=r;a&&s.add(a)})),e===NO?s.forEach((r=>{r._onAfterObjectsChange(AC,t)})):s.forEach((r=>{r._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(e,t,s){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const r=Ie(Ie({hasControls:!1},s),{},{forActiveSelection:!0});for(let a=0;a<this._objects.length;a++)this._objects[a]._renderControls(e,r);super._renderControls(e,t),e.restore()}}ke(iu,"type","ActiveSelection"),ke(iu,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),Nt.setClass(iu),Nt.setClass(iu,"activeSelection");class TJ{constructor(){ke(this,"resources",{})}applyFilters(e,t,s,r,a){const o=a.getContext("2d");if(!o)return;o.drawImage(t,0,0,s,r);const l={sourceWidth:s,sourceHeight:r,imageData:o.getImageData(0,0,s,r),originalEl:t,originalImageData:o.getImageData(0,0,s,r),canvasEl:a,ctx:o,filterBackend:this};e.forEach((u=>{u.applyTo(l)}));const{imageData:c}=l;return c.width===s&&c.height===r||(a.width=c.width,a.height=c.height),o.putImageData(c,0,0),l}}class j8{constructor(){let{tileSize:e=ds.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ke(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),ke(this,"resources",{}),this.tileSize=e,this.setupGLContext(e,e),this.captureGPUInfo()}setupGLContext(e,t){this.dispose(),this.createWebGLCanvas(e,t)}createWebGLCanvas(e,t){const s=Dl({width:e,height:t}),r=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});r&&(r.clearColor(0,0,0,0),this.canvas=s,this.gl=r)}applyFilters(e,t,s,r,a,o){const l=this.gl,c=a.getContext("2d");if(!l||!c)return;let u;o&&(u=this.getCachedTexture(o,t));const d={originalWidth:t.width||t.naturalWidth||0,originalHeight:t.height||t.naturalHeight||0,sourceWidth:s,sourceHeight:r,destinationWidth:s,destinationHeight:r,context:l,sourceTexture:this.createTexture(l,s,r,u?void 0:t),targetTexture:this.createTexture(l,s,r),originalTexture:u||this.createTexture(l,s,r,u?void 0:t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:a},p=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,p),e.forEach((m=>{m&&m.applyTo(d)})),(function(m){const g=m.targetCanvas,b=g.width,v=g.height,x=m.destinationWidth,S=m.destinationHeight;b===x&&v===S||(g.width=x,g.height=S)})(d),this.copyGLTo2D(l,d),l.bindTexture(l.TEXTURE_2D,null),l.deleteTexture(d.sourceTexture),l.deleteTexture(d.targetTexture),l.deleteFramebuffer(p),c.setTransform(1,0,0,1,0,0),d}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(e,t,s,r,a){const{NEAREST:o,TEXTURE_2D:l,RGBA:c,UNSIGNED_BYTE:u,CLAMP_TO_EDGE:d,TEXTURE_MAG_FILTER:p,TEXTURE_MIN_FILTER:m,TEXTURE_WRAP_S:g,TEXTURE_WRAP_T:b}=e,v=e.createTexture();return e.bindTexture(l,v),e.texParameteri(l,p,a||o),e.texParameteri(l,m,a||o),e.texParameteri(l,g,d),e.texParameteri(l,b,d),r?e.texImage2D(l,0,c,c,u,r):e.texImage2D(l,0,c,t,s,0,c,u,null),v}getCachedTexture(e,t,s){const{textureCache:r}=this;if(r[e])return r[e];{const a=this.createTexture(this.gl,t.width,t.height,t,s);return a&&(r[e]=a),a}}evictCachesForKey(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])}copyGLTo2D(e,t){const s=e.canvas,r=t.targetCanvas,a=r.getContext("2d");if(!a)return;a.translate(0,r.height),a.scale(1,-1);const o=s.height-r.height;a.drawImage(s,0,o,r.width,r.height,0,0,r.width,r.height)}copyGLTo2DPutImageData(e,t){const s=t.targetCanvas.getContext("2d"),r=t.destinationWidth,a=t.destinationHeight,o=r*a*4;if(!s)return;const l=new Uint8Array(this.imageBuffer,0,o),c=new Uint8ClampedArray(this.imageBuffer,0,o);e.readPixels(0,0,r,a,e.RGBA,e.UNSIGNED_BYTE,l);const u=new ImageData(c,r,a);s.putImageData(u,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const e=this.gl,t={renderer:"",vendor:""};if(!e)return t;const s=e.getExtension("WEBGL_debug_renderer_info");if(s){const r=e.getParameter(s.UNMASKED_RENDERER_WEBGL),a=e.getParameter(s.UNMASKED_VENDOR_WEBGL);r&&(t.renderer=r.toLowerCase()),a&&(t.vendor=a.toLowerCase())}return this.gpuInfo=t,t}}let l5;function NJ(){const{WebGLProbe:n}=mh();return n.queryWebGL(gh()),ds.enableGLFiltering&&n.isSupported(ds.textureSize)?new j8({tileSize:ds.textureSize}):new TJ}function c5(){return!l5&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(l5=NJ()),l5}const AJ=["filters","resizeFilter","src","crossOrigin","type"],U8=["cropX","cropY"];class Na extends Da{static getDefaults(){return Ie(Ie({},super.getDefaults()),Na.ownDefaults)}constructor(e,t){super(),ke(this,"_lastScaleX",1),ke(this,"_lastScaleY",1),ke(this,"_filterScalingX",1),ke(this,"_filterScalingY",1),this.filters=[],Object.assign(this,Na.ownDefaults),this.setOptions(t),this.cacheKey="texture".concat(Uf()),this.setElement(typeof e=="string"?(this.canvas&&su(this.canvas.getElement())||a1()).getElementById(e):e,t)}getElement(){return this._element}setElement(e){var t;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=e,this._originalElement=e,this._setWidthHeight(s),(t=e.classList)===null||t===void 0||t.add(Na.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(e){const t=c5(!1);t instanceof j8&&t.evictCachesForKey(e)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((e=>{const t=this[e];t&&mh().dispose(t),this[e]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const e=this.getElement();return e?{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}:{width:0,height:0}}_stroke(e){if(!this.stroke||this.strokeWidth===0)return;const t=this.width/2,s=this.height/2;e.beginPath(),e.moveTo(-t,-s),e.lineTo(t,-s),e.lineTo(t,s),e.lineTo(-t,s),e.lineTo(-t,-s),e.closePath()}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=[];return this.filters.forEach((s=>{s&&t.push(s.toObject())})),Ie(Ie({},super.toObject([...U8,...e])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:t},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const e=[],t=this._element,s=-this.width/2,r=-this.height/2;let a=[],o=[],l="",c="";if(!t)return[];if(this.hasCrop()){const u=Uf();a.push('<clipPath id="imageCrop_'+u+`">
`,'	<rect x="'+s+'" y="'+r+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),l=' clip-path="url(#imageCrop_'+u+')" '}if(this.imageSmoothing||(c=' image-rendering="optimizeSpeed"'),e.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(r-this.cropY,'" width="').concat(t.width||t.naturalWidth,'" height="').concat(t.height||t.naturalHeight,'"').concat(c).concat(l,`></image>
`)),this.stroke||this.strokeDashArray){const u=this.fill;this.fill=null,o=['	<rect x="'.concat(s,'" y="').concat(r,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=u}return a=this.paintFirst!==mi?a.concat(o,e):a.concat(e,o),a}getSrc(e){const t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src")||"":t.src:this.src||""}getSvgSrc(e){return this.getSrc(e)}setSrc(e){let{crossOrigin:t,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return uv(e,{crossOrigin:t,signal:s}).then((r=>{t!==void 0&&this.set({crossOrigin:t}),this.setElement(r)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const e=this.resizeFilter,t=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),r=s.x,a=s.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||r>t&&a>t)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,void(this._lastScaleY=a);const l=Dl(o),{width:c,height:u}=o;this._element=l,this._lastScaleX=e.scaleX=r,this._lastScaleY=e.scaleY=a,c5().applyFilters([e],o,c,u,this._element),this._filterScalingX=l.width/this._originalElement.width,this._filterScalingY=l.height/this._originalElement.height}applyFilters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(e=e.filter((a=>a&&!a.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),e.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const t=this._originalElement,s=t.naturalWidth||t.width,r=t.naturalHeight||t.height;if(this._element===this._originalElement){const a=Dl({width:s,height:r});this._element=a,this._filteredEl=a}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,r),this._lastScaleX=1,this._lastScaleY=1);c5().applyFilters(e,this._originalElement,s,r,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(e){e.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)}drawCacheOnCanvas(e){e.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(e)}shouldCache(){return this.needsItsOwnCache()}_renderFill(e){const t=this._element;if(!t)return;const s=this._filterScalingX,r=this._filterScalingY,a=this.width,o=this.height,l=Math.max(this.cropX,0),c=Math.max(this.cropY,0),u=t.naturalWidth||t.width,d=t.naturalHeight||t.height,p=l*s,m=c*r,g=Math.min(a*s,u-p),b=Math.min(o*r,d-m),v=-a/2,x=-o/2,S=Math.min(a,u/s-l),C=Math.min(o,d/r-c);t&&e.drawImage(t,p,m,g,b,v,x,S,C)}_needsResize(){const e=this.getTotalObjectScaling();return e.x!==this._lastScaleX||e.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:e,height:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this.getOriginalSize();this.width=e||s.width,this.height=t||s.height}parsePreserveAspectRatioAttribute(){const e=vO(this.preserveAspectRatio||""),t=this.width,s=this.height,r={width:t,height:s};let a,o=this._element.width,l=this._element.height,c=1,u=1,d=0,p=0,m=0,g=0;return!e||e.alignX===no&&e.alignY===no?(c=t/o,u=s/l):(e.meetOrSlice==="meet"&&(c=u=x8(this._element,r),a=(t-o*c)/2,e.alignX==="Min"&&(d=-a),e.alignX==="Max"&&(d=a),a=(s-l*u)/2,e.alignY==="Min"&&(p=-a),e.alignY==="Max"&&(p=a)),e.meetOrSlice==="slice"&&(c=u=S8(this._element,r),a=o-t/c,e.alignX==="Mid"&&(m=a/2),e.alignX==="Max"&&(m=a),a=l-s/u,e.alignY==="Mid"&&(g=a/2),e.alignY==="Max"&&(g=a),o=t/c,l=s/u)),{width:o,height:l,scaleX:c,scaleY:u,offsetLeft:d,offsetTop:p,cropX:m,cropY:g}}static fromObject(e,t){let{filters:s,resizeFilter:r,src:a,crossOrigin:o,type:l}=e,c=ar(e,AJ);return Promise.all([uv(a,Ie(Ie({},t),{},{crossOrigin:o})),s&&M0(s,t),r&&M0([r],t),fw(c,t)]).then((u=>{let[d,p=[],[m]=[],g={}]=u;return new this(d,Ie(Ie({},c),{},{src:a,filters:p,resizeFilter:m},g))}))}static fromURL(e){let{crossOrigin:t=null,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return uv(e,{crossOrigin:t,signal:s}).then((a=>new this(a,r)))}static async fromElement(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const r=Ed(e,this.ATTRIBUTE_NAMES,s);return this.fromURL(r["xlink:href"]||r.href,t,r).catch((a=>(yd("log","Unable to parse Image",a),null)))}}function u5(n){if(!FK.test(n.nodeName))return{};const e=n.getAttribute("viewBox");let t,s,r=1,a=1,o=0,l=0;const c=n.getAttribute("width"),u=n.getAttribute("height"),d=n.getAttribute("x")||0,p=n.getAttribute("y")||0,m=!(e&&u6.test(e)),g=!c||!u||c==="100%"||u==="100%";let b="",v=0,x=0;if(m&&(d||p)&&n.parentNode&&n.parentNode.nodeName!=="#document"&&(b=" translate("+Ja(d||"0")+" "+Ja(p||"0")+") ",t=(n.getAttribute("transform")||"")+b,n.setAttribute("transform",t),n.removeAttribute("x"),n.removeAttribute("y")),m&&g)return{width:0,height:0};const S={width:0,height:0};if(m)return S.width=Ja(c),S.height=Ja(u),S;const C=e.match(u6);o=-parseFloat(C[1]),l=-parseFloat(C[2]);const A=parseFloat(C[3]),k=parseFloat(C[4]);S.minX=o,S.minY=l,S.viewBoxWidth=A,S.viewBoxHeight=k,g?(S.width=A,S.height=k):(S.width=Ja(c),S.height=Ja(u),r=S.width/A,a=S.height/k);const O=vO(n.getAttribute("preserveAspectRatio")||"");if(O.alignX!==no&&(O.meetOrSlice==="meet"&&(a=r=r>a?a:r),O.meetOrSlice==="slice"&&(a=r=r>a?r:a),v=S.width-A*r,x=S.height-k*r,O.alignX==="Mid"&&(v/=2),O.alignY==="Mid"&&(x/=2),O.alignX==="Min"&&(v=0),O.alignY==="Min"&&(x=0)),r===1&&a===1&&o===0&&l===0&&d===0&&p===0)return S;if((d||p)&&n.parentNode.nodeName!=="#document"&&(b=" translate("+Ja(d||"0")+" "+Ja(p||"0")+") "),t=b+" matrix("+r+" 0 0 "+a+" "+(o*r+v)+" "+(l*a+x)+") ",n.nodeName==="svg"){for(s=n.ownerDocument.createElementNS(dE,"g");n.firstChild;)s.appendChild(n.firstChild);n.appendChild(s)}else s=n,s.removeAttribute("x"),s.removeAttribute("y"),t=s.getAttribute("transform")+t;return s.setAttribute("transform",t),S}ke(Na,"type","Image"),ke(Na,"cacheProperties",[...Ad,...U8]),ke(Na,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),ke(Na,"CSS_CANVAS","canvas-img"),ke(Na,"ATTRIBUTE_NAMES",[...tp,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),Nt.setClass(Na),Nt.setSVGClass(Na);const $C=n=>n.tagName.replace("svg:",""),EJ=j_(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function V8(n,e){let t,s,r,a,o=[];for(r=0,a=e.length;r<a;r++)t=e[r],s=n.getElementsByTagNameNS("http://www.w3.org/2000/svg",t),o=o.concat(Array.from(s));return o}const IJ=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],h5="xlink:href";function W8(n,e){var t;const s=((t=e.getAttribute(h5))===null||t===void 0?void 0:t.slice(1))||"",r=n.getElementById(s);if(r&&r.getAttribute(h5)&&W8(n,r),r&&(IJ.forEach((a=>{const o=r.getAttribute(a);!e.hasAttribute(a)&&o&&e.setAttribute(a,o)})),!e.children.length)){const a=r.cloneNode(!0);for(;a.firstChild;)e.appendChild(a.firstChild)}e.removeAttribute(h5)}const OJ=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function DJ(n){const e=n.getElementsByTagName("style"),t={};for(let s=0;s<e.length;s++){const r=(e[s].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");r.trim()!==""&&r.split("}").filter(((a,o,l)=>l.length>1&&a.trim())).forEach((a=>{if((a.match(/{/g)||[]).length>1&&a.trim().startsWith("@"))return;const o=a.split("{"),l={},c=o[1].trim().split(";").filter((function(u){return u.trim()}));for(let u=0;u<c.length;u++){const d=c[u].split(":"),p=d[0].trim(),m=d[1].trim();l[p]=m}(a=o[0].trim()).split(",").forEach((u=>{(u=u.replace(/^svg/i,"").trim())!==""&&(t[u]=Ie(Ie({},t[u]||{}),l))}))}))}return t}const L6=n=>Nt.getSVGClass($C(n).toLowerCase());class $J{constructor(e,t,s,r,a){this.elements=e,this.options=t,this.reviver=s,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r,this.clipPaths=a,this.gradientDefs=(function(o){const l=V8(o,OJ),c={};let u=l.length;for(;u--;){const d=l[u];d.getAttribute("xlink:href")&&W8(o,d);const p=d.getAttribute("id");p&&(c[p]=d)}return c})(r),this.cssRules=DJ(r)}parse(){return Promise.all(this.elements.map((e=>this.createObject(e))))}async createObject(e){const t=L6(e);if(t){const s=await t.fromElement(e,this.options,this.cssRules);return this.resolveGradient(s,e,mi),this.resolveGradient(s,e,so),s instanceof Na&&s._originalElement?VS(s,s.parsePreserveAspectRatioAttribute()):VS(s),await this.resolveClipPath(s,e),this.reviver&&this.reviver(e,s),s}return null}extractPropertyDefinition(e,t,s){const r=e[t],a=this.regexUrl;if(!a.test(r))return;a.lastIndex=0;const o=a.exec(r)[1];return a.lastIndex=0,s[o]}resolveGradient(e,t,s){const r=this.extractPropertyDefinition(e,s,this.gradientDefs);if(r){const a=t.getAttribute(s+"-opacity"),o=x0.fromElement(r,e,Ie(Ie({},this.options),{},{opacity:a}));e.set(s,o)}}async resolveClipPath(e,t,s){const r=this.extractPropertyDefinition(e,"clipPath",this.clipPaths);if(r){const a=jo(e.calcTransformMatrix()),o=r[0].parentElement;let l=t;for(;!s&&l.parentElement&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentElement;l.parentElement.appendChild(o);const c=NC("".concat(l.getAttribute("transform")||""," ").concat(o.getAttribute("originalTransform")||""));o.setAttribute("transform","matrix(".concat(c.join(","),")"));const u=await Promise.all(r.map((C=>L6(C).fromElement(C,this.options,this.cssRules).then((A=>(VS(A),A.fillRule=A.clipRule,delete A.clipRule,A)))))),d=u.length===1?u[0]:new Al(u),p=ei(a,d.calcTransformMatrix());d.clipPath&&await this.resolveClipPath(d,l,o.getAttribute("clip-path")?l:void 0);const{scaleX:m,scaleY:g,angle:b,skewX:v,translateX:x,translateY:S}=xm(p);d.set({flipX:!1,flipY:!1}),d.set({scaleX:m,scaleY:g,angle:b,skewX:v,skewY:0}),d.setPositionByOrigin(new Ve(x,S),In,In),e.clipPath=d}else delete e.clipPath}}const F6=n=>LK.test($C(n)),xE=()=>({objects:[],elements:[],options:{},allElements:[]});async function H8(n,e){let{crossOrigin:t,signal:s}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(s&&s.aborted)return yd("log",new iO("parseSVGDocument")),xE();const r=n.documentElement;(function(d){const p=V8(d,["use","svg:use"]),m=["x","y","xlink:href","href","transform"];for(const g of p){const b=g.attributes,v={};for(const R of b)R.value&&(v[R.name]=R.value);const x=(v["xlink:href"]||v.href||"").slice(1);if(x==="")return;const S=d.getElementById(x);if(S===null)return;let C=S.cloneNode(!0);const A=C.attributes,k={};for(const R of A)R.value&&(k[R.name]=R.value);const{x:O=0,y:F=0,transform:$=""}=v,M="".concat($," ").concat(k.transform||""," translate(").concat(O,", ").concat(F,")");if(u5(C),/^svg$/i.test(C.nodeName)){const R=C.ownerDocument.createElementNS(dE,"g");Object.entries(k).forEach((z=>{let[I,j]=z;return R.setAttributeNS(dE,I,j)})),R.append(...C.childNodes),C=R}for(const R of b){if(!R)continue;const{name:z,value:I}=R;if(!m.includes(z))if(z==="style"){const j={};mE(I,j),Object.entries(k).forEach((q=>{let[re,X]=q;j[re]=X})),mE(k.style||"",j);const H=Object.entries(j).map((q=>q.join(":"))).join(";");C.setAttribute(z,H)}else!k[z]&&C.setAttribute(z,I)}C.setAttribute("transform",M),C.setAttribute("instantiated_by_use","1"),C.removeAttribute("id"),g.parentNode.replaceChild(C,g)}})(n);const a=Array.from(r.getElementsByTagName("*")),o=Ie(Ie({},u5(r)),{},{crossOrigin:t,signal:s}),l=a.filter((d=>(u5(d),F6(d)&&!(function(p){let m=p;for(;m&&(m=m.parentElement);)if(m&&m.nodeName&&EJ.test($C(m))&&!m.getAttribute("instantiated_by_use"))return!0;return!1})(d))));if(!l||l&&!l.length)return Ie(Ie({},xE()),{},{options:o,allElements:a});const c={};return a.filter((d=>$C(d)==="clipPath")).forEach((d=>{d.setAttribute("originalTransform",d.getAttribute("transform")||"");const p=d.getAttribute("id");c[p]=Array.from(d.getElementsByTagName("*")).filter((m=>F6(m)))})),{objects:await new $J(l,o,e,n,c).parse(),elements:l,options:o,allElements:a}}function G8(n,e,t){return H8(new(o1()).DOMParser().parseFromString(n.trim(),"text/xml"),e,t)}function RJ(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise(((s,r)=>{O8(n.replace(/^\n\s*/,"").trim(),{onComplete:a=>{const o=a.responseXML;o&&s(o),r()},signal:t.signal})})).then((s=>H8(s,e,t))).catch((()=>xE()))}const X_=n=>n.webgl!==void 0,IO="precision highp float",LJ=`
    `.concat(IO,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),FJ=["type"],MJ=["type"],PJ=new RegExp(IO,"g");class bi{get type(){return this.constructor.type}constructor(){let e=ar(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},FJ);Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return LJ}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:r="highp"}}=mh();r!=="highp"&&(t=t.replace(PJ,IO.replace("highp",r)));const a=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER),l=e.createProgram();if(!a||!o||!l)throw new nh("Vertex, fragment shader or program creation error");if(e.shaderSource(a,s),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new nh("Vertex shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(a)));if(e.shaderSource(o,t),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new nh("Fragment shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(o)));if(e.attachShader(l,a),e.attachShader(l,o),e.linkProgram(l),!e.getProgramParameter(l,e.LINK_STATUS))throw new nh('Shader link error for "'.concat(this.type,'" ').concat(e.getProgramInfoLog(l)));const c=this.getUniformLocations(e,l)||{};return c.uStepW=e.getUniformLocation(l,"uStepW"),c.uStepH=e.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:this.getAttributeLocations(e,l),uniformLocations:c}}getAttributeLocations(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}}getUniformLocations(e,t){const s=this.constructor.uniformLocations,r={};for(let a=0;a<s.length;a++)r[s[a]]=e.getUniformLocation(t,s[a]);return r}sendAttributeData(e,t,s){const r=t.aPosition,a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW)}_setupFrameBuffer(e){const t=e.context;if(e.passes>1){const s=e.destinationWidth,r=e.destinationHeight;e.sourceWidth===s&&e.sourceHeight===r||(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,s,r)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)}else t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish()}_swapTextures(e){e.passes--,e.pass++;const t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t}isNeutralState(e){return!1}applyTo(e){X_(e)?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){}getCacheKey(){return this.type}retrieveShader(e){const t=this.getCacheKey();return e.programCache[t]||(e.programCache[t]=this.createProgram(e.context)),e.programCache[t]}applyToWebGL(e){const t=e.context,s=this.retrieveShader(e);e.pass===0&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(s.program),this.sendAttributeData(t,s.attributeLocations,e.aPosition),t.uniform1f(s.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(s.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,s.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(e,t,s){e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)}unbindAdditionalTexture(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}sendUniformData(e,t){}createHelpLayer(e){if(!e.helpLayer){const{sourceWidth:t,sourceHeight:s}=e,r=Dl({width:t,height:s});e.helpLayer=r}}toObject(){const e=Object.keys(this.constructor.defaults||{});return Ie({type:this.type},e.reduce(((t,s)=>(t[s]=this[s],t)),{}))}toJSON(){return this.toObject()}static async fromObject(e,t){return new this(ar(e,MJ))}}ke(bi,"type","BaseFilter"),ke(bi,"uniformLocations",[]);const zJ={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Rb extends bi{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(zJ[this.mode],`
        }
      }
      `)}applyTo2d(e){let{imageData:{data:t}}=e;const s=new Ho(this.color).getSource(),r=this.alpha,a=s[0]*r,o=s[1]*r,l=s[2]*r,c=1-r;for(let u=0;u<t.length;u+=4){const d=t[u],p=t[u+1],m=t[u+2];let g,b,v;switch(this.mode){case"multiply":g=d*a/255,b=p*o/255,v=m*l/255;break;case"screen":g=255-(255-d)*(255-a)/255,b=255-(255-p)*(255-o)/255,v=255-(255-m)*(255-l)/255;break;case"add":g=d+a,b=p+o,v=m+l;break;case"difference":g=Math.abs(d-a),b=Math.abs(p-o),v=Math.abs(m-l);break;case"subtract":g=d-a,b=p-o,v=m-l;break;case"darken":g=Math.min(d,a),b=Math.min(p,o),v=Math.min(m,l);break;case"lighten":g=Math.max(d,a),b=Math.max(p,o),v=Math.max(m,l);break;case"overlay":g=a<128?2*d*a/255:255-2*(255-d)*(255-a)/255,b=o<128?2*p*o/255:255-2*(255-p)*(255-o)/255,v=l<128?2*m*l/255:255-2*(255-m)*(255-l)/255;break;case"exclusion":g=a+d-2*a*d/255,b=o+p-2*o*p/255,v=l+m-2*l*m/255;break;case"tint":g=a+d*c,b=o+p*c,v=l+m*c}t[u]=g,t[u+1]=b,t[u+2]=v}}sendUniformData(e,t){const s=new Ho(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,e.uniform4fv(t.uColor,s)}}ke(Rb,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),ke(Rb,"type","BlendColor"),ke(Rb,"uniformLocations",["uColor"]),Nt.setClass(Rb);const BJ={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},jJ=["type","image"];class Lb extends bi{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return BJ[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(e){const t=e.context,s=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,s,t.TEXTURE1),super.applyToWebGL(e),this.unbindAdditionalTexture(t,t.TEXTURE1)}createTexture(e,t){return e.getCachedTexture(t.cacheKey,t.getElement())}calculateMatrix(){const e=this.image,{width:t,height:s}=e.getElement();return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/s,1]}applyTo2d(e){let{imageData:{data:t,width:s,height:r},filterBackend:{resources:a}}=e;const o=this.image;a.blendImage||(a.blendImage=gh());const l=a.blendImage,c=l.getContext("2d");l.width!==s||l.height!==r?(l.width=s,l.height=r):c.clearRect(0,0,s,r),c.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),c.drawImage(o.getElement(),0,0,s,r);const u=c.getImageData(0,0,s,r).data;for(let d=0;d<t.length;d+=4){const p=t[d],m=t[d+1],g=t[d+2],b=t[d+3],v=u[d],x=u[d+1],S=u[d+2],C=u[d+3];switch(this.mode){case"multiply":t[d]=p*v/255,t[d+1]=m*x/255,t[d+2]=g*S/255,t[d+3]=b*C/255;break;case"mask":t[d+3]=C}}}sendUniformData(e,t){const s=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,s)}toObject(){return Ie(Ie({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(e,t){let{type:s,image:r}=e,a=ar(e,jJ);return Na.fromObject(r,t).then((o=>new this(Ie(Ie({},a),{},{image:o}))))}}ke(Lb,"type","BlendImage"),ke(Lb,"defaults",{mode:"multiply",alpha:1}),ke(Lb,"uniformLocations",["uTransformMatrix","uImage"]),Nt.setClass(Lb);class Fb extends bi{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float totalC = 0.0;
      float totalA = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);
        float weight = 1.0 - abs(percent);
        float alpha = weight * sample.a;
        color.rgb += sample.rgb * alpha;
        color.a += alpha;
        totalA += weight;
        totalC += alpha;
      }
      gl_FragColor.rgb = color.rgb / totalC;
      gl_FragColor.a = color.a / totalA;
    }
  `}applyTo(e){X_(e)?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){let{imageData:{data:t,width:s,height:r}}=e;this.aspectRatio=s/r,this.horizontal=!0;let a=this.getBlurValue()*s;const o=new Uint8ClampedArray(t),l=15,c=4*s;for(let u=0;u<t.length;u+=4){let d=0,p=0,m=0,g=0,b=0;const v=u-u%c,x=v+c;for(let S=-14;S<l;S++){const C=S/l,A=4*Math.floor(a*C),k=1-Math.abs(C);let O=u+A;O<v?O=v:O>x&&(O=x);const F=t[O+3]*k;d+=t[O]*F,p+=t[O+1]*F,m+=t[O+2]*F,g+=F,b+=k}o[u]=d/g,o[u+1]=p/g,o[u+2]=m/g,o[u+3]=g/b}this.horizontal=!1,a=this.getBlurValue()*r;for(let u=0;u<o.length;u+=4){let d=0,p=0,m=0,g=0,b=0;const v=u%c,x=o.length-c+v;for(let S=-14;S<l;S++){const C=S/l,A=Math.floor(a*C)*c,k=1-Math.abs(C);let O=u+A;O<v?O=v:O>x&&(O=x);const F=o[O+3]*k;d+=o[O]*F,p+=o[O+1]*F,m+=o[O+2]*F,g+=F,b+=k}t[u]=d/g,t[u+1]=p/g,t[u+2]=m/g,t[u+3]=g/b}}sendUniformData(e,t){const s=this.chooseRightDelta();e.uniform2fv(t.uDelta,s)}isNeutralState(){return this.blur===0}getBlurValue(){let e=1;const{horizontal:t,aspectRatio:s}=this;return t?s>1&&(e=1/s):s<1&&(e=s),e*this.blur*.12}chooseRightDelta(){const e=this.getBlurValue();return this.horizontal?[e,0]:[0,e]}}ke(Fb,"type","Blur"),ke(Fb,"defaults",{blur:0}),ke(Fb,"uniformLocations",["uDelta"]),Nt.setClass(Fb);class Mb extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=Math.round(255*this.brightness);for(let r=0;r<t.length;r+=4)t[r]+=s,t[r+1]+=s,t[r+2]+=s}isNeutralState(){return this.brightness===0}sendUniformData(e,t){e.uniform1f(t.uBrightness,this.brightness)}}ke(Mb,"type","Brightness"),ke(Mb,"defaults",{brightness:0}),ke(Mb,"uniformLocations",["uBrightness"]),Nt.setClass(Mb);const q8={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class am extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(e){const t=e.imageData.data,s=this.matrix,r=this.colorsOnly;for(let a=0;a<t.length;a+=4){const o=t[a],l=t[a+1],c=t[a+2];if(t[a]=o*s[0]+l*s[1]+c*s[2]+255*s[4],t[a+1]=o*s[5]+l*s[6]+c*s[7]+255*s[9],t[a+2]=o*s[10]+l*s[11]+c*s[12]+255*s[14],!r){const u=t[a+3];t[a]+=u*s[3],t[a+1]+=u*s[8],t[a+2]+=u*s[13],t[a+3]=o*s[15]+l*s[16]+c*s[17]+u*s[18]+255*s[19]}}}sendUniformData(e,t){const s=this.matrix,r=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],a=[s[4],s[9],s[14],s[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,r),e.uniform4fv(t.uConstants,a)}toObject(){return Ie(Ie({},super.toObject()),{},{matrix:[...this.matrix]})}}function Km(n,e){var t;const s=(ke(t=class extends am{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",n),ke(t,"defaults",{colorsOnly:!1,matrix:e}),t);return Nt.setClass(s,n),s}ke(am,"type","ColorMatrix"),ke(am,"defaults",q8),ke(am,"uniformLocations",["uColorMatrix","uConstants"]),Nt.setClass(am);const UJ=Km("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),VJ=Km("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),WJ=Km("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),HJ=Km("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),GJ=Km("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),qJ=Km("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),XJ=Km("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class SE extends bi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.subFilters=e.subFilters||[]}applyTo(e){X_(e)&&(e.passes+=this.subFilters.length-1),this.subFilters.forEach((t=>{t.applyTo(e)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((e=>e.toObject()))}}isNeutralState(){return!this.subFilters.some((e=>!e.isNeutralState()))}static fromObject(e,t){return Promise.all((e.subFilters||[]).map((s=>Nt.getClass(s.type).fromObject(s,t)))).then((s=>new this({subFilters:s})))}}ke(SE,"type","Composed"),Nt.setClass(SE);class Pb extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(e){let{imageData:{data:t}}=e;const s=Math.floor(255*this.contrast),r=259*(s+255)/(255*(259-s));for(let a=0;a<t.length;a+=4)t[a]=r*(t[a]-128)+128,t[a+1]=r*(t[a+1]-128)+128,t[a+2]=r*(t[a+2]-128)+128}sendUniformData(e,t){e.uniform1f(t.uContrast,this.contrast)}}ke(Pb,"type","Contrast"),ke(Pb,"defaults",{contrast:0}),ke(Pb,"uniformLocations",["uContrast"]),Nt.setClass(Pb);const YJ={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class zb extends bi{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return YJ[this.getCacheKey()]}applyTo2d(e){const t=e.imageData,s=t.data,r=this.matrix,a=Math.round(Math.sqrt(r.length)),o=Math.floor(a/2),l=t.width,c=t.height,u=e.ctx.createImageData(l,c),d=u.data,p=this.opaque?1:0;let m,g,b,v,x,S,C,A,k,O,F,$,M;for(F=0;F<c;F++)for(O=0;O<l;O++){for(x=4*(F*l+O),m=0,g=0,b=0,v=0,M=0;M<a;M++)for($=0;$<a;$++)C=F+M-o,S=O+$-o,C<0||C>=c||S<0||S>=l||(A=4*(C*l+S),k=r[M*a+$],m+=s[A]*k,g+=s[A+1]*k,b+=s[A+2]*k,p||(v+=s[A+3]*k));d[x]=m,d[x+1]=g,d[x+2]=b,d[x+3]=p?s[x+3]:v}e.imageData=u}sendUniformData(e,t){e.uniform1fv(t.uMatrix,this.matrix)}toObject(){return Ie(Ie({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}ke(zb,"type","Convolute"),ke(zb,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),ke(zb,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),Nt.setClass(zb);const X8="Gamma";class Bb extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.gamma=e.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(e){let{imageData:{data:t}}=e;const s=this.gamma,r=1/s[0],a=1/s[1],o=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const l=this.rgbValues;for(let c=0;c<256;c++)l.r[c]=255*Math.pow(c/255,r),l.g[c]=255*Math.pow(c/255,a),l.b[c]=255*Math.pow(c/255,o);for(let c=0;c<t.length;c+=4)t[c]=l.r[t[c]],t[c+1]=l.g[t[c+1]],t[c+2]=l.b[t[c+2]]}sendUniformData(e,t){e.uniform3fv(t.uGamma,this.gamma)}isNeutralState(){const{gamma:e}=this;return e[0]===1&&e[1]===1&&e[2]===1}toObject(){return{type:X8,gamma:this.gamma.concat()}}}ke(Bb,"type",X8),ke(Bb,"defaults",{gamma:[1,1,1]}),ke(Bb,"uniformLocations",["uGamma"]),Nt.setClass(Bb);const KJ={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class jb extends bi{applyTo2d(e){let{imageData:{data:t}}=e;for(let s,r=0;r<t.length;r+=4){const a=t[r],o=t[r+1],l=t[r+2];switch(this.mode){case"average":s=(a+o+l)/3;break;case"lightness":s=(Math.min(a,o,l)+Math.max(a,o,l))/2;break;case"luminosity":s=.21*a+.72*o+.07*l}t[r+2]=t[r+1]=t[r]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return KJ[this.mode]}sendUniformData(e,t){e.uniform1i(t.uMode,1)}isNeutralState(){return!1}}ke(jb,"type","Grayscale"),ke(jb,"defaults",{mode:"average"}),ke(jb,"uniformLocations",["uMode"]),Nt.setClass(jb);const ZJ=Ie(Ie({},q8),{},{rotation:0});class HS extends am{calculateMatrix(){const e=this.rotation*Math.PI,t=du(e),s=fu(e),r=1/3,a=Math.sqrt(r)*s,o=1-t;this.matrix=[t+o/3,r*o-a,r*o+a,0,0,r*o+a,t+r*o,r*o-a,0,0,r*o-a,r*o+a,t+r*o,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(e){this.calculateMatrix(),super.applyTo(e)}toObject(){return{type:this.type,rotation:this.rotation}}}ke(HS,"type","HueRotation"),ke(HS,"defaults",ZJ),Nt.setClass(HS);class Ub extends bi{applyTo2d(e){let{imageData:{data:t}}=e;for(let s=0;s<t.length;s+=4)t[s]=255-t[s],t[s+1]=255-t[s+1],t[s+2]=255-t[s+2],this.alpha&&(t[s+3]=255-t[s+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(e,t){e.uniform1i(t.uInvert,Number(this.invert)),e.uniform1i(t.uAlpha,Number(this.alpha))}}ke(Ub,"type","Invert"),ke(Ub,"defaults",{alpha:!1,invert:!0}),ke(Ub,"uniformLocations",["uInvert","uAlpha"]),Nt.setClass(Ub);class Vb extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=this.noise;for(let r=0;r<t.length;r+=4){const a=(.5-Math.random())*s;t[r]+=a,t[r+1]+=a,t[r+2]+=a}}sendUniformData(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())}isNeutralState(){return this.noise===0}}ke(Vb,"type","Noise"),ke(Vb,"defaults",{noise:0}),ke(Vb,"uniformLocations",["uNoise","uSeed"]),Nt.setClass(Vb);class Wb extends bi{applyTo2d(e){let{imageData:{data:t,width:s,height:r}}=e;for(let a=0;a<r;a+=this.blocksize)for(let o=0;o<s;o+=this.blocksize){const l=4*a*s+4*o,c=t[l],u=t[l+1],d=t[l+2],p=t[l+3];for(let m=a;m<Math.min(a+this.blocksize,r);m++)for(let g=o;g<Math.min(o+this.blocksize,s);g++){const b=4*m*s+4*g;t[b]=c,t[b+1]=u,t[b+2]=d,t[b+3]=p}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}ke(Wb,"type","Pixelate"),ke(Wb,"defaults",{blocksize:4}),ke(Wb,"uniformLocations",["uBlocksize"]),Nt.setClass(Wb);class Hb extends bi{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=255*this.distance,r=new Ho(this.color).getSource(),a=[r[0]-s,r[1]-s,r[2]-s],o=[r[0]+s,r[1]+s,r[2]+s];for(let l=0;l<t.length;l+=4){const c=t[l],u=t[l+1],d=t[l+2];c>a[0]&&u>a[1]&&d>a[2]&&c<o[0]&&u<o[1]&&d<o[2]&&(t[l+3]=0)}}sendUniformData(e,t){const s=new Ho(this.color).getSource(),r=this.distance,a=[0+s[0]/255-r,0+s[1]/255-r,0+s[2]/255-r,1],o=[s[0]/255+r,s[1]/255+r,s[2]/255+r,1];e.uniform4fv(t.uLow,a),e.uniform4fv(t.uHigh,o)}}ke(Hb,"type","RemoveColor"),ke(Hb,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),ke(Hb,"uniformLocations",["uLow","uHigh"]),Nt.setClass(Hb);class Gb extends bi{sendUniformData(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)}getFilterWindow(){const e=this.tempScale;return Math.ceil(this.lanczosLobes/e)}getCacheKey(){const e=this.getFilterWindow();return"".concat(this.type,"_").concat(e)}getFragmentSource(){const e=this.getFilterWindow();return this.generateShader(e)}getTaps(){const e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,s=this.getFilterWindow(),r=new Array(s);for(let a=1;a<=s;a++)r[a-1]=e(a*t);return r}generateShader(e){const t=new Array(e);for(let s=1;s<=e;s++)t[s-1]="".concat(s,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(e,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(t.map(((s,r)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(s,") * uTaps[").concat(r,"] + texture2D(uTexture, vTexCoord - ").concat(s,") * uTaps[").concat(r,`];
              sum += 2.0 * uTaps[`).concat(r,`];
            `))).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(e){e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,super.applyTo(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,super.applyTo(e),e.sourceHeight=e.destinationHeight}applyTo(e){X_(e)?this.applyToForWebgl(e):this.applyTo2d(e)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(e){return t=>{if(t>=e||t<=-e)return 0;if(t<11920929e-14&&t>-11920929e-14)return 1;const s=(t*=Math.PI)/e;return Math.sin(t)/t*Math.sin(s)/s}}applyTo2d(e){const t=e.imageData,s=this.scaleX,r=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/r;const a=t.width,o=t.height,l=Math.round(a*s),c=Math.round(o*r);let u;u=this.resizeType==="sliceHack"?this.sliceByTwo(e,a,o,l,c):this.resizeType==="hermite"?this.hermiteFastResize(e,a,o,l,c):this.resizeType==="bilinear"?this.bilinearFiltering(e,a,o,l,c):this.resizeType==="lanczos"?this.lanczosResize(e,a,o,l,c):new ImageData(l,c),e.imageData=u}sliceByTwo(e,t,s,r,a){const o=e.imageData,l=.5;let c=!1,u=!1,d=t*l,p=s*l;const m=e.filterBackend.resources;let g=0,b=0;const v=t;let x=0;m.sliceByTwo||(m.sliceByTwo=gh());const S=m.sliceByTwo;(S.width<1.5*t||S.height<s)&&(S.width=1.5*t,S.height=s);const C=S.getContext("2d");for(C.clearRect(0,0,1.5*t,s),C.putImageData(o,0,0),r=Math.floor(r),a=Math.floor(a);!c||!u;)t=d,s=p,r<Math.floor(d*l)?d=Math.floor(d*l):(d=r,c=!0),a<Math.floor(p*l)?p=Math.floor(p*l):(p=a,u=!0),C.drawImage(S,g,b,t,s,v,x,d,p),g=v,b=x,x+=p;return C.getImageData(g,b,r,a)}lanczosResize(e,t,s,r,a){const o=e.imageData.data,l=e.ctx.createImageData(r,a),c=l.data,u=this.lanczosCreate(this.lanczosLobes),d=this.rcpScaleX,p=this.rcpScaleY,m=2/this.rcpScaleX,g=2/this.rcpScaleY,b=Math.ceil(d*this.lanczosLobes/2),v=Math.ceil(p*this.lanczosLobes/2),x={},S={x:0,y:0},C={x:0,y:0};return(function A(k){let O,F,$,M,R,z,I,j,H,q,re;for(S.x=(k+.5)*d,C.x=Math.floor(S.x),O=0;O<a;O++){for(S.y=(O+.5)*p,C.y=Math.floor(S.y),R=0,z=0,I=0,j=0,H=0,F=C.x-b;F<=C.x+b;F++)if(!(F<0||F>=t)){q=Math.floor(1e3*Math.abs(F-S.x)),x[q]||(x[q]={});for(let X=C.y-v;X<=C.y+v;X++)X<0||X>=s||(re=Math.floor(1e3*Math.abs(X-S.y)),x[q][re]||(x[q][re]=u(Math.sqrt(Math.pow(q*m,2)+Math.pow(re*g,2))/1e3)),$=x[q][re],$>0&&(M=4*(X*t+F),R+=$,z+=$*o[M],I+=$*o[M+1],j+=$*o[M+2],H+=$*o[M+3]))}M=4*(O*r+k),c[M]=z/R,c[M+1]=I/R,c[M+2]=j/R,c[M+3]=H/R}return++k<r?A(k):l})(0)}bilinearFiltering(e,t,s,r,a){let o,l,c,u,d,p,m,g,b,v,x,S,C,A=0;const k=this.rcpScaleX,O=this.rcpScaleY,F=4*(t-1),$=e.imageData.data,M=e.ctx.createImageData(r,a),R=M.data;for(m=0;m<a;m++)for(g=0;g<r;g++)for(d=Math.floor(k*g),p=Math.floor(O*m),b=k*g-d,v=O*m-p,C=4*(p*t+d),x=0;x<4;x++)o=$[C+x],l=$[C+4+x],c=$[C+F+x],u=$[C+F+4+x],S=o*(1-b)*(1-v)+l*b*(1-v)+c*v*(1-b)+u*b*v,R[A++]=S;return M}hermiteFastResize(e,t,s,r,a){const o=this.rcpScaleX,l=this.rcpScaleY,c=Math.ceil(o/2),u=Math.ceil(l/2),d=e.imageData.data,p=e.ctx.createImageData(r,a),m=p.data;for(let g=0;g<a;g++)for(let b=0;b<r;b++){const v=4*(b+g*r);let x=0,S=0,C=0,A=0,k=0,O=0,F=0;const $=(g+.5)*l;for(let M=Math.floor(g*l);M<(g+1)*l;M++){const R=Math.abs($-(M+.5))/u,z=(b+.5)*o,I=R*R;for(let j=Math.floor(b*o);j<(b+1)*o;j++){let H=Math.abs(z-(j+.5))/c;const q=Math.sqrt(I+H*H);q>1&&q<-1||(x=2*q*q*q-3*q*q+1,x>0&&(H=4*(j+M*t),F+=x*d[H+3],C+=x,d[H+3]<255&&(x=x*d[H+3]/250),A+=x*d[H],k+=x*d[H+1],O+=x*d[H+2],S+=x))}}m[v]=A/S,m[v+1]=k/S,m[v+2]=O/S,m[v+3]=F/C}return p}}ke(Gb,"type","Resize"),ke(Gb,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),ke(Gb,"uniformLocations",["uDelta","uTaps"]),Nt.setClass(Gb);class qb extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=-this.saturation;for(let r=0;r<t.length;r+=4){const a=t[r],o=t[r+1],l=t[r+2],c=Math.max(a,o,l);t[r]+=c!==a?(c-a)*s:0,t[r+1]+=c!==o?(c-o)*s:0,t[r+2]+=c!==l?(c-l)*s:0}}sendUniformData(e,t){e.uniform1f(t.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}ke(qb,"type","Saturation"),ke(qb,"defaults",{saturation:0}),ke(qb,"uniformLocations",["uSaturation"]),Nt.setClass(qb);class Xb extends bi{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=-this.vibrance;for(let r=0;r<t.length;r+=4){const a=t[r],o=t[r+1],l=t[r+2],c=Math.max(a,o,l),u=(a+o+l)/3,d=2*Math.abs(c-u)/255*s;t[r]+=c!==a?(c-a)*d:0,t[r+1]+=c!==o?(c-o)*d:0,t[r+2]+=c!==l?(c-l)*d:0}}sendUniformData(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}ke(Xb,"type","Vibrance"),ke(Xb,"defaults",{vibrance:0}),ke(Xb,"uniformLocations",["uVibrance"]),Nt.setClass(Xb);var JJ=Object.freeze({__proto__:null,BaseFilter:bi,BlackWhite:XJ,BlendColor:Rb,BlendImage:Lb,Blur:Fb,Brightness:Mb,Brownie:UJ,ColorMatrix:am,Composed:SE,Contrast:Pb,Convolute:zb,Gamma:Bb,Grayscale:jb,HueRotation:HS,Invert:Ub,Kodachrome:WJ,Noise:Vb,Pixelate:Wb,Polaroid:GJ,RemoveColor:Hb,Resize:Gb,Saturation:qb,Sepia:qJ,Technicolor:HJ,Vibrance:Xb,Vintage:VJ});const QJ="modulepreload",eQ=function(n,e){return new URL(n,e).href},M6={},fv=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let u=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");r=u(t.map(d=>{if(d=eQ(d,s),d in M6)return;M6[d]=!0;const p=d.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(s)for(let b=o.length-1;b>=0;b--){const v=o[b];if(v.href===d&&(!p||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":QJ,p||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),p)return new Promise((b,v)=>{g.addEventListener("load",b),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};function Ns(n){"@babel/helpers - typeof";return Ns=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ns(n)}var pu=Uint8Array,Cl=Uint16Array,OO=Int32Array,DO=new pu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$O=new pu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),P6=new pu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y8=function(n,e){for(var t=new Cl(31),s=0;s<31;++s)t[s]=e+=1<<n[s-1];for(var r=new OO(t[30]),s=1;s<30;++s)for(var a=t[s];a<t[s+1];++a)r[a]=a-t[s]<<5|s;return{b:t,r}},K8=Y8(DO,2),tQ=K8.b,CE=K8.r;tQ[28]=258,CE[258]=28;var nQ=Y8($O,0),z6=nQ.r,_E=new Cl(32768);for(var sr=0;sr<32768;++sr){var Sf=(sr&43690)>>1|(sr&21845)<<1;Sf=(Sf&52428)>>2|(Sf&13107)<<2,Sf=(Sf&61680)>>4|(Sf&3855)<<4,_E[sr]=((Sf&65280)>>8|(Sf&255)<<8)>>1}var pv=(function(n,e,t){for(var s=n.length,r=0,a=new Cl(e);r<s;++r)n[r]&&++a[n[r]-1];var o=new Cl(e);for(r=1;r<e;++r)o[r]=o[r-1]+a[r-1]<<1;var l;if(t){l=new Cl(1<<e);var c=15-e;for(r=0;r<s;++r)if(n[r])for(var u=r<<4|n[r],d=e-n[r],p=o[n[r]-1]++<<d,m=p|(1<<d)-1;p<=m;++p)l[_E[p]>>c]=u}else for(l=new Cl(s),r=0;r<s;++r)n[r]&&(l[r]=_E[o[n[r]-1]++]>>15-n[r]);return l}),_m=new pu(288);for(var sr=0;sr<144;++sr)_m[sr]=8;for(var sr=144;sr<256;++sr)_m[sr]=9;for(var sr=256;sr<280;++sr)_m[sr]=7;for(var sr=280;sr<288;++sr)_m[sr]=8;var RC=new pu(32);for(var sr=0;sr<32;++sr)RC[sr]=5;var sQ=pv(_m,9,0),rQ=pv(RC,5,0),Z8=function(n){return(n+7)/8|0},iQ=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new pu(n.subarray(e,t))},nd=function(n,e,t){t<<=e&7;var s=e/8|0;n[s]|=t,n[s+1]|=t>>8},_b=function(n,e,t){t<<=e&7;var s=e/8|0;n[s]|=t,n[s+1]|=t>>8,n[s+2]|=t>>16},d5=function(n,e){for(var t=[],s=0;s<n.length;++s)n[s]&&t.push({s,f:n[s]});var r=t.length,a=t.slice();if(!r)return{t:Q8,l:0};if(r==1){var o=new pu(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(O,F){return O.f-F.f}),t.push({s:-1,f:25001});var l=t[0],c=t[1],u=0,d=1,p=2;for(t[0]={s:-1,f:l.f+c.f,l,r:c};d!=r-1;)l=t[t[u].f<t[p].f?u++:p++],c=t[u!=d&&t[u].f<t[p].f?u++:p++],t[d++]={s:-1,f:l.f+c.f,l,r:c};for(var m=a[0].s,s=1;s<r;++s)a[s].s>m&&(m=a[s].s);var g=new Cl(m+1),b=kE(t[d-1],g,0);if(b>e){var s=0,v=0,x=b-e,S=1<<x;for(a.sort(function(F,$){return g[$.s]-g[F.s]||F.f-$.f});s<r;++s){var C=a[s].s;if(g[C]>e)v+=S-(1<<b-g[C]),g[C]=e;else break}for(v>>=x;v>0;){var A=a[s].s;g[A]<e?v-=1<<e-g[A]++-1:++s}for(;s>=0&&v;--s){var k=a[s].s;g[k]==e&&(--g[k],++v)}b=e}return{t:new pu(g),l:b}},kE=function(n,e,t){return n.s==-1?Math.max(kE(n.l,e,t+1),kE(n.r,e,t+1)):e[n.s]=t},B6=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new Cl(++e),s=0,r=n[0],a=1,o=function(c){t[s++]=c},l=1;l<=e;++l)if(n[l]==r&&l!=e)++a;else{if(!r&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(r),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(r);a=1,r=n[l]}return{c:t.subarray(0,s),n:e}},kb=function(n,e){for(var t=0,s=0;s<e.length;++s)t+=n[s]*e[s];return t},J8=function(n,e,t){var s=t.length,r=Z8(e+2);n[r]=s&255,n[r+1]=s>>8,n[r+2]=n[r]^255,n[r+3]=n[r+1]^255;for(var a=0;a<s;++a)n[r+a+4]=t[a];return(r+4+s)*8},j6=function(n,e,t,s,r,a,o,l,c,u,d){nd(e,d++,t),++r[256];for(var p=d5(r,15),m=p.t,g=p.l,b=d5(a,15),v=b.t,x=b.l,S=B6(m),C=S.c,A=S.n,k=B6(v),O=k.c,F=k.n,$=new Cl(19),M=0;M<C.length;++M)++$[C[M]&31];for(var M=0;M<O.length;++M)++$[O[M]&31];for(var R=d5($,7),z=R.t,I=R.l,j=19;j>4&&!z[P6[j-1]];--j);var H=u+5<<3,q=kb(r,_m)+kb(a,RC)+o,re=kb(r,m)+kb(a,v)+o+14+3*j+kb($,z)+2*$[16]+3*$[17]+7*$[18];if(c>=0&&H<=q&&H<=re)return J8(e,d,n.subarray(c,c+u));var X,ne,Q,he;if(nd(e,d,1+(re<q)),d+=2,re<q){X=pv(m,g,0),ne=m,Q=pv(v,x,0),he=v;var ye=pv(z,I,0);nd(e,d,A-257),nd(e,d+5,F-1),nd(e,d+10,j-4),d+=14;for(var M=0;M<j;++M)nd(e,d+3*M,z[P6[M]]);d+=3*j;for(var Y=[C,O],B=0;B<2;++B)for(var G=Y[B],M=0;M<G.length;++M){var J=G[M]&31;nd(e,d,ye[J]),d+=z[J],J>15&&(nd(e,d,G[M]>>5&127),d+=G[M]>>12)}}else X=sQ,ne=_m,Q=rQ,he=RC;for(var M=0;M<l;++M){var oe=s[M];if(oe>255){var J=oe>>18&31;_b(e,d,X[J+257]),d+=ne[J+257],J>7&&(nd(e,d,oe>>23&31),d+=DO[J]);var de=oe&31;_b(e,d,Q[de]),d+=he[de],de>3&&(_b(e,d,oe>>5&8191),d+=$O[de])}else _b(e,d,X[oe]),d+=ne[oe]}return _b(e,d,X[256]),d+ne[256]},aQ=new OO([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Q8=new pu(0),oQ=function(n,e,t,s,r,a){var o=a.z||n.length,l=new pu(s+o+5*(1+Math.ceil(o/7e3))+r),c=l.subarray(s,l.length-r),u=a.l,d=(a.r||0)&7;if(e){d&&(c[0]=a.r>>3);for(var p=aQ[e-1],m=p>>13,g=p&8191,b=(1<<t)-1,v=a.p||new Cl(32768),x=a.h||new Cl(b+1),S=Math.ceil(t/3),C=2*S,A=function(pt){return(n[pt]^n[pt+1]<<S^n[pt+2]<<C)&b},k=new OO(25e3),O=new Cl(288),F=new Cl(32),$=0,M=0,R=a.i||0,z=0,I=a.w||0,j=0;R+2<o;++R){var H=A(R),q=R&32767,re=x[H];if(v[q]=re,x[H]=q,I<=R){var X=o-R;if(($>7e3||z>24576)&&(X>423||!u)){d=j6(n,c,0,k,O,F,M,z,j,R-j,d),z=$=M=0,j=R;for(var ne=0;ne<286;++ne)O[ne]=0;for(var ne=0;ne<30;++ne)F[ne]=0}var Q=2,he=0,ye=g,Y=q-re&32767;if(X>2&&H==A(R-Y))for(var B=Math.min(m,X)-1,G=Math.min(32767,R),J=Math.min(258,X);Y<=G&&--ye&&q!=re;){if(n[R+Q]==n[R+Q-Y]){for(var oe=0;oe<J&&n[R+oe]==n[R+oe-Y];++oe);if(oe>Q){if(Q=oe,he=Y,oe>B)break;for(var de=Math.min(Y,oe-2),ge=0,ne=0;ne<de;++ne){var Ae=R-Y+ne&32767,Ce=v[Ae],Fe=Ae-Ce&32767;Fe>ge&&(ge=Fe,re=Ae)}}}q=re,re=v[q],Y+=q-re&32767}if(he){k[z++]=268435456|CE[Q]<<18|z6[he];var Ge=CE[Q]&31,ot=z6[he]&31;M+=DO[Ge]+$O[ot],++O[257+Ge],++F[ot],I=R+Q,++$}else k[z++]=n[R],++O[n[R]]}}for(R=Math.max(R,I);R<o;++R)k[z++]=n[R],++O[n[R]];d=j6(n,c,u,k,O,F,M,z,j,R-j,d),u||(a.r=d&7|c[d/8|0]<<3,d-=7,a.h=x,a.p=v,a.i=R,a.w=I)}else{for(var R=a.w||0;R<o+u;R+=65535){var ut=R+65535;ut>=o&&(c[d/8|0]=u,ut=o),d=J8(c,d+1,n.subarray(R,ut))}a.i=o}return iQ(l,0,s+Z8(d)+r)},e7=function(){var n=1,e=0;return{p:function(t){for(var s=n,r=e,a=t.length|0,o=0;o!=a;){for(var l=Math.min(o+2655,a);o<l;++o)r+=s+=t[o];s=(s&65535)+15*(s>>16),r=(r&65535)+15*(r>>16)}n=s,e=r},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},lQ=function(n,e,t,s,r){if(!r&&(r={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),o=new pu(a.length+n.length);o.set(a),o.set(n,a.length),n=o,r.w=a.length}return oQ(n,e.level==null?6:e.level,e.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,s,r)},t7=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},cQ=function(n,e){var t=e.level,s=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=s<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var r=e7();r.p(e.dictionary),t7(n,2,r.d())}};function TE(n,e){e||(e={});var t=e7();t.p(n);var s=lQ(n,e,e.dictionary?6:2,4);return cQ(s,e),t7(s,s.length-4,t.d()),s}var uQ=typeof TextDecoder<"u"&&new TextDecoder,hQ=0;try{uQ.decode(Q8,{stream:!0}),hQ=1}catch{}function dQ(n){if(Array.isArray(n))return n}function fQ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,a,o,l=[],c=!0,u=!1;try{if(a=(t=t.call(n)).next,e!==0)for(;!(c=(s=a.call(t)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(d){u=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw r}}return l}}function U6(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function pQ(n,e){if(n){if(typeof n=="string")return U6(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?U6(n,e):void 0}}function mQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V6(n,e){return dQ(n)||fQ(n,e)||pQ(n,e)||mQ()}function W6(n,e="utf8"){return new TextDecoder(e).decode(n)}const gQ=new TextEncoder;function yQ(n){return gQ.encode(n)}const bQ=1024*8,vQ=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),f5={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class RO{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=bQ,t={}){let s=!1;typeof e=="number"?e=new ArrayBuffer(e):(s=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,a=e.byteLength-r;let o=r;(ArrayBuffer.isView(e)||e instanceof RO)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+r),e=e.buffer),s?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const s=(this.offset+e)*2,r=new Uint8Array(s);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=s,this.byteLength=s,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const s=f5[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,a=this.buffer.slice(r,r+s);if(this.littleEndian===vQ&&t!=="uint8"&&t!=="int8"){const l=new Uint8Array(this.buffer.slice(r,r+s));l.reverse();const c=new f5[t](l.buffer);return this.offset+=s,c.reverse(),c}const o=new f5[t](a);return this.offset+=s,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let s=0;s<e;s++)t+=this.readChar();return t}readUtf8(e=1){return W6(this.readBytes(e))}decodeText(e=1,t="utf8"){return W6(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(yQ(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function f1(n){let e=n.length;for(;--e>=0;)n[e]=0}const wQ=3,xQ=258,n7=29,SQ=256,CQ=SQ+1+n7,s7=30,_Q=512,kQ=new Array((CQ+2)*2);f1(kQ);const TQ=new Array(s7*2);f1(TQ);const NQ=new Array(_Q);f1(NQ);const AQ=new Array(xQ-wQ+1);f1(AQ);const EQ=new Array(n7);f1(EQ);const IQ=new Array(s7);f1(IQ);const OQ=(n,e,t,s)=>{let r=n&65535|0,a=n>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do r=r+e[s++]|0,a=a+r|0;while(--o);r%=65521,a%=65521}return r|a<<16|0};var NE=OQ;const DQ=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},$Q=new Uint32Array(DQ()),RQ=(n,e,t,s)=>{const r=$Q,a=s+t;n^=-1;for(let o=s;o<a;o++)n=n>>>8^r[(n^e[o])&255];return n^-1};var Gu=RQ,AE={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},r7={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const LQ=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var FQ=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const s in t)LQ(t,s)&&(n[s]=t[s])}}return n},MQ=n=>{let e=0;for(let s=0,r=n.length;s<r;s++)e+=n[s].length;const t=new Uint8Array(e);for(let s=0,r=0,a=n.length;s<a;s++){let o=n[s];t.set(o,r),r+=o.length}return t},i7={assign:FQ,flattenChunks:MQ};let a7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a7=!1}const kv=new Uint8Array(256);for(let n=0;n<256;n++)kv[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;kv[254]=kv[254]=1;var PQ=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,s,r,a,o=n.length,l=0;for(r=0;r<o;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<o&&(s=n.charCodeAt(r+1),(s&64512)===56320&&(t=65536+(t-55296<<10)+(s-56320),r++)),l+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(l),a=0,r=0;a<l;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<o&&(s=n.charCodeAt(r+1),(s&64512)===56320&&(t=65536+(t-55296<<10)+(s-56320),r++)),t<128?e[a++]=t:t<2048?(e[a++]=192|t>>>6,e[a++]=128|t&63):t<65536?(e[a++]=224|t>>>12,e[a++]=128|t>>>6&63,e[a++]=128|t&63):(e[a++]=240|t>>>18,e[a++]=128|t>>>12&63,e[a++]=128|t>>>6&63,e[a++]=128|t&63);return e};const zQ=(n,e)=>{if(e<65534&&n.subarray&&a7)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let s=0;s<e;s++)t+=String.fromCharCode(n[s]);return t};var BQ=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let s,r;const a=new Array(t*2);for(r=0,s=0;s<t;){let o=n[s++];if(o<128){a[r++]=o;continue}let l=kv[o];if(l>4){a[r++]=65533,s+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&s<t;)o=o<<6|n[s++]&63,l--;if(l>1){a[r++]=65533;continue}o<65536?a[r++]=o:(o-=65536,a[r++]=55296|o>>10&1023,a[r++]=56320|o&1023)}return zQ(a,r)},jQ=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+kv[n[t]]>e?t:e},EE={string2buf:PQ,buf2string:BQ,utf8border:jQ};function UQ(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var VQ=UQ;const fS=16209,WQ=16191;var HQ=function(e,t){let s,r,a,o,l,c,u,d,p,m,g,b,v,x,S,C,A,k,O,F,$,M,R,z;const I=e.state;s=e.next_in,R=e.input,r=s+(e.avail_in-5),a=e.next_out,z=e.output,o=a-(t-e.avail_out),l=a+(e.avail_out-257),c=I.dmax,u=I.wsize,d=I.whave,p=I.wnext,m=I.window,g=I.hold,b=I.bits,v=I.lencode,x=I.distcode,S=(1<<I.lenbits)-1,C=(1<<I.distbits)-1;e:do{b<15&&(g+=R[s++]<<b,b+=8,g+=R[s++]<<b,b+=8),A=v[g&S];t:for(;;){if(k=A>>>24,g>>>=k,b-=k,k=A>>>16&255,k===0)z[a++]=A&65535;else if(k&16){O=A&65535,k&=15,k&&(b<k&&(g+=R[s++]<<b,b+=8),O+=g&(1<<k)-1,g>>>=k,b-=k),b<15&&(g+=R[s++]<<b,b+=8,g+=R[s++]<<b,b+=8),A=x[g&C];n:for(;;){if(k=A>>>24,g>>>=k,b-=k,k=A>>>16&255,k&16){if(F=A&65535,k&=15,b<k&&(g+=R[s++]<<b,b+=8,b<k&&(g+=R[s++]<<b,b+=8)),F+=g&(1<<k)-1,F>c){e.msg="invalid distance too far back",I.mode=fS;break e}if(g>>>=k,b-=k,k=a-o,F>k){if(k=F-k,k>d&&I.sane){e.msg="invalid distance too far back",I.mode=fS;break e}if($=0,M=m,p===0){if($+=u-k,k<O){O-=k;do z[a++]=m[$++];while(--k);$=a-F,M=z}}else if(p<k){if($+=u+p-k,k-=p,k<O){O-=k;do z[a++]=m[$++];while(--k);if($=0,p<O){k=p,O-=k;do z[a++]=m[$++];while(--k);$=a-F,M=z}}}else if($+=p-k,k<O){O-=k;do z[a++]=m[$++];while(--k);$=a-F,M=z}for(;O>2;)z[a++]=M[$++],z[a++]=M[$++],z[a++]=M[$++],O-=3;O&&(z[a++]=M[$++],O>1&&(z[a++]=M[$++]))}else{$=a-F;do z[a++]=z[$++],z[a++]=z[$++],z[a++]=z[$++],O-=3;while(O>2);O&&(z[a++]=z[$++],O>1&&(z[a++]=z[$++]))}}else if((k&64)===0){A=x[(A&65535)+(g&(1<<k)-1)];continue n}else{e.msg="invalid distance code",I.mode=fS;break e}break}}else if((k&64)===0){A=v[(A&65535)+(g&(1<<k)-1)];continue t}else if(k&32){I.mode=WQ;break e}else{e.msg="invalid literal/length code",I.mode=fS;break e}break}}while(s<r&&a<l);O=b>>3,s-=O,b-=O<<3,g&=(1<<b)-1,e.next_in=s,e.next_out=a,e.avail_in=s<r?5+(r-s):5-(s-r),e.avail_out=a<l?257+(l-a):257-(a-l),I.hold=g,I.bits=b};const l0=15,H6=852,G6=592,q6=0,p5=1,X6=2,GQ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),qQ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),XQ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),YQ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),KQ=(n,e,t,s,r,a,o,l)=>{const c=l.bits;let u=0,d=0,p=0,m=0,g=0,b=0,v=0,x=0,S=0,C=0,A,k,O,F,$,M=null,R;const z=new Uint16Array(l0+1),I=new Uint16Array(l0+1);let j=null,H,q,re;for(u=0;u<=l0;u++)z[u]=0;for(d=0;d<s;d++)z[e[t+d]]++;for(g=c,m=l0;m>=1&&z[m]===0;m--);if(g>m&&(g=m),m===0)return r[a++]=1<<24|64<<16|0,r[a++]=1<<24|64<<16|0,l.bits=1,0;for(p=1;p<m&&z[p]===0;p++);for(g<p&&(g=p),x=1,u=1;u<=l0;u++)if(x<<=1,x-=z[u],x<0)return-1;if(x>0&&(n===q6||m!==1))return-1;for(I[1]=0,u=1;u<l0;u++)I[u+1]=I[u]+z[u];for(d=0;d<s;d++)e[t+d]!==0&&(o[I[e[t+d]]++]=d);if(n===q6?(M=j=o,R=20):n===p5?(M=GQ,j=qQ,R=257):(M=XQ,j=YQ,R=0),C=0,d=0,u=p,$=a,b=g,v=0,O=-1,S=1<<g,F=S-1,n===p5&&S>H6||n===X6&&S>G6)return 1;for(;;){H=u-v,o[d]+1<R?(q=0,re=o[d]):o[d]>=R?(q=j[o[d]-R],re=M[o[d]-R]):(q=96,re=0),A=1<<u-v,k=1<<b,p=k;do k-=A,r[$+(C>>v)+k]=H<<24|q<<16|re|0;while(k!==0);for(A=1<<u-1;C&A;)A>>=1;if(A!==0?(C&=A-1,C+=A):C=0,d++,--z[u]===0){if(u===m)break;u=e[t+o[d]]}if(u>g&&(C&F)!==O){for(v===0&&(v=g),$+=p,b=u-v,x=1<<b;b+v<m&&(x-=z[b+v],!(x<=0));)b++,x<<=1;if(S+=1<<b,n===p5&&S>H6||n===X6&&S>G6)return 1;O=C&F,r[O]=g<<24|b<<16|$-a|0}}return C!==0&&(r[$+C]=u-v<<24|64<<16|0),l.bits=g,0};var mv=KQ;const ZQ=0,o7=1,l7=2,{Z_FINISH:Y6,Z_BLOCK:JQ,Z_TREES:pS,Z_OK:km,Z_STREAM_END:QQ,Z_NEED_DICT:eee,Z_STREAM_ERROR:fc,Z_DATA_ERROR:c7,Z_MEM_ERROR:u7,Z_BUF_ERROR:tee,Z_DEFLATED:K6}=r7,Y_=16180,Z6=16181,J6=16182,Q6=16183,e4=16184,t4=16185,n4=16186,s4=16187,r4=16188,i4=16189,LC=16190,sd=16191,m5=16192,a4=16193,g5=16194,o4=16195,l4=16196,c4=16197,u4=16198,mS=16199,gS=16200,h4=16201,d4=16202,f4=16203,p4=16204,m4=16205,y5=16206,g4=16207,y4=16208,hr=16209,h7=16210,d7=16211,nee=852,see=592,ree=15,iee=ree,b4=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function aee(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Zm=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<Y_||e.mode>d7?1:0},f7=n=>{if(Zm(n))return fc;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=Y_,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(nee),e.distcode=e.distdyn=new Int32Array(see),e.sane=1,e.back=-1,km},p7=n=>{if(Zm(n))return fc;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,f7(n)},m7=(n,e)=>{let t;if(Zm(n))return fc;const s=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?fc:(s.window!==null&&s.wbits!==e&&(s.window=null),s.wrap=t,s.wbits=e,p7(n))},g7=(n,e)=>{if(!n)return fc;const t=new aee;n.state=t,t.strm=n,t.window=null,t.mode=Y_;const s=m7(n,e);return s!==km&&(n.state=null),s},oee=n=>g7(n,iee);let v4=!0,b5,v5;const lee=n=>{if(v4){b5=new Int32Array(512),v5=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(mv(o7,n.lens,0,288,b5,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;mv(l7,n.lens,0,32,v5,0,n.work,{bits:5}),v4=!1}n.lencode=b5,n.lenbits=9,n.distcode=v5,n.distbits=5},y7=(n,e,t,s)=>{let r;const a=n.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(e.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>s&&(r=s),a.window.set(e.subarray(t-s,t-s+r),a.wnext),s-=r,s?(a.window.set(e.subarray(t-s,t),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},cee=(n,e)=>{let t,s,r,a,o,l,c,u,d,p,m,g,b,v,x=0,S,C,A,k,O,F,$,M;const R=new Uint8Array(4);let z,I;const j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Zm(n)||!n.output||!n.input&&n.avail_in!==0)return fc;t=n.state,t.mode===sd&&(t.mode=m5),o=n.next_out,r=n.output,c=n.avail_out,a=n.next_in,s=n.input,l=n.avail_in,u=t.hold,d=t.bits,p=l,m=c,M=km;e:for(;;)switch(t.mode){case Y_:if(t.wrap===0){t.mode=m5;break}for(;d<16;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(t.wrap&2&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,R[0]=u&255,R[1]=u>>>8&255,t.check=Gu(t.check,R,2,0),u=0,d=0,t.mode=Z6;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){n.msg="incorrect header check",t.mode=hr;break}if((u&15)!==K6){n.msg="unknown compression method",t.mode=hr;break}if(u>>>=4,d-=4,$=(u&15)+8,t.wbits===0&&(t.wbits=$),$>15||$>t.wbits){n.msg="invalid window size",t.mode=hr;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=u&512?i4:sd,u=0,d=0;break;case Z6:for(;d<16;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(t.flags=u,(t.flags&255)!==K6){n.msg="unknown compression method",t.mode=hr;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=hr;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&t.wrap&4&&(R[0]=u&255,R[1]=u>>>8&255,t.check=Gu(t.check,R,2,0)),u=0,d=0,t.mode=J6;case J6:for(;d<32;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}t.head&&(t.head.time=u),t.flags&512&&t.wrap&4&&(R[0]=u&255,R[1]=u>>>8&255,R[2]=u>>>16&255,R[3]=u>>>24&255,t.check=Gu(t.check,R,4,0)),u=0,d=0,t.mode=Q6;case Q6:for(;d<16;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&t.wrap&4&&(R[0]=u&255,R[1]=u>>>8&255,t.check=Gu(t.check,R,2,0)),u=0,d=0,t.mode=e4;case e4:if(t.flags&1024){for(;d<16;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&t.wrap&4&&(R[0]=u&255,R[1]=u>>>8&255,t.check=Gu(t.check,R,2,0)),u=0,d=0}else t.head&&(t.head.extra=null);t.mode=t4;case t4:if(t.flags&1024&&(g=t.length,g>l&&(g=l),g&&(t.head&&($=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(s.subarray(a,a+g),$)),t.flags&512&&t.wrap&4&&(t.check=Gu(t.check,s,g,a)),l-=g,a+=g,t.length-=g),t.length))break e;t.length=0,t.mode=n4;case n4:if(t.flags&2048){if(l===0)break e;g=0;do $=s[a+g++],t.head&&$&&t.length<65536&&(t.head.name+=String.fromCharCode($));while($&&g<l);if(t.flags&512&&t.wrap&4&&(t.check=Gu(t.check,s,g,a)),l-=g,a+=g,$)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=s4;case s4:if(t.flags&4096){if(l===0)break e;g=0;do $=s[a+g++],t.head&&$&&t.length<65536&&(t.head.comment+=String.fromCharCode($));while($&&g<l);if(t.flags&512&&t.wrap&4&&(t.check=Gu(t.check,s,g,a)),l-=g,a+=g,$)break e}else t.head&&(t.head.comment=null);t.mode=r4;case r4:if(t.flags&512){for(;d<16;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(t.wrap&4&&u!==(t.check&65535)){n.msg="header crc mismatch",t.mode=hr;break}u=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=sd;break;case i4:for(;d<32;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}n.adler=t.check=b4(u),u=0,d=0,t.mode=LC;case LC:if(t.havedict===0)return n.next_out=o,n.avail_out=c,n.next_in=a,n.avail_in=l,t.hold=u,t.bits=d,eee;n.adler=t.check=1,t.mode=sd;case sd:if(e===JQ||e===pS)break e;case m5:if(t.last){u>>>=d&7,d-=d&7,t.mode=y5;break}for(;d<3;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}switch(t.last=u&1,u>>>=1,d-=1,u&3){case 0:t.mode=a4;break;case 1:if(lee(t),t.mode=mS,e===pS){u>>>=2,d-=2;break e}break;case 2:t.mode=l4;break;case 3:n.msg="invalid block type",t.mode=hr}u>>>=2,d-=2;break;case a4:for(u>>>=d&7,d-=d&7;d<32;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if((u&65535)!==(u>>>16^65535)){n.msg="invalid stored block lengths",t.mode=hr;break}if(t.length=u&65535,u=0,d=0,t.mode=g5,e===pS)break e;case g5:t.mode=o4;case o4:if(g=t.length,g){if(g>l&&(g=l),g>c&&(g=c),g===0)break e;r.set(s.subarray(a,a+g),o),l-=g,a+=g,c-=g,o+=g,t.length-=g;break}t.mode=sd;break;case l4:for(;d<14;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(t.nlen=(u&31)+257,u>>>=5,d-=5,t.ndist=(u&31)+1,u>>>=5,d-=5,t.ncode=(u&15)+4,u>>>=4,d-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=hr;break}t.have=0,t.mode=c4;case c4:for(;t.have<t.ncode;){for(;d<3;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}t.lens[j[t.have++]]=u&7,u>>>=3,d-=3}for(;t.have<19;)t.lens[j[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,z={bits:t.lenbits},M=mv(ZQ,t.lens,0,19,t.lencode,0,t.work,z),t.lenbits=z.bits,M){n.msg="invalid code lengths set",t.mode=hr;break}t.have=0,t.mode=u4;case u4:for(;t.have<t.nlen+t.ndist;){for(;x=t.lencode[u&(1<<t.lenbits)-1],S=x>>>24,C=x>>>16&255,A=x&65535,!(S<=d);){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(A<16)u>>>=S,d-=S,t.lens[t.have++]=A;else{if(A===16){for(I=S+2;d<I;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(u>>>=S,d-=S,t.have===0){n.msg="invalid bit length repeat",t.mode=hr;break}$=t.lens[t.have-1],g=3+(u&3),u>>>=2,d-=2}else if(A===17){for(I=S+3;d<I;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}u>>>=S,d-=S,$=0,g=3+(u&7),u>>>=3,d-=3}else{for(I=S+7;d<I;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}u>>>=S,d-=S,$=0,g=11+(u&127),u>>>=7,d-=7}if(t.have+g>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=hr;break}for(;g--;)t.lens[t.have++]=$}}if(t.mode===hr)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=hr;break}if(t.lenbits=9,z={bits:t.lenbits},M=mv(o7,t.lens,0,t.nlen,t.lencode,0,t.work,z),t.lenbits=z.bits,M){n.msg="invalid literal/lengths set",t.mode=hr;break}if(t.distbits=6,t.distcode=t.distdyn,z={bits:t.distbits},M=mv(l7,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,z),t.distbits=z.bits,M){n.msg="invalid distances set",t.mode=hr;break}if(t.mode=mS,e===pS)break e;case mS:t.mode=gS;case gS:if(l>=6&&c>=258){n.next_out=o,n.avail_out=c,n.next_in=a,n.avail_in=l,t.hold=u,t.bits=d,HQ(n,m),o=n.next_out,r=n.output,c=n.avail_out,a=n.next_in,s=n.input,l=n.avail_in,u=t.hold,d=t.bits,t.mode===sd&&(t.back=-1);break}for(t.back=0;x=t.lencode[u&(1<<t.lenbits)-1],S=x>>>24,C=x>>>16&255,A=x&65535,!(S<=d);){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(C&&(C&240)===0){for(k=S,O=C,F=A;x=t.lencode[F+((u&(1<<k+O)-1)>>k)],S=x>>>24,C=x>>>16&255,A=x&65535,!(k+S<=d);){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}u>>>=k,d-=k,t.back+=k}if(u>>>=S,d-=S,t.back+=S,t.length=A,C===0){t.mode=m4;break}if(C&32){t.back=-1,t.mode=sd;break}if(C&64){n.msg="invalid literal/length code",t.mode=hr;break}t.extra=C&15,t.mode=h4;case h4:if(t.extra){for(I=t.extra;d<I;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=d4;case d4:for(;x=t.distcode[u&(1<<t.distbits)-1],S=x>>>24,C=x>>>16&255,A=x&65535,!(S<=d);){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if((C&240)===0){for(k=S,O=C,F=A;x=t.distcode[F+((u&(1<<k+O)-1)>>k)],S=x>>>24,C=x>>>16&255,A=x&65535,!(k+S<=d);){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}u>>>=k,d-=k,t.back+=k}if(u>>>=S,d-=S,t.back+=S,C&64){n.msg="invalid distance code",t.mode=hr;break}t.offset=A,t.extra=C&15,t.mode=f4;case f4:if(t.extra){for(I=t.extra;d<I;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=hr;break}t.mode=p4;case p4:if(c===0)break e;if(g=m-c,t.offset>g){if(g=t.offset-g,g>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=hr;break}g>t.wnext?(g-=t.wnext,b=t.wsize-g):b=t.wnext-g,g>t.length&&(g=t.length),v=t.window}else v=r,b=o-t.offset,g=t.length;g>c&&(g=c),c-=g,t.length-=g;do r[o++]=v[b++];while(--g);t.length===0&&(t.mode=gS);break;case m4:if(c===0)break e;r[o++]=t.length,c--,t.mode=gS;break;case y5:if(t.wrap){for(;d<32;){if(l===0)break e;l--,u|=s[a++]<<d,d+=8}if(m-=c,n.total_out+=m,t.total+=m,t.wrap&4&&m&&(n.adler=t.check=t.flags?Gu(t.check,r,m,o-m):NE(t.check,r,m,o-m)),m=c,t.wrap&4&&(t.flags?u:b4(u))!==t.check){n.msg="incorrect data check",t.mode=hr;break}u=0,d=0}t.mode=g4;case g4:if(t.wrap&&t.flags){for(;d<32;){if(l===0)break e;l--,u+=s[a++]<<d,d+=8}if(t.wrap&4&&u!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=hr;break}u=0,d=0}t.mode=y4;case y4:M=QQ;break e;case hr:M=c7;break e;case h7:return u7;case d7:default:return fc}return n.next_out=o,n.avail_out=c,n.next_in=a,n.avail_in=l,t.hold=u,t.bits=d,(t.wsize||m!==n.avail_out&&t.mode<hr&&(t.mode<y5||e!==Y6))&&y7(n,n.output,n.next_out,m-n.avail_out),p-=n.avail_in,m-=n.avail_out,n.total_in+=p,n.total_out+=m,t.total+=m,t.wrap&4&&m&&(n.adler=t.check=t.flags?Gu(t.check,r,m,n.next_out-m):NE(t.check,r,m,n.next_out-m)),n.data_type=t.bits+(t.last?64:0)+(t.mode===sd?128:0)+(t.mode===mS||t.mode===g5?256:0),(p===0&&m===0||e===Y6)&&M===km&&(M=tee),M},uee=n=>{if(Zm(n))return fc;let e=n.state;return e.window&&(e.window=null),n.state=null,km},hee=(n,e)=>{if(Zm(n))return fc;const t=n.state;return(t.wrap&2)===0?fc:(t.head=e,e.done=!1,km)},dee=(n,e)=>{const t=e.length;let s,r,a;return Zm(n)||(s=n.state,s.wrap!==0&&s.mode!==LC)?fc:s.mode===LC&&(r=1,r=NE(r,e,t,0),r!==s.check)?c7:(a=y7(n,e,t,t),a?(s.mode=h7,u7):(s.havedict=1,km))};var fee=p7,pee=m7,mee=f7,gee=oee,yee=g7,bee=cee,vee=uee,wee=hee,xee=dee,See="pako inflate (from Nodeca project)",od={inflateReset:fee,inflateReset2:pee,inflateResetKeep:mee,inflateInit:gee,inflateInit2:yee,inflate:bee,inflateEnd:vee,inflateGetHeader:wee,inflateSetDictionary:xee,inflateInfo:See};function Cee(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var _ee=Cee;const b7=Object.prototype.toString,{Z_NO_FLUSH:kee,Z_FINISH:Tee,Z_OK:Tv,Z_STREAM_END:w5,Z_NEED_DICT:x5,Z_STREAM_ERROR:Nee,Z_DATA_ERROR:w4,Z_MEM_ERROR:Aee}=r7;function mw(n){this.options=i7.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new VQ,this.strm.avail_out=0;let t=od.inflateInit2(this.strm,e.windowBits);if(t!==Tv)throw new Error(AE[t]);if(this.header=new _ee,od.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=EE.string2buf(e.dictionary):b7.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=od.inflateSetDictionary(this.strm,e.dictionary),t!==Tv)))throw new Error(AE[t])}mw.prototype.push=function(n,e){const t=this.strm,s=this.options.chunkSize,r=this.options.dictionary;let a,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?Tee:kee,b7.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(s),t.next_out=0,t.avail_out=s),a=od.inflate(t,o),a===x5&&r&&(a=od.inflateSetDictionary(t,r),a===Tv?a=od.inflate(t,o):a===w4&&(a=x5));t.avail_in>0&&a===w5&&t.state.wrap>0&&n[t.next_in]!==0;)od.inflateReset(t),a=od.inflate(t,o);switch(a){case Nee:case w4:case x5:case Aee:return this.onEnd(a),this.ended=!0,!1}if(l=t.avail_out,t.next_out&&(t.avail_out===0||a===w5))if(this.options.to==="string"){let c=EE.utf8border(t.output,t.next_out),u=t.next_out-c,d=EE.buf2string(t.output,c);t.next_out=u,t.avail_out=s-u,u&&t.output.set(t.output.subarray(c,c+u),0),this.onData(d)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(a===Tv&&l===0)){if(a===w5)return a=od.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};mw.prototype.onData=function(n){this.chunks.push(n)};mw.prototype.onEnd=function(n){n===Tv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i7.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Eee(n,e){const t=new mw(e);if(t.push(n),t.err)throw t.msg||AE[t.err];return t.result}var Iee=mw,Oee=Eee,Dee={Inflate:Iee,inflate:Oee};const{Inflate:$ee,inflate:Ree}=Dee;var x4=$ee,Lee=Ree;const v7=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;v7[n]=e}const S4=4294967295;function Fee(n,e,t){let s=n;for(let r=0;r<t;r++)s=v7[(s^e[r])&255]^s>>>8;return s}function Mee(n,e){return(Fee(S4,n,e)^S4)>>>0}function C4(n,e,t){const s=n.readUint32(),r=Mee(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(r!==s)throw new Error(`CRC mismatch for chunk ${t}. Expected ${s}, found ${r}`)}function w7(n,e,t){for(let s=0;s<t;s++)e[s]=n[s]}function x7(n,e,t,s){let r=0;for(;r<s;r++)e[r]=n[r];for(;r<t;r++)e[r]=n[r]+e[r-s]&255}function S7(n,e,t,s){let r=0;if(t.length===0)for(;r<s;r++)e[r]=n[r];else for(;r<s;r++)e[r]=n[r]+t[r]&255}function C7(n,e,t,s,r){let a=0;if(t.length===0){for(;a<r;a++)e[a]=n[a];for(;a<s;a++)e[a]=n[a]+(e[a-r]>>1)&255}else{for(;a<r;a++)e[a]=n[a]+(t[a]>>1)&255;for(;a<s;a++)e[a]=n[a]+(e[a-r]+t[a]>>1)&255}}function _7(n,e,t,s,r){let a=0;if(t.length===0){for(;a<r;a++)e[a]=n[a];for(;a<s;a++)e[a]=n[a]+e[a-r]&255}else{for(;a<r;a++)e[a]=n[a]+t[a]&255;for(;a<s;a++)e[a]=n[a]+Pee(e[a-r],t[a],t[a-r])&255}}function Pee(n,e,t){const s=n+e-t,r=Math.abs(s-n),a=Math.abs(s-e),o=Math.abs(s-t);return r<=a&&r<=o?n:a<=o?e:t}function zee(n,e,t,s,r,a){switch(n){case 0:w7(e,t,r);break;case 1:x7(e,t,r,a);break;case 2:S7(e,t,s,r);break;case 3:C7(e,t,s,r,a);break;case 4:_7(e,t,s,r,a);break;default:throw new Error(`Unsupported filter: ${n}`)}}const Bee=new Uint16Array([255]),jee=new Uint8Array(Bee.buffer),Uee=jee[0]===255;function Vee(n){const{data:e,width:t,height:s,channels:r,depth:a}=n,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(a/8)*r,c=new Uint8Array(s*t*l);let u=0;for(let d=0;d<7;d++){const p=o[d],m=Math.ceil((t-p.x)/p.xStep),g=Math.ceil((s-p.y)/p.yStep);if(m<=0||g<=0)continue;const b=m*l,v=new Uint8Array(b);for(let x=0;x<g;x++){const S=e[u++],C=e.subarray(u,u+b);u+=b;const A=new Uint8Array(b);zee(S,C,A,v,b,l),v.set(A);for(let k=0;k<m;k++){const O=p.x+k*p.xStep,F=p.y+x*p.yStep;if(!(O>=t||F>=s))for(let $=0;$<l;$++)c[(F*t+O)*l+$]=A[k*l+$]}}}if(a===16){const d=new Uint16Array(c.buffer);if(Uee)for(let p=0;p<d.length;p++)d[p]=Wee(d[p]);return d}else return c}function Wee(n){return(n&255)<<8|n>>8&255}const Hee=new Uint16Array([255]),Gee=new Uint8Array(Hee.buffer),qee=Gee[0]===255,Xee=new Uint8Array(0);function _4(n){const{data:e,width:t,height:s,channels:r,depth:a}=n,o=Math.ceil(a/8)*r,l=Math.ceil(a/8*r*t),c=new Uint8Array(s*l);let u=Xee,d=0,p,m;for(let g=0;g<s;g++){switch(p=e.subarray(d+1,d+1+l),m=c.subarray(g*l,(g+1)*l),e[d]){case 0:w7(p,m,l);break;case 1:x7(p,m,l,o);break;case 2:S7(p,m,u,l);break;case 3:C7(p,m,u,l,o);break;case 4:_7(p,m,u,l,o);break;default:throw new Error(`Unsupported filter: ${e[d]}`)}u=m,d+=l+1}if(a===16){const g=new Uint16Array(c.buffer);if(qee)for(let b=0;b<g.length;b++)g[b]=Yee(g[b]);return g}else return c}function Yee(n){return(n&255)<<8|n>>8&255}const GS=Uint8Array.of(137,80,78,71,13,10,26,10);function k4(n){if(!Kee(n.readBytes(GS.length)))throw new Error("wrong PNG signature")}function Kee(n){if(n.length<GS.length)return!1;for(let e=0;e<GS.length;e++)if(n[e]!==GS[e])return!1;return!0}const Zee="tEXt",Jee=0,k7=new TextDecoder("latin1");function Qee(n){if(tte(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const ete=/^[\u0000-\u00FF]*$/;function tte(n){if(!ete.test(n))throw new Error("invalid latin1 text")}function nte(n,e,t){const s=T7(e);n[s]=ste(e,t-s.length-1)}function T7(n){for(n.mark();n.readByte()!==Jee;);const e=n.offset;n.reset();const t=k7.decode(n.readBytes(e-n.offset-1));return n.skip(1),Qee(t),t}function ste(n,e){return k7.decode(n.readBytes(e))}const bl={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},S5={UNKNOWN:-1,DEFLATE:0},T4={UNKNOWN:-1,ADAPTIVE:0},C5={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},yS={NONE:0,BACKGROUND:1,PREVIOUS:2},_5={SOURCE:0,OVER:1};class rte extends RO{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:s=!1}=t;this._checkCrc=s,this._inflator=new x4,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=S5.UNKNOWN,this._filterMethod=T4.UNKNOWN,this._interlaceMethod=C5.UNKNOWN,this._colorType=bl.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(k4(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(k4(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const s=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case Zee:nte(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-s!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?C4(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const s=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=s+e;break}if(this.offset-s!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?C4(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=ite(this.readUint8());const t=this.readUint8();this._colorType=t;let s;switch(t){case bl.GREYSCALE:s=1;break;case bl.TRUECOLOUR:s=3;break;case bl.INDEXED_COLOUR:s=1;break;case bl.GREYSCALE_ALPHA:s=2;break;case bl.TRUECOLOUR_ALPHA:s=4;break;case bl.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=s,this._compressionMethod=this.readUint8(),this._compressionMethod!==S5.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const s=[];this._palette=s;for(let r=0;r<t;r++)s.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,s=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,s,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,s=this.offset+this.byteOffset;if(s+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,s,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case bl.GREYSCALE:case bl.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case bl.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const s=this.readByte();this._palette[t].push(s)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case bl.UNKNOWN:case bl.GREYSCALE_ALPHA:case bl.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=T7(this),s=this.readUint8();if(s!==S5.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:Lee(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),s=this.readByte();this._png.resolution={x:e,y:t,unit:s}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},s=this._frames.at(e);if(s){if(s.data=_4({data:s.data,width:s.width,height:s.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||s.xOffset===0&&s.yOffset===0&&s.width===this._png.width&&s.height===this._png.height)t.data=s.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(s,r,t),this.addFrameDataToCanvas(t,s)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,s){switch(e.disposeOp){case yS.NONE:break;case yS.BACKGROUND:for(let r=0;r<this._png.height;r++)for(let a=0;a<this._png.width;a++){const o=(r*e.width+a)*this._png.channels;for(let l=0;l<this._png.channels;l++)s.data[o+l]=0}break;case yS.PREVIOUS:s.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const s=1<<this._png.depth,r=(a,o)=>{const l=((a+t.yOffset)*this._png.width+t.xOffset+o)*this._png.channels,c=(a*t.width+o)*this._png.channels;return{index:l,frameIndex:c}};switch(t.blendOp){case _5.SOURCE:for(let a=0;a<t.height;a++)for(let o=0;o<t.width;o++){const{index:l,frameIndex:c}=r(a,o);for(let u=0;u<this._png.channels;u++)e.data[l+u]=t.data[c+u]}break;case _5.OVER:for(let a=0;a<t.height;a++)for(let o=0;o<t.width;o++){const{index:l,frameIndex:c}=r(a,o);for(let u=0;u<this._png.channels;u++){const d=t.data[c+this._png.channels-1]/s,p=u%(this._png.channels-1)===0?1:t.data[c+u],m=Math.floor(d*p+(1-d)*e.data[l+u]);e.data[l+u]+=m}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==T4.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===C5.NO_INTERLACE)this._png.data=_4({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===C5.ADAM7)this._png.data=Vee({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:yS.NONE,blendOp:_5.SOURCE,data:e}),this._inflator=new x4,this._writingDataChunks=!1}}function ite(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var N4;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(N4||(N4={}));function ate(n,e){return new rte(n,e).decode()}var wn=(function(){return typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:this})();function k5(){wn.console&&typeof wn.console.log=="function"&&wn.console.log.apply(wn.console,arguments)}var Vs={log:k5,warn:function(n){wn.console&&(typeof wn.console.warn=="function"?wn.console.warn.apply(wn.console,arguments):k5.call(null,arguments))},error:function(n){wn.console&&(typeof wn.console.error=="function"?wn.console.error.apply(wn.console,arguments):k5(n))}};function T5(n,e,t){var s=new XMLHttpRequest;s.open("GET",n),s.responseType="blob",s.onload=function(){qp(s.response,e,t)},s.onerror=function(){Vs.error("could not download file")},s.send()}function A4(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function bS(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var qp=wn.saveAs||((typeof window>"u"?"undefined":Ns(window))!=="object"||window!==wn?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var s=wn.URL||wn.webkitURL,r=document.createElement("a");e=e||n.name||"download",r.download=e,r.rel="noopener",typeof n=="string"?(r.href=n,r.origin!==location.origin?A4(r.href)?T5(n,e,t):bS(r,r.target="_blank"):bS(r)):(r.href=s.createObjectURL(n),setTimeout(function(){s.revokeObjectURL(r.href)},4e4),setTimeout(function(){bS(r)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(A4(n))T5(n,e,t);else{var s=document.createElement("a");s.href=n,s.target="_blank",setTimeout(function(){bS(s)})}else navigator.msSaveOrOpenBlob((function(r,a){return a===void 0?a={autoBom:!1}:Ns(a)!=="object"&&(Vs.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r})(n,t),e)}:function(n,e,t,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),typeof n=="string")return T5(n,e,t);var r=n.type==="application/octet-stream",a=/constructor/i.test(wn.HTMLElement)||wn.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||r&&a)&&(typeof FileReader>"u"?"undefined":Ns(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var d=l.result;d=o?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=d:location=d,s=null},l.readAsDataURL(n)}else{var c=wn.URL||wn.webkitURL,u=c.createObjectURL(n);s?s.location=u:location.href=u,s=null,setTimeout(function(){c.revokeObjectURL(u)},4e4)}});function N7(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],s=0;s<t.length;s++){var r=t[s].re,a=t[s].process,o=r.exec(n);o&&(e=a(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),u=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),u.length==1&&(u="0"+u),"#"+l+c+u}}var qS=wn.atob.bind(wn),E4=wn.btoa.bind(wn);function N5(n,e){var t=n[0],s=n[1],r=n[2],a=n[3];t=xa(t,s,r,a,e[0],7,-680876936),a=xa(a,t,s,r,e[1],12,-389564586),r=xa(r,a,t,s,e[2],17,606105819),s=xa(s,r,a,t,e[3],22,-1044525330),t=xa(t,s,r,a,e[4],7,-176418897),a=xa(a,t,s,r,e[5],12,1200080426),r=xa(r,a,t,s,e[6],17,-1473231341),s=xa(s,r,a,t,e[7],22,-45705983),t=xa(t,s,r,a,e[8],7,1770035416),a=xa(a,t,s,r,e[9],12,-1958414417),r=xa(r,a,t,s,e[10],17,-42063),s=xa(s,r,a,t,e[11],22,-1990404162),t=xa(t,s,r,a,e[12],7,1804603682),a=xa(a,t,s,r,e[13],12,-40341101),r=xa(r,a,t,s,e[14],17,-1502002290),t=Sa(t,s=xa(s,r,a,t,e[15],22,1236535329),r,a,e[1],5,-165796510),a=Sa(a,t,s,r,e[6],9,-1069501632),r=Sa(r,a,t,s,e[11],14,643717713),s=Sa(s,r,a,t,e[0],20,-373897302),t=Sa(t,s,r,a,e[5],5,-701558691),a=Sa(a,t,s,r,e[10],9,38016083),r=Sa(r,a,t,s,e[15],14,-660478335),s=Sa(s,r,a,t,e[4],20,-405537848),t=Sa(t,s,r,a,e[9],5,568446438),a=Sa(a,t,s,r,e[14],9,-1019803690),r=Sa(r,a,t,s,e[3],14,-187363961),s=Sa(s,r,a,t,e[8],20,1163531501),t=Sa(t,s,r,a,e[13],5,-1444681467),a=Sa(a,t,s,r,e[2],9,-51403784),r=Sa(r,a,t,s,e[7],14,1735328473),t=Ca(t,s=Sa(s,r,a,t,e[12],20,-1926607734),r,a,e[5],4,-378558),a=Ca(a,t,s,r,e[8],11,-2022574463),r=Ca(r,a,t,s,e[11],16,1839030562),s=Ca(s,r,a,t,e[14],23,-35309556),t=Ca(t,s,r,a,e[1],4,-1530992060),a=Ca(a,t,s,r,e[4],11,1272893353),r=Ca(r,a,t,s,e[7],16,-155497632),s=Ca(s,r,a,t,e[10],23,-1094730640),t=Ca(t,s,r,a,e[13],4,681279174),a=Ca(a,t,s,r,e[0],11,-358537222),r=Ca(r,a,t,s,e[3],16,-722521979),s=Ca(s,r,a,t,e[6],23,76029189),t=Ca(t,s,r,a,e[9],4,-640364487),a=Ca(a,t,s,r,e[12],11,-421815835),r=Ca(r,a,t,s,e[15],16,530742520),t=_a(t,s=Ca(s,r,a,t,e[2],23,-995338651),r,a,e[0],6,-198630844),a=_a(a,t,s,r,e[7],10,1126891415),r=_a(r,a,t,s,e[14],15,-1416354905),s=_a(s,r,a,t,e[5],21,-57434055),t=_a(t,s,r,a,e[12],6,1700485571),a=_a(a,t,s,r,e[3],10,-1894986606),r=_a(r,a,t,s,e[10],15,-1051523),s=_a(s,r,a,t,e[1],21,-2054922799),t=_a(t,s,r,a,e[8],6,1873313359),a=_a(a,t,s,r,e[15],10,-30611744),r=_a(r,a,t,s,e[6],15,-1560198380),s=_a(s,r,a,t,e[13],21,1309151649),t=_a(t,s,r,a,e[4],6,-145523070),a=_a(a,t,s,r,e[11],10,-1120210379),r=_a(r,a,t,s,e[2],15,718787259),s=_a(s,r,a,t,e[9],21,-343485551),n[0]=If(t,n[0]),n[1]=If(s,n[1]),n[2]=If(r,n[2]),n[3]=If(a,n[3])}function K_(n,e,t,s,r,a){return e=If(If(e,n),If(s,a)),If(e<<r|e>>>32-r,t)}function xa(n,e,t,s,r,a,o){return K_(e&t|~e&s,n,e,r,a,o)}function Sa(n,e,t,s,r,a,o){return K_(e&s|t&~s,n,e,r,a,o)}function Ca(n,e,t,s,r,a,o){return K_(e^t^s,n,e,r,a,o)}function _a(n,e,t,s,r,a,o){return K_(t^(e|~s),n,e,r,a,o)}function A7(n){var e,t=n.length,s=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)N5(s,ote(n.substring(e-64,e)));n=n.substring(e-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)r[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(N5(s,r),e=0;e<16;e++)r[e]=0;return r[14]=8*t,N5(s,r),s}function ote(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var I4="0123456789abcdef".split("");function lte(n){for(var e="",t=0;t<4;t++)e+=I4[n>>8*t+4&15]+I4[n>>8*t&15];return e}function cte(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function IE(n){return A7(n).map(cte).join("")}var ute=(function(n){for(var e=0;e<n.length;e++)n[e]=lte(n[e]);return n.join("")})(A7("hello"))!="5d41402abc4b2a76b9719d911017c592";function If(n,e){if(ute){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}function OE(n,e){var t,s,r,a;if(n!==t){for(var o=(r=n,a=1+(256/n.length|0),new Array(a+1).join(r)),l=[],c=0;c<256;c++)l[c]=c;var u=0;for(c=0;c<256;c++){var d=l[c];u=(u+d+o.charCodeAt(c))%256,l[c]=l[u],l[u]=d}t=n,s=l}else l=s;var p=e.length,m=0,g=0,b="";for(c=0;c<p;c++)g=(g+(d=l[m=(m+1)%256]))%256,l[m]=l[g],l[g]=d,o=l[(l[m]+l[g])%256],b+=String.fromCharCode(e.charCodeAt(c)^o);return b}var O4={print:4,modify:8,copy:16,"annot-forms":32};function f0(n,e,t,s){this.v=1,this.r=2;var r=192;n.forEach(function(l){if(O4.perm!==void 0)throw new Error("Invalid permission: "+l);r+=O4[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var a=(e+this.padding).substr(0,32),o=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,o),this.P=-(1+(255^r)),this.encryptionKey=IE(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(s)).substr(0,5),this.U=OE(this.encryptionKey,this.padding)}function p0(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,s=0;s<t;s++){var r=n.charCodeAt(s);e+=r<33||r===35||r===37||r===40||r===41||r===47||r===60||r===62||r===91||r===93||r===123||r===125||r>126?"#"+("0"+r.toString(16)).slice(-2):n[s]}return e}function D4(n){if(Ns(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,s,r){if(r=r||!1,typeof t!="string"||typeof s!="function"||typeof r!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var a=Math.random().toString(35);return e[t][a]=[s,!!r],a},this.unsubscribe=function(t){for(var s in e)if(e[s][t])return delete e[s][t],Object.keys(e[s]).length===0&&delete e[s],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var s=Array.prototype.slice.call(arguments,1),r=[];for(var a in e[t]){var o=e[t][a];try{o[0].apply(n,s)}catch(l){wn.console&&Vs.error("jsPDF PubSub Error",l.message,l)}o[1]&&r.push(a)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function FC(n){if(!(this instanceof FC))return new FC(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function E7(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function Qp(n,e,t,s,r){if(!(this instanceof Qp))return new Qp(n,e,t,s,r);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,E7.call(this,s,r)}function S0(n,e,t,s,r){if(!(this instanceof S0))return new S0(n,e,t,s,r);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,E7.call(this,s,r)}function qt(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",s=arguments[1],r=arguments[2],a=arguments[3],o=[],l=1,c=16,u="S",d=null;Ns(n=n||{})==="object"&&(t=n.orientation,s=n.unit||s,r=n.format||r,a=n.compress||n.compressPdf||a,(d=n.encryption||null)!==null&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),l=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(c=n.floatPrecision),u=n.defaultPathOperation||"S"),o=n.filters||(a===!0?["FlateEncode"]:o),s=s||"mm",t=(""+(t||"P")).toLowerCase();var p=n.putOnlyUsedFonts||!1,m={},g={internal:{},__private__:{}};g.__private__.PubSub=D4;var b="1.3",v=g.__private__.getPdfVersion=function(){return b};g.__private__.setPdfVersion=function(D){b=D};var x={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};g.__private__.getPageFormats=function(){return x};var S=g.__private__.getPageFormat=function(D){return x[D]};r=r||"a4";var C="compat",A="advanced",k=C;function O(){this.saveGraphicsState(),ce(new Kt(fn,0,0,-fn,0,Ec()*fn).toString()+" cm"),this.setFontSize(this.getFontSize()/fn),u="n",k=A}function F(){this.restoreGraphicsState(),u="S",k=C}var $=g.__private__.combineFontStyleAndFontWeight=function(D,K){if(D=="bold"&&K=="normal"||D=="bold"&&K==400||D=="normal"&&K=="italic"||D=="bold"&&K=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return K&&(D=K==400||K==="normal"?D==="italic"?"italic":"normal":K!=700&&K!=="bold"||D!=="normal"?(K==700?"bold":K)+""+D:"bold"),D};g.advancedAPI=function(D){var K=k===C;return K&&O.call(this),typeof D!="function"||(D(this),K&&F.call(this)),this},g.compatAPI=function(D){var K=k===A;return K&&F.call(this),typeof D!="function"||(D(this),K&&O.call(this)),this},g.isAdvancedAPI=function(){return k===A};var M,R=function(D){if(k!==A)throw new Error(D+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},z=g.roundToPrecision=g.__private__.roundToPrecision=function(D,K){var me=e||K;if(isNaN(D)||isNaN(me))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return D.toFixed(me).replace(/0+$/,"")};M=g.hpf=g.__private__.hpf=typeof c=="number"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return z(D,c)}:c==="smart"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return z(D,D>-1&&D<1?16:5)}:function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return z(D,16)};var I=g.f2=g.__private__.f2=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f2");return z(D,2)},j=g.__private__.f3=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f3");return z(D,3)},H=g.scale=g.__private__.scale=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.scale");return k===C?D*fn:k===A?D:void 0},q=function(D){return H((function(K){return k===C?Ec()-K:k===A?K:void 0})(D))};g.__private__.setPrecision=g.setPrecision=function(D){typeof parseInt(D,10)=="number"&&(e=parseInt(D,10))};var re,X="00000000000000000000000000000000",ne=g.__private__.getFileId=function(){return X},Q=g.__private__.setFileId=function(D){return X=D!==void 0&&/^[a-fA-F0-9]{32}$/.test(D)?D.toUpperCase():X.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),d!==null&&(Vr=new f0(d.userPermissions,d.userPassword,d.ownerPassword,X)),X};g.setFileId=function(D){return Q(D),this},g.getFileId=function(){return ne()};var he=g.__private__.convertDateToPDFDate=function(D){var K=D.getTimezoneOffset(),me=K<0?"+":"-",xe=Math.floor(Math.abs(K/60)),De=Math.abs(K%60),Je=[me,J(xe),"'",J(De),"'"].join("");return["D:",D.getFullYear(),J(D.getMonth()+1),J(D.getDate()),J(D.getHours()),J(D.getMinutes()),J(D.getSeconds()),Je].join("")},ye=g.__private__.convertPDFDateToDate=function(D){var K=parseInt(D.substr(2,4),10),me=parseInt(D.substr(6,2),10)-1,xe=parseInt(D.substr(8,2),10),De=parseInt(D.substr(10,2),10),Je=parseInt(D.substr(12,2),10),it=parseInt(D.substr(14,2),10);return new Date(K,me,xe,De,Je,it,0)},Y=g.__private__.setCreationDate=function(D){var K;if(D===void 0&&(D=new Date),D instanceof Date)K=he(D);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(D))throw new Error("Invalid argument passed to jsPDF.setCreationDate");K=D}return re=K},B=g.__private__.getCreationDate=function(D){var K=re;return D==="jsDate"&&(K=ye(re)),K};g.setCreationDate=function(D){return Y(D),this},g.getCreationDate=function(D){return B(D)};var G,J=g.__private__.padd2=function(D){return("0"+parseInt(D)).slice(-2)},oe=g.__private__.padd2Hex=function(D){return("00"+(D=D.toString())).substr(D.length)},de=0,ge=[],Ae=[],Ce=0,Fe=[],Ge=[],ot=!1,ut=Ae;g.__private__.setCustomOutputDestination=function(D){ot=!0,ut=D};var pt=function(D){ot||(ut=D)};g.__private__.resetCustomOutputDestination=function(){ot=!1,ut=Ae};var ce=g.__private__.out=function(D){return D=D.toString(),Ce+=D.length+1,ut.push(D),ut},rt=g.__private__.write=function(D){return ce(arguments.length===1?D.toString():Array.prototype.join.call(arguments," "))},At=g.__private__.getArrayBuffer=function(D){for(var K=D.length,me=new ArrayBuffer(K),xe=new Uint8Array(me);K--;)xe[K]=D.charCodeAt(K);return me},yt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];g.__private__.getStandardFonts=function(){return yt};var nt=n.fontSize||16;g.__private__.setFontSize=g.setFontSize=function(D){return nt=k===A?D/fn:D,this};var xt,vt=g.__private__.getFontSize=g.getFontSize=function(){return k===C?nt:nt*fn},Tt=n.R2L||!1;g.__private__.setR2L=g.setR2L=function(D){return Tt=D,this},g.__private__.getR2L=g.getR2L=function(){return Tt};var Lt,Yt=g.__private__.setZoomMode=function(D){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(D))xt=D;else if(isNaN(D)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(D)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+D+'" is not recognized.');xt=D}else xt=parseInt(D,10)};g.__private__.getZoomMode=function(){return xt};var mn,Jt=g.__private__.setPageMode=function(D){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(D)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+D+'" is not recognized.');Lt=D};g.__private__.getPageMode=function(){return Lt};var bn=g.__private__.setLayoutMode=function(D){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(D)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+D+'" is not recognized.');mn=D};g.__private__.getLayoutMode=function(){return mn},g.__private__.setDisplayMode=g.setDisplayMode=function(D,K,me){return Yt(D),bn(K),Jt(me),this};var cn={title:"",subject:"",author:"",keywords:"",creator:""};g.__private__.getDocumentProperty=function(D){if(Object.keys(cn).indexOf(D)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return cn[D]},g.__private__.getDocumentProperties=function(){return cn},g.__private__.setDocumentProperties=g.setProperties=g.setDocumentProperties=function(D){for(var K in cn)cn.hasOwnProperty(K)&&D[K]&&(cn[K]=D[K]);return this},g.__private__.setDocumentProperty=function(D,K){if(Object.keys(cn).indexOf(D)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return cn[D]=K};var Et,fn,zt,Ks,Cn,Qt={},un={},Un=[],en={},Is={},on={},gn={},Ss=null,An=0,Gt=[],Qn=new D4(g),Qo=n.hotfixes||[],Mi={},zl={},bo=[],Kt=function D(K,me,xe,De,Je,it){if(!(this instanceof D))return new D(K,me,xe,De,Je,it);isNaN(K)&&(K=1),isNaN(me)&&(me=0),isNaN(xe)&&(xe=0),isNaN(De)&&(De=1),isNaN(Je)&&(Je=0),isNaN(it)&&(it=0),this._matrix=[K,me,xe,De,Je,it]};Object.defineProperty(Kt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Kt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Kt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Kt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Kt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Kt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Kt.prototype,"a",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Kt.prototype,"b",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Kt.prototype,"c",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Kt.prototype,"d",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Kt.prototype,"e",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Kt.prototype,"f",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Kt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Kt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Kt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Kt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Kt.prototype.join=function(D){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(M).join(D)},Kt.prototype.multiply=function(D){var K=D.sx*this.sx+D.shy*this.shx,me=D.sx*this.shy+D.shy*this.sy,xe=D.shx*this.sx+D.sy*this.shx,De=D.shx*this.shy+D.sy*this.sy,Je=D.tx*this.sx+D.ty*this.shx+this.tx,it=D.tx*this.shy+D.ty*this.sy+this.ty;return new Kt(K,me,xe,De,Je,it)},Kt.prototype.decompose=function(){var D=this.sx,K=this.shy,me=this.shx,xe=this.sy,De=this.tx,Je=this.ty,it=Math.sqrt(D*D+K*K),Dt=(D/=it)*me+(K/=it)*xe;me-=D*Dt,xe-=K*Dt;var jt=Math.sqrt(me*me+xe*xe);return Dt/=jt,D*(xe/=jt)<K*(me/=jt)&&(D=-D,K=-K,Dt=-Dt,it=-it),{scale:new Kt(it,0,0,jt,0,0),translate:new Kt(1,0,0,1,De,Je),rotate:new Kt(D,K,-K,D,0,0),skew:new Kt(1,0,Dt,1,0,0)}},Kt.prototype.toString=function(D){return this.join(" ")},Kt.prototype.inversed=function(){var D=this.sx,K=this.shy,me=this.shx,xe=this.sy,De=this.tx,Je=this.ty,it=1/(D*xe-K*me),Dt=xe*it,jt=-K*it,hn=-me*it,_n=D*it;return new Kt(Dt,jt,hn,_n,-Dt*De-hn*Je,-jt*De-_n*Je)},Kt.prototype.applyToPoint=function(D){var K=D.x*this.sx+D.y*this.shx+this.tx,me=D.x*this.shy+D.y*this.sy+this.ty;return new xo(K,me)},Kt.prototype.applyToRectangle=function(D){var K=this.applyToPoint(D),me=this.applyToPoint(new xo(D.x+D.w,D.y+D.h));return new _c(K.x,K.y,me.x-K.x,me.y-K.y)},Kt.prototype.clone=function(){var D=this.sx,K=this.shy,me=this.shx,xe=this.sy,De=this.tx,Je=this.ty;return new Kt(D,K,me,xe,De,Je)},g.Matrix=Kt;var wc=g.matrixMult=function(D,K){return K.multiply(D)},Bl=new Kt(1,0,0,1,0,0);g.unitMatrix=g.identityMatrix=Bl;var za=function(D,K){if(!Is[D]){var me=(K instanceof Qp?"Sh":"P")+(Object.keys(en).length+1).toString(10);K.id=me,Is[D]=me,en[me]=K,Qn.publish("addPattern",K)}};g.ShadingPattern=Qp,g.TilingPattern=S0,g.addShadingPattern=function(D,K){return R("addShadingPattern()"),za(D,K),this},g.beginTilingPattern=function(D){R("beginTilingPattern()"),Rh(D.boundingBox[0],D.boundingBox[1],D.boundingBox[2]-D.boundingBox[0],D.boundingBox[3]-D.boundingBox[1],D.matrix)},g.endTilingPattern=function(D,K){R("endTilingPattern()"),K.stream=Ge[G].join(`
`),za(D,K),Qn.publish("endTilingPattern",K),bo.pop().restore()};var Ba,Xs=g.__private__.newObject=function(){var D=Tr();return ii(D,!0),D},Tr=g.__private__.newObjectDeferred=function(){return de++,ge[de]=function(){return Ce},de},ii=function(D,K){return K=typeof K=="boolean"&&K,ge[D]=Ce,K&&ce(D+" 0 obj"),D},Tu=g.__private__.newAdditionalObject=function(){var D={objId:Tr(),content:""};return Fe.push(D),D},ia=Tr(),Cs=Tr(),Zs=g.__private__.decodeColorString=function(D){var K=D.split(" ");if(K.length!==2||K[1]!=="g"&&K[1]!=="G")K.length!==5||K[4]!=="k"&&K[4]!=="K"||(K=[(1-K[0])*(1-K[3]),(1-K[1])*(1-K[3]),(1-K[2])*(1-K[3]),"r"]);else{var me=parseFloat(K[0]);K=[me,me,me,"r"]}for(var xe="#",De=0;De<3;De++)xe+=("0"+Math.floor(255*parseFloat(K[De])).toString(16)).slice(-2);return xe},Pi=g.__private__.encodeColorString=function(D){var K;typeof D=="string"&&(D={ch1:D});var me=D.ch1,xe=D.ch2,De=D.ch3,Je=D.ch4,it=D.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof me=="string"&&me.charAt(0)!=="#"){var Dt=new N7(me);if(Dt.ok)me=Dt.toHex();else if(!/^\d*\.?\d*$/.test(me))throw new Error('Invalid color "'+me+'" passed to jsPDF.encodeColorString.')}if(typeof me=="string"&&/^#[0-9A-Fa-f]{3}$/.test(me)&&(me="#"+me[1]+me[1]+me[2]+me[2]+me[3]+me[3]),typeof me=="string"&&/^#[0-9A-Fa-f]{6}$/.test(me)){var jt=parseInt(me.substr(1),16);me=jt>>16&255,xe=jt>>8&255,De=255&jt}if(xe===void 0||Je===void 0&&me===xe&&xe===De)K=typeof me=="string"?me+" "+it[0]:D.precision===2?I(me/255)+" "+it[0]:j(me/255)+" "+it[0];else if(Je===void 0||Ns(Je)==="object"){if(Je&&!isNaN(Je.a)&&Je.a===0)return["1.","1.","1.",it[1]].join(" ");K=typeof me=="string"?[me,xe,De,it[1]].join(" "):D.precision===2?[I(me/255),I(xe/255),I(De/255),it[1]].join(" "):[j(me/255),j(xe/255),j(De/255),it[1]].join(" ")}else K=typeof me=="string"?[me,xe,De,Je,it[2]].join(" "):D.precision===2?[I(me),I(xe),I(De),I(Je),it[2]].join(" "):[j(me),j(xe),j(De),j(Je),it[2]].join(" ");return K},ja=g.__private__.getFilters=function(){return o},vo=g.__private__.putStream=function(D){var K=(D=D||{}).data||"",me=D.filters||ja(),xe=D.alreadyAppliedFilters||[],De=D.addLength1||!1,Je=K.length,it=D.objectId,Dt=function(Wr){return Wr};if(d!==null&&it===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");d!==null&&(Dt=Vr.encryptor(it,0));var jt={};me===!0&&(me=["FlateEncode"]);var hn=D.additionalKeyValues||[],_n=(jt=qt.API.processDataByFilters!==void 0?qt.API.processDataByFilters(K,me):{data:K,reverseChain:[]}).reverseChain+(Array.isArray(xe)?xe.join(" "):xe.toString());if(jt.data.length!==0&&(hn.push({key:"Length",value:jt.data.length}),De===!0&&hn.push({key:"Length1",value:Je})),_n.length!=0)if(_n.split("/").length-1==1)hn.push({key:"Filter",value:_n});else{hn.push({key:"Filter",value:"["+_n+"]"});for(var es=0;es<hn.length;es+=1)if(hn[es].key==="DecodeParms"){for(var Js=[],vr=0;vr<jt.reverseChain.split("/").length-1;vr+=1)Js.push("null");Js.push(hn[es].value),hn[es].value="["+Js.join(" ")+"]"}}ce("<<");for(var Os=0;Os<hn.length;Os++)ce("/"+hn[Os].key+" "+hn[Os].value);ce(">>"),jt.data.length!==0&&(ce("stream"),ce(Dt(jt.data)),ce("endstream"))},Ah=g.__private__.putPage=function(D){var K=D.number,me=D.data,xe=D.objId,De=D.contentsObjId;ii(xe,!0),ce("<</Type /Page"),ce("/Parent "+D.rootDictionaryObjId+" 0 R"),ce("/Resources "+D.resourceDictionaryObjId+" 0 R"),ce("/MediaBox ["+parseFloat(M(D.mediaBox.bottomLeftX))+" "+parseFloat(M(D.mediaBox.bottomLeftY))+" "+M(D.mediaBox.topRightX)+" "+M(D.mediaBox.topRightY)+"]"),D.cropBox!==null&&ce("/CropBox ["+M(D.cropBox.bottomLeftX)+" "+M(D.cropBox.bottomLeftY)+" "+M(D.cropBox.topRightX)+" "+M(D.cropBox.topRightY)+"]"),D.bleedBox!==null&&ce("/BleedBox ["+M(D.bleedBox.bottomLeftX)+" "+M(D.bleedBox.bottomLeftY)+" "+M(D.bleedBox.topRightX)+" "+M(D.bleedBox.topRightY)+"]"),D.trimBox!==null&&ce("/TrimBox ["+M(D.trimBox.bottomLeftX)+" "+M(D.trimBox.bottomLeftY)+" "+M(D.trimBox.topRightX)+" "+M(D.trimBox.topRightY)+"]"),D.artBox!==null&&ce("/ArtBox ["+M(D.artBox.bottomLeftX)+" "+M(D.artBox.bottomLeftY)+" "+M(D.artBox.topRightX)+" "+M(D.artBox.topRightY)+"]"),typeof D.userUnit=="number"&&D.userUnit!==1&&ce("/UserUnit "+D.userUnit),Qn.publish("putPage",{objId:xe,pageContext:Gt[K],pageNumber:K,page:me}),ce("/Contents "+De+" 0 R"),ce(">>"),ce("endobj");var Je=me.join(`
`);return k===A&&(Je+=`
Q`),ii(De,!0),vo({data:Je,filters:ja(),objectId:De}),ce("endobj"),xe},el=g.__private__.putPages=function(){var D,K,me=[];for(D=1;D<=An;D++)Gt[D].objId=Tr(),Gt[D].contentsObjId=Tr();for(D=1;D<=An;D++)me.push(Ah({number:D,data:Ge[D],objId:Gt[D].objId,contentsObjId:Gt[D].contentsObjId,mediaBox:Gt[D].mediaBox,cropBox:Gt[D].cropBox,bleedBox:Gt[D].bleedBox,trimBox:Gt[D].trimBox,artBox:Gt[D].artBox,userUnit:Gt[D].userUnit,rootDictionaryObjId:ia,resourceDictionaryObjId:Cs}));ii(ia,!0),ce("<</Type /Pages");var xe="/Kids [";for(K=0;K<An;K++)xe+=me[K]+" 0 R ";ce(xe+"]"),ce("/Count "+An),ce(">>"),ce("endobj"),Qn.publish("postPutPages")},tl=function(D){Qn.publish("putFont",{font:D,out:ce,newObject:Xs,putStream:vo}),D.isAlreadyPutted!==!0&&(D.objectNumber=Xs(),ce("<<"),ce("/Type /Font"),ce("/BaseFont /"+p0(D.postScriptName)),ce("/Subtype /Type1"),typeof D.encoding=="string"&&ce("/Encoding /"+D.encoding),ce("/FirstChar 32"),ce("/LastChar 255"),ce(">>"),ce("endobj"))},Nu=function(D){D.objectNumber=Xs();var K=[];K.push({key:"Type",value:"/XObject"}),K.push({key:"Subtype",value:"/Form"}),K.push({key:"BBox",value:"["+[M(D.x),M(D.y),M(D.x+D.width),M(D.y+D.height)].join(" ")+"]"}),K.push({key:"Matrix",value:"["+D.matrix.toString()+"]"});var me=D.pages[1].join(`
`);vo({data:me,additionalKeyValues:K,objectId:D.objectNumber}),ce("endobj")},nl=function(D,K){K||(K=21);var me=Xs(),xe=(function(it,Dt){var jt,hn=[],_n=1/(Dt-1);for(jt=0;jt<1;jt+=_n)hn.push(jt);if(hn.push(1),it[0].offset!=0){var es={offset:0,color:it[0].color};it.unshift(es)}if(it[it.length-1].offset!=1){var Js={offset:1,color:it[it.length-1].color};it.push(Js)}for(var vr="",Os=0,Wr=0;Wr<hn.length;Wr++){for(jt=hn[Wr];jt>it[Os+1].offset;)Os++;var Ar=it[Os].offset,xi=(jt-Ar)/(it[Os+1].offset-Ar),Ic=it[Os].color,ll=it[Os+1].color;vr+=oe(Math.round((1-xi)*Ic[0]+xi*ll[0]).toString(16))+oe(Math.round((1-xi)*Ic[1]+xi*ll[1]).toString(16))+oe(Math.round((1-xi)*Ic[2]+xi*ll[2]).toString(16))}return vr.trim()})(D.colors,K),De=[];De.push({key:"FunctionType",value:"0"}),De.push({key:"Domain",value:"[0.0 1.0]"}),De.push({key:"Size",value:"["+K+"]"}),De.push({key:"BitsPerSample",value:"8"}),De.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),De.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),vo({data:xe,additionalKeyValues:De,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:me}),ce("endobj"),D.objectNumber=Xs(),ce("<< /ShadingType "+D.type),ce("/ColorSpace /DeviceRGB");var Je="/Coords ["+M(parseFloat(D.coords[0]))+" "+M(parseFloat(D.coords[1]))+" ";D.type===2?Je+=M(parseFloat(D.coords[2]))+" "+M(parseFloat(D.coords[3])):Je+=M(parseFloat(D.coords[2]))+" "+M(parseFloat(D.coords[3]))+" "+M(parseFloat(D.coords[4]))+" "+M(parseFloat(D.coords[5])),ce(Je+="]"),D.matrix&&ce("/Matrix ["+D.matrix.toString()+"]"),ce("/Function "+me+" 0 R"),ce("/Extend [true true]"),ce(">>"),ce("endobj")},sl=function(D,K){var me=Tr(),xe=Xs();K.push({resourcesOid:me,objectOid:xe}),D.objectNumber=xe;var De=[];De.push({key:"Type",value:"/Pattern"}),De.push({key:"PatternType",value:"1"}),De.push({key:"PaintType",value:"1"}),De.push({key:"TilingType",value:"1"}),De.push({key:"BBox",value:"["+D.boundingBox.map(M).join(" ")+"]"}),De.push({key:"XStep",value:M(D.xStep)}),De.push({key:"YStep",value:M(D.yStep)}),De.push({key:"Resources",value:me+" 0 R"}),D.matrix&&De.push({key:"Matrix",value:"["+D.matrix.toString()+"]"}),vo({data:D.stream,additionalKeyValues:De,objectId:D.objectNumber}),ce("endobj")},Eh=function(D){for(var K in D.objectNumber=Xs(),ce("<<"),D)switch(K){case"opacity":ce("/ca "+I(D[K]));break;case"stroke-opacity":ce("/CA "+I(D[K]))}ce(">>"),ce("endobj")},jl=function(D){ii(D.resourcesOid,!0),ce("<<"),ce("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var K in ce("/Font <<"),Qt)Qt.hasOwnProperty(K)&&(p===!1||p===!0&&m.hasOwnProperty(K))&&ce("/"+K+" "+Qt[K].objectNumber+" 0 R");ce(">>")})(),(function(){if(Object.keys(en).length>0){for(var K in ce("/Shading <<"),en)en.hasOwnProperty(K)&&en[K]instanceof Qp&&en[K].objectNumber>=0&&ce("/"+K+" "+en[K].objectNumber+" 0 R");Qn.publish("putShadingPatternDict"),ce(">>")}})(),(function(K){if(Object.keys(en).length>0){for(var me in ce("/Pattern <<"),en)en.hasOwnProperty(me)&&en[me]instanceof g.TilingPattern&&en[me].objectNumber>=0&&en[me].objectNumber<K&&ce("/"+me+" "+en[me].objectNumber+" 0 R");Qn.publish("putTilingPatternDict"),ce(">>")}})(D.objectOid),(function(){if(Object.keys(on).length>0){var K;for(K in ce("/ExtGState <<"),on)on.hasOwnProperty(K)&&on[K].objectNumber>=0&&ce("/"+K+" "+on[K].objectNumber+" 0 R");Qn.publish("putGStateDict"),ce(">>")}})(),(function(){for(var K in ce("/XObject <<"),Mi)Mi.hasOwnProperty(K)&&Mi[K].objectNumber>=0&&ce("/"+K+" "+Mi[K].objectNumber+" 0 R");Qn.publish("putXobjectDict"),ce(">>")})(),ce(">>"),ce("endobj")},br=function(D){un[D.fontName]=un[D.fontName]||{},un[D.fontName][D.fontStyle]=D.id},dp=function(D,K,me,xe,De){var Je={id:"F"+(Object.keys(Qt).length+1).toString(10),postScriptName:D,fontName:K,fontStyle:me,encoding:xe,isStandardFont:De||!1,metadata:{}};return Qn.publish("addFont",{font:Je,instance:this}),Qt[Je.id]=Je,br(Je),Je.id},Ua=g.__private__.pdfEscape=g.pdfEscape=function(D,K){return(function(me,xe){var De,Je,it,Dt,jt,hn,_n,es,Js;if(it=(xe=xe||{}).sourceEncoding||"Unicode",jt=xe.outputEncoding,(xe.autoencode||jt)&&Qt[Et].metadata&&Qt[Et].metadata[it]&&Qt[Et].metadata[it].encoding&&(Dt=Qt[Et].metadata[it].encoding,!jt&&Qt[Et].encoding&&(jt=Qt[Et].encoding),!jt&&Dt.codePages&&(jt=Dt.codePages[0]),typeof jt=="string"&&(jt=Dt[jt]),jt)){for(_n=!1,hn=[],De=0,Je=me.length;De<Je;De++)(es=jt[me.charCodeAt(De)])?hn.push(String.fromCharCode(es)):hn.push(me[De]),hn[De].charCodeAt(0)>>8&&(_n=!0);me=hn.join("")}for(De=me.length;_n===void 0&&De!==0;)me.charCodeAt(De-1)>>8&&(_n=!0),De--;if(!_n)return me;for(hn=xe.noBOM?[]:[254,255],De=0,Je=me.length;De<Je;De++){if((Js=(es=me.charCodeAt(De))>>8)>>8)throw new Error("Character at position "+De+" of string '"+me+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");hn.push(Js),hn.push(es-(Js<<8))}return String.fromCharCode.apply(void 0,hn)})(D,K).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rl=g.__private__.beginPage=function(D){Ge[++An]=[],Gt[An]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(D[0]),topRightY:Number(D[1])}},pp(An),pt(Ge[G])},xc=function(D,K){var me,xe,De;switch(t=K||t,typeof D=="string"&&(me=S(D.toLowerCase()),Array.isArray(me)&&(xe=me[0],De=me[1])),Array.isArray(D)&&(xe=D[0]*fn,De=D[1]*fn),isNaN(xe)&&(xe=r[0],De=r[1]),(xe>14400||De>14400)&&(Vs.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),xe=Math.min(14400,xe),De=Math.min(14400,De)),r=[xe,De],t.substr(0,1)){case"l":De>xe&&(r=[De,xe]);break;case"p":xe>De&&(r=[De,xe])}rl(r),rn(Oh),ce(Ha),jd!==0&&ce(jd+" J"),ai!==0&&ce(ai+" j"),Qn.publish("addPage",{pageNumber:An})},fp=function(D){D>0&&D<=An&&(Ge.splice(D,1),Gt.splice(D,1),An--,G>An&&(G=An),this.setPage(G))},pp=function(D){D>0&&D<=An&&(G=D)},mp=g.__private__.getNumberOfPages=g.getNumberOfPages=function(){return Ge.length-1},gg=function(D,K,me){var xe,De=void 0;return me=me||{},D=D!==void 0?D:Qt[Et].fontName,K=K!==void 0?K:Qt[Et].fontStyle,xe=D.toLowerCase(),un[xe]!==void 0&&un[xe][K]!==void 0?De=un[xe][K]:un[D]!==void 0&&un[D][K]!==void 0?De=un[D][K]:me.disableWarning===!1&&Vs.warn("Unable to look up font label for font '"+D+"', '"+K+"'. Refer to getFontList() for available fonts."),De||me.noFallback||(De=un.times[K])==null&&(De=un.times.normal),De},Va=g.__private__.putInfo=function(){var D=Xs(),K=function(xe){return xe};for(var me in d!==null&&(K=Vr.encryptor(D,0)),ce("<<"),ce("/Producer ("+Ua(K("jsPDF "+qt.version))+")"),cn)cn.hasOwnProperty(me)&&cn[me]&&ce("/"+me.substr(0,1).toUpperCase()+me.substr(1)+" ("+Ua(K(cn[me]))+")");ce("/CreationDate ("+Ua(K(re))+")"),ce(">>"),ce("endobj")},Sc=g.__private__.putCatalog=function(D){var K=(D=D||{}).rootDictionaryObjId||ia;switch(Xs(),ce("<<"),ce("/Type /Catalog"),ce("/Pages "+K+" 0 R"),xt||(xt="fullwidth"),xt){case"fullwidth":ce("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ce("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ce("/OpenAction [3 0 R /Fit]");break;case"original":ce("/OpenAction [3 0 R /XYZ null null 1]");break;default:var me=""+xt;me.substr(me.length-1)==="%"&&(xt=parseInt(xt)/100),typeof xt=="number"&&ce("/OpenAction [3 0 R /XYZ null null "+I(xt)+"]")}switch(mn||(mn="continuous"),mn){case"continuous":ce("/PageLayout /OneColumn");break;case"single":ce("/PageLayout /SinglePage");break;case"two":case"twoleft":ce("/PageLayout /TwoColumnLeft");break;case"tworight":ce("/PageLayout /TwoColumnRight")}Lt&&ce("/PageMode /"+Lt),Qn.publish("putCatalog"),ce(">>"),ce("endobj")},il=g.__private__.putTrailer=function(){ce("trailer"),ce("<<"),ce("/Size "+(de+1)),ce("/Root "+de+" 0 R"),ce("/Info "+(de-1)+" 0 R"),d!==null&&ce("/Encrypt "+Vr.oid+" 0 R"),ce("/ID [ <"+X+"> <"+X+"> ]"),ce(">>")},cs=g.__private__.putHeader=function(){ce("%PDF-"+b),ce("%")},gp=g.__private__.putXRef=function(){var D="0000000000";ce("xref"),ce("0 "+(de+1)),ce("0000000000 65535 f ");for(var K=1;K<=de;K++)typeof ge[K]=="function"?ce((D+ge[K]()).slice(-10)+" 00000 n "):ge[K]!==void 0?ce((D+ge[K]).slice(-10)+" 00000 n "):ce("0000000000 00000 n ")},Ul=g.__private__.buildDocument=function(){var D;de=0,Ce=0,Ae=[],ge=[],Fe=[],ia=Tr(),Cs=Tr(),pt(Ae),Qn.publish("buildDocument"),cs(),el(),(function(){Qn.publish("putAdditionalObjects");for(var me=0;me<Fe.length;me++){var xe=Fe[me];ii(xe.objId,!0),ce(xe.content),ce("endobj")}Qn.publish("postPutAdditionalObjects")})(),D=[],(function(){for(var me in Qt)Qt.hasOwnProperty(me)&&(p===!1||p===!0&&m.hasOwnProperty(me))&&tl(Qt[me])})(),(function(){var me;for(me in on)on.hasOwnProperty(me)&&Eh(on[me])})(),(function(){for(var me in Mi)Mi.hasOwnProperty(me)&&Nu(Mi[me])})(),(function(me){var xe;for(xe in en)en.hasOwnProperty(xe)&&(en[xe]instanceof Qp?nl(en[xe]):en[xe]instanceof S0&&sl(en[xe],me))})(D),Qn.publish("putResources"),D.forEach(jl),jl({resourcesOid:Cs,objectOid:Number.MAX_SAFE_INTEGER}),Qn.publish("postPutResources"),d!==null&&(Vr.oid=Xs(),ce("<<"),ce("/Filter /Standard"),ce("/V "+Vr.v),ce("/R "+Vr.r),ce("/U <"+Vr.toHexString(Vr.U)+">"),ce("/O <"+Vr.toHexString(Vr.O)+">"),ce("/P "+Vr.P),ce(">>"),ce("endobj")),Va(),Sc();var K=Ce;return gp(),il(),ce("startxref"),ce(""+K),ce("%%EOF"),pt(Ge[G]),Ae.join(`
`)},Au=g.__private__.getBlob=function(D){return new Blob([At(D)],{type:"application/pdf"})},yp=g.output=g.__private__.output=(Ba=function(D,K){switch(typeof(K=K||{})=="string"?K={filename:K}:K.filename=K.filename||"generated.pdf",D){case void 0:return Ul();case"save":g.save(K.filename);break;case"arraybuffer":return At(Ul());case"blob":return Au(Ul());case"bloburi":case"bloburl":if(wn.URL!==void 0&&typeof wn.URL.createObjectURL=="function")return wn.URL&&wn.URL.createObjectURL(Au(Ul()))||void 0;Vs.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var me="",xe=Ul();try{me=E4(xe)}catch{me=E4(unescape(encodeURIComponent(xe)))}return"data:application/pdf;filename="+K.filename+";base64,"+me;case"pdfobjectnewwindow":if(Object.prototype.toString.call(wn)==="[object Window]"){var De="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Je=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';K.pdfObjectUrl&&(De=K.pdfObjectUrl,Je="");var it='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+De+'"'+Je+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(K)+");<\/script></body></html>",Dt=wn.open();return Dt!==null&&Dt.document.write(it),Dt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(wn)==="[object Window]"){var jt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(K.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+K.filename+'" width="500px" height="400px" /></body></html>',hn=wn.open();if(hn!==null){hn.document.write(jt);var _n=this;hn.document.documentElement.querySelector("#pdfViewer").onload=function(){hn.document.title=K.filename,hn.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(_n.output("bloburl"))}}return hn}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(wn)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var es='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",K)+'"></iframe></body></html>',Js=wn.open();if(Js!==null&&(Js.document.write(es),Js.document.title=K.filename),Js||typeof safari>"u")return Js;break;case"datauri":case"dataurl":return wn.document.location.href=this.output("datauristring",K);default:return null}},Ba.foo=function(){try{return Ba.apply(this,arguments)}catch(me){var D=me.stack||"";~D.indexOf(" at ")&&(D=D.split(" at ")[1]);var K="Error in function "+D.split(`
`)[0].split("<")[0]+": "+me.message;if(!wn.console)throw new Error(K);wn.console.error(K,me),wn.alert&&alert(K)}},Ba.foo.bar=Ba,Ba.foo),aa=function(D){return Array.isArray(Qo)===!0&&Qo.indexOf(D)>-1};switch(s){case"pt":fn=1;break;case"mm":fn=72/25.4;break;case"cm":fn=72/2.54;break;case"in":fn=72;break;case"px":fn=aa("px_scaling")==1?.75:96/72;break;case"pc":case"em":fn=12;break;case"ex":fn=6;break;default:if(typeof s!="number")throw new Error("Invalid unit: "+s);fn=s}var Vr=null;Y(),Q();var Nr=g.__private__.getPageInfo=g.getPageInfo=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Gt[D].objId,pageNumber:D,pageContext:Gt[D]}},zd=g.__private__.getPageInfoByObjId=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var K in Gt)if(Gt[K].objId===D)break;return Nr(K)},yg=g.__private__.getCurrentPageInfo=g.getCurrentPageInfo=function(){return{objId:Gt[G].objId,pageNumber:G,pageContext:Gt[G]}};g.addPage=function(){return xc.apply(this,arguments),this},g.setPage=function(){return pp.apply(this,arguments),pt.call(this,Ge[G]),this},g.insertPage=function(D){return this.addPage(),this.movePage(G,D),this},g.movePage=function(D,K){var me,xe;if(D>K){me=Ge[D],xe=Gt[D];for(var De=D;De>K;De--)Ge[De]=Ge[De-1],Gt[De]=Gt[De-1];Ge[K]=me,Gt[K]=xe,this.setPage(K)}else if(D<K){me=Ge[D],xe=Gt[D];for(var Je=D;Je<K;Je++)Ge[Je]=Ge[Je+1],Gt[Je]=Gt[Je+1];Ge[K]=me,Gt[K]=xe,this.setPage(K)}return this},g.deletePage=function(){return fp.apply(this,arguments),this},g.__private__.text=g.text=function(D,K,me,xe,De){var Je,it,Dt,jt,hn,_n,es,Js,vr,Os=(xe=xe||{}).scope||this;if(typeof D=="number"&&typeof K=="number"&&(typeof me=="string"||Array.isArray(me))){var Wr=me;me=K,K=D,D=Wr}if(arguments[3]instanceof Kt==0?(Dt=arguments[4],jt=arguments[5],Ns(es=arguments[3])==="object"&&es!==null||(typeof Dt=="string"&&(jt=Dt,Dt=null),typeof es=="string"&&(jt=es,es=null),typeof es=="number"&&(Dt=es,es=null),xe={flags:es,angle:Dt,align:jt})):(R("The transform parameter of text() with a Matrix value"),vr=De),isNaN(K)||isNaN(me)||D==null)throw new Error("Invalid arguments passed to jsPDF.text");if(D.length===0)return Os;var Ar,xi="",Ic=typeof xe.lineHeightFactor=="number"?xe.lineHeightFactor:Cc,ll=Os.internal.scaleFactor;function Oc(us){return us=us.split("	").join(Array(xe.TabLen||9).join(" ")),Ua(us,es)}function Tp(us){for(var ts,Ds=us.concat(),xr=[],Jl=Ds.length;Jl--;)typeof(ts=Ds.shift())=="string"?xr.push(ts):Array.isArray(us)&&(ts.length===1||ts[1]===void 0&&ts[2]===void 0)?xr.push(ts[0]):xr.push([ts[0],ts[1],ts[2]]);return xr}function Vd(us,ts){var Ds;if(typeof us=="string")Ds=ts(us)[0];else if(Array.isArray(us)){for(var xr,Jl,dl=us.concat(),Ph=[],Ep=dl.length;Ep--;)typeof(xr=dl.shift())=="string"?Ph.push(ts(xr)[0]):Array.isArray(xr)&&typeof xr[0]=="string"&&(Jl=ts(xr[0],xr[1],xr[2]),Ph.push([Jl[0],Jl[1],Jl[2]]));Ds=Ph}return Ds}var Hl=!1,cl=!0;if(typeof D=="string")Hl=!0;else if(Array.isArray(D)){var Fh=D.concat();it=[];for(var Dc,oi=Fh.length;oi--;)(typeof(Dc=Fh.shift())!="string"||Array.isArray(Dc)&&typeof Dc[0]!="string")&&(cl=!1);Hl=cl}if(Hl===!1)throw new Error('Type of text must be string or Array. "'+D+'" is not recognized.');typeof D=="string"&&(D=D.match(/[\r?\n]/)?D.split(/\r\n|\r|\n/g):[D]);var Iu=nt/Os.internal.scaleFactor,Ou=Iu*(Ic-1);switch(xe.baseline){case"bottom":me-=Ou;break;case"top":me+=Iu-Ou;break;case"hanging":me+=Iu-2*Ou;break;case"middle":me+=Iu/2-Ou}if((_n=xe.maxWidth||0)>0&&(typeof D=="string"?D=Os.splitTextToSize(D,_n):Object.prototype.toString.call(D)==="[object Array]"&&(D=D.reduce(function(us,ts){return us.concat(Os.splitTextToSize(ts,_n))},[]))),Je={text:D,x:K,y:me,options:xe,mutex:{pdfEscape:Ua,activeFontKey:Et,fonts:Qt,activeFontSize:nt}},Qn.publish("preProcessText",Je),D=Je.text,Dt=(xe=Je.options).angle,vr instanceof Kt==0&&Dt&&typeof Dt=="number"){Dt*=Math.PI/180,xe.rotationDirection===0&&(Dt=-Dt),k===A&&(Dt=-Dt);var Wd=Math.cos(Dt),Gl=Math.sin(Dt);vr=new Kt(Wd,Gl,-Gl,Wd,0,0)}else Dt&&Dt instanceof Kt&&(vr=Dt);k!==A||vr||(vr=Bl),(hn=xe.charSpace||wo)!==void 0&&(xi+=M(H(hn))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Js=xe.horizontalScale)!==void 0&&(xi+=M(100*Js)+` Tz
`),xe.lang;var la=-1,$c=xe.renderingMode!==void 0?xe.renderingMode:xe.stroke,Hd=Os.internal.getCurrentPageInfo().pageContext;switch($c){case 0:case!1:case"fill":la=0;break;case 1:case!0:case"stroke":la=1;break;case 2:case"fillThenStroke":la=2;break;case 3:case"invisible":la=3;break;case 4:case"fillAndAddForClipping":la=4;break;case 5:case"strokeAndAddPathForClipping":la=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":la=6;break;case 7:case"addToPathForClipping":la=7}var Np=Hd.usedRenderingMode!==void 0?Hd.usedRenderingMode:-1;la!==-1?xi+=la+` Tr
`:Np!==-1&&(xi+=`0 Tr
`),la!==-1&&(Hd.usedRenderingMode=la),jt=xe.align||"left";var Ga,ul=nt*Ic,Rc=Os.internal.pageSize.getWidth(),Ap=Qt[Et];hn=xe.charSpace||wo,_n=xe.maxWidth||0,es=Object.assign({autoencode:!0,noBOM:!0},xe.flags);var hl=[],Du=function(us){return Os.getStringUnitWidth(us,{font:Ap,charSpace:hn,fontSize:nt,doKerning:!1})*nt/ll};if(Object.prototype.toString.call(D)==="[object Array]"){var ba;it=Tp(D),jt!=="left"&&(Ga=it.map(Du));var ca,ql=0;if(jt==="right"){K-=Ga[0],D=[],oi=it.length;for(var Xl=0;Xl<oi;Xl++)Xl===0?(ca=Wa(K),ba=wi(me)):(ca=H(ql-Ga[Xl]),ba=-ul),D.push([it[Xl],ca,ba]),ql=Ga[Xl]}else if(jt==="center"){K-=Ga[0]/2,D=[],oi=it.length;for(var Lc=0;Lc<oi;Lc++)Lc===0?(ca=Wa(K),ba=wi(me)):(ca=H((ql-Ga[Lc])/2),ba=-ul),D.push([it[Lc],ca,ba]),ql=Ga[Lc]}else if(jt==="left"){D=[],oi=it.length;for(var Gd=0;Gd<oi;Gd++)D.push(it[Gd])}else if(jt==="justify"&&Ap.encoding==="Identity-H"){D=[],oi=it.length,_n=_n!==0?_n:Rc;for(var qd=0,wr=0;wr<oi;wr++)if(ba=wr===0?wi(me):-ul,ca=wr===0?Wa(K):qd,wr<oi-1){var Tg=H((_n-Ga[wr])/(it[wr].split(" ").length-1)),Yl=it[wr].split(" ");D.push([Yl[0]+" ",ca,ba]),qd=0;for(var Kl=1;Kl<Yl.length;Kl++){var Si=(Du(Yl[Kl-1]+" "+Yl[Kl])-Du(Yl[Kl]))*ll+Tg;Kl==Yl.length-1?D.push([Yl[Kl],Si,0]):D.push([Yl[Kl]+" ",Si,0]),qd-=Si}}else D.push([it[wr],ca,ba]);D.push(["",qd,0])}else{if(jt!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(D=[],oi=it.length,_n=_n!==0?_n:Rc,wr=0;wr<oi;wr++){ba=wr===0?wi(me):-ul,ca=wr===0?Wa(K):0;var Fc=it[wr].split(" ").length-1,Xd=Fc>0?(_n-Ga[wr])/Fc:0;wr<oi-1?hl.push(M(H(Xd))):hl.push(0),D.push([it[wr],ca,ba])}}}(typeof xe.R2L=="boolean"?xe.R2L:Tt)===!0&&(D=Vd(D,function(us,ts,Ds){return[us.split("").reverse().join(""),ts,Ds]})),Je={text:D,x:K,y:me,options:xe,mutex:{pdfEscape:Ua,activeFontKey:Et,fonts:Qt,activeFontSize:nt}},Qn.publish("postProcessText",Je),D=Je.text,Ar=Je.mutex.isHex||!1;var Yd=Qt[Et].encoding;Yd!=="WinAnsiEncoding"&&Yd!=="StandardEncoding"||(D=Vd(D,function(us,ts,Ds){return[Oc(us),ts,Ds]})),it=Tp(D),D=[];for(var Mc,Pc,Zl,Mh=Array.isArray(it[0])?1:0,qa="",zc=function(us,ts,Ds){var xr="";return Ds instanceof Kt?(Ds=typeof xe.angle=="number"?wc(Ds,new Kt(1,0,0,1,us,ts)):wc(new Kt(1,0,0,1,us,ts),Ds),k===A&&(Ds=wc(new Kt(1,0,0,-1,0,0),Ds)),xr=Ds.join(" ")+` Tm
`):xr=M(us)+" "+M(ts)+` Td
`,xr},zi=0;zi<it.length;zi++){switch(qa="",Mh){case 1:Zl=(Ar?"<":"(")+it[zi][0]+(Ar?">":")"),Mc=parseFloat(it[zi][1]),Pc=parseFloat(it[zi][2]);break;case 0:Zl=(Ar?"<":"(")+it[zi]+(Ar?">":")"),Mc=Wa(K),Pc=wi(me)}hl!==void 0&&hl[zi]!==void 0&&(qa=hl[zi]+` Tw
`),zi===0?D.push(qa+zc(Mc,Pc,vr)+Zl):Mh===0?D.push(qa+Zl):Mh===1&&D.push(qa+zc(Mc,Pc,vr)+Zl)}D=Mh===0?D.join(` Tj
T* `):D.join(` Tj
`),D+=` Tj
`;var So=`BT
/`;return So+=Et+" "+nt+` Tf
`,So+=M(nt*Ic)+` TL
`,So+=Vl+`
`,So+=xi,So+=D,ce(So+="ET"),m[Et]=!0,Os};var bp=g.__private__.clip=g.clip=function(D){return ce(D==="evenodd"?"W*":"W"),this};g.clipEvenOdd=function(){return bp("evenodd")},g.__private__.discardPath=g.discardPath=function(){return ce("n"),this};var oa=g.__private__.isValidStyle=function(D){var K=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(D)!==-1&&(K=!0),K};g.__private__.setDefaultPathOperation=g.setDefaultPathOperation=function(D){return oa(D)&&(u=D),this};var vp=g.__private__.getStyle=g.getStyle=function(D){var K=u;switch(D){case"D":case"S":K="S";break;case"F":K="f";break;case"FD":case"DF":K="B";break;case"f":case"f*":case"B":case"B*":K=D}return K},wp=g.close=function(){return ce("h"),this};g.stroke=function(){return ce("S"),this},g.fill=function(D){return al("f",D),this},g.fillEvenOdd=function(D){return al("f*",D),this},g.fillStroke=function(D){return al("B",D),this},g.fillStrokeEvenOdd=function(D){return al("B*",D),this};var al=function(D,K){Ns(K)==="object"?vg(K,D):ce(D)},Ih=function(D){D===null||k===A&&D===void 0||(D=vp(D),ce(D))};function bg(D,K,me,xe,De){var Je=new S0(K||this.boundingBox,me||this.xStep,xe||this.yStep,this.gState,De||this.matrix);Je.stream=this.stream;var it=D+"$$"+this.cloneIndex+++"$$";return za(it,Je),Je}var vg=function(D,K){var me=Is[D.key],xe=en[me];if(xe instanceof Qp)ce("q"),ce(xp(K)),xe.gState&&g.setGState(xe.gState),ce(D.matrix.toString()+" cm"),ce("/"+me+" sh"),ce("Q");else if(xe instanceof S0){var De=new Kt(1,0,0,-1,0,Ec());D.matrix&&(De=De.multiply(D.matrix||Bl),me=bg.call(xe,D.key,D.boundingBox,D.xStep,D.yStep,De).id),ce("q"),ce("/Pattern cs"),ce("/"+me+" scn"),xe.gState&&g.setGState(xe.gState),ce(K),ce("Q")}},xp=function(D){switch(D){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Sp=g.moveTo=function(D,K){return ce(M(H(D))+" "+M(q(K))+" m"),this},wg=g.lineTo=function(D,K){return ce(M(H(D))+" "+M(q(K))+" l"),this},ya=g.curveTo=function(D,K,me,xe,De,Je){return ce([M(H(D)),M(q(K)),M(H(me)),M(q(xe)),M(H(De)),M(q(Je)),"c"].join(" ")),this};g.__private__.line=g.line=function(D,K,me,xe,De){if(isNaN(D)||isNaN(K)||isNaN(me)||isNaN(xe)||!oa(De))throw new Error("Invalid arguments passed to jsPDF.line");return k===C?this.lines([[me-D,xe-K]],D,K,[1,1],De||"S"):this.lines([[me-D,xe-K]],D,K,[1,1]).stroke()},g.__private__.lines=g.lines=function(D,K,me,xe,De,Je){var it,Dt,jt,hn,_n,es,Js,vr,Os,Wr,Ar,xi;if(typeof D=="number"&&(xi=me,me=K,K=D,D=xi),xe=xe||[1,1],Je=Je||!1,isNaN(K)||isNaN(me)||!Array.isArray(D)||!Array.isArray(xe)||!oa(De)||typeof Je!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Sp(K,me),it=xe[0],Dt=xe[1],hn=D.length,Wr=K,Ar=me,jt=0;jt<hn;jt++)(_n=D[jt]).length===2?(Wr=_n[0]*it+Wr,Ar=_n[1]*Dt+Ar,wg(Wr,Ar)):(es=_n[0]*it+Wr,Js=_n[1]*Dt+Ar,vr=_n[2]*it+Wr,Os=_n[3]*Dt+Ar,Wr=_n[4]*it+Wr,Ar=_n[5]*Dt+Ar,ya(es,Js,vr,Os,Wr,Ar));return Je&&wp(),Ih(De),this},g.path=function(D){for(var K=0;K<D.length;K++){var me=D[K],xe=me.c;switch(me.op){case"m":Sp(xe[0],xe[1]);break;case"l":wg(xe[0],xe[1]);break;case"c":ya.apply(this,xe);break;case"h":wp()}}return this},g.__private__.rect=g.rect=function(D,K,me,xe,De){if(isNaN(D)||isNaN(K)||isNaN(me)||isNaN(xe)||!oa(De))throw new Error("Invalid arguments passed to jsPDF.rect");return k===C&&(xe=-xe),ce([M(H(D)),M(q(K)),M(H(me)),M(H(xe)),"re"].join(" ")),Ih(De),this},g.__private__.triangle=g.triangle=function(D,K,me,xe,De,Je,it){if(isNaN(D)||isNaN(K)||isNaN(me)||isNaN(xe)||isNaN(De)||isNaN(Je)||!oa(it))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[me-D,xe-K],[De-me,Je-xe],[D-De,K-Je]],D,K,[1,1],it,!0),this},g.__private__.roundedRect=g.roundedRect=function(D,K,me,xe,De,Je,it){if(isNaN(D)||isNaN(K)||isNaN(me)||isNaN(xe)||isNaN(De)||isNaN(Je)||!oa(it))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Dt=4/3*(Math.SQRT2-1);return De=Math.min(De,.5*me),Je=Math.min(Je,.5*xe),this.lines([[me-2*De,0],[De*Dt,0,De,Je-Je*Dt,De,Je],[0,xe-2*Je],[0,Je*Dt,-De*Dt,Je,-De,Je],[2*De-me,0],[-De*Dt,0,-De,-Je*Dt,-De,-Je],[0,2*Je-xe],[0,-Je*Dt,De*Dt,-Je,De,-Je]],D+De,K,[1,1],it,!0),this},g.__private__.ellipse=g.ellipse=function(D,K,me,xe,De){if(isNaN(D)||isNaN(K)||isNaN(me)||isNaN(xe)||!oa(De))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Je=4/3*(Math.SQRT2-1)*me,it=4/3*(Math.SQRT2-1)*xe;return Sp(D+me,K),ya(D+me,K-it,D+Je,K-xe,D,K-xe),ya(D-Je,K-xe,D-me,K-it,D-me,K),ya(D-me,K+it,D-Je,K+xe,D,K+xe),ya(D+Je,K+xe,D+me,K+it,D+me,K),Ih(De),this},g.__private__.circle=g.circle=function(D,K,me,xe){if(isNaN(D)||isNaN(K)||isNaN(me)||!oa(xe))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(D,K,me,me,xe)},g.setFont=function(D,K,me){return me&&(K=$(K,me)),Et=gg(D,K,{disableWarning:!1}),this};var ol=g.__private__.getFont=g.getFont=function(){return Qt[gg.apply(g,arguments)]};g.__private__.getFontList=g.getFontList=function(){var D,K,me={};for(D in un)if(un.hasOwnProperty(D))for(K in me[D]=[],un[D])un[D].hasOwnProperty(K)&&me[D].push(K);return me},g.addFont=function(D,K,me,xe,De){var Je=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Je.indexOf(arguments[3])!==-1?De=arguments[3]:arguments[3]&&Je.indexOf(arguments[3])==-1&&(me=$(me,xe)),dp.call(this,D,K,me,De=De||"Identity-H")};var Cc,Oh=n.lineWidth||.200025,Eu=g.__private__.getLineWidth=g.getLineWidth=function(){return Oh},rn=g.__private__.setLineWidth=g.setLineWidth=function(D){return Oh=D,ce(M(H(D))+" w"),this};g.__private__.setLineDash=qt.API.setLineDash=qt.API.setLineDashPattern=function(D,K){if(D=D||[],K=K||0,isNaN(K)||!Array.isArray(D))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return D=D.map(function(me){return M(H(me))}).join(" "),K=M(H(K)),ce("["+D+"] "+K+" d"),this};var xg=g.__private__.getLineHeight=g.getLineHeight=function(){return nt*Cc};g.__private__.getLineHeight=g.getLineHeight=function(){return nt*Cc};var Cp=g.__private__.setLineHeightFactor=g.setLineHeightFactor=function(D){return typeof(D=D||1.15)=="number"&&(Cc=D),this},Sg=g.__private__.getLineHeightFactor=g.getLineHeightFactor=function(){return Cc};Cp(n.lineHeight);var Wa=g.__private__.getHorizontalCoordinate=function(D){return H(D)},wi=g.__private__.getVerticalCoordinate=function(D){return k===A?D:Gt[G].mediaBox.topRightY-Gt[G].mediaBox.bottomLeftY-H(D)},_p=g.__private__.getHorizontalCoordinateString=g.getHorizontalCoordinateString=function(D){return M(Wa(D))},Dh=g.__private__.getVerticalCoordinateString=g.getVerticalCoordinateString=function(D){return M(wi(D))},Ha=n.strokeColor||"0 G";g.__private__.getStrokeColor=g.getDrawColor=function(){return Zs(Ha)},g.__private__.setStrokeColor=g.setDrawColor=function(D,K,me,xe){return Ha=Pi({ch1:D,ch2:K,ch3:me,ch4:xe,pdfColorType:"draw",precision:2}),ce(Ha),this};var $h=n.fillColor||"0 g";g.__private__.getFillColor=g.getFillColor=function(){return Zs($h)},g.__private__.setFillColor=g.setFillColor=function(D,K,me,xe){return $h=Pi({ch1:D,ch2:K,ch3:me,ch4:xe,pdfColorType:"fill",precision:2}),ce($h),this};var Vl=n.textColor||"0 g",Cg=g.__private__.getTextColor=g.getTextColor=function(){return Zs(Vl)};g.__private__.setTextColor=g.setTextColor=function(D,K,me,xe){return Vl=Pi({ch1:D,ch2:K,ch3:me,ch4:xe,pdfColorType:"text",precision:3}),this};var wo=n.charSpace,Bd=g.__private__.getCharSpace=g.getCharSpace=function(){return parseFloat(wo||0)};g.__private__.setCharSpace=g.setCharSpace=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return wo=D,this};var jd=0;g.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},g.__private__.setLineCap=g.setLineCap=function(D){var K=g.CapJoinStyles[D];if(K===void 0)throw new Error("Line cap style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return jd=K,ce(K+" J"),this};var ai=0;g.__private__.setLineJoin=g.setLineJoin=function(D){var K=g.CapJoinStyles[D];if(K===void 0)throw new Error("Line join style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ai=K,ce(K+" j"),this},g.__private__.setLineMiterLimit=g.__private__.setMiterLimit=g.setLineMiterLimit=g.setMiterLimit=function(D){if(D=D||0,isNaN(D))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ce(M(H(D))+" M"),this},g.GState=FC,g.setGState=function(D){(D=typeof D=="string"?on[gn[D]]:Wl(null,D)).equals(Ss)||(ce("/"+D.id+" gs"),Ss=D)};var Wl=function(D,K){if(!D||!gn[D]){var me=!1;for(var xe in on)if(on.hasOwnProperty(xe)&&on[xe].equals(K)){me=!0;break}if(me)K=on[xe];else{var De="GS"+(Object.keys(on).length+1).toString(10);on[De]=K,K.id=De}return D&&(gn[D]=K.id),Qn.publish("addGState",K),K}};g.addGState=function(D,K){return Wl(D,K),this},g.saveGraphicsState=function(){return ce("q"),Un.push({key:Et,size:nt,color:Vl}),this},g.restoreGraphicsState=function(){ce("Q");var D=Un.pop();return Et=D.key,nt=D.size,Vl=D.color,Ss=null,this},g.setCurrentTransformationMatrix=function(D){return ce(D.toString()+" cm"),this},g.comment=function(D){return ce("#"+D),this};var xo=function(D,K){var me=D||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return me},set:function(Je){isNaN(Je)||(me=parseFloat(Je))}});var xe=K||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return xe},set:function(Je){isNaN(Je)||(xe=parseFloat(Je))}});var De="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return De},set:function(Je){De=Je.toString()}}),this},_c=function(D,K,me,xe){xo.call(this,D,K),this.type="rect";var De=me||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return De},set:function(it){isNaN(it)||(De=parseFloat(it))}});var Je=xe||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Je},set:function(it){isNaN(it)||(Je=parseFloat(it))}}),this},Ud=function(){this.page=An,this.currentPage=G,this.pages=Ge.slice(0),this.pagesContext=Gt.slice(0),this.x=zt,this.y=Ks,this.matrix=Cn,this.width=Tc(G),this.height=kp(G),this.outputDestination=ut,this.id="",this.objectNumber=-1};Ud.prototype.restore=function(){An=this.page,G=this.currentPage,Gt=this.pagesContext,Ge=this.pages,zt=this.x,Ks=this.y,Cn=this.matrix,Lh(G,this.width),Nc(G,this.height),ut=this.outputDestination};var Rh=function(D,K,me,xe,De){bo.push(new Ud),An=G=0,Ge=[],zt=D,Ks=K,Cn=De,rl([me,xe])};for(var kc in g.beginFormObject=function(D,K,me,xe,De){return Rh(D,K,me,xe,De),this},g.endFormObject=function(D){return(function(K){if(zl[K])bo.pop().restore();else{var me=new Ud,xe="Xo"+(Object.keys(Mi).length+1).toString(10);me.id=xe,zl[K]=xe,Mi[xe]=me,Qn.publish("addFormObject",me),bo.pop().restore()}})(D),this},g.doFormObject=function(D,K){var me=Mi[zl[D]];return ce("q"),ce(K.toString()+" cm"),ce("/"+me.id+" Do"),ce("Q"),this},g.getFormObject=function(D){var K=Mi[zl[D]];return{x:K.x,y:K.y,width:K.width,height:K.height,matrix:K.matrix}},g.save=function(D,K){return D=D||"generated.pdf",(K=K||{}).returnPromise=K.returnPromise||!1,K.returnPromise===!1?(qp(Au(Ul()),D),typeof qp.unload=="function"&&wn.setTimeout&&setTimeout(qp.unload,911),this):new Promise(function(me,xe){try{var De=qp(Au(Ul()),D);typeof qp.unload=="function"&&wn.setTimeout&&setTimeout(qp.unload,911),me(De)}catch(Je){xe(Je.message)}})},qt.API)qt.API.hasOwnProperty(kc)&&(kc==="events"&&qt.API.events.length?(function(D,K){var me,xe,De;for(De=K.length-1;De!==-1;De--)me=K[De][0],xe=K[De][1],D.subscribe.apply(D,[me].concat(typeof xe=="function"?[xe]:xe))})(Qn,qt.API.events):g[kc]=qt.API[kc]);function Tc(D){return Gt[D].mediaBox.topRightX-Gt[D].mediaBox.bottomLeftX}function Lh(D,K){Gt[D].mediaBox.topRightX=K+Gt[D].mediaBox.bottomLeftX}function kp(D){return Gt[D].mediaBox.topRightY-Gt[D].mediaBox.bottomLeftY}function Nc(D,K){Gt[D].mediaBox.topRightY=K+Gt[D].mediaBox.bottomLeftY}var Ac=g.getPageWidth=function(D){return Tc(D=D||G)/fn},_g=g.setPageWidth=function(D,K){Lh(D,K*fn)},Ec=g.getPageHeight=function(D){return kp(D=D||G)/fn},kg=g.setPageHeight=function(D,K){Nc(D,K*fn)};return g.internal={pdfEscape:Ua,getStyle:vp,getFont:ol,getFontSize:vt,getCharSpace:Bd,getTextColor:Cg,getLineHeight:xg,getLineHeightFactor:Sg,getLineWidth:Eu,write:rt,getHorizontalCoordinate:Wa,getVerticalCoordinate:wi,getCoordinateString:_p,getVerticalCoordinateString:Dh,collections:{},newObject:Xs,newAdditionalObject:Tu,newObjectDeferred:Tr,newObjectDeferredBegin:ii,getFilters:ja,putStream:vo,events:Qn,scaleFactor:fn,pageSize:{getWidth:function(){return Ac(G)},setWidth:function(D){_g(G,D)},getHeight:function(){return Ec(G)},setHeight:function(D){kg(G,D)}},encryptionOptions:d,encryption:Vr,getEncryptor:function(D){return d!==null?Vr.encryptor(D,0):function(K){return K}},output:yp,getNumberOfPages:mp,get pages(){return Ge},out:ce,f2:I,f3:j,getPageInfo:Nr,getPageInfoByObjId:zd,getCurrentPageInfo:yg,getPDFVersion:v,Point:xo,Rectangle:_c,Matrix:Kt,hasHotfix:aa},Object.defineProperty(g.internal.pageSize,"width",{get:function(){return Ac(G)},set:function(D){_g(G,D)},enumerable:!0,configurable:!0}),Object.defineProperty(g.internal.pageSize,"height",{get:function(){return Ec(G)},set:function(D){kg(G,D)},enumerable:!0,configurable:!0}),(function(D){for(var K=0,me=yt.length;K<me;K++){var xe=dp.call(this,D[K][0],D[K][1],D[K][2],yt[K][3],!0);p===!1&&(m[xe]=!0);var De=D[K][0].split("-");br({id:xe,fontName:De[0],fontStyle:De[1]||""})}Qn.publish("addFonts",{fonts:Qt,dictionary:un})}).call(g,yt),Et="F1",xc(r,t),Qn.publish("initialized"),g}f0.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},f0.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},f0.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},f0.prototype.processOwnerPassword=function(n,e){return OE(IE(e).substr(0,5),n)},f0.prototype.encryptor=function(n,e){var t=IE(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(s){return OE(t,s)}},FC.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||Ns(n)!==Ns(this))return!1;var s=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;s++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&s--;return s===0},qt.API={events:[]},qt.version="3.0.4";var Lr=qt.API,LO=1,Jm=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},c0=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Nn=function(n){return n.toFixed(2)},Cf=function(n){return n.toFixed(5)};Lr.__acroform__={};var Zo=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},$4=function(n){return n*LO},qu=function(n){var e=new O7,t=Mt.internal.getHeight(n)||0,s=Mt.internal.getWidth(n)||0;return e.BBox=[0,0,Number(Nn(s)),Number(Nn(t))],e},hte=Lr.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},dte=Lr.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},fte=Lr.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},Kr=Lr.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return fte(n,e-1)},Zr=Lr.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return hte(n,e-1)},Jr=Lr.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return dte(n,e-1)},pte=Lr.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,s=e.internal.getVerticalCoordinate,r=n[0],a=n[1],o=n[2],l=n[3],c={};return c.lowerLeft_X=t(r)||0,c.lowerLeft_Y=s(a+l)||0,c.upperRight_X=t(r+o)||0,c.upperRight_Y=s(a)||0,[Number(Nn(c.lowerLeft_X)),Number(Nn(c.lowerLeft_Y)),Number(Nn(c.upperRight_X)),Number(Nn(c.upperRight_Y))]},mte=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,s=DE(n,t),r=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+r+" "+Nn(s.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC");var a=qu(n);return a.scope=n.scope,a.stream=e.join(`
`),a}},DE=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,s={text:"",fontSize:""},r=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");r=n.multiline?r.map(function(I){return I.split(`
`)}):r.map(function(I){return[I]});var a=t,o=Mt.internal.getHeight(n)||0;o=o<0?-o:o;var l=Mt.internal.getWidth(n)||0;l=l<0?-l:l;var c=function(I,j,H){if(I+1<r.length){var q=j+" "+r[I+1][0];return vS(q,n,H).width<=l-4}return!1};a++;e:for(;a>0;){e="",a--;var u,d,p=vS("3",n,a).height,m=n.multiline?o-a:(o-p)/2,g=m+=2,b=0,v=0,x=0;if(a<=0){e=`(...) Tj
`,e+="% Width of Text: "+vS(e,n,a=12).width+", FieldWidth:"+l+`
`;break}for(var S="",C=0,A=0;A<r.length;A++)if(r.hasOwnProperty(A)){var k=!1;if(r[A].length!==1&&x!==r[A].length-1){if((p+2)*(C+2)+2>o)continue e;S+=r[A][x],k=!0,v=A,A--}else{S=(S+=r[A][x]+" ").substr(S.length-1)==" "?S.substr(0,S.length-1):S;var O=parseInt(A),F=c(O,S,a),$=A>=r.length-1;if(F&&!$){S+=" ",x=0;continue}if(F||$){if($)v=O;else if(n.multiline&&(p+2)*(C+2)+2>o)continue e}else{if(!n.multiline||(p+2)*(C+2)+2>o)continue e;v=O}}for(var M="",R=b;R<=v;R++){var z=r[R];if(n.multiline){if(R===v){M+=z[x]+" ",x=(x+1)%z.length;continue}if(R===b){M+=z[z.length-1]+" ";continue}}M+=z[0]+" "}switch(M=M.substr(M.length-1)==" "?M.substr(0,M.length-1):M,d=vS(M,n,a).width,n.textAlign){case"right":u=l-d-2;break;case"center":u=(l-d)/2;break;default:u=2}e+=Nn(u)+" "+Nn(g)+` Td
`,e+="("+Jm(M)+`) Tj
`,e+=-Nn(u)+` 0 Td
`,g=-(a+2),d=0,b=k?v:v+1,C++,S=""}break}return s.text=e,s.fontSize=a,s},vS=function(n,e,t){var s=e.scope.internal.getFont(e.fontName,e.fontStyle),r=e.scope.getStringUnitWidth(n,{font:s,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:s,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:r}},gte={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},yte=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(s){return s.type===t.type&&s.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},bte=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(wu.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(gte)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");LO=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new D7,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var s=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in s)if(s.hasOwnProperty(r)){var a=s[r];a.objId=void 0,a.hasAnnotation&&yte(a,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(s,r){var a=!s;for(var o in s||(r.internal.newObjectDeferredBegin(r.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),r.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),s=s||r.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(s.hasOwnProperty(o)){var l=s[o],c=[],u=l.Rect;if(l.Rect&&(l.Rect=pte(l.Rect,r)),r.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Mt.createDefaultAppearanceStream(l),Ns(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=u,l.hasAppearanceStream&&!l.appearanceStreamContent){var d=mte(l);c.push({key:"AP",value:"<</N "+d+">>"}),r.internal.acroformPlugin.xForms.push(d)}if(l.appearanceStreamContent){var p="";for(var m in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(m)){var g=l.appearanceStreamContent[m];if(p+="/"+m+" ",p+="<<",Object.keys(g).length>=1||Array.isArray(g)){for(var o in g)if(g.hasOwnProperty(o)){var b=g[o];typeof b=="function"&&(b=b.call(r,l)),p+="/"+o+" "+b+" ",r.internal.acroformPlugin.xForms.indexOf(b)>=0||r.internal.acroformPlugin.xForms.push(b)}}else typeof(b=g)=="function"&&(b=b.call(r,l)),p+="/"+o+" "+b,r.internal.acroformPlugin.xForms.indexOf(b)>=0||r.internal.acroformPlugin.xForms.push(b);p+=">>"}c.push({key:"AP",value:`<<
`+p+">>"})}r.internal.putStream({additionalKeyValues:c,objectId:l.objId}),r.internal.out("endobj")}a&&(function(v,x){for(var S in v)if(v.hasOwnProperty(S)){var C=S,A=v[S];x.internal.newObjectDeferredBegin(A.objId,!0),Ns(A)==="object"&&typeof A.putStream=="function"&&A.putStream(),delete v[C]}})(r.internal.acroformPlugin.xForms,r)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},I7=Lr.__acroform__.arrayToPdfArray=function(n,e,t){var s=function(o){return o};if(Array.isArray(n)){for(var r="[",a=0;a<n.length;a++)switch(a!==0&&(r+=" "),Ns(n[a])){case"boolean":case"number":case"object":r+=n[a].toString();break;case"string":n[a].substr(0,1)!=="/"?(e!==void 0&&t&&(s=t.internal.getEncryptor(e)),r+="("+Jm(s(n[a].toString()))+")"):r+=n[a].toString()}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},A5=function(n,e,t){var s=function(r){return r};return e!==void 0&&t&&(s=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+Jm(s(n))+")"},rh=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};rh.prototype.toString=function(){return this.objId+" 0 R"},rh.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},rh.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(a){return a!="content"&&a!="appearanceStreamContent"&&a!="scope"&&a!="objId"&&a.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var s=e[t],r=this[s];r&&(Array.isArray(r)?n.push({key:s,value:I7(r,this.objId,this.scope)}):r instanceof rh?(r.scope=this.scope,n.push({key:s,value:r.objId+" 0 R"})):typeof r!="function"&&n.push({key:s,value:r}))}return n};var O7=function(){rh.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};Zo(O7,rh);var D7=function(){rh.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(s){return s};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Jm(t(n))+")"}},set:function(t){n=t}})};Zo(D7,rh);var wu=function n(){rh.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(S){if(isNaN(S))throw new Error('Invalid value "'+S+'" for attribute F supplied.');e=S}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Kr(e,3)},set:function(S){S?this.F=Zr(e,3):this.F=Jr(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(S){if(isNaN(S))throw new Error('Invalid value "'+S+'" for attribute Ff supplied.');t=S}});var s=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(s.length!==0)return s},set:function(S){s=S!==void 0?S:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[0])?0:s[0]},set:function(S){s[0]=S}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[1])?0:s[1]},set:function(S){s[1]=S}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[2])?0:s[2]},set:function(S){s[2]=S}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[3])?0:s[3]},set:function(S){s[3]=S}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(S){switch(S){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=S;break;default:throw new Error('Invalid value "'+S+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof MC)return;a="FieldObject"+n.FieldNum++}var S=function(C){return C};return this.scope&&(S=this.scope.internal.getEncryptor(this.objId)),"("+Jm(S(a))+")"},set:function(S){a=S.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(S){a=S}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(S){o=S}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(S){l=S}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(S){c=S}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return u===void 0?50/LO:u},set:function(S){u=S}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(S){d=S}});var p="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!p||this instanceof MC||this instanceof hm))return A5(p,this.objId,this.scope)},set:function(S){S=S.toString(),p=S}});var m=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof Hi==0?A5(m,this.objId,this.scope):m},set:function(S){S=S.toString(),m=this instanceof Hi==0?S.substr(0,1)==="("?c0(S.substr(1,S.length-2)):c0(S):S}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Hi==1?c0(m.substr(1,m.length-1)):m},set:function(S){S=S.toString(),m=this instanceof Hi==1?"/"+S:S}});var g=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(g)return g},set:function(S){this.V=S}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(g)return this instanceof Hi==0?A5(g,this.objId,this.scope):g},set:function(S){S=S.toString(),g=this instanceof Hi==0?S.substr(0,1)==="("?c0(S.substr(1,S.length-2)):c0(S):S}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Hi==1?c0(g.substr(1,g.length-1)):g},set:function(S){S=S.toString(),g=this instanceof Hi==1?"/"+S:S}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var b,v=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return v},set:function(S){S=!!S,v=S}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(b)return b},set:function(S){b=S}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,1)},set:function(S){S?this.Ff=Zr(this.Ff,1):this.Ff=Jr(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,2)},set:function(S){S?this.Ff=Zr(this.Ff,2):this.Ff=Jr(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,3)},set:function(S){S?this.Ff=Zr(this.Ff,3):this.Ff=Jr(this.Ff,3)}});var x=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(x!==null)return x},set:function(S){if([0,1,2].indexOf(S)===-1)throw new Error('Invalid value "'+S+'" for attribute Q supplied.');x=S}}),Object.defineProperty(this,"textAlign",{get:function(){var S;switch(x){case 0:default:S="left";break;case 1:S="center";break;case 2:S="right"}return S},configurable:!0,enumerable:!0,set:function(S){switch(S){case"right":case 2:x=2;break;case"center":case 1:x=1;break;default:x=0}}})};Zo(wu,rh);var N0=function(){wu.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return I7(e,this.objId,this.scope)},set:function(t){var s,r;r=[],typeof(s=t)=="string"&&(r=(function(a,o,l){l||(l=1);for(var c,u=[];c=o.exec(a);)u.push(c[l]);return u})(s,/\((.*?)\)/g)),e=r}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,s){for(s=s||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),s!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,18)},set:function(t){t?this.Ff=Zr(this.Ff,18):this.Ff=Jr(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Zr(this.Ff,19):this.Ff=Jr(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,20)},set:function(t){t?(this.Ff=Zr(this.Ff,20),e.sort()):this.Ff=Jr(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,22)},set:function(t){t?this.Ff=Zr(this.Ff,22):this.Ff=Jr(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,23)},set:function(t){t?this.Ff=Zr(this.Ff,23):this.Ff=Jr(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,27)},set:function(t){t?this.Ff=Zr(this.Ff,27):this.Ff=Jr(this.Ff,27)}}),this.hasAppearanceStream=!1};Zo(N0,wu);var A0=function(){N0.call(this),this.fontName="helvetica",this.combo=!1};Zo(A0,N0);var E0=function(){A0.call(this),this.combo=!0};Zo(E0,A0);var XS=function(){E0.call(this),this.edit=!0};Zo(XS,E0);var Hi=function(){wu.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,15)},set:function(t){t?this.Ff=Zr(this.Ff,15):this.Ff=Jr(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,16)},set:function(t){t?this.Ff=Zr(this.Ff,16):this.Ff=Jr(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,17)},set:function(t){t?this.Ff=Zr(this.Ff,17):this.Ff=Jr(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,26)},set:function(t){t?this.Ff=Zr(this.Ff,26):this.Ff=Jr(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(a){return a};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var s,r=[];for(s in r.push("<<"),e)r.push("/"+s+" ("+Jm(t(e[s]))+")");return r.push(">>"),r.join(`
`)}},set:function(t){Ns(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}})};Zo(Hi,wu);var YS=function(){Hi.call(this),this.pushButton=!0};Zo(YS,Hi);var I0=function(){Hi.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};Zo(I0,Hi);var MC=function(){var n,e;wu.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(r){n=r}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(r){e=r}});var t,s={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(l){return l};this.scope&&(r=this.scope.internal.getEncryptor(this.objId));var a,o=[];for(a in o.push("<<"),s)o.push("/"+a+" ("+Jm(r(s[a]))+")");return o.push(">>"),o.join(`
`)},set:function(r){Ns(r)==="object"&&(s=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return s.CA||""},set:function(r){typeof r=="string"&&(s.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(r){t="/"+r}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Mt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Zo(MC,wu),I0.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},I0.prototype.createOption=function(n){var e=new MC;return e.Parent=this,e.optionName=n,this.Kids.push(e),vte.call(this.scope,e),e};var KS=function(){Hi.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Mt.CheckBox.createAppearanceStream()};Zo(KS,Hi);var hm=function(){wu.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,13)},set:function(e){e?this.Ff=Zr(this.Ff,13):this.Ff=Jr(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,21)},set:function(e){e?this.Ff=Zr(this.Ff,21):this.Ff=Jr(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,23)},set:function(e){e?this.Ff=Zr(this.Ff,23):this.Ff=Jr(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,24)},set:function(e){e?this.Ff=Zr(this.Ff,24):this.Ff=Jr(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,25)},set:function(e){e?this.Ff=Zr(this.Ff,25):this.Ff=Jr(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,26)},set:function(e){e?this.Ff=Zr(this.Ff,26):this.Ff=Jr(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Zo(hm,wu);var ZS=function(){hm.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Kr(this.Ff,14)},set:function(n){n?this.Ff=Zr(this.Ff,14):this.Ff=Jr(this.Ff,14)}}),this.password=!0};Zo(ZS,hm);var Mt={CheckBox:{createAppearanceStream:function(){return{N:{On:Mt.CheckBox.YesNormal},D:{On:Mt.CheckBox.YesPushDown,Off:Mt.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=qu(n);e.scope=n.scope;var t=[],s=n.scope.internal.getFont(n.fontName,n.fontStyle).id,r=n.scope.__private__.encodeColorString(n.color),a=DE(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+Nn(Mt.internal.getWidth(n))+" "+Nn(Mt.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+s+" "+Nn(a.fontSize)+" Tf "+r),t.push("BT"),t.push(a.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=qu(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,s=n.scope.__private__.encodeColorString(n.color),r=[],a=Mt.internal.getHeight(n),o=Mt.internal.getWidth(n),l=DE(n,n.caption);return r.push("1 g"),r.push("0 0 "+Nn(o)+" "+Nn(a)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+Nn(o-1)+" "+Nn(a-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+t+" "+Nn(l.fontSize)+" Tf "+s),r.push(l.text),r.push("ET"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(n){var e=qu(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Nn(Mt.internal.getWidth(n))+" "+Nn(Mt.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:Mt.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=Mt.RadioButton.Circle.YesNormal,e.D[n]=Mt.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=qu(n);e.scope=n.scope;var t=[],s=Mt.internal.getWidth(n)<=Mt.internal.getHeight(n)?Mt.internal.getWidth(n)/4:Mt.internal.getHeight(n)/4;s=Number((.9*s).toFixed(5));var r=Mt.internal.Bezier_C,a=Number((s*r).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Cf(Mt.internal.getWidth(n)/2)+" "+Cf(Mt.internal.getHeight(n)/2)+" cm"),t.push(s+" 0 m"),t.push(s+" "+a+" "+a+" "+s+" 0 "+s+" c"),t.push("-"+a+" "+s+" -"+s+" "+a+" -"+s+" 0 c"),t.push("-"+s+" -"+a+" -"+a+" -"+s+" 0 -"+s+" c"),t.push(a+" -"+s+" "+s+" -"+a+" "+s+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=qu(n);e.scope=n.scope;var t=[],s=Mt.internal.getWidth(n)<=Mt.internal.getHeight(n)?Mt.internal.getWidth(n)/4:Mt.internal.getHeight(n)/4;s=Number((.9*s).toFixed(5));var r=Number((2*s).toFixed(5)),a=Number((r*Mt.internal.Bezier_C).toFixed(5)),o=Number((s*Mt.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Cf(Mt.internal.getWidth(n)/2)+" "+Cf(Mt.internal.getHeight(n)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),t.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),t.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),t.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Cf(Mt.internal.getWidth(n)/2)+" "+Cf(Mt.internal.getHeight(n)/2)+" cm"),t.push(s+" 0 m"),t.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),t.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),t.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),t.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=qu(n);e.scope=n.scope;var t=[],s=Mt.internal.getWidth(n)<=Mt.internal.getHeight(n)?Mt.internal.getWidth(n)/4:Mt.internal.getHeight(n)/4;s=Number((.9*s).toFixed(5));var r=Number((2*s).toFixed(5)),a=Number((r*Mt.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Cf(Mt.internal.getWidth(n)/2)+" "+Cf(Mt.internal.getHeight(n)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),t.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),t.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),t.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:Mt.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=Mt.RadioButton.Cross.YesNormal,e.D[n]=Mt.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=qu(n);e.scope=n.scope;var t=[],s=Mt.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+Nn(Mt.internal.getWidth(n)-2)+" "+Nn(Mt.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(Nn(s.x1.x)+" "+Nn(s.x1.y)+" m"),t.push(Nn(s.x2.x)+" "+Nn(s.x2.y)+" l"),t.push(Nn(s.x4.x)+" "+Nn(s.x4.y)+" m"),t.push(Nn(s.x3.x)+" "+Nn(s.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=qu(n);e.scope=n.scope;var t=Mt.internal.calculateCross(n),s=[];return s.push("0.749023 g"),s.push("0 0 "+Nn(Mt.internal.getWidth(n))+" "+Nn(Mt.internal.getHeight(n))+" re"),s.push("f"),s.push("q"),s.push("1 1 "+Nn(Mt.internal.getWidth(n)-2)+" "+Nn(Mt.internal.getHeight(n)-2)+" re"),s.push("W"),s.push("n"),s.push(Nn(t.x1.x)+" "+Nn(t.x1.y)+" m"),s.push(Nn(t.x2.x)+" "+Nn(t.x2.y)+" l"),s.push(Nn(t.x4.x)+" "+Nn(t.x4.y)+" m"),s.push(Nn(t.x3.x)+" "+Nn(t.x3.y)+" l"),s.push("s"),s.push("Q"),e.stream=s.join(`
`),e},OffPushDown:function(n){var e=qu(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Nn(Mt.internal.getWidth(n))+" "+Nn(Mt.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};Mt.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=Mt.internal.getWidth(n),t=Mt.internal.getHeight(n),s=Math.min(e,t);return{x1:{x:(e-s)/2,y:(t-s)/2+s},x2:{x:(e-s)/2+s,y:(t-s)/2},x3:{x:(e-s)/2,y:(t-s)/2},x4:{x:(e-s)/2+s,y:(t-s)/2+s}}}},Mt.internal.getWidth=function(n){var e=0;return Ns(n)==="object"&&(e=$4(n.Rect[2])),e},Mt.internal.getHeight=function(n){var e=0;return Ns(n)==="object"&&(e=$4(n.Rect[3])),e};var vte=Lr.addField=function(n){if(bte(this,n),!(n instanceof wu))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};Lr.AcroFormChoiceField=N0,Lr.AcroFormListBox=A0,Lr.AcroFormComboBox=E0,Lr.AcroFormEditBox=XS,Lr.AcroFormButton=Hi,Lr.AcroFormPushButton=YS,Lr.AcroFormRadioButton=I0,Lr.AcroFormCheckBox=KS,Lr.AcroFormTextField=hm,Lr.AcroFormPasswordField=ZS,Lr.AcroFormAppearance=Mt,Lr.AcroForm={ChoiceField:N0,ListBox:A0,ComboBox:E0,EditBox:XS,Button:Hi,PushButton:YS,RadioButton:I0,CheckBox:KS,TextField:hm,PasswordField:ZS,Appearance:Mt},qt.AcroForm={ChoiceField:N0,ListBox:A0,ComboBox:E0,EditBox:XS,Button:Hi,PushButton:YS,RadioButton:I0,CheckBox:KS,TextField:hm,PasswordField:ZS,Appearance:Mt};qt.AcroForm;function $7(n){return n.reduce(function(e,t,s){return e[t]=s,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",s={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=n.__addimage__.getImageFileTypeByImageData=function(I,j){var H,q,re,X,ne,Q=t;if((j=j||t)==="RGBA"||I.data!==void 0&&I.data instanceof Uint8ClampedArray&&"height"in I&&"width"in I)return"RGBA";if(F(I))for(ne in s)for(re=s[ne],H=0;H<re.length;H+=1){for(X=!0,q=0;q<re[H].length;q+=1)if(re[H][q]!==void 0&&re[H][q]!==I[q]){X=!1;break}if(X===!0){Q=ne;break}}else for(ne in s)for(re=s[ne],H=0;H<re.length;H+=1){for(X=!0,q=0;q<re[H].length;q+=1)if(re[H][q]!==void 0&&re[H][q]!==I.charCodeAt(q)){X=!1;break}if(X===!0){Q=ne;break}}return Q===t&&j!==t&&(Q=j),Q},a=function I(j){for(var H=this.internal.write,q=this.internal.putStream,re=(0,this.internal.getFilters)();re.indexOf("FlateEncode")!==-1;)re.splice(re.indexOf("FlateEncode"),1);j.objectId=this.internal.newObject();var X=[];if(X.push({key:"Type",value:"/XObject"}),X.push({key:"Subtype",value:"/Image"}),X.push({key:"Width",value:j.width}),X.push({key:"Height",value:j.height}),j.colorSpace===S.INDEXED?X.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(j.palette.length/3-1)+" "+("sMask"in j&&j.sMask!==void 0?j.objectId+2:j.objectId+1)+" 0 R]"}):(X.push({key:"ColorSpace",value:"/"+j.colorSpace}),j.colorSpace===S.DEVICE_CMYK&&X.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),X.push({key:"BitsPerComponent",value:j.bitsPerComponent}),"decodeParameters"in j&&j.decodeParameters!==void 0&&X.push({key:"DecodeParms",value:"<<"+j.decodeParameters+">>"}),"transparency"in j&&Array.isArray(j.transparency)&&j.transparency.length>0){for(var ne="",Q=0,he=j.transparency.length;Q<he;Q++)ne+=j.transparency[Q]+" "+j.transparency[Q]+" ";X.push({key:"Mask",value:"["+ne+"]"})}j.sMask!==void 0&&X.push({key:"SMask",value:j.objectId+1+" 0 R"});var ye=j.filter!==void 0?["/"+j.filter]:void 0;if(q({data:j.data,additionalKeyValues:X,alreadyAppliedFilters:ye,objectId:j.objectId}),H("endobj"),"sMask"in j&&j.sMask!==void 0){var Y,B=(Y=j.sMaskBitsPerComponent)!==null&&Y!==void 0?Y:j.bitsPerComponent,G={width:j.width,height:j.height,colorSpace:"DeviceGray",bitsPerComponent:B,data:j.sMask};"filter"in j&&(G.decodeParameters="/Predictor ".concat(j.predictor," /Colors 1 /BitsPerComponent ").concat(B," /Columns ").concat(j.width),G.filter=j.filter),I.call(this,G)}if(j.colorSpace===S.INDEXED){var J=this.internal.newObject();q({data:M(new Uint8Array(j.palette)),objectId:J}),H("endobj")}},o=function(){var I=this.internal.collections[e+"images"];for(var j in I)a.call(this,I[j])},l=function(){var I,j=this.internal.collections[e+"images"],H=this.internal.write;for(var q in j)H("/I"+(I=j[q]).index,I.objectId,"0","R")},c=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},u=function(){var I=this.internal.collections[e+"images"];return c.call(this),I},d=function(){return Object.keys(this.internal.collections[e+"images"]).length},p=function(I){return typeof n["process"+I.toUpperCase()]=="function"},m=function(I){return Ns(I)==="object"&&I.nodeType===1},g=function(I,j){if(I.nodeName==="IMG"&&I.hasAttribute("src")){var H=""+I.getAttribute("src");if(H.indexOf("data:image/")===0)return qS(unescape(H).split("base64,").pop());var q=n.loadFile(H,!0);if(q!==void 0)return q}if(I.nodeName==="CANVAS"){if(I.width===0||I.height===0)throw new Error("Given canvas must have data. Canvas width: "+I.width+", height: "+I.height);var re;switch(j){case"PNG":re="image/png";break;case"WEBP":re="image/webp";break;default:re="image/jpeg"}return qS(I.toDataURL(re,1).split("base64,").pop())}},b=function(I){var j=this.internal.collections[e+"images"];if(j){for(var H in j)if(I===j[H].alias)return j[H]}},v=function(I,j,H){return I||j||(I=-96,j=-96),I<0&&(I=-1*H.width*72/I/this.internal.scaleFactor),j<0&&(j=-1*H.height*72/j/this.internal.scaleFactor),I===0&&(I=j*H.width/H.height),j===0&&(j=I*H.height/H.width),[I,j]},x=function(I,j,H,q,re,X){var ne=v.call(this,H,q,re),Q=this.internal.getCoordinateString,he=this.internal.getVerticalCoordinateString,ye=u.call(this);if(H=ne[0],q=ne[1],ye[re.index]=re,X){X*=Math.PI/180;var Y=Math.cos(X),B=Math.sin(X),G=function(oe){return oe.toFixed(4)},J=[G(Y),G(B),G(-1*B),G(Y),0,0,"cm"]}this.internal.write("q"),X?(this.internal.write([1,"0","0",1,Q(I),he(j+q),"cm"].join(" ")),this.internal.write(J.join(" ")),this.internal.write([Q(H),"0","0",Q(q),"0","0","cm"].join(" "))):this.internal.write([Q(H),"0","0",Q(q),Q(I),he(j+q),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+re.index+" Do"),this.internal.write("Q")},S=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var C=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},A=n.__addimage__.sHashCode=function(I){var j,H,q=0;if(typeof I=="string")for(H=I.length,j=0;j<H;j++)q=(q<<5)-q+I.charCodeAt(j),q|=0;else if(F(I))for(H=I.byteLength/2,j=0;j<H;j++)q=(q<<5)-q+I[j],q|=0;return q},k=n.__addimage__.validateStringAsBase64=function(I){(I=I||"").toString().trim();var j=!0;return I.length===0&&(j=!1),I.length%4!=0&&(j=!1),/^[A-Za-z0-9+/]+$/.test(I.substr(0,I.length-2))===!1&&(j=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(I.substr(-2))===!1&&(j=!1),j},O=n.__addimage__.extractImageFromDataUrl=function(I){if(I==null||!(I=I.trim()).startsWith("data:"))return null;var j=I.indexOf(",");return j<0?null:I.substring(0,j).trim().endsWith("base64")?I.substring(j+1):null};n.__addimage__.isArrayBuffer=function(I){return I instanceof ArrayBuffer};var F=n.__addimage__.isArrayBufferView=function(I){return I instanceof Int8Array||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int16Array||I instanceof Uint16Array||I instanceof Int32Array||I instanceof Uint32Array||I instanceof Float32Array||I instanceof Float64Array},$=n.__addimage__.binaryStringToUint8Array=function(I){for(var j=I.length,H=new Uint8Array(j),q=0;q<j;q++)H[q]=I.charCodeAt(q);return H},M=n.__addimage__.arrayBufferToBinaryString=function(I){for(var j="",H=F(I)?I:new Uint8Array(I),q=0;q<H.length;q+=8192)j+=String.fromCharCode.apply(null,H.subarray(q,q+8192));return j};n.addImage=function(){var I,j,H,q,re,X,ne,Q,he;if(typeof arguments[1]=="number"?(j=t,H=arguments[1],q=arguments[2],re=arguments[3],X=arguments[4],ne=arguments[5],Q=arguments[6],he=arguments[7]):(j=arguments[1],H=arguments[2],q=arguments[3],re=arguments[4],X=arguments[5],ne=arguments[6],Q=arguments[7],he=arguments[8]),Ns(I=arguments[0])==="object"&&!m(I)&&"imageData"in I){var ye=I;I=ye.imageData,j=ye.format||j||t,H=ye.x||H||0,q=ye.y||q||0,re=ye.w||ye.width||re,X=ye.h||ye.height||X,ne=ye.alias||ne,Q=ye.compression||Q,he=ye.rotation||ye.angle||he}var Y=this.internal.getFilters();if(Q===void 0&&Y.indexOf("FlateEncode")!==-1&&(Q="SLOW"),isNaN(H)||isNaN(q))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var B=R.call(this,I,j,ne,Q);return x.call(this,H,q,re,X,B,he),this};var R=function(I,j,H,q){var re,X,ne;if(typeof I=="string"&&r(I)===t){I=unescape(I);var Q=z(I,!1);(Q!==""||(Q=n.loadFile(I,!0))!==void 0)&&(I=Q)}if(m(I)&&(I=g(I,j)),j=r(I,j),!p(j))throw new Error("addImage does not support files of type '"+j+"', please ensure that a plugin for '"+j+"' support is added.");if(((ne=H)==null||ne.length===0)&&(H=(function(he){return typeof he=="string"||F(he)?A(he):F(he.data)?A(he.data):null})(I)),(re=b.call(this,H))||(I instanceof Uint8Array||j==="RGBA"||(X=I,I=$(I)),re=this["process"+j.toUpperCase()](I,d.call(this),H,(function(he){return he&&typeof he=="string"&&(he=he.toUpperCase()),he in n.image_compression?he:C.NONE})(q),X)),!re)throw new Error("An unknown error occurred whilst processing the image.");return re},z=n.__addimage__.convertBase64ToBinaryString=function(I,j){j=typeof j!="boolean"||j;var H,q="";if(typeof I=="string"){var re;H=(re=O(I))!==null&&re!==void 0?re:I;try{q=qS(H)}catch(X){if(j)throw k(H)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+X.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return q};n.getImageProperties=function(I){var j,H,q="";if(m(I)&&(I=g(I)),typeof I=="string"&&r(I)===t&&((q=z(I,!1))===""&&(q=n.loadFile(I)||""),I=q),H=r(I),!p(H))throw new Error("addImage does not support files of type '"+H+"', please ensure that a plugin for '"+H+"' support is added.");if(I instanceof Uint8Array||(I=$(I)),!(j=this["process"+H.toUpperCase()](I)))throw new Error("An unknown error occurred whilst processing the image");return j.fileType=H,j}})(qt.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};qt.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var s,r,a,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(t.objId),u=t.pageContext.annotations,d=!1,p=0;p<u.length&&!d;p++)switch((s=u[p]).type){case"link":(e(s.options.url)||e(s.options.pageNumber))&&(d=!0);break;case"reference":case"text":case"freetext":d=!0}if(d!=0){this.internal.write("/Annots [");for(var m=0;m<u.length;m++){s=u[m];var g=this.internal.pdfEscape,b=this.internal.getEncryptor(t.objId);switch(s.type){case"reference":this.internal.write(" "+s.object.objId+" 0 R ");break;case"text":var v=this.internal.newAdditionalObject(),x=this.internal.newAdditionalObject(),S=this.internal.getEncryptor(v.objId),C=s.title||"Note";a="<</Type /Annot /Subtype /Text "+(r="/Rect ["+o(s.bounds.x)+" "+l(s.bounds.y+s.bounds.h)+" "+o(s.bounds.x+s.bounds.w)+" "+l(s.bounds.y)+"] ")+"/Contents ("+g(S(s.contents))+")",a+=" /Popup "+x.objId+" 0 R",a+=" /P "+c.objId+" 0 R",a+=" /T ("+g(S(C))+") >>",v.content=a;var A=v.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+o(s.bounds.x+30)+" "+l(s.bounds.y+s.bounds.h)+" "+o(s.bounds.x+s.bounds.w+30)+" "+l(s.bounds.y)+"] ")+" /Parent "+A,s.open&&(a+=" /Open true"),a+=" >>",x.content=a,this.internal.write(v.objId,"0 R",x.objId,"0 R");break;case"freetext":r="/Rect ["+o(s.bounds.x)+" "+l(s.bounds.y)+" "+o(s.bounds.x+s.bounds.w)+" "+l(s.bounds.y+s.bounds.h)+"] ";var k=s.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+g(b(s.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+k+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(s.options.name){var O=this.annotations._nameMap[s.options.name];s.options.pageNumber=O.page,s.options.top=O.y}else s.options.top||(s.options.top=0);if(r="/Rect ["+s.finalBounds.x+" "+s.finalBounds.y+" "+s.finalBounds.w+" "+s.finalBounds.h+"] ",a="",s.options.url)a="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+g(b(s.options.url))+") >>";else if(s.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(s.options.pageNumber).objId+" 0 R",s.options.magFactor=s.options.magFactor||"XYZ",s.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+s.options.top+"]";break;case"FitV":s.options.left=s.options.left||0,a+=" /FitV "+s.options.left+"]";break;default:var F=l(s.options.top);s.options.left=s.options.left||0,s.options.zoom===void 0&&(s.options.zoom=0),a+=" /XYZ "+s.options.left+" "+F+" "+s.options.zoom+"]"}a!=""&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var s=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":s.pageContext.annotations.push(t)}},n.link=function(t,s,r,a,o){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(t),y:u(s),w:c(t+r),h:u(s+a)},options:o,type:"link"})},n.textWithLink=function(t,s,r,a){var o,l,c=this.getTextWidth(t),u=this.internal.getLineHeight()/this.internal.scaleFactor;if(a.maxWidth!==void 0){l=a.maxWidth;var d=this.splitTextToSize(t,l).length;o=Math.ceil(u*d)}else l=c,o=u;return this.text(t,s,r,a),r+=.2*u,a.align==="center"&&(s-=c/2),a.align==="right"&&(s-=c),this.link(s,r-u,l,o,a),c},n.getTextWidth=function(t){var s=this.internal.getFontSize();return this.getStringUnitWidth(t)*s/this.internal.scaleFactor}})(qt.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},s={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];n.__arabicParser__={};var a=n.__arabicParser__.isInArabicSubstitutionA=function(v){return e[v.charCodeAt(0)]!==void 0},o=n.__arabicParser__.isArabicLetter=function(v){return typeof v=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(v)},l=n.__arabicParser__.isArabicEndLetter=function(v){return o(v)&&a(v)&&e[v.charCodeAt(0)].length<=2},c=n.__arabicParser__.isArabicAlfLetter=function(v){return o(v)&&r.indexOf(v.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(v){return o(v)&&a(v)&&e[v.charCodeAt(0)].length>=1};var u=n.__arabicParser__.arabicLetterHasFinalForm=function(v){return o(v)&&a(v)&&e[v.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(v){return o(v)&&a(v)&&e[v.charCodeAt(0)].length>=3};var d=n.__arabicParser__.arabicLetterHasMedialForm=function(v){return o(v)&&a(v)&&e[v.charCodeAt(0)].length==4},p=n.__arabicParser__.resolveLigatures=function(v){var x=0,S=t,C="",A=0;for(x=0;x<v.length;x+=1)S[v.charCodeAt(x)]!==void 0?(A++,typeof(S=S[v.charCodeAt(x)])=="number"&&(C+=String.fromCharCode(S),S=t,A=0),x===v.length-1&&(S=t,C+=v.charAt(x-(A-1)),x-=A-1,A=0)):(S=t,C+=v.charAt(x-A),x-=A,A=0);return C};n.__arabicParser__.isArabicDiacritic=function(v){return v!==void 0&&s[v.charCodeAt(0)]!==void 0};var m=n.__arabicParser__.getCorrectForm=function(v,x,S){return o(v)?a(v)===!1?-1:!u(v)||!o(x)&&!o(S)||!o(S)&&l(x)||l(v)&&!o(x)||l(v)&&c(x)||l(v)&&l(x)?0:d(v)&&o(x)&&!l(x)&&o(S)&&u(S)?3:l(v)||!o(S)?1:2:-1},g=function(v){var x=0,S=0,C=0,A="",k="",O="",F=(v=v||"").split("\\s+"),$=[];for(x=0;x<F.length;x+=1){for($.push(""),S=0;S<F[x].length;S+=1)A=F[x][S],k=F[x][S-1],O=F[x][S+1],o(A)?(C=m(A,k,O),$[x]+=C!==-1?String.fromCharCode(e[A.charCodeAt(0)][C]):A):$[x]+=A;$[x]=p($[x])}return $.join(" ")},b=n.__arabicParser__.processArabic=n.processArabic=function(){var v,x=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,S=[];if(Array.isArray(x)){var C=0;for(S=[],C=0;C<x.length;C+=1)Array.isArray(x[C])?S.push([g(x[C][0]),x[C][1],x[C][2]]):S.push([g(x[C])]);v=S}else v=g(x);return typeof arguments[0]=="string"?v:(arguments[0].text=v,arguments[0])};n.events.push(["preProcessText",b])})(qt.API),qt.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(l){t=l}});var s=150;Object.defineProperty(this,"width",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=s+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var a=[];Object.defineProperty(this,"childNodes",{get:function(){return a},set:function(l){a=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,s){var r;if((t=t||"2d")!=="2d")return null;for(r in s)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=s[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(qt.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,s=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(v){c=v}});var u=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return u},set:function(v){u=v}});var d=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return d},set:function(v){d=v}});var p=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return p},set:function(v){p=v}});var m=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return m},set:function(v){m=v}});var g=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return g},set:function(v){g=v}});var b=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return b},set:function(v){b=v}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(c){return s.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},n.getTextDimensions=function(c,u){s.call(this);var d=(u=u||{}).fontSize||this.getFontSize(),p=u.font||this.getFont(),m=u.scaleFactor||this.internal.scaleFactor,g=0,b=0,v=0,x=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var S=u.maxWidth;S>0?typeof c=="string"?c=this.splitTextToSize(c,S):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(A,k){return A.concat(x.splitTextToSize(k,S))},[])):c=Array.isArray(c)?c:[c];for(var C=0;C<c.length;C++)g<(v=this.getStringUnitWidth(c[C],{font:p})*d)&&(g=v);return g!==0&&(b=c.length),{w:g/=m,h:Math.max((b*d*this.getLineHeightFactor()-d*(this.getLineHeightFactor()-1))/m,0)}},n.cellAddPage=function(){s.call(this),this.addPage();var c=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new a(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=n.cell=function(){var c;c=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),s.call(this);var u=this.internal.__cell__.lastCell,d=this.internal.__cell__.padding,p=this.internal.__cell__.margins||e,m=this.internal.__cell__.tableHeaderRow,g=this.internal.__cell__.printHeaders;return u.lineNumber!==void 0&&(u.lineNumber===c.lineNumber?(c.x=(u.x||0)+(u.width||0),c.y=u.y||0):u.y+u.height+c.height+p.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=p.top,g&&m&&(this.printHeaderRow(c.lineNumber,!0),c.y+=m[0].height)):c.y=u.y+u.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,t===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-d,c.y+d,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+d,{align:"center",baseline:"top",maxWidth:c.width-d-d}):this.text(c.text,c.x+d,c.y+d,{align:"left",baseline:"top",maxWidth:c.width-d-d})),this.internal.__cell__.lastCell=c,this};n.table=function(c,u,d,p,m){if(s.call(this),!d)throw new Error("No data for PDF table.");var g,b,v,x,S=[],C=[],A=[],k={},O={},F=[],$=[],M=(m=m||{}).autoSize||!1,R=m.printHeaders!==!1,z=m.css&&m.css["font-size"]!==void 0?16*m.css["font-size"]:m.fontSize||12,I=m.margins||Object.assign({width:this.getPageWidth()},e),j=typeof m.padding=="number"?m.padding:3,H=m.headerBackgroundColor||"#c8c8c8",q=m.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=R,this.internal.__cell__.margins=I,this.internal.__cell__.table_font_size=z,this.internal.__cell__.padding=j,this.internal.__cell__.headerBackgroundColor=H,this.internal.__cell__.headerTextColor=q,this.setFontSize(z),p==null)C=S=Object.keys(d[0]),A=S.map(function(){return"left"});else if(Array.isArray(p)&&Ns(p[0])==="object")for(S=p.map(function(ye){return ye.name}),C=p.map(function(ye){return ye.prompt||ye.name||""}),A=p.map(function(ye){return ye.align||"left"}),g=0;g<p.length;g+=1)O[p[g].name]=.7499990551181103*p[g].width;else Array.isArray(p)&&typeof p[0]=="string"&&(C=S=p,A=S.map(function(){return"left"}));if(M||Array.isArray(p)&&typeof p[0]=="string")for(g=0;g<S.length;g+=1){for(k[x=S[g]]=d.map(function(ye){return ye[x]}),this.setFont(void 0,"bold"),F.push(this.getTextDimensions(C[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),b=k[x],this.setFont(void 0,"normal"),v=0;v<b.length;v+=1)F.push(this.getTextDimensions(b[v],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);O[x]=Math.max.apply(null,F)+j+j,F=[]}if(R){var re={};for(g=0;g<S.length;g+=1)re[S[g]]={},re[S[g]].text=C[g],re[S[g]].align=A[g];var X=l.call(this,re,O);$=S.map(function(ye){return new a(c,u,O[ye],X,re[ye].text,void 0,re[ye].align)}),this.setTableHeaderRow($),this.printHeaderRow(1,!1)}var ne=p.reduce(function(ye,Y){return ye[Y.name]=Y.align,ye},{});for(g=0;g<d.length;g+=1){"rowStart"in m&&m.rowStart instanceof Function&&m.rowStart({row:g,data:d[g]},this);var Q=l.call(this,d[g],O);for(v=0;v<S.length;v+=1){var he=d[g][S[v]];"cellStart"in m&&m.cellStart instanceof Function&&m.cellStart({row:g,col:v,data:he},this),o.call(this,new a(c,u,O[S[v]],Q,he,g+2,ne[S[v]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=u,this};var l=function(c,u){var d=this.internal.__cell__.padding,p=this.internal.__cell__.table_font_size,m=this.internal.scaleFactor;return Object.keys(c).map(function(g){var b=c[g];return this.splitTextToSize(b.hasOwnProperty("text")?b.text:b,u[g]-d-d)},this).map(function(g){return this.getLineHeightFactor()*g.length*p/m+d+d},this).reduce(function(g,b){return Math.max(g,b)},0)};n.setTableHeaderRow=function(c){s.call(this),this.internal.__cell__.tableHeaderRow=c},n.printHeaderRow=function(c,u){if(s.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var d;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var p=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(p[0],p[1],p[2],p[3],void 0,-1)}this.setFont(void 0,"bold");for(var m=[],g=0;g<this.internal.__cell__.tableHeaderRow.length;g+=1){d=this.internal.__cell__.tableHeaderRow[g].clone(),u&&(d.y=this.internal.__cell__.margins.top||0,m.push(d)),d.lineNumber=c;var b=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,d),this.setTextColor(b)}m.length>0&&this.setTableHeaderRow(m),this.setFont(void 0,"normal"),t=!1}})(qt.API);var R7={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},L7=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],$E=$7(L7),F7=[100,200,300,400,500,600,700,800,900],wte=$7(F7);function E5(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(a){return R7[a=a||"normal"]?a:"normal"})(n.style),s=(function(a){return a?typeof a=="number"?a>=100&&a<=900&&a%100==0?a:400:/^\d00$/.test(a)?parseInt(a):a==="bold"?700:400:400})(n.weight),r=(function(a){return typeof $E[a=a||"normal"]=="number"?a:"normal"})(n.stretch);return{family:e,style:t,weight:s,stretch:r,src:n.src||[],ref:n.ref||{name:e,style:[r,t,s].join(" ")}}}function R4(n,e,t,s){var r;for(r=t;r>=0&&r<e.length;r+=s)if(n[e[r]])return n[e[r]];for(r=t;r>=0&&r<e.length;r-=s)if(n[e[r]])return n[e[r]]}var xte={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},L4={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function F4(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function M4(n){return n.trimLeft()}function Ste(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function Cte(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var wS,P4,z4,u0,xS,B4,j4,U4,I5=["times"];function V4(n,e,t,s,r){var a=4,o=H4;switch(r){case qt.API.image_compression.FAST:a=1,o=W4;break;case qt.API.image_compression.MEDIUM:a=6,o=G4;break;case qt.API.image_compression.SLOW:a=9,o=q4}n=(function(c,u,d,p){for(var m,g=c.length/u,b=new Uint8Array(c.length+g),v=[_te,W4,H4,G4,q4],x=0;x<g;x+=1){var S=x*u,C=c.subarray(S,S+u);if(p)b.set(p(C,d,m),S+x);else{for(var A=v.length,k=[],O=0;O<A;O+=1)k[O]=v[O](C,d,m);var F=Tte(k.concat());b.set(k[F],S+x)}m=C}return b})(n,e,Math.ceil(t*s/8),o);var l=TE(n,{level:a});return qt.API.__addimage__.arrayBufferToBinaryString(l)}function _te(n){var e=Array.apply([],n);return e.unshift(0),e}function W4(n,e){var t=n.length,s=[];s[0]=1;for(var r=0;r<t;r+=1){var a=n[r-e]||0;s[r+1]=n[r]-a+256&255}return s}function H4(n,e,t){var s=n.length,r=[];r[0]=2;for(var a=0;a<s;a+=1){var o=t&&t[a]||0;r[a+1]=n[a]-o+256&255}return r}function G4(n,e,t){var s=n.length,r=[];r[0]=3;for(var a=0;a<s;a+=1){var o=n[a-e]||0,l=t&&t[a]||0;r[a+1]=n[a]+256-(o+l>>>1)&255}return r}function q4(n,e,t){var s=n.length,r=[];r[0]=4;for(var a=0;a<s;a+=1){var o=kte(n[a-e]||0,t&&t[a]||0,t&&t[a-e]||0);r[a+1]=n[a]-o+256&255}return r}function kte(n,e,t){if(n===e&&e===t)return n;var s=Math.abs(e-t),r=Math.abs(n-t),a=Math.abs(n+e-t-t);return s<=r&&s<=a?n:r<=a?e:t}function Tte(n){var e=n.map(function(t){return t.reduce(function(s,r){return s+Math.abs(r)},0)});return e.indexOf(Math.min.apply(null,e))}function O5(n,e,t){var s=e*t,r=Math.floor(s/8),a=16-(s-8*r+t),o=(1<<t)-1;return M7(n,r)>>a&o}function X4(n,e,t,s){var r=t*s,a=Math.floor(r/8),o=16-(r-8*a+s),l=(1<<s)-1,c=(e&l)<<o;(function(u,d,p){if(d+1<u.byteLength)u.setUint16(d,p,!1);else{var m=p>>8&255;u.setUint8(d,m)}})(n,a,M7(n,a)&~(l<<o)&65535|c)}function M7(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function Nte(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,s=n[e++]|n[e++]<<8,r=n[e++],a=r>>7,o=1<<1+(7&r);n[e++],n[e++];var l=null,c=null;a&&(l=e,c=o,e+=3*o);var u=!0,d=[],p=0,m=null,g=0,b=null;for(this.width=t,this.height=s;u&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,b=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!((I=n[e++])>=0))throw Error("Invalid block size");if(I===0)break;e+=I}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var v=n[e++];p=n[e++]|n[e++]<<8,m=n[e++],1&v||(m=null),g=v>>2&7,e++;break;case 254:for(;;){if(!((I=n[e++])>=0))throw Error("Invalid block size");if(I===0)break;e+=I}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var x=n[e++]|n[e++]<<8,S=n[e++]|n[e++]<<8,C=n[e++]|n[e++]<<8,A=n[e++]|n[e++]<<8,k=n[e++],O=k>>6&1,F=1<<1+(7&k),$=l,M=c,R=!1;k>>7&&(R=!0,$=e,M=F,e+=3*F);var z=e;for(e++;;){var I;if(!((I=n[e++])>=0))throw Error("Invalid block size");if(I===0)break;e+=I}d.push({x,y:S,width:C,height:A,has_local_palette:R,palette_offset:$,palette_size:M,data_offset:z,data_length:e-z,transparent_index:m,interlaced:!!O,delay:p,disposal:g});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return b},this.frameInfo=function(j){if(j<0||j>=d.length)throw new Error("Frame index out of range.");return d[j]},this.decodeAndBlitFrameBGRA=function(j,H){var q=this.frameInfo(j),re=q.width*q.height,X=new Uint8Array(re);Y4(n,q.data_offset,X,re);var ne=q.palette_offset,Q=q.transparent_index;Q===null&&(Q=256);var he=q.width,ye=t-he,Y=he,B=4*(q.y*t+q.x),G=4*((q.y+q.height)*t+q.x),J=B,oe=4*ye;q.interlaced===!0&&(oe+=4*t*7);for(var de=8,ge=0,Ae=X.length;ge<Ae;++ge){var Ce=X[ge];if(Y===0&&(Y=he,(J+=oe)>=G&&(oe=4*ye+4*t*(de-1),J=B+(he+ye)*(de<<1),de>>=1)),Ce===Q)J+=4;else{var Fe=n[ne+3*Ce],Ge=n[ne+3*Ce+1],ot=n[ne+3*Ce+2];H[J++]=ot,H[J++]=Ge,H[J++]=Fe,H[J++]=255}--Y}},this.decodeAndBlitFrameRGBA=function(j,H){var q=this.frameInfo(j),re=q.width*q.height,X=new Uint8Array(re);Y4(n,q.data_offset,X,re);var ne=q.palette_offset,Q=q.transparent_index;Q===null&&(Q=256);var he=q.width,ye=t-he,Y=he,B=4*(q.y*t+q.x),G=4*((q.y+q.height)*t+q.x),J=B,oe=4*ye;q.interlaced===!0&&(oe+=4*t*7);for(var de=8,ge=0,Ae=X.length;ge<Ae;++ge){var Ce=X[ge];if(Y===0&&(Y=he,(J+=oe)>=G&&(oe=4*ye+4*t*(de-1),J=B+(he+ye)*(de<<1),de>>=1)),Ce===Q)J+=4;else{var Fe=n[ne+3*Ce],Ge=n[ne+3*Ce+1],ot=n[ne+3*Ce+2];H[J++]=Fe,H[J++]=Ge,H[J++]=ot,H[J++]=255}--Y}}}function Y4(n,e,t,s){for(var r=n[e++],a=1<<r,o=a+1,l=o+1,c=r+1,u=(1<<c)-1,d=0,p=0,m=0,g=n[e++],b=new Int32Array(4096),v=null;;){for(;d<16&&g!==0;)p|=n[e++]<<d,d+=8,g===1?g=n[e++]:--g;if(d<c)break;var x=p&u;if(p>>=c,d-=c,x!==a){if(x===o)break;for(var S=x<l?x:v,C=0,A=S;A>a;)A=b[A]>>8,++C;var k=A;if(m+C+(S!==x?1:0)>s)return void Vs.log("Warning, gif stream longer than expected.");t[m++]=k;var O=m+=C;for(S!==x&&(t[m++]=k),A=S;C--;)A=b[A],t[--O]=255&A,A>>=8;v!==null&&l<4096&&(b[l++]=v<<8|k,l>=u+1&&c<12&&(++c,u=u<<1|1)),v=x}else l=o+1,u=(1<<(c=r+1))-1,v=null}return m!==s&&Vs.log("Warning, gif stream shorter than expected."),t}function D5(n){var e,t,s,r,a,o=Math.floor,l=new Array(64),c=new Array(64),u=new Array(64),d=new Array(64),p=new Array(65535),m=new Array(65535),g=new Array(64),b=new Array(64),v=[],x=0,S=7,C=new Array(64),A=new Array(64),k=new Array(64),O=new Array(256),F=new Array(2048),$=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],M=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],I=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],j=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],re=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function X(B,G){for(var J=0,oe=0,de=new Array,ge=1;ge<=16;ge++){for(var Ae=1;Ae<=B[ge];Ae++)de[G[oe]]=[],de[G[oe]][0]=J,de[G[oe]][1]=ge,oe++,J++;J*=2}return de}function ne(B){for(var G=B[0],J=B[1]-1;J>=0;)G&1<<J&&(x|=1<<S),J--,--S<0&&(x==255?(Q(255),Q(0)):Q(x),S=7,x=0)}function Q(B){v.push(B)}function he(B){Q(B>>8&255),Q(255&B)}function ye(B,G,J,oe,de){for(var ge,Ae=de[0],Ce=de[240],Fe=(function(nt,xt){var vt,Tt,Lt,Yt,mn,Jt,bn,cn,Et,fn,zt=0;for(Et=0;Et<8;++Et){vt=nt[zt],Tt=nt[zt+1],Lt=nt[zt+2],Yt=nt[zt+3],mn=nt[zt+4],Jt=nt[zt+5],bn=nt[zt+6];var Ks=vt+(cn=nt[zt+7]),Cn=vt-cn,Qt=Tt+bn,un=Tt-bn,Un=Lt+Jt,en=Lt-Jt,Is=Yt+mn,on=Yt-mn,gn=Ks+Is,Ss=Ks-Is,An=Qt+Un,Gt=Qt-Un;nt[zt]=gn+An,nt[zt+4]=gn-An;var Qn=.707106781*(Gt+Ss);nt[zt+2]=Ss+Qn,nt[zt+6]=Ss-Qn;var Qo=.382683433*((gn=on+en)-(Gt=un+Cn)),Mi=.5411961*gn+Qo,zl=1.306562965*Gt+Qo,bo=.707106781*(An=en+un),Kt=Cn+bo,wc=Cn-bo;nt[zt+5]=wc+Mi,nt[zt+3]=wc-Mi,nt[zt+1]=Kt+zl,nt[zt+7]=Kt-zl,zt+=8}for(zt=0,Et=0;Et<8;++Et){vt=nt[zt],Tt=nt[zt+8],Lt=nt[zt+16],Yt=nt[zt+24],mn=nt[zt+32],Jt=nt[zt+40],bn=nt[zt+48];var Bl=vt+(cn=nt[zt+56]),za=vt-cn,Ba=Tt+bn,Xs=Tt-bn,Tr=Lt+Jt,ii=Lt-Jt,Tu=Yt+mn,ia=Yt-mn,Cs=Bl+Tu,Zs=Bl-Tu,Pi=Ba+Tr,ja=Ba-Tr;nt[zt]=Cs+Pi,nt[zt+32]=Cs-Pi;var vo=.707106781*(ja+Zs);nt[zt+16]=Zs+vo,nt[zt+48]=Zs-vo;var Ah=.382683433*((Cs=ia+ii)-(ja=Xs+za)),el=.5411961*Cs+Ah,tl=1.306562965*ja+Ah,Nu=.707106781*(Pi=ii+Xs),nl=za+Nu,sl=za-Nu;nt[zt+40]=sl+el,nt[zt+24]=sl-el,nt[zt+8]=nl+tl,nt[zt+56]=nl-tl,zt++}for(Et=0;Et<64;++Et)fn=nt[Et]*xt[Et],g[Et]=fn>0?fn+.5|0:fn-.5|0;return g})(B,G),Ge=0;Ge<64;++Ge)b[$[Ge]]=Fe[Ge];var ot=b[0]-J;J=b[0],ot==0?ne(oe[0]):(ne(oe[m[ge=32767+ot]]),ne(p[ge]));for(var ut=63;ut>0&&b[ut]==0;)ut--;if(ut==0)return ne(Ae),J;for(var pt,ce=1;ce<=ut;){for(var rt=ce;b[ce]==0&&ce<=ut;)++ce;var At=ce-rt;if(At>=16){pt=At>>4;for(var yt=1;yt<=pt;++yt)ne(Ce);At&=15}ge=32767+b[ce],ne(de[(At<<4)+m[ge]]),ne(p[ge]),ce++}return ut!=63&&ne(Ae),J}function Y(B){B=Math.min(Math.max(B,1),100),a!=B&&((function(G){for(var J=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],oe=0;oe<64;oe++){var de=o((J[oe]*G+50)/100);de=Math.min(Math.max(de,1),255),l[$[oe]]=de}for(var ge=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ae=0;Ae<64;Ae++){var Ce=o((ge[Ae]*G+50)/100);Ce=Math.min(Math.max(Ce,1),255),c[$[Ae]]=Ce}for(var Fe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ge=0,ot=0;ot<8;ot++)for(var ut=0;ut<8;ut++)u[Ge]=1/(l[$[Ge]]*Fe[ot]*Fe[ut]*8),d[Ge]=1/(c[$[Ge]]*Fe[ot]*Fe[ut]*8),Ge++})(B<50?Math.floor(5e3/B):Math.floor(200-2*B)),a=B)}this.encode=function(B,G){G&&Y(G),v=new Array,x=0,S=7,he(65496),he(65504),he(16),Q(74),Q(70),Q(73),Q(70),Q(0),Q(1),Q(1),Q(0),he(1),he(1),Q(0),Q(0),(function(){he(65499),he(132),Q(0);for(var Tt=0;Tt<64;Tt++)Q(l[Tt]);Q(1);for(var Lt=0;Lt<64;Lt++)Q(c[Lt])})(),(function(Tt,Lt){he(65472),he(17),Q(8),he(Lt),he(Tt),Q(3),Q(1),Q(17),Q(0),Q(2),Q(17),Q(1),Q(3),Q(17),Q(1)})(B.width,B.height),(function(){he(65476),he(418),Q(0);for(var Tt=0;Tt<16;Tt++)Q(M[Tt+1]);for(var Lt=0;Lt<=11;Lt++)Q(R[Lt]);Q(16);for(var Yt=0;Yt<16;Yt++)Q(z[Yt+1]);for(var mn=0;mn<=161;mn++)Q(I[mn]);Q(1);for(var Jt=0;Jt<16;Jt++)Q(j[Jt+1]);for(var bn=0;bn<=11;bn++)Q(H[bn]);Q(17);for(var cn=0;cn<16;cn++)Q(q[cn+1]);for(var Et=0;Et<=161;Et++)Q(re[Et])})(),he(65498),he(12),Q(3),Q(1),Q(0),Q(2),Q(17),Q(3),Q(17),Q(0),Q(63),Q(0);var J=0,oe=0,de=0;x=0,S=7,this.encode.displayName="_encode_";for(var ge,Ae,Ce,Fe,Ge,ot,ut,pt,ce,rt=B.data,At=B.width,yt=B.height,nt=4*At,xt=0;xt<yt;){for(ge=0;ge<nt;){for(Ge=nt*xt+ge,ut=-1,pt=0,ce=0;ce<64;ce++)ot=Ge+(pt=ce>>3)*nt+(ut=4*(7&ce)),xt+pt>=yt&&(ot-=nt*(xt+1+pt-yt)),ge+ut>=nt&&(ot-=ge+ut-nt+4),Ae=rt[ot++],Ce=rt[ot++],Fe=rt[ot++],C[ce]=(F[Ae]+F[Ce+256|0]+F[Fe+512|0]>>16)-128,A[ce]=(F[Ae+768|0]+F[Ce+1024|0]+F[Fe+1280|0]>>16)-128,k[ce]=(F[Ae+1280|0]+F[Ce+1536|0]+F[Fe+1792|0]>>16)-128;J=ye(C,u,J,e,s),oe=ye(A,d,oe,t,r),de=ye(k,d,de,t,r),ge+=32}xt+=8}if(S>=0){var vt=[];vt[1]=S+1,vt[0]=(1<<S+1)-1,ne(vt)}return he(65497),new Uint8Array(v)},n=n||50,(function(){for(var B=String.fromCharCode,G=0;G<256;G++)O[G]=B(G)})(),e=X(M,R),t=X(j,H),s=X(z,I),r=X(q,re),(function(){for(var B=1,G=2,J=1;J<=15;J++){for(var oe=B;oe<G;oe++)m[32767+oe]=J,p[32767+oe]=[],p[32767+oe][1]=J,p[32767+oe][0]=oe;for(var de=-(G-1);de<=-B;de++)m[32767+de]=J,p[32767+de]=[],p[32767+de][1]=J,p[32767+de][0]=G-1+de;B<<=1,G<<=1}})(),(function(){for(var B=0;B<256;B++)F[B]=19595*B,F[B+256|0]=38470*B,F[B+512|0]=7471*B+32768,F[B+768|0]=-11059*B,F[B+1024|0]=-21709*B,F[B+1280|0]=32768*B+8421375,F[B+1536|0]=-27439*B,F[B+1792|0]=-5329*B})(),Y(n)}function Yc(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function K4(n){function e(R){if(!R)throw Error("assert :P")}function t(R,z,I){for(var j=0;4>j;j++)if(R[z+j]!=I.charCodeAt(j))return!0;return!1}function s(R,z,I,j,H){for(var q=0;q<H;q++)R[z+q]=I[j+q]}function r(R,z,I,j){for(var H=0;H<j;H++)R[z+H]=I}function a(R){return new Int32Array(R)}function o(R,z){for(var I=[],j=0;j<R;j++)I.push(new z);return I}function l(R,z){var I=[];return(function j(H,q,re){for(var X=re[q],ne=0;ne<X&&(H.push(re.length>q+1?[]:new z),!(re.length<q+1));ne++)j(H[ne],q+1,re)})(I,0,R),I}var c=function(){var R=this;function z(_,N){for(var L=1<<N-1>>>0;_&L;)L>>>=1;return L?(_&L-1)+L:_}function I(_,N,L,V,Z){e(!(V%L));do _[N+(V-=L)]=Z;while(0<V)}function j(_,N,L,V,Z){if(e(2328>=Z),512>=Z)var te=a(512);else if((te=a(Z))==null)return 0;return(function(se,le,ue,pe,Te,ze){var fe,Oe,Me=le,Ke=1<<ue,Pe=a(16),Xe=a(16);for(e(Te!=0),e(pe!=null),e(se!=null),e(0<ue),Oe=0;Oe<Te;++Oe){if(15<pe[Oe])return 0;++Pe[pe[Oe]]}if(Pe[0]==Te)return 0;for(Xe[1]=0,fe=1;15>fe;++fe){if(Pe[fe]>1<<fe)return 0;Xe[fe+1]=Xe[fe]+Pe[fe]}for(Oe=0;Oe<Te;++Oe)fe=pe[Oe],0<pe[Oe]&&(ze[Xe[fe]++]=Oe);if(Xe[15]==1)return(pe=new H).g=0,pe.value=ze[0],I(se,Me,1,Ke,pe),Ke;var Qe,ht=-1,st=Ke-1,Ft=0,Ct=1,vn=1,Ot=1<<ue;for(Oe=0,fe=1,Te=2;fe<=ue;++fe,Te<<=1){if(Ct+=vn<<=1,0>(vn-=Pe[fe]))return 0;for(;0<Pe[fe];--Pe[fe])(pe=new H).g=fe,pe.value=ze[Oe++],I(se,Me+Ft,Te,Ot,pe),Ft=z(Ft,fe)}for(fe=ue+1,Te=2;15>=fe;++fe,Te<<=1){if(Ct+=vn<<=1,0>(vn-=Pe[fe]))return 0;for(;0<Pe[fe];--Pe[fe]){if(pe=new H,(Ft&st)!=ht){for(Me+=Ot,Qe=1<<(ht=fe)-ue;15>ht&&!(0>=(Qe-=Pe[ht]));)++ht,Qe<<=1;Ke+=Ot=1<<(Qe=ht-ue),se[le+(ht=Ft&st)].g=Qe+ue,se[le+ht].value=Me-le-ht}pe.g=fe-ue,pe.value=ze[Oe++],I(se,Me+(Ft>>ue),Te,Ot,pe),Ft=z(Ft,fe)}}return Ct!=2*Xe[15]-1?0:Ke})(_,N,L,V,Z,te)}function H(){this.value=this.g=0}function q(){this.value=this.g=0}function re(){this.G=o(5,H),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Du,q)}function X(_,N,L,V){e(_!=null),e(N!=null),e(2147483648>V),_.Ca=254,_.I=0,_.b=-8,_.Ka=0,_.oa=N,_.pa=L,_.Jd=N,_.Yc=L+V,_.Zc=4<=V?L+V-4+1:L,Ae(_)}function ne(_,N){for(var L=0;0<N--;)L|=Fe(_,128)<<N;return L}function Q(_,N){var L=ne(_,N);return Ce(_)?-L:L}function he(_,N,L,V){var Z,te=0;for(e(_!=null),e(N!=null),e(4294967288>V),_.Sb=V,_.Ra=0,_.u=0,_.h=0,4<V&&(V=4),Z=0;Z<V;++Z)te+=N[L+Z]<<8*Z;_.Ra=te,_.bb=V,_.oa=N,_.pa=L}function ye(_){for(;8<=_.u&&_.bb<_.Sb;)_.Ra>>>=8,_.Ra+=_.oa[_.pa+_.bb]<<ql-8>>>0,++_.bb,_.u-=8;oe(_)&&(_.h=1,_.u=0)}function Y(_,N){if(e(0<=N),!_.h&&N<=ca){var L=J(_)&ba[N];return _.u+=N,ye(_),L}return _.h=1,_.u=0}function B(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function G(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function J(_){return _.Ra>>>(_.u&ql-1)>>>0}function oe(_){return e(_.bb<=_.Sb),_.h||_.bb==_.Sb&&_.u>ql}function de(_,N){_.u=N,_.h=oe(_)}function ge(_){_.u>=Xl&&(e(_.u>=Xl),ye(_))}function Ae(_){e(_!=null&&_.oa!=null),_.pa<_.Zc?(_.I=(_.oa[_.pa++]|_.I<<8)>>>0,_.b+=8):(e(_!=null&&_.oa!=null),_.pa<_.Yc?(_.b+=8,_.I=_.oa[_.pa++]|_.I<<8):_.Ka?_.b=0:(_.I<<=8,_.b+=8,_.Ka=1))}function Ce(_){return ne(_,1)}function Fe(_,N){var L=_.Ca;0>_.b&&Ae(_);var V=_.b,Z=L*N>>>8,te=(_.I>>>V>Z)+0;for(te?(L-=Z,_.I-=Z+1<<V>>>0):L=Z+1,V=L,Z=0;256<=V;)Z+=8,V>>=8;return V=7^Z+Lc[V],_.b-=V,_.Ca=(L<<V)-1,te}function Ge(_,N,L){_[N+0]=L>>24&255,_[N+1]=L>>16&255,_[N+2]=L>>8&255,_[N+3]=255&L}function ot(_,N){return _[N+0]|_[N+1]<<8}function ut(_,N){return ot(_,N)|_[N+2]<<16}function pt(_,N){return ot(_,N)|ot(_,N+2)<<16}function ce(_,N){var L=1<<N;return e(_!=null),e(0<N),_.X=a(L),_.X==null?0:(_.Mb=32-N,_.Xa=N,1)}function rt(_,N){e(_!=null),e(N!=null),e(_.Xa==N.Xa),s(N.X,0,_.X,0,1<<N.Xa)}function At(){this.X=[],this.Xa=this.Mb=0}function yt(_,N,L,V){e(L!=null),e(V!=null);var Z=L[0],te=V[0];return Z==0&&(Z=(_*te+N/2)/N),te==0&&(te=(N*Z+_/2)/_),0>=Z||0>=te?0:(L[0]=Z,V[0]=te,1)}function nt(_,N){return _+(1<<N)-1>>>N}function xt(_,N){return((4278255360&_)+(4278255360&N)>>>0&4278255360)+((16711935&_)+(16711935&N)>>>0&16711935)>>>0}function vt(_,N){R[N]=function(L,V,Z,te,se,le,ue){var pe;for(pe=0;pe<se;++pe){var Te=R[_](le[ue+pe-1],Z,te+pe);le[ue+pe]=xt(L[V+pe],Te)}}}function Tt(){this.ud=this.hd=this.jd=0}function Lt(_,N){return((4278124286&(_^N))>>>1)+(_&N)>>>0}function Yt(_){return 0<=_&&256>_?_:0>_?0:255<_?255:void 0}function mn(_,N){return Yt(_+(_-N+.5>>1))}function Jt(_,N,L){return Math.abs(N-L)-Math.abs(_-L)}function bn(_,N,L,V,Z,te,se){for(V=te[se-1],L=0;L<Z;++L)te[se+L]=V=xt(_[N+L],V)}function cn(_,N,L,V,Z){var te;for(te=0;te<L;++te){var se=_[N+te],le=se>>8&255,ue=16711935&(ue=(ue=16711935&se)+((le<<16)+le));V[Z+te]=(4278255360&se)+ue>>>0}}function Et(_,N){N.jd=255&_,N.hd=_>>8&255,N.ud=_>>16&255}function fn(_,N,L,V,Z,te){var se;for(se=0;se<V;++se){var le=N[L+se],ue=le>>>8,pe=le,Te=255&(Te=(Te=le>>>16)+((_.jd<<24>>24)*(ue<<24>>24)>>>5));pe=255&(pe=(pe+=(_.hd<<24>>24)*(ue<<24>>24)>>>5)+((_.ud<<24>>24)*(Te<<24>>24)>>>5)),Z[te+se]=(4278255360&le)+(Te<<16)+pe}}function zt(_,N,L,V,Z){R[N]=function(te,se,le,ue,pe,Te,ze,fe,Oe){for(ue=ze;ue<fe;++ue)for(ze=0;ze<Oe;++ze)pe[Te++]=Z(le[V(te[se++])])},R[_]=function(te,se,le,ue,pe,Te,ze){var fe=8>>te.b,Oe=te.Ea,Me=te.K[0],Ke=te.w;if(8>fe)for(te=(1<<te.b)-1,Ke=(1<<fe)-1;se<le;++se){var Pe,Xe=0;for(Pe=0;Pe<Oe;++Pe)Pe&te||(Xe=V(ue[pe++])),Te[ze++]=Z(Me[Xe&Ke]),Xe>>=fe}else R["VP8LMapColor"+L](ue,pe,Me,Ke,Te,ze,se,le,Oe)}}function Ks(_,N,L,V,Z){for(L=N+L;N<L;){var te=_[N++];V[Z++]=te>>16&255,V[Z++]=te>>8&255,V[Z++]=255&te}}function Cn(_,N,L,V,Z){for(L=N+L;N<L;){var te=_[N++];V[Z++]=te>>16&255,V[Z++]=te>>8&255,V[Z++]=255&te,V[Z++]=te>>24&255}}function Qt(_,N,L,V,Z){for(L=N+L;N<L;){var te=(se=_[N++])>>16&240|se>>12&15,se=240&se|se>>28&15;V[Z++]=te,V[Z++]=se}}function un(_,N,L,V,Z){for(L=N+L;N<L;){var te=(se=_[N++])>>16&248|se>>13&7,se=se>>5&224|se>>3&31;V[Z++]=te,V[Z++]=se}}function Un(_,N,L,V,Z){for(L=N+L;N<L;){var te=_[N++];V[Z++]=255&te,V[Z++]=te>>8&255,V[Z++]=te>>16&255}}function en(_,N,L,V,Z,te){if(te==0)for(L=N+L;N<L;)Ge(V,((te=_[N++])[0]>>24|te[1]>>8&65280|te[2]<<8&16711680|te[3]<<24)>>>0),Z+=32;else s(V,Z,_,N,L)}function Is(_,N){R[N][0]=R[_+"0"],R[N][1]=R[_+"1"],R[N][2]=R[_+"2"],R[N][3]=R[_+"3"],R[N][4]=R[_+"4"],R[N][5]=R[_+"5"],R[N][6]=R[_+"6"],R[N][7]=R[_+"7"],R[N][8]=R[_+"8"],R[N][9]=R[_+"9"],R[N][10]=R[_+"10"],R[N][11]=R[_+"11"],R[N][12]=R[_+"12"],R[N][13]=R[_+"13"],R[N][14]=R[_+"0"],R[N][15]=R[_+"0"]}function on(_){return _==Lp||_==Og||_==Zd||_==Dg}function gn(){this.eb=[],this.size=this.A=this.fb=0}function Ss(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function An(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new gn,this.f.kb=new Ss,this.sd=null}function Gt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Qn(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Qo(_){return alert("todo:WebPSamplerProcessPlane"),_.T}function Mi(_,N){var L=_.T,V=N.ba.f.RGBA,Z=V.eb,te=V.fb+_.ka*V.A,se=ki[N.ba.S],le=_.y,ue=_.O,pe=_.f,Te=_.N,ze=_.ea,fe=_.W,Oe=N.cc,Me=N.dc,Ke=N.Mc,Pe=N.Nc,Xe=_.ka,Qe=_.ka+_.T,ht=_.U,st=ht+1>>1;for(Xe==0?se(le,ue,null,null,pe,Te,ze,fe,pe,Te,ze,fe,Z,te,null,null,ht):(se(N.ec,N.fc,le,ue,Oe,Me,Ke,Pe,pe,Te,ze,fe,Z,te-V.A,Z,te,ht),++L);Xe+2<Qe;Xe+=2)Oe=pe,Me=Te,Ke=ze,Pe=fe,Te+=_.Rc,fe+=_.Rc,te+=2*V.A,se(le,(ue+=2*_.fa)-_.fa,le,ue,Oe,Me,Ke,Pe,pe,Te,ze,fe,Z,te-V.A,Z,te,ht);return ue+=_.fa,_.j+Qe<_.o?(s(N.ec,N.fc,le,ue,ht),s(N.cc,N.dc,pe,Te,st),s(N.Mc,N.Nc,ze,fe,st),L--):1&Qe||se(le,ue,null,null,pe,Te,ze,fe,pe,Te,ze,fe,Z,te+V.A,null,null,ht),L}function zl(_,N,L){var V=_.F,Z=[_.J];if(V!=null){var te=_.U,se=N.ba.S,le=se==Rp||se==Zd;N=N.ba.f.RGBA;var ue=[0],pe=_.ka;ue[0]=_.T,_.Kb&&(pe==0?--ue[0]:(--pe,Z[0]-=_.width),_.j+_.ka+_.T==_.o&&(ue[0]=_.o-_.j-pe));var Te=N.eb;pe=N.fb+pe*N.A,_=Ip(V,Z[0],_.width,te,ue,Te,pe+(le?0:3),N.A),e(L==ue),_&&on(se)&&zh(Te,pe,le,te,ue,N.A)}return 0}function bo(_){var N=_.ma,L=N.ba.S,V=11>L,Z=L==ji||L==_o||L==Rp||L==Kd||L==12||on(L);if(N.memory=null,N.Ib=null,N.Jb=null,N.Nd=null,!Rc(N.Oa,_,Z?11:12))return 0;if(Z&&on(L)&&Tp(),_.da)alert("todo:use_scaling");else{if(V){if(N.Ib=Qo,_.Kb){if(L=_.U+1>>1,N.memory=a(_.U+2*L),N.memory==null)return 0;N.ec=N.memory,N.fc=0,N.cc=N.ec,N.dc=N.fc+_.U,N.Mc=N.cc,N.Nc=N.dc+L,N.Ib=Mi,Tp()}}else alert("todo:EmitYUV");Z&&(N.Jb=zl,V&&ll())}if(V&&!zu){for(_=0;256>_;++_)Ti[_]=89858*(_-128)+ef>>Io,LN[_]=-22014*(_-128)+ef,bx[_]=-45773*(_-128),Mg[_]=113618*(_-128)+ef>>Io;for(_=Vh;_<Pu;++_)N=76283*(_-16)+ef>>Io,FN[_-Vh]=Va(N,255),MN[_-Vh]=Va(N+8>>4,15);zu=1}return 1}function Kt(_){var N=_.ma,L=_.U,V=_.T;return e(!(1&_.ka)),0>=L||0>=V?0:(L=N.Ib(_,N),N.Jb!=null&&N.Jb(_,N,L),N.Dc+=L,1)}function wc(_){_.ma.memory=null}function Bl(_,N,L,V){return Y(_,8)!=47?0:(N[0]=Y(_,14)+1,L[0]=Y(_,14)+1,V[0]=Y(_,1),Y(_,3)!=0?0:!_.h)}function za(_,N){if(4>_)return _+1;var L=_-2>>1;return(2+(1&_)<<L)+Y(N,L)+1}function Ba(_,N){return 120<N?N-120:1<=(L=((L=To[N-1])>>4)*_+(8-(15&L)))?L:1;var L}function Xs(_,N,L){var V=J(L),Z=_[N+=255&V].g-8;return 0<Z&&(de(L,L.u+8),V=J(L),N+=_[N].value,N+=V&(1<<Z)-1),de(L,L.u+_[N].g),_[N].value}function Tr(_,N,L){return L.g+=_.g,L.value+=_.value<<N>>>0,e(8>=L.g),_.g}function ii(_,N,L){var V=_.xc;return e((N=V==0?0:_.vc[_.md*(L>>V)+(N>>V)])<_.Wb),_.Ya[N]}function Tu(_,N,L,V){var Z=_.ab,te=_.c*N,se=_.C;N=se+N;var le=L,ue=V;for(V=_.Ta,L=_.Ua;0<Z--;){var pe=_.gc[Z],Te=se,ze=N,fe=le,Oe=ue,Me=(ue=V,le=L,pe.Ea);switch(e(Te<ze),e(ze<=pe.nc),pe.hc){case 2:wr(fe,Oe,(ze-Te)*Me,ue,le);break;case 0:var Ke=Te,Pe=ze,Xe=ue,Qe=le,ht=(Ot=pe).Ea;Ke==0&&(Gd(fe,Oe,null,null,1,Xe,Qe),bn(fe,Oe+1,0,0,ht-1,Xe,Qe+1),Oe+=ht,Qe+=ht,++Ke);for(var st=1<<Ot.b,Ft=st-1,Ct=nt(ht,Ot.b),vn=Ot.K,Ot=Ot.w+(Ke>>Ot.b)*Ct;Ke<Pe;){var Vn=vn,js=Ot,kn=1;for(qd(fe,Oe,Xe,Qe-ht,1,Xe,Qe);kn<ht;){var _t=(kn&~Ft)+st;_t>ht&&(_t=ht),(0,Fc[Vn[js++]>>8&15])(fe,Oe+ +kn,Xe,Qe+kn-ht,_t-kn,Xe,Qe+kn),kn=_t}Oe+=ht,Qe+=ht,++Ke&Ft||(Ot+=Ct)}ze!=pe.nc&&s(ue,le-Me,ue,le+(ze-Te-1)*Me,Me);break;case 1:for(Me=fe,Pe=Oe,ht=(fe=pe.Ea)-(Qe=fe&~(Xe=(Oe=1<<pe.b)-1)),Ke=nt(fe,pe.b),st=pe.K,pe=pe.w+(Te>>pe.b)*Ke;Te<ze;){for(Ft=st,Ct=pe,vn=new Tt,Ot=Pe+Qe,Vn=Pe+fe;Pe<Ot;)Et(Ft[Ct++],vn),Xd(vn,Me,Pe,Oe,ue,le),Pe+=Oe,le+=Oe;Pe<Vn&&(Et(Ft[Ct++],vn),Xd(vn,Me,Pe,ht,ue,le),Pe+=ht,le+=ht),++Te&Xe||(pe+=Ke)}break;case 3:if(fe==ue&&Oe==le&&0<pe.b){for(Pe=ue,fe=Me=le+(ze-Te)*Me-(Qe=(ze-Te)*nt(pe.Ea,pe.b)),Oe=ue,Xe=le,Ke=[],Qe=(ht=Qe)-1;0<=Qe;--Qe)Ke[Qe]=Oe[Xe+Qe];for(Qe=ht-1;0<=Qe;--Qe)Pe[fe+Qe]=Ke[Qe];Tg(pe,Te,ze,ue,Me,ue,le)}else Tg(pe,Te,ze,fe,Oe,ue,le)}le=V,ue=L}ue!=L&&s(V,L,le,ue,te)}function ia(_,N){var L=_.V,V=_.Ba+_.c*_.C,Z=N-_.C;if(e(N<=_.l.o),e(16>=Z),0<Z){var te=_.l,se=_.Ta,le=_.Ua,ue=te.width;if(Tu(_,Z,L,V),Z=le=[le],e((L=_.C)<(V=N)),e(te.v<te.va),V>te.o&&(V=te.o),L<te.j){var pe=te.j-L;L=te.j,Z[0]+=pe*ue}if(L>=V?L=0:(Z[0]+=4*te.v,te.ka=L-te.j,te.U=te.va-te.v,te.T=V-L,L=1),L){if(le=le[0],11>(L=_.ca).S){var Te=L.f.RGBA,ze=(V=L.S,Z=te.U,te=te.T,pe=Te.eb,Te.A),fe=te;for(Te=Te.fb+_.Ma*Te.A;0<fe--;){var Oe=se,Me=le,Ke=Z,Pe=pe,Xe=Te;switch(V){case Eg:Yd(Oe,Me,Ke,Pe,Xe);break;case ji:Mc(Oe,Me,Ke,Pe,Xe);break;case Lp:Mc(Oe,Me,Ke,Pe,Xe),zh(Pe,Xe,0,Ke,1,0);break;case Ig:Mh(Oe,Me,Ke,Pe,Xe);break;case _o:en(Oe,Me,Ke,Pe,Xe,1);break;case Og:en(Oe,Me,Ke,Pe,Xe,1),zh(Pe,Xe,0,Ke,1,0);break;case Rp:en(Oe,Me,Ke,Pe,Xe,0);break;case Zd:en(Oe,Me,Ke,Pe,Xe,0),zh(Pe,Xe,1,Ke,1,0);break;case Kd:Pc(Oe,Me,Ke,Pe,Xe);break;case Dg:Pc(Oe,Me,Ke,Pe,Xe),Co(Pe,Xe,Ke,1,0);break;case $u:Zl(Oe,Me,Ke,Pe,Xe);break;default:e(0)}le+=ue,Te+=ze}_.Ma+=te}else alert("todo:EmitRescaledRowsYUVA");e(_.Ma<=L.height)}}_.C=N,e(_.C<=_.i)}function Cs(_){var N;if(0<_.ua)return 0;for(N=0;N<_.Wb;++N){var L=_.Ya[N].G,V=_.Ya[N].H;if(0<L[1][V[1]+0].g||0<L[2][V[2]+0].g||0<L[3][V[3]+0].g)return 0}return 1}function Zs(_,N,L,V,Z,te){if(_.Z!=0){var se=_.qd,le=_.rd;for(e(jc[_.Z]!=null);N<L;++N)jc[_.Z](se,le,V,Z,V,Z,te),se=V,le=Z,Z+=te;_.qd=se,_.rd=le}}function Pi(_,N){var L=_.l.ma,V=L.Z==0||L.Z==1?_.l.j:_.C;if(V=_.C<V?V:_.C,e(N<=_.l.o),N>V){var Z=_.l.width,te=L.ca,se=L.tb+Z*V,le=_.V,ue=_.Ba+_.c*V,pe=_.gc;e(_.ab==1),e(pe[0].hc==3),Kl(pe[0],V,N,le,ue,te,se),Zs(L,V,N,te,se,Z)}_.C=_.Ma=N}function ja(_,N,L,V,Z,te,se){var le=_.$/V,ue=_.$%V,pe=_.m,Te=_.s,ze=L+_.$,fe=ze;Z=L+V*Z;var Oe=L+V*te,Me=280+Te.ua,Ke=_.Pb?le:16777216,Pe=0<Te.ua?Te.Wa:null,Xe=Te.wc,Qe=ze<Oe?ii(Te,ue,le):null;e(_.C<te),e(Oe<=Z);var ht=!1;e:for(;;){for(;ht||ze<Oe;){var st=0;if(le>=Ke){var Ft=ze-L;e((Ke=_).Pb),Ke.wd=Ke.m,Ke.xd=Ft,0<Ke.s.ua&&rt(Ke.s.Wa,Ke.s.vb),Ke=le+Ru}if(ue&Xe||(Qe=ii(Te,ue,le)),e(Qe!=null),Qe.Qb&&(N[ze]=Qe.qb,ht=!0),!ht)if(ge(pe),Qe.jc){st=pe,Ft=N;var Ct=ze,vn=Qe.pd[J(st)&Du-1];e(Qe.jc),256>vn.g?(de(st,st.u+vn.g),Ft[Ct]=vn.value,st=0):(de(st,st.u+vn.g-256),e(256<=vn.value),st=vn.value),st==0&&(ht=!0)}else st=Xs(Qe.G[0],Qe.H[0],pe);if(pe.h)break;if(ht||256>st){if(!ht)if(Qe.nd)N[ze]=(Qe.qb|st<<8)>>>0;else{if(ge(pe),ht=Xs(Qe.G[1],Qe.H[1],pe),ge(pe),Ft=Xs(Qe.G[2],Qe.H[2],pe),Ct=Xs(Qe.G[3],Qe.H[3],pe),pe.h)break;N[ze]=(Ct<<24|ht<<16|st<<8|Ft)>>>0}if(ht=!1,++ze,++ue>=V&&(ue=0,++le,se!=null&&le<=te&&!(le%16)&&se(_,le),Pe!=null))for(;fe<ze;)st=N[fe++],Pe.X[(506832829*st&4294967295)>>>Pe.Mb]=st}else if(280>st){if(st=za(st-256,pe),Ft=Xs(Qe.G[4],Qe.H[4],pe),ge(pe),Ft=Ba(V,Ft=za(Ft,pe)),pe.h)break;if(ze-L<Ft||Z-ze<st)break e;for(Ct=0;Ct<st;++Ct)N[ze+Ct]=N[ze+Ct-Ft];for(ze+=st,ue+=st;ue>=V;)ue-=V,++le,se!=null&&le<=te&&!(le%16)&&se(_,le);if(e(ze<=Z),ue&Xe&&(Qe=ii(Te,ue,le)),Pe!=null)for(;fe<ze;)st=N[fe++],Pe.X[(506832829*st&4294967295)>>>Pe.Mb]=st}else{if(!(st<Me))break e;for(ht=st-280,e(Pe!=null);fe<ze;)st=N[fe++],Pe.X[(506832829*st&4294967295)>>>Pe.Mb]=st;st=ze,e(!(ht>>>(Ft=Pe).Xa)),N[st]=Ft.X[ht],ht=!0}ht||e(pe.h==oe(pe))}if(_.Pb&&pe.h&&ze<Z)e(_.m.h),_.a=5,_.m=_.wd,_.$=_.xd,0<_.s.ua&&rt(_.s.vb,_.s.Wa);else{if(pe.h)break e;se?.(_,le>te?te:le),_.a=0,_.$=ze-L}return 1}return _.a=3,0}function vo(_){e(_!=null),_.vc=null,_.yc=null,_.Ya=null;var N=_.Wa;N!=null&&(N.X=null),_.vb=null,e(_!=null)}function Ah(){var _=new hn;return _==null?null:(_.a=0,_.xb=Vy,Is("Predictor","VP8LPredictors"),Is("Predictor","VP8LPredictors_C"),Is("PredictorAdd","VP8LPredictorsAdd"),Is("PredictorAdd","VP8LPredictorsAdd_C"),wr=cn,Xd=fn,Yd=Ks,Mc=Cn,Pc=Qt,Zl=un,Mh=Un,R.VP8LMapColor32b=Yl,R.VP8LMapColor8b=Si,_)}function el(_,N,L,V,Z){var te=1,se=[_],le=[N],ue=V.m,pe=V.s,Te=null,ze=0;e:for(;;){if(L)for(;te&&Y(ue,1);){var fe=se,Oe=le,Me=V,Ke=1,Pe=Me.m,Xe=Me.gc[Me.ab],Qe=Y(Pe,2);if(Me.Oc&1<<Qe)te=0;else{switch(Me.Oc|=1<<Qe,Xe.hc=Qe,Xe.Ea=fe[0],Xe.nc=Oe[0],Xe.K=[null],++Me.ab,e(4>=Me.ab),Qe){case 0:case 1:Xe.b=Y(Pe,3)+2,Ke=el(nt(Xe.Ea,Xe.b),nt(Xe.nc,Xe.b),0,Me,Xe.K),Xe.K=Xe.K[0];break;case 3:var ht,st=Y(Pe,8)+1,Ft=16<st?0:4<st?1:2<st?2:3;if(fe[0]=nt(Xe.Ea,Ft),Xe.b=Ft,ht=Ke=el(st,1,0,Me,Xe.K)){var Ct,vn=st,Ot=Xe,Vn=1<<(8>>Ot.b),js=a(Vn);if(js==null)ht=0;else{var kn=Ot.K[0],_t=Ot.w;for(js[0]=Ot.K[0][0],Ct=1;Ct<1*vn;++Ct)js[Ct]=xt(kn[_t+Ct],js[Ct-1]);for(;Ct<4*Vn;++Ct)js[Ct]=0;Ot.K[0]=null,Ot.K[0]=js,ht=1}}Ke=ht;break;case 2:break;default:e(0)}te=Ke}}if(se=se[0],le=le[0],te&&Y(ue,1)&&!(te=1<=(ze=Y(ue,4))&&11>=ze)){V.a=3;break e}var mt;if(mt=te)t:{var Qs,an,En,gs=V,Hr=se,Ni=le,$s=ze,Er=L,Ui=gs.m,Ir=gs.s,Pn=[null],rs=1,er=0,hs=No[$s];n:for(;;){if(Er&&Y(Ui,1)){var Gr=Y(Ui,3)+2,tr=nt(Hr,Gr),is=nt(Ni,Gr),Cr=tr*is;if(!el(tr,is,0,gs,Pn))break n;for(Pn=Pn[0],Ir.xc=Gr,Qs=0;Qs<Cr;++Qs){var ys=Pn[Qs]>>8&65535;Pn[Qs]=ys,ys>=rs&&(rs=ys+1)}}if(Ui.h)break n;for(an=0;5>an;++an){var Or=jh[an];!an&&0<$s&&(Or+=1<<$s),er<Or&&(er=Or)}var Dr=o(rs*hs,H),_s=rs,ns=o(_s,re);if(ns==null)var Vi=null;else e(65536>=_s),Vi=ns;var lr=a(er);if(Vi==null||lr==null||Dr==null){gs.a=1;break n}var Zt=Dr;for(Qs=En=0;Qs<rs;++Qs){var tn=Vi[Qs],as=tn.G,va=tn.H,Oo=0,ha=1,$r=0;for(an=0;5>an;++an){Or=jh[an],as[an]=Zt,va[an]=En,!an&&0<$s&&(Or+=1<<$s);r:{var Bu,ju=Or,zg=gs,Rs=lr,Hy=Zt,Gy=En,Bg=0,Uc=zg.m,PN=Y(Uc,1);if(r(Rs,0,0,ju),PN){var qy=Y(Uc,1)+1,Xy=Y(Uc,1),jg=Y(Uc,Xy==0?1:8);Rs[jg]=1,qy==2&&(Rs[jg=Y(Uc,8)]=1);var li=1}else{var cr=a(19),zp=Y(Uc,4)+4;if(19<zp){zg.a=3;var Uu=0;break r}for(Bu=0;Bu<zp;++Bu)cr[Fp[Bu]]=Y(Uc,3);var nf=void 0,Wh=void 0,ec=zg,Ug=cr,sf=ju,Vg=Rs,Wg=0,Vc=ec.m,Yy=8,Ky=o(128,H);s:for(;j(Ky,0,7,Ug,19);){if(Y(Vc,1)){var vx=2+2*Y(Vc,3);if((nf=2+Y(Vc,vx))>sf)break s}else nf=sf;for(Wh=0;Wh<sf&&nf--;){ge(Vc);var Zy=Ky[0+(127&J(Vc))];de(Vc,Vc.u+Zy.g);var Vu=Zy.value;if(16>Vu)Vg[Wh++]=Vu,Vu!=0&&(Yy=Vu);else{var wx=Vu==16,xx=Vu-16,Sx=Jd[xx],Jy=Y(Vc,ko[xx])+Sx;if(Wh+Jy>sf)break s;for(var Cx=wx?Yy:0;0<Jy--;)Vg[Wh++]=Cx}}Wg=1;break s}Wg||(ec.a=3),li=Wg}(li=li&&!Uc.h)&&(Bg=j(Hy,Gy,8,Rs,ju)),li&&Bg!=0?Uu=Bg:(zg.a=3,Uu=0)}if(Uu==0)break n;if(ha&&$g[an]==1&&(ha=Zt[En].g==0),Oo+=Zt[En].g,En+=Uu,3>=an){var Hh,Hg=lr[0];for(Hh=1;Hh<Or;++Hh)lr[Hh]>Hg&&(Hg=lr[Hh]);$r+=Hg}}if(tn.nd=ha,tn.Qb=0,ha&&(tn.qb=(as[3][va[3]+0].value<<24|as[1][va[1]+0].value<<16|as[2][va[2]+0].value)>>>0,Oo==0&&256>as[0][va[0]+0].value&&(tn.Qb=1,tn.qb+=as[0][va[0]+0].value<<8)),tn.jc=!tn.Qb&&6>$r,tn.jc){var Bp,tc=tn;for(Bp=0;Bp<Du;++Bp){var Wc=Bp,Hc=tc.pd[Wc],Gg=tc.G[0][tc.H[0]+Wc];256<=Gg.value?(Hc.g=Gg.g+256,Hc.value=Gg.value):(Hc.g=0,Hc.value=0,Wc>>=Tr(Gg,8,Hc),Wc>>=Tr(tc.G[1][tc.H[1]+Wc],16,Hc),Wc>>=Tr(tc.G[2][tc.H[2]+Wc],0,Hc),Tr(tc.G[3][tc.H[3]+Wc],24,Hc))}}}Ir.vc=Pn,Ir.Wb=rs,Ir.Ya=Vi,Ir.yc=Dr,mt=1;break t}mt=0}if(!(te=mt)){V.a=3;break e}if(0<ze){if(pe.ua=1<<ze,!ce(pe.Wa,ze)){V.a=1,te=0;break e}}else pe.ua=0;var qg=V,Gh=se,_x=le,rf=qg.s,af=rf.xc;if(qg.c=Gh,qg.i=_x,rf.md=nt(Gh,af),rf.wc=af==0?-1:(1<<af)-1,L){V.xb=Lu;break e}if((Te=a(se*le))==null){V.a=1,te=0;break e}te=(te=ja(V,Te,0,se,le,le,null))&&!ue.h;break e}return te?(Z!=null?Z[0]=Te:(e(Te==null),e(L)),V.$=0,L||vo(pe)):vo(pe),te}function tl(_,N){var L=_.c*_.i,V=L+N+16*N;return e(_.c<=N),_.V=a(V),_.V==null?(_.Ta=null,_.Ua=0,_.a=1,0):(_.Ta=_.V,_.Ua=_.Ba+L+N,1)}function Nu(_,N){var L=_.C,V=N-L,Z=_.V,te=_.Ba+_.c*L;for(e(N<=_.l.o);0<V;){var se=16<V?16:V,le=_.l.ma,ue=_.l.width,pe=ue*se,Te=le.ca,ze=le.tb+ue*L,fe=_.Ta,Oe=_.Ua;Tu(_,se,Z,te),Xa(fe,Oe,Te,ze,pe),Zs(le,L,L+se,Te,ze,ue),V-=se,Z+=se*_.c,L+=se}e(L==N),_.C=_.Ma=N}function nl(){this.ub=this.yd=this.td=this.Rb=0}function sl(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Eh(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function jl(){this.Yb=(function(){var _=[];return(function N(L,V,Z){for(var te=Z[V],se=0;se<te&&(L.push(Z.length>V+1?[]:0),!(Z.length<V+1));se++)N(L[se],V+1,Z)})(_,0,[3,11]),_})()}function br(){this.jb=a(3),this.Wc=l([4,8],jl),this.Xc=l([4,17],jl)}function dp(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function Ua(){this.ld=this.La=this.dd=this.tc=0}function rl(){this.Na=this.la=0}function xc(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function fp(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function pp(){this.uc=this.M=this.Nb=0,this.wa=Array(new Ua),this.Y=0,this.ya=Array(new fp),this.aa=0,this.l=new Sc}function mp(){this.y=a(16),this.f=a(8),this.ea=a(8)}function gg(){this.cb=this.a=0,this.sc="",this.m=new B,this.Od=new nl,this.Kc=new sl,this.ed=new dp,this.Qa=new Eh,this.Ic=this.$c=this.Aa=0,this.D=new pp,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,B),this.ia=0,this.pb=o(4,xc),this.Pa=new br,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new mp),this.Hd=0,this.rb=Array(new rl),this.sb=0,this.wa=Array(new Ua),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new fp),this.L=this.aa=0,this.gd=l([4,2],Ua),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Va(_,N){return 0>_?0:_>N?N:_}function Sc(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function il(){var _=new gg;return _!=null&&(_.a=0,_.sc="OK",_.cb=0,_.Xb=0,Ya||(Ya=Au)),_}function cs(_,N,L){return _.a==0&&(_.a=N,_.sc=L,_.cb=0),0}function gp(_,N,L){return 3<=L&&_[N+0]==157&&_[N+1]==1&&_[N+2]==42}function Ul(_,N){if(_==null)return 0;if(_.a=0,_.sc="OK",N==null)return cs(_,2,"null VP8Io passed to VP8GetHeaders()");var L=N.data,V=N.w,Z=N.ha;if(4>Z)return cs(_,7,"Truncated header.");var te=L[V+0]|L[V+1]<<8|L[V+2]<<16,se=_.Od;if(se.Rb=!(1&te),se.td=te>>1&7,se.yd=te>>4&1,se.ub=te>>5,3<se.td)return cs(_,3,"Incorrect keyframe parameters.");if(!se.yd)return cs(_,4,"Frame not displayable.");V+=3,Z-=3;var le=_.Kc;if(se.Rb){if(7>Z)return cs(_,7,"cannot parse picture header");if(!gp(L,V,Z))return cs(_,3,"Bad code word");le.c=16383&(L[V+4]<<8|L[V+3]),le.Td=L[V+4]>>6,le.i=16383&(L[V+6]<<8|L[V+5]),le.Ud=L[V+6]>>6,V+=7,Z-=7,_.za=le.c+15>>4,_.Ub=le.i+15>>4,N.width=le.c,N.height=le.i,N.Da=0,N.j=0,N.v=0,N.va=N.width,N.o=N.height,N.da=0,N.ib=N.width,N.hb=N.height,N.U=N.width,N.T=N.height,r((te=_.Pa).jb,0,255,te.jb.length),e((te=_.Qa)!=null),te.Cb=0,te.Bb=0,te.Fb=1,r(te.Zb,0,0,te.Zb.length),r(te.Lb,0,0,te.Lb)}if(se.ub>Z)return cs(_,7,"bad partition length");X(te=_.m,L,V,se.ub),V+=se.ub,Z-=se.ub,se.Rb&&(le.Ld=Ce(te),le.Kd=Ce(te)),le=_.Qa;var ue,pe=_.Pa;if(e(te!=null),e(le!=null),le.Cb=Ce(te),le.Cb){if(le.Bb=Ce(te),Ce(te)){for(le.Fb=Ce(te),ue=0;4>ue;++ue)le.Zb[ue]=Ce(te)?Q(te,7):0;for(ue=0;4>ue;++ue)le.Lb[ue]=Ce(te)?Q(te,6):0}if(le.Bb)for(ue=0;3>ue;++ue)pe.jb[ue]=Ce(te)?ne(te,8):255}else le.Bb=0;if(te.Ka)return cs(_,3,"cannot parse segment header");if((le=_.ed).zd=Ce(te),le.Tb=ne(te,6),le.wb=ne(te,3),le.Pc=Ce(te),le.Pc&&Ce(te)){for(pe=0;4>pe;++pe)Ce(te)&&(le.vd[pe]=Q(te,6));for(pe=0;4>pe;++pe)Ce(te)&&(le.od[pe]=Q(te,6))}if(_.L=le.Tb==0?0:le.zd?1:2,te.Ka)return cs(_,3,"cannot parse filter header");var Te=Z;if(Z=ue=V,V=ue+Te,le=Te,_.Xb=(1<<ne(_.m,2))-1,Te<3*(pe=_.Xb))L=7;else{for(ue+=3*pe,le-=3*pe,Te=0;Te<pe;++Te){var ze=L[Z+0]|L[Z+1]<<8|L[Z+2]<<16;ze>le&&(ze=le),X(_.Jc[+Te],L,ue,ze),ue+=ze,le-=ze,Z+=3}X(_.Jc[+pe],L,ue,le),L=ue<V?0:5}if(L!=0)return cs(_,L,"cannot parse partitions");for(L=ne(ue=_.m,7),Z=Ce(ue)?Q(ue,4):0,V=Ce(ue)?Q(ue,4):0,le=Ce(ue)?Q(ue,4):0,pe=Ce(ue)?Q(ue,4):0,ue=Ce(ue)?Q(ue,4):0,Te=_.Qa,ze=0;4>ze;++ze){if(Te.Cb){var fe=Te.Zb[ze];Te.Fb||(fe+=L)}else{if(0<ze){_.pb[ze]=_.pb[0];continue}fe=L}var Oe=_.pb[ze];Oe.Sc[0]=Ao[Va(fe+Z,127)],Oe.Sc[1]=Eo[Va(fe+0,127)],Oe.Eb[0]=2*Ao[Va(fe+V,127)],Oe.Eb[1]=101581*Eo[Va(fe+le,127)]>>16,8>Oe.Eb[1]&&(Oe.Eb[1]=8),Oe.Qc[0]=Ao[Va(fe+pe,117)],Oe.Qc[1]=Eo[Va(fe+ue,127)],Oe.lc=fe+ue}if(!se.Rb)return cs(_,4,"Not a key frame.");for(Ce(te),se=_.Pa,L=0;4>L;++L){for(Z=0;8>Z;++Z)for(V=0;3>V;++V)for(le=0;11>le;++le)pe=Fe(te,Bs[L][Z][V][le])?ne(te,8):yx[L][Z][V][le],se.Wc[L][Z].Yb[V][le]=pe;for(Z=0;17>Z;++Z)se.Xc[L][Z]=se.Wc[L][Hn[Z]]}return _.kc=Ce(te),_.kc&&(_.Bd=ne(te,8)),_.cb=1}function Au(_,N,L,V,Z,te,se){var le=N[Z].Yb[L];for(L=0;16>Z;++Z){if(!Fe(_,le[L+0]))return Z;for(;!Fe(_,le[L+1]);)if(le=N[++Z].Yb[0],L=0,Z==16)return 16;var ue=N[Z+1].Yb;if(Fe(_,le[L+2])){var pe=_,Te=0;if(Fe(pe,(fe=le)[(ze=L)+3]))if(Fe(pe,fe[ze+6])){for(le=0,ze=2*(Te=Fe(pe,fe[ze+8]))+(fe=Fe(pe,fe[ze+9+Te])),Te=0,fe=gx[ze];fe[le];++le)Te+=Te+Fe(pe,fe[le]);Te+=3+(8<<ze)}else Fe(pe,fe[ze+7])?(Te=7+2*Fe(pe,165),Te+=Fe(pe,145)):Te=5+Fe(pe,159);else Te=Fe(pe,fe[ze+4])?3+Fe(pe,fe[ze+5]):2;le=ue[2]}else Te=1,le=ue[1];ue=se+Uy[Z],0>(pe=_).b&&Ae(pe);var ze,fe=pe.b,Oe=(ze=pe.Ca>>1)-(pe.I>>fe)>>31;--pe.b,pe.Ca+=Oe,pe.Ca|=1,pe.I-=(ze+1&Oe)<<fe,te[ue]=((Te^Oe)-Oe)*V[(0<Z)+0]}return 16}function yp(_){var N=_.rb[_.sb-1];N.la=0,N.Na=0,r(_.zc,0,0,_.zc.length),_.ja=0}function aa(_,N,L,V,Z){Z=_[N+L+32*V]+(Z>>3),_[N+L+32*V]=-256&Z?0>Z?0:255:Z}function Vr(_,N,L,V,Z,te){aa(_,N,0,L,V+Z),aa(_,N,1,L,V+te),aa(_,N,2,L,V-te),aa(_,N,3,L,V-Z)}function Nr(_){return(20091*_>>16)+_}function zd(_,N,L,V){var Z,te=0,se=a(16);for(Z=0;4>Z;++Z){var le=_[N+0]+_[N+8],ue=_[N+0]-_[N+8],pe=(35468*_[N+4]>>16)-Nr(_[N+12]),Te=Nr(_[N+4])+(35468*_[N+12]>>16);se[te+0]=le+Te,se[te+1]=ue+pe,se[te+2]=ue-pe,se[te+3]=le-Te,te+=4,N++}for(Z=te=0;4>Z;++Z)le=(_=se[te+0]+4)+se[te+8],ue=_-se[te+8],pe=(35468*se[te+4]>>16)-Nr(se[te+12]),aa(L,V,0,0,le+(Te=Nr(se[te+4])+(35468*se[te+12]>>16))),aa(L,V,1,0,ue+pe),aa(L,V,2,0,ue-pe),aa(L,V,3,0,le-Te),te++,V+=32}function yg(_,N,L,V){var Z=_[N+0]+4,te=35468*_[N+4]>>16,se=Nr(_[N+4]),le=35468*_[N+1]>>16;Vr(L,V,0,Z+se,_=Nr(_[N+1]),le),Vr(L,V,1,Z+te,_,le),Vr(L,V,2,Z-te,_,le),Vr(L,V,3,Z-se,_,le)}function bp(_,N,L,V,Z){zd(_,N,L,V),Z&&zd(_,N+16,L,V+4)}function oa(_,N,L,V){zc(_,N+0,L,V,1),zc(_,N+32,L,V+128,1)}function vp(_,N,L,V){var Z;for(_=_[N+0]+4,Z=0;4>Z;++Z)for(N=0;4>N;++N)aa(L,V,N,Z,_)}function wp(_,N,L,V){_[N+0]&&us(_,N+0,L,V),_[N+16]&&us(_,N+16,L,V+4),_[N+32]&&us(_,N+32,L,V+128),_[N+48]&&us(_,N+48,L,V+128+4)}function al(_,N,L,V){var Z,te=a(16);for(Z=0;4>Z;++Z){var se=_[N+0+Z]+_[N+12+Z],le=_[N+4+Z]+_[N+8+Z],ue=_[N+4+Z]-_[N+8+Z],pe=_[N+0+Z]-_[N+12+Z];te[0+Z]=se+le,te[8+Z]=se-le,te[4+Z]=pe+ue,te[12+Z]=pe-ue}for(Z=0;4>Z;++Z)se=(_=te[0+4*Z]+3)+te[3+4*Z],le=te[1+4*Z]+te[2+4*Z],ue=te[1+4*Z]-te[2+4*Z],pe=_-te[3+4*Z],L[V+0]=se+le>>3,L[V+16]=pe+ue>>3,L[V+32]=se-le>>3,L[V+48]=pe-ue>>3,V+=64}function Ih(_,N,L){var V,Z=N-32,te=Bi,se=255-_[Z-1];for(V=0;V<L;++V){var le,ue=te,pe=se+_[N-1];for(le=0;le<L;++le)_[N+le]=ue[pe+_[Z+le]];N+=32}}function bg(_,N){Ih(_,N,4)}function vg(_,N){Ih(_,N,8)}function xp(_,N){Ih(_,N,16)}function Sp(_,N){var L;for(L=0;16>L;++L)s(_,N+32*L,_,N-32,16)}function wg(_,N){var L;for(L=16;0<L;--L)r(_,N,_[N-1],16),N+=32}function ya(_,N,L){var V;for(V=0;16>V;++V)r(N,L+32*V,_,16)}function ol(_,N){var L,V=16;for(L=0;16>L;++L)V+=_[N-1+32*L]+_[N+L-32];ya(V>>5,_,N)}function Cc(_,N){var L,V=8;for(L=0;16>L;++L)V+=_[N-1+32*L];ya(V>>4,_,N)}function Oh(_,N){var L,V=8;for(L=0;16>L;++L)V+=_[N+L-32];ya(V>>4,_,N)}function Eu(_,N){ya(128,_,N)}function rn(_,N,L){return _+2*N+L+2>>2}function xg(_,N){var L,V=N-32;for(V=new Uint8Array([rn(_[V-1],_[V+0],_[V+1]),rn(_[V+0],_[V+1],_[V+2]),rn(_[V+1],_[V+2],_[V+3]),rn(_[V+2],_[V+3],_[V+4])]),L=0;4>L;++L)s(_,N+32*L,V,0,V.length)}function Cp(_,N){var L=_[N-1],V=_[N-1+32],Z=_[N-1+64],te=_[N-1+96];Ge(_,N+0,16843009*rn(_[N-1-32],L,V)),Ge(_,N+32,16843009*rn(L,V,Z)),Ge(_,N+64,16843009*rn(V,Z,te)),Ge(_,N+96,16843009*rn(Z,te,te))}function Sg(_,N){var L,V=4;for(L=0;4>L;++L)V+=_[N+L-32]+_[N-1+32*L];for(V>>=3,L=0;4>L;++L)r(_,N+32*L,V,4)}function Wa(_,N){var L=_[N-1+0],V=_[N-1+32],Z=_[N-1+64],te=_[N-1-32],se=_[N+0-32],le=_[N+1-32],ue=_[N+2-32],pe=_[N+3-32];_[N+0+96]=rn(V,Z,_[N-1+96]),_[N+1+96]=_[N+0+64]=rn(L,V,Z),_[N+2+96]=_[N+1+64]=_[N+0+32]=rn(te,L,V),_[N+3+96]=_[N+2+64]=_[N+1+32]=_[N+0+0]=rn(se,te,L),_[N+3+64]=_[N+2+32]=_[N+1+0]=rn(le,se,te),_[N+3+32]=_[N+2+0]=rn(ue,le,se),_[N+3+0]=rn(pe,ue,le)}function wi(_,N){var L=_[N+1-32],V=_[N+2-32],Z=_[N+3-32],te=_[N+4-32],se=_[N+5-32],le=_[N+6-32],ue=_[N+7-32];_[N+0+0]=rn(_[N+0-32],L,V),_[N+1+0]=_[N+0+32]=rn(L,V,Z),_[N+2+0]=_[N+1+32]=_[N+0+64]=rn(V,Z,te),_[N+3+0]=_[N+2+32]=_[N+1+64]=_[N+0+96]=rn(Z,te,se),_[N+3+32]=_[N+2+64]=_[N+1+96]=rn(te,se,le),_[N+3+64]=_[N+2+96]=rn(se,le,ue),_[N+3+96]=rn(le,ue,ue)}function _p(_,N){var L=_[N-1+0],V=_[N-1+32],Z=_[N-1+64],te=_[N-1-32],se=_[N+0-32],le=_[N+1-32],ue=_[N+2-32],pe=_[N+3-32];_[N+0+0]=_[N+1+64]=te+se+1>>1,_[N+1+0]=_[N+2+64]=se+le+1>>1,_[N+2+0]=_[N+3+64]=le+ue+1>>1,_[N+3+0]=ue+pe+1>>1,_[N+0+96]=rn(Z,V,L),_[N+0+64]=rn(V,L,te),_[N+0+32]=_[N+1+96]=rn(L,te,se),_[N+1+32]=_[N+2+96]=rn(te,se,le),_[N+2+32]=_[N+3+96]=rn(se,le,ue),_[N+3+32]=rn(le,ue,pe)}function Dh(_,N){var L=_[N+0-32],V=_[N+1-32],Z=_[N+2-32],te=_[N+3-32],se=_[N+4-32],le=_[N+5-32],ue=_[N+6-32],pe=_[N+7-32];_[N+0+0]=L+V+1>>1,_[N+1+0]=_[N+0+64]=V+Z+1>>1,_[N+2+0]=_[N+1+64]=Z+te+1>>1,_[N+3+0]=_[N+2+64]=te+se+1>>1,_[N+0+32]=rn(L,V,Z),_[N+1+32]=_[N+0+96]=rn(V,Z,te),_[N+2+32]=_[N+1+96]=rn(Z,te,se),_[N+3+32]=_[N+2+96]=rn(te,se,le),_[N+3+64]=rn(se,le,ue),_[N+3+96]=rn(le,ue,pe)}function Ha(_,N){var L=_[N-1+0],V=_[N-1+32],Z=_[N-1+64],te=_[N-1+96];_[N+0+0]=L+V+1>>1,_[N+2+0]=_[N+0+32]=V+Z+1>>1,_[N+2+32]=_[N+0+64]=Z+te+1>>1,_[N+1+0]=rn(L,V,Z),_[N+3+0]=_[N+1+32]=rn(V,Z,te),_[N+3+32]=_[N+1+64]=rn(Z,te,te),_[N+3+64]=_[N+2+64]=_[N+0+96]=_[N+1+96]=_[N+2+96]=_[N+3+96]=te}function $h(_,N){var L=_[N-1+0],V=_[N-1+32],Z=_[N-1+64],te=_[N-1+96],se=_[N-1-32],le=_[N+0-32],ue=_[N+1-32],pe=_[N+2-32];_[N+0+0]=_[N+2+32]=L+se+1>>1,_[N+0+32]=_[N+2+64]=V+L+1>>1,_[N+0+64]=_[N+2+96]=Z+V+1>>1,_[N+0+96]=te+Z+1>>1,_[N+3+0]=rn(le,ue,pe),_[N+2+0]=rn(se,le,ue),_[N+1+0]=_[N+3+32]=rn(L,se,le),_[N+1+32]=_[N+3+64]=rn(V,L,se),_[N+1+64]=_[N+3+96]=rn(Z,V,L),_[N+1+96]=rn(te,Z,V)}function Vl(_,N){var L;for(L=0;8>L;++L)s(_,N+32*L,_,N-32,8)}function Cg(_,N){var L;for(L=0;8>L;++L)r(_,N,_[N-1],8),N+=32}function wo(_,N,L){var V;for(V=0;8>V;++V)r(N,L+32*V,_,8)}function Bd(_,N){var L,V=8;for(L=0;8>L;++L)V+=_[N+L-32]+_[N-1+32*L];wo(V>>4,_,N)}function jd(_,N){var L,V=4;for(L=0;8>L;++L)V+=_[N+L-32];wo(V>>3,_,N)}function ai(_,N){var L,V=4;for(L=0;8>L;++L)V+=_[N-1+32*L];wo(V>>3,_,N)}function Wl(_,N){wo(128,_,N)}function xo(_,N,L){var V=_[N-L],Z=_[N+0],te=3*(Z-V)+Bc[1020+_[N-2*L]-_[N+L]],se=$p[112+(te+4>>3)];_[N-L]=Bi[255+V+$p[112+(te+3>>3)]],_[N+0]=Bi[255+Z-se]}function _c(_,N,L,V){var Z=_[N+0],te=_[N+L];return Ci[255+_[N-2*L]-_[N-L]]>V||Ci[255+te-Z]>V}function Ud(_,N,L,V){return 4*Ci[255+_[N-L]-_[N+0]]+Ci[255+_[N-2*L]-_[N+L]]<=V}function Rh(_,N,L,V,Z){var te=_[N-3*L],se=_[N-2*L],le=_[N-L],ue=_[N+0],pe=_[N+L],Te=_[N+2*L],ze=_[N+3*L];return 4*Ci[255+le-ue]+Ci[255+se-pe]>V?0:Ci[255+_[N-4*L]-te]<=Z&&Ci[255+te-se]<=Z&&Ci[255+se-le]<=Z&&Ci[255+ze-Te]<=Z&&Ci[255+Te-pe]<=Z&&Ci[255+pe-ue]<=Z}function kc(_,N,L,V){var Z=2*V+1;for(V=0;16>V;++V)Ud(_,N+V,L,Z)&&xo(_,N+V,L)}function Tc(_,N,L,V){var Z=2*V+1;for(V=0;16>V;++V)Ud(_,N+V*L,1,Z)&&xo(_,N+V*L,1)}function Lh(_,N,L,V){var Z;for(Z=3;0<Z;--Z)kc(_,N+=4*L,L,V)}function kp(_,N,L,V){var Z;for(Z=3;0<Z;--Z)Tc(_,N+=4,L,V)}function Nc(_,N,L,V,Z,te,se,le){for(te=2*te+1;0<Z--;){if(Rh(_,N,L,te,se))if(_c(_,N,L,le))xo(_,N,L);else{var ue=_,pe=N,Te=L,ze=ue[pe-2*Te],fe=ue[pe-Te],Oe=ue[pe+0],Me=ue[pe+Te],Ke=ue[pe+2*Te],Pe=27*(Qe=Bc[1020+3*(Oe-fe)+Bc[1020+ze-Me]])+63>>7,Xe=18*Qe+63>>7,Qe=9*Qe+63>>7;ue[pe-3*Te]=Bi[255+ue[pe-3*Te]+Qe],ue[pe-2*Te]=Bi[255+ze+Xe],ue[pe-Te]=Bi[255+fe+Pe],ue[pe+0]=Bi[255+Oe-Pe],ue[pe+Te]=Bi[255+Me-Xe],ue[pe+2*Te]=Bi[255+Ke-Qe]}N+=V}}function Ac(_,N,L,V,Z,te,se,le){for(te=2*te+1;0<Z--;){if(Rh(_,N,L,te,se))if(_c(_,N,L,le))xo(_,N,L);else{var ue=_,pe=N,Te=L,ze=ue[pe-Te],fe=ue[pe+0],Oe=ue[pe+Te],Me=$p[112+(4+(Ke=3*(fe-ze))>>3)],Ke=$p[112+(Ke+3>>3)],Pe=Me+1>>1;ue[pe-2*Te]=Bi[255+ue[pe-2*Te]+Pe],ue[pe-Te]=Bi[255+ze+Ke],ue[pe+0]=Bi[255+fe-Me],ue[pe+Te]=Bi[255+Oe-Pe]}N+=V}}function _g(_,N,L,V,Z,te){Nc(_,N,L,1,16,V,Z,te)}function Ec(_,N,L,V,Z,te){Nc(_,N,1,L,16,V,Z,te)}function kg(_,N,L,V,Z,te){var se;for(se=3;0<se;--se)Ac(_,N+=4*L,L,1,16,V,Z,te)}function D(_,N,L,V,Z,te){var se;for(se=3;0<se;--se)Ac(_,N+=4,1,L,16,V,Z,te)}function K(_,N,L,V,Z,te,se,le){Nc(_,N,Z,1,8,te,se,le),Nc(L,V,Z,1,8,te,se,le)}function me(_,N,L,V,Z,te,se,le){Nc(_,N,1,Z,8,te,se,le),Nc(L,V,1,Z,8,te,se,le)}function xe(_,N,L,V,Z,te,se,le){Ac(_,N+4*Z,Z,1,8,te,se,le),Ac(L,V+4*Z,Z,1,8,te,se,le)}function De(_,N,L,V,Z,te,se,le){Ac(_,N+4,1,Z,8,te,se,le),Ac(L,V+4,1,Z,8,te,se,le)}function Je(){this.ba=new An,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Qn,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function it(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Dt(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function jt(){this.ua=0,this.Wa=new At,this.vb=new At,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new re,this.yc=new H}function hn(){this.xb=this.a=0,this.l=new Sc,this.ca=new An,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new G,this.Pb=0,this.wd=new G,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new jt,this.ab=0,this.gc=o(4,Dt),this.Oc=0}function _n(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Sc,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function es(_,N,L,V,Z,te,se){for(_=_==null?0:_[N+0],N=0;N<se;++N)Z[te+N]=_+L[V+N]&255,_=Z[te+N]}function Js(_,N,L,V,Z,te,se){var le;if(_==null)es(null,null,L,V,Z,te,se);else for(le=0;le<se;++le)Z[te+le]=_[N+le]+L[V+le]&255}function vr(_,N,L,V,Z,te,se){if(_==null)es(null,null,L,V,Z,te,se);else{var le,ue=_[N+0],pe=ue,Te=ue;for(le=0;le<se;++le)pe=Te+(ue=_[N+le])-pe,Te=L[V+le]+(-256&pe?0>pe?0:255:pe)&255,pe=ue,Z[te+le]=Te}}function Os(_,N,L,V){var Z=N.width,te=N.o;if(e(_!=null&&N!=null),0>L||0>=V||L+V>te)return null;if(!_.Cc){if(_.ga==null){var se;if(_.ga=new _n,(se=_.ga==null)||(se=N.width*N.o,e(_.Gb.length==0),_.Gb=a(se),_.Uc=0,_.Gb==null?se=0:(_.mb=_.Gb,_.nb=_.Uc,_.rc=null,se=1),se=!se),!se){se=_.ga;var le=_.Fa,ue=_.P,pe=_.qc,Te=_.mb,ze=_.nb,fe=ue+1,Oe=pe-1,Me=se.l;if(e(le!=null&&Te!=null&&N!=null),jc[0]=null,jc[1]=es,jc[2]=Js,jc[3]=vr,se.ca=Te,se.tb=ze,se.c=N.width,se.i=N.height,e(0<se.c&&0<se.i),1>=pe)N=0;else if(se.$a=3&le[ue+0],se.Z=le[ue+0]>>2&3,se.Lc=le[ue+0]>>4&3,ue=le[ue+0]>>6&3,0>se.$a||1<se.$a||4<=se.Z||1<se.Lc||ue)N=0;else if(Me.put=Kt,Me.ac=bo,Me.bc=wc,Me.ma=se,Me.width=N.width,Me.height=N.height,Me.Da=N.Da,Me.v=N.v,Me.va=N.va,Me.j=N.j,Me.o=N.o,se.$a)e:{e(se.$a==1),N=Ah();t:for(;;){if(N==null){N=0;break e}if(e(se!=null),se.mc=N,N.c=se.c,N.i=se.i,N.l=se.l,N.l.ma=se,N.l.width=se.c,N.l.height=se.i,N.a=0,he(N.m,le,fe,Oe),!el(se.c,se.i,1,N,null)||(N.ab==1&&N.gc[0].hc==3&&Cs(N.s)?(se.ic=1,le=N.c*N.i,N.Ta=null,N.Ua=0,N.V=a(le),N.Ba=0,N.V==null?(N.a=1,N=0):N=1):(se.ic=0,N=tl(N,se.c)),!N))break t;N=1;break e}se.mc=null,N=0}else N=Oe>=se.c*se.i;se=!N}if(se)return null;_.ga.Lc!=1?_.Ga=0:V=te-L}e(_.ga!=null),e(L+V<=te);e:{if(N=(le=_.ga).c,te=le.l.o,le.$a==0){if(fe=_.rc,Oe=_.Vc,Me=_.Fa,ue=_.P+1+L*N,pe=_.mb,Te=_.nb+L*N,e(ue<=_.P+_.qc),le.Z!=0)for(e(jc[le.Z]!=null),se=0;se<V;++se)jc[le.Z](fe,Oe,Me,ue,pe,Te,N),fe=pe,Oe=Te,Te+=N,ue+=N;else for(se=0;se<V;++se)s(pe,Te,Me,ue,N),fe=pe,Oe=Te,Te+=N,ue+=N;_.rc=fe,_.Vc=Oe}else{if(e(le.mc!=null),N=L+V,e((se=le.mc)!=null),e(N<=se.i),se.C>=N)N=1;else if(le.ic||ll(),le.ic){le=se.V,fe=se.Ba,Oe=se.c;var Ke=se.i,Pe=(Me=1,ue=se.$/Oe,pe=se.$%Oe,Te=se.m,ze=se.s,se.$),Xe=Oe*Ke,Qe=Oe*N,ht=ze.wc,st=Pe<Qe?ii(ze,pe,ue):null;e(Pe<=Xe),e(N<=Ke),e(Cs(ze));t:for(;;){for(;!Te.h&&Pe<Qe;){if(pe&ht||(st=ii(ze,pe,ue)),e(st!=null),ge(Te),256>(Ke=Xs(st.G[0],st.H[0],Te)))le[fe+Pe]=Ke,++Pe,++pe>=Oe&&(pe=0,++ue<=N&&!(ue%16)&&Pi(se,ue));else{if(!(280>Ke)){Me=0;break t}Ke=za(Ke-256,Te);var Ft,Ct=Xs(st.G[4],st.H[4],Te);if(ge(Te),!(Pe>=(Ct=Ba(Oe,Ct=za(Ct,Te)))&&Xe-Pe>=Ke)){Me=0;break t}for(Ft=0;Ft<Ke;++Ft)le[fe+Pe+Ft]=le[fe+Pe+Ft-Ct];for(Pe+=Ke,pe+=Ke;pe>=Oe;)pe-=Oe,++ue<=N&&!(ue%16)&&Pi(se,ue);Pe<Qe&&pe&ht&&(st=ii(ze,pe,ue))}e(Te.h==oe(Te))}Pi(se,ue>N?N:ue);break t}!Me||Te.h&&Pe<Xe?(Me=0,se.a=Te.h?5:3):se.$=Pe,N=Me}else N=ja(se,se.V,se.Ba,se.c,se.i,N,Nu);if(!N){V=0;break e}}L+V>=te&&(_.Cc=1),V=1}if(!V)return null;if(_.Cc&&((V=_.ga)!=null&&(V.mc=null),_.ga=null,0<_.Ga))return alert("todo:WebPDequantizeLevels"),null}return _.nb+L*Z}function Wr(_,N,L,V,Z,te){for(;0<Z--;){var se,le=_,ue=N+(L?1:0),pe=_,Te=N+(L?0:3);for(se=0;se<V;++se){var ze=pe[Te+4*se];ze!=255&&(ze*=32897,le[ue+4*se+0]=le[ue+4*se+0]*ze>>23,le[ue+4*se+1]=le[ue+4*se+1]*ze>>23,le[ue+4*se+2]=le[ue+4*se+2]*ze>>23)}N+=te}}function Ar(_,N,L,V,Z){for(;0<V--;){var te;for(te=0;te<L;++te){var se=_[N+2*te+0],le=15&(pe=_[N+2*te+1]),ue=4369*le,pe=(240&pe|pe>>4)*ue>>16;_[N+2*te+0]=(240&se|se>>4)*ue>>16&240|(15&se|se<<4)*ue>>16>>4&15,_[N+2*te+1]=240&pe|le}N+=Z}}function xi(_,N,L,V,Z,te,se,le){var ue,pe,Te=255;for(pe=0;pe<Z;++pe){for(ue=0;ue<V;++ue){var ze=_[N+ue];te[se+4*ue]=ze,Te&=ze}N+=L,se+=le}return Te!=255}function Ic(_,N,L,V,Z){var te;for(te=0;te<Z;++te)L[V+te]=_[N+te]>>8}function ll(){zh=Wr,Co=Ar,Ip=xi,Xa=Ic}function Oc(_,N,L){R[_]=function(V,Z,te,se,le,ue,pe,Te,ze,fe,Oe,Me,Ke,Pe,Xe,Qe,ht){var st,Ft=ht-1>>1,Ct=le[ue+0]|pe[Te+0]<<16,vn=ze[fe+0]|Oe[Me+0]<<16;e(V!=null);var Ot=3*Ct+vn+131074>>2;for(N(V[Z+0],255&Ot,Ot>>16,Ke,Pe),te!=null&&(Ot=3*vn+Ct+131074>>2,N(te[se+0],255&Ot,Ot>>16,Xe,Qe)),st=1;st<=Ft;++st){var Vn=le[ue+st]|pe[Te+st]<<16,js=ze[fe+st]|Oe[Me+st]<<16,kn=Ct+Vn+vn+js+524296,_t=kn+2*(Vn+vn)>>3;Ot=_t+Ct>>1,Ct=(kn=kn+2*(Ct+js)>>3)+Vn>>1,N(V[Z+2*st-1],255&Ot,Ot>>16,Ke,Pe+(2*st-1)*L),N(V[Z+2*st-0],255&Ct,Ct>>16,Ke,Pe+(2*st-0)*L),te!=null&&(Ot=kn+vn>>1,Ct=_t+js>>1,N(te[se+2*st-1],255&Ot,Ot>>16,Xe,Qe+(2*st-1)*L),N(te[se+2*st+0],255&Ct,Ct>>16,Xe,Qe+(2*st+0)*L)),Ct=Vn,vn=js}1&ht||(Ot=3*Ct+vn+131074>>2,N(V[Z+ht-1],255&Ot,Ot>>16,Ke,Pe+(ht-1)*L),te!=null&&(Ot=3*vn+Ct+131074>>2,N(te[se+ht-1],255&Ot,Ot>>16,Xe,Qe+(ht-1)*L)))}}function Tp(){ki[Eg]=Uh,ki[ji]=Qd,ki[Ig]=Wy,ki[_o]=Lg,ki[Rp]=Fu,ki[Kd]=Ql,ki[$u]=Mu,ki[Lp]=Qd,ki[Og]=Lg,ki[Zd]=Fu,ki[Dg]=Ql}function Vd(_){return _&-16384?0>_?0:255:_>>Fg}function Hl(_,N){return Vd((19077*_>>8)+(26149*N>>8)-14234)}function cl(_,N,L){return Vd((19077*_>>8)-(6419*N>>8)-(13320*L>>8)+8708)}function Fh(_,N){return Vd((19077*_>>8)+(33050*N>>8)-17685)}function Dc(_,N,L,V,Z){V[Z+0]=Hl(_,L),V[Z+1]=cl(_,N,L),V[Z+2]=Fh(_,N)}function oi(_,N,L,V,Z){V[Z+0]=Fh(_,N),V[Z+1]=cl(_,N,L),V[Z+2]=Hl(_,L)}function Iu(_,N,L,V,Z){var te=cl(_,N,L);N=te<<3&224|Fh(_,N)>>3,V[Z+0]=248&Hl(_,L)|te>>5,V[Z+1]=N}function Ou(_,N,L,V,Z){var te=240&Fh(_,N)|15;V[Z+0]=240&Hl(_,L)|cl(_,N,L)>>4,V[Z+1]=te}function Wd(_,N,L,V,Z){V[Z+0]=255,Dc(_,N,L,V,Z+1)}function Gl(_,N,L,V,Z){oi(_,N,L,V,Z),V[Z+3]=255}function la(_,N,L,V,Z){Dc(_,N,L,V,Z),V[Z+3]=255}function $c(_,N,L){R[_]=function(V,Z,te,se,le,ue,pe,Te,ze){for(var fe=Te+(-2&ze)*L;Te!=fe;)N(V[Z+0],te[se+0],le[ue+0],pe,Te),N(V[Z+1],te[se+0],le[ue+0],pe,Te+L),Z+=2,++se,++ue,Te+=2*L;1&ze&&N(V[Z+0],te[se+0],le[ue+0],pe,Te)}}function Hd(_,N,L){return L==0?_==0?N==0?6:5:N==0?4:0:L}function Np(_,N,L,V,Z){switch(_>>>30){case 3:zc(N,L,V,Z,0);break;case 2:zi(N,L,V,Z);break;case 1:us(N,L,V,Z)}}function Ga(_,N){var L,V,Z=N.M,te=N.Nb,se=_.oc,le=_.pc+40,ue=_.oc,pe=_.pc+584,Te=_.oc,ze=_.pc+600;for(L=0;16>L;++L)se[le+32*L-1]=129;for(L=0;8>L;++L)ue[pe+32*L-1]=129,Te[ze+32*L-1]=129;for(0<Z?se[le-1-32]=ue[pe-1-32]=Te[ze-1-32]=129:(r(se,le-32-1,127,21),r(ue,pe-32-1,127,9),r(Te,ze-32-1,127,9)),V=0;V<_.za;++V){var fe=N.ya[N.aa+V];if(0<V){for(L=-1;16>L;++L)s(se,le+32*L-4,se,le+32*L+12,4);for(L=-1;8>L;++L)s(ue,pe+32*L-4,ue,pe+32*L+4,4),s(Te,ze+32*L-4,Te,ze+32*L+4,4)}var Oe=_.Gd,Me=_.Hd+V,Ke=fe.ad,Pe=fe.Hc;if(0<Z&&(s(se,le-32,Oe[Me].y,0,16),s(ue,pe-32,Oe[Me].f,0,8),s(Te,ze-32,Oe[Me].ea,0,8)),fe.Za){var Xe=se,Qe=le-32+16;for(0<Z&&(V>=_.za-1?r(Xe,Qe,Oe[Me].y[15],4):s(Xe,Qe,Oe[Me+1].y,0,4)),L=0;4>L;L++)Xe[Qe+128+L]=Xe[Qe+256+L]=Xe[Qe+384+L]=Xe[Qe+0+L];for(L=0;16>L;++L,Pe<<=2)Xe=se,Qe=le+Sr[L],or[fe.Ob[L]](Xe,Qe),Np(Pe,Ke,16*+L,Xe,Qe)}else if(Xe=Hd(V,Z,fe.Ob[0]),ua[Xe](se,le),Pe!=0)for(L=0;16>L;++L,Pe<<=2)Np(Pe,Ke,16*+L,se,le+Sr[L]);for(L=fe.Gc,Xe=Hd(V,Z,fe.Dd),fl[Xe](ue,pe),fl[Xe](Te,ze),Pe=Ke,Xe=ue,Qe=pe,255&(fe=0|L)&&(170&fe?So(Pe,256,Xe,Qe):ts(Pe,256,Xe,Qe)),fe=Te,Pe=ze,255&(L>>=8)&&(170&L?So(Ke,320,fe,Pe):ts(Ke,320,fe,Pe)),Z<_.Ub-1&&(s(Oe[Me].y,0,se,le+480,16),s(Oe[Me].f,0,ue,pe+224,8),s(Oe[Me].ea,0,Te,ze+224,8)),L=8*te*_.B,Oe=_.sa,Me=_.ta+16*V+16*te*_.R,Ke=_.qa,fe=_.ra+8*V+L,Pe=_.Ha,Xe=_.Ia+8*V+L,L=0;16>L;++L)s(Oe,Me+L*_.R,se,le+32*L,16);for(L=0;8>L;++L)s(Ke,fe+L*_.B,ue,pe+32*L,8),s(Pe,Xe+L*_.B,Te,ze+32*L,8)}}function ul(_,N,L,V,Z,te,se,le,ue){var pe=[0],Te=[0],ze=0,fe=ue!=null?ue.kd:0,Oe=ue??new it;if(_==null||12>L)return 7;Oe.data=_,Oe.w=N,Oe.ha=L,N=[N],L=[L],Oe.gb=[Oe.gb];e:{var Me=N,Ke=L,Pe=Oe.gb;if(e(_!=null),e(Ke!=null),e(Pe!=null),Pe[0]=0,12<=Ke[0]&&!t(_,Me[0],"RIFF")){if(t(_,Me[0]+8,"WEBP")){Pe=3;break e}var Xe=pt(_,Me[0]+4);if(12>Xe||4294967286<Xe){Pe=3;break e}if(fe&&Xe>Ke[0]-8){Pe=7;break e}Pe[0]=Xe,Me[0]+=12,Ke[0]-=12}Pe=0}if(Pe!=0)return Pe;for(Xe=0<Oe.gb[0],L=L[0];;){e:{var Qe=_;Ke=N,Pe=L;var ht=pe,st=Te,Ft=Me=[0];if((Ot=ze=[ze])[0]=0,8>Pe[0])Pe=7;else{if(!t(Qe,Ke[0],"VP8X")){if(pt(Qe,Ke[0]+4)!=10){Pe=3;break e}if(18>Pe[0]){Pe=7;break e}var Ct=pt(Qe,Ke[0]+8),vn=1+ut(Qe,Ke[0]+12);if(2147483648<=vn*(Qe=1+ut(Qe,Ke[0]+15))){Pe=3;break e}Ft!=null&&(Ft[0]=Ct),ht!=null&&(ht[0]=vn),st!=null&&(st[0]=Qe),Ke[0]+=18,Pe[0]-=18,Ot[0]=1}Pe=0}}if(ze=ze[0],Me=Me[0],Pe!=0)return Pe;if(Ke=!!(2&Me),!Xe&&ze)return 3;if(te!=null&&(te[0]=!!(16&Me)),se!=null&&(se[0]=Ke),le!=null&&(le[0]=0),se=pe[0],Me=Te[0],ze&&Ke&&ue==null){Pe=0;break}if(4>L){Pe=7;break}if(Xe&&ze||!Xe&&!ze&&!t(_,N[0],"ALPH")){L=[L],Oe.na=[Oe.na],Oe.P=[Oe.P],Oe.Sa=[Oe.Sa];e:{Ct=_,Pe=N,Xe=L;var Ot=Oe.gb;ht=Oe.na,st=Oe.P,Ft=Oe.Sa,vn=22,e(Ct!=null),e(Xe!=null),Qe=Pe[0];var Vn=Xe[0];for(e(ht!=null),e(Ft!=null),ht[0]=null,st[0]=null,Ft[0]=0;;){if(Pe[0]=Qe,Xe[0]=Vn,8>Vn){Pe=7;break e}var js=pt(Ct,Qe+4);if(4294967286<js){Pe=3;break e}var kn=8+js+1&-2;if(vn+=kn,0<Ot&&vn>Ot){Pe=3;break e}if(!t(Ct,Qe,"VP8 ")||!t(Ct,Qe,"VP8L")){Pe=0;break e}if(Vn[0]<kn){Pe=7;break e}t(Ct,Qe,"ALPH")||(ht[0]=Ct,st[0]=Qe+8,Ft[0]=js),Qe+=kn,Vn-=kn}}if(L=L[0],Oe.na=Oe.na[0],Oe.P=Oe.P[0],Oe.Sa=Oe.Sa[0],Pe!=0)break}L=[L],Oe.Ja=[Oe.Ja],Oe.xa=[Oe.xa];e:if(Ot=_,Pe=N,Xe=L,ht=Oe.gb[0],st=Oe.Ja,Ft=Oe.xa,Ct=Pe[0],Qe=!t(Ot,Ct,"VP8 "),vn=!t(Ot,Ct,"VP8L"),e(Ot!=null),e(Xe!=null),e(st!=null),e(Ft!=null),8>Xe[0])Pe=7;else{if(Qe||vn){if(Ot=pt(Ot,Ct+4),12<=ht&&Ot>ht-12){Pe=3;break e}if(fe&&Ot>Xe[0]-8){Pe=7;break e}st[0]=Ot,Pe[0]+=8,Xe[0]-=8,Ft[0]=vn}else Ft[0]=5<=Xe[0]&&Ot[Ct+0]==47&&!(Ot[Ct+4]>>5),st[0]=Xe[0];Pe=0}if(L=L[0],Oe.Ja=Oe.Ja[0],Oe.xa=Oe.xa[0],N=N[0],Pe!=0)break;if(4294967286<Oe.Ja)return 3;if(le==null||Ke||(le[0]=Oe.xa?2:1),se=[se],Me=[Me],Oe.xa){if(5>L){Pe=7;break}le=se,fe=Me,Ke=te,_==null||5>L?_=0:5<=L&&_[N+0]==47&&!(_[N+4]>>5)?(Xe=[0],Ot=[0],ht=[0],he(st=new G,_,N,L),Bl(st,Xe,Ot,ht)?(le!=null&&(le[0]=Xe[0]),fe!=null&&(fe[0]=Ot[0]),Ke!=null&&(Ke[0]=ht[0]),_=1):_=0):_=0}else{if(10>L){Pe=7;break}le=Me,_==null||10>L||!gp(_,N+3,L-3)?_=0:(fe=_[N+0]|_[N+1]<<8|_[N+2]<<16,Ke=16383&(_[N+7]<<8|_[N+6]),_=16383&(_[N+9]<<8|_[N+8]),1&fe||3<(fe>>1&7)||!(fe>>4&1)||fe>>5>=Oe.Ja||!Ke||!_?_=0:(se&&(se[0]=Ke),le&&(le[0]=_),_=1))}if(!_||(se=se[0],Me=Me[0],ze&&(pe[0]!=se||Te[0]!=Me)))return 3;ue!=null&&(ue[0]=Oe,ue.offset=N-ue.w,e(4294967286>N-ue.w),e(ue.offset==ue.ha-L));break}return Pe==0||Pe==7&&ze&&ue==null?(te!=null&&(te[0]|=Oe.na!=null&&0<Oe.na.length),V!=null&&(V[0]=se),Z!=null&&(Z[0]=Me),0):Pe}function Rc(_,N,L){var V=N.width,Z=N.height,te=0,se=0,le=V,ue=Z;if(N.Da=_!=null&&0<_.Da,N.Da&&(le=_.cd,ue=_.bd,te=_.v,se=_.j,11>L||(te&=-2,se&=-2),0>te||0>se||0>=le||0>=ue||te+le>V||se+ue>Z))return 0;if(N.v=te,N.j=se,N.va=te+le,N.o=se+ue,N.U=le,N.T=ue,N.da=_!=null&&0<_.da,N.da){if(!yt(le,ue,L=[_.ib],te=[_.hb]))return 0;N.ib=L[0],N.hb=te[0]}return N.ob=_!=null&&_.ob,N.Kb=_==null||!_.Sd,N.da&&(N.ob=N.ib<3*V/4&&N.hb<3*Z/4,N.Kb=0),1}function Ap(_){if(_==null)return 2;if(11>_.S){var N=_.f.RGBA;N.fb+=(_.height-1)*N.A,N.A=-N.A}else N=_.f.kb,_=_.height,N.O+=(_-1)*N.fa,N.fa=-N.fa,N.N+=(_-1>>1)*N.Ab,N.Ab=-N.Ab,N.W+=(_-1>>1)*N.Db,N.Db=-N.Db,N.F!=null&&(N.J+=(_-1)*N.lb,N.lb=-N.lb);return 0}function hl(_,N,L,V){if(V==null||0>=_||0>=N)return 2;if(L!=null){if(L.Da){var Z=L.cd,te=L.bd,se=-2&L.v,le=-2&L.j;if(0>se||0>le||0>=Z||0>=te||se+Z>_||le+te>N)return 2;_=Z,N=te}if(L.da){if(!yt(_,N,Z=[L.ib],te=[L.hb]))return 2;_=Z[0],N=te[0]}}V.width=_,V.height=N;e:{var ue=V.width,pe=V.height;if(_=V.S,0>=ue||0>=pe||!(_>=Eg&&13>_))_=2;else{if(0>=V.Rd&&V.sd==null){se=te=Z=N=0;var Te=(le=ue*Pg[_])*pe;if(11>_||(te=(pe+1)/2*(N=(ue+1)/2),_==12&&(se=(Z=ue)*pe)),(pe=a(Te+2*te+se))==null){_=1;break e}V.sd=pe,11>_?((ue=V.f.RGBA).eb=pe,ue.fb=0,ue.A=le,ue.size=Te):((ue=V.f.kb).y=pe,ue.O=0,ue.fa=le,ue.Fd=Te,ue.f=pe,ue.N=0+Te,ue.Ab=N,ue.Cd=te,ue.ea=pe,ue.W=0+Te+te,ue.Db=N,ue.Ed=te,_==12&&(ue.F=pe,ue.J=0+Te+2*te),ue.Tc=se,ue.lb=Z)}if(N=1,Z=V.S,te=V.width,se=V.height,Z>=Eg&&13>Z)if(11>Z)_=V.f.RGBA,N&=(le=Math.abs(_.A))*(se-1)+te<=_.size,N&=le>=te*Pg[Z],N&=_.eb!=null;else{_=V.f.kb,le=(te+1)/2,Te=(se+1)/2,ue=Math.abs(_.fa),pe=Math.abs(_.Ab);var ze=Math.abs(_.Db),fe=Math.abs(_.lb),Oe=fe*(se-1)+te;N&=ue*(se-1)+te<=_.Fd,N&=pe*(Te-1)+le<=_.Cd,N=(N&=ze*(Te-1)+le<=_.Ed)&ue>=te&pe>=le&ze>=le,N&=_.y!=null,N&=_.f!=null,N&=_.ea!=null,Z==12&&(N&=fe>=te,N&=Oe<=_.Tc,N&=_.F!=null)}else N=0;_=N?0:2}}return _!=0||L!=null&&L.fd&&(_=Ap(V)),_}var Du=64,ba=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ca=24,ql=32,Xl=8,Lc=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];vt("Predictor0","PredictorAdd0"),R.Predictor0=function(){return 4278190080},R.Predictor1=function(_){return _},R.Predictor2=function(_,N,L){return N[L+0]},R.Predictor3=function(_,N,L){return N[L+1]},R.Predictor4=function(_,N,L){return N[L-1]},R.Predictor5=function(_,N,L){return Lt(Lt(_,N[L+1]),N[L+0])},R.Predictor6=function(_,N,L){return Lt(_,N[L-1])},R.Predictor7=function(_,N,L){return Lt(_,N[L+0])},R.Predictor8=function(_,N,L){return Lt(N[L-1],N[L+0])},R.Predictor9=function(_,N,L){return Lt(N[L+0],N[L+1])},R.Predictor10=function(_,N,L){return Lt(Lt(_,N[L-1]),Lt(N[L+0],N[L+1]))},R.Predictor11=function(_,N,L){var V=N[L+0];return 0>=Jt(V>>24&255,_>>24&255,(N=N[L-1])>>24&255)+Jt(V>>16&255,_>>16&255,N>>16&255)+Jt(V>>8&255,_>>8&255,N>>8&255)+Jt(255&V,255&_,255&N)?V:_},R.Predictor12=function(_,N,L){var V=N[L+0];return(Yt((_>>24&255)+(V>>24&255)-((N=N[L-1])>>24&255))<<24|Yt((_>>16&255)+(V>>16&255)-(N>>16&255))<<16|Yt((_>>8&255)+(V>>8&255)-(N>>8&255))<<8|Yt((255&_)+(255&V)-(255&N)))>>>0},R.Predictor13=function(_,N,L){var V=N[L-1];return(mn((_=Lt(_,N[L+0]))>>24&255,V>>24&255)<<24|mn(_>>16&255,V>>16&255)<<16|mn(_>>8&255,V>>8&255)<<8|mn(255&_,255&V))>>>0};var Gd=R.PredictorAdd0;R.PredictorAdd1=bn,vt("Predictor2","PredictorAdd2"),vt("Predictor3","PredictorAdd3"),vt("Predictor4","PredictorAdd4"),vt("Predictor5","PredictorAdd5"),vt("Predictor6","PredictorAdd6"),vt("Predictor7","PredictorAdd7"),vt("Predictor8","PredictorAdd8"),vt("Predictor9","PredictorAdd9"),vt("Predictor10","PredictorAdd10"),vt("Predictor11","PredictorAdd11"),vt("Predictor12","PredictorAdd12"),vt("Predictor13","PredictorAdd13");var qd=R.PredictorAdd2;zt("ColorIndexInverseTransform","MapARGB","32b",function(_){return _>>8&255},function(_){return _}),zt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(_){return _},function(_){return _>>8&255});var wr,Tg=R.ColorIndexInverseTransform,Yl=R.MapARGB,Kl=R.VP8LColorIndexInverseTransformAlpha,Si=R.MapAlpha,Fc=R.VP8LPredictorsAdd=[];Fc.length=16,(R.VP8LPredictors=[]).length=16,(R.VP8LPredictorsAdd_C=[]).length=16,(R.VP8LPredictors_C=[]).length=16;var Xd,Yd,Mc,Pc,Zl,Mh,qa,zc,zi,So,us,ts,Ds,xr,Jl,dl,Ph,Ep,zy,fx,px,mx,By,jy,zh,Co,Ip,Xa,Bh=a(511),Ng=a(2041),Op=a(225),Dp=a(767),Ag=0,Bc=Ng,$p=Op,Bi=Dp,Ci=Bh,Eg=0,ji=1,Ig=2,_o=3,Rp=4,Kd=5,$u=6,Lp=7,Og=8,Zd=9,Dg=10,ko=[2,3,7],Jd=[3,3,11],jh=[280,256,256,256,40],$g=[0,1,1,1,0],Fp=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],To=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],No=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Ru=8,Ao=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Eo=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ya=null,gx=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Uy=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Rg=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],yx=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],_i=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Bs=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Hn=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ua=[],or=[],fl=[],Lu=1,Vy=2,jc=[],ki=[];Oc("UpsampleRgbLinePair",Dc,3),Oc("UpsampleBgrLinePair",oi,3),Oc("UpsampleRgbaLinePair",la,4),Oc("UpsampleBgraLinePair",Gl,4),Oc("UpsampleArgbLinePair",Wd,4),Oc("UpsampleRgba4444LinePair",Ou,2),Oc("UpsampleRgb565LinePair",Iu,2);var Uh=R.UpsampleRgbLinePair,Wy=R.UpsampleBgrLinePair,Qd=R.UpsampleRgbaLinePair,Lg=R.UpsampleBgraLinePair,Fu=R.UpsampleArgbLinePair,Ql=R.UpsampleRgba4444LinePair,Mu=R.UpsampleRgb565LinePair,Io=16,ef=1<<Io-1,Vh=-227,Pu=482,Fg=6,zu=0,Ti=a(256),Mg=a(256),bx=a(256),LN=a(256),FN=a(Pu-Vh),MN=a(Pu-Vh);$c("YuvToRgbRow",Dc,3),$c("YuvToBgrRow",oi,3),$c("YuvToRgbaRow",la,4),$c("YuvToBgraRow",Gl,4),$c("YuvToArgbRow",Wd,4),$c("YuvToRgba4444Row",Ou,2),$c("YuvToRgb565Row",Iu,2);var Sr=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],tf=[0,2,8],Mp=[8,7,6,4,4,2,2,2,1,1,1,1],Pp=1;this.WebPDecodeRGBA=function(_,N,L,V,Z){var te=ji,se=new Je,le=new An;se.ba=le,le.S=te,le.width=[le.width],le.height=[le.height];var ue=le.width,pe=le.height,Te=new Gt;if(Te==null||_==null)var ze=2;else e(Te!=null),ze=ul(_,N,L,Te.width,Te.height,Te.Pd,Te.Qd,Te.format,null);if(ze!=0?ue=0:(ue!=null&&(ue[0]=Te.width[0]),pe!=null&&(pe[0]=Te.height[0]),ue=1),ue){le.width=le.width[0],le.height=le.height[0],V!=null&&(V[0]=le.width),Z!=null&&(Z[0]=le.height);e:{if(V=new Sc,(Z=new it).data=_,Z.w=N,Z.ha=L,Z.kd=1,N=[0],e(Z!=null),((_=ul(Z.data,Z.w,Z.ha,null,null,null,N,null,Z))==0||_==7)&&N[0]&&(_=4),(N=_)==0){if(e(se!=null),V.data=Z.data,V.w=Z.w+Z.offset,V.ha=Z.ha-Z.offset,V.put=Kt,V.ac=bo,V.bc=wc,V.ma=se,Z.xa){if((_=Ah())==null){se=1;break e}if((function(fe,Oe){var Me=[0],Ke=[0],Pe=[0];t:for(;;){if(fe==null)return 0;if(Oe==null)return fe.a=2,0;if(fe.l=Oe,fe.a=0,he(fe.m,Oe.data,Oe.w,Oe.ha),!Bl(fe.m,Me,Ke,Pe)){fe.a=3;break t}if(fe.xb=Vy,Oe.width=Me[0],Oe.height=Ke[0],!el(Me[0],Ke[0],1,fe,null))break t;return 1}return e(fe.a!=0),0})(_,V)){if(V=(N=hl(V.width,V.height,se.Oa,se.ba))==0){t:{V=_;n:for(;;){if(V==null){V=0;break t}if(e(V.s.yc!=null),e(V.s.Ya!=null),e(0<V.s.Wb),e((L=V.l)!=null),e((Z=L.ma)!=null),V.xb!=0){if(V.ca=Z.ba,V.tb=Z.tb,e(V.ca!=null),!Rc(Z.Oa,L,_o)){V.a=2;break n}if(!tl(V,L.width)||L.da)break n;if((L.da||on(V.ca.S))&&ll(),11>V.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),V.ca.f.kb.F!=null&&ll()),V.Pb&&0<V.s.ua&&V.s.vb.X==null&&!ce(V.s.vb,V.s.Wa.Xa)){V.a=1;break n}V.xb=0}if(!ja(V,V.V,V.Ba,V.c,V.i,L.o,ia))break n;Z.Dc=V.Ma,V=1;break t}e(V.a!=0),V=0}V=!V}V&&(N=_.a)}else N=_.a}else{if((_=new il)==null){se=1;break e}if(_.Fa=Z.na,_.P=Z.P,_.qc=Z.Sa,Ul(_,V)){if((N=hl(V.width,V.height,se.Oa,se.ba))==0){if(_.Aa=0,L=se.Oa,e((Z=_)!=null),L!=null){if(0<(ue=0>(ue=L.Md)?0:100<ue?255:255*ue/100)){for(pe=Te=0;4>pe;++pe)12>(ze=Z.pb[pe]).lc&&(ze.ia=ue*Mp[0>ze.lc?0:ze.lc]>>3),Te|=ze.ia;Te&&(alert("todo:VP8InitRandom"),Z.ia=1)}Z.Ga=L.Id,100<Z.Ga?Z.Ga=100:0>Z.Ga&&(Z.Ga=0)}(function(fe,Oe){if(fe==null)return 0;if(Oe==null)return cs(fe,2,"NULL VP8Io parameter in VP8Decode().");if(!fe.cb&&!Ul(fe,Oe))return 0;if(e(fe.cb),Oe.ac==null||Oe.ac(Oe)){Oe.ob&&(fe.L=0);var Me=tf[fe.L];if(fe.L==2?(fe.yb=0,fe.zb=0):(fe.yb=Oe.v-Me>>4,fe.zb=Oe.j-Me>>4,0>fe.yb&&(fe.yb=0),0>fe.zb&&(fe.zb=0)),fe.Va=Oe.o+15+Me>>4,fe.Hb=Oe.va+15+Me>>4,fe.Hb>fe.za&&(fe.Hb=fe.za),fe.Va>fe.Ub&&(fe.Va=fe.Ub),0<fe.L){var Ke=fe.ed;for(Me=0;4>Me;++Me){var Pe;if(fe.Qa.Cb){var Xe=fe.Qa.Lb[Me];fe.Qa.Fb||(Xe+=Ke.Tb)}else Xe=Ke.Tb;for(Pe=0;1>=Pe;++Pe){var Qe=fe.gd[Me][Pe],ht=Xe;if(Ke.Pc&&(ht+=Ke.vd[0],Pe&&(ht+=Ke.od[0])),0<(ht=0>ht?0:63<ht?63:ht)){var st=ht;0<Ke.wb&&(st=4<Ke.wb?st>>2:st>>1)>9-Ke.wb&&(st=9-Ke.wb),1>st&&(st=1),Qe.dd=st,Qe.tc=2*ht+st,Qe.ld=40<=ht?2:15<=ht?1:0}else Qe.tc=0;Qe.La=Pe}}}Me=0}else cs(fe,6,"Frame setup failed"),Me=fe.a;if(Me=Me==0){if(Me){fe.$c=0,0<fe.Aa||(fe.Ic=Pp);t:{Me=fe.Ic,Ke=4*(st=fe.za);var Ft=32*st,Ct=st+1,vn=0<fe.L?st*(0<fe.Aa?2:1):0,Ot=(fe.Aa==2?2:1)*st;if((Qe=Ke+832+(Pe=3*(16*Me+tf[fe.L])/2*Ft)+(Xe=fe.Fa!=null&&0<fe.Fa.length?fe.Kc.c*fe.Kc.i:0))!=Qe)Me=0;else{if(Qe>fe.Vb){if(fe.Vb=0,fe.Ec=a(Qe),fe.Fc=0,fe.Ec==null){Me=cs(fe,1,"no memory during frame initialization.");break t}fe.Vb=Qe}Qe=fe.Ec,ht=fe.Fc,fe.Ac=Qe,fe.Bc=ht,ht+=Ke,fe.Gd=o(Ft,mp),fe.Hd=0,fe.rb=o(Ct+1,rl),fe.sb=1,fe.wa=vn?o(vn,Ua):null,fe.Y=0,fe.D.Nb=0,fe.D.wa=fe.wa,fe.D.Y=fe.Y,0<fe.Aa&&(fe.D.Y+=st),e(!0),fe.oc=Qe,fe.pc=ht,ht+=832,fe.ya=o(Ot,fp),fe.aa=0,fe.D.ya=fe.ya,fe.D.aa=fe.aa,fe.Aa==2&&(fe.D.aa+=st),fe.R=16*st,fe.B=8*st,st=(Ft=tf[fe.L])*fe.R,Ft=Ft/2*fe.B,fe.sa=Qe,fe.ta=ht+st,fe.qa=fe.sa,fe.ra=fe.ta+16*Me*fe.R+Ft,fe.Ha=fe.qa,fe.Ia=fe.ra+8*Me*fe.B+Ft,fe.$c=0,ht+=Pe,fe.mb=Xe?Qe:null,fe.nb=Xe?ht:null,e(ht+Xe<=fe.Fc+fe.Vb),yp(fe),r(fe.Ac,fe.Bc,0,Ke),Me=1}}if(Me){if(Oe.ka=0,Oe.y=fe.sa,Oe.O=fe.ta,Oe.f=fe.qa,Oe.N=fe.ra,Oe.ea=fe.Ha,Oe.Vd=fe.Ia,Oe.fa=fe.R,Oe.Rc=fe.B,Oe.F=null,Oe.J=0,!Ag){for(Me=-255;255>=Me;++Me)Bh[255+Me]=0>Me?-Me:Me;for(Me=-1020;1020>=Me;++Me)Ng[1020+Me]=-128>Me?-128:127<Me?127:Me;for(Me=-112;112>=Me;++Me)Op[112+Me]=-16>Me?-16:15<Me?15:Me;for(Me=-255;510>=Me;++Me)Dp[255+Me]=0>Me?0:255<Me?255:Me;Ag=1}qa=al,zc=bp,So=oa,us=vp,ts=wp,zi=yg,Ds=_g,xr=Ec,Jl=K,dl=me,Ph=kg,Ep=D,zy=xe,fx=De,px=kc,mx=Tc,By=Lh,jy=kp,or[0]=Sg,or[1]=bg,or[2]=xg,or[3]=Cp,or[4]=Wa,or[5]=_p,or[6]=wi,or[7]=Dh,or[8]=$h,or[9]=Ha,ua[0]=ol,ua[1]=xp,ua[2]=Sp,ua[3]=wg,ua[4]=Cc,ua[5]=Oh,ua[6]=Eu,fl[0]=Bd,fl[1]=vg,fl[2]=Vl,fl[3]=Cg,fl[4]=ai,fl[5]=jd,fl[6]=Wl,Me=1}else Me=0}Me&&(Me=(function(Vn,js){for(Vn.M=0;Vn.M<Vn.Va;++Vn.M){var kn,_t=Vn.Jc[Vn.M&Vn.Xb],mt=Vn.m,Qs=Vn;for(kn=0;kn<Qs.za;++kn){var an=mt,En=Qs,gs=En.Ac,Hr=En.Bc+4*kn,Ni=En.zc,$s=En.ya[En.aa+kn];if(En.Qa.Bb?$s.$b=Fe(an,En.Pa.jb[0])?2+Fe(an,En.Pa.jb[2]):Fe(an,En.Pa.jb[1]):$s.$b=0,En.kc&&($s.Ad=Fe(an,En.Bd)),$s.Za=!Fe(an,145)+0,$s.Za){var Er=$s.Ob,Ui=0;for(En=0;4>En;++En){var Ir,Pn=Ni[0+En];for(Ir=0;4>Ir;++Ir){Pn=_i[gs[Hr+Ir]][Pn];for(var rs=Rg[Fe(an,Pn[0])];0<rs;)rs=Rg[2*rs+Fe(an,Pn[rs])];Pn=-rs,gs[Hr+Ir]=Pn}s(Er,Ui,gs,Hr,4),Ui+=4,Ni[0+En]=Pn}}else Pn=Fe(an,156)?Fe(an,128)?1:3:Fe(an,163)?2:0,$s.Ob[0]=Pn,r(gs,Hr,Pn,4),r(Ni,0,Pn,4);$s.Dd=Fe(an,142)?Fe(an,114)?Fe(an,183)?1:3:2:0}if(Qs.m.Ka)return cs(Vn,7,"Premature end-of-partition0 encountered.");for(;Vn.ja<Vn.za;++Vn.ja){if(Qs=_t,an=(mt=Vn).rb[mt.sb-1],gs=mt.rb[mt.sb+mt.ja],kn=mt.ya[mt.aa+mt.ja],Hr=mt.kc?kn.Ad:0)an.la=gs.la=0,kn.Za||(an.Na=gs.Na=0),kn.Hc=0,kn.Gc=0,kn.ia=0;else{var er,hs;if(an=gs,gs=Qs,Hr=mt.Pa.Xc,Ni=mt.ya[mt.aa+mt.ja],$s=mt.pb[Ni.$b],En=Ni.ad,Er=0,Ui=mt.rb[mt.sb-1],Pn=Ir=0,r(En,Er,0,384),Ni.Za)var Gr=0,tr=Hr[3];else{rs=a(16);var is=an.Na+Ui.Na;if(is=Ya(gs,Hr[1],is,$s.Eb,0,rs,0),an.Na=Ui.Na=(0<is)+0,1<is)qa(rs,0,En,Er);else{var Cr=rs[0]+3>>3;for(rs=0;256>rs;rs+=16)En[Er+rs]=Cr}Gr=1,tr=Hr[0]}var ys=15&an.la,Or=15&Ui.la;for(rs=0;4>rs;++rs){var Dr=1&Or;for(Cr=hs=0;4>Cr;++Cr)ys=ys>>1|(Dr=(is=Ya(gs,tr,is=Dr+(1&ys),$s.Sc,Gr,En,Er))>Gr)<<7,hs=hs<<2|(3<is?3:1<is?2:En[Er+0]!=0),Er+=16;ys>>=4,Or=Or>>1|Dr<<7,Ir=(Ir<<8|hs)>>>0}for(tr=ys,Gr=Or>>4,er=0;4>er;er+=2){for(hs=0,ys=an.la>>4+er,Or=Ui.la>>4+er,rs=0;2>rs;++rs){for(Dr=1&Or,Cr=0;2>Cr;++Cr)is=Dr+(1&ys),ys=ys>>1|(Dr=0<(is=Ya(gs,Hr[2],is,$s.Qc,0,En,Er)))<<3,hs=hs<<2|(3<is?3:1<is?2:En[Er+0]!=0),Er+=16;ys>>=2,Or=Or>>1|Dr<<5}Pn|=hs<<4*er,tr|=ys<<4<<er,Gr|=(240&Or)<<er}an.la=tr,Ui.la=Gr,Ni.Hc=Ir,Ni.Gc=Pn,Ni.ia=43690&Pn?0:$s.ia,Hr=!(Ir|Pn)}if(0<mt.L&&(mt.wa[mt.Y+mt.ja]=mt.gd[kn.$b][kn.Za],mt.wa[mt.Y+mt.ja].La|=!Hr),Qs.Ka)return cs(Vn,7,"Premature end-of-file encountered.")}if(yp(Vn),mt=js,Qs=1,kn=(_t=Vn).D,an=0<_t.L&&_t.M>=_t.zb&&_t.M<=_t.Va,_t.Aa==0)t:{if(kn.M=_t.M,kn.uc=an,Ga(_t,kn),Qs=1,kn=(hs=_t.D).Nb,an=(Pn=tf[_t.L])*_t.R,gs=Pn/2*_t.B,rs=16*kn*_t.R,Cr=8*kn*_t.B,Hr=_t.sa,Ni=_t.ta-an+rs,$s=_t.qa,En=_t.ra-gs+Cr,Er=_t.Ha,Ui=_t.Ia-gs+Cr,Or=(ys=hs.M)==0,Ir=ys>=_t.Va-1,_t.Aa==2&&Ga(_t,hs),hs.uc)for(Dr=(is=_t).D.M,e(is.D.uc),hs=is.yb;hs<is.Hb;++hs){Gr=hs,tr=Dr;var _s=(ns=($r=is).D).Nb;er=$r.R;var ns=ns.wa[ns.Y+Gr],Vi=$r.sa,lr=$r.ta+16*_s*er+16*Gr,Zt=ns.dd,tn=ns.tc;if(tn!=0)if(e(3<=tn),$r.L==1)0<Gr&&mx(Vi,lr,er,tn+4),ns.La&&jy(Vi,lr,er,tn),0<tr&&px(Vi,lr,er,tn+4),ns.La&&By(Vi,lr,er,tn);else{var as=$r.B,va=$r.qa,Oo=$r.ra+8*_s*as+8*Gr,ha=$r.Ha,$r=$r.Ia+8*_s*as+8*Gr;_s=ns.ld,0<Gr&&(xr(Vi,lr,er,tn+4,Zt,_s),dl(va,Oo,ha,$r,as,tn+4,Zt,_s)),ns.La&&(Ep(Vi,lr,er,tn,Zt,_s),fx(va,Oo,ha,$r,as,tn,Zt,_s)),0<tr&&(Ds(Vi,lr,er,tn+4,Zt,_s),Jl(va,Oo,ha,$r,as,tn+4,Zt,_s)),ns.La&&(Ph(Vi,lr,er,tn,Zt,_s),zy(va,Oo,ha,$r,as,tn,Zt,_s))}}if(_t.ia&&alert("todo:DitherRow"),mt.put!=null){if(hs=16*ys,ys=16*(ys+1),Or?(mt.y=_t.sa,mt.O=_t.ta+rs,mt.f=_t.qa,mt.N=_t.ra+Cr,mt.ea=_t.Ha,mt.W=_t.Ia+Cr):(hs-=Pn,mt.y=Hr,mt.O=Ni,mt.f=$s,mt.N=En,mt.ea=Er,mt.W=Ui),Ir||(ys-=Pn),ys>mt.o&&(ys=mt.o),mt.F=null,mt.J=null,_t.Fa!=null&&0<_t.Fa.length&&hs<ys&&(mt.J=Os(_t,mt,hs,ys-hs),mt.F=_t.mb,mt.F==null&&mt.F.length==0)){Qs=cs(_t,3,"Could not decode alpha data.");break t}hs<mt.j&&(Pn=mt.j-hs,hs=mt.j,e(!(1&Pn)),mt.O+=_t.R*Pn,mt.N+=_t.B*(Pn>>1),mt.W+=_t.B*(Pn>>1),mt.F!=null&&(mt.J+=mt.width*Pn)),hs<ys&&(mt.O+=mt.v,mt.N+=mt.v>>1,mt.W+=mt.v>>1,mt.F!=null&&(mt.J+=mt.v),mt.ka=hs-mt.j,mt.U=mt.va-mt.v,mt.T=ys-hs,Qs=mt.put(mt))}kn+1!=_t.Ic||Ir||(s(_t.sa,_t.ta-an,Hr,Ni+16*_t.R,an),s(_t.qa,_t.ra-gs,$s,En+8*_t.B,gs),s(_t.Ha,_t.Ia-gs,Er,Ui+8*_t.B,gs))}if(!Qs)return cs(Vn,6,"Output aborted.")}return 1})(fe,Oe)),Oe.bc!=null&&Oe.bc(Oe),Me&=1}return Me?(fe.cb=0,Me):0})(_,V)||(N=_.a)}}else N=_.a}N==0&&se.Oa!=null&&se.Oa.fd&&(N=Ap(se.ba))}se=N}te=se!=0?null:11>te?le.f.RGBA.eb:le.f.kb.y}else te=null;return te};var Pg=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function u(R,z){for(var I="",j=0;j<4;j++)I+=String.fromCharCode(R[z++]);return I}function d(R,z){return R[z+0]|R[z+1]<<8}function p(R,z){return(R[z+0]|R[z+1]<<8|R[z+2]<<16)>>>0}function m(R,z){return(R[z+0]|R[z+1]<<8|R[z+2]<<16|R[z+3]<<24)>>>0}new c;var g=[0],b=[0],v=[],x=new c,S=n,C=(function(R,z){var I={},j=0,H=!1,q=0,re=0;if(I.frames=[],!(function(B,G){for(var J=0;J<4;J++)if(B[G+J]!="RIFF".charCodeAt(J))return!0;return!1})(R,z)){for(m(R,z+=4),z+=8;z<R.length;){var X=u(R,z),ne=m(R,z+=4);z+=4;var Q=ne+(1&ne);switch(X){case"VP8 ":case"VP8L":I.frames[j]===void 0&&(I.frames[j]={}),(Y=I.frames[j]).src_off=H?re:z-8,Y.src_size=q+ne+8,j++,H&&(H=!1,q=0,re=0);break;case"VP8X":(Y=I.header={}).feature_flags=R[z];var he=z+4;Y.canvas_width=1+p(R,he),he+=3,Y.canvas_height=1+p(R,he),he+=3;break;case"ALPH":H=!0,q=Q+8,re=z-8;break;case"ANIM":(Y=I.header).bgcolor=m(R,z),he=z+4,Y.loop_count=d(R,he),he+=2;break;case"ANMF":var ye,Y;(Y=I.frames[j]={}).offset_x=2*p(R,z),z+=3,Y.offset_y=2*p(R,z),z+=3,Y.width=1+p(R,z),z+=3,Y.height=1+p(R,z),z+=3,Y.duration=p(R,z),z+=3,ye=R[z++],Y.dispose=1&ye,Y.blend=ye>>1&1}X!="ANMF"&&(z+=Q)}return I}})(S,0);C.response=S,C.rgbaoutput=!0,C.dataurl=!1;var A=C.header?C.header:null,k=C.frames?C.frames:null;if(A){A.loop_counter=A.loop_count,g=[A.canvas_height],b=[A.canvas_width];for(var O=0;O<k.length&&k[O].blend!=0;O++);}var F=k[0],$=x.WebPDecodeRGBA(S,F.src_off,F.src_size,b,g);F.rgba=$,F.imgwidth=b[0],F.imgheight=g[0];for(var M=0;M<b[0]*g[0]*4;M++)v[M]=$[M];return this.width=b,this.height=g,this.data=v,this}(function(n){var e,t,s,r,a,o,l,c,u,d=function(B){return B=B||{},this.isStrokeTransparent=B.isStrokeTransparent||!1,this.strokeOpacity=B.strokeOpacity||1,this.strokeStyle=B.strokeStyle||"#000000",this.fillStyle=B.fillStyle||"#000000",this.isFillTransparent=B.isFillTransparent||!1,this.fillOpacity=B.fillOpacity||1,this.font=B.font||"10px sans-serif",this.textBaseline=B.textBaseline||"alphabetic",this.textAlign=B.textAlign||"left",this.lineWidth=B.lineWidth||1,this.lineJoin=B.lineJoin||"miter",this.lineCap=B.lineCap||"butt",this.path=B.path||[],this.transform=B.transform!==void 0?B.transform.clone():new c,this.globalCompositeOperation=B.globalCompositeOperation||"normal",this.globalAlpha=B.globalAlpha||1,this.clip_path=B.clip_path||[],this.currentPoint=B.currentPoint||new o,this.miterLimit=B.miterLimit||10,this.lastPoint=B.lastPoint||new o,this.lineDashOffset=B.lineDashOffset||0,this.lineDash=B.lineDash||[],this.margin=B.margin||[0,0,0,0],this.prevPageLastElemOffset=B.prevPageLastElemOffset||0,this.ignoreClearRect=typeof B.ignoreClearRect!="boolean"||B.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new p(this),e=this.internal.f2,t=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,u=new d}]);var p=function(B){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var G=B;Object.defineProperty(this,"pdf",{get:function(){return G}});var J=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return J},set:function(ce){J=!!ce}});var oe=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return oe},set:function(ce){oe=!!ce}});var de=0;Object.defineProperty(this,"posX",{get:function(){return de},set:function(ce){isNaN(ce)||(de=ce)}});var ge=0;Object.defineProperty(this,"posY",{get:function(){return ge},set:function(ce){isNaN(ce)||(ge=ce)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(ce){var rt;typeof ce=="number"?rt=[ce,ce,ce,ce]:((rt=new Array(4))[0]=ce[0],rt[1]=ce.length>=2?ce[1]:rt[0],rt[2]=ce.length>=3?ce[2]:rt[0],rt[3]=ce.length>=4?ce[3]:rt[1]),u.margin=rt}});var Ae=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Ae},set:function(ce){Ae=ce}});var Ce=0;Object.defineProperty(this,"lastBreak",{get:function(){return Ce},set:function(ce){Ce=ce}});var Fe=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Fe},set:function(ce){Fe=ce}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(ce){ce instanceof d&&(u=ce)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(ce){u.path=ce}});var Ge=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ge},set:function(ce){Ge=ce}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(ce){var rt;rt=m(ce),this.ctx.fillStyle=rt.style,this.ctx.isFillTransparent=rt.a===0,this.ctx.fillOpacity=rt.a,this.pdf.setFillColor(rt.r,rt.g,rt.b,{a:rt.a}),this.pdf.setTextColor(rt.r,rt.g,rt.b,{a:rt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(ce){var rt=m(ce);this.ctx.strokeStyle=rt.style,this.ctx.isStrokeTransparent=rt.a===0,this.ctx.strokeOpacity=rt.a,rt.a===0?this.pdf.setDrawColor(255,255,255):(rt.a,this.pdf.setDrawColor(rt.r,rt.g,rt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(ce){["butt","round","square"].indexOf(ce)!==-1&&(this.ctx.lineCap=ce,this.pdf.setLineCap(ce))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(ce){isNaN(ce)||(this.ctx.lineWidth=ce,this.pdf.setLineWidth(ce))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(ce){["bevel","round","miter"].indexOf(ce)!==-1&&(this.ctx.lineJoin=ce,this.pdf.setLineJoin(ce))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(ce){isNaN(ce)||(this.ctx.miterLimit=ce,this.pdf.setMiterLimit(ce))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(ce){this.ctx.textBaseline=ce}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(ce){["right","end","center","left","start"].indexOf(ce)!==-1&&(this.ctx.textAlign=ce)}});var ot=null,ut=null,pt=null;Object.defineProperty(this,"fontFaces",{get:function(){return pt},set:function(ce){ot=null,ut=null,pt=ce}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(ce){var rt;if(this.ctx.font=ce,(rt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(ce))!==null){var At=rt[1];rt[2];var yt=rt[3],nt=rt[4];rt[5];var xt=rt[6],vt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(nt)[2];nt=Math.floor(vt==="px"?parseFloat(nt)*this.pdf.internal.scaleFactor:vt==="em"?parseFloat(nt)*this.pdf.getFontSize():parseFloat(nt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(nt);var Tt=(function(zt){var Ks,Cn,Qt=[],un=zt.trim();if(un==="")return I5;if(un in L4)return[L4[un]];for(;un!=="";){switch(Cn=null,Ks=(un=M4(un)).charAt(0)){case'"':case"'":Cn=Ste(un.substring(1),Ks);break;default:Cn=Cte(un)}if(Cn===null||(Qt.push(Cn[0]),(un=M4(Cn[1]))!==""&&un.charAt(0)!==","))return I5;un=un.replace(/^,/,"")}return Qt})(xt);if(this.fontFaces){var Lt=(function(zt,Ks){var Cn=zt.getFontList(),Qt=JSON.stringify(Cn);if(ot===null||ut!==Qt){var un=(function(Un){var en=[];return Object.keys(Un).forEach(function(Is){Un[Is].forEach(function(on){var gn=null;switch(on){case"bold":gn={family:Is,weight:"bold"};break;case"italic":gn={family:Is,style:"italic"};break;case"bolditalic":gn={family:Is,weight:"bold",style:"italic"};break;case"":case"normal":gn={family:Is}}gn!==null&&(gn.ref={name:Is,style:on},en.push(gn))})}),en})(Cn);ot=(function(Un){for(var en={},Is=0;Is<Un.length;++Is){var on=E5(Un[Is]),gn=on.family,Ss=on.stretch,An=on.style,Gt=on.weight;en[gn]=en[gn]||{},en[gn][Ss]=en[gn][Ss]||{},en[gn][Ss][An]=en[gn][Ss][An]||{},en[gn][Ss][An][Gt]=on}return en})(un.concat(Ks)),ut=Qt}return ot})(this.pdf,this.fontFaces),Yt=Tt.map(function(zt){return{family:zt,stretch:"normal",weight:yt,style:At}}),mn=(function(zt,Ks,Cn){for(var Qt=(Cn=Cn||{}).defaultFontFamily||"times",un=Object.assign({},xte,Cn.genericFontFamilies||{}),Un=null,en=null,Is=0;Is<Ks.length;++Is)if(un[(Un=E5(Ks[Is])).family]&&(Un.family=un[Un.family]),zt.hasOwnProperty(Un.family)){en=zt[Un.family];break}if(!(en=en||zt[Qt]))throw new Error("Could not find a font-family for the rule '"+F4(Un)+"' and default family '"+Qt+"'.");if(en=(function(on,gn){if(gn[on])return gn[on];var Ss=$E[on],An=Ss<=$E.normal?-1:1,Gt=R4(gn,L7,Ss,An);if(!Gt)throw new Error("Could not find a matching font-stretch value for "+on);return Gt})(Un.stretch,en),en=(function(on,gn){if(gn[on])return gn[on];for(var Ss=R7[on],An=0;An<Ss.length;++An)if(gn[Ss[An]])return gn[Ss[An]];throw new Error("Could not find a matching font-style for "+on)})(Un.style,en),!(en=(function(on,gn){if(gn[on])return gn[on];if(on===400&&gn[500])return gn[500];if(on===500&&gn[400])return gn[400];var Ss=wte[on],An=R4(gn,F7,Ss,on<400?-1:1);if(!An)throw new Error("Could not find a matching font-weight for value "+on);return An})(Un.weight,en)))throw new Error("Failed to resolve a font for the rule '"+F4(Un)+"'.");return en})(Lt,Yt);this.pdf.setFont(mn.ref.name,mn.ref.style)}else{var Jt="";(yt==="bold"||parseInt(yt,10)>=700||At==="bold")&&(Jt="bold"),At==="italic"&&(Jt+="italic"),Jt.length===0&&(Jt="normal");for(var bn="",cn={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Et=0;Et<Tt.length;Et++){if(this.pdf.internal.getFont(Tt[Et],Jt,{noFallback:!0,disableWarning:!0})!==void 0){bn=Tt[Et];break}if(Jt==="bolditalic"&&this.pdf.internal.getFont(Tt[Et],"bold",{noFallback:!0,disableWarning:!0})!==void 0)bn=Tt[Et],Jt="bold";else if(this.pdf.internal.getFont(Tt[Et],"normal",{noFallback:!0,disableWarning:!0})!==void 0){bn=Tt[Et],Jt="normal";break}}if(bn===""){for(var fn=0;fn<Tt.length;fn++)if(cn[Tt[fn]]){bn=cn[Tt[fn]];break}}bn=bn===""?"Times":bn,this.pdf.setFont(bn,Jt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(ce){this.ctx.globalCompositeOperation=ce}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(ce){this.ctx.globalAlpha=ce}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(ce){this.ctx.lineDashOffset=ce,Y.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(ce){this.ctx.lineDash=ce,Y.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(ce){this.ctx.ignoreClearRect=!!ce}})};p.prototype.setLineDash=function(B){this.lineDash=B},p.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},p.prototype.fill=function(){k.call(this,"fill",!1)},p.prototype.stroke=function(){k.call(this,"stroke",!1)},p.prototype.beginPath=function(){this.path=[{type:"begin"}]},p.prototype.moveTo=function(B,G){if(isNaN(B)||isNaN(G))throw Vs.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var J=this.ctx.transform.applyToPoint(new o(B,G));this.path.push({type:"mt",x:J.x,y:J.y}),this.ctx.lastPoint=new o(B,G)},p.prototype.closePath=function(){var B=new o(0,0),G=0;for(G=this.path.length-1;G!==-1;G--)if(this.path[G].type==="begin"&&Ns(this.path[G+1])==="object"&&typeof this.path[G+1].x=="number"){B=new o(this.path[G+1].x,this.path[G+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(B.x,B.y)},p.prototype.lineTo=function(B,G){if(isNaN(B)||isNaN(G))throw Vs.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var J=this.ctx.transform.applyToPoint(new o(B,G));this.path.push({type:"lt",x:J.x,y:J.y}),this.ctx.lastPoint=new o(J.x,J.y)},p.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),k.call(this,null,!0)},p.prototype.quadraticCurveTo=function(B,G,J,oe){if(isNaN(J)||isNaN(oe)||isNaN(B)||isNaN(G))throw Vs.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var de=this.ctx.transform.applyToPoint(new o(J,oe)),ge=this.ctx.transform.applyToPoint(new o(B,G));this.path.push({type:"qct",x1:ge.x,y1:ge.y,x:de.x,y:de.y}),this.ctx.lastPoint=new o(de.x,de.y)},p.prototype.bezierCurveTo=function(B,G,J,oe,de,ge){if(isNaN(de)||isNaN(ge)||isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe))throw Vs.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Ae=this.ctx.transform.applyToPoint(new o(de,ge)),Ce=this.ctx.transform.applyToPoint(new o(B,G)),Fe=this.ctx.transform.applyToPoint(new o(J,oe));this.path.push({type:"bct",x1:Ce.x,y1:Ce.y,x2:Fe.x,y2:Fe.y,x:Ae.x,y:Ae.y}),this.ctx.lastPoint=new o(Ae.x,Ae.y)},p.prototype.arc=function(B,G,J,oe,de,ge){if(isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe)||isNaN(de))throw Vs.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ge=!!ge,!this.ctx.transform.isIdentity){var Ae=this.ctx.transform.applyToPoint(new o(B,G));B=Ae.x,G=Ae.y;var Ce=this.ctx.transform.applyToPoint(new o(0,J)),Fe=this.ctx.transform.applyToPoint(new o(0,0));J=Math.sqrt(Math.pow(Ce.x-Fe.x,2)+Math.pow(Ce.y-Fe.y,2))}Math.abs(de-oe)>=2*Math.PI&&(oe=0,de=2*Math.PI),this.path.push({type:"arc",x:B,y:G,radius:J,startAngle:oe,endAngle:de,counterclockwise:ge})},p.prototype.arcTo=function(B,G,J,oe,de){throw new Error("arcTo not implemented.")},p.prototype.rect=function(B,G,J,oe){if(isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe))throw Vs.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(B,G),this.lineTo(B+J,G),this.lineTo(B+J,G+oe),this.lineTo(B,G+oe),this.lineTo(B,G),this.lineTo(B+J,G),this.lineTo(B,G)},p.prototype.fillRect=function(B,G,J,oe){if(isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe))throw Vs.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!g.call(this)){var de={};this.lineCap!=="butt"&&(de.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(de.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(B,G,J,oe),this.fill(),de.hasOwnProperty("lineCap")&&(this.lineCap=de.lineCap),de.hasOwnProperty("lineJoin")&&(this.lineJoin=de.lineJoin)}},p.prototype.strokeRect=function(B,G,J,oe){if(isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe))throw Vs.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");b.call(this)||(this.beginPath(),this.rect(B,G,J,oe),this.stroke())},p.prototype.clearRect=function(B,G,J,oe){if(isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe))throw Vs.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(B,G,J,oe))},p.prototype.save=function(B){B=typeof B!="boolean"||B;for(var G=this.pdf.internal.getCurrentPageInfo().pageNumber,J=0;J<this.pdf.internal.getNumberOfPages();J++)this.pdf.setPage(J+1),this.pdf.internal.out("q");if(this.pdf.setPage(G),B){this.ctx.fontSize=this.pdf.internal.getFontSize();var oe=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=oe}},p.prototype.restore=function(B){B=typeof B!="boolean"||B;for(var G=this.pdf.internal.getCurrentPageInfo().pageNumber,J=0;J<this.pdf.internal.getNumberOfPages();J++)this.pdf.setPage(J+1),this.pdf.internal.out("Q");this.pdf.setPage(G),B&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},p.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var m=function(B){var G,J,oe,de;if(B.isCanvasGradient===!0&&(B=B.getColor()),!B)return{r:0,g:0,b:0,a:0,style:B};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(B))G=0,J=0,oe=0,de=0;else{var ge=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(B);if(ge!==null)G=parseInt(ge[1]),J=parseInt(ge[2]),oe=parseInt(ge[3]),de=1;else if((ge=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(B))!==null)G=parseInt(ge[1]),J=parseInt(ge[2]),oe=parseInt(ge[3]),de=parseFloat(ge[4]);else{if(de=1,typeof B=="string"&&B.charAt(0)!=="#"){var Ae=new N7(B);B=Ae.ok?Ae.toHex():"#000000"}B.length===4?(G=B.substring(1,2),G+=G,J=B.substring(2,3),J+=J,oe=B.substring(3,4),oe+=oe):(G=B.substring(1,3),J=B.substring(3,5),oe=B.substring(5,7)),G=parseInt(G,16),J=parseInt(J,16),oe=parseInt(oe,16)}}return{r:G,g:J,b:oe,a:de,style:B}},g=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},b=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};p.prototype.fillText=function(B,G,J,oe){if(isNaN(G)||isNaN(J)||typeof B!="string")throw Vs.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(oe=isNaN(oe)?void 0:oe,!g.call(this)){var de=Q(this.ctx.transform.rotation),ge=this.ctx.transform.scaleX;j.call(this,{text:B,x:G,y:J,scale:ge,angle:de,align:this.textAlign,maxWidth:oe})}},p.prototype.strokeText=function(B,G,J,oe){if(isNaN(G)||isNaN(J)||typeof B!="string")throw Vs.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!b.call(this)){oe=isNaN(oe)?void 0:oe;var de=Q(this.ctx.transform.rotation),ge=this.ctx.transform.scaleX;j.call(this,{text:B,x:G,y:J,scale:ge,renderingMode:"stroke",angle:de,align:this.textAlign,maxWidth:oe})}},p.prototype.measureText=function(B){if(typeof B!="string")throw Vs.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var G=this.pdf,J=this.pdf.internal.scaleFactor,oe=G.internal.getFontSize(),de=G.getStringUnitWidth(B)*oe/G.internal.scaleFactor;return new function(ge){var Ae=(ge=ge||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Ae}}),this}({width:de*=Math.round(96*J/72*1e4)/1e4})},p.prototype.scale=function(B,G){if(isNaN(B)||isNaN(G))throw Vs.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var J=new c(B,0,0,G,0,0);this.ctx.transform=this.ctx.transform.multiply(J)},p.prototype.rotate=function(B){if(isNaN(B))throw Vs.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var G=new c(Math.cos(B),Math.sin(B),-Math.sin(B),Math.cos(B),0,0);this.ctx.transform=this.ctx.transform.multiply(G)},p.prototype.translate=function(B,G){if(isNaN(B)||isNaN(G))throw Vs.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var J=new c(1,0,0,1,B,G);this.ctx.transform=this.ctx.transform.multiply(J)},p.prototype.transform=function(B,G,J,oe,de,ge){if(isNaN(B)||isNaN(G)||isNaN(J)||isNaN(oe)||isNaN(de)||isNaN(ge))throw Vs.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Ae=new c(B,G,J,oe,de,ge);this.ctx.transform=this.ctx.transform.multiply(Ae)},p.prototype.setTransform=function(B,G,J,oe,de,ge){B=isNaN(B)?1:B,G=isNaN(G)?0:G,J=isNaN(J)?0:J,oe=isNaN(oe)?1:oe,de=isNaN(de)?0:de,ge=isNaN(ge)?0:ge,this.ctx.transform=new c(B,G,J,oe,de,ge)};var v=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};p.prototype.drawImage=function(B,G,J,oe,de,ge,Ae,Ce,Fe){var Ge=this.pdf.getImageProperties(B),ot=1,ut=1,pt=1,ce=1;oe!==void 0&&Ce!==void 0&&(pt=Ce/oe,ce=Fe/de,ot=Ge.width/oe*Ce/oe,ut=Ge.height/de*Fe/de),ge===void 0&&(ge=G,Ae=J,G=0,J=0),oe!==void 0&&Ce===void 0&&(Ce=oe,Fe=de),oe===void 0&&Ce===void 0&&(Ce=Ge.width,Fe=Ge.height);var rt=this.ctx.transform.decompose(),At=Q(rt.rotate.shx),yt=new c,nt=(yt=(yt=(yt=yt.multiply(rt.translate)).multiply(rt.skew)).multiply(rt.scale)).applyToRectangle(new l(ge-G*pt,Ae-J*ce,oe*ot,de*ut));if(this.autoPaging){for(var xt,vt=x.call(this,nt),Tt=[],Lt=0;Lt<vt.length;Lt+=1)Tt.indexOf(vt[Lt])===-1&&Tt.push(vt[Lt]);A(Tt);for(var Yt=Tt[0],mn=Tt[Tt.length-1],Jt=Yt;Jt<mn+1;Jt++){this.pdf.setPage(Jt);var bn=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],cn=Jt===1?this.posY+this.margin[0]:this.margin[0],Et=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],fn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],zt=Jt===1?0:Et+(Jt-2)*fn;if(this.ctx.clip_path.length!==0){var Ks=this.path;xt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=C(xt,this.posX+this.margin[3],-zt+cn+this.ctx.prevPageLastElemOffset),O.call(this,"fill",!0),this.path=Ks}var Cn=JSON.parse(JSON.stringify(nt));Cn=C([Cn],this.posX+this.margin[3],-zt+cn+this.ctx.prevPageLastElemOffset)[0];var Qt=(Jt>Yt||Jt<mn)&&v.call(this);Qt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],bn,fn,null).clip().discardPath()),this.pdf.addImage(B,"JPEG",Cn.x,Cn.y,Cn.w,Cn.h,null,null,At),Qt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(B,"JPEG",nt.x,nt.y,nt.w,nt.h,null,null,At)};var x=function(B,G,J){var oe=[];G=G||this.pdf.internal.pageSize.width,J=J||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var de=this.posY+this.ctx.prevPageLastElemOffset;switch(B.type){default:case"mt":case"lt":oe.push(Math.floor((B.y+de)/J)+1);break;case"arc":oe.push(Math.floor((B.y+de-B.radius)/J)+1),oe.push(Math.floor((B.y+de+B.radius)/J)+1);break;case"qct":var ge=he(this.ctx.lastPoint.x,this.ctx.lastPoint.y,B.x1,B.y1,B.x,B.y);oe.push(Math.floor((ge.y+de)/J)+1),oe.push(Math.floor((ge.y+ge.h+de)/J)+1);break;case"bct":var Ae=ye(this.ctx.lastPoint.x,this.ctx.lastPoint.y,B.x1,B.y1,B.x2,B.y2,B.x,B.y);oe.push(Math.floor((Ae.y+de)/J)+1),oe.push(Math.floor((Ae.y+Ae.h+de)/J)+1);break;case"rect":oe.push(Math.floor((B.y+de)/J)+1),oe.push(Math.floor((B.y+B.h+de)/J)+1)}for(var Ce=0;Ce<oe.length;Ce+=1)for(;this.pdf.internal.getNumberOfPages()<oe[Ce];)S.call(this);return oe},S=function(){var B=this.fillStyle,G=this.strokeStyle,J=this.font,oe=this.lineCap,de=this.lineWidth,ge=this.lineJoin;this.pdf.addPage(),this.fillStyle=B,this.strokeStyle=G,this.font=J,this.lineCap=oe,this.lineWidth=de,this.lineJoin=ge},C=function(B,G,J){for(var oe=0;oe<B.length;oe++)switch(B[oe].type){case"bct":B[oe].x2+=G,B[oe].y2+=J;case"qct":B[oe].x1+=G,B[oe].y1+=J;default:B[oe].x+=G,B[oe].y+=J}return B},A=function(B){return B.sort(function(G,J){return G-J})},k=function(B,G){var J=this.fillStyle,oe=this.strokeStyle,de=this.lineCap,ge=this.lineWidth,Ae=Math.abs(ge*this.ctx.transform.scaleX),Ce=this.lineJoin;if(this.autoPaging){for(var Fe,Ge,ot=JSON.parse(JSON.stringify(this.path)),ut=JSON.parse(JSON.stringify(this.path)),pt=[],ce=0;ce<ut.length;ce++)if(ut[ce].x!==void 0)for(var rt=x.call(this,ut[ce]),At=0;At<rt.length;At+=1)pt.indexOf(rt[At])===-1&&pt.push(rt[At]);for(var yt=0;yt<pt.length;yt++)for(;this.pdf.internal.getNumberOfPages()<pt[yt];)S.call(this);A(pt);for(var nt=pt[0],xt=pt[pt.length-1],vt=nt;vt<xt+1;vt++){this.pdf.setPage(vt),this.fillStyle=J,this.strokeStyle=oe,this.lineCap=de,this.lineWidth=Ae,this.lineJoin=Ce;var Tt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Lt=vt===1?this.posY+this.margin[0]:this.margin[0],Yt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],mn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Jt=vt===1?0:Yt+(vt-2)*mn;if(this.ctx.clip_path.length!==0){var bn=this.path;Fe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=C(Fe,this.posX+this.margin[3],-Jt+Lt+this.ctx.prevPageLastElemOffset),O.call(this,B,!0),this.path=bn}if(Ge=JSON.parse(JSON.stringify(ot)),this.path=C(Ge,this.posX+this.margin[3],-Jt+Lt+this.ctx.prevPageLastElemOffset),G===!1||vt===0){var cn=(vt>nt||vt<xt)&&v.call(this);cn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Tt,mn,null).clip().discardPath()),O.call(this,B,G),cn&&this.pdf.restoreGraphicsState()}this.lineWidth=ge}this.path=ot}else this.lineWidth=Ae,O.call(this,B,G),this.lineWidth=ge},O=function(B,G){if((B!=="stroke"||G||!b.call(this))&&(B==="stroke"||G||!g.call(this))){for(var J,oe,de=[],ge=this.path,Ae=0;Ae<ge.length;Ae++){var Ce=ge[Ae];switch(Ce.type){case"begin":de.push({begin:!0});break;case"close":de.push({close:!0});break;case"mt":de.push({start:Ce,deltas:[],abs:[]});break;case"lt":var Fe=de.length;if(ge[Ae-1]&&!isNaN(ge[Ae-1].x)&&(J=[Ce.x-ge[Ae-1].x,Ce.y-ge[Ae-1].y],Fe>0)){for(;Fe>=0;Fe--)if(de[Fe-1].close!==!0&&de[Fe-1].begin!==!0){de[Fe-1].deltas.push(J),de[Fe-1].abs.push(Ce);break}}break;case"bct":J=[Ce.x1-ge[Ae-1].x,Ce.y1-ge[Ae-1].y,Ce.x2-ge[Ae-1].x,Ce.y2-ge[Ae-1].y,Ce.x-ge[Ae-1].x,Ce.y-ge[Ae-1].y],de[de.length-1].deltas.push(J);break;case"qct":var Ge=ge[Ae-1].x+2/3*(Ce.x1-ge[Ae-1].x),ot=ge[Ae-1].y+2/3*(Ce.y1-ge[Ae-1].y),ut=Ce.x+2/3*(Ce.x1-Ce.x),pt=Ce.y+2/3*(Ce.y1-Ce.y),ce=Ce.x,rt=Ce.y;J=[Ge-ge[Ae-1].x,ot-ge[Ae-1].y,ut-ge[Ae-1].x,pt-ge[Ae-1].y,ce-ge[Ae-1].x,rt-ge[Ae-1].y],de[de.length-1].deltas.push(J);break;case"arc":de.push({deltas:[],abs:[],arc:!0}),Array.isArray(de[de.length-1].abs)&&de[de.length-1].abs.push(Ce)}}oe=G?null:B==="stroke"?"stroke":"fill";for(var At=!1,yt=0;yt<de.length;yt++)if(de[yt].arc)for(var nt=de[yt].abs,xt=0;xt<nt.length;xt++){var vt=nt[xt];vt.type==="arc"?M.call(this,vt.x,vt.y,vt.radius,vt.startAngle,vt.endAngle,vt.counterclockwise,void 0,G,!At):H.call(this,vt.x,vt.y),At=!0}else if(de[yt].close===!0)this.pdf.internal.out("h"),At=!1;else if(de[yt].begin!==!0){var Tt=de[yt].start.x,Lt=de[yt].start.y;q.call(this,de[yt].deltas,Tt,Lt),At=!0}oe&&R.call(this,oe),G&&z.call(this)}},F=function(B){var G=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,J=G*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return B-J;case"top":return B+G-J;case"hanging":return B+G-2*J;case"middle":return B+G/2-J;default:return B}},$=function(B){return B+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};p.prototype.createLinearGradient=function(){var B=function(){};return B.colorStops=[],B.addColorStop=function(G,J){this.colorStops.push([G,J])},B.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},B.isCanvasGradient=!0,B},p.prototype.createPattern=function(){return this.createLinearGradient()},p.prototype.createRadialGradient=function(){return this.createLinearGradient()};var M=function(B,G,J,oe,de,ge,Ae,Ce,Fe){for(var Ge=X.call(this,J,oe,de,ge),ot=0;ot<Ge.length;ot++){var ut=Ge[ot];ot===0&&(Fe?I.call(this,ut.x1+B,ut.y1+G):H.call(this,ut.x1+B,ut.y1+G)),re.call(this,B,G,ut.x2,ut.y2,ut.x3,ut.y3,ut.x4,ut.y4)}Ce?z.call(this):R.call(this,Ae)},R=function(B){switch(B){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},z=function(){this.pdf.clip(),this.pdf.discardPath()},I=function(B,G){this.pdf.internal.out(t(B)+" "+s(G)+" m")},j=function(B){var G;switch(B.align){case"right":case"end":G="right";break;case"center":G="center";break;default:G="left"}var J,oe,de,ge=this.pdf.getTextDimensions(B.text),Ae=F.call(this,B.y),Ce=$.call(this,Ae)-ge.h,Fe=this.ctx.transform.applyToPoint(new o(B.x,Ae));if(this.autoPaging){var Ge=this.ctx.transform.decompose(),ot=new c;ot=(ot=(ot=ot.multiply(Ge.translate)).multiply(Ge.skew)).multiply(Ge.scale);for(var ut=this.ctx.transform.applyToRectangle(new l(B.x,Ae,ge.w,ge.h)),pt=ot.applyToRectangle(new l(B.x,Ce,ge.w,ge.h)),ce=x.call(this,pt),rt=[],At=0;At<ce.length;At+=1)rt.indexOf(ce[At])===-1&&rt.push(ce[At]);A(rt);for(var yt=rt[0],nt=rt[rt.length-1],xt=yt;xt<nt+1;xt++){this.pdf.setPage(xt);var vt=xt===1?this.posY+this.margin[0]:this.margin[0],Tt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Lt=this.pdf.internal.pageSize.height-this.margin[2],Yt=Lt-this.margin[0],mn=this.pdf.internal.pageSize.width-this.margin[1],Jt=mn-this.margin[3],bn=xt===1?0:Tt+(xt-2)*Yt;if(this.ctx.clip_path.length!==0){var cn=this.path;J=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=C(J,this.posX+this.margin[3],-1*bn+vt),O.call(this,"fill",!0),this.path=cn}var Et=C([JSON.parse(JSON.stringify(pt))],this.posX+this.margin[3],-bn+vt+this.ctx.prevPageLastElemOffset)[0];B.scale>=.01&&(oe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(oe*B.scale),de=this.lineWidth,this.lineWidth=de*B.scale);var fn=this.autoPaging!=="text";if(fn||Et.y+Et.h<=Lt){if(fn||Et.y>=vt&&Et.x<=mn){var zt=fn?B.text:this.pdf.splitTextToSize(B.text,B.maxWidth||mn-Et.x)[0],Ks=C([JSON.parse(JSON.stringify(ut))],this.posX+this.margin[3],-bn+vt+this.ctx.prevPageLastElemOffset)[0],Cn=fn&&(xt>yt||xt<nt)&&v.call(this);Cn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Jt,Yt,null).clip().discardPath()),this.pdf.text(zt,Ks.x,Ks.y,{angle:B.angle,align:G,renderingMode:B.renderingMode}),Cn&&this.pdf.restoreGraphicsState()}}else Et.y<Lt&&(this.ctx.prevPageLastElemOffset+=Lt-Et.y);B.scale>=.01&&(this.pdf.setFontSize(oe),this.lineWidth=de)}}else B.scale>=.01&&(oe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(oe*B.scale),de=this.lineWidth,this.lineWidth=de*B.scale),this.pdf.text(B.text,Fe.x+this.posX,Fe.y+this.posY,{angle:B.angle,align:G,renderingMode:B.renderingMode,maxWidth:B.maxWidth}),B.scale>=.01&&(this.pdf.setFontSize(oe),this.lineWidth=de)},H=function(B,G,J,oe){J=J||0,oe=oe||0,this.pdf.internal.out(t(B+J)+" "+s(G+oe)+" l")},q=function(B,G,J){return this.pdf.lines(B,G,J,null,null)},re=function(B,G,J,oe,de,ge,Ae,Ce){this.pdf.internal.out([e(r(J+B)),e(a(oe+G)),e(r(de+B)),e(a(ge+G)),e(r(Ae+B)),e(a(Ce+G)),"c"].join(" "))},X=function(B,G,J,oe){for(var de=2*Math.PI,ge=Math.PI/2;G>J;)G-=de;var Ae=Math.abs(J-G);Ae<de&&oe&&(Ae=de-Ae);for(var Ce=[],Fe=oe?-1:1,Ge=G;Ae>1e-5;){var ot=Ge+Fe*Math.min(Ae,ge);Ce.push(ne.call(this,B,Ge,ot)),Ae-=Math.abs(ot-Ge),Ge=ot}return Ce},ne=function(B,G,J){var oe=(J-G)/2,de=B*Math.cos(oe),ge=B*Math.sin(oe),Ae=de,Ce=-ge,Fe=Ae*Ae+Ce*Ce,Ge=Fe+Ae*de+Ce*ge,ot=4/3*(Math.sqrt(2*Fe*Ge)-Ge)/(Ae*ge-Ce*de),ut=Ae-ot*Ce,pt=Ce+ot*Ae,ce=ut,rt=-pt,At=oe+G,yt=Math.cos(At),nt=Math.sin(At);return{x1:B*Math.cos(G),y1:B*Math.sin(G),x2:ut*yt-pt*nt,y2:ut*nt+pt*yt,x3:ce*yt-rt*nt,y3:ce*nt+rt*yt,x4:B*Math.cos(J),y4:B*Math.sin(J)}},Q=function(B){return 180*B/Math.PI},he=function(B,G,J,oe,de,ge){var Ae=B+.5*(J-B),Ce=G+.5*(oe-G),Fe=de+.5*(J-de),Ge=ge+.5*(oe-ge),ot=Math.min(B,de,Ae,Fe),ut=Math.max(B,de,Ae,Fe),pt=Math.min(G,ge,Ce,Ge),ce=Math.max(G,ge,Ce,Ge);return new l(ot,pt,ut-ot,ce-pt)},ye=function(B,G,J,oe,de,ge,Ae,Ce){var Fe,Ge,ot,ut,pt,ce,rt,At,yt,nt,xt,vt,Tt,Lt,Yt=J-B,mn=oe-G,Jt=de-J,bn=ge-oe,cn=Ae-de,Et=Ce-ge;for(Ge=0;Ge<41;Ge++)yt=(rt=(ot=B+(Fe=Ge/40)*Yt)+Fe*((pt=J+Fe*Jt)-ot))+Fe*(pt+Fe*(de+Fe*cn-pt)-rt),nt=(At=(ut=G+Fe*mn)+Fe*((ce=oe+Fe*bn)-ut))+Fe*(ce+Fe*(ge+Fe*Et-ce)-At),Ge==0?(xt=yt,vt=nt,Tt=yt,Lt=nt):(xt=Math.min(xt,yt),vt=Math.min(vt,nt),Tt=Math.max(Tt,yt),Lt=Math.max(Lt,nt));return new l(Math.round(xt),Math.round(vt),Math.round(Tt-xt),Math.round(Lt-vt))},Y=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var B,G,J=(B=this.ctx.lineDash,G=this.ctx.lineDashOffset,JSON.stringify({lineDash:B,lineDashOffset:G}));this.prevLineDash!==J&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=J)}}})(qt.API),(function(n){var e=function(o){var l,c,u,d,p,m,g,b,v,x;for(c=[],u=0,d=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;d>u;u+=4)(p=(o.charCodeAt(u)<<24)+(o.charCodeAt(u+1)<<16)+(o.charCodeAt(u+2)<<8)+o.charCodeAt(u+3))!==0?(m=(p=((p=((p=((p=(p-(x=p%85))/85)-(v=p%85))/85)-(b=p%85))/85)-(g=p%85))/85)%85,c.push(m+33,g+33,b+33,v+33,x+33)):c.push(122);return(function(S,C){for(var A=C;A>0;A--)S.pop()})(c,l.length),String.fromCharCode.apply(String,c)+"~>"},t=function(o){var l,c,u,d,p,m=String,g="length",b=255,v="charCodeAt",x="slice",S="replace";for(o[x](-2),o=o[x](0,-2)[S](/\s/g,"")[S]("z","!!!!!"),u=[],d=0,p=(o+=l="uuuuu"[x](o[g]%5||5))[g];p>d;d+=5)c=52200625*(o[v](d)-33)+614125*(o[v](d+1)-33)+7225*(o[v](d+2)-33)+85*(o[v](d+3)-33)+(o[v](d+4)-33),u.push(b&c>>24,b&c>>16,b&c>>8,b&c);return(function(C,A){for(var k=A;k>0;k--)C.pop()})(u,l[g]),m.fromCharCode.apply(m,u)},s=function(o){return o.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},r=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var c="",u=0;u<o.length;u+=2)c+=String.fromCharCode("0x"+(o[u]+o[u+1]));return c},a=function(o){for(var l=new Uint8Array(o.length),c=o.length;c--;)l[c]=o.charCodeAt(c);return(l=TE(l)).reduce(function(u,d){return u+String.fromCharCode(d)},"")};n.processDataByFilters=function(o,l){var c=0,u=o||"",d=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":u=t(u),d.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":u=e(u),d.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":u=r(u),d.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":u=s(u),d.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":u=a(u),d.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:u,reverseChain:d.reverse().join(" ")}}})(qt.API),(function(n){n.loadFile=function(e,t,s){return(function(r,a,o){a=a!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=(function(c,u,d){var p=new XMLHttpRequest,m=0,g=function(b){var v=b.length,x=[],S=String.fromCharCode;for(m=0;m<v;m+=1)x.push(S(255&b.charCodeAt(m)));return x.join("")};if(p.open("GET",c,!u),p.overrideMimeType("text/plain; charset=x-user-defined"),u===!1&&(p.onload=function(){p.status===200?d(g(this.responseText)):d(void 0)}),p.send(null),u&&p.status===200)return g(p.responseText)})(r,a,o)}catch{}return l})(e,t,s)},n.loadImageFile=n.loadFile})(qt.API),(function(n){function e(){return(wn.html2canvas?Promise.resolve(wn.html2canvas):fv(()=>import("./html2canvas.esm-3ybT_T2r.js"),[],import.meta.url)).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function t(){return(wn.DOMPurify?Promise.resolve(wn.DOMPurify):fv(()=>import("./purify.es-Bzr520pe.js"),[],import.meta.url)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var s=function(l){var c=Ns(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},r=function(l,c){var u=document.createElement(l);for(var d in c.className&&(u.className=c.className),c.innerHTML&&c.dompurify&&(u.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)u.style[d]=c.style[d];return u},a=function l(c,u){for(var d=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),p=c.firstChild;p;p=p.nextSibling)u!==!0&&p.nodeType===1&&p.nodeName==="SCRIPT"||d.appendChild(l(p,u));return c.nodeType===1&&(c.nodeName==="CANVAS"?(d.width=c.width,d.height=c.height,d.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(d.value=c.value),d.addEventListener("load",function(){d.scrollTop=c.scrollTop,d.scrollLeft=c.scrollLeft},!0)),d},o=function l(c){var u=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),d=l.convert(Promise.resolve(),u);return(d=d.setProgress(1,l,1,[l])).set(c)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,c){return l.__proto__=c||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,c){return this.then(function(){switch(c=c||(function(u){switch(s(u)){case"string":return"string";case"element":return u.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(l),c){case"string":return this.then(t).then(function(u){return this.set({src:r("div",{innerHTML:l,dompurify:u})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=r("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=r("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(r("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var u=Object.assign({},this.opt.html2canvas);return delete u.onrendered,c(this.prop.container,u)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var u=this.opt.jsPDF,d=this.opt.fontFaces,p=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,m=Object.assign({async:!0,allowTaint:!0,scale:p,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete m.onrendered,u.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,u.context2d.posX=this.opt.x,u.context2d.posY=this.opt.y,u.context2d.margin=this.opt.margin,u.context2d.fontFaces=d,d)for(var g=0;g<d.length;++g){var b=d[g],v=b.src.find(function(x){return x.format==="truetype"});v&&u.addFont(v.url,b.ref.name,b.ref.style)}return m.windowHeight=m.windowHeight||0,m.windowHeight=m.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):m.windowHeight,u.context2d.save(!0),c(this.prop.container,m)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,c,u){return(u=u||"pdf").toLowerCase()==="img"||u.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},o.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(s(l)!=="object")return this;var c=Object.keys(l||{}).map(function(u){if(u in o.template.prop)return function(){this.prop[u]=l[u]};switch(u){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[u]=l[u]}}},this);return this.then(function(){return this.thenList(c)})},o.prototype.get=function(l,c){return this.then(function(){var u=l in o.template.prop?this.prop[l]:this.opt[l];return c?c(u):u})},o.prototype.setMargin=function(l){return this.then(function(){switch(s(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function c(u,d){return Math.floor(u*d/72*96)}return this.then(function(){(l=l||qt.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,c,u,d){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),u!=null&&(this.progress.n=u),d!=null&&(this.progress.stack=d),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,c,u,d){return this.setProgress(l?this.progress.val+l:null,c||null,u?this.progress.n+u:null,d?this.progress.stack.concat(d):null)},o.prototype.then=function(l,c){var u=this;return this.thenCore(l,c,function(d,p){return u.updateProgress(null,null,1,[d]),Promise.prototype.then.call(this,function(m){return u.updateProgress(null,d),m}).then(d,p).then(function(m){return u.updateProgress(1),m})})},o.prototype.thenCore=function(l,c,u){u=u||Promise.prototype.then;var d=this;l&&(l=l.bind(d)),c&&(c=c.bind(d));var p=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?d:o.convert(Object.assign({},d),Promise.prototype),m=u.call(p,l,c);return o.convert(m,d.__proto__)},o.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},o.prototype.thenList=function(l){var c=this;return l.forEach(function(u){c=c.thenCore(u)}),c},o.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return o.convert(c,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,qt.getPageSize=function(l,c,u){if(Ns(l)==="object"){var d=l;l=d.orientation,c=d.unit||c,u=d.format||u}c=c||"mm",u=u||"a4",l=(""+(l||"P")).toLowerCase();var p,m=(""+u).toLowerCase(),g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":p=1;break;case"mm":p=72/25.4;break;case"cm":p=72/2.54;break;case"in":p=72;break;case"px":p=.75;break;case"pc":case"em":p=12;break;case"ex":p=6;break;default:throw"Invalid unit: "+c}var b,v=0,x=0;if(g.hasOwnProperty(m))v=g[m][1]/p,x=g[m][0]/p;else try{v=u[1],x=u[0]}catch{throw new Error("Invalid format: "+u)}if(l==="p"||l==="portrait")l="p",x>v&&(b=x,x=v,v=b);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",v>x&&(b=x,x=v,v=b)}return{width:x,height:v,unit:c,k:p,orientation:l}},n.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(E5):null;var u=new o(c);return c.worker?u:u.from(l).doCallback()}})(qt.API),qt.API.addJS=function(n){return z4=n,this.internal.events.subscribe("postPutResources",function(){wS=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(wS+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),P4=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+z4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){wS!==void 0&&P4!==void 0&&this.internal.out("/Names <</JavaScript "+wS+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,s=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=t.outline.render().split(/\r\n/),a=0;a<r.length;a++){var o=r[a],l=s.exec(o);if(l!=null){var c=l[1];t.internal.newObjectDeferredBegin(c,!1)}t.internal.write(o)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,d=[];for(a=0;a<u;a++){var p=t.internal.newObject();d.push(p);var m=t.internal.getPageInfo(a+1);t.internal.write("<< /D["+m.objId+" 0 R /XYZ null null null]>> endobj")}var g=t.internal.newObject();for(t.internal.write("<< /Names [ "),a=0;a<d.length;a++)t.internal.write("(page_"+(a+1)+")"+d[a]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+g+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(s,r,a){var o={title:r,options:a,children:[]};return s==null&&(s=this.root),s.children.push(o),o},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(s){s.id=t.internal.newObjectDeferred();for(var r=0;r<s.children.length;r++)this.genIds_r(s.children[r])},t.outline.renderRoot=function(s){this.objStart(s),this.line("/Type /Outlines"),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1]))),this.line("/Count "+this.count_r({count:0},s)),this.objEnd()},t.outline.renderItems=function(s){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,a=0;a<s.children.length;a++){var o=s.children[a];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(s)),a>0&&this.line("/Prev "+this.makeRef(s.children[a-1])),a<s.children.length-1&&this.line("/Next "+this.makeRef(s.children[a+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var c=t.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var u=0;u<s.children.length;u++)this.renderItems(s.children[u])},t.outline.line=function(s){this.ctx.val+=s+`\r
`},t.outline.makeRef=function(s){return s.id+" 0 R"},t.outline.makeString=function(s){return"("+t.internal.pdfEscape(s)+")"},t.outline.objStart=function(s){this.ctx.val+=`\r
`+s.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(s,r){for(var a=0;a<r.children.length;a++)s.count++,this.count_r(s,r.children[a]);return s.count}}])})(qt.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,s,r,a,o,l){var c,u=this.decode.DCT_DECODE,d=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=o||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,c=(function(p){for(var m,g=256*p.charCodeAt(4)+p.charCodeAt(5),b=p.length,v={width:0,height:0,numcomponents:1},x=4;x<b;x+=2){if(x+=g,e.indexOf(p.charCodeAt(x+1))!==-1){m=256*p.charCodeAt(x+5)+p.charCodeAt(x+6),v={width:256*p.charCodeAt(x+7)+p.charCodeAt(x+8),height:m,numcomponents:p.charCodeAt(x+9)};break}g=256*p.charCodeAt(x+2)+p.charCodeAt(x+3)}return v})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}d={data:t,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:u,index:s,alias:r}}return d}})(qt.API),qt.API.processPNG=function(n,e,t,s){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var r,a=ate(n,{checkCrc:!0}),o=a.width,l=a.height,c=a.channels,u=a.palette,d=a.depth;r=u&&c===1?(function(M){for(var R=M.width,z=M.height,I=M.data,j=M.palette,H=M.depth,q=!1,re=[],X=[],ne=void 0,Q=!1,he=0,ye=0;ye<j.length;ye++){var Y=V6(j[ye],4),B=Y[0],G=Y[1],J=Y[2],oe=Y[3];re.push(B,G,J),oe!=null&&(oe===0?(he++,X.length<1&&X.push(ye)):oe<255&&(Q=!0))}if(Q||he>1){q=!0,X=void 0;var de=R*z;ne=new Uint8Array(de);for(var ge=new DataView(I.buffer),Ae=0;Ae<de;Ae++){var Ce=O5(ge,Ae,H),Fe=V6(j[Ce],4)[3];ne[Ae]=Fe}}else he===0&&(X=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:q?8:void 0,colorBytes:I,alphaBytes:ne,needSMask:q,palette:re,mask:X}})(a):c===2||c===4?(function(M){for(var R=M.data,z=M.width,I=M.height,j=M.channels,H=M.depth,q=j===2?"DeviceGray":"DeviceRGB",re=j-1,X=z*I,ne=re,Q=X*ne,he=1*X,ye=Math.ceil(Q*H/8),Y=Math.ceil(he*H/8),B=new Uint8Array(ye),G=new Uint8Array(Y),J=new DataView(R.buffer),oe=new DataView(B.buffer),de=new DataView(G.buffer),ge=!1,Ae=0;Ae<X;Ae++){for(var Ce=Ae*j,Fe=0;Fe<ne;Fe++)X4(oe,O5(J,Ce+Fe,H),Ae*ne+Fe,H);var Ge=O5(J,Ce+ne,H);Ge<(1<<H)-1&&(ge=!0),X4(de,Ge,1*Ae,H)}return{colorSpace:q,colorsPerPixel:re,sMaskBitsPerComponent:ge?H:void 0,colorBytes:B,alphaBytes:G,needSMask:ge}})(a):(function(M){var R=M.data,z=M.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:z,colorsPerPixel:z==="DeviceGray"?1:3,colorBytes:R instanceof Uint16Array?(function(I){for(var j=I.length,H=new Uint8Array(2*j),q=new DataView(H.buffer,H.byteOffset,H.byteLength),re=0;re<j;re++)q.setUint16(2*re,I[re],!1);return H})(R):R,needSMask:!1}})(a);var p,m,g,b=r,v=b.colorSpace,x=b.colorsPerPixel,S=b.sMaskBitsPerComponent,C=b.colorBytes,A=b.alphaBytes,k=b.needSMask,O=b.palette,F=b.mask,$=null;return s!==qt.API.image_compression.NONE&&typeof TE=="function"?($=(function(M){var R;switch(M){case qt.API.image_compression.FAST:R=11;break;case qt.API.image_compression.MEDIUM:R=13;break;case qt.API.image_compression.SLOW:R=14;break;default:R=12}return R})(s),p=this.decode.FLATE_DECODE,m="/Predictor ".concat($," /Colors ").concat(x," /BitsPerComponent ").concat(d," /Columns ").concat(o),n=V4(C,Math.ceil(o*x*d/8),x,d,s),k&&(g=V4(A,Math.ceil(o*S/8),1,S,s))):(p=void 0,m=void 0,n=C,k&&(g=A)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(g&&this.__addimage__.isArrayBuffer(g)||this.__addimage__.isArrayBufferView(g))&&(g=this.__addimage__.arrayBufferToBinaryString(g)),{alias:t,data:n,index:e,filter:p,decodeParameters:m,transparency:F,palette:O,sMask:g,predictor:$,width:o,height:l,bitsPerComponent:d,sMaskBitsPerComponent:S,colorSpace:v}}},(function(n){n.processGIF89A=function(e,t,s,r){var a=new Nte(e),o=a.width,l=a.height,c=[];a.decodeAndBlitFrameRGBA(0,c);var u={data:c,width:o,height:l},d=new D5(100).encode(u,100);return n.processJPEG.call(this,d,t,s,r)},n.processGIF87A=n.processGIF89A})(qt.API),Yc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:r,green:s,blue:t,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Yc.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[n]()}catch(t){Vs.log("bit decode error:"+t)}},Yc.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var s=this.bottom_up?n:this.height-1-n,r=0;r<e;r++)for(var a=this.datav.getUint8(this.pos++,!0),o=s*this.width*4+8*r*4,l=0;l<8&&8*r+l<this.width;l++){var c=this.palette[a>>7-l&1];this.data[o+4*l]=c.blue,this.data[o+4*l+1]=c.green,this.data[o+4*l+2]=c.red,this.data[o+4*l+3]=255}t!==0&&(this.pos+=4-t)}},Yc.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var s=this.bottom_up?t:this.height-1-t,r=0;r<n;r++){var a=this.datav.getUint8(this.pos++,!0),o=s*this.width*4+2*r*4,l=a>>4,c=15&a,u=this.palette[l];if(this.data[o]=u.blue,this.data[o+1]=u.green,this.data[o+2]=u.red,this.data[o+3]=255,2*r+1>=this.width)break;u=this.palette[c],this.data[o+4]=u.blue,this.data[o+4+1]=u.green,this.data[o+4+2]=u.red,this.data[o+4+3]=255}e!==0&&(this.pos+=4-e)}},Yc.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,s=0;s<this.width;s++){var r=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*s;if(r<this.palette.length){var o=this.palette[r];this.data[a]=o.red,this.data[a+1]=o.green,this.data[a+2]=o.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}n!==0&&(this.pos+=4-n)}},Yc.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var s=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,l=(a>>5&e)/e*255|0,c=(a>>10&e)/e*255|0,u=a>>15?255:0,d=s*this.width*4+4*r;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=o,this.data[d+3]=u}this.pos+=n}},Yc.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),s=this.height-1;s>=0;s--){for(var r=this.bottom_up?s:this.height-1-s,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,c=(o>>5&t)/t*255|0,u=(o>>11)/e*255|0,d=r*this.width*4+4*a;this.data[d]=u,this.data[d+1]=c,this.data[d+2]=l,this.data[d+3]=255}this.pos+=n}},Yc.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var s=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*t;this.data[o]=a,this.data[o+1]=r,this.data[o+2]=s,this.data[o+3]=255}this.pos+=this.width%4}},Yc.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var s=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*t;this.data[l]=a,this.data[l+1]=r,this.data[l+2]=s,this.data[l+3]=o}},Yc.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,s,r){var a=new Yc(e,!1),o=a.width,l=a.height,c={data:a.getData(),width:o,height:l},u=new D5(100).encode(c,100);return n.processJPEG.call(this,u,t,s,r)}})(qt.API),K4.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,s,r){var a=new K4(e),o=a.width,l=a.height,c={data:a.getData(),width:o,height:l},u=new D5(100).encode(c,100);return n.processJPEG.call(this,u,t,s,r)}})(qt.API),qt.API.processRGBA=function(n,e,t){for(var s=n.data,r=s.length,a=new Uint8Array(r/4*3),o=new Uint8Array(r/4),l=0,c=0,u=0;u<r;u+=4){var d=s[u],p=s[u+1],m=s[u+2],g=s[u+3];a[l++]=d,a[l++]=p,a[l++]=m,o[c++]=g}var b=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:b,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},qt.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},u0=qt.API,xS=u0.getCharWidthsArray=function(n,e){var t,s,r=(e=e||{}).font||this.internal.getFont(),a=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),l=e.widths?e.widths:r.metadata.Unicode.widths,c=l.fof?l.fof:1,u=e.kerning?e.kerning:r.metadata.Unicode.kerning,d=u.fof?u.fof:1,p=e.doKerning!==!1,m=0,g=n.length,b=0,v=l[0]||c,x=[];for(t=0;t<g;t++)s=n.charCodeAt(t),typeof r.metadata.widthOfString=="function"?x.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(s))+o*(1e3/a)||0)/1e3):(m=p&&Ns(u[s])==="object"&&!isNaN(parseInt(u[s][b],10))?u[s][b]/d:0,x.push((l[s]||v)/c+m)),b=s;return x},B4=u0.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),s=e.font||this.internal.getFont(),r=e.charSpace||this.internal.getCharSpace();return u0.processArabic&&(n=u0.processArabic(n)),typeof s.metadata.widthOfString=="function"?s.metadata.widthOfString(n,t,r)/t:xS.apply(this,arguments).reduce(function(a,o){return a+o},0)},j4=function(n,e,t,s){for(var r=[],a=0,o=n.length,l=0;a!==o&&l+e[a]<t;)l+=e[a],a++;r.push(n.slice(0,a));var c=a;for(l=0;a!==o;)l+e[a]>s&&(r.push(n.slice(c,a)),l=0,c=a),l+=e[a],a++;return c!==a&&r.push(n.slice(c,a)),r},U4=function(n,e,t){t||(t={});var s,r,a,o,l,c,u,d=[],p=[d],m=t.textIndent||0,g=0,b=0,v=n.split(" "),x=xS.apply(this,[" ",t])[0];if(c=t.lineIndent===-1?v[0].length+2:t.lineIndent||0){var S=Array(c).join(" "),C=[];v.map(function(k){(k=k.split(/\s*\n/)).length>1?C=C.concat(k.map(function(O,F){return(F&&O.length?`
`:"")+O})):C.push(k[0])}),v=C,c=B4.apply(this,[S,t])}for(a=0,o=v.length;a<o;a++){var A=0;if(s=v[a],c&&s[0]==`
`&&(s=s.substr(1),A=1),m+g+(b=(r=xS.apply(this,[s,t])).reduce(function(k,O){return k+O},0))>e||A){if(b>e){for(l=j4.apply(this,[s,r,e-(m+g),e]),d.push(l.shift()),d=[l.pop()];l.length;)p.push([l.shift()]);b=r.slice(s.length-(d[0]?d[0].length:0)).reduce(function(k,O){return k+O},0)}else d=[s];p.push(d),m=b+c,g=x}else d.push(s),m+=g+b,g=x}return u=c?function(k,O){return(O?S:"")+k.join(" ")}:function(k){return k.join(" ")},p.map(u)},u0.splitTextToSize=function(n,e,t){var s,r=(t=t||{}).fontSize||this.internal.getFontSize(),a=(function(d){if(d.widths&&d.kerning)return{widths:d.widths,kerning:d.kerning};var p=this.internal.getFont(d.fontName,d.fontStyle),m="Unicode";return p.metadata[m]?{widths:p.metadata[m].widths||{0:1},kerning:p.metadata[m].kerning||{}}:{font:p.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);s=Array.isArray(n)?n:String(n).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/r;a.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/r:0,a.lineIndent=t.lineIndent;var l,c,u=[];for(l=0,c=s.length;l<c;l++)u=u.concat(U4.apply(this,[s[l],o,a]));return u},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",s={},r={},a=0;a<16;a++)s[t[a]]=e[a],r[e[a]]=t[a];var o=function(m){return"0x"+parseInt(m,10).toString(16)},l=n.__fontmetrics__.compress=function(m){var g,b,v,x,S=["{"];for(var C in m){if(g=m[C],isNaN(parseInt(C,10))?b="'"+C+"'":(C=parseInt(C,10),b=(b=o(C).slice(2)).slice(0,-1)+r[b.slice(-1)]),typeof g=="number")g<0?(v=o(g).slice(3),x="-"):(v=o(g).slice(2),x=""),v=x+v.slice(0,-1)+r[v.slice(-1)];else{if(Ns(g)!=="object")throw new Error("Don't know what to do with value type "+Ns(g)+".");v=l(g)}S.push(b+v)}return S.push("}"),S.join("")},c=n.__fontmetrics__.uncompress=function(m){if(typeof m!="string")throw new Error("Invalid argument passed to uncompress.");for(var g,b,v,x,S={},C=1,A=S,k=[],O="",F="",$=m.length-1,M=1;M<$;M+=1)(x=m[M])=="'"?g?(v=g.join(""),g=void 0):g=[]:g?g.push(x):x=="{"?(k.push([A,v]),A={},v=void 0):x=="}"?((b=k.pop())[0][b[1]]=A,v=void 0,A=b[0]):x=="-"?C=-1:v===void 0?s.hasOwnProperty(x)?(O+=s[x],v=parseInt(O,16)*C,C=1,O=""):O+=x:s.hasOwnProperty(x)?(F+=s[x],A[v]=parseInt(F,16)*C,C=1,v=void 0,F=""):F+=x;return S},u={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:u,"Courier-Bold":u,"Courier-BoldOblique":u,"Courier-Oblique":u,Helvetica:u,"Helvetica-Bold":u,"Helvetica-BoldOblique":u,"Helvetica-Oblique":u,"Times-Roman":u,"Times-Bold":u,"Times-BoldItalic":u,"Times-Italic":u}},p={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(m){var g=m.font,b=p.Unicode[g.postScriptName];b&&(g.metadata.Unicode={},g.metadata.Unicode.widths=b.widths,g.metadata.Unicode.kerning=b.kerning);var v=d.Unicode[g.postScriptName];v&&(g.metadata.Unicode.encoding=v,g.encoding=v.codePages[0])}])})(qt.API),(function(n){var e=function(t){for(var s=t.length,r=new Uint8Array(s),a=0;a<s;a++)r[a]=t.charCodeAt(a);return r};n.API.events.push(["addFont",function(t){var s=void 0,r=t.font,a=t.instance;if(!r.isStandardFont){if(a===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if(typeof(s=a.existsFileInVFS(r.postScriptName)===!1?a.loadFile(r.postScriptName):a.getFileFromVFS(r.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?e(l):e(qS(l)),o.metadata=n.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(r,s)}}])})(qt),qt.API.addSvgAsImage=function(n,e,t,s,r,a,o,l){if(isNaN(e)||isNaN(t))throw Vs.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(r))throw Vs.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=s,c.height=r;var u=c.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height);var d={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return(wn.canvg?Promise.resolve(wn.canvg):fv(()=>import("./index.es-DJzR0Tj3.js"),__vite__mapDeps([0,1,2]),import.meta.url)).catch(function(m){return Promise.reject(new Error("Could not load canvg: "+m))}).then(function(m){return m.default?m.default:m}).then(function(m){return m.fromString(u,n,d)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(m){return m.render(d)}).then(function(){p.addImage(c.toDataURL("image/jpeg",1),e,t,s,r,o,l)})},qt.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var s=1;s<=this.internal.getNumberOfPages();s++)for(var r=0;r<this.internal.pages[s].length;r++)this.internal.pages[s][r]=this.internal.pages[s][r].replace(e,t);return this},qt.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var s,r,a,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),c=[],u=0,d=0,p=0;function m(b,v){var x,S=!1;for(x=0;x<b.length;x+=1)b[x]===v&&(S=!0);return S}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var g=l.length;for(p=0;p<g;p+=1)t[l[p]].value=t[l[p]].defaultValue,t[l[p]].explicitSet=!1}if(Ns(n)==="object"){for(r in n)if(a=n[r],m(l,r)&&a!==void 0){if(t[r].type==="boolean"&&typeof a=="boolean")t[r].value=a;else if(t[r].type==="name"&&m(t[r].valueSet,a))t[r].value=a;else if(t[r].type==="integer"&&Number.isInteger(a))t[r].value=a;else if(t[r].type==="array"){for(u=0;u<a.length;u+=1)if(s=!0,a[u].length===1&&typeof a[u][0]=="number")c.push(String(a[u]-1));else if(a[u].length>1){for(d=0;d<a[u].length;d+=1)typeof a[u][d]!="number"&&(s=!1);s===!0&&c.push([a[u][0]-1,a[u][1]-1].join(" "))}t[r].value="["+c.join(" ")+"]"}else t[r].value=t[r].defaultValue;t[r].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var b,v=[];for(b in t)t[b].explicitSet===!0&&(t[b].type==="name"?v.push("/"+b+" /"+t[b].value):v.push("/"+b+" "+t[b].value));v.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+v.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(n){var e=function(){var s='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',r=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),a=unescape(encodeURIComponent(s)),o=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),u=a.length+o.length+l.length+r.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+u+" >>"),this.internal.write("stream"),this.internal.write(r+a+o+l+c),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(s,r){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:s,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(qt.API),(function(n){var e=n.API,t=e.pdfEscape16=function(a,o){for(var l,c=o.metadata.Unicode.widths,u=["","0","00","000","0000"],d=[""],p=0,m=a.length;p<m;++p){if(l=o.metadata.characterToGlyph(a.charCodeAt(p)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=a.charCodeAt(p),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return d.join("");l=l.toString(16),d.push(u[4-l.length],l)}return d.join("")},s=function(a){var o,l,c,u,d,p,m;for(d=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],p=0,m=(l=Object.keys(a).sort(function(g,b){return g-b})).length;p<m;p++)o=l[p],c.length>=100&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),a[o]!==void 0&&a[o]!==null&&typeof a[o].toString=="function"&&(u=("0000"+a[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),c.push("<"+o+"><"+u+">"));return c.length&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),d+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(a){(function(o){var l=o.font,c=o.out,u=o.newObject,d=o.putStream;if(l.metadata instanceof n.API.TTFFont&&l.encoding==="Identity-H"){for(var p=l.metadata.Unicode.widths,m=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),g="",b=0;b<m.length;b++)g+=String.fromCharCode(m[b]);var v=u();d({data:g,addLength1:!0,objectId:v}),c("endobj");var x=u();d({data:s(l.metadata.toUnicode),addLength1:!0,objectId:x}),c("endobj");var S=u();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+p0(l.fontName)),c("/FontFile2 "+v+" 0 R"),c("/FontBBox "+n.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var C=u();c("<<"),c("/Type /Font"),c("/BaseFont /"+p0(l.fontName)),c("/FontDescriptor "+S+" 0 R"),c("/W "+n.API.PDFObject.convert(p)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=u(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+x+" 0 R"),c("/BaseFont /"+p0(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+C+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(a)}]),e.events.push(["putFont",function(a){(function(o){var l=o.font,c=o.out,u=o.newObject,d=o.putStream;if(l.metadata instanceof n.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var p=l.metadata.rawData,m="",g=0;g<p.length;g++)m+=String.fromCharCode(p[g]);var b=u();d({data:m,addLength1:!0,objectId:b}),c("endobj");var v=u();d({data:s(l.metadata.toUnicode),addLength1:!0,objectId:v}),c("endobj");var x=u();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+b+" 0 R"),c("/Flags 96"),c("/FontBBox "+n.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+p0(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=u();for(var S=0;S<l.metadata.hmtx.widths.length;S++)l.metadata.hmtx.widths[S]=parseInt(l.metadata.hmtx.widths[S]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+v+" 0 R/BaseFont/"+p0(l.fontName)+"/FontDescriptor "+x+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(a)}]);var r=function(a){var o,l=a.text||"",c=a.x,u=a.y,d=a.options||{},p=a.mutex||{},m=p.pdfEscape,g=p.activeFontKey,b=p.fonts,v=g,x="",S=0,C="",A=b[v].encoding;if(b[v].encoding!=="Identity-H")return{text:l,x:c,y:u,options:d,mutex:p};for(C=l,v=g,Array.isArray(l)&&(C=l[0]),S=0;S<C.length;S+=1)b[v].metadata.hasOwnProperty("cmap")&&(o=b[v].metadata.cmap.unicode.codeMap[C[S].charCodeAt(0)]),o||C[S].charCodeAt(0)<256&&b[v].metadata.hasOwnProperty("Unicode")?x+=C[S]:x+="";var k="";return parseInt(v.slice(1))<14||A==="WinAnsiEncoding"?k=m(x,v).split("").map(function(O){return O.charCodeAt(0).toString(16)}).join(""):A==="Identity-H"&&(k=t(x,b[v])),p.isHex=!0,{text:k,x:c,y:u,options:d,mutex:p}};e.events.push(["postProcessText",function(a){var o=a.text||"",l=[],c={text:o,x:a.x,y:a.y,options:a.options,mutex:a.mutex};if(Array.isArray(o)){var u=0;for(u=0;u<o.length;u+=1)Array.isArray(o[u])&&o[u].length===3?l.push([r(Object.assign({},c,{text:o[u][0]})).text,o[u][1],o[u][2]]):l.push(r(Object.assign({},c,{text:o[u]})).text);a.text=l}else a.text=r(Object.assign({},c,{text:o})).text}])})(qt),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,s){return e.call(this),this.internal.vFS[t]=s,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(qt.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(s){var r,a,o,l,c,u,d,p=e,m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],b={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},v={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},x=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],S=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),C=!1,A=0;this.__bidiEngine__={};var k=function(I){var j=I.charCodeAt(),H=j>>8,q=v[H];return q!==void 0?p[256*q+(255&j)]:H===252||H===253?"AL":S.test(H)?"L":H===8?"R":"N"},O=function(I){for(var j,H=0;H<I.length;H++){if((j=k(I.charAt(H)))==="L")return!1;if(j==="R")return!0}return!1},F=function(I,j,H,q){var re,X,ne,Q,he=j[q];switch(he){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":C=!1;break;case"N":case"AN":break;case"EN":C&&(he="AN");break;case"AL":C=!0,he="R";break;case"WS":case"BN":he="N";break;case"CS":q<1||q+1>=j.length||(re=H[q-1])!=="EN"&&re!=="AN"||(X=j[q+1])!=="EN"&&X!=="AN"?he="N":C&&(X="AN"),he=X===re?X:"N";break;case"ES":he=(re=q>0?H[q-1]:"B")==="EN"&&q+1<j.length&&j[q+1]==="EN"?"EN":"N";break;case"ET":if(q>0&&H[q-1]==="EN"){he="EN";break}if(C){he="N";break}for(ne=q+1,Q=j.length;ne<Q&&j[ne]==="ET";)ne++;he=ne<Q&&j[ne]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(Q=j.length,ne=q+1;ne<Q&&j[ne]==="NSM";)ne++;if(ne<Q){var ye=I[q],Y=ye>=1425&&ye<=2303||ye===64286;if(re=j[ne],Y&&(re==="R"||re==="AL")){he="R";break}}}he=q<1||(re=j[q-1])==="B"?"N":H[q-1];break;case"B":C=!1,r=!0,he=A;break;case"S":a=!0,he="N"}return he},$=function(I,j,H){var q=I.split("");return H&&M(q,H,{hiLevel:A}),q.reverse(),j&&j.reverse(),q.join("")},M=function(I,j,H){var q,re,X,ne,Q,he=-1,ye=I.length,Y=0,B=[],G=A?g:m,J=[];for(C=!1,r=!1,a=!1,re=0;re<ye;re++)J[re]=k(I[re]);for(X=0;X<ye;X++){if(Q=Y,B[X]=F(I,J,B,X),q=240&(Y=G[Q][b[B[X]]]),Y&=15,j[X]=ne=G[Y][5],q>0)if(q===16){for(re=he;re<X;re++)j[re]=1;he=-1}else he=-1;if(G[Y][6])he===-1&&(he=X);else if(he>-1){for(re=he;re<X;re++)j[re]=ne;he=-1}J[X]==="B"&&(j[X]=0),H.hiLevel|=ne}a&&(function(oe,de,ge){for(var Ae=0;Ae<ge;Ae++)if(oe[Ae]==="S"){de[Ae]=A;for(var Ce=Ae-1;Ce>=0&&oe[Ce]==="WS";Ce--)de[Ce]=A}})(J,j,ye)},R=function(I,j,H,q,re){if(!(re.hiLevel<I)){if(I===1&&A===1&&!r)return j.reverse(),void(H&&H.reverse());for(var X,ne,Q,he,ye=j.length,Y=0;Y<ye;){if(q[Y]>=I){for(Q=Y+1;Q<ye&&q[Q]>=I;)Q++;for(he=Y,ne=Q-1;he<ne;he++,ne--)X=j[he],j[he]=j[ne],j[ne]=X,H&&(X=H[he],H[he]=H[ne],H[ne]=X);Y=Q}Y++}}},z=function(I,j,H){var q=I.split(""),re={hiLevel:A};return H||(H=[]),M(q,H,re),(function(X,ne,Q){if(Q.hiLevel!==0&&d)for(var he,ye=0;ye<X.length;ye++)ne[ye]===1&&(he=x.indexOf(X[ye]))>=0&&(X[ye]=x[he+1])})(q,H,re),R(2,q,j,H,re),R(1,q,j,H,re),q.join("")};return this.__bidiEngine__.doBidiReorder=function(I,j,H){if((function(re,X){if(X)for(var ne=0;ne<re.length;ne++)X[ne]=ne;l===void 0&&(l=O(re)),u===void 0&&(u=O(re))})(I,j),o||!c||u)if(o&&c&&l^u)A=l?1:0,I=$(I,j,H);else if(!o&&c&&u)A=l?1:0,I=z(I,j,H),I=$(I,j);else if(!o||l||c||u){if(o&&!c&&l^u)I=$(I,j),l?(A=0,I=z(I,j,H)):(A=1,I=z(I,j,H),I=$(I,j));else if(o&&l&&!c&&u)A=1,I=z(I,j,H),I=$(I,j);else if(!o&&!c&&l^u){var q=d;l?(A=1,I=z(I,j,H),A=0,d=!1,I=z(I,j,H),d=q):(A=0,I=z(I,j,H),I=$(I,j),A=1,d=!1,I=z(I,j,H),d=q,I=$(I,j))}}else A=0,I=z(I,j,H);else A=l?1:0,I=z(I,j,H);return I},this.__bidiEngine__.setOptions=function(I){I&&(o=I.isInputVisual,c=I.isOutputVisual,l=I.isInputRtl,u=I.isOutputRtl,d=I.isSymmetricSwapping)},this.__bidiEngine__.setOptions(s),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(s){var r=s.text;s.x,s.y;var a=s.options||{};s.mutex,a.lang;var o=[];if(a.isInputVisual=typeof a.isInputVisual!="boolean"||a.isInputVisual,t.setOptions(a),Object.prototype.toString.call(r)==="[object Array]"){var l=0;for(o=[],l=0;l<r.length;l+=1)Object.prototype.toString.call(r[l])==="[object Array]"?o.push([t.doBidiReorder(r[l][0]),r[l][1],r[l][2]]):o.push([t.doBidiReorder(r[l])]);s.text=o}else s.text=t.doBidiReorder(r);t.setOptions({isInputVisual:!0})}])})(qt),qt.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new Vf(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Ute(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new Ate(this.contents),this.head=new Ite(this),this.name=new Lte(this),this.cmap=new P7(this),this.toUnicode={},this.hhea=new Ote(this),this.maxp=new Fte(this),this.hmtx=new Mte(this),this.post=new $te(this),this.os2=new Dte(this),this.loca=new jte(this),this.glyf=new Pte(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,s,r,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,c,u;for(u=[],o=0,l=(c=this.bbox).length;o<l;o++)e=c[o],u.push(Math.round(e*this.scaleFactor));return u}).call(this),this.stemV=0,this.post.exists?(s=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+s)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(a=this.familyClass)===1||a===2||a===3||a===4||a===5||a===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,s){var r,a,o,l;for(o=0,a=0,l=(e=""+e).length;0<=l?a<l:a>l;a=0<=l?++a:--a)r=e.charCodeAt(a),o+=this.widthOfGlyph(this.characterToGlyph(r))+s*(1e3/t)||0;return o*(t/1e3)},n.prototype.lineHeight=function(e,t){var s;return t==null&&(t=!1),s=t?this.lineGap:0,(this.ascender+s-this.decender)/1e3*e},n})();var xu,Vf=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,s;for(s=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)s[t]=String.fromCharCode(this.readByte());return s.join("")},n.prototype.writeString=function(e){var t,s,r;for(r=[],t=0,s=e.length;0<=s?t<s:t>s;t=0<=s?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,s,r,a,o,l,c;return e=this.readByte(),t=this.readByte(),s=this.readByte(),r=this.readByte(),a=this.readByte(),o=this.readByte(),l=this.readByte(),c=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^s)+4294967296*(255^r)+16777216*(255^a)+65536*(255^o)+256*(255^l)+(255^c)+1):72057594037927940*e+281474976710656*t+1099511627776*s+4294967296*r+16777216*a+65536*o+256*l+c},n.prototype.writeLongLong=function(e){var t,s;return t=Math.floor(e/4294967296),s=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(s>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,s;for(t=[],s=0;0<=e?s<e:s>e;s=0<=e?++s:--s)t.push(this.readByte());return t},n.prototype.write=function(e){var t,s,r,a;for(a=[],s=0,r=e.length;s<r;s++)t=e[s],a.push(this.writeByte(t));return a},n})(),Ate=(function(){var n;function e(t){var s,r,a;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},r=0,a=this.tableCount;0<=a?r<a:r>a;r=0<=a?++r:--r)s={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[s.tag]=s}return e.prototype.encode=function(t){var s,r,a,o,l,c,u,d,p,m,g,b,v;for(v in g=Object.keys(t).length,c=Math.log(2),p=16*Math.floor(Math.log(g)/c),o=Math.floor(p/c),d=16*g-p,(r=new Vf).writeInt(this.scalarType),r.writeShort(g),r.writeShort(p),r.writeShort(o),r.writeShort(d),a=16*g,u=r.pos+a,l=null,b=[],t)for(m=t[v],r.writeString(v),r.writeInt(n(m)),r.writeInt(u),r.writeInt(m.length),b=b.concat(m),v==="head"&&(l=u),u+=m.length;u%4;)b.push(0),u++;return r.write(b),s=2981146554-n(r.data),r.pos=l+8,r.writeUInt32(s),r.data},n=function(t){var s,r,a,o;for(t=z7.call(t);t.length%4;)t.push(0);for(a=new Vf(t),r=0,s=0,o=t.length;s<o;s=s+=4)r+=a.readUInt32();return 4294967295&r},e})(),Ete={}.hasOwnProperty,kh=function(n,e){for(var t in e)Ete.call(e,t)&&(n[t]=e[t]);function s(){this.constructor=n}return s.prototype=e.prototype,n.prototype=new s,n.__super__=e.prototype,n};xu=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var Ite=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new Vf).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),Z4=(function(){function n(e,t){var s,r,a,o,l,c,u,d,p,m,g,b,v,x,S,C,A;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),p=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=e.readByte();break;case 4:for(g=e.readUInt16(),m=g/2,e.pos+=6,a=(function(){var k,O;for(O=[],c=k=0;0<=m?k<m:k>m;c=0<=m?++k:--k)O.push(e.readUInt16());return O})(),e.pos+=2,v=(function(){var k,O;for(O=[],c=k=0;0<=m?k<m:k>m;c=0<=m?++k:--k)O.push(e.readUInt16());return O})(),u=(function(){var k,O;for(O=[],c=k=0;0<=m?k<m:k>m;c=0<=m?++k:--k)O.push(e.readUInt16());return O})(),d=(function(){var k,O;for(O=[],c=k=0;0<=m?k<m:k>m;c=0<=m?++k:--k)O.push(e.readUInt16());return O})(),r=(this.length-e.pos+this.offset)/2,l=(function(){var k,O;for(O=[],c=k=0;0<=r?k<r:k>r;c=0<=r?++k:--k)O.push(e.readUInt16());return O})(),c=S=0,A=a.length;S<A;c=++S)for(x=a[c],s=C=b=v[c];b<=x?C<=x:C>=x;s=b<=x?++C:--C)d[c]===0?o=s+u[c]:(o=l[d[c]/2+(s-b)-(m-c)]||0)!==0&&(o+=u[c]),this.codeMap[s]=65535&o}e.pos=p}return n.encode=function(e,t){var s,r,a,o,l,c,u,d,p,m,g,b,v,x,S,C,A,k,O,F,$,M,R,z,I,j,H,q,re,X,ne,Q,he,ye,Y,B,G,J,oe,de,ge,Ae,Ce,Fe,Ge,ot;switch(q=new Vf,o=Object.keys(e).sort(function(ut,pt){return ut-pt}),t){case"macroman":for(v=0,x=(function(){var ut=[];for(b=0;b<256;++b)ut.push(0);return ut})(),C={0:0},a={},re=0,he=o.length;re<he;re++)C[Ce=e[r=o[re]]]==null&&(C[Ce]=++v),a[r]={old:e[r],new:C[e[r]]},x[r]=C[e[r]];return q.writeUInt16(1),q.writeUInt16(0),q.writeUInt32(12),q.writeUInt16(0),q.writeUInt16(262),q.writeUInt16(0),q.write(x),{charMap:a,subtable:q.data,maxGlyphID:v+1};case"unicode":for(j=[],p=[],A=0,C={},s={},S=u=null,X=0,ye=o.length;X<ye;X++)C[O=e[r=o[X]]]==null&&(C[O]=++A),s[r]={old:O,new:C[O]},l=C[O]-r,S!=null&&l===u||(S&&p.push(S),j.push(r),u=l),S=r;for(S&&p.push(S),p.push(65535),j.push(65535),z=2*(R=j.length),M=2*Math.pow(Math.log(R)/Math.LN2,2),m=Math.log(M/2)/Math.LN2,$=2*R-M,c=[],F=[],g=[],b=ne=0,Y=j.length;ne<Y;b=++ne){if(I=j[b],d=p[b],I===65535){c.push(0),F.push(0);break}if(I-(H=s[I].new)>=32768)for(c.push(0),F.push(2*(g.length+R-b)),r=Q=I;I<=d?Q<=d:Q>=d;r=I<=d?++Q:--Q)g.push(s[r].new);else c.push(H-I),F.push(0)}for(q.writeUInt16(3),q.writeUInt16(1),q.writeUInt32(12),q.writeUInt16(4),q.writeUInt16(16+8*R+2*g.length),q.writeUInt16(0),q.writeUInt16(z),q.writeUInt16(M),q.writeUInt16(m),q.writeUInt16($),ge=0,B=p.length;ge<B;ge++)r=p[ge],q.writeUInt16(r);for(q.writeUInt16(0),Ae=0,G=j.length;Ae<G;Ae++)r=j[Ae],q.writeUInt16(r);for(Fe=0,J=c.length;Fe<J;Fe++)l=c[Fe],q.writeUInt16(l);for(Ge=0,oe=F.length;Ge<oe;Ge++)k=F[Ge],q.writeUInt16(k);for(ot=0,de=g.length;ot<de;ot++)v=g[ot],q.writeUInt16(v);return{charMap:s,subtable:q.data,maxGlyphID:A+1}}},n})(),P7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,s,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=r?s<r:s>r;s=0<=r?++s:--s)t=new Z4(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var s,r;return t==null&&(t="macroman"),s=Z4.encode(e,t),(r=new Vf).writeUInt16(0),r.writeUInt16(1),s.table=r.data.concat(s.subtable),s},n})(),Ote=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),Dte=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,s;for(s=[],t=0;t<10;++t)s.push(e.readByte());return s})(),this.charRange=(function(){var t,s;for(s=[],t=0;t<4;++t)s.push(e.readInt());return s})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,s;for(s=[],t=0;t<2;t=++t)s.push(e.readInt());return s})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),$te=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="post",n.prototype.parse=function(e){var t,s,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(s=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=s?a<s:a>s;a=0<=s?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return s=e.readUInt16(),this.offsets=e.read(s);case 262144:return this.map=(function(){var o,l,c;for(c=[],a=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;a=0<=l?++o:--o)c.push(e.readUInt32());return c}).call(this)}},n})(),Rte=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Lte=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="name",n.prototype.parse=function(e){var t,s,r,a,o,l,c,u,d,p,m;for(e.pos=this.offset,e.readShort(),t=e.readShort(),l=e.readShort(),s=[],a=0;0<=t?a<t:a>t;a=0<=t?++a:--a)s.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+l+e.readShort()});for(c={},a=d=0,p=s.length;d<p;a=++d)r=s[a],e.pos=r.offset,u=e.readString(r.length),o=new Rte(u,r),c[m=r.nameID]==null&&(c[m]=[]),c[r.nameID].push(o);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},n})(),Fte=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),Mte=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,s,r,a,o,l,c;for(e.pos=this.offset,this.metrics=[],t=0,l=this.file.hhea.numberOfMetrics;0<=l?t<l:t>l;t=0<=l?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var u,d;for(d=[],t=u=0;0<=r?u<r:u>r;t=0<=r?++u:--u)d.push(e.readInt16());return d})(),this.widths=(function(){var u,d,p,m;for(m=[],u=0,d=(p=this.metrics).length;u<d;u++)a=p[u],m.push(a.advance);return m}).call(this),s=this.widths[this.widths.length-1],c=[],t=o=0;0<=r?o<r:o>r;t=0<=r?++o:--o)c.push(this.widths.push(s));return c},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),z7=[].slice,Pte=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,s,r,a,o,l,c,u,d,p;return e in this.cache?this.cache[e]:(a=this.file.loca,t=this.file.contents,s=a.indexOf(e),(r=a.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+s,o=(l=new Vf(t.read(r))).readShort(),u=l.readShort(),p=l.readShort(),c=l.readShort(),d=l.readShort(),this.cache[e]=o===-1?new Bte(l,u,p,c,d):new zte(l,o,u,p,c,d),this.cache[e]))},n.prototype.encode=function(e,t,s){var r,a,o,l,c;for(o=[],a=[],l=0,c=t.length;l<c;l++)r=e[t[l]],a.push(o.length),r&&(o=o.concat(r.encode(s)));return a.push(o.length),{table:o,offsets:a}},n})(),zte=(function(){function n(e,t,s,r,a,o){this.raw=e,this.numberOfContours=t,this.xMin=s,this.yMin=r,this.xMax=a,this.yMax=o,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),Bte=(function(){function n(e,t,s,r,a){var o,l;for(this.raw=e,this.xMin=t,this.yMin=s,this.xMax=r,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return n.prototype.encode=function(){var e,t,s;for(t=new Vf(z7.call(this.raw.data)),e=0,s=this.glyphIDs.length;e<s;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),jte=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return kh(n,xu),n.prototype.tag="loca",n.prototype.parse=function(e){var t,s;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var r,a;for(a=[],s=0,r=this.length;s<r;s+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var r,a;for(a=[],s=0,r=this.length;s<r;s+=4)a.push(e.readUInt32());return a}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var s=new Uint32Array(this.offsets.length),r=0,a=0,o=0;o<s.length;++o)if(s[o]=r,a<t.length&&t[a]==o){++a,s[o]=r;var l=this.offsets[o],c=this.offsets[o+1]-l;c>0&&(r+=c)}for(var u=new Array(4*s.length),d=0;d<s.length;++d)u[4*d+3]=255&s[d],u[4*d+2]=(65280&s[d])>>8,u[4*d+1]=(16711680&s[d])>>16,u[4*d]=(4278190080&s[d])>>24;return u},n})(),Ute=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,s,r,a;for(t in r=this.font.cmap.tables[0].codeMap,e={},a=this.subset)s=a[t],e[t]=r[s];return e},n.prototype.glyphsFor=function(e){var t,s,r,a,o,l,c;for(r={},o=0,l=e.length;o<l;o++)r[a=e[o]]=this.font.glyf.glyphFor(a);for(a in t=[],r)(s=r[a])!=null&&s.compound&&t.push.apply(t,s.glyphIDs);if(t.length>0)for(a in c=this.glyphsFor(t))s=c[a],r[a]=s;return r},n.prototype.encode=function(e,t){var s,r,a,o,l,c,u,d,p,m,g,b,v,x,S;for(r in s=P7.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(e),g={0:0},S=s.charMap)g[(c=S[r]).old]=c.new;for(b in m=s.maxGlyphID,o)b in g||(g[b]=m++);return d=(function(C){var A,k;for(A in k={},C)k[C[A]]=A;return k})(g),p=Object.keys(d).sort(function(C,A){return C-A}),v=(function(){var C,A,k;for(k=[],C=0,A=p.length;C<A;C++)l=p[C],k.push(d[l]);return k})(),a=this.font.glyf.encode(o,v,g),u=this.font.loca.encode(a.offsets,v),x={cmap:this.font.cmap.raw(),glyf:a.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(x["OS/2"]=this.font.os2.raw()),this.font.directory.encode(x)},n})();qt.API.PDFObject=(function(){var n;function e(){}return n=function(t,s){return(Array(s+1).join("0")+t).slice(-s)},e.convert=function(t){var s,r,a,o;if(Array.isArray(t))return"["+(function(){var l,c,u;for(u=[],l=0,c=t.length;l<c;l++)s=t[l],u.push(e.convert(s));return u})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(r in a=["<<"],t)o=t[r],a.push("/"+r+" "+e.convert(o));return a.push(">>"),a.join(`
`)}return""+t},e})();function $5(n,e,t,s){const r=e.target,a=new Ve(t,s),o=fr.transformPoint(a,fr.invertTransform(r.calcTransformMatrix())),l=r.width,c=l/2,u=o.x-c;let d=l+u;d<10&&(d=10);const p=r.getOriginalSize().width,m=r.cropX||0;if(m+d>p&&(d=p-m),d===l)return!1;const g=fr.cos(r.angle),b=fr.sin(r.angle),v=u/2*r.scaleX*g,x=u/2*r.scaleX*b;return r.set("width",d),r.set("left",r.left+v),r.set("top",r.top+x),!0}function R5(n,e,t,s){const r=e.target,a=new Ve(t,s),o=fr.transformPoint(a,fr.invertTransform(r.calcTransformMatrix())),l=r.width,c=-l/2,u=o.x-c;let d=l-u;d<10&&(d=10);let p=r.cropX||0,m=p+u;if(m<0?(m=0,d=l+p):m+d>r.getOriginalSize().width,d===l&&m===p)return!1;const g=m-p,b=fr.cos(r.angle),v=fr.sin(r.angle),x=g/2*r.scaleX*b,S=g/2*r.scaleX*v;return r.set("cropX",m),r.set("width",d),r.set("left",r.left+x),r.set("top",r.top+S),!0}function L5(n,e,t,s){const r=e.target,a=new Ve(t,s),o=fr.transformPoint(a,fr.invertTransform(r.calcTransformMatrix())),l=r.height,c=o.y-l/2;let u=l+c;u<10&&(u=10);const d=r.getOriginalSize().height,p=r.cropY||0;if(p+u>d&&(u=d-p),u===l)return!1;const m=fr.cos(r.angle),g=fr.sin(r.angle),b=c/2*r.scaleY*-g,v=c/2*r.scaleY*m;return r.set("height",u),r.set("left",r.left+b),r.set("top",r.top+v),!0}function F5(n,e,t,s){const r=e.target,a=new Ve(t,s),o=fr.transformPoint(a,fr.invertTransform(r.calcTransformMatrix())),l=r.height,c=o.y- -l/2;let u=l-c;u<10&&(u=10);let d=r.cropY||0,p=d+c;p<0&&(p=0,u=l+d);const m=p-d,g=fr.cos(r.angle),b=fr.sin(r.angle),v=m/2*r.scaleY*-b,x=m/2*r.scaleY*g;return r.set("cropY",p),r.set("height",u),r.set("left",r.left+v),r.set("top",r.top+x),!0}function _f(n,e,t,s,r){n.save(),n.translate(e,t),r.angle&&n.rotate(-fr.degreesToRadians(r.angle)),n.shadowColor="rgba(0,0,0,0.3)",n.shadowBlur=4,n.fillStyle="white",n.strokeStyle="black",n.lineWidth=1;const a=10;n.beginPath(),n.rect(-a/2,-a/2,a,a),n.fillStyle="#ffffff",n.strokeStyle="rgba(0,0,0,0.5)",n.lineWidth=1,n.fill(),n.stroke(),n.restore()}function Vte(){return{mr:new Ei({x:.5,y:0,cursorStyle:"ew-resize",actionHandler:$5,render:_f}),ml:new Ei({x:-.5,y:0,cursorStyle:"ew-resize",actionHandler:R5,render:_f}),mb:new Ei({x:0,y:.5,cursorStyle:"ns-resize",actionHandler:L5,render:_f}),mt:new Ei({x:0,y:-.5,cursorStyle:"ns-resize",actionHandler:F5,render:_f}),br:new Ei({x:.5,y:.5,cursorStyle:"nwse-resize",actionHandler:(n,e,t,s)=>{const r=$5(n,e,t,s),a=L5(n,e,t,s);return r||a},render:_f}),bl:new Ei({x:-.5,y:.5,cursorStyle:"nesw-resize",actionHandler:(n,e,t,s)=>{const r=R5(n,e,t,s),a=L5(n,e,t,s);return r||a},render:_f}),tr:new Ei({x:.5,y:-.5,cursorStyle:"nesw-resize",actionHandler:(n,e,t,s)=>{const r=$5(n,e,t,s),a=F5(n,e,t,s);return r||a},render:_f}),tl:new Ei({x:-.5,y:-.5,cursorStyle:"nwse-resize",actionHandler:(n,e,t,s)=>{const r=R5(n,e,t,s),a=F5(n,e,t,s);return r||a},render:_f})}}function B7(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function Wte(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function J4(n,e){return n.get(B7(n,e))}function Hte(n,e,t){Wte(n,e),e.set(n,t)}function Gte(n,e,t){return n.set(B7(n,e),t),t}const qte=100,sn={},Xte=()=>{sn.previousActiveElement instanceof HTMLElement?(sn.previousActiveElement.focus(),sn.previousActiveElement=null):document.body&&document.body.focus()},Yte=n=>new Promise(e=>{if(!n)return e();const t=window.scrollX,s=window.scrollY;sn.restoreFocusTimeout=setTimeout(()=>{Xte(),e()},qte),window.scrollTo(t,s)}),j7="swal2-",Kte=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"],Ye=Kte.reduce((n,e)=>(n[e]=j7+e,n),{}),Zte=["success","warning","info","question","error"],PC=Zte.reduce((n,e)=>(n[e]=j7+e,n),{}),U7="SweetAlert2:",FO=n=>n.charAt(0).toUpperCase()+n.slice(1),oo=n=>{console.warn(`${U7} ${typeof n=="object"?n.join(" "):n}`)},Qm=n=>{console.error(`${U7} ${n}`)},Q4=[],Jte=n=>{Q4.includes(n)||(Q4.push(n),oo(n))},V7=(n,e=null)=>{Jte(`"${n}" is deprecated and will be removed in the next major release.${e?` Use "${e}" instead.`:""}`)},Z_=n=>typeof n=="function"?n():n,MO=n=>n&&typeof n.toPromise=="function",gw=n=>MO(n)?n.toPromise():Promise.resolve(n),PO=n=>n&&Promise.resolve(n)===n,go=()=>document.body.querySelector(`.${Ye.container}`),yw=n=>{const e=go();return e?e.querySelector(n):null},Fl=n=>yw(`.${n}`),ms=()=>Fl(Ye.popup),p1=()=>Fl(Ye.icon),Qte=()=>Fl(Ye["icon-content"]),W7=()=>Fl(Ye.title),zO=()=>Fl(Ye["html-container"]),H7=()=>Fl(Ye.image),BO=()=>Fl(Ye["progress-steps"]),J_=()=>Fl(Ye["validation-message"]),bh=()=>yw(`.${Ye.actions} .${Ye.confirm}`),m1=()=>yw(`.${Ye.actions} .${Ye.cancel}`),eg=()=>yw(`.${Ye.actions} .${Ye.deny}`),ene=()=>Fl(Ye["input-label"]),g1=()=>yw(`.${Ye.loader}`),bw=()=>Fl(Ye.actions),G7=()=>Fl(Ye.footer),Q_=()=>Fl(Ye["timer-progress-bar"]),jO=()=>Fl(Ye.close),tne=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,UO=()=>{const n=ms();if(!n)return[];const e=n.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),t=Array.from(e).sort((a,o)=>{const l=parseInt(a.getAttribute("tabindex")||"0"),c=parseInt(o.getAttribute("tabindex")||"0");return l>c?1:l<c?-1:0}),s=n.querySelectorAll(tne),r=Array.from(s).filter(a=>a.getAttribute("tabindex")!=="-1");return[...new Set(t.concat(r))].filter(a=>Vo(a))},VO=()=>md(document.body,Ye.shown)&&!md(document.body,Ye["toast-shown"])&&!md(document.body,Ye["no-backdrop"]),ek=()=>{const n=ms();return n?md(n,Ye.toast):!1},nne=()=>{const n=ms();return n?n.hasAttribute("data-loading"):!1},Ml=(n,e)=>{if(n.textContent="",e){const s=new DOMParser().parseFromString(e,"text/html"),r=s.querySelector("head");r&&Array.from(r.childNodes).forEach(o=>{n.appendChild(o)});const a=s.querySelector("body");a&&Array.from(a.childNodes).forEach(o=>{o instanceof HTMLVideoElement||o instanceof HTMLAudioElement?n.appendChild(o.cloneNode(!0)):n.appendChild(o)})}},md=(n,e)=>{if(!e)return!1;const t=e.split(/\s+/);for(let s=0;s<t.length;s++)if(!n.classList.contains(t[s]))return!1;return!0},sne=(n,e)=>{Array.from(n.classList).forEach(t=>{!Object.values(Ye).includes(t)&&!Object.values(PC).includes(t)&&!Object.values(e.showClass||{}).includes(t)&&n.classList.remove(t)})},$l=(n,e,t)=>{if(sne(n,e),!e.customClass)return;const s=e.customClass[t];if(s){if(typeof s!="string"&&!s.forEach){oo(`Invalid type of customClass.${t}! Expected string or iterable object, got "${typeof s}"`);return}vs(n,s)}},tk=(n,e)=>{if(!e)return null;switch(e){case"select":case"textarea":case"file":return n.querySelector(`.${Ye.popup} > .${Ye[e]}`);case"checkbox":return n.querySelector(`.${Ye.popup} > .${Ye.checkbox} input`);case"radio":return n.querySelector(`.${Ye.popup} > .${Ye.radio} input:checked`)||n.querySelector(`.${Ye.popup} > .${Ye.radio} input:first-child`);case"range":return n.querySelector(`.${Ye.popup} > .${Ye.range} input`);default:return n.querySelector(`.${Ye.popup} > .${Ye.input}`)}},q7=n=>{if(n.focus(),n.type!=="file"){const e=n.value;n.value="",n.value=e}},X7=(n,e,t)=>{!n||!e||(typeof e=="string"&&(e=e.split(/\s+/).filter(Boolean)),e.forEach(s=>{Array.isArray(n)?n.forEach(r=>{t?r.classList.add(s):r.classList.remove(s)}):t?n.classList.add(s):n.classList.remove(s)}))},vs=(n,e)=>{X7(n,e,!0)},pc=(n,e)=>{X7(n,e,!1)},Of=(n,e)=>{const t=Array.from(n.children);for(let s=0;s<t.length;s++){const r=t[s];if(r instanceof HTMLElement&&md(r,e))return r}},dm=(n,e,t)=>{t===`${parseInt(`${t}`)}`&&(t=parseInt(t)),t||parseInt(`${t}`)===0?n.style.setProperty(e,typeof t=="number"?`${t}px`:t):n.style.removeProperty(e)},Zi=(n,e="flex")=>{n&&(n.style.display=e)},$a=n=>{n&&(n.style.display="none")},WO=(n,e="block")=>{n&&new MutationObserver(()=>{vw(n,n.innerHTML,e)}).observe(n,{childList:!0,subtree:!0})},ez=(n,e,t,s)=>{const r=n.querySelector(e);r&&r.style.setProperty(t,s)},vw=(n,e,t="flex")=>{e?Zi(n,t):$a(n)},Vo=n=>!!(n&&(n.offsetWidth||n.offsetHeight||n.getClientRects().length)),rne=()=>!Vo(bh())&&!Vo(eg())&&!Vo(m1()),RE=n=>n.scrollHeight>n.clientHeight,ine=(n,e)=>{let t=n;for(;t&&t!==e;){if(RE(t))return!0;t=t.parentElement}return!1},Y7=n=>{const e=window.getComputedStyle(n),t=parseFloat(e.getPropertyValue("animation-duration")||"0"),s=parseFloat(e.getPropertyValue("transition-duration")||"0");return t>0||s>0},HO=(n,e=!1)=>{const t=Q_();t&&Vo(t)&&(e&&(t.style.transition="none",t.style.width="100%"),setTimeout(()=>{t.style.transition=`width ${n/1e3}s linear`,t.style.width="0%"},10))},ane=()=>{const n=Q_();if(!n)return;const e=parseInt(window.getComputedStyle(n).width);n.style.removeProperty("transition"),n.style.width="100%";const t=parseInt(window.getComputedStyle(n).width),s=e/t*100;n.style.width=`${s}%`},one=()=>typeof window>"u"||typeof document>"u",lne=`
 <div aria-labelledby="${Ye.title}" aria-describedby="${Ye["html-container"]}" class="${Ye.popup}" tabindex="-1">
   <button type="button" class="${Ye.close}"></button>
   <ul class="${Ye["progress-steps"]}"></ul>
   <div class="${Ye.icon}"></div>
   <img class="${Ye.image}" />
   <h2 class="${Ye.title}" id="${Ye.title}"></h2>
   <div class="${Ye["html-container"]}" id="${Ye["html-container"]}"></div>
   <input class="${Ye.input}" id="${Ye.input}" />
   <input type="file" class="${Ye.file}" />
   <div class="${Ye.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${Ye.select}" id="${Ye.select}"></select>
   <div class="${Ye.radio}"></div>
   <label class="${Ye.checkbox}">
     <input type="checkbox" id="${Ye.checkbox}" />
     <span class="${Ye.label}"></span>
   </label>
   <textarea class="${Ye.textarea}" id="${Ye.textarea}"></textarea>
   <div class="${Ye["validation-message"]}" id="${Ye["validation-message"]}"></div>
   <div class="${Ye.actions}">
     <div class="${Ye.loader}"></div>
     <button type="button" class="${Ye.confirm}"></button>
     <button type="button" class="${Ye.deny}"></button>
     <button type="button" class="${Ye.cancel}"></button>
   </div>
   <div class="${Ye.footer}"></div>
   <div class="${Ye["timer-progress-bar-container"]}">
     <div class="${Ye["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),cne=()=>{const n=go();return n?(n.remove(),pc([document.documentElement,document.body],[Ye["no-backdrop"],Ye["toast-shown"],Ye["has-column"]]),!0):!1},Wp=()=>{sn.currentInstance.resetValidationMessage()},une=()=>{const n=ms(),e=Of(n,Ye.input),t=Of(n,Ye.file),s=n.querySelector(`.${Ye.range} input`),r=n.querySelector(`.${Ye.range} output`),a=Of(n,Ye.select),o=n.querySelector(`.${Ye.checkbox} input`),l=Of(n,Ye.textarea);e.oninput=Wp,t.onchange=Wp,a.onchange=Wp,o.onchange=Wp,l.oninput=Wp,s.oninput=()=>{Wp(),r.value=s.value},s.onchange=()=>{Wp(),r.value=s.value}},hne=n=>typeof n=="string"?document.querySelector(n):n,dne=n=>{const e=ms();e.setAttribute("role",n.toast?"alert":"dialog"),e.setAttribute("aria-live",n.toast?"polite":"assertive"),n.toast||e.setAttribute("aria-modal","true")},fne=n=>{window.getComputedStyle(n).direction==="rtl"&&(vs(go(),Ye.rtl),sn.isRTL=!0)},pne=n=>{const e=cne();if(one()){Qm("SweetAlert2 requires document to initialize");return}const t=document.createElement("div");t.className=Ye.container,e&&vs(t,Ye["no-transition"]),Ml(t,lne),t.dataset.swal2Theme=n.theme;const s=hne(n.target);s.appendChild(t),n.topLayer&&(t.setAttribute("popover",""),t.showPopover()),dne(n),fne(s),une()},GO=(n,e)=>{n instanceof HTMLElement?e.appendChild(n):typeof n=="object"?mne(n,e):n&&Ml(e,n)},mne=(n,e)=>{n.jquery?gne(e,n):Ml(e,n.toString())},gne=(n,e)=>{if(n.textContent="",0 in e)for(let t=0;t in e;t++)n.appendChild(e[t].cloneNode(!0));else n.appendChild(e.cloneNode(!0))},yne=(n,e)=>{const t=bw(),s=g1();!t||!s||(!e.showConfirmButton&&!e.showDenyButton&&!e.showCancelButton?$a(t):Zi(t),$l(t,e,"actions"),bne(t,s,e),Ml(s,e.loaderHtml||""),$l(s,e,"loader"))};function bne(n,e,t){const s=bh(),r=eg(),a=m1();!s||!r||!a||(P5(s,"confirm",t),P5(r,"deny",t),P5(a,"cancel",t),vne(s,r,a,t),t.reverseButtons&&(t.toast?(n.insertBefore(a,s),n.insertBefore(r,s)):(n.insertBefore(a,e),n.insertBefore(r,e),n.insertBefore(s,e))))}function vne(n,e,t,s){if(!s.buttonsStyling){pc([n,e,t],Ye.styled);return}vs([n,e,t],Ye.styled),s.confirmButtonColor&&n.style.setProperty("--swal2-confirm-button-background-color",s.confirmButtonColor),s.denyButtonColor&&e.style.setProperty("--swal2-deny-button-background-color",s.denyButtonColor),s.cancelButtonColor&&t.style.setProperty("--swal2-cancel-button-background-color",s.cancelButtonColor),M5(n),M5(e),M5(t)}function M5(n){const e=window.getComputedStyle(n);if(e.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const t=e.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");n.style.setProperty("--swal2-action-button-focus-box-shadow",e.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${t}`))}function P5(n,e,t){const s=FO(e);vw(n,t[`show${s}Button`],"inline-block"),Ml(n,t[`${e}ButtonText`]||""),n.setAttribute("aria-label",t[`${e}ButtonAriaLabel`]||""),n.className=Ye[e],$l(n,t,`${e}Button`)}const wne=(n,e)=>{const t=jO();t&&(Ml(t,e.closeButtonHtml||""),$l(t,e,"closeButton"),vw(t,e.showCloseButton),t.setAttribute("aria-label",e.closeButtonAriaLabel||""))},xne=(n,e)=>{const t=go();t&&(Sne(t,e.backdrop),Cne(t,e.position),_ne(t,e.grow),$l(t,e,"container"))};function Sne(n,e){typeof e=="string"?n.style.background=e:e||vs([document.documentElement,document.body],Ye["no-backdrop"])}function Cne(n,e){e&&(e in Ye?vs(n,Ye[e]):(oo('The "position" parameter is not valid, defaulting to "center"'),vs(n,Ye.center)))}function _ne(n,e){e&&vs(n,Ye[`grow-${e}`])}var Ys={innerParams:new WeakMap,domCache:new WeakMap};const kne=["input","file","range","select","radio","checkbox","textarea"],Tne=(n,e)=>{const t=ms();if(!t)return;const s=Ys.innerParams.get(n),r=!s||e.input!==s.input;kne.forEach(a=>{const o=Of(t,Ye[a]);o&&(Ene(a,e.inputAttributes),o.className=Ye[a],r&&$a(o))}),e.input&&(r&&Nne(e),Ine(e))},Nne=n=>{if(!n.input)return;if(!qr[n.input]){Qm(`Unexpected type of input! Expected ${Object.keys(qr).join(" | ")}, got "${n.input}"`);return}const e=K7(n.input);if(!e)return;const t=qr[n.input](e,n);Zi(e),n.inputAutoFocus&&setTimeout(()=>{q7(t)})},Ane=n=>{for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e].name;["id","type","value","style"].includes(t)||n.removeAttribute(t)}},Ene=(n,e)=>{const t=ms();if(!t)return;const s=tk(t,n);if(s){Ane(s);for(const r in e)s.setAttribute(r,e[r])}},Ine=n=>{if(!n.input)return;const e=K7(n.input);e&&$l(e,n,"input")},qO=(n,e)=>{!n.placeholder&&e.inputPlaceholder&&(n.placeholder=e.inputPlaceholder)},ww=(n,e,t)=>{if(t.inputLabel){const s=document.createElement("label"),r=Ye["input-label"];s.setAttribute("for",n.id),s.className=r,typeof t.customClass=="object"&&vs(s,t.customClass.inputLabel),s.innerText=t.inputLabel,e.insertAdjacentElement("beforebegin",s)}},K7=n=>{const e=ms();if(e)return Of(e,Ye[n]||Ye.input)},zC=(n,e)=>{["string","number"].includes(typeof e)?n.value=`${e}`:PO(e)||oo(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof e}"`)},qr={};qr.text=qr.email=qr.password=qr.number=qr.tel=qr.url=qr.search=qr.date=qr["datetime-local"]=qr.time=qr.week=qr.month=(n,e)=>(zC(n,e.inputValue),ww(n,n,e),qO(n,e),n.type=e.input,n);qr.file=(n,e)=>(ww(n,n,e),qO(n,e),n);qr.range=(n,e)=>{const t=n.querySelector("input"),s=n.querySelector("output");return zC(t,e.inputValue),t.type=e.input,zC(s,e.inputValue),ww(t,n,e),n};qr.select=(n,e)=>{if(n.textContent="",e.inputPlaceholder){const t=document.createElement("option");Ml(t,e.inputPlaceholder),t.value="",t.disabled=!0,t.selected=!0,n.appendChild(t)}return ww(n,n,e),n};qr.radio=n=>(n.textContent="",n);qr.checkbox=(n,e)=>{const t=tk(ms(),"checkbox");t.value="1",t.checked=!!e.inputValue;const s=n.querySelector("span");return Ml(s,e.inputPlaceholder||e.inputLabel),t};qr.textarea=(n,e)=>{zC(n,e.inputValue),qO(n,e),ww(n,n,e);const t=s=>parseInt(window.getComputedStyle(s).marginLeft)+parseInt(window.getComputedStyle(s).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const s=parseInt(window.getComputedStyle(ms()).width),r=()=>{if(!document.body.contains(n))return;const a=n.offsetWidth+t(n);a>s?ms().style.width=`${a}px`:dm(ms(),"width",e.width)};new MutationObserver(r).observe(n,{attributes:!0,attributeFilter:["style"]})}}),n};const One=(n,e)=>{const t=zO();t&&(WO(t),$l(t,e,"htmlContainer"),e.html?(GO(e.html,t),Zi(t,"block")):e.text?(t.textContent=e.text,Zi(t,"block")):$a(t),Tne(n,e))},Dne=(n,e)=>{const t=G7();t&&(WO(t),vw(t,!!e.footer,"block"),e.footer&&GO(e.footer,t),$l(t,e,"footer"))},$ne=(n,e)=>{const t=Ys.innerParams.get(n),s=p1();if(!s)return;if(t&&e.icon===t.icon){nz(s,e),tz(s,e);return}if(!e.icon&&!e.iconHtml){$a(s);return}if(e.icon&&Object.keys(PC).indexOf(e.icon)===-1){Qm(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${e.icon}"`),$a(s);return}Zi(s),nz(s,e),tz(s,e),vs(s,e.showClass&&e.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Z7)},tz=(n,e)=>{for(const[t,s]of Object.entries(PC))e.icon!==t&&pc(n,s);vs(n,e.icon&&PC[e.icon]),Fne(n,e),Z7(),$l(n,e,"icon")},Z7=()=>{const n=ms();if(!n)return;const e=window.getComputedStyle(n).getPropertyValue("background-color"),t=n.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let s=0;s<t.length;s++)t[s].style.backgroundColor=e},Rne=n=>`
  ${n.animation?'<div class="swal2-success-circular-line-left"></div>':""}
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div>
  ${n.animation?'<div class="swal2-success-fix"></div>':""}
  ${n.animation?'<div class="swal2-success-circular-line-right"></div>':""}
`,Lne=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,nz=(n,e)=>{if(!e.icon&&!e.iconHtml)return;let t=n.innerHTML,s="";e.iconHtml?s=sz(e.iconHtml):e.icon==="success"?(s=Rne(e),t=t.replace(/ style=".*?"/g,"")):e.icon==="error"?s=Lne:e.icon&&(s=sz({question:"?",warning:"!",info:"i"}[e.icon])),t.trim()!==s.trim()&&Ml(n,s)},Fne=(n,e)=>{if(e.iconColor){n.style.color=e.iconColor,n.style.borderColor=e.iconColor;for(const t of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])ez(n,t,"background-color",e.iconColor);ez(n,".swal2-success-ring","border-color",e.iconColor)}},sz=n=>`<div class="${Ye["icon-content"]}">${n}</div>`,Mne=(n,e)=>{const t=H7();if(t){if(!e.imageUrl){$a(t);return}Zi(t,""),t.setAttribute("src",e.imageUrl),t.setAttribute("alt",e.imageAlt||""),dm(t,"width",e.imageWidth),dm(t,"height",e.imageHeight),t.className=Ye.image,$l(t,e,"image")}};let XO=!1,J7=0,Q7=0,eU=0,tU=0;const Pne=n=>{n.addEventListener("mousedown",BC),document.body.addEventListener("mousemove",jC),n.addEventListener("mouseup",UC),n.addEventListener("touchstart",BC),document.body.addEventListener("touchmove",jC),n.addEventListener("touchend",UC)},zne=n=>{n.removeEventListener("mousedown",BC),document.body.removeEventListener("mousemove",jC),n.removeEventListener("mouseup",UC),n.removeEventListener("touchstart",BC),document.body.removeEventListener("touchmove",jC),n.removeEventListener("touchend",UC)},BC=n=>{const e=ms();if(n.target===e||p1().contains(n.target)){XO=!0;const t=nU(n);J7=t.clientX,Q7=t.clientY,eU=parseInt(e.style.insetInlineStart)||0,tU=parseInt(e.style.insetBlockStart)||0,vs(e,"swal2-dragging")}},jC=n=>{const e=ms();if(XO){let{clientX:t,clientY:s}=nU(n);const r=t-J7;e.style.insetInlineStart=`${eU+(sn.isRTL?-r:r)}px`,e.style.insetBlockStart=`${tU+(s-Q7)}px`}},UC=()=>{const n=ms();XO=!1,pc(n,"swal2-dragging")},nU=n=>{let e=0,t=0;return n.type.startsWith("mouse")?(e=n.clientX,t=n.clientY):n.type.startsWith("touch")&&(e=n.touches[0].clientX,t=n.touches[0].clientY),{clientX:e,clientY:t}},Bne=(n,e)=>{const t=go(),s=ms();if(!(!t||!s)){if(e.toast){dm(t,"width",e.width),s.style.width="100%";const r=g1();r&&s.insertBefore(r,p1())}else dm(s,"width",e.width);dm(s,"padding",e.padding),e.color&&(s.style.color=e.color),e.background&&(s.style.background=e.background),$a(J_()),jne(s,e),e.draggable&&!e.toast?(vs(s,Ye.draggable),Pne(s)):(pc(s,Ye.draggable),zne(s))}},jne=(n,e)=>{const t=e.showClass||{};n.className=`${Ye.popup} ${Vo(n)?t.popup:""}`,e.toast?(vs([document.documentElement,document.body],Ye["toast-shown"]),vs(n,Ye.toast)):vs(n,Ye.modal),$l(n,e,"popup"),typeof e.customClass=="string"&&vs(n,e.customClass),e.icon&&vs(n,Ye[`icon-${e.icon}`])},Une=(n,e)=>{const t=BO();if(!t)return;const{progressSteps:s,currentProgressStep:r}=e;if(!s||s.length===0||r===void 0){$a(t);return}Zi(t),t.textContent="",r>=s.length&&oo("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),s.forEach((a,o)=>{const l=Vne(a);if(t.appendChild(l),o===r&&vs(l,Ye["active-progress-step"]),o!==s.length-1){const c=Wne(e);t.appendChild(c)}})},Vne=n=>{const e=document.createElement("li");return vs(e,Ye["progress-step"]),Ml(e,n),e},Wne=n=>{const e=document.createElement("li");return vs(e,Ye["progress-step-line"]),n.progressStepsDistance&&dm(e,"width",n.progressStepsDistance),e},Hne=(n,e)=>{const t=W7();t&&(WO(t),vw(t,!!(e.title||e.titleText),"block"),e.title&&GO(e.title,t),e.titleText&&(t.innerText=e.titleText),$l(t,e,"title"))},sU=(n,e)=>{Bne(n,e),xne(n,e),Une(n,e),$ne(n,e),Mne(n,e),Hne(n,e),wne(n,e),One(n,e),yne(n,e),Dne(n,e);const t=ms();typeof e.didRender=="function"&&t&&e.didRender(t),sn.eventEmitter.emit("didRender",t)},Gne=()=>Vo(ms()),rU=()=>{var n;return(n=bh())===null||n===void 0?void 0:n.click()},qne=()=>{var n;return(n=eg())===null||n===void 0?void 0:n.click()},Xne=()=>{var n;return(n=m1())===null||n===void 0?void 0:n.click()},y1=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),iU=n=>{n.keydownTarget&&n.keydownHandlerAdded&&(n.keydownTarget.removeEventListener("keydown",n.keydownHandler,{capture:n.keydownListenerCapture}),n.keydownHandlerAdded=!1)},Yne=(n,e,t)=>{iU(n),e.toast||(n.keydownHandler=s=>Zne(e,s,t),n.keydownTarget=e.keydownListenerCapture?window:ms(),n.keydownListenerCapture=e.keydownListenerCapture,n.keydownTarget.addEventListener("keydown",n.keydownHandler,{capture:n.keydownListenerCapture}),n.keydownHandlerAdded=!0)},LE=(n,e)=>{var t;const s=UO();if(s.length){n=n+e,n===-2&&(n=s.length-1),n===s.length?n=0:n===-1&&(n=s.length-1),s[n].focus();return}(t=ms())===null||t===void 0||t.focus()},aU=["ArrowRight","ArrowDown"],Kne=["ArrowLeft","ArrowUp"],Zne=(n,e,t)=>{n&&(e.isComposing||e.keyCode===229||(n.stopKeydownPropagation&&e.stopPropagation(),e.key==="Enter"?Jne(e,n):e.key==="Tab"?Qne(e):[...aU,...Kne].includes(e.key)?ese(e.key):e.key==="Escape"&&tse(e,n,t)))},Jne=(n,e)=>{if(!Z_(e.allowEnterKey))return;const t=tk(ms(),e.input);if(n.target&&t&&n.target instanceof HTMLElement&&n.target.outerHTML===t.outerHTML){if(["textarea","file"].includes(e.input))return;rU(),n.preventDefault()}},Qne=n=>{const e=n.target,t=UO();let s=-1;for(let r=0;r<t.length;r++)if(e===t[r]){s=r;break}n.shiftKey?LE(s,-1):LE(s,1),n.stopPropagation(),n.preventDefault()},ese=n=>{const e=bw(),t=bh(),s=eg(),r=m1();if(!e||!t||!s||!r)return;const a=[t,s,r];if(document.activeElement instanceof HTMLElement&&!a.includes(document.activeElement))return;const o=aU.includes(n)?"nextElementSibling":"previousElementSibling";let l=document.activeElement;if(l){for(let c=0;c<e.children.length;c++){if(l=l[o],!l)return;if(l instanceof HTMLButtonElement&&Vo(l))break}l instanceof HTMLButtonElement&&l.focus()}},tse=(n,e,t)=>{n.preventDefault(),Z_(e.allowEscapeKey)&&t(y1.esc)};var B0={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const nse=()=>{const n=go();Array.from(document.body.children).forEach(t=>{t.contains(n)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))})},oU=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},lU=typeof window<"u"&&!!window.GestureEvent,sse=()=>{if(lU&&!md(document.body,Ye.iosfix)){const n=document.body.scrollTop;document.body.style.top=`${n*-1}px`,vs(document.body,Ye.iosfix),rse()}},rse=()=>{const n=go();if(!n)return;let e;n.ontouchstart=t=>{e=ise(t)},n.ontouchmove=t=>{e&&(t.preventDefault(),t.stopPropagation())}},ise=n=>{const e=n.target,t=go(),s=zO();return!t||!s||ase(n)||ose(n)?!1:e===t||!RE(t)&&e instanceof HTMLElement&&!ine(e,s)&&e.tagName!=="INPUT"&&e.tagName!=="TEXTAREA"&&!(RE(s)&&s.contains(e))},ase=n=>n.touches&&n.touches.length&&n.touches[0].touchType==="stylus",ose=n=>n.touches&&n.touches.length>1,lse=()=>{if(md(document.body,Ye.iosfix)){const n=parseInt(document.body.style.top,10);pc(document.body,Ye.iosfix),document.body.style.top="",document.body.scrollTop=n*-1}},cse=()=>{const n=document.createElement("div");n.className=Ye["scrollbar-measure"],document.body.appendChild(n);const e=n.getBoundingClientRect().width-n.clientWidth;return document.body.removeChild(n),e};let O0=null;const use=n=>{O0===null&&(document.body.scrollHeight>window.innerHeight||n==="scroll")&&(O0=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${O0+cse()}px`)},hse=()=>{O0!==null&&(document.body.style.paddingRight=`${O0}px`,O0=null)};function cU(n,e,t,s){ek()?rz(n,s):(Yte(t).then(()=>rz(n,s)),iU(sn)),lU?(e.setAttribute("style","display:none !important"),e.removeAttribute("class"),e.innerHTML=""):e.remove(),VO()&&(hse(),lse(),oU()),dse()}function dse(){pc([document.documentElement,document.body],[Ye.shown,Ye["height-auto"],Ye["no-backdrop"],Ye["toast-shown"]])}function Df(n){n=pse(n);const e=B0.swalPromiseResolve.get(this),t=fse(this);this.isAwaitingPromise?n.isDismissed||(xw(this),e(n)):t&&e(n)}const fse=n=>{const e=ms();if(!e)return!1;const t=Ys.innerParams.get(n);if(!t||md(e,t.hideClass.popup))return!1;pc(e,t.showClass.popup),vs(e,t.hideClass.popup);const s=go();return pc(s,t.showClass.backdrop),vs(s,t.hideClass.backdrop),mse(n,e,t),!0};function uU(n){const e=B0.swalPromiseReject.get(this);xw(this),e&&e(n)}const xw=n=>{n.isAwaitingPromise&&(delete n.isAwaitingPromise,Ys.innerParams.get(n)||n._destroy())},pse=n=>typeof n>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},n),mse=(n,e,t)=>{var s;const r=go(),a=Y7(e);typeof t.willClose=="function"&&t.willClose(e),(s=sn.eventEmitter)===null||s===void 0||s.emit("willClose",e),a?gse(n,e,r,t.returnFocus,t.didClose):cU(n,r,t.returnFocus,t.didClose)},gse=(n,e,t,s,r)=>{sn.swalCloseEventFinishedCallback=cU.bind(null,n,t,s,r);const a=function(o){if(o.target===e){var l;(l=sn.swalCloseEventFinishedCallback)===null||l===void 0||l.call(sn),delete sn.swalCloseEventFinishedCallback,e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a)}};e.addEventListener("animationend",a),e.addEventListener("transitionend",a)},rz=(n,e)=>{setTimeout(()=>{var t;typeof e=="function"&&e.bind(n.params)(),(t=sn.eventEmitter)===null||t===void 0||t.emit("didClose"),n._destroy&&n._destroy()})},j0=n=>{let e=ms();if(e||new $0,e=ms(),!e)return;const t=g1();ek()?$a(p1()):yse(e,n),Zi(t),e.setAttribute("data-loading","true"),e.setAttribute("aria-busy","true"),e.focus()},yse=(n,e)=>{const t=bw(),s=g1();!t||!s||(!e&&Vo(bh())&&(e=bh()),Zi(t),e&&($a(e),s.setAttribute("data-button-to-replace",e.className),t.insertBefore(s,e)),vs([n,t],Ye.loading))},bse=(n,e)=>{e.input==="select"||e.input==="radio"?Cse(n,e):["text","email","number","tel","textarea"].some(t=>t===e.input)&&(MO(e.inputValue)||PO(e.inputValue))&&(j0(bh()),_se(n,e))},vse=(n,e)=>{const t=n.getInput();if(!t)return null;switch(e.input){case"checkbox":return wse(t);case"radio":return xse(t);case"file":return Sse(t);default:return e.inputAutoTrim?t.value.trim():t.value}},wse=n=>n.checked?1:0,xse=n=>n.checked?n.value:null,Sse=n=>n.files&&n.files.length?n.getAttribute("multiple")!==null?n.files:n.files[0]:null,Cse=(n,e)=>{const t=ms();if(!t)return;const s=r=>{e.input==="select"?kse(t,VC(r),e):e.input==="radio"&&Tse(t,VC(r),e)};MO(e.inputOptions)||PO(e.inputOptions)?(j0(bh()),gw(e.inputOptions).then(r=>{n.hideLoading(),s(r)})):typeof e.inputOptions=="object"?s(e.inputOptions):Qm(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof e.inputOptions}`)},_se=(n,e)=>{const t=n.getInput();t&&($a(t),gw(e.inputValue).then(s=>{t.value=e.input==="number"?`${parseFloat(s)||0}`:`${s}`,Zi(t),t.focus(),n.hideLoading()}).catch(s=>{Qm(`Error in inputValue promise: ${s}`),t.value="",Zi(t),t.focus(),n.hideLoading()}))};function kse(n,e,t){const s=Of(n,Ye.select);if(!s)return;const r=(a,o,l)=>{const c=document.createElement("option");c.value=l,Ml(c,o),c.selected=hU(l,t.inputValue),a.appendChild(c)};e.forEach(a=>{const o=a[0],l=a[1];if(Array.isArray(l)){const c=document.createElement("optgroup");c.label=o,c.disabled=!1,s.appendChild(c),l.forEach(u=>r(c,u[1],u[0]))}else r(s,l,o)}),s.focus()}function Tse(n,e,t){const s=Of(n,Ye.radio);if(!s)return;e.forEach(a=>{const o=a[0],l=a[1],c=document.createElement("input"),u=document.createElement("label");c.type="radio",c.name=Ye.radio,c.value=o,hU(o,t.inputValue)&&(c.checked=!0);const d=document.createElement("span");Ml(d,l),d.className=Ye.label,u.appendChild(c),u.appendChild(d),s.appendChild(u)});const r=s.querySelectorAll("input");r.length&&r[0].focus()}const VC=n=>{const e=[];return n instanceof Map?n.forEach((t,s)=>{let r=t;typeof r=="object"&&(r=VC(r)),e.push([s,r])}):Object.keys(n).forEach(t=>{let s=n[t];typeof s=="object"&&(s=VC(s)),e.push([t,s])}),e},hU=(n,e)=>!!e&&e.toString()===n.toString(),Nse=n=>{const e=Ys.innerParams.get(n);n.disableButtons(),e.input?dU(n,"confirm"):KO(n,!0)},Ase=n=>{const e=Ys.innerParams.get(n);n.disableButtons(),e.returnInputValueOnDeny?dU(n,"deny"):YO(n,!1)},Ese=(n,e)=>{n.disableButtons(),e(y1.cancel)},dU=(n,e)=>{const t=Ys.innerParams.get(n);if(!t.input){Qm(`The "input" parameter is needed to be set when using returnInputValueOn${FO(e)}`);return}const s=n.getInput(),r=vse(n,t);t.inputValidator?Ise(n,r,e):s&&!s.checkValidity()?(n.enableButtons(),n.showValidationMessage(t.validationMessage||s.validationMessage)):e==="deny"?YO(n,r):KO(n,r)},Ise=(n,e,t)=>{const s=Ys.innerParams.get(n);n.disableInput(),Promise.resolve().then(()=>gw(s.inputValidator(e,s.validationMessage))).then(a=>{n.enableButtons(),n.enableInput(),a?n.showValidationMessage(a):t==="deny"?YO(n,e):KO(n,e)})},YO=(n,e)=>{const t=Ys.innerParams.get(n||void 0);t.showLoaderOnDeny&&j0(eg()),t.preDeny?(n.isAwaitingPromise=!0,Promise.resolve().then(()=>gw(t.preDeny(e,t.validationMessage))).then(r=>{r===!1?(n.hideLoading(),xw(n)):n.close({isDenied:!0,value:typeof r>"u"?e:r})}).catch(r=>fU(n||void 0,r))):n.close({isDenied:!0,value:e})},iz=(n,e)=>{n.close({isConfirmed:!0,value:e})},fU=(n,e)=>{n.rejectPromise(e)},KO=(n,e)=>{const t=Ys.innerParams.get(n||void 0);t.showLoaderOnConfirm&&j0(),t.preConfirm?(n.resetValidationMessage(),n.isAwaitingPromise=!0,Promise.resolve().then(()=>gw(t.preConfirm(e,t.validationMessage))).then(r=>{Vo(J_())||r===!1?(n.hideLoading(),xw(n)):iz(n,typeof r>"u"?e:r)}).catch(r=>fU(n||void 0,r))):iz(n,e)};function WC(){const n=Ys.innerParams.get(this);if(!n)return;const e=Ys.domCache.get(this);$a(e.loader),ek()?n.icon&&Zi(p1()):Ose(e),pc([e.popup,e.actions],Ye.loading),e.popup.removeAttribute("aria-busy"),e.popup.removeAttribute("data-loading"),e.confirmButton.disabled=!1,e.denyButton.disabled=!1,e.cancelButton.disabled=!1}const Ose=n=>{const e=n.popup.getElementsByClassName(n.loader.getAttribute("data-button-to-replace"));e.length?Zi(e[0],"inline-block"):rne()&&$a(n.actions)};function pU(){const n=Ys.innerParams.get(this),e=Ys.domCache.get(this);return e?tk(e.popup,n.input):null}function mU(n,e,t){const s=Ys.domCache.get(n);e.forEach(r=>{s[r].disabled=t})}function gU(n,e){const t=ms();if(!(!t||!n))if(n.type==="radio"){const s=t.querySelectorAll(`[name="${Ye.radio}"]`);for(let r=0;r<s.length;r++)s[r].disabled=e}else n.disabled=e}function yU(){mU(this,["confirmButton","denyButton","cancelButton"],!1)}function bU(){mU(this,["confirmButton","denyButton","cancelButton"],!0)}function vU(){gU(this.getInput(),!1)}function wU(){gU(this.getInput(),!0)}function xU(n){const e=Ys.domCache.get(this),t=Ys.innerParams.get(this);Ml(e.validationMessage,n),e.validationMessage.className=Ye["validation-message"],t.customClass&&t.customClass.validationMessage&&vs(e.validationMessage,t.customClass.validationMessage),Zi(e.validationMessage);const s=this.getInput();s&&(s.setAttribute("aria-invalid","true"),s.setAttribute("aria-describedby",Ye["validation-message"]),q7(s),vs(s,Ye.inputerror))}function SU(){const n=Ys.domCache.get(this);n.validationMessage&&$a(n.validationMessage);const e=this.getInput();e&&(e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),pc(e,Ye.inputerror))}const D0={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},Dse=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],$se={allowEnterKey:void 0},Rse=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],CU=n=>Object.prototype.hasOwnProperty.call(D0,n),_U=n=>Dse.indexOf(n)!==-1,kU=n=>$se[n],Lse=n=>{CU(n)||oo(`Unknown parameter "${n}"`)},Fse=n=>{Rse.includes(n)&&oo(`The parameter "${n}" is incompatible with toasts`)},Mse=n=>{const e=kU(n);e&&V7(n,e)},TU=n=>{n.backdrop===!1&&n.allowOutsideClick&&oo('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),n.theme&&!["light","dark","auto","minimal","borderless","bootstrap-4","bootstrap-4-light","bootstrap-4-dark","bootstrap-5","bootstrap-5-light","bootstrap-5-dark","material-ui","material-ui-light","material-ui-dark","embed-iframe","bulma","bulma-light","bulma-dark"].includes(n.theme)&&oo(`Invalid theme "${n.theme}"`);for(const e in n)Lse(e),n.toast&&Fse(e),Mse(e)};function NU(n){const e=go(),t=ms(),s=Ys.innerParams.get(this);if(!t||md(t,s.hideClass.popup)){oo("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const r=Pse(n),a=Object.assign({},s,r);TU(a),e.dataset.swal2Theme=a.theme,sU(this,a),Ys.innerParams.set(this,a),Object.defineProperties(this,{params:{value:Object.assign({},this.params,n),writable:!1,enumerable:!0}})}const Pse=n=>{const e={};return Object.keys(n).forEach(t=>{_U(t)?e[t]=n[t]:oo(`Invalid parameter to update: ${t}`)}),e};function AU(){const n=Ys.domCache.get(this),e=Ys.innerParams.get(this);if(!e){EU(this);return}n.popup&&sn.swalCloseEventFinishedCallback&&(sn.swalCloseEventFinishedCallback(),delete sn.swalCloseEventFinishedCallback),typeof e.didDestroy=="function"&&e.didDestroy(),sn.eventEmitter.emit("didDestroy"),zse(this)}const zse=n=>{EU(n),delete n.params,delete sn.keydownHandler,delete sn.keydownTarget,delete sn.currentInstance},EU=n=>{n.isAwaitingPromise?(z5(Ys,n),n.isAwaitingPromise=!0):(z5(B0,n),z5(Ys,n),delete n.isAwaitingPromise,delete n.disableButtons,delete n.enableButtons,delete n.getInput,delete n.disableInput,delete n.enableInput,delete n.hideLoading,delete n.disableLoading,delete n.showValidationMessage,delete n.resetValidationMessage,delete n.close,delete n.closePopup,delete n.closeModal,delete n.closeToast,delete n.rejectPromise,delete n.update,delete n._destroy)},z5=(n,e)=>{for(const t in n)n[t].delete(e)};var Bse=Object.freeze({__proto__:null,_destroy:AU,close:Df,closeModal:Df,closePopup:Df,closeToast:Df,disableButtons:bU,disableInput:wU,disableLoading:WC,enableButtons:yU,enableInput:vU,getInput:pU,handleAwaitingPromise:xw,hideLoading:WC,rejectPromise:uU,resetValidationMessage:SU,showValidationMessage:xU,update:NU});const jse=(n,e,t)=>{n.toast?Use(n,e,t):(Wse(e),Hse(e),Gse(n,e,t))},Use=(n,e,t)=>{e.popup.onclick=()=>{n&&(Vse(n)||n.timer||n.input)||t(y1.close)}},Vse=n=>!!(n.showConfirmButton||n.showDenyButton||n.showCancelButton||n.showCloseButton);let HC=!1;const Wse=n=>{n.popup.onmousedown=()=>{n.container.onmouseup=function(e){n.container.onmouseup=()=>{},e.target===n.container&&(HC=!0)}}},Hse=n=>{n.container.onmousedown=e=>{e.target===n.container&&e.preventDefault(),n.popup.onmouseup=function(t){n.popup.onmouseup=()=>{},(t.target===n.popup||t.target instanceof HTMLElement&&n.popup.contains(t.target))&&(HC=!0)}}},Gse=(n,e,t)=>{e.container.onclick=s=>{if(HC){HC=!1;return}s.target===e.container&&Z_(n.allowOutsideClick)&&t(y1.backdrop)}},qse=n=>typeof n=="object"&&n.jquery,az=n=>n instanceof Element||qse(n),Xse=n=>{const e={};return typeof n[0]=="object"&&!az(n[0])?Object.assign(e,n[0]):["title","html","icon"].forEach((t,s)=>{const r=n[s];typeof r=="string"||az(r)?e[t]=r:r!==void 0&&Qm(`Unexpected type of ${t}! Expected "string" or "Element", got ${typeof r}`)}),e};function Yse(...n){return new this(...n)}function Kse(n){class e extends this{_main(s,r){return super._main(s,Object.assign({},n,r))}}return e}const Zse=()=>sn.timeout&&sn.timeout.getTimerLeft(),IU=()=>{if(sn.timeout)return ane(),sn.timeout.stop()},OU=()=>{if(sn.timeout){const n=sn.timeout.start();return HO(n),n}},Jse=()=>{const n=sn.timeout;return n&&(n.running?IU():OU())},Qse=n=>{if(sn.timeout){const e=sn.timeout.increase(n);return HO(e,!0),e}},ere=()=>!!(sn.timeout&&sn.timeout.isRunning());let oz=!1;const FE={};function tre(n="data-swal-template"){FE[n]=this,oz||(document.body.addEventListener("click",nre),oz=!0)}const nre=n=>{for(let e=n.target;e&&e!==document;e=e.parentNode)for(const t in FE){const s=e.getAttribute(t);if(s){FE[t].fire({template:s});return}}};class sre{constructor(){this.events={}}_getHandlersByEventName(e){return typeof this.events[e]>"u"&&(this.events[e]=[]),this.events[e]}on(e,t){const s=this._getHandlersByEventName(e);s.includes(t)||s.push(t)}once(e,t){const s=(...r)=>{this.removeListener(e,s),t.apply(this,r)};this.on(e,s)}emit(e,...t){this._getHandlersByEventName(e).forEach(s=>{try{s.apply(this,t)}catch(r){console.error(r)}})}removeListener(e,t){const s=this._getHandlersByEventName(e),r=s.indexOf(t);r>-1&&s.splice(r,1)}removeAllListeners(e){this.events[e]!==void 0&&(this.events[e].length=0)}reset(){this.events={}}}sn.eventEmitter=new sre;const rre=(n,e)=>{sn.eventEmitter.on(n,e)},ire=(n,e)=>{sn.eventEmitter.once(n,e)},are=(n,e)=>{if(!n){sn.eventEmitter.reset();return}e?sn.eventEmitter.removeListener(n,e):sn.eventEmitter.removeAllListeners(n)};var ore=Object.freeze({__proto__:null,argsToParams:Xse,bindClickHandler:tre,clickCancel:Xne,clickConfirm:rU,clickDeny:qne,enableLoading:j0,fire:Yse,getActions:bw,getCancelButton:m1,getCloseButton:jO,getConfirmButton:bh,getContainer:go,getDenyButton:eg,getFocusableElements:UO,getFooter:G7,getHtmlContainer:zO,getIcon:p1,getIconContent:Qte,getImage:H7,getInputLabel:ene,getLoader:g1,getPopup:ms,getProgressSteps:BO,getTimerLeft:Zse,getTimerProgressBar:Q_,getTitle:W7,getValidationMessage:J_,increaseTimer:Qse,isDeprecatedParameter:kU,isLoading:nne,isTimerRunning:ere,isUpdatableParameter:_U,isValidParameter:CU,isVisible:Gne,mixin:Kse,off:are,on:rre,once:ire,resumeTimer:OU,showLoading:j0,stopTimer:IU,toggleTimer:Jse});class lre{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(e){const t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const DU=["swal-title","swal-html","swal-footer"],cre=n=>{const e=typeof n.template=="string"?document.querySelector(n.template):n.template;if(!e)return{};const t=e.content;return yre(t),Object.assign(ure(t),hre(t),dre(t),fre(t),pre(t),mre(t),gre(t,DU))},ure=n=>{const e={};return Array.from(n.querySelectorAll("swal-param")).forEach(s=>{Tm(s,["name","value"]);const r=s.getAttribute("name"),a=s.getAttribute("value");!r||!a||(typeof D0[r]=="boolean"?e[r]=a!=="false":typeof D0[r]=="object"?e[r]=JSON.parse(a):e[r]=a)}),e},hre=n=>{const e={};return Array.from(n.querySelectorAll("swal-function-param")).forEach(s=>{const r=s.getAttribute("name"),a=s.getAttribute("value");!r||!a||(e[r]=new Function(`return ${a}`)())}),e},dre=n=>{const e={};return Array.from(n.querySelectorAll("swal-button")).forEach(s=>{Tm(s,["type","color","aria-label"]);const r=s.getAttribute("type");!r||!["confirm","cancel","deny"].includes(r)||(e[`${r}ButtonText`]=s.innerHTML,e[`show${FO(r)}Button`]=!0,s.hasAttribute("color")&&(e[`${r}ButtonColor`]=s.getAttribute("color")),s.hasAttribute("aria-label")&&(e[`${r}ButtonAriaLabel`]=s.getAttribute("aria-label")))}),e},fre=n=>{const e={},t=n.querySelector("swal-image");return t&&(Tm(t,["src","width","height","alt"]),t.hasAttribute("src")&&(e.imageUrl=t.getAttribute("src")||void 0),t.hasAttribute("width")&&(e.imageWidth=t.getAttribute("width")||void 0),t.hasAttribute("height")&&(e.imageHeight=t.getAttribute("height")||void 0),t.hasAttribute("alt")&&(e.imageAlt=t.getAttribute("alt")||void 0)),e},pre=n=>{const e={},t=n.querySelector("swal-icon");return t&&(Tm(t,["type","color"]),t.hasAttribute("type")&&(e.icon=t.getAttribute("type")),t.hasAttribute("color")&&(e.iconColor=t.getAttribute("color")),e.iconHtml=t.innerHTML),e},mre=n=>{const e={},t=n.querySelector("swal-input");t&&(Tm(t,["type","label","placeholder","value"]),e.input=t.getAttribute("type")||"text",t.hasAttribute("label")&&(e.inputLabel=t.getAttribute("label")),t.hasAttribute("placeholder")&&(e.inputPlaceholder=t.getAttribute("placeholder")),t.hasAttribute("value")&&(e.inputValue=t.getAttribute("value")));const s=Array.from(n.querySelectorAll("swal-input-option"));return s.length&&(e.inputOptions={},s.forEach(r=>{Tm(r,["value"]);const a=r.getAttribute("value");if(!a)return;const o=r.innerHTML;e.inputOptions[a]=o})),e},gre=(n,e)=>{const t={};for(const s in e){const r=e[s],a=n.querySelector(r);a&&(Tm(a,[]),t[r.replace(/^swal-/,"")]=a.innerHTML.trim())}return t},yre=n=>{const e=DU.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(n.children).forEach(t=>{const s=t.tagName.toLowerCase();e.includes(s)||oo(`Unrecognized element <${s}>`)})},Tm=(n,e)=>{Array.from(n.attributes).forEach(t=>{e.indexOf(t.name)===-1&&oo([`Unrecognized attribute "${t.name}" on <${n.tagName.toLowerCase()}>.`,`${e.length?`Allowed attributes are: ${e.join(", ")}`:"To set the value, use HTML within the element."}`])})},$U=10,bre=n=>{const e=go(),t=ms();typeof n.willOpen=="function"&&n.willOpen(t),sn.eventEmitter.emit("willOpen",t);const r=window.getComputedStyle(document.body).overflowY;xre(e,t,n),setTimeout(()=>{vre(e,t)},$U),VO()&&(wre(e,n.scrollbarPadding,r),nse()),!ek()&&!sn.previousActiveElement&&(sn.previousActiveElement=document.activeElement),typeof n.didOpen=="function"&&setTimeout(()=>n.didOpen(t)),sn.eventEmitter.emit("didOpen",t)},GC=n=>{const e=ms();if(n.target!==e)return;const t=go();e.removeEventListener("animationend",GC),e.removeEventListener("transitionend",GC),t.style.overflowY="auto",pc(t,Ye["no-transition"])},vre=(n,e)=>{Y7(e)?(n.style.overflowY="hidden",e.addEventListener("animationend",GC),e.addEventListener("transitionend",GC)):n.style.overflowY="auto"},wre=(n,e,t)=>{sse(),e&&t!=="hidden"&&use(t),setTimeout(()=>{n.scrollTop=0})},xre=(n,e,t)=>{vs(n,t.showClass.backdrop),t.animation?(e.style.setProperty("opacity","0","important"),Zi(e,"grid"),setTimeout(()=>{vs(e,t.showClass.popup),e.style.removeProperty("opacity")},$U)):Zi(e,"grid"),vs([document.documentElement,document.body],Ye.shown),t.heightAuto&&t.backdrop&&!t.toast&&vs([document.documentElement,document.body],Ye["height-auto"])};var lz={email:(n,e)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(n)?Promise.resolve():Promise.resolve(e||"Invalid email address"),url:(n,e)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(n)?Promise.resolve():Promise.resolve(e||"Invalid URL")};function Sre(n){n.inputValidator||(n.input==="email"&&(n.inputValidator=lz.email),n.input==="url"&&(n.inputValidator=lz.url))}function Cre(n){(!n.target||typeof n.target=="string"&&!document.querySelector(n.target)||typeof n.target!="string"&&!n.target.appendChild)&&(oo('Target parameter is not valid, defaulting to "body"'),n.target="body")}function _re(n){Sre(n),n.showLoaderOnConfirm&&!n.preConfirm&&oo(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),Cre(n),typeof n.title=="string"&&(n.title=n.title.split(`
`).join("<br />")),pne(n)}let Xu;var SS=new WeakMap;class ri{constructor(...e){if(Hte(this,SS,void 0),typeof window>"u")return;Xu=this;const t=Object.freeze(this.constructor.argsToParams(e));this.params=t,this.isAwaitingPromise=!1,Gte(SS,this,this._main(Xu.params))}_main(e,t={}){if(TU(Object.assign({},t,e)),sn.currentInstance){const a=B0.swalPromiseResolve.get(sn.currentInstance),{isAwaitingPromise:o}=sn.currentInstance;sn.currentInstance._destroy(),o||a({isDismissed:!0}),VO()&&oU()}sn.currentInstance=Xu;const s=Tre(e,t);_re(s),Object.freeze(s),sn.timeout&&(sn.timeout.stop(),delete sn.timeout),clearTimeout(sn.restoreFocusTimeout);const r=Nre(Xu);return sU(Xu,s),Ys.innerParams.set(Xu,s),kre(Xu,r,s)}then(e){return J4(SS,this).then(e)}finally(e){return J4(SS,this).finally(e)}}const kre=(n,e,t)=>new Promise((s,r)=>{const a=o=>{n.close({isDismissed:!0,dismiss:o,isConfirmed:!1,isDenied:!1})};B0.swalPromiseResolve.set(n,s),B0.swalPromiseReject.set(n,r),e.confirmButton.onclick=()=>{Nse(n)},e.denyButton.onclick=()=>{Ase(n)},e.cancelButton.onclick=()=>{Ese(n,a)},e.closeButton.onclick=()=>{a(y1.close)},jse(t,e,a),Yne(sn,t,a),bse(n,t),bre(t),Are(sn,t,a),Ere(e,t),setTimeout(()=>{e.container.scrollTop=0})}),Tre=(n,e)=>{const t=cre(n),s=Object.assign({},D0,e,t,n);return s.showClass=Object.assign({},D0.showClass,s.showClass),s.hideClass=Object.assign({},D0.hideClass,s.hideClass),s.animation===!1&&(s.showClass={backdrop:"swal2-noanimation"},s.hideClass={}),s},Nre=n=>{const e={popup:ms(),container:go(),actions:bw(),confirmButton:bh(),denyButton:eg(),cancelButton:m1(),loader:g1(),closeButton:jO(),validationMessage:J_(),progressSteps:BO()};return Ys.domCache.set(n,e),e},Are=(n,e,t)=>{const s=Q_();$a(s),e.timer&&(n.timeout=new lre(()=>{t("timer"),delete n.timeout},e.timer),e.timerProgressBar&&(Zi(s),$l(s,e,"timerProgressBar"),setTimeout(()=>{n.timeout&&n.timeout.running&&HO(e.timer)})))},Ere=(n,e)=>{if(!e.toast){if(!Z_(e.allowEnterKey)){V7("allowEnterKey"),Dre();return}Ire(n)||Ore(n,e)||LE(-1,1)}},Ire=n=>{const e=Array.from(n.popup.querySelectorAll("[autofocus]"));for(const t of e)if(t instanceof HTMLElement&&Vo(t))return t.focus(),!0;return!1},Ore=(n,e)=>e.focusDeny&&Vo(n.denyButton)?(n.denyButton.focus(),!0):e.focusCancel&&Vo(n.cancelButton)?(n.cancelButton.focus(),!0):e.focusConfirm&&Vo(n.confirmButton)?(n.confirmButton.focus(),!0):!1,Dre=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};ri.prototype.disableButtons=bU;ri.prototype.enableButtons=yU;ri.prototype.getInput=pU;ri.prototype.disableInput=wU;ri.prototype.enableInput=vU;ri.prototype.hideLoading=WC;ri.prototype.disableLoading=WC;ri.prototype.showValidationMessage=xU;ri.prototype.resetValidationMessage=SU;ri.prototype.close=Df;ri.prototype.closePopup=Df;ri.prototype.closeModal=Df;ri.prototype.closeToast=Df;ri.prototype.rejectPromise=uU;ri.prototype.update=NU;ri.prototype._destroy=AU;Object.assign(ri,ore);Object.keys(Bse).forEach(n=>{ri[n]=function(...e){return Xu&&Xu[n]?Xu[n](...e):null}});ri.DismissReason=y1;ri.version="11.26.10";const $0=ri;$0.default=$0;typeof document<"u"&&(function(n,e){var t=n.createElement("style");if(n.getElementsByTagName("head")[0].appendChild(t),t.styleSheet)t.styleSheet.disabled||(t.styleSheet.cssText=e);else try{t.innerHTML=e}catch{t.innerText=e}})(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.15s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-timer-progress-bar-background: rgba(0, 0, 0, 0.3);--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white);--swal2-timer-progress-bar-background: rgba(255, 255, 255, 0.7)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white);--swal2-timer-progress-bar-background: rgba(255, 255, 255, 0.7)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;overflow-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:var(--swal2-timer-progress-bar-background)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;overflow-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:translate3d(0, -50px, 0) scale(0.9);opacity:0}100%{transform:translate3d(0, 0, 0) scale(1);opacity:1}}@keyframes swal2-hide{0%{transform:translate3d(0, 0, 0) scale(1);opacity:1}100%{transform:translate3d(0, -50px, 0) scale(0.9);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const Bn={success:n=>{$0.fire({icon:"success",title:"Success",text:n,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,background:"#fff",color:"#333"})},error:n=>{$0.fire({icon:"error",title:"Error",text:n,toast:!0,position:"top-end",showConfirmButton:!1,timer:4e3,background:"#fff",color:"#d33"})},info:n=>{$0.fire({icon:"info",title:"Info",text:n,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}};class $re{constructor(e){this.cm=e,this.canvas=e.canvas,this._isDisposed=!1,this.isDragging=!1,this.isSpacePanning=!1,this.isHandMode=!1,this.lastPosX=0,this.lastPosY=0,this.canvasWrapper=document.getElementById("canvas-wrapper"),this.zoomCallback=null,this.handleWindowResize=()=>{this.canvasWrapper&&!this._isDisposed&&this.resizeCanvasElement(this.canvasWrapper.clientWidth,this.canvasWrapper.clientHeight)},this.setupZoomPan(),window.addEventListener("resize",this.handleWindowResize),this.canvasWrapper&&(this.resizeTimeout=setTimeout(()=>{this._isDisposed||this.resizeCanvasElement(this.canvasWrapper.clientWidth,this.canvasWrapper.clientHeight)},0))}dispose(){this._isDisposed=!0,window.removeEventListener("resize",this.handleWindowResize),clearTimeout(this.resizeTimeout)}onZoomChange(e){this.zoomCallback=e}setupZoomPan(){this.canvas.on("mouse:wheel",e=>{if(!e.e.altKey)return;const t=e.e.deltaY;let s=this.canvas.getZoom();s*=.999**t,s>5&&(s=5),s<.05&&(s=.05);const r=new Ve(e.e.offsetX,e.e.offsetY);this.canvas.zoomToPoint(r,s),this.zoomCallback&&this.zoomCallback(s),e.e.preventDefault(),e.e.stopPropagation()}),this.canvas.on("mouse:down",e=>{const t=e.e;(this.isSpacePanning||this.isHandMode)&&(this.isDragging=!0,this.canvas.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY,this.canvas.setCursor("grabbing"))}),this.canvas.on("mouse:move",e=>{if(this.isDragging){const t=e.e,s=t.clientX-this.lastPosX,r=t.clientY-this.lastPosY;this.canvas.relativePan(new Ve(s,r)),this.lastPosX=t.clientX,this.lastPosY=t.clientY,e.e.preventDefault()}}),this.canvas.on("mouse:up",()=>{this.canvas.setViewportTransform(this.canvas.viewportTransform),this.isDragging=!1,(this.isHandMode||this.isSpacePanning)&&this.canvas.setCursor("grab"),!this.isHandMode&&!this.isSpacePanning?(this.canvas.selection=!0,this.canvas.setCursor("default")):this.canvas.setCursor("grab")})}setZoom(e){let t=e;t>5&&(t=5),t<.05&&(t=.05);const s=new Ve(this.canvas.width/2,this.canvas.height/2);this.canvas.zoomToPoint(s,t),this.zoomCallback&&this.zoomCallback(t)}zoomIn(){this.setZoom(this.canvas.getZoom()*1.2)}zoomOut(){this.setZoom(this.canvas.getZoom()/1.2)}resetZoom(){if(!this.cm.originalWidth)this.canvas.setViewportTransform([1,0,0,1,0,0]);else{const t=this.canvas.width,s=this.canvas.height,r=this.cm.originalWidth,a=this.cm.originalHeight,o=(t-r*1)/2,l=(s-a*1)/2;this.canvas.setViewportTransform([1,0,0,1,o,l])}this.zoomCallback&&this.zoomCallback(1)}fitToScreen(){if(!this.cm.originalWidth)return;const e=this.canvas.width,t=this.canvas.height,s=(e-80)/this.cm.originalWidth,r=(t-80)/this.cm.originalHeight;let a=Math.min(s,r);this.canvas.setViewportTransform([1,0,0,1,0,0]);const o=(e-this.cm.originalWidth*a)/2,l=(t-this.cm.originalHeight*a)/2;this.canvas.setViewportTransform([a,0,0,a,o,l]),this.canvas.requestRenderAll(),this.zoomCallback&&this.zoomCallback(a)}resizeCanvasElement(e,t){this.canvas.setDimensions({width:parseInt(e),height:parseInt(t)})}resizePage(e,t){const s=parseInt(e),r=parseInt(t);this.cm.originalWidth=s,this.cm.originalHeight=r,this.cm.workspace&&(this.cm.workspace.set({width:s,height:r}),this.cm.workspace.setCoords(),this.cm.canvas.requestRenderAll()),this.resetZoom()}toggleHandMode(){return this._isDisposed||!this.canvas?!1:(this.isHandMode=!this.isHandMode,this.isHandMode?(this.canvas.selection=!1,this.canvas.defaultCursor="grab",this.canvas.hoverCursor="grab",this.canvas.moveCursor="grab",this.canvas.setCursor("grab")):(this.canvas.selection=!0,this.canvas.defaultCursor="default",this.canvas.hoverCursor="move",this.canvas.moveCursor="move",this.canvas.setCursor("default")),this.isHandMode)}setSpacePanning(e){this._isDisposed||!this.canvas||this.isSpacePanning!==e&&(this.isSpacePanning=e,e?(this.canvas.selection=!1,this.canvas.defaultCursor="grab",this.canvas.hoverCursor="grab",this.canvas.moveCursor="grab",this.canvas.setCursor("grab"),this.canvas.discardActiveObject(),this.canvas.requestRenderAll()):(this.isHandMode||(this.canvas.selection=!0,this.canvas.defaultCursor="default",this.canvas.hoverCursor="move",this.canvas.moveCursor="move",this.canvas.setCursor("default")),this.isDragging=!1,this.canvas.requestRenderAll()))}}class Rre{constructor(e){this.cm=e,this.canvas=e.canvas,this.setupEvents(),this.setupDragDrop(),this.setupShortcuts()}dispose(){this.boundKeydown&&document.removeEventListener("keydown",this.boundKeydown),this.boundKeyup&&document.removeEventListener("keyup",this.boundKeyup),this.boundPaste&&document.removeEventListener("paste",this.boundPaste),this.canvas&&this.canvas.off()}setupEvents(){const e=()=>{this.cm.selectionCallback&&this.cm.selectionCallback(this.canvas.getActiveObject())};let t,s="Modification";const r=l=>{s=l,clearTimeout(t),t=setTimeout(()=>{o(s)},500)},a=(l,c)=>{if(!l)return c;const u=l.type==="i-text"?"Text":l.type==="image"?"Image":l.type.charAt(0).toUpperCase()+l.type.slice(1);return`${c} ${u}`},o=(l="Modification",c=null)=>{this.cm.historyManager&&this.cm.historyManager.saveState(l)};this.canvas.on("selection:created",e),this.canvas.on("selection:updated",e),this.canvas.on("selection:cleared",e),this.canvas.on("path:created",l=>{const c=l.path;c&&(c.set("strokeUniform",!0),c.setCoords(),this.canvas.requestRenderAll())}),this.canvas.on("object:modified",l=>{e();const c=a(l.target,"Modified");r(c)}),this.canvas.on("object:added",l=>{if(l.target&&!l.target.isSmartGuide&&!l.target.excludeFromExport){const c=a(l.target,"Added");o(c,l.target)}}),this.canvas.on("object:removed",l=>{if(l.target&&!l.target.isSmartGuide&&!l.target.excludeFromExport){const c=a(l.target,"Removed");o(c,l.target)}}),this.canvas.on("object:moving",l=>{e(),this.cm.snapToGrid&&this.cm.snapToGrid(l.target),this.cm.handleObjectMoving&&this.cm.handleObjectMoving(l)}),this.canvas.on("object:scaling",e),this.canvas.on("object:rotating",e),this.canvas.on("mouse:up",()=>{this.cm.clearGuidelines&&this.cm.clearGuidelines()})}setupDragDrop(){const e=this.canvas.wrapperEl;e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation()}),e.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation();const s=t.dataTransfer.files[0];if(s&&s.type.startsWith("image/")){const r=new FileReader;r.onload=a=>this.cm.addImage(a.target.result),r.readAsDataURL(s),Bn.success("Image uploaded via drag & drop")}})}setupShortcuts(){this.boundKeydown=async e=>{if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.isContentEditable||e.repeat||!this.cm||!this.cm.canvas)return;const t=this.cm.getActiveObject();if(e.key==="Delete"||e.key==="Backspace"){this.cm.removeActiveObject();return}if(t){const s=e.shiftKey?10:1;e.key==="ArrowLeft"?(e.preventDefault(),this.cm.nudgeActiveObject(-s,0)):e.key==="ArrowRight"?(e.preventDefault(),this.cm.nudgeActiveObject(s,0)):e.key==="ArrowUp"?(e.preventDefault(),this.cm.nudgeActiveObject(0,-s)):e.key==="ArrowDown"&&(e.preventDefault(),this.cm.nudgeActiveObject(0,s))}if((e.ctrlKey||e.metaKey)&&(e.code==="KeyC"&&(e.preventDefault(),await this.cm.copy()),e.code==="KeyV"&&this.cm.clipboardManager.clipboard&&(e.preventDefault(),await this.cm.paste()),e.code==="KeyD"&&(e.preventDefault(),this.cm.duplicateActiveObject())),(e.ctrlKey||e.metaKey)&&e.code==="KeyG"&&(e.preventDefault(),e.shiftKey?this.cm.ungroup():this.cm.group()),(e.ctrlKey||e.metaKey)&&e.code==="KeyA"&&(e.preventDefault(),this.cm.selectAll&&this.cm.selectAll()),e.code==="Space"||e.key===" "){if(t&&t.isEditing||this.cm.viewport&&this.cm.viewport.isSpacePanning)return;e.preventDefault(),this.cm.viewport&&this.cm.viewport.setSpacePanning(!0)}},this.boundKeyup=e=>{(e.code==="Space"||e.key===" ")&&this.cm&&this.cm.viewport&&this.cm.viewport.setSpacePanning(!1)},this.boundPaste=async e=>{if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.isContentEditable)return;const t=e.clipboardData||window.clipboardData;if(!t)return;const s=t.items;let r=!1;for(let a=0;a<s.length;a++)if(s[a].type.indexOf("image")!==-1){r=!0;const o=s[a].getAsFile(),l=new FileReader;l.onload=c=>{this.cm.addImage(c.target.result)},l.readAsDataURL(o),Bn.success("Image pasted from clipboard")}r&&e.preventDefault()},document.addEventListener("keydown",this.boundKeydown),document.addEventListener("keyup",this.boundKeyup),document.addEventListener("paste",this.boundPaste)}}class Lre{constructor(e){this.cm=e}get canvas(){return this.cm.canvas}get workspace(){return this.cm.workspace}align(e,t=!1){const s=this.canvas.getActiveObject();if(!s)return;const a=(s.type?s.type.toLowerCase():"")==="activeselection",o=a&&!t?s.getObjects():[s];let l;a&&!t?l=s.getBoundingRect():l={left:this.workspace.left,top:this.workspace.top,width:this.workspace.width,height:this.workspace.height},o.forEach(c=>{const d=a&&!t?c.getBoundingRect():c.getBoundingRect(!0),p=a&&!t?s.getBoundingRect():l;let m=0,g=0;switch(e){case"left":m=p.left-d.left;break;case"center":m=p.left+p.width/2-(d.left+d.width/2);break;case"right":m=p.left+p.width-(d.left+d.width);break;case"top":g=p.top-d.top;break;case"middle":g=p.top+p.height/2-(d.top+d.height/2);break;case"bottom":g=p.top+p.height-(d.top+d.height);break}(m!==0||g!==0)&&(c.set({left:c.left+m,top:c.top+g}),c.setCoords())}),a&&!t&&(typeof s._calcBounds=="function"&&s._calcBounds(),s.setCoords(),s.set("dirty",!0)),this.canvas.fire("object:modified",{target:s}),this.canvas.renderAll(),this.cm.historyManager&&this.cm.historyManager.saveState(`Align ${e}`)}distribute(e){const t=this.canvas.getActiveObject();if(!t||(t.type?t.type.toLowerCase():"")!=="activeselection")return;const r=t.getObjects().map(m=>({obj:m,bounds:m.getBoundingRect()})).sort((m,g)=>e==="horizontal"?m.bounds.left-g.bounds.left:m.bounds.top-g.bounds.top);if(r.length<3)return;const a=e==="horizontal",o=r.reduce((m,g)=>m+(a?g.bounds.width:g.bounds.height),0),l=t.getBoundingRect(),d=((a?l.width:l.height)-o)/(r.length-1);let p=a?l.left:l.top;r.forEach(m=>{const g=m.obj,b=m.bounds;if(a){const v=p-b.left;g.set("left",g.left+v),p+=b.width+d}else{const v=p-b.top;g.set("top",g.top+v),p+=b.height+d}g.setCoords(),g.set("dirty",!0)}),typeof t._calcBounds=="function"&&t._calcBounds(),t.setCoords(),t.set("dirty",!0),this.canvas.fire("object:modified",{target:t}),this.canvas.renderAll(),this.cm.historyManager&&this.cm.historyManager.saveState(`Distribute ${e}`)}}class Fre{constructor(e){this.cm=e,this.clipboard=null}get canvas(){return this.cm.canvas}get hasInternalContent(){return!!this.clipboard}async copy(){const e=this.canvas.getActiveObject();if(e){const t=await e.clone();this.clipboard=t,Bn.info("Copied to clipboard")}}async paste(){if(!this.clipboard)return;const e=await this.clipboard.clone();this.canvas.discardActiveObject(),e.set({left:e.left+10,top:e.top+10,evented:!0}),e.type==="activeSelection"?(e.canvas=this.canvas,e.forEachObject(t=>this.canvas.add(t)),e.setCoords()):this.canvas.add(e),this.clipboard.top+=10,this.clipboard.left+=10,this.canvas.setActiveObject(e),this.canvas.requestRenderAll(),Bn.success("Pasted object")}async duplicate(){const e=this.canvas.getActiveObject();if(!e)return;const t=await e.clone();this.canvas.discardActiveObject(),t.set({left:(e.left||0)+10,top:(e.top||0)+10,evented:!0}),t.type==="activeSelection"?(t.canvas=this.canvas,t.forEachObject(s=>this.canvas.add(s)),t.setCoords()):this.canvas.add(t),this.canvas.setActiveObject(t),this.canvas.requestRenderAll(),Bn.success("Object duplicated")}}class Mre{constructor(e){this.cm=e,this.gridObject=null,this.snapThreshold=10,this.guidelines=[]}get canvas(){return this.cm.canvas}get workspace(){return this.cm.workspace}get originalWidth(){return this.cm.originalWidth}get originalHeight(){return this.cm.originalHeight}toggleGrid(){if(this.gridObject)return this.canvas.remove(this.gridObject),this.gridObject=null,this.canvas.requestRenderAll(),!1;const e=50,t=document.createElement("canvas");t.width=e,t.height=e;const s=t.getContext("2d");s.strokeStyle="rgba(0, 0, 0, 0.1)",s.lineWidth=1,s.beginPath(),s.moveTo(.5,0),s.lineTo(.5,e),s.moveTo(0,.5),s.lineTo(e,.5),s.stroke();const r=new WS({source:t,repeat:"repeat"}),a=new wl({left:0,top:0,width:this.originalWidth,height:this.originalHeight,fill:r,selectable:!1,evented:!1,excludeFromExport:!0});if(this.gridObject=a,this.canvas.add(a),this.workspace){const o=this.canvas.getObjects().indexOf(this.workspace);this.canvas.moveObjectTo(a,o+1)}else this.canvas.sendObjectToBack(a);return this.canvas.requestRenderAll(),!0}snapToGrid(e){if(!this.gridObject)return;const t=50,s=10,r=Math.round(e.left/t)*t,a=Math.round(e.top/t)*t;Math.abs(e.left-r)<s&&e.set("left",r),Math.abs(e.top-a)<s&&e.set("top",a)}addGuide(e,t){let s;const r={stroke:"cyan",strokeDashArray:[4,4],strokeWidth:1,selectable:!0,evented:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!1,hasBorders:!1,id:"guide",excludeFromExport:!0};return e==="horizontal"?s=new th([0,0,this.originalWidth,0],{...r,top:t,left:0,lockMovementX:!0,lockMovementY:!1,hoverCursor:"ns-resize",moveCursor:"ns-resize",width:this.originalWidth}):s=new th([0,0,0,this.originalHeight],{...r,top:0,left:t,lockMovementX:!1,lockMovementY:!0,hoverCursor:"ew-resize",moveCursor:"ew-resize",height:this.originalHeight}),this.canvas.add(s),this.canvas.bringObjectToFront(s),this.canvas.setActiveObject(s),this.canvas.requestRenderAll(),s}handleObjectMoving(e){const t=e.target,s=this.canvas,r=this.originalWidth,a=this.originalHeight,o=this.snapThreshold;this.clearGuidelines();const l=t.left,c=t.top,u=t.getScaledWidth(),d=t.getScaledHeight(),p=l+u/2,m=c+d/2,g=l+u,b=c+d;let v=null,x=null;Math.abs(p-r/2)<o&&(t.set({left:r/2-u/2}),v=r/2),v||s.getObjects().forEach(S=>{if(S===t||!S.visible)return;if(S.id==="guide"){if(S.lockMovementY){const F=S.left;Math.abs(l-F)<o?(t.set({left:F}),v=F):Math.abs(g-F)<o?(t.set({left:F-u}),v=F):Math.abs(p-F)<o&&(t.set({left:F-u/2}),v=F)}return}const C=S.left,A=S.getScaledWidth(),k=C+A/2,O=C+A;Math.abs(p-k)<o?(t.set({left:k-u/2}),v=k):Math.abs(l-C)<o?(t.set({left:C}),v=C):Math.abs(g-O)<o?(t.set({left:O-u}),v=O):Math.abs(l-O)<o?(t.set({left:O}),v=O):Math.abs(g-C)<o&&(t.set({left:C-u}),v=C)}),Math.abs(m-a/2)<o&&(t.set({top:a/2-d/2}),x=a/2),x||s.getObjects().forEach(S=>{if(S===t||!S.visible)return;if(S.id==="guide"){if(S.lockMovementX){const F=S.top;Math.abs(c-F)<o?(t.set({top:F}),x=F):Math.abs(b-F)<o?(t.set({top:F-d}),x=F):Math.abs(m-F)<o&&(t.set({top:F-d/2}),x=F)}return}const C=S.top,A=S.getScaledHeight(),k=C+A/2,O=C+A;Math.abs(m-k)<o?(t.set({top:k-d/2}),x=k):Math.abs(c-C)<o?(t.set({top:C}),x=C):Math.abs(b-O)<o?(t.set({top:O-d}),x=O):Math.abs(c-O)<o?(t.set({top:O}),x=O):Math.abs(b-C)<o&&(t.set({top:C-d}),x=C)}),v!==null&&this.drawVerticalLine(v),x!==null&&this.drawHorizontalLine(x)}clearGuidelines(){this.canvas.getObjects("line").forEach(e=>{e.isSmartGuide&&this.canvas.remove(e)}),this.canvas.requestRenderAll()}drawVerticalLine(e){this.drawGuideLine([e,0,e,this.originalHeight])}drawHorizontalLine(e){this.drawGuideLine([0,e,this.originalWidth,e])}drawGuideLine(e){const t=new th(e,{stroke:"red",strokeWidth:1,selectable:!1,evented:!1,strokeDashArray:[4,4],isSmartGuide:!0,excludeFromExport:!0});this.canvas.add(t)}}class Pre{constructor(e){this.canvasManager=e}get canvas(){return this.canvasManager.canvas}getActiveObject(){return this.canvasManager.getActiveObject()}async duplicate(){}toggleLock(){const e=this.getActiveObject();if(!e)return;const t=!e.lockMovementX;e.set({lockMovementX:t,lockMovementY:t,lockScalingX:t,lockScalingY:t,lockRotation:t,hasControls:!t,selectable:!0}),this.canvas.requestRenderAll(),Bn.info(t?"Object locked":"Object unlocked")}reset(){this.canvas.discardActiveObject(),this.canvas.requestRenderAll()}remove(){const e=this.getActiveObject();!e||e.isEditing||(e.type==="activeSelection"||e instanceof iu?e.forEachObject(t=>{this.canvas.remove(t)}):this.canvas.remove(e),this.canvas.discardActiveObject(),this.canvas.requestRenderAll(),this.canvasManager.selectionCallback&&this.canvasManager.selectionCallback(null),Bn.success("Object(s) removed"))}flip(e){const t=this.getActiveObject();t&&(t.type==="activeSelection"?t.forEachObject(s=>{e==="horizontal"?s.set("flipX",!s.flipX):s.set("flipY",!s.flipY)}):e==="horizontal"?t.set("flipX",!t.flipX):t.set("flipY",!t.flipY),this.canvas.requestRenderAll(),this.canvas.requestRenderAll())}layer(e){switch(e){case"up":this.bringForward();break;case"down":this.sendBackward();break;case"front":this.bringToFront();break;case"back":this.sendToBack();break}}bringForward(){const e=this.getActiveObject();e&&(this.canvas.bringObjectForward(e),this.canvas.requestRenderAll(),this.canvas.requestRenderAll())}sendBackward(){const e=this.getActiveObject();e&&this.canvas.getObjects().indexOf(e)>1&&(this.canvas.sendObjectBackwards(e),this.canvas.requestRenderAll(),this.canvas.requestRenderAll())}bringToFront(){const e=this.getActiveObject();e&&(this.canvas.bringObjectToFront(e),this.canvas.requestRenderAll(),this.canvas.requestRenderAll())}sendToBack(){const e=this.getActiveObject();e&&(this.canvas.sendObjectToBack(e),this.canvasManager.workspace&&this.canvas.sendObjectToBack(this.canvasManager.workspace),this.canvas.requestRenderAll(),this.canvas.requestRenderAll())}group(){const e=this.getActiveObject();if(!e||e.type!=="activeSelection"&&e.type!=="activeselection")return;const t=e.getObjects();this.canvas.discardActiveObject(),t.forEach(r=>this.canvas.remove(r));const s=new Al(t,{selectable:!0,evented:!0,subTargetCheck:!1,interactive:!1});s.setCoords(),this.canvas.add(s),this.canvas.setActiveObject(s),this.canvas.requestRenderAll(),Bn.success("Grouped objects")}async ungroup(){const e=this.getActiveObject();if(!e||e.type!=="group"&&e.type!=="Group")return;const t=e.calcTransformMatrix(),s=e.angle||0,r=e.scaleX||1,a=e.scaleY||1,o=[...e.getObjects()];this.canvas.remove(e),this.canvas.discardActiveObject();const l=[],c=o.map(d=>d.clone()),u=await Promise.all(c);for(let d=0;d<u.length;d++){const p=o[d],m=u[d],g=fr.transformPoint(new Ve(p.left,p.top),t);m.set({left:g.x,top:g.y,angle:(p.angle||0)+s,scaleX:(p.scaleX||1)*r,scaleY:(p.scaleY||1)*a,group:null,selectable:!0,evented:!0,dirty:!0}),m.setCoords(),this.canvas.add(m),l.push(m)}if(l.length>0){const d=new iu(l,{canvas:this.canvas});this.canvas.setActiveObject(d)}this.canvas.requestRenderAll(),Bn.success("Ungrouped objects")}}const cz={rect:n=>new wl({strokeUniform:!0,...n}),circle:n=>(n.width&&!n.radius&&(n.radius=n.width/2),new Yu({strokeUniform:!0,...n})),triangle:n=>new Af({strokeUniform:!0,...n}),star:n=>{const e=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}],t=new Ef(e,{strokeUniform:!0,...n,objectCaching:!1});return t.scaleToWidth(n.width||100),t},pentagon:n=>{const e=[{x:50,y:0},{x:100,y:38},{x:82,y:100},{x:18,y:100},{x:0,y:38}],t=new Ef(e,{strokeUniform:!0,...n,objectCaching:!1});return t.scaleToWidth(n.width||100),t},hexagon:n=>{const e=[{x:50,y:0},{x:100,y:25},{x:100,y:75},{x:50,y:100},{x:0,y:75},{x:0,y:25}],t=new Ef(e,{strokeUniform:!0,...n,objectCaching:!1});return t.scaleToWidth(n.width||100),t},arrow:n=>{const e=[{x:0,y:25},{x:50,y:25},{x:50,y:0},{x:100,y:50},{x:50,y:100},{x:50,y:75},{x:0,y:75}],t=new Ef(e,{strokeUniform:!0,...n,objectCaching:!1});return t.scaleToWidth(n.width||100),t},heart:n=>{const e="M 272.70141,238.71731         C 206.46141,238.71731 152.70141,292.47731 152.70141,358.71731          C 152.70141,493.46231 288.63461,521.28716 381.92956,598.5043         C 468.52458,519.8324 611.16641,496.06231 611.16641,358.71731         C 611.16641,292.47731 557.40641,238.71731 491.16641,238.71731         C 449.12141,238.71731 411.66641,262.11731 381.92956,298.5043         C 352.19271,262.11731 314.73141,238.71731 272.70141,238.71731          z",t=new eh(e,{strokeUniform:!0,...n,objectCaching:!1});return t.scaleToWidth(n.width||100),t},message_box:n=>{const e="M20,2H4C2.9,2,2,2.9,2,4v18l4-4h14c1.1,0,2-0.9,2-2V4C22,2.9,21.1,2,20,2z",t=new eh(e,{strokeUniform:!0,...n,objectCaching:!1});return t.scaleToWidth(n.width||100),t}},zre=(n,e)=>cz[n]?cz[n](e):(console.warn(`Shape type "${n}" not found in config.`),null);class Bre{constructor(e){this.canvasManager=e}get canvas(){return this.canvasManager.canvas}addText(e="Double click to edit",t={}){const s=new sh(e,{left:100,top:100,fontFamily:"'Phetsarath OT', 'Noto Sans Lao', sans-serif",fill:"#333",fontSize:40,...t});this.canvas.add(s),this.canvas.setActiveObject(s),this.canvas.requestRenderAll()}async addImage(e,t={}){try{const s=await Na.fromURL(e);s.width>this.canvasManager.originalWidth&&s.scaleToWidth(this.canvasManager.originalWidth/2),t.fill&&s.set({tint:t.fill}),this.canvas.add(s),s.set({left:this.canvasManager.originalWidth/2,top:this.canvasManager.originalHeight/2,originX:"center",originY:"center"}),this.canvas.setActiveObject(s),this.canvas.requestRenderAll()}catch(s){console.error("Error loading image:",s)}}addShape(e,t={}){const s={left:100,top:100,...t},r=zre(e,s);r&&(this.canvas.add(r),this.canvas.setActiveObject(r),this.canvas.requestRenderAll())}async addSVG(e,t={}){try{const s=await RJ(e),{objects:r,opts:a}=s;if(r&&r.length>0){const o=new Al(r,{...a,...t,strokeUniform:!0,left:100,top:100}),l=c=>{c.forEach(u=>{u.set("strokeUniform",!0),u.type==="group"&&l(u._objects)})};if(o._objects&&l(o._objects),t.fill){const c=u=>{u.forEach(d=>{d.type==="group"?c(d._objects):d.set&&d.set("fill",t.fill)})};o._objects&&c(o._objects),o.set("fill",t.fill)}this.canvas.add(o),this.canvas.setActiveObject(o),this.canvas.requestRenderAll()}else Bn.info("Loaded SVG but found no objects.")}catch(s){console.error("SVG Load Error",s),Bn.error("Failed to load SVG: "+s.message)}}async addSVGString(e,t={}){try{const s=await G8(e),{objects:r,opts:a}=s;if(r&&r.length>0){const o=new Al(r,{...a,...t,strokeUniform:!0,left:100,top:100}),l=c=>{c.forEach(u=>{u.set("strokeUniform",!0),u.type==="group"&&l(u._objects)})};if(o._objects&&l(o._objects),t.fill){const c=u=>{u.forEach(d=>{d.type==="group"?c(d._objects):d.set&&(d.set("fill",t.fill),d.type==="path"&&d.set("stroke",t.fill))})};o._objects&&c(o._objects),o.set("fill",t.fill)}this.canvas.add(o),this.canvas.setActiveObject(o),this.canvas.requestRenderAll()}}catch(s){console.error("SVG String Load Error",s)}}}class uz{constructor(e){this.canvasManager=e}get canvas(){return this.canvasManager.canvas}applyImageFilter(e,t,s){if(!e||!e.filters)return;const a={brightness:"Brightness",contrast:"Contrast",blur:"Blur",sharpen:"Convolute",saturation:"Saturation",grayscale:"Grayscale",sepia:"Sepia",hue:"HueRotation",noise:"Noise",pixelate:"Pixelate",tint:"BlendColor"}[t];if(!a)return;let o=e.filters.find(l=>l.type===a);if(!o){const l=JJ[a];if(l){let c={};t==="blur"?c={blur:s}:t==="pixelate"?c={blocksize:s}:t==="hue"?c={rotation:s}:t==="tint"?c={color:s,mode:"multiply",alpha:.5}:t==="sharpen"?c={matrix:[0,0,0,0,1,0,0,0,0]}:c[t]=s,o=new l(c),e.filters.push(o)}}if(o){let l=!1;if(t==="blur")o.blur=s,s===0&&(l=!0);else if(t==="pixelate")o.blocksize=s,s===0&&(l=!0);else if(t==="hue")o.rotation=s,s===0&&(l=!0);else if(t==="grayscale"||t==="sepia")s===0&&(l=!0);else if(t==="tint")o.color=s,(!s||s==="transparent"||s==="rgba(0,0,0,0)")&&(l=!0);else if(t==="noise")o.noise=s,s===0&&(l=!0);else if(t==="sharpen")if(s<=0)l=!0;else{const c=s;o.matrix=[0,-c,0,-c,1+4*c,-c,0,-c,0]}else o[t]=s,s===0&&(l=!0);if(l){const c=e.filters.indexOf(o);c>-1&&e.filters.splice(c,1)}}e.applyFilters(),this.canvas.requestRenderAll()}}class jre{constructor(e){this.canvasManager=e}get canvas(){return this.canvasManager.canvas}loadGoogleFont(e){if(!e||["Arial","Times New Roman","Courier New","Verdana","Georgia","Trebuchet MS","Impact","Noto Sans Lao Looped","Noto Serif Lao","Phetsarath OT","Noto Sans Lao"].some(a=>e.includes(a)))return;const s=e.replace(/['"]/g,"").split(",")[0].trim(),r="font-css-"+s.replace(/\s+/g,"-").toLowerCase();if(!document.getElementById(r)){const a=document.createElement("link");a.id=r,a.rel="stylesheet",a.href=`https://fonts.googleapis.com/css2?family=${s.replace(/\s+/g,"+")}:wght@400;700&display=swap`,document.head.appendChild(a),a.onload=()=>{this.canvas.requestRenderAll()}}}setTextStyle(e,t){const s=this.canvasManager.getActiveObject();s&&s.type==="i-text"&&(e==="fontFamily"&&this.loadGoogleFont(t),s.set(e,t),this.canvas.requestRenderAll())}toggleTextDecoration(e){const t=this.canvasManager.getActiveObject();if(t&&t.type==="i-text"){if(e==="fontWeight"){const s=t.fontWeight==="bold";t.set("fontWeight",s?"normal":"bold")}else if(e==="fontStyle"){const s=t.fontStyle==="italic";t.set("fontStyle",s?"normal":"italic")}else e==="underline"&&t.set("underline",!t.underline);this.canvas.requestRenderAll()}return t[e]}}var Ure=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var a in r)r.hasOwnProperty(a)&&(s[a]=r[a])},n(e,t)};return function(e,t){n(e,t);function s(){this.constructor=e}e.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}})(),Vre=Object.prototype.hasOwnProperty;function ME(n,e){return Vre.call(n,e)}function PE(n){if(Array.isArray(n)){for(var e=new Array(n.length),t=0;t<e.length;t++)e[t]=""+t;return e}if(Object.keys)return Object.keys(n);var s=[];for(var r in n)ME(n,r)&&s.push(r);return s}function _l(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function zE(n){for(var e=0,t=n.length,s;e<t;){if(s=n.charCodeAt(e),s>=48&&s<=57){e++;continue}return!1}return!0}function Xp(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function RU(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function BE(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(var e=0,t=n.length;e<t;e++)if(BE(n[e]))return!0}else if(typeof n=="object"){for(var s=PE(n),r=s.length,a=0;a<r;a++)if(BE(n[s[a]]))return!0}}return!1}function hz(n,e){var t=[n];for(var s in e){var r=typeof e[s]=="object"?JSON.stringify(e[s],null,2):e[s];typeof r<"u"&&t.push(s+": "+r)}return t.join(`
`)}var LU=(function(n){Ure(e,n);function e(t,s,r,a,o){var l=this.constructor,c=n.call(this,hz(t,{name:s,index:r,operation:a,tree:o}))||this;return c.name=s,c.index=r,c.operation=a,c.tree=o,Object.setPrototypeOf(c,l.prototype),c.message=hz(t,{name:s,index:r,operation:a,tree:o}),c}return e})(Error),Fr=LU,Wre=_l,C0={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var s=n[e];return delete n[e],{newDocument:t,removed:s}},replace:function(n,e,t){var s=n[e];return n[e]=this.value,{newDocument:t,removed:s}},move:function(n,e,t){var s=qC(t,this.path);s&&(s=_l(s));var r=fm(t,{op:"remove",path:this.from}).removed;return fm(t,{op:"add",path:this.path,value:r}),{newDocument:t,removed:s}},copy:function(n,e,t){var s=qC(t,this.from);return fm(t,{op:"add",path:this.path,value:_l(s)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Nv(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},Hre={add:function(n,e,t){return zE(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var s=n.splice(e,1);return{newDocument:t,removed:s[0]}},replace:function(n,e,t){var s=n[e];return n[e]=this.value,{newDocument:t,removed:s}},move:C0.move,copy:C0.copy,test:C0.test,_get:C0._get};function qC(n,e){if(e=="")return n;var t={op:"_get",path:e};return fm(n,t),t.value}function fm(n,e,t,s,r,a){if(t===void 0&&(t=!1),s===void 0&&(s=!0),r===void 0&&(r=!0),a===void 0&&(a=0),t&&(typeof t=="function"?t(e,0,n,e.path):XC(e,0)),e.path===""){var o={newDocument:n};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=n,o;if(e.op==="move"||e.op==="copy")return o.newDocument=qC(n,e.from),e.op==="move"&&(o.removed=n),o;if(e.op==="test"){if(o.test=Nv(n,e.value),o.test===!1)throw new Fr("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return o.newDocument=n,o}else{if(e.op==="remove")return o.removed=n,o.newDocument=null,o;if(e.op==="_get")return e.value=n,o;if(t)throw new Fr("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return o}}else{s||(n=_l(n));var l=e.path||"",c=l.split("/"),u=n,d=1,p=c.length,m=void 0,g=void 0,b=void 0;for(typeof t=="function"?b=t:b=XC;;){if(g=c[d],g&&g.indexOf("~")!=-1&&(g=RU(g)),r&&(g=="__proto__"||g=="prototype"&&d>0&&c[d-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&m===void 0&&(u[g]===void 0?m=c.slice(0,d).join("/"):d==p-1&&(m=e.path),m!==void 0&&b(e,0,n,m)),d++,Array.isArray(u)){if(g==="-")g=u.length;else{if(t&&!zE(g))throw new Fr("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);zE(g)&&(g=~~g)}if(d>=p){if(t&&e.op==="add"&&g>u.length)throw new Fr("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);var o=Hre[e.op].call(e,u,g,n);if(o.test===!1)throw new Fr("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return o}}else if(d>=p){var o=C0[e.op].call(e,u,g,n);if(o.test===!1)throw new Fr("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return o}if(u=u[g],t&&d<p&&(!u||typeof u!="object"))throw new Fr("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function nk(n,e,t,s,r){if(s===void 0&&(s=!0),r===void 0&&(r=!0),t&&!Array.isArray(e))throw new Fr("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(n=_l(n));for(var a=new Array(e.length),o=0,l=e.length;o<l;o++)a[o]=fm(n,e[o],t,!0,r,o),n=a[o].newDocument;return a.newDocument=n,a}function Gre(n,e,t){var s=fm(n,e);if(s.test===!1)throw new Fr("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return s.newDocument}function XC(n,e,t,s){if(typeof n!="object"||n===null||Array.isArray(n))throw new Fr("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(C0[n.op]){if(typeof n.path!="string")throw new Fr("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new Fr('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new Fr("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new Fr("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&BE(n.value))throw new Fr("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var r=n.path.split("/").length,a=s.split("/").length;if(r!==a+1&&r!==a)throw new Fr("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==s)throw new Fr("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var o={op:"_get",path:n.from,value:void 0},l=FU([o],t);if(l&&l.name==="OPERATION_PATH_UNRESOLVABLE")throw new Fr("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new Fr("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function FU(n,e,t){try{if(!Array.isArray(n))throw new Fr("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)nk(_l(e),_l(n),t||!0);else{t=t||XC;for(var s=0;s<n.length;s++)t(n[s],s,e,void 0)}}catch(r){if(r instanceof Fr)return r;throw r}}function Nv(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),s=Array.isArray(e),r,a,o;if(t&&s){if(a=n.length,a!=e.length)return!1;for(r=a;r--!==0;)if(!Nv(n[r],e[r]))return!1;return!0}if(t!=s)return!1;var l=Object.keys(n);if(a=l.length,a!==Object.keys(e).length)return!1;for(r=a;r--!==0;)if(!e.hasOwnProperty(l[r]))return!1;for(r=a;r--!==0;)if(o=l[r],!Nv(n[o],e[o]))return!1;return!0}return n!==n&&e!==e}const qre=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:Fr,_areEquals:Nv,applyOperation:fm,applyPatch:nk,applyReducer:Gre,deepClone:Wre,getValueByPointer:qC,validate:FU,validator:XC},Symbol.toStringTag,{value:"Module"}));var ZO=new WeakMap,Xre=(function(){function n(e){this.observers=new Map,this.obj=e}return n})(),Yre=(function(){function n(e,t){this.callback=e,this.observer=t}return n})();function Kre(n){return ZO.get(n)}function Zre(n,e){return n.observers.get(e)}function Jre(n,e){n.observers.delete(e.callback)}function Qre(n,e){e.unobserve()}function eie(n,e){var t=[],s,r=Kre(n);if(!r)r=new Xre(n),ZO.set(n,r);else{var a=Zre(r,e);s=a&&a.observer}if(s)return s;if(s={},r.value=_l(n),e){s.callback=e,s.next=null;var o=function(){jE(s)},l=function(){clearTimeout(s.next),s.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",l),window.addEventListener("keyup",l),window.addEventListener("mousedown",l),window.addEventListener("keydown",l),window.addEventListener("change",l))}return s.patches=t,s.object=n,s.unobserve=function(){jE(s),clearTimeout(s.next),Jre(r,s),typeof window<"u"&&(window.removeEventListener("mouseup",l),window.removeEventListener("keyup",l),window.removeEventListener("mousedown",l),window.removeEventListener("keydown",l),window.removeEventListener("change",l))},r.observers.set(e,new Yre(e,s)),s}function jE(n,e){e===void 0&&(e=!1);var t=ZO.get(n.object);JO(t.value,n.object,n.patches,"",e),n.patches.length&&nk(t.value,n.patches);var s=n.patches;return s.length>0&&(n.patches=[],n.callback&&n.callback(s)),s}function JO(n,e,t,s,r){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=PE(e),o=PE(n),l=!1,c=o.length-1;c>=0;c--){var u=o[c],d=n[u];if(ME(e,u)&&!(e[u]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var p=e[u];typeof d=="object"&&d!=null&&typeof p=="object"&&p!=null&&Array.isArray(d)===Array.isArray(p)?JO(d,p,t,s+"/"+Xp(u),r):d!==p&&(r&&t.push({op:"test",path:s+"/"+Xp(u),value:_l(d)}),t.push({op:"replace",path:s+"/"+Xp(u),value:_l(p)}))}else Array.isArray(n)===Array.isArray(e)?(r&&t.push({op:"test",path:s+"/"+Xp(u),value:_l(d)}),t.push({op:"remove",path:s+"/"+Xp(u)}),l=!0):(r&&t.push({op:"test",path:s,value:n}),t.push({op:"replace",path:s,value:e}))}if(!(!l&&a.length==o.length))for(var c=0;c<a.length;c++){var u=a[c];!ME(n,u)&&e[u]!==void 0&&t.push({op:"add",path:s+"/"+Xp(u),value:_l(e[u])})}}}function UE(n,e,t){t===void 0&&(t=!1);var s=[];return JO(n,e,s,"",t),s}const tie=Object.freeze(Object.defineProperty({__proto__:null,compare:UE,generate:jE,observe:eie,unobserve:Qre},Symbol.toStringTag,{value:"Module"}));Object.assign({},qre,tie,{JsonPatchError:LU,deepClone:_l,escapePathComponent:Xp,unescapePathComponent:RU});class nie{constructor(e){this.cm=e,this.history=[],this.currentIndex=-1,this.locked=!1,this.maxDepth=50,this.saveState("Initial")}get canvas(){return this.cm.canvas}saveState(e=null){if(this.locked||!this.canvas)return;const t=this.cm.saveProject();if(this.currentIndex===-1)this.history=[{state:JSON.parse(JSON.stringify(t)),label:e||"Initial"}],this.currentIndex=0;else{const s=this.getFullState(this.currentIndex),r=UE(s,t);if(r.length===0)return;const a=UE(t,s);if(this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1)),this.history.push({forward:r,backward:a,label:e||"Action"}),this.currentIndex++,this.history.length>this.maxDepth){this.history.shift(),this.currentIndex--;const o=this.getFullState(0);this.history[0]={state:o,label:this.history[0].label}}}this.notifyUpdate()}getFullState(e){if(e<0||e>=this.history.length)return null;let t=JSON.parse(JSON.stringify(this.history[0].state));for(let s=1;s<=e;s++)t=nk(t,this.history[s].forward).newDocument;return t}async undo(){if(this.currentIndex<=0)return;this.currentIndex--;const e=this.getFullState(this.currentIndex);await this.loadState(e),this.notifyUpdate()}async redo(){if(this.currentIndex>=this.history.length-1)return;this.currentIndex++;const e=this.getFullState(this.currentIndex);await this.loadState(e),this.notifyUpdate()}async loadState(e){this.locked=!0;try{await this.cm.loadProject(e)}catch(t){console.error("History Load Error:",t),Bn.error("Failed to restore state")}finally{this.locked=!1}}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}notifyUpdate(){window.dispatchEvent(new CustomEvent("historyUpdate",{detail:{canUndo:this.canUndo(),canRedo:this.canRedo(),label:this.history[this.currentIndex]?.label||""}}))}}var B5={exports:{}},dz;function sie(){return dz||(dz=1,(function(n){(function(){function e(){var t=this;this.versionnumber="1.2.6",this.imageToSVG=function(s,r,a){a=t.checkoptions(a),t.loadImage(s,function(o){r(t.imagedataToSVG(t.getImgdata(o),a))},a)},this.imagedataToSVG=function(s,r){r=t.checkoptions(r);var a=t.imagedataToTracedata(s,r);return t.getsvgstring(a,r)},this.imageToTracedata=function(s,r,a){a=t.checkoptions(a),t.loadImage(s,function(o){r(t.imagedataToTracedata(t.getImgdata(o),a))},a)},this.imagedataToTracedata=function(s,r){r=t.checkoptions(r);var a=t.colorquantization(s,r);if(r.layering===0)for(var o={layers:[],palette:a.palette,width:a.array[0].length-2,height:a.array.length-2},l=0;l<a.palette.length;l++){var c=t.batchtracepaths(t.internodes(t.pathscan(t.layeringstep(a,l),r.pathomit),r),r.ltres,r.qtres);o.layers.push(c)}else{var u=t.layering(a);r.layercontainerid&&t.drawLayers(u,t.specpalette,r.scale,r.layercontainerid);var d=t.batchpathscan(u,r.pathomit),p=t.batchinternodes(d,r),o={layers:t.batchtracelayers(p,r.ltres,r.qtres),palette:a.palette,width:s.width,height:s.height}}return o},this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.checkoptions=function(s){s=s||{},typeof s=="string"&&(s=s.toLowerCase(),t.optionpresets[s]?s=t.optionpresets[s]:s={});for(var r=Object.keys(t.optionpresets.default),a=0;a<r.length;a++)s.hasOwnProperty(r[a])||(s[r[a]]=t.optionpresets.default[r[a]]);return s},this.colorquantization=function(s,r){var a=[],o=0,l,c,u,d=[],p=s.width*s.height,m,g,b,v,x;if(s.data.length<p*4){for(var S=new Uint8ClampedArray(p*4),C=0;C<p;C++)S[C*4]=s.data[C*3],S[C*4+1]=s.data[C*3+1],S[C*4+2]=s.data[C*3+2],S[C*4+3]=255;s.data=S}for(g=0;g<s.height+2;g++)for(a[g]=[],m=0;m<s.width+2;m++)a[g][m]=-1;for(r.pal?x=r.pal:r.colorsampling===0?x=t.generatepalette(r.numberofcolors):r.colorsampling===1?x=t.samplepalette(r.numberofcolors,s):x=t.samplepalette2(r.numberofcolors,s),r.blurradius>0&&(s=t.blur(s,r.blurradius,r.blurdelta)),v=0;v<r.colorquantcycles;v++){if(v>0)for(b=0;b<x.length;b++)d[b].n>0&&(x[b]={r:Math.floor(d[b].r/d[b].n),g:Math.floor(d[b].g/d[b].n),b:Math.floor(d[b].b/d[b].n),a:Math.floor(d[b].a/d[b].n)}),d[b].n/p<r.mincolorratio&&v<r.colorquantcycles-1&&(x[b]={r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)});for(m=0;m<x.length;m++)d[m]={r:0,g:0,b:0,a:0,n:0};for(g=0;g<s.height;g++)for(m=0;m<s.width;m++){for(o=(g*s.width+m)*4,u=0,c=1024,b=0;b<x.length;b++)l=Math.abs(x[b].r-s.data[o])+Math.abs(x[b].g-s.data[o+1])+Math.abs(x[b].b-s.data[o+2])+Math.abs(x[b].a-s.data[o+3]),l<c&&(c=l,u=b);d[u].r+=s.data[o],d[u].g+=s.data[o+1],d[u].b+=s.data[o+2],d[u].a+=s.data[o+3],d[u].n++,a[g+1][m+1]=u}}return{array:a,palette:x}},this.samplepalette=function(s,r){for(var a,o=[],l=0;l<s;l++)a=Math.floor(Math.random()*r.data.length/4)*4,o.push({r:r.data[a],g:r.data[a+1],b:r.data[a+2],a:r.data[a+3]});return o},this.samplepalette2=function(s,r){for(var a,o=[],l=Math.ceil(Math.sqrt(s)),c=Math.ceil(s/l),u=r.width/(l+1),d=r.height/(c+1),p=0;p<c;p++)for(var m=0;m<l&&o.length!==s;m++)a=Math.floor((p+1)*d*r.width+(m+1)*u)*4,o.push({r:r.data[a],g:r.data[a+1],b:r.data[a+2],a:r.data[a+3]});return o},this.generatepalette=function(s){var r=[],a,o,l;if(s<8)for(var c=Math.floor(255/(s-1)),u=0;u<s;u++)r.push({r:u*c,g:u*c,b:u*c,a:255});else{var d=Math.floor(Math.pow(s,.3333333333333333)),p=Math.floor(255/(d-1)),m=s-d*d*d;for(a=0;a<d;a++)for(o=0;o<d;o++)for(l=0;l<d;l++)r.push({r:a*p,g:o*p,b:l*p,a:255});for(a=0;a<m;a++)r.push({r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)})}return r},this.layering=function(s){var r=[],a=0,o=s.array.length,l=s.array[0].length,c,u,d,p,m,g,b,v,x,S,C;for(C=0;C<s.palette.length;C++)for(r[C]=[],S=0;S<o;S++)for(r[C][S]=[],x=0;x<l;x++)r[C][S][x]=0;for(S=1;S<o-1;S++)for(x=1;x<l-1;x++)a=s.array[S][x],c=s.array[S-1][x-1]===a?1:0,u=s.array[S-1][x]===a?1:0,d=s.array[S-1][x+1]===a?1:0,p=s.array[S][x-1]===a?1:0,m=s.array[S][x+1]===a?1:0,g=s.array[S+1][x-1]===a?1:0,b=s.array[S+1][x]===a?1:0,v=s.array[S+1][x+1]===a?1:0,r[a][S+1][x+1]=1+m*2+v*4+b*8,p||(r[a][S+1][x]=2+b*4+g*8),u||(r[a][S][x+1]=0+d*2+m*4+8),c||(r[a][S][x]=0+u*2+4+p*8);return r},this.layeringstep=function(s,r){var a=[],o=s.array.length,l=s.array[0].length,c,u;for(u=0;u<o;u++)for(a[u]=[],c=0;c<l;c++)a[u][c]=0;for(u=1;u<o;u++)for(c=1;c<l;c++)a[u][c]=(s.array[u-1][c-1]===r?1:0)+(s.array[u-1][c]===r?2:0)+(s.array[u][c-1]===r?8:0)+(s.array[u][c]===r?4:0);return a},this.pointinpoly=function(s,r){for(var a=!1,o=0,l=r.length-1;o<r.length;l=o++)a=r[o].y>s.y!=r[l].y>s.y&&s.x<(r[l].x-r[o].x)*(s.y-r[o].y)/(r[l].y-r[o].y)+r[o].x?!a:a;return a},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.pathscan=function(s,r){for(var a=[],o=0,l=0,c=0,u=0,d=s[0].length,p=s.length,m=0,g=!0,b=!1,v,x=0;x<p;x++)for(var S=0;S<d;S++)if(s[x][S]==4||s[x][S]==11)for(c=S,u=x,a[o]={},a[o].points=[],a[o].boundingbox=[c,u,c,u],a[o].holechildren=[],g=!1,l=0,b=s[x][S]==11,m=1;!g;){if(a[o].points[l]={},a[o].points[l].x=c-1,a[o].points[l].y=u-1,a[o].points[l].t=s[u][c],c-1<a[o].boundingbox[0]&&(a[o].boundingbox[0]=c-1),c-1>a[o].boundingbox[2]&&(a[o].boundingbox[2]=c-1),u-1<a[o].boundingbox[1]&&(a[o].boundingbox[1]=u-1),u-1>a[o].boundingbox[3]&&(a[o].boundingbox[3]=u-1),v=t.pathscan_combined_lookup[s[u][c]][m],s[u][c]=v[0],m=v[1],c+=v[2],u+=v[3],c-1===a[o].points[0].x&&u-1===a[o].points[0].y)if(g=!0,a[o].points.length<r)a.pop();else{if(a[o].isholepath=!!b,b){for(var C=0,A=[-1,-1,d+1,p+1],k=0;k<o;k++)!a[k].isholepath&&t.boundingboxincludes(a[k].boundingbox,a[o].boundingbox)&&t.boundingboxincludes(A,a[k].boundingbox)&&t.pointinpoly(a[o].points[0],a[k].points)&&(C=k,A=a[k].boundingbox);a[C].holechildren.push(o)}o++}l++}return a},this.boundingboxincludes=function(s,r){return s[0]<r[0]&&s[1]<r[1]&&s[2]>r[2]&&s[3]>r[3]},this.batchpathscan=function(s,r){var a=[];for(var o in s)s.hasOwnProperty(o)&&(a[o]=t.pathscan(s[o],r));return a},this.internodes=function(s,r){var a=[],o=0,l=0,c=0,u=0,d=0,p,m;for(p=0;p<s.length;p++)for(a[p]={},a[p].points=[],a[p].boundingbox=s[p].boundingbox,a[p].holechildren=s[p].holechildren,a[p].isholepath=s[p].isholepath,o=s[p].points.length,m=0;m<o;m++)l=(m+1)%o,c=(m+2)%o,u=(m-1+o)%o,d=(m-2+o)%o,r.rightangleenhance&&t.testrightangle(s[p],d,u,m,l,c)&&(a[p].points.length>0&&(a[p].points[a[p].points.length-1].linesegment=t.getdirection(a[p].points[a[p].points.length-1].x,a[p].points[a[p].points.length-1].y,s[p].points[m].x,s[p].points[m].y)),a[p].points.push({x:s[p].points[m].x,y:s[p].points[m].y,linesegment:t.getdirection(s[p].points[m].x,s[p].points[m].y,(s[p].points[m].x+s[p].points[l].x)/2,(s[p].points[m].y+s[p].points[l].y)/2)})),a[p].points.push({x:(s[p].points[m].x+s[p].points[l].x)/2,y:(s[p].points[m].y+s[p].points[l].y)/2,linesegment:t.getdirection((s[p].points[m].x+s[p].points[l].x)/2,(s[p].points[m].y+s[p].points[l].y)/2,(s[p].points[l].x+s[p].points[c].x)/2,(s[p].points[l].y+s[p].points[c].y)/2)});return a},this.testrightangle=function(s,r,a,o,l,c){return s.points[o].x===s.points[r].x&&s.points[o].x===s.points[a].x&&s.points[o].y===s.points[l].y&&s.points[o].y===s.points[c].y||s.points[o].y===s.points[r].y&&s.points[o].y===s.points[a].y&&s.points[o].x===s.points[l].x&&s.points[o].x===s.points[c].x},this.getdirection=function(s,r,a,o){var l=8;return s<a?r<o?l=1:r>o?l=7:l=0:s>a?r<o?l=3:r>o?l=5:l=4:r<o?l=2:r>o?l=6:l=8,l},this.batchinternodes=function(s,r){var a=[];for(var o in s)s.hasOwnProperty(o)&&(a[o]=t.internodes(s[o],r));return a},this.tracepath=function(s,r,a){var o=0,l,c,u,d={};for(d.segments=[],d.boundingbox=s.boundingbox,d.holechildren=s.holechildren,d.isholepath=s.isholepath;o<s.points.length;){for(l=s.points[o].linesegment,c=-1,u=o+1;(s.points[u].linesegment===l||s.points[u].linesegment===c||c===-1)&&u<s.points.length-1;)s.points[u].linesegment!==l&&c===-1&&(c=s.points[u].linesegment),u++;u===s.points.length-1&&(u=0),d.segments=d.segments.concat(t.fitseq(s,r,a,o,u)),u>0?o=u:o=s.points.length}return d},this.fitseq=function(s,r,a,o,l){if(l>s.points.length||l<0)return[];var c=o,u=0,d=!0,p,m,g,b=l-o;b<0&&(b+=s.points.length);for(var v=(s.points[l].x-s.points[o].x)/b,x=(s.points[l].y-s.points[o].y)/b,S=(o+1)%s.points.length,C;S!=l;)C=S-o,C<0&&(C+=s.points.length),p=s.points[o].x+v*C,m=s.points[o].y+x*C,g=(s.points[S].x-p)*(s.points[S].x-p)+(s.points[S].y-m)*(s.points[S].y-m),g>r&&(d=!1),g>u&&(c=S,u=g),S=(S+1)%s.points.length;if(d)return[{type:"L",x1:s.points[o].x,y1:s.points[o].y,x2:s.points[l].x,y2:s.points[l].y}];var A=c;d=!0,u=0;var k=(A-o)/b,O=(1-k)*(1-k),F=2*(1-k)*k,$=k*k,M=(O*s.points[o].x+$*s.points[l].x-s.points[A].x)/-F,R=(O*s.points[o].y+$*s.points[l].y-s.points[A].y)/-F;for(S=o+1;S!=l;)k=(S-o)/b,O=(1-k)*(1-k),F=2*(1-k)*k,$=k*k,p=O*s.points[o].x+F*M+$*s.points[l].x,m=O*s.points[o].y+F*R+$*s.points[l].y,g=(s.points[S].x-p)*(s.points[S].x-p)+(s.points[S].y-m)*(s.points[S].y-m),g>a&&(d=!1),g>u&&(c=S,u=g),S=(S+1)%s.points.length;if(d)return[{type:"Q",x1:s.points[o].x,y1:s.points[o].y,x2:M,y2:R,x3:s.points[l].x,y3:s.points[l].y}];var z=A;return t.fitseq(s,r,a,o,z).concat(t.fitseq(s,r,a,z,l))},this.batchtracepaths=function(s,r,a){var o=[];for(var l in s)s.hasOwnProperty(l)&&o.push(t.tracepath(s[l],r,a));return o},this.batchtracelayers=function(s,r,a){var o=[];for(var l in s)s.hasOwnProperty(l)&&(o[l]=t.batchtracepaths(s[l],r,a));return o},this.roundtodec=function(s,r){return+s.toFixed(r)},this.svgpathstring=function(s,r,a,o){var l=s.layers[r],c=l[a],u="",d;if(o.linefilter&&c.segments.length<3)return u;if(u="<path "+(o.desc?'desc="l '+r+" p "+a+'" ':"")+t.tosvgcolorstr(s.palette[r],o)+'d="',o.roundcoords===-1){for(u+="M "+c.segments[0].x1*o.scale+" "+c.segments[0].y1*o.scale+" ",d=0;d<c.segments.length;d++)u+=c.segments[d].type+" "+c.segments[d].x2*o.scale+" "+c.segments[d].y2*o.scale+" ",c.segments[d].hasOwnProperty("x3")&&(u+=c.segments[d].x3*o.scale+" "+c.segments[d].y3*o.scale+" ");u+="Z "}else{for(u+="M "+t.roundtodec(c.segments[0].x1*o.scale,o.roundcoords)+" "+t.roundtodec(c.segments[0].y1*o.scale,o.roundcoords)+" ",d=0;d<c.segments.length;d++)u+=c.segments[d].type+" "+t.roundtodec(c.segments[d].x2*o.scale,o.roundcoords)+" "+t.roundtodec(c.segments[d].y2*o.scale,o.roundcoords)+" ",c.segments[d].hasOwnProperty("x3")&&(u+=t.roundtodec(c.segments[d].x3*o.scale,o.roundcoords)+" "+t.roundtodec(c.segments[d].y3*o.scale,o.roundcoords)+" ");u+="Z "}for(var p=0;p<c.holechildren.length;p++){var m=l[c.holechildren[p]];if(o.roundcoords===-1)for(m.segments[m.segments.length-1].hasOwnProperty("x3")?u+="M "+m.segments[m.segments.length-1].x3*o.scale+" "+m.segments[m.segments.length-1].y3*o.scale+" ":u+="M "+m.segments[m.segments.length-1].x2*o.scale+" "+m.segments[m.segments.length-1].y2*o.scale+" ",d=m.segments.length-1;d>=0;d--)u+=m.segments[d].type+" ",m.segments[d].hasOwnProperty("x3")&&(u+=m.segments[d].x2*o.scale+" "+m.segments[d].y2*o.scale+" "),u+=m.segments[d].x1*o.scale+" "+m.segments[d].y1*o.scale+" ";else for(m.segments[m.segments.length-1].hasOwnProperty("x3")?u+="M "+t.roundtodec(m.segments[m.segments.length-1].x3*o.scale)+" "+t.roundtodec(m.segments[m.segments.length-1].y3*o.scale)+" ":u+="M "+t.roundtodec(m.segments[m.segments.length-1].x2*o.scale)+" "+t.roundtodec(m.segments[m.segments.length-1].y2*o.scale)+" ",d=m.segments.length-1;d>=0;d--)u+=m.segments[d].type+" ",m.segments[d].hasOwnProperty("x3")&&(u+=t.roundtodec(m.segments[d].x2*o.scale)+" "+t.roundtodec(m.segments[d].y2*o.scale)+" "),u+=t.roundtodec(m.segments[d].x1*o.scale)+" "+t.roundtodec(m.segments[d].y1*o.scale)+" ";u+="Z "}if(u+='" />',o.lcpr||o.qcpr){for(d=0;d<c.segments.length;d++)c.segments[d].hasOwnProperty("x3")&&o.qcpr&&(u+='<circle cx="'+c.segments[d].x2*o.scale+'" cy="'+c.segments[d].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+o.qcpr*.2+'" stroke="black" />',u+='<circle cx="'+c.segments[d].x3*o.scale+'" cy="'+c.segments[d].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+o.qcpr*.2+'" stroke="black" />',u+='<line x1="'+c.segments[d].x1*o.scale+'" y1="'+c.segments[d].y1*o.scale+'" x2="'+c.segments[d].x2*o.scale+'" y2="'+c.segments[d].y2*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />',u+='<line x1="'+c.segments[d].x2*o.scale+'" y1="'+c.segments[d].y2*o.scale+'" x2="'+c.segments[d].x3*o.scale+'" y2="'+c.segments[d].y3*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />'),!c.segments[d].hasOwnProperty("x3")&&o.lcpr&&(u+='<circle cx="'+c.segments[d].x2*o.scale+'" cy="'+c.segments[d].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+o.lcpr*.2+'" stroke="black" />');for(var p=0;p<c.holechildren.length;p++){var m=l[c.holechildren[p]];for(d=0;d<m.segments.length;d++)m.segments[d].hasOwnProperty("x3")&&o.qcpr&&(u+='<circle cx="'+m.segments[d].x2*o.scale+'" cy="'+m.segments[d].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+o.qcpr*.2+'" stroke="black" />',u+='<circle cx="'+m.segments[d].x3*o.scale+'" cy="'+m.segments[d].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+o.qcpr*.2+'" stroke="black" />',u+='<line x1="'+m.segments[d].x1*o.scale+'" y1="'+m.segments[d].y1*o.scale+'" x2="'+m.segments[d].x2*o.scale+'" y2="'+m.segments[d].y2*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />',u+='<line x1="'+m.segments[d].x2*o.scale+'" y1="'+m.segments[d].y2*o.scale+'" x2="'+m.segments[d].x3*o.scale+'" y2="'+m.segments[d].y3*o.scale+'" stroke-width="'+o.qcpr*.2+'" stroke="cyan" />'),!m.segments[d].hasOwnProperty("x3")&&o.lcpr&&(u+='<circle cx="'+m.segments[d].x2*o.scale+'" cy="'+m.segments[d].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+o.lcpr*.2+'" stroke="black" />')}}return u},this.getsvgstring=function(s,r){r=t.checkoptions(r);for(var a=s.width*r.scale,o=s.height*r.scale,l="<svg "+(r.viewbox?'viewBox="0 0 '+a+" "+o+'" ':'width="'+a+'" height="'+o+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+t.versionnumber+'" >',c=0;c<s.layers.length;c++)for(var u=0;u<s.layers[c].length;u++)s.layers[c][u].isholepath||(l+=t.svgpathstring(s,c,u,r));return l+="</svg>",l},this.compareNumbers=function(s,r){return s-r},this.torgbastr=function(s){return"rgba("+s.r+","+s.g+","+s.b+","+s.a+")"},this.tosvgcolorstr=function(s,r){return'fill="rgb('+s.r+","+s.g+","+s.b+')" stroke="rgb('+s.r+","+s.g+","+s.b+')" stroke-width="'+r.strokewidth+'" opacity="'+s.a/255+'" '},this.appendSVGString=function(s,r){var a;r?(a=document.getElementById(r),a||(a=document.createElement("div"),a.id=r,document.body.appendChild(a))):(a=document.createElement("div"),document.body.appendChild(a)),a.innerHTML+=s},this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.blur=function(s,r,a){var o,l,c,u,d,p,m,g,b,v,x={width:s.width,height:s.height,data:[]};if(r=Math.floor(r),r<1)return s;r>5&&(r=5),a=Math.abs(a),a>1024&&(a=1024);var S=t.gks[r-1];for(l=0;l<s.height;l++)for(o=0;o<s.width;o++){for(p=0,m=0,g=0,b=0,v=0,c=-r;c<r+1;c++)o+c>0&&o+c<s.width&&(d=(l*s.width+o+c)*4,p+=s.data[d]*S[c+r],m+=s.data[d+1]*S[c+r],g+=s.data[d+2]*S[c+r],b+=s.data[d+3]*S[c+r],v+=S[c+r]);d=(l*s.width+o)*4,x.data[d]=Math.floor(p/v),x.data[d+1]=Math.floor(m/v),x.data[d+2]=Math.floor(g/v),x.data[d+3]=Math.floor(b/v)}var C=new Uint8ClampedArray(x.data);for(l=0;l<s.height;l++)for(o=0;o<s.width;o++){for(p=0,m=0,g=0,b=0,v=0,c=-r;c<r+1;c++)l+c>0&&l+c<s.height&&(d=((l+c)*s.width+o)*4,p+=C[d]*S[c+r],m+=C[d+1]*S[c+r],g+=C[d+2]*S[c+r],b+=C[d+3]*S[c+r],v+=S[c+r]);d=(l*s.width+o)*4,x.data[d]=Math.floor(p/v),x.data[d+1]=Math.floor(m/v),x.data[d+2]=Math.floor(g/v),x.data[d+3]=Math.floor(b/v)}for(l=0;l<s.height;l++)for(o=0;o<s.width;o++)d=(l*s.width+o)*4,u=Math.abs(x.data[d]-s.data[d])+Math.abs(x.data[d+1]-s.data[d+1])+Math.abs(x.data[d+2]-s.data[d+2])+Math.abs(x.data[d+3]-s.data[d+3]),u>a&&(x.data[d]=s.data[d],x.data[d+1]=s.data[d+1],x.data[d+2]=s.data[d+2],x.data[d+3]=s.data[d+3]);return x},this.loadImage=function(s,r,a){var o=new Image;a&&a.corsenabled&&(o.crossOrigin="Anonymous"),o.onload=function(){var l=document.createElement("canvas");l.width=o.width,l.height=o.height;var c=l.getContext("2d");c.drawImage(o,0,0),r(l)},o.src=s},this.getImgdata=function(s){var r=s.getContext("2d");return r.getImageData(0,0,s.width,s.height)},this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}],this.drawLayers=function(s,r,a,o){a=a||1;var l,c,u,d,p,m;o?(m=document.getElementById(o),m||(m=document.createElement("div"),m.id=o,document.body.appendChild(m))):(m=document.createElement("div"),document.body.appendChild(m));for(p in s)if(s.hasOwnProperty(p)){l=s[p][0].length,c=s[p].length;var g=document.createElement("canvas");g.width=l*a,g.height=c*a;var b=g.getContext("2d");for(d=0;d<c;d++)for(u=0;u<l;u++)b.fillStyle=t.torgbastr(r[s[p][d][u]%r.length]),b.fillRect(u*a,d*a,a,a);m.appendChild(g)}}}n.exports=new e})()})(B5)),B5.exports}var rie=sie();const iie=L_(rie),aie={trace:async(n,e={})=>new Promise((t,s)=>{try{const r={ltres:1,qtres:1,pathomit:8,colorsampling:1,numberofcolors:16,mincolorratio:.02,colorquantcycles:3,scale:1,simplifyTolerance:0,roundcoords:1,lcpr:0,qcpr:0,desc:!1,viewbox:!0,...e};iie.imageToSVG(n,a=>{a?t(a):s(new Error("Failed to generate SVG string"))},r)}catch(r){console.error("Vectorization failed:",r),s(r)}})};var CS=function(n,e){return n<e?-1:n>e?1:0},fz=function(n){return n.reduce(function(e,t){return e+t},0)},oie=(function(){function n(t){this.colors=t}var e=n.prototype;return e.palette=function(){return this.colors},e.map=function(t){return t},n})(),lie=(function(){function n(a,o,l){return(a<<10)+(o<<5)+l}function e(a){var o=[],l=!1;function c(){o.sort(a),l=!0}return{push:function(u){o.push(u),l=!1},peek:function(u){return l||c(),u===void 0&&(u=o.length-1),o[u]},pop:function(){return l||c(),o.pop()},size:function(){return o.length},map:function(u){return o.map(u)},debug:function(){return l||c(),o}}}function t(a,o,l,c,u,d,p){var m=this;m.r1=a,m.r2=o,m.g1=l,m.g2=c,m.b1=u,m.b2=d,m.histo=p}function s(){this.vboxes=new e(function(a,o){return CS(a.vbox.count()*a.vbox.volume(),o.vbox.count()*o.vbox.volume())})}function r(a,o){if(o.count()){var l=o.r2-o.r1+1,c=o.g2-o.g1+1,u=Math.max.apply(null,[l,c,o.b2-o.b1+1]);if(o.count()==1)return[o.copy()];var d,p,m,g,b=0,v=[],x=[];if(u==l)for(d=o.r1;d<=o.r2;d++){for(g=0,p=o.g1;p<=o.g2;p++)for(m=o.b1;m<=o.b2;m++)g+=a[n(d,p,m)]||0;v[d]=b+=g}else if(u==c)for(d=o.g1;d<=o.g2;d++){for(g=0,p=o.r1;p<=o.r2;p++)for(m=o.b1;m<=o.b2;m++)g+=a[n(p,d,m)]||0;v[d]=b+=g}else for(d=o.b1;d<=o.b2;d++){for(g=0,p=o.r1;p<=o.r2;p++)for(m=o.g1;m<=o.g2;m++)g+=a[n(p,m,d)]||0;v[d]=b+=g}return v.forEach(function(S,C){x[C]=b-S}),(function(S){var C,A,k,O,F,$=S+"1",M=S+"2",R=0;for(d=o[$];d<=o[M];d++)if(v[d]>b/2){for(k=o.copy(),O=o.copy(),F=(C=d-o[$])<=(A=o[M]-d)?Math.min(o[M]-1,~~(d+A/2)):Math.max(o[$],~~(d-1-C/2));!v[F];)F++;for(R=x[F];!R&&v[F-1];)R=x[--F];return k[M]=F,O[$]=k[M]+1,[k,O]}})(u==l?"r":u==c?"g":"b")}}return t.prototype={volume:function(a){var o=this;return o._volume&&!a||(o._volume=(o.r2-o.r1+1)*(o.g2-o.g1+1)*(o.b2-o.b1+1)),o._volume},count:function(a){var o=this,l=o.histo;if(!o._count_set||a){var c,u,d,p=0;for(c=o.r1;c<=o.r2;c++)for(u=o.g1;u<=o.g2;u++)for(d=o.b1;d<=o.b2;d++)p+=l[n(c,u,d)]||0;o._count=p,o._count_set=!0}return o._count},copy:function(){var a=this;return new t(a.r1,a.r2,a.g1,a.g2,a.b1,a.b2,a.histo)},avg:function(a){var o=this,l=o.histo;if(!o._avg||a){var c,u,d,p,m=0,g=0,b=0,v=0;if(o.r1===o.r2&&o.g1===o.g2&&o.b1===o.b2)o._avg=[o.r1<<3,o.g1<<3,o.b1<<3];else{for(u=o.r1;u<=o.r2;u++)for(d=o.g1;d<=o.g2;d++)for(p=o.b1;p<=o.b2;p++)m+=c=l[n(u,d,p)]||0,g+=c*(u+.5)*8,b+=c*(d+.5)*8,v+=c*(p+.5)*8;o._avg=m?[~~(g/m),~~(b/m),~~(v/m)]:[~~(8*(o.r1+o.r2+1)/2),~~(8*(o.g1+o.g2+1)/2),~~(8*(o.b1+o.b2+1)/2)]}}return o._avg},contains:function(a){var o=this,l=a[0]>>3;return gval=a[1]>>3,bval=a[2]>>3,l>=o.r1&&l<=o.r2&&gval>=o.g1&&gval<=o.g2&&bval>=o.b1&&bval<=o.b2}},s.prototype={push:function(a){this.vboxes.push({vbox:a,color:a.avg()})},palette:function(){return this.vboxes.map(function(a){return a.color})},size:function(){return this.vboxes.size()},map:function(a){for(var o=this.vboxes,l=0;l<o.size();l++)if(o.peek(l).vbox.contains(a))return o.peek(l).color;return this.nearest(a)},nearest:function(a){for(var o,l,c,u=this.vboxes,d=0;d<u.size();d++)((l=Math.sqrt(Math.pow(a[0]-u.peek(d).color[0],2)+Math.pow(a[1]-u.peek(d).color[1],2)+Math.pow(a[2]-u.peek(d).color[2],2)))<o||o===void 0)&&(o=l,c=u.peek(d).color);return c},forcebw:function(){var a=this.vboxes;a.sort(function(u,d){return CS(fz(u.color),fz(d.color))});var o=a[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(a[0].color=[0,0,0]);var l=a.length-1,c=a[l].color;c[0]>251&&c[1]>251&&c[2]>251&&(a[l].color=[255,255,255])}},{quantize:function(a,o){if(!Number.isInteger(o)||o<1||o>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!a.length||o<2||o>256||!a.length||o<2||o>256)return!1;for(var l=[],c=new Set,u=0;u<a.length;u++){var d=a[u],p=d.join(",");c.has(p)||(c.add(p),l.push(d))}if(l.length<=o)return new oie(l);var m=(function(C){var A,k=new Array(32768);return C.forEach(function(O){A=n(O[0]>>3,O[1]>>3,O[2]>>3),k[A]=(k[A]||0)+1}),k})(a);m.forEach(function(){});var g=(function(C,A){var k,O,F,$=1e6,M=0,R=1e6,z=0,I=1e6,j=0;return C.forEach(function(H){(k=H[0]>>3)<$?$=k:k>M&&(M=k),(O=H[1]>>3)<R?R=O:O>z&&(z=O),(F=H[2]>>3)<I?I=F:F>j&&(j=F)}),new t($,M,R,z,I,j,A)})(a,m),b=new e(function(C,A){return CS(C.count(),A.count())});function v(C,A){for(var k,O=C.size(),F=0;F<1e3;){if(O>=A||F++>1e3)return;if((k=C.pop()).count()){var $=r(m,k),M=$[0],R=$[1];if(!M)return;C.push(M),R&&(C.push(R),O++)}else C.push(k),F++}}b.push(g),v(b,.75*o);for(var x=new e(function(C,A){return CS(C.count()*C.volume(),A.count()*A.volume())});b.size();)x.push(b.pop());v(x,o);for(var S=new s;x.size();)S.push(x.pop());return S}}})().quantize,MU=function(n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=n.naturalWidth,this.height=this.canvas.height=n.naturalHeight,this.context.drawImage(n,0,0,this.width,this.height)};MU.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var m0=function(){};m0.prototype.getColor=function(n,e){return e===void 0&&(e=10),this.getPalette(n,5,e)[0]},m0.prototype.getPalette=function(n,e,t){var s=(function(l){var c=l.colorCount,u=l.quality;if(c!==void 0&&Number.isInteger(c)){if(c===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");c=Math.max(c,2),c=Math.min(c,20)}else c=10;return(u===void 0||!Number.isInteger(u)||u<1)&&(u=10),{colorCount:c,quality:u}})({colorCount:e,quality:t}),r=new MU(n),a=(function(l,c,u){for(var d,p,m,g,b,v=l,x=[],S=0;S<c;S+=u)p=v[0+(d=4*S)],m=v[d+1],g=v[d+2],((b=v[d+3])===void 0||b>=125)&&(p>250&&m>250&&g>250||x.push([p,m,g]));return x})(r.getImageData().data,r.width*r.height,s.quality),o=lie(a,s.colorCount);return o?o.palette():null},m0.prototype.getColorFromUrl=function(n,e,t){var s=this,r=document.createElement("img");r.addEventListener("load",function(){var a=s.getPalette(r,5,t);e(a[0],n)}),r.src=n},m0.prototype.getImageData=function(n,e){var t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){if(this.status==200){var s=new Uint8Array(this.response);i=s.length;for(var r=new Array(i),a=0;a<s.length;a++)r[a]=String.fromCharCode(s[a]);var o=r.join(""),l=window.btoa(o);e("data:image/png;base64,"+l)}},t.send()},m0.prototype.getColorAsync=function(n,e,t){var s=this;this.getImageData(n,function(r){var a=document.createElement("img");a.addEventListener("load",function(){var o=s.getPalette(a,5,t);e(o[0],this)}),a.src=r})};const VE={extractColors:async(n,e=6)=>new Promise((t,s)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{try{const a=new m0,o=a.getColor(r),l=a.getPalette(r,e),c=VE.rgbToHex(o[0],o[1],o[2]),u=l.map(d=>VE.rgbToHex(d[0],d[1],d[2]));t({dominant:c,palette:u})}catch(a){console.error("Color extraction failed:",a),s(a)}},r.onerror=a=>{console.error("Failed to load image for color extraction:",a),s(a)},r.src=typeof n=="string"?n:n.src}),rgbToHex:(n,e,t)=>{const s=r=>{const a=r.toString(16);return a.length===1?"0"+a:a};return"#"+s(n)+s(e)+s(t)}},cie=({scale:n,name:e,version:t,meta:{architecture:s,...r},path:a})=>({scale:n,modelType:"layers",_internals:{path:a,name:e,version:t},meta:{architecture:s,...r},inputRange:[0,255],outputRange:[0,255]}),uie="@upscalerjs/default-model",hie="1.0.0-beta.17",die=2,fie=cie({scale:die,name:uie,version:hie,path:"models/model.json",meta:{C:1,D:2,G:4,G0:64,T:10,architecture:"rdn",patchSize:128,size:"slim",artifactReducing:!1,sharpening:!1,dataset:"div2k",modelFileName:"rdn-C1-D2-G4-G064-T10-x2-patchsize128-compress100-sharpen0-datadiv2k-vary_cFalse_best-val_loss_epoch494"}});const pie=1e-7,mie=1e-4;class QO{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class sk{refCount(e){return Mo("refCount")}incRef(e){return Mo("incRef")}timerAvailable(){return!0}time(e){return Mo("time")}read(e){return Mo("read")}readSync(e){return Mo("readSync")}readToGPU(e,t){return Mo("readToGPU")}numDataIds(){return Mo("numDataIds")}disposeData(e,t){return Mo("disposeData")}write(e,t,s){return Mo("write")}move(e,t,s,r,a){return Mo("move")}createTensorFromGPUData(e,t,s){return Mo("createTensorFromGPUData")}memory(){return Mo("memory")}floatPrecision(){return Mo("floatPrecision")}epsilon(){return this.floatPrecision()===32?pie:mie}dispose(){return Mo("dispose")}}function Mo(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function eD(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,dd(n,e,t)}function gie(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,s=0;for(;t>0;)s=Math.random()*t|0,t--,dd(n,t,s),dd(e,t,s)}function Wf(n,e,t){return Math.max(n,Math.min(e,t))}function rk(n){return n%2===0?n:n+1}function dd(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function PU(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function yie(n,e){const t=Math.random();return e*t+(1-t)*n}function bie(n,e){let t=0;for(let s=0;s<n.length;s++){const r=Number(n[s])-Number(e[s]);t+=r*r}return t}function ee(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function ea(n,e,t=""){ee(jn(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function tg(n){ee(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function We(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function vie(n){return n.length===0}function zU(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==null&&e[t]!==null&&n[t]!==e[t])return!1;return!0}function jn(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Nm(n){return n%1===0}function wie(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function YC(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function xie(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return eD(e),e}function pm(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function WE(n,e=r=>0,t,s){return new Promise((r,a)=>{let o=0;const l=()=>{if(n()){r();return}o++;const c=e(o);if(t!=null&&o>=t){a();return}s!=null?s(l,c):setTimeout(l,c)};l()})}function tD(n,e){let t=1,s=-1;for(let a=0;a<n.length;++a)if(n[a]>=0)t*=n[a];else if(n[a]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${a}`);s=a}else if(n[a]<0)throw Error(`Shapes can not be < 0. Found ${n[a]} at dim ${a}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Fn(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),ee(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),ee(n.every(s=>Nm(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Id(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||r?null:Fn(e,n).sort();let o=0;for(let l=0;l<n.length;++l){if(a!=null){if(a[o]===l&&n[l]!==1)throw new Error(`Can't squeeze axis ${l} since its dim '${n[l]}' is not 1`);(a[o]==null||a[o]>l)&&n[l]===1&&(t.push(n[l]),s.push(l)),a[o]<=l&&o++}n[l]!==1&&(t.push(n[l]),s.push(l))}return{newShape:t,keptDims:s}}function $i(n,e){return kr(n,e)}function kr(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function BU(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function jU(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function nD(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Av(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function UU(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function ih(n){return typeof n=="string"||n instanceof String}function VU(n){return typeof n=="boolean"}function KC(n){return typeof n=="number"}function ng(n){return Array.isArray(n)?ng(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":KC(n)?"float32":ih(n)?"string":VU(n)?"bool":"float32"}function Hf(n){return!!(n&&n.constructor&&n.call&&n.apply)}function ZC(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Ht(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function WU(n,e,t,s=!1){const r=new Array;if(e.length===1){const a=e[0]*(s?2:1);for(let o=0;o<a;o++)r[o]=t[n+o]}else{const a=e[0],o=e.slice(1),l=o.reduce((c,u)=>c*u)*(s?2:1);for(let c=0;c<a;c++)r[c]=WU(n+c*l,o,t,s)}return r}function El(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,a)=>r*a)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return WU(0,n,e,t)}function HU(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function ik(n,e){const t=Ji(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Ji(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function sD(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return El(n,new Float32Array(t));if(e==="int32")return El(n,new Int32Array(t));if(e==="bool")return El(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Jo(n){n.forEach(e=>{ee(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function ou(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function sg(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function vd(n){return n&&n.then&&typeof n.then=="function"}const pz="tfjsflags";class GU{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Sie,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Re().getBool("IS_TEST")||Re().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];Re().getBool("IS_TEST")||Re().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(vd(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);pz in e&&e[pz].split(",").forEach(s=>{const[r,a]=s.split(":");this.urlFlags[r]=_ie(r,a)})}}function Sie(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Cie(e,s[0],s[1]),s.join("="))),e}function Cie(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function _ie(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function Re(){return rD}let rD=null;function kie(n){rD=n}let j5;function qU(){if(j5==null){let n;if(typeof window<"u")n=window;else if(typeof window<"u")n=window;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");j5=n}return j5}function Tie(){const n=qU();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function iD(n,e){const t=Tie();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Sw="Abs",b1="Acos",v1="Acosh",rg="Add",Cw="AddN",ak="All",ok="Any",_w="ArgMax",kw="ArgMin",w1="Asin",x1="Asinh",S1="Atan",C1="Atanh",_1="Atan2",Tw="AvgPool",lk="AvgPoolGrad",Nw="AvgPool3D",ck="AvgPool3DGrad",Aw="BatchMatMul",Ew="BatchToSpaceND",uk="Bincount",Iw="BitwiseAnd",XU="BroadcastTo",hk="BroadcastArgs",k1="Cast",T1="Ceil",N1="ClipByValue",dk="Complex",Ow="ComplexAbs",Dw="Concat",$w="Conv2D",fk="Conv2DBackpropFilter",Rw="Conv2DBackpropInput",Lw="Conv3D",pk="Conv3DBackpropFilterV2",mk="Conv3DBackpropInputV2",A1="Cos",E1="Cosh",gk="Cumprod",Fw="Cumsum",yk="CropAndResize",bk="DenseBincount",vk="DepthToSpace",Mw="DepthwiseConv2dNative",wk="DepthwiseConv2dNativeBackpropFilter",xk="DepthwiseConv2dNativeBackpropInput",Sk="Diag",Pw="Dilation2D",JC="Dilation2DBackpropInput",QC="Dilation2DBackpropFilter",Ck="Draw",I1="RealDiv",_k="Einsum",O1="Elu",kk="EluGrad",D1="Erf",zw="Equal",$1="Exp",Bw="ExpandDims",R1="Expm1",Tk="FFT",Nk="Fill",Ak="FlipLeftRight",L1="Floor",F1="FloorDiv",jw="FusedBatchNorm",Uw="GatherV2",Ek="GatherNd",Vw="Greater",M1="GreaterEqual",P1="Identity",Ik="IFFT",Ok="Imag",z1="IsFinite",B1="IsInf",j1="IsNan",Ww="LeakyRelu",Hw="Less",Gw="LessEqual",Dk="LinSpace",U1="Log",V1="Log1p",qw="LogicalAnd",Xw="LogicalNot",Yw="LogicalOr",Nie="LogicalXor",YU="LogSoftmax",Aie="LowerBound",Kw="LRN",$k="LRNGrad",Eie="MatrixBandPart",Zw="Max",W1="Maximum",Jw="MaxPool",Rk="MaxPoolGrad",Qw="MaxPool3D",Lk="MaxPool3DGrad",Fk="MaxPoolWithArgmax",e2="Mean",t2="Min",H1="Minimum",n2="MirrorPad",G1="Mod",Mk="Multinomial",q1="Multiply",s2="Neg",r2="NotEqual",Pk="NonMaxSuppressionV3",zk="NonMaxSuppressionV4",Bk="NonMaxSuppressionV5",i2="OnesLike",a2="OneHot",o2="Pack",l2="PadV2",Iie="Pool",X1="Pow",c2="Prelu",u2="Prod",jk="RaggedGather",Uk="RaggedRange",Vk="RaggedTensorToTensor",Wk="Range",Hk="Real",Y1="Reciprocal",K1="Relu",h2="Reshape",d2="ResizeNearestNeighbor",Gk="ResizeNearestNeighborGrad",f2="ResizeBilinear",qk="ResizeBilinearGrad",Z1="Relu6",p2="Reverse",J1="Round",Q1="Rsqrt",Xk="ScatterNd",Yk="TensorScatterUpdate",Kk="SearchSorted",m2="Select",ey="Selu",g2="Slice",ty="Sin",ny="Sinh",sy="Sign",ry="Sigmoid",iy="Softplus",ay="Sqrt",y2="Sum",b2="SpaceToBatchND",v2="SplitV",w2="Softmax",Zk="SparseFillEmptyRows",Jk="SparseReshape",Qk="SparseSegmentMean",eT="SparseSegmentSum",tT="SparseToDense",oy="SquaredDifference",nT="Square",x2="StaticRegexReplace",sT="StridedSlice",rT="StringNGrams",iT="StringSplit",aT="StringToHashBucketFast",ly="Sub",cy="Tan",uy="Tanh",hy="Tile",oT="TopK",lT="Transform",mm="Transpose",cT="Unique",S2="Unpack",C2="UnsortedSegmentSum",Oie="UpperBound",_2="ZerosLike",dy="Step",e_="FromPixels",uT="RotateWithOffset",Ev="_FusedMatMul",Iv="FusedConv2D",Ov="FusedDepthwiseConv2D";function xl(...n){Re().getBool("IS_TEST")||Re().getBool("PROD")||console.warn(...n)}function Die(...n){Re().getBool("IS_TEST")||Re().getBool("PROD")||console.log(...n)}const U0=iD("kernelRegistry",()=>new Map),Dv=iD("gradRegistry",()=>new Map);function $v(n,e){const t=aD(n,e);return U0.get(t)}function HE(n){return Dv.get(n)}function t_(n){const e=U0.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[a,o]=r,[l]=a.split("_");l===n&&t.push(o)}return t}function hT(n){const{kernelName:e,backendName:t}=n,s=aD(e,t);U0.has(s)&&xl(`The kernel '${e}' for backend '${t}' is already registered`),U0.set(s,n)}function KU(n){const{kernelName:e}=n;Dv.has(e)&&Re().getBool("DEBUG")&&xl(`Overriding the gradient for '${e}'`),Dv.set(e,n)}function $ie(n,e){const t=aD(n,e);if(!U0.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);U0.delete(t)}function Rie(n){if(!Dv.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);Dv.delete(n)}function Lie(n,e){t_(n).forEach(s=>{const r=Object.assign({},s,{backendName:e});hT(r)})}function aD(n,e){return`${e}_${n}`}function ZU(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var U5,mz;function Fie(){if(mz)return U5;mz=1,U5=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(z,I,j){this.low=z|0,this.high=I|0,this.unsigned=!!j}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(z){return(z&&z.__isLong__)===!0}e.isLong=t;var s={},r={};function a(z,I){var j,H,q;return I?(z>>>=0,(q=0<=z&&z<256)&&(H=r[z],H)?H:(j=l(z,(z|0)<0?-1:0,!0),q&&(r[z]=j),j)):(z|=0,(q=-128<=z&&z<128)&&(H=s[z],H)?H:(j=l(z,z<0?-1:0,!1),q&&(s[z]=j),j))}e.fromInt=a;function o(z,I){if(isNaN(z))return I?C:S;if(I){if(z<0)return C;if(z>=b)return $}else{if(z<=-v)return M;if(z+1>=v)return F}return z<0?o(-z,I).neg():l(z%g|0,z/g|0,I)}e.fromNumber=o;function l(z,I,j){return new e(z,I,j)}e.fromBits=l;var c=Math.pow;function u(z,I,j){if(z.length===0)throw Error("empty string");if(z==="NaN"||z==="Infinity"||z==="+Infinity"||z==="-Infinity")return S;if(typeof I=="number"?(j=I,I=!1):I=!!I,j=j||10,j<2||36<j)throw RangeError("radix");var H;if((H=z.indexOf("-"))>0)throw Error("interior hyphen");if(H===0)return u(z.substring(1),I,j).neg();for(var q=o(c(j,8)),re=S,X=0;X<z.length;X+=8){var ne=Math.min(8,z.length-X),Q=parseInt(z.substring(X,X+ne),j);if(ne<8){var he=o(c(j,ne));re=re.mul(he).add(o(Q))}else re=re.mul(q),re=re.add(o(Q))}return re.unsigned=I,re}e.fromString=u;function d(z,I){return typeof z=="number"?o(z,I):typeof z=="string"?u(z,I):l(z.low,z.high,typeof I=="boolean"?I:z.unsigned)}e.fromValue=d;var p=65536,m=1<<24,g=p*p,b=g*g,v=b/2,x=a(m),S=a(0);e.ZERO=S;var C=a(0,!0);e.UZERO=C;var A=a(1);e.ONE=A;var k=a(1,!0);e.UONE=k;var O=a(-1);e.NEG_ONE=O;var F=l(-1,2147483647,!1);e.MAX_VALUE=F;var $=l(-1,-1,!0);e.MAX_UNSIGNED_VALUE=$;var M=l(0,-2147483648,!1);e.MIN_VALUE=M;var R=e.prototype;return R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},R.toString=function(I){if(I=I||10,I<2||36<I)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(M)){var j=o(I),H=this.div(j),q=H.mul(j).sub(this);return H.toString(I)+q.toInt().toString(I)}else return"-"+this.neg().toString(I);for(var re=o(c(I,6),this.unsigned),X=this,ne="";;){var Q=X.div(re),he=X.sub(Q.mul(re)).toInt()>>>0,ye=he.toString(I);if(X=Q,X.isZero())return ye+ne;for(;ye.length<6;)ye="0"+ye;ne=""+ye+ne}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(M)?64:this.neg().getNumBitsAbs();for(var I=this.high!=0?this.high:this.low,j=31;j>0&&(I&1<<j)==0;j--);return this.high!=0?j+33:j+1},R.isZero=function(){return this.high===0&&this.low===0},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return(this.low&1)===1},R.isEven=function(){return(this.low&1)===0},R.equals=function(I){return t(I)||(I=d(I)),this.unsigned!==I.unsigned&&this.high>>>31===1&&I.high>>>31===1?!1:this.high===I.high&&this.low===I.low},R.eq=R.equals,R.notEquals=function(I){return!this.eq(I)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(I){return this.comp(I)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(I){return this.comp(I)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(I){return this.comp(I)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(I){return this.comp(I)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(I){if(t(I)||(I=d(I)),this.eq(I))return 0;var j=this.isNegative(),H=I.isNegative();return j&&!H?-1:!j&&H?1:this.unsigned?I.high>>>0>this.high>>>0||I.high===this.high&&I.low>>>0>this.low>>>0?-1:1:this.sub(I).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(M)?M:this.not().add(A)},R.neg=R.negate,R.add=function(I){t(I)||(I=d(I));var j=this.high>>>16,H=this.high&65535,q=this.low>>>16,re=this.low&65535,X=I.high>>>16,ne=I.high&65535,Q=I.low>>>16,he=I.low&65535,ye=0,Y=0,B=0,G=0;return G+=re+he,B+=G>>>16,G&=65535,B+=q+Q,Y+=B>>>16,B&=65535,Y+=H+ne,ye+=Y>>>16,Y&=65535,ye+=j+X,ye&=65535,l(B<<16|G,ye<<16|Y,this.unsigned)},R.subtract=function(I){return t(I)||(I=d(I)),this.add(I.neg())},R.sub=R.subtract,R.multiply=function(I){if(this.isZero())return S;if(t(I)||(I=d(I)),n){var j=n.mul(this.low,this.high,I.low,I.high);return l(j,n.get_high(),this.unsigned)}if(I.isZero())return S;if(this.eq(M))return I.isOdd()?M:S;if(I.eq(M))return this.isOdd()?M:S;if(this.isNegative())return I.isNegative()?this.neg().mul(I.neg()):this.neg().mul(I).neg();if(I.isNegative())return this.mul(I.neg()).neg();if(this.lt(x)&&I.lt(x))return o(this.toNumber()*I.toNumber(),this.unsigned);var H=this.high>>>16,q=this.high&65535,re=this.low>>>16,X=this.low&65535,ne=I.high>>>16,Q=I.high&65535,he=I.low>>>16,ye=I.low&65535,Y=0,B=0,G=0,J=0;return J+=X*ye,G+=J>>>16,J&=65535,G+=re*ye,B+=G>>>16,G&=65535,G+=X*he,B+=G>>>16,G&=65535,B+=q*ye,Y+=B>>>16,B&=65535,B+=re*he,Y+=B>>>16,B&=65535,B+=X*Q,Y+=B>>>16,B&=65535,Y+=H*ye+q*he+re*Q+X*ne,Y&=65535,l(G<<16|J,Y<<16|B,this.unsigned)},R.mul=R.multiply,R.divide=function(I){if(t(I)||(I=d(I)),I.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&I.low===-1&&I.high===-1)return this;var j=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,I.low,I.high);return l(j,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:S;var H,q,re;if(this.unsigned){if(I.unsigned||(I=I.toUnsigned()),I.gt(this))return C;if(I.gt(this.shru(1)))return k;re=C}else{if(this.eq(M)){if(I.eq(A)||I.eq(O))return M;if(I.eq(M))return A;var X=this.shr(1);return H=X.div(I).shl(1),H.eq(S)?I.isNegative()?A:O:(q=this.sub(I.mul(H)),re=H.add(q.div(I)),re)}else if(I.eq(M))return this.unsigned?C:S;if(this.isNegative())return I.isNegative()?this.neg().div(I.neg()):this.neg().div(I).neg();if(I.isNegative())return this.div(I.neg()).neg();re=S}for(q=this;q.gte(I);){H=Math.max(1,Math.floor(q.toNumber()/I.toNumber()));for(var ne=Math.ceil(Math.log(H)/Math.LN2),Q=ne<=48?1:c(2,ne-48),he=o(H),ye=he.mul(I);ye.isNegative()||ye.gt(q);)H-=Q,he=o(H,this.unsigned),ye=he.mul(I);he.isZero()&&(he=A),re=re.add(he),q=q.sub(ye)}return re},R.div=R.divide,R.modulo=function(I){if(t(I)||(I=d(I)),n){var j=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,I.low,I.high);return l(j,n.get_high(),this.unsigned)}return this.sub(this.div(I).mul(I))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return l(~this.low,~this.high,this.unsigned)},R.and=function(I){return t(I)||(I=d(I)),l(this.low&I.low,this.high&I.high,this.unsigned)},R.or=function(I){return t(I)||(I=d(I)),l(this.low|I.low,this.high|I.high,this.unsigned)},R.xor=function(I){return t(I)||(I=d(I)),l(this.low^I.low,this.high^I.high,this.unsigned)},R.shiftLeft=function(I){return t(I)&&(I=I.toInt()),(I&=63)===0?this:I<32?l(this.low<<I,this.high<<I|this.low>>>32-I,this.unsigned):l(0,this.low<<I-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(I){return t(I)&&(I=I.toInt()),(I&=63)===0?this:I<32?l(this.low>>>I|this.high<<32-I,this.high>>I,this.unsigned):l(this.high>>I-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(I){if(t(I)&&(I=I.toInt()),I&=63,I===0)return this;var j=this.high;if(I<32){var H=this.low;return l(H>>>I|j<<32-I,j>>>I,this.unsigned)}else return I===32?l(j,0,this.unsigned):l(j>>>I-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},R.toBytes=function(I){return I?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var I=this.high,j=this.low;return[j&255,j>>>8&255,j>>>16&255,j>>>24,I&255,I>>>8&255,I>>>16&255,I>>>24]},R.toBytesBE=function(){var I=this.high,j=this.low;return[I>>>24,I>>>16&255,I>>>8&255,I&255,j>>>24,j>>>16&255,j>>>8&255,j&255]},e.fromBytes=function(I,j,H){return H?e.fromBytesLE(I,j):e.fromBytesBE(I,j)},e.fromBytesLE=function(I,j){return new e(I[0]|I[1]<<8|I[2]<<16|I[3]<<24,I[4]|I[5]<<8|I[6]<<16|I[7]<<24,j)},e.fromBytesBE=function(I,j){return new e(I[4]<<24|I[5]<<16|I[6]<<8|I[7],I[0]<<24|I[1]<<16|I[2]<<8|I[3],j)},U5}var JU=Fie();const QU=L_(JU),Mie=iK({__proto__:null,default:QU},[JU]);const em=QU||Mie;function k2(n){return em.fromString(n,!0,16)}const eV=k2("c3a5c85c97cb3127"),Yp=k2("b492b66fbe98f273"),Ea=k2("9ae16a3b2f90404f");function GE(n){return n.xor(n.shru(47))}function tV(n,e,t){const s=n.slice(e,e+t);return em.fromBytes(Array.from(s),!0,!0)}function Ws(n,e){return tV(n,e,8)}function gz(n,e){return tV(n,e,4)}function Ii(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Mf(n,e,t=k2("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Pie(n,e,t,s,r,a){r=r.add(n),a=Ii(a.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),a=a.add(Ii(r,44)),[r.add(s),a.add(o)]}function _S(n,e,t,s){return Pie(Ws(n,e),Ws(n,e+8),Ws(n,e+16),Ws(n,e+24),t,s)}function zie(n,e=n.length){if(e>=8){const t=Ea.add(e*2),s=Ws(n,0).add(Ea),r=Ws(n,e-8),a=Ii(r,37).mul(t).add(s),o=Ii(s,25).add(r).mul(t);return Mf(a,o,t)}if(e>=4){const t=Ea.add(e*2),s=gz(n,0);return Mf(s.shl(3).add(e),gz(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],a=t+(s<<8),o=e+(r<<2);return GE(Ea.mul(a).xor(eV.mul(o))).mul(Ea)}return Ea}function Bie(n,e=n.length){const t=Ea.add(e*2),s=Ws(n,0).mul(Yp),r=Ws(n,8),a=Ws(n,e-8).mul(t),o=Ws(n,e-16).mul(Ea);return Mf(Ii(s.add(r),43).add(Ii(a,30)).add(o),s.add(Ii(r.add(Ea),18)).add(a),t)}function jie(n,e=n.length){const t=Ea.add(e*2),s=Ws(n,0).mul(Ea),r=Ws(n,8),a=Ws(n,e-8).mul(t),o=Ws(n,e-16).mul(Ea),l=Ii(s.add(r),43).add(Ii(a,30)).add(o),c=Mf(l,s.add(Ii(r.add(Ea),18)).add(a),t),u=Ws(n,16).mul(t),d=Ws(n,24),p=l.add(Ws(n,e-32)).mul(t),m=c.add(Ws(n,e-24)).mul(t);return Mf(Ii(u.add(d),43).add(Ii(p,30)).add(m),u.add(Ii(d.add(s),18)).add(p),t)}function nV(n,e=n.length){const t=em.fromNumber(81,!0);if(e<=32)return e<=16?zie(n,e):Bie(n,e);if(e<=64)return jie(n,e);let s=t,r=t.mul(Yp).add(113),a=GE(r.mul(Ea).add(113)).mul(Ea),o=[em.UZERO,em.UZERO],l=[em.UZERO,em.UZERO];s=s.mul(Ea).add(Ws(n,0));let c=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=Ii(s.add(r).add(o[0]).add(Ws(n,c+8)),37).mul(Yp),r=Ii(r.add(o[1]).add(Ws(n,c+48)),42).mul(Yp),s=s.xor(l[1]),r=r.add(o[0]).add(Ws(n,c+40)),a=Ii(a.add(l[0]),33).mul(Yp),o=_S(n,c,o[1].mul(Yp),s.add(l[0])),l=_S(n,c+32,a.add(l[1]),r.add(Ws(n,c+16))),[a,s]=[s,a],c+=64;while(c!==u);const p=Yp.add(a.and(255).shl(1));return c=d,l[0]=l[0].add(e-1&63),o[0]=o[0].add(l[0]),l[0]=l[0].add(o[0]),s=Ii(s.add(r).add(o[0]).add(Ws(n,c+8)),37).mul(p),r=Ii(r.add(o[1]).add(Ws(n,c+48)),42).mul(p),s=s.xor(l[1].mul(9)),r=r.add(o[0].mul(9).add(Ws(n,c+40))),a=Ii(a.add(l[0]),33).mul(p),o=_S(n,c,o[1].mul(p),s.add(l[0])),l=_S(n,c+32,a.add(l[1]),r.add(Ws(n,c+16))),[a,s]=[s,a],Mf(Mf(o[0],l[0],p).add(GE(r).mul(eV)).add(a),Mf(o[1],l[1],p).add(s),p)}function Od(n,e){return e==="string"?ch(n):np([n],e)}function Uie(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function np(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=vh(n)),Re().getBool("DEBUG")&&BU(n,e),Uie(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Gi(){return Re().platform.now()}function sV(n,e){return Re().platform.fetch(n,e)}function ch(n,e="utf-8"){return e=e||"utf-8",Re().platform.encode(n,e)}function wd(n,e="utf-8"){return e=e||"utf-8",Re().platform.decode(n,e)}function di(n){return Re().platform.isTypedArray!=null?Re().platform.isTypedArray(n):ZU(n)}function vh(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||vd(n)||n==null||di(n)&&t)e.push(n);else if(Array.isArray(n)||di(n))for(let s=0;s<n.length;++s)vh(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)vh(n[r],e,t)}return e}const Vie=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:jn,arraysEqualWithNull:zU,assert:ee,assertNonNegativeIntegerDimensions:Jo,assertNonNull:tg,assertShapesMatch:ea,bytesFromStringArray:UU,bytesPerElement:Av,checkConversionForErrors:BU,clamp:Wf,computeStrides:Ht,convertBackendValuesAndArrayBuffer:HU,createScalarValue:Od,createShuffledIndices:xie,decodeString:wd,distSquared:bie,encodeString:ch,fetch:sV,fingerPrint64:nV,flatten:vh,getArrayFromDType:kr,getTypedArrayFromDType:$i,hasEncodingLoss:nD,hexToLong:k2,indexToLoc:sg,inferDtype:ng,inferFromImplicitShape:tD,isBoolean:VU,isFunction:Hf,isInt:Nm,isNumber:KC,isPromise:vd,isScalarShape:vie,isString:ih,isTypedArray:di,isValidDtype:jU,locToIndex:ou,makeOnesTypedArray:ik,makeZerosNestedTypedArray:sD,makeZerosTypedArray:Ji,nearestDivisor:ZC,nearestLargerEven:rk,now:Gi,parseAxisParam:Fn,randUniform:yie,repeatedTry:WE,rightPad:pm,shuffle:eD,shuffleCombo:gie,sizeFromShape:We,sizeToSquarishShape:YC,squeezeShape:Id,sum:PU,swap:dd,tanh:wie,toNestedArray:El,toTypedArray:np},Symbol.toStringTag,{value:"Module"}));class Wie{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Gie)}profileKernel(e,t,s){let r;const a=()=>{r=s()};let o;const l=Gi();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(a);else{a();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Gi()-l})}if(Re().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(p=>{Hie(p,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:a,extraInfo:o}=e;s.forEach(l=>{Promise.all([l.data(),r,o]).then(c=>{this.logger.logKernelProfile(t,l,c[0],c[1],a,c[2])})})}}function Hie(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class Gie{logKernelProfile(e,t,s,r,a,o){const l=typeof r=="number"?pm(`${r}ms`,9):r.error,c=pm(e,25),u=t.rank,d=t.size,p=pm(t.shape.toString(),14);let m="";for(const g in a){const b=a[g];if(b!=null){const v=b.shape||t.shape,x=v.length;m+=`${g}: ${x}D ${x>0?v:""} `}}console.log(`%c${c}	%c${l}	%c${u}D ${p}	%c${d}	%c${m}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function qie(n,e,t){const s={},r={};for(let c=0;c<e.length;c++)s[e[c].id]=!0;for(let c=0;c<n.length;c++){const u=n[c],d=u.inputs;for(const p in d){const m=d[p];let g=!1;for(let b=0;b<e.length;b++)if(s[m.id]){u.outputs.forEach(v=>s[v.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const a={};a[t.id]=!0;const o={};for(let c=n.length-1;c>=0;c--){const u=n[c],d=u.inputs;for(let p=0;p<u.outputs.length;p++)if(a[u.outputs[p].id]){for(const m in d)a[d[m].id]=!0,o[u.id]=!0;break}}const l=[];for(let c=0;c<n.length;c++){const u=n[c];if(r[u.id]&&o[u.id]){const d={};for(const m in u.inputs){const g=u.inputs[m];s[g.id]&&(d[m]=g)}const p=Object.assign({},u);p.inputs=d,p.outputs=u.outputs,l.push(p)}}return l}function Xie(n,e,t,s){for(let r=e.length-1;r>=0;r--){const a=e[r],o=[];if(a.outputs.forEach(c=>{const u=n[c.id];u!=null?o.push(u):o.push(null)}),a.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const l=a.gradient(o);for(const c in a.inputs){if(!(c in l))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(l)}.`);const u=t(()=>l[c]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${u.dtype}'`);const d=a.inputs[c];if(!jn(u.shape,d.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${c}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const p=n[d.id];n[d.id]=s(p,u),p.dispose()}}}}const yz=20,Tb=3,V5=7;function Yie(n,e,t,s){const r=Ht(e),a=Kie(n,e,t,r),o=e.length,l=JS(n,e,t,r,a),c=["Tensor"];return s&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${o}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(l.map(u=>"    "+u).join(`
`)),c.join(`
`)}function Kie(n,e,t,s){const r=We(e),a=s[s.length-1],o=new Array(a).fill(0),l=e.length,c=t==="complex64"?Kb(n):n;if(l>1)for(let u=0;u<r/a;u++){const d=u*a;for(let p=0;p<a;p++)o[p]=Math.max(o[p],Yb(c[d+p],0,t).length)}return o}function Yb(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(V5))} + ${parseFloat(n[1].toFixed(V5))}j`:ih(n)?s=`'${n}'`:t==="bool"?s=rV(n):s=parseFloat(n.toFixed(V5)).toString(),pm(s,e)}function rV(n){return n===0?"false":"true"}function JS(n,e,t,s,r,a=!0){const o=t==="complex64"?2:1,l=e[0],c=e.length;if(c===0){if(t==="complex64"){const v=Kb(n);return[Yb(v[0],0,t)]}return t==="bool"?[rV(n[0])]:[n[0].toString()]}if(c===1){if(l>yz){const x=Tb*o;let S=Array.from(n.slice(0,x)),C=Array.from(n.slice((l-Tb)*o,l*o));return t==="complex64"&&(S=Kb(S),C=Kb(C)),["["+S.map((A,k)=>Yb(A,r[k],t)).join(", ")+", ..., "+C.map((A,k)=>Yb(A,r[l-Tb+k],t)).join(", ")+"]"]}return["["+(t==="complex64"?Kb(n):Array.from(n)).map((x,S)=>Yb(x,r[S],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),p=s[0]*o,m=[];if(l>yz){for(let v=0;v<Tb;v++){const x=v*p,S=x+p;m.push(...JS(n.slice(x,S),u,t,d,r,!1))}m.push("...");for(let v=l-Tb;v<l;v++){const x=v*p,S=x+p;m.push(...JS(n.slice(x,S),u,t,d,r,v===l-1))}}else for(let v=0;v<l;v++){const x=v*p,S=x+p;m.push(...JS(n.slice(x,S),u,t,d,r,v===l-1))}const g=c===2?",":"";m[0]="["+(l>0?m[0]+g:"");for(let v=1;v<m.length-1;v++)m[v]=" "+m[v]+g;let b=`,
`;for(let v=2;v<c;v++)b+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":b),m}function Kb(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}class ni{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=We(e),s!=null){const r=s.length;ee(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||kr(t,this.size),this.strides=Ht(e)}set(e,...t){t.length===0&&(t=[0]),ee(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const a=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(a)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return tu().makeTensor(this.values,this.shape,this.dtype)}}let tu=null,g0=null;function Zie(n){tu=n}function Jie(n){g0=n}class Yn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=We(e),this.strides=Ht(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return g0.buffer(this.shape,this.dtype,e)}bufferSync(){return g0.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return El(this.shape,e,this.dtype==="complex64")}arraySync(){return El(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=tu().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>wd(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),tu().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=tu().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>wd(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await tu().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),tu().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return g0.print(this,e)}clone(){return this.throwIfDisposed(),g0.clone(this)}toString(e=!1){const t=this.dataSync();return Yie(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),g0.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),tu().makeVariable(this,e,t,s)}}Object.defineProperty(Yn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function qe(){return iD("Tensor",()=>Yn)}qe();class Rv extends Yn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!jn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);tu().disposeTensor(this),this.dataId=e.dataId,tu().incRef(this,null)}dispose(){tu().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Rv,Symbol.hasInstance,{value:n=>n instanceof Yn&&n.assign!=null&&n.assign instanceof Function});var qE;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(qE||(qE={}));var XE;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(XE||(XE={}));var YE;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(YE||(YE={}));var KE;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(KE||(KE={}));var ZE;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(ZE||(ZE={}));const Qie={float32:KE,int32:XE,bool:YE,complex64:ZE};function lo(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Qie[n][e]}function dT(n){return lo(n,"int32")}function iV(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function aV(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}function gr(n,e){if(n.dtype===e.dtype)return[n,e];const t=lo(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function oV(n,e){ee(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function fT(n,e){return e.some(t=>t.id===n.id)}function xd(n){const e=[];return lV(n,e,new Set),e}function lV(n,e,t){if(n==null)return;if(n instanceof Yn){e.push(n);return}if(!eae(n))return;const s=n;for(const r in s){const a=s[r];t.has(a)||(t.add(a),lV(a,e,t))}}function eae(n){return Array.isArray(n)||typeof n=="object"}const tae=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:oV,getTensorsInContainer:xd,isTensorInList:fT,makeTypesMatch:gr},Symbol.toStringTag,{value:"Module"}));function W5(n){return n.kernelName!=null}class bz{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class V0{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bz}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(xl(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Wie(this.backendInstance),!0}setupRegisteredKernels(){t_(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){t_(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof sk)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,a=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,xl(`Initialization of backend ${e} failed`),xl(o.stack||o.message)),!1));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return xl(`Initialization of backend ${e} failed`),xl(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:a}=this.initializeBackend(s);if(a||r)return{name:s,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,a=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,a,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return V0.nextTensorId++}nextVariableId(){return V0.nextVariableId++}clone(e){const t=be.runKernel(P1,{x:e}),s={x:e},r=o=>({x:()=>{const l="float32",c={x:o},u={dtype:l};return be.runKernel(k1,c,u)}}),a=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,a,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!($v(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let a=0;s.forEach(c=>{a+=c.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=r-t-a-o;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),a=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c;const u=W5(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(W5(e)){const{kernelName:b,inputs:v,attrs:x}=e;this.backendName==null&&this.backend;const S=$v(b,this.backendName);ee(S!=null,()=>`Cannot find registered kernel '${b}' for backend '${this.backendName}'`),l=()=>{const C=this.backend.numDataIds();c=S.kernelFunc({inputs:v,attrs:x,backend:this.backend});const A=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(b,C,A);const k=A.map(O=>O.rank!=null?O:this.makeTensorFromTensorInfo(O));if(r){const O=this.getTensorsForGradient(b,v,k);s=this.saveTensorsForBackwardMode(O)}return k}}else{const{forwardFunc:b}=e,v=x=>{r&&(s=x.map(S=>this.keep(this.clone(S))))};l=()=>{const x=this.backend.numDataIds();c=this.tidy(()=>b(this.backend,v));const S=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,x,S),S}}const{inputs:d,attrs:p}=e,m=W5(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=l():(g=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,m,s,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(b=>d[b]!=null?d[b].shape:null),outputShapes:t.map(b=>b.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(c)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=HE(e);if(r!=null){const a=r.inputsToSave||[],o=r.outputsToSave||[];let l;r.saveAllInputs?(ee(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(t).map(u=>t[u])):l=a.map(u=>t[u]);const c=s.filter((u,d)=>o[d]);return l.concat(c)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let a=e;s==="string"&&ih(e[0])&&(a=e.map(c=>ch(c)));const o=r.write(a,t,s),l=new Yn(t,s,o,this.nextTensorId());if(this.trackTensor(l,r),s==="string"){const c=this.state.tensorInfo.get(o),u=UU(a);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,t,s,r){s=s||"float32";const a={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:a}=e,o=new Yn(r,a,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const a=new Rv(e,t,s,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Av(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Rv||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Av(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,a,o){const l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:a},c=HE(e);c!=null&&(r=c.gradFunc),r!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){const m=s[p],g=Ji(m.size,m.dtype);return this.makeTensor(g,m.shape,m.dtype)}return d}),r(u.length>1?u:u[0],a,o))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=xd(e),s=new Set(t.map(a=>a.id));for(let a=0;a<this.state.activeScope.track.length;a++){const o=this.state.activeScope.track[a];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(a=>{!a.kept&&a.scopeId===r.id&&this.track(a)})}gradients(e,t,s,r=!1){if(ee(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ee(a instanceof Yn,()=>"The result y returned by f() must be a tensor.");const o=qie(this.state.activeTape,t,a);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const l={};l[a.id]=s??nae(a.shape),Xie(l,o,u=>this.tidy(u),sae);const c=t.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:a,grads:c}})}customGrad(e){return ee(Hf(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ee(t.every(l=>l instanceof Yn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((l,c)=>{r[c]=l});const a=(l,c)=>(s=e(...t,c),ee(s.value instanceof Yn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ee(Hf(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(l,c)=>{const u=s.gradFunc(l,c),d=Array.isArray(u)?u:[u];ee(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ee(d.every(m=>m instanceof Yn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const p={};return d.forEach((m,g)=>{p[g]=()=>m}),p};return this.runKernelFunc({forwardFunc:a,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Gi(),s=await this.backend.time(e);return s.wallMs=Gi()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bz;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}V0.nextTensorId=0;V0.nextVariableId=0;function nae(n){const e=ik(We(n),"float32");return be.makeTensor(e,n,"float32")}function cV(){const n=qU();if(n._tfengine==null){const e=new GU(n);n._tfengine=new V0(e)}return kie(n._tfengine.ENV),Zie(()=>n._tfengine),n._tfengine}const be=cV();function sae(n,e){const t={a:n,b:e};return be.runKernel(rg,t)}function rae(){return typeof navigator<"u"&&navigator!=null}let JE;function iae(n){JE=n}function oD(n){if(JE!==void 0)return JE;if(n||rae()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function lD(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const aae=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:lD,isMobile:oD,mockIsMobile:iae},Symbol.toStringTag,{value:"Module"}));const co=Re();co.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});co.registerFlag("IS_BROWSER",()=>lD());co.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");co.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));co.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));co.registerFlag("PROD",()=>!1);co.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>co.getBool("DEBUG"));co.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);co.registerFlag("IS_TEST",()=>!1);co.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>co.getBool("DEBUG"));co.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);co.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);co.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function wh(n,e){let t=n;if(di(n))return e==="string"?[]:[n.length];if(iV(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(aV(n))return[n.buffer.size/(e==null?4:Av(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||di(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&Re().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&uV(n,s,[]),s}function uV(n,e,t){if(t=t||[],!Array.isArray(n)&&!di(n)){ee(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ee(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),ee(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)uV(n[r],s,t.concat(r))}function vz(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function ie(n,e,t,s="numeric"){if(n instanceof Yn)return vz(s,n.dtype,e,t),n;let r=ng(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),vz(s,r,e,t),n==null||!di(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const c=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}const a=wh(n,r);!di(n)&&!Array.isArray(n)&&(n=[n]);const l=r!=="string"?np(n,r):vh(n,[],!0);return be.makeTensor(l,a,r)}function Lv(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((a,o)=>ie(a,`${e}[${o}]`,t,s))}const cD="__op";function ve(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+cD;const r=(...a)=>{be.startScope(t);try{const o=s(...a);return vd(o)&&console.error("Cannot return a Promise inside of tidy."),be.endScope(o),o}catch(o){throw be.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}function oae(n,e){const t=ie(n,"real","complex"),s=ie(e,"imag","complex");ea(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return be.runKernel(dk,r)}const Sd=ve({complex_:oae});function sp(n,e,t,s){if(s==null)s=ng(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(aV(n)||iV(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return be.backend.createTensorFromGPUData(n,e||t,s)}if(!di(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Jo(e);const r=We(e),a=We(t);ee(r===a,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${a}`);for(let o=0;o<t.length;++o){const l=t[o],c=o===t.length-1?l!==We(e.slice(o)):!0;ee(t[o]===e[o]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!di(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?np(n,s):vh(n,[],!0),be.makeTensor(n,e,s)}function Wo(n,e,t){const s=wh(n,t);return sp(n,e,s,t)}const QE={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Su{static join(e){return new Su(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>di(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=t+r.byteLength;this.shards.push({buffer:r,start:t,end:a}),t=a}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,a=new ArrayBuffer(r),o=new Uint8Array(a);let l=0;for(let c=s;c<this.shards.length;c++){const u=this.shards[c],p=e+l-u.start,m=l,b=Math.min(t,u.end)-u.start,v=new Uint8Array(u.buffer,p,b-p);if(o.set(v,m),l+=v.length,t<u.end)break}return a}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=lae(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function lae(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,a=e(n[r]);if(a===0)return r;a<0?s=r:t=r+1}return-1}const n_=4;async function eI(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const l=r[o],c=Array.isArray(n)?n[o].tensor:n[l];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${l}': ${c.dtype}`);const u={name:l,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const d=new Promise(async p=>{const m=await c.bytes(),g=m.reduce((x,S)=>x+S.length,0)+n_*m.length,b=new Uint8Array(g);let v=0;for(let x=0;x<m.length;x++){const S=m[x],C=new Uint8Array(new Uint32Array([S.length]).buffer);b.set(C,v),v+=n_,b.set(S,v),v+=S.length}p(b)});s.push(d)}else s.push(c.data());e!=null&&(u.group=e),t.push(u)}const a=await Promise.all(s);return{data:cae(a),specs:t}}function uD(n,e){const t=new Su(n),s={};let r,a=0;for(const o of e){const l=o.name,c=o.dtype,u=o.shape,d=We(u);let p;if("quantization"in o){const m=o.quantization;if(m.dtype==="uint8"||m.dtype==="uint16"){if(!("min"in m&&"scale"in m))throw new Error(`Weight ${o.name} with quantization ${m.dtype} doesn't have corresponding metadata min and scale.`)}else if(m.dtype==="float16"){if(c!=="float32")throw new Error(`Weight ${o.name} is quantized with ${m.dtype} which only supports weights of type float32 not ${c}.`)}else throw new Error(`Weight ${o.name} has unknown quantization dtype ${m.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const g=QE[m.dtype],b=t.slice(a,a+d*g),v=m.dtype==="uint8"?new Uint8Array(b):new Uint16Array(b);if(c==="float32")if(m.dtype==="uint8"||m.dtype==="uint16"){p=new Float32Array(v.length);for(let x=0;x<v.length;x++){const S=v[x];p[x]=S*m.scale+m.min}}else if(m.dtype==="float16")r===void 0&&(r=mae()),p=r(v);else throw new Error(`Unsupported quantization type ${m.dtype} for weight type float32.`);else if(c==="int32"){if(m.dtype!=="uint8"&&m.dtype!=="uint16")throw new Error(`Unsupported quantization type ${m.dtype} for weight type int32.`);p=new Int32Array(v.length);for(let x=0;x<v.length;x++){const S=v[x];p[x]=Math.round(S*m.scale+m.min)}}else throw new Error(`Unsupported dtype in weight '${l}': ${c}`);a+=d*g}else if(c==="string"){const m=We(o.shape);p=[];for(let g=0;g<m;g++){const b=new Uint32Array(t.slice(a,a+n_))[0];a+=n_;const v=new Uint8Array(t.slice(a,a+b));p.push(v),a+=b}}else{const m=QE[c],g=t.slice(a,a+d*m);if(c==="float32")p=new Float32Array(g);else if(c==="int32")p=new Int32Array(g);else if(c==="bool")p=new Uint8Array(g);else if(c==="complex64"){p=new Float32Array(g);const b=new Float32Array(p.length/2),v=new Float32Array(p.length/2);for(let C=0;C<b.length;C++)b[C]=p[C*2],v[C]=p[C*2+1];const x=Wo(b,u,"float32"),S=Wo(v,u,"float32");s[l]=Sd(x,S),x.dispose(),S.dispose()}else throw new Error(`Unsupported dtype in weight '${l}': ${c}`);a+=d*m}c!=="complex64"&&(s[l]=Wo(p,u,c))}return s}function cae(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(a=>{if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${a.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(a=>{s.set(new Uint8Array(a.buffer),r),r+=a.byteLength}),s.buffer}const hD=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function wz(n){return hD?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function uae(n){if(hD)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function hae(n){if(hD){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function hV(n){return Su.join(n)}function xz(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);const t=n.split("/");return t[t.length-1]}function dV(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function dD(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function fD(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),dD(n,t,s)}function T2(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:wz(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:wz(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Su(n.weightData).byteLength}}function pD(n){const e=[];for(const t of n)e.push(...t.weights);return e}function dae(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function fae(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function pae(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function mae(){const n=dae(),e=fae(),t=pae();return s=>{const r=new ArrayBuffer(4*s.length),a=new Uint32Array(r);for(let o=0;o<s.length;o++){const l=s[o],c=n[t[l>>10]+(l&1023)]+e[l>>10];a[o]=c}return new Float32Array(r)}}class dr{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return dr.instance==null&&(dr.instance=new dr),dr.instance}static registerSaveRouter(e){dr.getInstance().saveRouters.push(e)}static registerLoadRouter(e){dr.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return dr.getHandlers(e,"save")}static getLoadHandlers(e,t){return dr.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?dr.getInstance().loadRouters:dr.getInstance().saveRouters).forEach(o=>{const l=o(e,s);l!==null&&r.push(l)}),r}}const gae=n=>dr.registerSaveRouter(n),yae=n=>dr.registerLoadRouter(n),fV=n=>dr.getSaveHandlers(n),pV=(n,e)=>dr.getLoadHandlers(n,e);const tI="tensorflowjs",nI=1,om="models_store",$f="model_info_store";function mV(){if(!Re().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function sI(n){const e=n.result;e.createObjectStore(om,{keyPath:"modelPath"}),e.createObjectStore($f,{keyPath:"modelPath"})}class Am{constructor(e){if(this.indexedDB=mV(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const a=this.indexedDB.open(tI,nI);a.onupgradeneeded=()=>sI(a),a.onsuccess=()=>{const o=a.result;if(t==null){const l=o.transaction(om,"readonly"),u=l.objectStore(om).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(o.close(),r(u.error)),l.oncomplete=()=>o.close()}else{t.weightData=Su.join(t.weightData);const l=T2(t),c=o.transaction($f,"readwrite");let u=c.objectStore($f),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l})}catch(m){return r(m)}let p;d.onsuccess=()=>{p=o.transaction(om,"readwrite");const m=p.objectStore(om);let g;try{g=m.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:l})}catch(b){return r(b)}g.onsuccess=()=>s({modelArtifactsInfo:l}),g.onerror=b=>{u=c.objectStore($f);const v=u.delete(this.modelPath);v.onsuccess=()=>(o.close(),r(g.error)),v.onerror=x=>(o.close(),r(g.error))}},d.onerror=m=>(o.close(),r(d.error)),c.oncomplete=()=>{p==null?o.close():p.oncomplete=()=>o.close()}}},a.onerror=o=>r(a.error)})}}Am.URL_SCHEME="indexeddb://";const gV=n=>Re().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Am.URL_SCHEME)?bae(n.slice(Am.URL_SCHEME.length)):null;dr.registerSaveRouter(gV);dr.registerLoadRouter(gV);function bae(n){return new Am(n)}function vae(n){return n.startsWith(Am.URL_SCHEME)?n.slice(Am.URL_SCHEME.length):n}class wae{constructor(){this.indexedDB=mV()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(tI,nI);s.onupgradeneeded=()=>sI(s),s.onsuccess=()=>{const r=s.result,a=r.transaction($f,"readonly"),l=a.objectStore($f).getAll();l.onsuccess=()=>{const c={};for(const u of l.result)c[u.modelPath]=u.modelArtifactsInfo;e(c)},l.onerror=c=>(r.close(),t(l.error)),a.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=vae(e),new Promise((t,s)=>{const r=this.indexedDB.open(tI,nI);r.onupgradeneeded=()=>sI(r),r.onsuccess=()=>{const a=r.result,o=a.transaction($f,"readwrite"),l=o.objectStore($f),c=l.get(e);let u;c.onsuccess=()=>{if(c.result==null)return a.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=l.delete(e),p=()=>{u=a.transaction(om,"readwrite");const g=u.objectStore(om).delete(e);g.onsuccess=()=>t(c.result.modelArtifactsInfo),g.onerror=b=>s(c.error)};d.onsuccess=p,d.onerror=m=>(p(),a.close(),s(c.error))}},c.onerror=d=>(a.close(),s(c.error)),o.oncomplete=()=>{u==null?a.close():u.oncomplete=()=>a.close()}},r.onerror=a=>s(r.error)})}}const fd="/",y0="tensorflowjs_models",yV="info",xae="model_topology",Sae="weight_specs",Cae="weight_data",_ae="model_metadata";function bV(n){return{info:[y0,n,yV].join(fd),topology:[y0,n,xae].join(fd),weightSpecs:[y0,n,Sae].join(fd),weightData:[y0,n,Cae].join(fd),modelMetadata:[y0,n,_ae].join(fd)}}function vV(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function kae(n){const e=n.split(fd);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(fd)}function Tae(n){return n.startsWith(Em.URL_SCHEME)?n.slice(Em.URL_SCHEME.length):n}class Em{constructor(e){if(!Re().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=bV(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=T2(e),a=Su.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,uae(a));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw vV(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){const l=JSON.parse(a);t.format=l.format,t.generatedBy=l.generatedBy,t.convertedBy=l.convertedBy,l.signature!=null&&(t.signature=l.signature),l.userDefinedMetadata!=null&&(t.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(t.modelInitializer=l.modelInitializer),l.initializerSignature!=null&&(t.initializerSignature=l.initializerSignature),l.trainingConfig!=null&&(t.trainingConfig=l.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=hae(o),t}}Em.URL_SCHEME="localstorage://";const wV=n=>Re().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Em.URL_SCHEME)?Nae(n.slice(Em.URL_SCHEME.length)):null;dr.registerSaveRouter(wV);dr.registerLoadRouter(wV);function Nae(n){return new Em(n)}class Aae{constructor(){ee(Re().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),ee(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=y0+fd,s=fd+yV;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(s)){const o=kae(a);e[o]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){e=Tae(e);const t=bV(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return vV(t),s}}const R0="://";class Aa{constructor(){this.managers={}}static getInstance(){return Aa.instance==null&&(Aa.instance=new Aa),Aa.instance}static registerManager(e,t){ee(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(R0)&&(e=e.slice(0,e.indexOf(R0))),ee(e.length>0,()=>"scheme must not be an empty string.");const s=Aa.getInstance();ee(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Aa.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Aa.getInstance().managers)}}function QS(n){if(n.indexOf(R0)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Aa.getSchemes().join(",")}`);return{scheme:n.split(R0)[0],path:n.split(R0)[1]}}async function xV(n,e,t=!1){ee(n!==e,()=>`Old path and new path are the same: '${n}'`);const s=dr.getLoadHandlers(n);ee(s.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),ee(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${n}.`);const r=s[0],a=dr.getSaveHandlers(e);ee(a.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),ee(a.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=a[0],l=QS(n).scheme,c=QS(n).path,u=l===QS(n).scheme,d=await r.load();t&&u&&await Aa.getManager(l).removeModel(c);const p=await o.save(d);return t&&!u&&await Aa.getManager(l).removeModel(c),p.modelArtifactsInfo}async function Eae(){const n=Aa.getSchemes(),e={};for(const t of n){const s=await Aa.getManager(t).listModels();for(const r in s){const a=t+R0+r;e[a]=s[r]}}return e}async function Iae(n){const e=QS(n);return Aa.getManager(e.scheme).removeModel(e.path)}async function Oae(n,e){return xV(n,e,!1)}async function Dae(n,e){return xV(n,e,!0)}class $ae{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!Re().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return ZU(e)}}if(Re().get("IS_BROWSER")){Re().setPlatform("browser",new $ae);try{Aa.registerManager(Em.URL_SCHEME,new Aae)}catch{}try{Aa.registerManager(Am.URL_SCHEME,new wae)}catch{}}const Rae={importFetch:()=>require("node-fetch")};let H5;class Lae{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return Re().global.fetch!=null?Re().global.fetch(e,t):(H5==null&&(H5=Rae.importFetch()),H5(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Re().get("IS_NODE")&&!Re().get("IS_BROWSER")&&Re().setPlatform("node",new Lae);function Dn(n,e="float32",t){return e=e||"float32",Jo(n),new ni(n,e,t)}function Fae(n,e){const t=ie(n,"x","cast");if(!jU(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return be.runKernel(k1,s,r)}const ft=ve({cast_:Fae});function Mae(n){const t={x:ie(n,"x","clone","string_or_numeric")};return be.runKernel(P1,t)}const uh=ve({clone_:Mae});function mD(n,e=!1){console.log(n.toString(e))}cV();const Pae={buffer:Dn,cast:ft,clone:uh,print:mD};Jie(Pae);function zae(){Re().set("PROD",!0)}function Bae(){Re().set("DEBUG",!0)}function jae(){Re().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Uae(n){Re().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Vae(){be.disposeVariables()}function Qc(){return be}function rI(){return be.memory()}function Wae(n){return be.profile(n)}function Le(n,e){return be.tidy(n,e)}function xn(n){xd(n).forEach(t=>t.dispose())}function fi(n){return be.keep(n)}function Hae(n){return be.time(n)}function Gae(n){return be.setBackend(n)}function qae(){return be.ready()}function Xae(){return be.backendName}function Yae(n){be.removeBackend(n)}function Kae(n){return be.findBackend(n)}function Zae(n){return be.findBackendFactory(n)}function gD(n,e,t=1){return be.registerBackend(n,e,t)}function SV(){return be.backend}function Jae(n,e){Re().setPlatform(n,e)}function Qae(n,e){let t=ie(n,"a","add"),s=ie(e,"b","add");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(rg,r)}const at=ve({add_:Qae});function eoe(n,e){let t=ie(n,"a","floorDiv"),s=ie(e,"b","floorDiv");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(F1,r)}const pT=ve({floorDiv_:eoe});function toe(n,e){let t=ie(n,"a","div"),s=ie(e,"b","div");if([t,s]=gr(t,s),t.dtype==="int32"&&s.dtype==="int32")return pT(t,s);const r={a:t,b:s},a={};return be.runKernel(I1,r,a)}const Bt=ve({div_:toe});function noe(n,e){let t=ie(n,"a","mul"),s=ie(e,"b","mul");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(q1,r)}const Se=ve({mul_:noe});function soe(n){const e=ie(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return be.runKernel(Ow,t)}else{const t={x:e};return be.runKernel(Sw,t)}}const Xr=ve({abs_:soe});function roe(n){const t={x:ie(n,"x","acos")};return be.runKernel(b1,t)}const yD=ve({acos_:roe});function ioe(n){const t={x:ie(n,"x","acosh")};return be.runKernel(v1,t)}const bD=ve({acosh_:ioe});function aoe(n){ee(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),ee(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((r,a)=>ie(r,`tensors${a}`,"addN")),t=e[0];e.forEach(r=>{if(r.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!jn(r.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return be.runKernel(Cw,s)}const CV=ve({addN_:aoe});function ooe(n,e=null,t=!1){const r={x:ie(n,"x","all","bool")},a={axis:e,keepDims:t};return be.runKernel(ak,r,a)}const mT=ve({all_:ooe});function loe(n,e=null,t=!1){const r={x:ie(n,"x","any","bool")},a={axis:e,keepDims:t};return be.runKernel(ok,r,a)}const Fv=ve({any_:loe});function coe(n,e=0){const s={x:ie(n,"x","argMax")},r={axis:e};return be.runKernel(_w,s,r)}const Im=ve({argMax_:coe});function uoe(n,e=0){const s={x:ie(n,"x","argMin")},r={axis:e};return be.runKernel(kw,s,r)}const vD=ve({argMin_:uoe});function hoe(n){const t={x:ie(n,"x","asin")};return be.runKernel(w1,t)}const wD=ve({asin_:hoe});function doe(n){const t={x:ie(n,"x","asinh")};return be.runKernel(x1,t)}const xD=ve({asinh_:doe});function foe(n){const t={x:ie(n,"x","atan")};return be.runKernel(S1,t)}const SD=ve({atan_:foe});function poe(n,e){let t=ie(n,"a","atan2"),s=ie(e,"b","atan2");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(_1,r)}const CD=ve({atan2_:poe});function moe(n){const t={x:ie(n,"x","atanh")};return be.runKernel(C1,t)}const _D=ve({atanh_:moe});function N2(n,e,t,s,r="NHWC",a){const o=n[3],l=[...e,o],c=$d(r);return Li(n,l,t,a,s,null,null,c)}function yc(n,e,t,s,r,a,o="channelsLast"){const[l,c]=Mv(e);let u;if(o==="channelsLast")u=[l,c,n[3],n[3]];else if(o==="channelsFirst")u=[l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Li(n,u,t,s,r,a,!1,o)}function Dd(n,e,t,s,r,a,o="NDHWC"){const[l,c,u]=iI(e);let d,p;if(o==="NDHWC")p="channelsLast",d=[l,c,u,n[4],n[4]];else if(o==="NCDHW")p="channelsFirst",d=[l,c,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return rp(n,d,t,s,r,!1,p,a)}function Li(n,e,t,s,r,a,o=!1,l="channelsLast"){let[c,u,d,p]=[-1,-1,-1,-1];if(l==="channelsLast")[c,u,d,p]=n;else if(l==="channelsFirst")[c,p,u,d]=n;else throw new Error(`Unknown dataFormat ${l}`);const[m,g,,b]=e,[v,x]=Mv(t),[S,C]=Mv(s),A=L0(m,S),k=L0(g,C),{padInfo:O,outHeight:F,outWidth:$}=boe(r,u,d,v,x,A,k,a,l),M=o?b*p:b;let R;return l==="channelsFirst"?R=[c,M,F,$]:l==="channelsLast"&&(R=[c,F,$,M]),{batchSize:c,dataFormat:l,inHeight:u,inWidth:d,inChannels:p,outHeight:F,outWidth:$,outChannels:M,padInfo:O,strideHeight:v,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:A,effectiveFilterWidth:k,dilationHeight:S,dilationWidth:C,inShape:n,outShape:R,filterShape:e}}function rp(n,e,t,s,r,a=!1,o="channelsLast",l){let[c,u,d,p,m]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[c,u,d,p,m]=n;else if(o==="channelsFirst")[c,m,u,d,p]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,b,v,,x]=e,[S,C,A]=iI(t),[k,O,F]=iI(s),$=L0(g,k),M=L0(b,O),R=L0(v,F),{padInfo:z,outDepth:I,outHeight:j,outWidth:H}=voe(r,u,d,p,S,C,A,$,M,R,l),q=a?x*m:x;let re;return o==="channelsFirst"?re=[c,q,I,j,H]:o==="channelsLast"&&(re=[c,I,j,H,q]),{batchSize:c,dataFormat:o,inDepth:u,inHeight:d,inWidth:p,inChannels:m,outDepth:I,outHeight:j,outWidth:H,outChannels:q,padInfo:z,strideDepth:S,strideHeight:C,strideWidth:A,filterDepth:g,filterHeight:b,filterWidth:v,effectiveFilterDepth:$,effectiveFilterHeight:M,effectiveFilterWidth:R,dilationDepth:k,dilationHeight:O,dilationWidth:F,inShape:n,outShape:re,filterShape:e}}function goe(n,e,t,s,r){s==null&&(s=kD(n,e,t));const a=n[0],o=n[1],l=Pv((a-e+2*s)/t+1,r),c=Pv((o-e+2*s)/t+1,r);return[l,c]}function yoe(n,e,t,s,r,a){r==null&&(r=kD(n,e[0],s[0]));const o=[0,0,0,t];for(let l=0;l<3;l++)n[l]+2*r>=e[l]&&(o[l]=Pv((n[l]-e[l]+2*r)/s[l]+1,a));return o}function kD(n,e,t,s=1){const r=L0(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Mv(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function iI(n){return typeof n=="number"?[n,n,n]:n}function L0(n,e){return e<=1?n:n+(n-1)*(e-1)}function boe(n,e,t,s,r,a,o,l,c){let u,d,p;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=goe([e,t],a,s,n,l);d=g[0],p=g[1]}else if(n==="same"){d=Math.ceil(e/s),p=Math.ceil(t/r);const m=Math.max(0,(d-1)*s+a-e),g=Math.max(0,(p-1)*r+o-t),b=Math.floor(m/2),v=m-b,x=Math.floor(g/2),S=g-x;u={top:b,bottom:v,left:x,right:S,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-a+1)/s),p=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const m=c==="channelsLast"?n[1][0]:n[2][0],g=c==="channelsLast"?n[1][1]:n[2][1],b=c==="channelsLast"?n[2][0]:n[3][0],v=c==="channelsLast"?n[2][1]:n[3][1];u={top:m,bottom:g,left:b,right:v,type:m===0&&g===0&&b===0&&v===0?"VALID":"EXPLICIT"},d=Pv((e-a+m+g)/s+1,l),p=Pv((t-o+b+v)/r+1,l)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:p}}function voe(n,e,t,s,r,a,o,l,c,u,d){let p,m,g,b;if(n==="valid"&&(n=0),typeof n=="number"){p={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=yoe([e,t,s,1],[l,c,u],1,[r,a,o],n,d);m=x[0],g=x[1],b=x[2]}else if(n==="same"){m=Math.ceil(e/r),g=Math.ceil(t/a),b=Math.ceil(s/o);const v=(m-1)*r+l-e,x=(g-1)*a+c-t,S=(b-1)*o+u-s,C=Math.floor(v/2),A=v-C,k=Math.floor(x/2),O=x-k,F=Math.floor(S/2),$=S-F;p={top:k,bottom:O,left:F,right:$,front:C,back:A,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:p,outDepth:m,outHeight:g,outWidth:b}}function Pv(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Gf(n){const[e,t,s]=Mv(n);return e===1&&t===1&&s===1}function ta(n,e){return Gf(n)||Gf(e)}function Om(n){return Mv(n).every(e=>e>0)}function $d(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Fa(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ee(Nm(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{ee(Nm(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}function woe(n,e){const s={x:ie(n,"x","reshape","string_or_numeric")},r={shape:e};return be.runKernel(h2,s,r)}const _e=ve({reshape_:woe});function xoe(n,e,t,s,r){const a=ie(n,"x","avgPool","float32"),o=1;ee(ta(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let l=a,c=!1;a.rank===3&&(c=!0,l=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ee(l.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${l.rank}.`),Fa("avgPool",s,r);const u={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let p=be.runKernel(Tw,u,d);return p=ft(p,a.dtype),c?_e(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const A2=ve({avgPool_:xoe});function Soe(n,e,t,s,r,a="NDHWC"){const o=ie(n,"x","avgPool3d","float32");let l=o,c=!1;o.rank===4&&(c=!0,l=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ee(l.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),ee(a==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),ee(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Fa("avgPool3d",s,r);const u={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:a};let p=be.runKernel(Nw,u,d);return p=ft(p,l.dtype),c?_e(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const TD=ve({avgPool3d_:Soe});function Coe(n,e=0){ee(n.length>=1,()=>"Pass at least one tensor to concat");const t=Lv(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(a=>{if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${a.dtype}. `)}),t.length===1)return uh(t[0]);const s=t,r={axis:e};return be.runKernel(Dw,s,r)}const Pr=ve({concat_:Coe});function _oe(n,e,t=!1,s=!1){let r=ie(n,"a","matMul"),a=ie(e,"b","matMul");[r,a]=gr(r,a);const o={a:r,b:a},l={transposeA:t,transposeB:s};return be.runKernel(Aw,o,l)}const Ln=ve({matMul_:_oe});function koe(n){const t={x:ie(n,"x","sigmoid","float32")};return be.runKernel(ry,t)}const lu=ve({sigmoid_:koe});function Toe(n,e,t){const s=ie(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},a={begin:e,size:t};return be.runKernel(g2,r,a)}const Xn=ve({slice_:Toe});function Noe(n){const t={x:ie(n,"x","tanh","float32")};return be.runKernel(uy,t)}const Dm=ve({tanh_:Noe});function Aoe(n,e,t,s,r,a){const o=ie(n,"forgetBias","basicLSTMCell"),l=ie(e,"lstmKernel","basicLSTMCell"),c=ie(t,"lstmBias","basicLSTMCell"),u=ie(s,"data","basicLSTMCell"),d=ie(r,"c","basicLSTMCell"),p=ie(a,"h","basicLSTMCell"),m=Pr([u,p],1),g=Ln(m,l),b=at(g,c),v=b.shape[0],x=b.shape[1]/4,S=[v,x],C=Xn(b,[0,0],S),A=Xn(b,[0,x],S),k=Xn(b,[0,x*2],S),O=Xn(b,[0,x*3],S),F=at(Se(lu(C),Dm(A)),Se(d,lu(at(o,k)))),$=Se(Dm(F),lu(O));return[F,$]}const _V=ve({basicLSTMCell_:Aoe});function Eoe(n,e,t){const s=ie(n,"x","batchToSpaceND"),r=e.reduce((l,c)=>l*c);ee(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),ee(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ee(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const a={x:s},o={blockShape:e,crops:t};return be.runKernel(Ew,a,o)}const E2=ve({batchToSpaceND_:Eoe});function Ioe(n){let e;return n.rank===0||n.rank===1?e=_e(n,[1,1,1,n.size]):n.rank===2?e=_e(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=_e(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function Ooe(n,e,t,s,r,a){a==null&&(a=.001);const o=ie(n,"x","batchNorm"),l=ie(e,"mean","batchNorm"),c=ie(t,"variance","batchNorm");let u;r!=null&&(u=ie(r,"scale","batchNorm"));let d;s!=null&&(d=ie(s,"offset","batchNorm")),ee(l.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ee(d==null||l.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ee(u==null||l.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:Ioe(o),scale:u,offset:d,mean:l,variance:c},g={varianceEpsilon:a},b=be.runKernel(jw,m,g);return _e(b,o.shape)}const fy=ve({batchNorm_:Ooe});function Doe(n,e,t,s,r,a){const o=ie(n,"x","batchNorm"),l=ie(e,"mean","batchNorm"),c=ie(t,"variance","batchNorm");let u;r!=null&&(u=ie(r,"scale","batchNorm"));let d;return s!=null&&(d=ie(s,"offset","batchNorm")),ee(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),ee(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`),ee(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&ee(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&ee(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),fy(o,l,c,d,u,a)}const ND=ve({batchNorm2d_:Doe});function $oe(n,e,t,s,r,a){const o=ie(n,"x","batchNorm"),l=ie(e,"mean","batchNorm"),c=ie(t,"variance","batchNorm");let u;r!=null&&(u=ie(r,"scale","batchNorm"));let d;return s!=null&&(d=ie(s,"offset","batchNorm")),ee(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),ee(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`),ee(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&ee(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&ee(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),fy(o,l,c,d,u,a)}const AD=ve({batchNorm3d_:$oe});function Roe(n,e,t,s,r,a){const o=ie(n,"x","batchNorm"),l=ie(e,"mean","batchNorm"),c=ie(t,"variance","batchNorm");let u;r!=null&&(u=ie(r,"scale","batchNorm"));let d;return s!=null&&(d=ie(s,"offset","batchNorm")),ee(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),ee(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`),ee(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&ee(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&ee(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),fy(o,l,c,d,u,a)}const ED=ve({batchNorm4d_:Roe});function Loe(n,e,t){const s=ie(n,"x","bincount"),r=ie(e,"weights","bincount");ee(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),ee(t>=0,()=>`size must be non-negative, but got ${t}.`),ee(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const a={x:s,weights:r},o={size:t};return be.runKernel(uk,a,o)}const ID=ve({bincount_:Loe});function Foe(n,e){const t=ie(n,"x","bitwiseAnd"),s=ie(e,"y","bitwiseAnd");if(!jn(t.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${s.shape}`);if(t.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${s.dtype}`);const r={a:t,b:s};return be.runKernel(Iw,r)}const kV=ve({bitwiseAnd_:Foe});function Moe(n,e){const t=ie(n,"s0","broadcastArgs","int32"),s=ie(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:t,s1:s};return be.runKernel(hk,r)}const TV=ve({broadcastArgs_:Moe});function Poe(n,e){let t=ie(n,"broadcastTo","x");const s=t.shape;if(Jo(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=_e(t,u)}const r=t.shape,a=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])a[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(a.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return uh(t);const l={x:t},c={reps:a};return be.runKernel(hy,l,c)}const gm=ve({broadcastTo_:Poe});function zoe(n){const t={x:ie(n,"x","ceil","float32")};return be.runKernel(T1,t)}const OD=ve({ceil_:zoe});function ig(n,e,t){Jo(n),t=t||ng(e);const s={shape:n,value:e,dtype:t};return be.runKernel(Nk,{},s)}function Boe(n,e,t){const s=ie(n,"x","clipByValue");if(ee(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return ig(s.shape,e,s.dtype);const r={x:s},a={clipValueMin:e,clipValueMax:t};return be.runKernel(N1,r,a)}const uo=ve({clipByValue_:Boe});function joe(n){return Pr(n,0)}const DD=ve({concat1d_:joe});function Uoe(n,e){return Pr(n,e)}const $D=ve({concat2d_:Uoe});function Voe(n,e){return Pr(n,e)}const RD=ve({concat3d_:Voe});function Woe(n,e){return Pr(n,e)}const LD=ve({concat4d_:Woe});function Hoe(n,e,t,s,r="NHWC",a=[1,1],o){const l=ie(n,"x","conv2d","float32"),c=ie(e,"filter","conv2d","float32");let u=l,d=!1;l.rank===3&&(d=!0,u=_e(l,[1,l.shape[0],l.shape[1],l.shape[2]])),ee(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),ee(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),Fa("conv2d",s,o);const p=r==="NHWC"?u.shape[3]:u.shape[1];ee(p===c.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${c.shape[2]}.`),ee(ta(t,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),ee(Om(a),()=>"Error in conv2D: Dilated rates should be larger than 0."),ee(Om(t),()=>"Error in conv2D: Strides should be larger than 0.");const m={x:u,filter:c},g={strides:t,pad:s,dataFormat:r,dilations:a,dimRoundingMode:o},b=be.runKernel($w,m,g);return d?_e(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const Cd=ve({conv2d_:Hoe});function Goe(n,e,t,s,r="NWC",a=1,o){const l=ie(n,"x","conv1d"),c=ie(e,"filter","conv1d");let u=l,d=!1;l.rank===2&&(d=!0,u=_e(l,[1,l.shape[0],l.shape[1]])),ee(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),ee(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),Fa("conv1d",s,o),ee(u.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${c.shape[1]}.`),ee(ta(t,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${a}'`),ee(Om(a),()=>"Error in conv1D: Dilated rates should be larger than 0."),ee(Om(t),()=>"Error in conv1D: Stride should be larger than 0."),ee(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const p=_e(c,[1,c.shape[0],c.shape[1],c.shape[2]]),m=_e(u,[u.shape[0],1,u.shape[1],u.shape[2]]),x=Cd(m,p,[1,t],s,"NHWC",[1,a],o);return d?_e(x,[x.shape[2],x.shape[3]]):_e(x,[x.shape[0],x.shape[2],x.shape[3]])}const gT=ve({conv1d_:Goe});function qoe(n,e,t,s,r,a="NHWC",o){ee(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let l=n,c=e,u=!1;e.rank===3&&(u=!0,c=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]),l=[1,n[0],n[1],n[2]]),ee(l.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`),ee(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),ee(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=a==="NHWC"?l[3]:l[1],p=a==="NHWC"?c.shape[3]:c.shape[1];ee(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),ee(p===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${t.shape[3]}.`),Fa("conv2dDerInput",r,o);const m={dy:c,filter:t},g={strides:s,pad:r,dataFormat:a,dimRoundingMode:o,inputShape:l},b=be.runKernel(Rw,m,g);return u?_e(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const FD=ve({conv2DBackpropInput_:qoe});function Xoe(n,e,t,s,r,a){const o=ie(n,"x","conv2dTranspose"),l=ie(e,"filter","conv2dTranspose");return FD(t,o,l,s,r,"NHWC",a)}const yT=ve({conv2dTranspose_:Xoe});function Yoe(n,e,t,s,r="NDHWC",a=[1,1,1]){const o=ie(n,"x","conv3d"),l=ie(e,"filter","conv3d");let c=o,u=!1;o.rank===4&&(u=!0,c=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ee(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),ee(l.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`),ee(c.shape[4]===l.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${l.shape[3]}.`),ee(ta(t,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),ee(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),ee(Om(a),()=>"Error in conv3D: Dilated rates should be larger than 0."),ee(Om(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:c,filter:l},p={strides:t,pad:s,dataFormat:r,dilations:a},m=be.runKernel(Lw,d,p);return u?_e(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const MD=ve({conv3d_:Yoe});function Koe(n,e,t,s,r){ee(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,o=e,l=!1;e.rank===4&&(l=!0,o=_e(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),a=[1,n[0],n[1],n[2],n[3]]);const c=a[4],u=o.shape[4];ee(a.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${a.length}.`),ee(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ee(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ee(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),ee(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},p={pad:r,strides:s,inputShape:a},m=be.runKernel(mk,d,p);return l?_e(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const NV=ve({conv3DBackpropInput_:Koe});function Zoe(n,e,t,s,r){const a=ie(n,"x","conv3dTranspose"),o=ie(e,"filter","conv3dTranspose");return NV(t,a,o,s,r)}const PD=ve({conv3dTranspose_:Zoe});function Joe(n){const t={x:ie(n,"x","cos","float32")};return be.runKernel(A1,t)}const I2=ve({cos_:Joe});function Qoe(n){const t={x:ie(n,"x","cosh","float32")};return be.runKernel(E1,t)}const bT=ve({cosh_:Qoe});function ele(n,e=0,t=!1,s=!1){const a={x:ie(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return be.runKernel(gk,a,o)}const zv=ve({cumprod_:ele});function tle(n,e=0,t=!1,s=!1){const a={x:ie(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return be.runKernel(Fw,a,o)}const vT=ve({cumsum_:tle});function nle(n,e,t,s=!1){const r=ie(n,"x","denseBincount"),a=ie(e,"weights","denseBincount");ee(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),ee(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),ee(t>=0,()=>`size must be non-negative, but got ${t}.`),ee(a.size===r.size||a.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${a.shape}.`);const o={x:r,weights:a},l={size:t,binaryOutput:s};return be.runKernel(bk,o,l)}const s_=ve({denseBincount_:nle});function sle(n,e,t="NHWC"){const s=ie(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],a=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];ee(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ee(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),ee(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e} for depthToSpace with input shape
        ${s.shape}`),ee(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const l={x:s},c={blockSize:e,dataFormat:t};return be.runKernel(vk,l,c)}const zD=ve({depthToSpace_:sle});function rle(n,e,t,s,r="NHWC",a=[1,1],o){const l=ie(n,"x","depthwiseConv2d","float32"),c=ie(e,"filter","depthwiseConv2d","float32");let u=l,d=!1;l.rank===3&&(d=!0,u=_e(l,[1,l.shape[0],l.shape[1],l.shape[2]])),ee(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),ee(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const p=r==="NHWC"?u.shape[3]:u.shape[1];ee(p===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${c.shape[2]}.`),Fa("depthwiseConv2d",s,o);const m={x:u,filter:c},g={strides:t,pad:s,dataFormat:r,dilations:a,dimRoundingMode:o},b=be.runKernel(Mw,m,g);return d?_e(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const py=ve({depthwiseConv2d_:rle});function ile(n){const t={x:ie(n,"x","diag")};return be.runKernel(Sk,t)}const AV=ve({diag_:ile});function ale(n,e,t,s,r=[1,1],a="NHWC"){const o=ie(n,"x","dilation2d"),l=ie(e,"filter","dilation2d");ee(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ee(l.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`),ee(a==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${a}`);let c=o,u=!1;o.rank===3&&(c=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),ee(c.shape[3]===l.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${l.shape[2]}`);const d={x:c,filter:l},p={strides:t,pad:s,dilations:r},m=be.runKernel(Pw,d,p);return u?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const BD=ve({dilation2d_:ale});function $m(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const a=t-1-r,o=n[a]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(a)}return s}function si(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],a=e.length-s-1,o=e[a];(r==null||r===1&&o>1)&&t.unshift(a)}return t}function Sn(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let a=n[n.length-r-1];a==null&&(a=1);let o=e[e.length-r-1];if(o==null&&(o=1),a===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=a;else if(a!==o){const l=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(l)}else s[t-r-1]=a}return s}const ole=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Sn,getBroadcastDims:$m,getReductionAxes:si},Symbol.toStringTag,{value:"Module"}));function lle(n,e){let t=ie(n,"a","equal","string_or_numeric"),s=ie(e,"b","equal","string_or_numeric");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(zw,r)}const Go=ve({equal_:lle});function cle(n,e,t){const s=ie(e,"a","where"),r=ie(t,"b","where"),a=ie(n,"condition","where","bool"),o=Sn(Sn(a.shape,s.shape),r.shape),l=gm(a,o),c=gm(s,o),u=gm(r,o),d={condition:l,t:c,e:u};return be.runKernel(m2,d)}const Di=ve({where_:cle});function ule(n){const t={x:ie(n,"x","zerosLike")};return be.runKernel(_2,t)}const Kn=ve({zerosLike_:ule});function hle(n,e){let t=ie(n,"a","div"),s=ie(e,"b","div");[t,s]=gr(t,s);const r=Bt(t,s),a=Kn(r),o=Go(s,a);return Di(o,a,r)}const jD=ve({divNoNan_:hle});function dle(n,e){const t=ie(n,"t1","dot"),s=ie(e,"t2","dot");ee((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],a=s.rank===1?s.size:s.shape[0];if(ee(r===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${a}.`),t.rank===1&&s.rank===1){const o=_e(t,[1,-1]),l=_e(s,[-1,1]),c=Ln(o,l);return _e(c,[])}else if(t.rank===1&&s.rank===2){const o=_e(t,[1,-1]),l=_e(s,[s.shape[0],s.shape[1]]),c=Ln(o,l);return _e(c,[c.size])}else if(t.rank===2&&s.rank===1){const o=_e(s,[-1,1]),l=Ln(t,o);return _e(l,[l.size])}else{const o=_e(s,[s.shape[0],s.shape[1]]);return Ln(t,o)}}const UD=ve({dot_:dle});function fle(n,...e){const t=e.map((r,a)=>ie(r,`tensors${a}`,"einsum")),s={equation:n};return be.runKernel(_k,t,s)}const tm=ve({einsum_:fle});function ple(n){const t={x:ie(n,"x","elu","float32")};return be.runKernel(O1,t)}const my=ve({elu_:ple});function mle(n,e){const t=ie(n,"x","ensureShape","string_or_numeric");if(!zU(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return n}const EV=ve({ensureShape_:mle});function gle(n){let e=ie(n,"x","erf");ee(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ft(e,"float32"));const t={x:e};return be.runKernel(D1,t)}const VD=ve({erf_:gle});function WD(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function IV(n,e,t){const s=n.length+e.length,r=[];let a=0,o=0;for(let l=0;l<s;l++)t.indexOf(l)===-1?r.push(n[a++]):r.push(e[o++]);return r}function Fi(n,e){const t=[],s=n.length;for(let a=0;a<s;a++)e.indexOf(a)===-1&&t.push(n[a]);const r=e.map(a=>n[a]);return[t,r]}function zr(n,e){const t=e.map(s=>1);return IV(n,t,e)}function na(n,e,t){ee(WD(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function yr(n,e){if(WD(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function ip(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Br(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}function yle(n,e=null,t=!1){const r={x:ie(n,"x","max")},a={reductionIndices:e,keepDims:t};return be.runKernel(Zw,r,a)}const Il=ve({max_:yle});function ble(n,e=null,t=!1){const r={x:ie(n,"x","min")},a={axis:e,keepDims:t};return be.runKernel(t2,r,a)}const W0=ve({min_:ble});function vle(n,e){let t=ie(n,"base","pow"),s=ie(e,"exp","pow");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(X1,r)}const _d=ve({pow_:vle});function Xt(n,e){if((di(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&di(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return sp(n,[],[],e)}function wle(n){const t={x:ie(n,"x","sqrt","float32")};return be.runKernel(ay,t)}const Qi=ve({sqrt_:wle});function xle(n){const e=ie(n,"x","square"),t={};return be.runKernel("Square",{x:e},t)}const As=ve({square_:xle});function Sle(n,e=null,t=!1){let s=ie(n,"x","sum");s.dtype==="bool"&&(s=ft(s,"int32"));const r={x:s},a={axis:e,keepDims:t};return be.runKernel(y2,r,a)}const It=ve({sum_:Sle});function Cle(n,e="euclidean",t=null,s=!1){n=ie(n,"x","norm");const r=OV(n,e,t);let a=r.shape;if(s){const o=Fn(t,n.shape);a=zr(r.shape,o)}return _e(r,a)}function OV(n,e,t=null){if(n.rank===0)return Xr(n);if(n.rank!==1&&t===null)return OV(_e(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return It(Xr(n),t);if(e===1/0)return Il(Xr(n),t);if(e===-1/0)return W0(Xr(n),t);if(e==="euclidean"||e===2)return Qi(It(_d(Xr(n),Xt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Il(It(Xr(n),t[0]),t[1]-1);if(e===1/0)return Il(It(Xr(n),t[1]),t[0]);if(e===-1/0)return W0(It(Xr(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Qi(It(As(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const gy=ve({norm_:Cle});function _le(n,e=null,t=!1){return gy(n,"euclidean",e,t)}const HD=ve({euclideanNorm_:_le});function kle(n){const t={x:ie(n,"x","exp")};return be.runKernel($1,t)}const ho=ve({exp_:kle});function Tle(n,e=0){const t=ie(n,"x","expandDims","string_or_numeric");ee(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return be.runKernel(Bw,s,r)}const qi=ve({expandDims_:Tle});function Nle(n){const t={x:ie(n,"x","expm1")};return be.runKernel(R1,t)}const GD=ve({expm1_:Nle});function Ale(n,e){const t=ie(n,"x","tile","string_or_numeric");ee(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return be.runKernel(hy,s,r)}const kl=ve({tile_:Ale});function Ele(n,e,t,s="float32"){e==null&&(e=n);const r=Dn([n,e],s),a=n<=e?n:e;for(let l=0;l<a;++l)r.set(1,l,l);const o=_e(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return kl(qi(o,0),[t[0],1,1]);if(t.length===2)return kl(qi(qi(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return kl(qi(qi(qi(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const wT=ve({eye_:Ele});function Ile(n){const t={x:ie(n,"x","floor","float32")};return be.runKernel(L1,t)}const yy=ve({floor_:Ile});function Ole(n,e,t=0,s=0){const r=ie(n,"x","gather"),a=ie(e,"indices","gather","int32"),o={x:r,indices:a},l={axis:t,batchDims:s};return be.runKernel(Uw,o,l)}const by=ve({gather_:Ole});function Dle(n,e){let t=ie(n,"a","greater","string_or_numeric"),s=ie(e,"b","greater","string_or_numeric");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Vw,r)}const Ma=ve({greater_:Dle});function $le(n,e){let t=ie(n,"a","greaterEqual","string_or_numeric"),s=ie(e,"b","greaterEqual","string_or_numeric");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(M1,r)}const Rd=ve({greaterEqual_:$le});function Rle(n){const t={input:ie(n,"input","imag")};return be.runKernel(Ok,t)}const O2=ve({imag_:Rle});function Lle(n){const t={x:ie(n,"x","isFinite")};return be.runKernel(z1,t)}const qD=ve({isFinite_:Lle});function Fle(n){const t={x:ie(n,"x","isInf")};return be.runKernel(B1,t)}const XD=ve({isInf_:Fle});function Mle(n){const t={x:ie(n,"x","isNaN")};return be.runKernel(j1,t)}const YD=ve({isNaN_:Mle});function Ple(n,e=.2){const s={x:ie(n,"x","leakyRelu")},r={alpha:e};return be.runKernel(Ww,s,r)}const D2=ve({leakyRelu_:Ple});function zle(n,e){let t=ie(n,"a","less","string_or_numeric"),s=ie(e,"b","less","string_or_numeric");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Hw,r)}const H0=ve({less_:zle});function Ble(n,e){let t=ie(n,"a","lessEqual","string_or_numeric"),s=ie(e,"b","lessEqual","string_or_numeric");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Gw,r)}const ap=ve({lessEqual_:Ble});function DV(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const s={start:n,stop:e,num:t};return be.runKernel(Dk,{},s)}function jle(n,e=5,t=1,s=1,r=.5){const a=ie(n,"x","localResponseNormalization");ee(a.rank===4||a.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${a.rank}.`),ee(Nm(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=a,l=!1;a.rank===3&&(l=!0,o=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const c={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},d=be.runKernel(Kw,c,u);return l?_e(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const KD=ve({localResponseNormalization_:jle});function Ule(n){const t={x:ie(n,"x","log","float32")};return be.runKernel(U1,t)}const qo=ve({log_:Ule});function Vle(n){const t={x:ie(n,"x","log1p")};return be.runKernel(V1,t)}const $2=ve({log1p_:Vle});function Wle(n){return ee(Hf(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const s=ie(e,"x","tf.grad","string_or_numeric"),r=t!=null?ie(t,"dy","tf.grad"):null;return be.tidy(()=>{const{value:a,grads:o}=be.gradients(()=>n(s),[s],r);return r!=null&&ea(a.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),xT(o),o[0]})}}function Hle(n){return ee(Hf(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{ee(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=Lv(e,"args","tf.grads","string_or_numeric"),r=t!=null?ie(t,"dy","tf.grads"):null;return be.tidy(()=>{const{value:a,grads:o}=be.gradients(()=>n(...s),s,r);return r!=null&&ea(a.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),xT(o),o})}}function Gle(n){return ee(Hf(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{ee(e instanceof Yn,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),ee(t==null||t instanceof Yn,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=be.gradients(()=>n(e),[e],t);return xT(s),{grad:s[0],value:r}}}function qle(n){return ee(Hf(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{ee(Array.isArray(e)&&e.every(r=>r instanceof Yn),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),ee(t==null||t instanceof Yn,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=be.gradients(()=>n(...e),e,t);return t!=null&&ea(s.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),xT(s.grads),s}}function $V(n,e){ee(Hf(n),()=>"The f passed in variableGrads(f) must be a function"),ee(e==null||Array.isArray(e)&&e.every(u=>u instanceof Rv),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in be.registeredVariables)e.push(be.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),ee(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const a=!0,{value:o,grads:l}=be.gradients(n,e,null,a);ee(l.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ee(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const c={};return e.forEach((u,d)=>{l[d]!=null&&(c[u.name]=l[d])}),s?.forEach(u=>c[u.name]=null),{value:o,grads:c}}function xh(n){return be.customGrad(n)}function xT(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Xle(n){const t={x:ie(n,"x","neg")};return be.runKernel(s2,t)}const Gs=ve({neg_:Xle});function Yle(n){const t={x:ie(n,"x","softplus")};return be.runKernel(iy,t)}const ag=ve({softplus_:Yle});function Kle(n){const e=ie(n,"x","logSigmoid");return xh(s=>({value:Gs(ag(Gs(s))),gradFunc:o=>Se(o,lu(Gs(s)))}))(e)}const ZD=ve({logSigmoid_:Kle});function Zle(n,e){let t=ie(n,"a","sub"),s=ie(e,"b","sub");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(ly,r)}const St=ve({sub_:Zle});function Jle(n,e=-1){const t=ie(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return xh((r,a)=>{const l=Il(r,e,!0),c=St(r,l),u=St(ft(c,"float32"),qo(It(ho(c),e,!0)));return a([u]),{value:u,gradFunc:(p,m)=>{const[g]=m,b=!0,v=ho(g);return St(p,Se(It(p,e,b),v))}}})(t)}const ST=ve({logSoftmax_:Jle});function Qle(n,e=null,t=!1){const s=ie(n,"x","logSumExp"),r=Fn(e,s.shape),a=Il(s,r,!0),o=St(s,a),l=ho(o),c=It(l,r),u=qo(c),d=at(_e(a,u.shape),u);if(t){const p=zr(d.shape,r);return _e(d,p)}return d}const R2=ve({logSumExp_:Qle});function ece(n,e){const t=ie(n,"a","logicalAnd","bool"),s=ie(e,"b","logicalAnd","bool");Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(qw,r)}const mc=ve({logicalAnd_:ece});function tce(n){const t={x:ie(n,"x","logicalNot","bool")};return be.runKernel(Xw,t)}const L2=ve({logicalNot_:tce});function nce(n,e){const t=ie(n,"a","logicalOr","bool"),s=ie(e,"b","logicalOr","bool");Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Yw,r)}const CT=ve({logicalOr_:nce});function sce(n,e){const t=ie(n,"a","logicalXor","bool"),s=ie(e,"b","logicalXor","bool");return Sn(t.shape,s.shape),mc(CT(n,e),L2(mc(n,e)))}const JD=ve({logicalXor_:sce});const kS=2147483648;function rce(n,e,t="left"){const s=ie(n,"sortedSequence","searchSorted"),r=ie(e,"values","searchSorted"),a=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],l=_e(s,[-1,a]),c=_e(r,[-1,o]);if(l.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(l.shape[0]!==c.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(We(c.shape)>=kS)throw new Error(`values tensor size must less than ${kS}`);if(l.shape[1]>=kS)throw new Error(`trailing dim_size must less than ${kS} for int32 output type, was ${l.shape[1]}`);const u={sortedSequence:l,values:c},d={side:t};return be.runKernel(Kk,u,d)}const _T=ve({searchSorted_:rce});function RV(n,e){return _T(n,e,"left")}function ice(n,e,t,s,r){const a=ie(n,"x","maxPool"),o=1;let l=a,c=!1;a.rank===3&&(c=!0,l=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ee(l.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.rank}.`),ee(ta(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Fa("maxPool",s,r);const u={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},p=be.runKernel(Jw,u,d);return c?_e(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const F2=ve({maxPool_:ice});function ace(n,e=[1,1,1],t,s,r,a="NDHWC"){const o=ie(n,"x","maxPool3d");let l=o,c=!1;o.rank===4&&(c=!0,l=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ee(l.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),ee(a==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),Fa("maxPool3d",s,r);const u={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:a},p=be.runKernel(Qw,u,d);return c?_e(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const QD=ve({maxPool3d_:ace});function oce(n,e,t,s,r=!1){const o={x:ie(n,"x","maxPoolWithArgmax")},l={filterSize:e,strides:t,pad:s,includeBatchInIndex:r},c=be.runKernel(Fk,o,l);return{result:c[0],indexes:c[1]}}const LV=ve({maxPoolWithArgmax_:oce});function lce(n,e){let t=ie(n,"a","maximum"),s=ie(e,"b","maximum");[t,s]=gr(t,s),t.dtype==="bool"&&(t=ft(t,"int32"),s=ft(s,"int32")),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(W1,r)}const Th=ve({maximum_:lce});function cce(n,e=null,t=!1){const r={x:ie(n,"x","mean")},a={axis:e,keepDims:t};return be.runKernel(e2,r,a)}const pr=ve({mean_:cce});function Qr(n,e="float32"){if(Jo(n),e==="complex64"){const s=Qr(n,"float32"),r=Qr(n,"float32");return Sd(s,r)}const t=Ji(We(n),e);return be.makeTensor(t,n,e)}function to(n,e="float32"){if(Jo(n),e==="complex64"){const s=to(n,"float32"),r=Qr(n,"float32");return Sd(s,r)}const t=ik(We(n),e);return be.makeTensor(t,n,e)}function FV(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let s=ie(n,"x","meshgrid",n instanceof Yn?n.dtype:"float32");if(e===void 0)return[s];let r=ie(e,"y","meshgrid",e instanceof Yn?e.dtype:"float32");const a=We(s.shape),o=We(r.shape);return t==="xy"?(s=_e(s,[1,-1]),r=_e(r,[-1,1]),[Ln(to([o,1],s.dtype),s),Ln(r,to([1,a],r.dtype))]):(s=_e(s,[-1,1]),r=_e(r,[1,-1]),[Ln(s,to([1,o],s.dtype)),Ln(to([a,1],r.dtype),r)])}function uce(n,e){let t=ie(n,"a","minimum"),s=ie(e,"b","minimum");[t,s]=gr(t,s),t.dtype==="bool"&&(t=ft(t,"int32"),s=ft(s,"int32")),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(H1,r)}const qf=ve({minimum_:uce});function hce(n,e,t){ee(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=ie(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ee(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let l=0;l<s.rank;l++)ee(e[l].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ee(e[l][0]>=0&&e[l][0]<=s.shape[l]-r&&e[l][1]>=0&&e[l][1]<=s.shape[l]-r,()=>`Padding in dimension ${l} cannot be greater than or equal to ${s.shape[l]-r} or less than 0 for input of shape ${s.shape}`);const a={paddings:e,mode:t},o={x:s};return be.runKernel(n2,o,a)}const e$=ve({mirrorPad_:hce});function dce(n,e){let t=ie(n,"a","mod"),s=ie(e,"b","mod");[t,s]=gr(t,s);const r={a:t,b:s};return be.runKernel(G1,r)}const t$=ve({mod_:dce});function fce(n,e=null,t=!1){n=ie(n,"x","moments");const s=Fn(e,n.shape),r=pr(n,s,t);let a=r.shape;t||(a=zr(r.shape,s));const o=As(St(ft(n,"float32"),_e(r,a))),l=pr(o,s,t);return{mean:r,variance:l}}const M2=ve({moments_:fce});function pce(n,e,t,s){const r=ie(e,"data","multiRNNCell"),a=Lv(t,"c","multiRNNCell"),o=Lv(s,"h","multiRNNCell");let l=r;const c=[];for(let p=0;p<n.length;p++){const m=n[p](l,a[p],o[p]);c.push(m[0]),c.push(m[1]),l=m[1]}const u=[],d=[];for(let p=0;p<c.length;p+=2)u.push(c[p]),d.push(c[p+1]);return[u,d]}const MV=ve({multiRNNCell_:pce});function mce(n,e,t,s=!1){const r=ie(n,"logits","multinomial"),a=r.size,o=r.rank;if(a<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${a}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();const c={logits:o===1?_e(r,[1,-1]):r},u={numSamples:e,seed:t,normalized:s},d=be.runKernel(Mk,c,u);return o===1?_e(d,[d.size]):d}const PV=ve({multinomial_:mce});function gce(n,e){let t=ie(n,"a","notEqual","string_or_numeric"),s=ie(e,"b","notEqual","string_or_numeric");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(r2,r)}const Rm=ve({notEqual_:gce});function yce(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:ie(n,"indices","oneHot","int32")},l={dtype:r,depth:e,onValue:t,offValue:s};return be.runKernel(a2,o,l)}const G0=ve({oneHot_:yce});function bce(n){const t={x:ie(n,"x","onesLike")};return be.runKernel(i2,t)}const Xo=ve({onesLike_:bce});function vce(n,e){const t=ie(n,"v1","outerProduct"),s=ie(e,"v2","outerProduct");ee(t.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${s.rank}.`);const r=_e(t,[-1,1]),a=_e(s,[1,-1]);return Ln(r,a)}const zV=ve({outerProduct_:vce});function wce(n,e,t=0){const s=ie(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},a={x:s};return be.runKernel(l2,a,r)}const Ld=ve({pad_:wce});function xce(n,e,t=0){return ee(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Ld(n,[e],t)}const BV=ve({pad1d_:xce});function Sce(n,e,t=0){return ee(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ld(n,e,t)}const jV=ve({pad2d_:Sce});function Cce(n,e,t=0){return ee(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ld(n,e,t)}const UV=ve({pad3d_:Cce});function _ce(n,e,t=0){return ee(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ld(n,e,t)}const VV=ve({pad4d_:_ce});function kce(n,e,t){const s=ie(n,"x","spaceToBatchND");ee(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),ee(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ee(s.shape.reduce((o,l,c)=>c>0&&c<=e.length?o&&(l+t[c-1][0]+t[c-1][1])%e[c-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},a={blockShape:e,paddings:t};return be.runKernel(b2,r,a)}const P2=ve({spaceToBatchND_:kce});function Tce(n,e,t,s,r,a,o){r==null&&(r=[1,1]),a==null&&(a=1),s===0&&(s="valid");const l=ie(n,"x","maxPool");let c=l,u=!1;l.rank===3&&(u=!0,c=_e(l,[1,l.shape[0],l.shape[1],l.shape[2]])),ee(ta(a,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${r}'`);const d=yc(c.shape,e,a,r,s),p=[d.dilationHeight,d.dilationWidth];let m;s==="same"?m=Ace([d.filterHeight,d.filterWidth],p):m=[[0,0],[0,0]];const g=p[0]===1&&p[1]===1,[b,v]=Nce([d.inHeight,d.inWidth],p,m),x=g?s:"valid",S=g?c:P2(c,p,b),A=(t==="avg"?()=>A2(S,e,a,x,o):()=>F2(S,e,a,x,o))(),k=g?A:E2(A,p,v);return u?_e(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function Nce(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),a=n.concat(s,r),o=e.map((d,p)=>(d-a[p]%d)%d),l=r.map((d,p)=>d+o[p]),c=e.map((d,p)=>[s[p],l[p]]),u=e.map((d,p)=>[0,o[p]]);return[c,u]}function Ace(n,e){const s=n.map((o,l)=>o+(o-1)*(e[l]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),a=s.map((o,l)=>o-r[l]);return s.map((o,l)=>[r[l],a[l]])}const n$=ve({pool_:Tce});function Ece(n,e){const t=ie(n,"x","prelu"),s=ie(e,"alpha","prelu"),r={x:t,alpha:s};return be.runKernel(c2,r)}const z2=ve({prelu_:Ece});function Ice(n,e=null,t=!1){let s=ie(n,"x","prod");s.dtype==="bool"&&(s=ft(s,"int32"));const r={x:s},a={axis:e,keepDims:t};return be.runKernel(u2,r,a)}const s$=ve({prod_:Ice});function Oce(n,e,t,s){const r=n.map((d,p)=>ie(d,`tensors${p}`,"raggedGather","int32")),a=ie(e,"paramsDenseValues","raggedGather"),o=ie(t,"indices","raggedGather","int32"),l={paramsNestedSplits:r,paramsDenseValues:a,indices:o},c={outputRaggedRank:s},u=be.runKernel(jk,l,c);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const WV=ve({raggedGather_:Oce});function Dce(n,e,t){const s=ie(n,"starts","raggedRange"),r=ie(e,"limits","raggedRange",s.dtype),a=ie(t,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:a},l=be.runKernel(Uk,o);return{rtNestedSplits:l[0],rtDenseValues:l[1]}}const HV=ve({raggedRange_:Dce});function $ce(n,e,t,s,r){const a=ie(n,"shape","raggedTensorToTensor","int32"),o=ie(e,"values","raggedTensorToTensor"),l=ie(t,"defaultValue","raggedTensorToTensor",o.dtype),c=s.map((p,m)=>ie(p,`tensors${m}`,"raggedTensorToTensor","int32")),u={shape:a,values:o,defaultValue:l,rowPartitionTensors:c},d={rowPartitionTypes:r};return be.runKernel(Vk,u,d)}const GV=ve({raggedTensorToTensor_:$ce});function Rce(n,e,t){Jo(n);const s=We(n);let r=null;if(t==null||t==="float32")r=new Float32Array(s);else if(t==="int32")r=new Int32Array(s);else if(t==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${t}`);for(let a=0;a<s;a++)r[a]=e();return be.makeTensor(r,n,t)}const qV=ve({rand_:Rce});var eC={exports:{}},Lce=eC.exports,Sz;function Fce(){return Sz||(Sz=1,(function(n){(function(e,t,s){function r(c){var u=this,d=l();u.next=function(){var p=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=p-(u.c=p|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(c),u.s0<0&&(u.s0+=1),u.s1-=d(c),u.s1<0&&(u.s1+=1),u.s2-=d(c),u.s2<0&&(u.s2+=1),d=null}function a(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function o(c,u){var d=new r(c),p=u&&u.state,m=d.next;return m.int32=function(){return d.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&a(p,d),m.state=function(){return a(d,{})}),m}function l(){var c=4022871197,u=function(d){d=String(d);for(var p=0;p<d.length;p++){c+=d.charCodeAt(p);var m=.02519603282416938*c;c=m>>>0,m-=c,m*=c,c=m>>>0,m-=c,c+=m*4294967296}return(c>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(Lce,n)})(eC)),eC.exports}var tC={exports:{}},Mce=tC.exports,Cz;function Pce(){return Cz||(Cz=1,(function(n){(function(e,t,s){function r(l){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var p=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^p^p>>>8},l===(l|0)?c.x=l:u+=l;for(var d=0;d<u.length+64;d++)c.x^=u.charCodeAt(d)|0,c.next()}function a(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c}function o(l,c){var u=new r(l),d=c&&c.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(m+g)/(1<<21);while(b===0);return b},p.int32=u.next,p.quick=p,d&&(typeof d=="object"&&a(d,u),p.state=function(){return a(u,{})}),p}t&&t.exports?t.exports=o:this.xor128=o})(Mce,n)})(tC)),tC.exports}var nC={exports:{}},zce=nC.exports,_z;function Bce(){return _z||(_z=1,(function(n){(function(e,t,s){function r(l){var c=this,u="";c.next=function(){var p=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(p^p<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,l===(l|0)?c.x=l:u+=l;for(var d=0;d<u.length+64;d++)c.x^=u.charCodeAt(d)|0,d==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c.v=l.v,c.d=l.d,c}function o(l,c){var u=new r(l),d=c&&c.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(m+g)/(1<<21);while(b===0);return b},p.int32=u.next,p.quick=p,d&&(typeof d=="object"&&a(d,u),p.state=function(){return a(u,{})}),p}t&&t.exports?t.exports=o:this.xorwow=o})(zce,n)})(nC)),nC.exports}var sC={exports:{}},jce=sC.exports,kz;function Uce(){return kz||(kz=1,(function(n){(function(e,t,s){function r(l){var c=this;c.next=function(){var d=c.x,p=c.i,m,g;return m=d[p],m^=m>>>7,g=m^m<<24,m=d[p+1&7],g^=m^m>>>10,m=d[p+3&7],g^=m^m>>>3,m=d[p+4&7],g^=m^m<<7,m=d[p+7&7],m=m^m<<13,g^=m^m<<9,d[p]=g,c.i=p+1&7,g};function u(d,p){var m,g=[];if(p===(p|0))g[0]=p;else for(p=""+p,m=0;m<p.length;++m)g[m&7]=g[m&7]<<15^p.charCodeAt(m)+g[m+1&7]<<13;for(;g.length<8;)g.push(0);for(m=0;m<8&&g[m]===0;++m);for(m==8?g[7]=-1:g[m],d.x=g,d.i=0,m=256;m>0;--m)d.next()}u(c,l)}function a(l,c){return c.x=l.x.slice(),c.i=l.i,c}function o(l,c){l==null&&(l=+new Date);var u=new r(l),d=c&&c.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(m+g)/(1<<21);while(b===0);return b},p.int32=u.next,p.quick=p,d&&(d.x&&a(d,u),p.state=function(){return a(u,{})}),p}t&&t.exports?t.exports=o:this.xorshift7=o})(jce,n)})(sC)),sC.exports}var rC={exports:{}},Vce=rC.exports,Tz;function Wce(){return Tz||(Tz=1,(function(n){(function(e,t,s){function r(l){var c=this;c.next=function(){var d=c.w,p=c.X,m=c.i,g,b;return c.w=d=d+1640531527|0,b=p[m+34&127],g=p[m=m+1&127],b^=b<<13,g^=g<<17,b^=b>>>15,g^=g>>>12,b=p[m]=b^g,c.i=m,b+(d^d>>>16)|0};function u(d,p){var m,g,b,v,x,S=[],C=128;for(p===(p|0)?(g=p,p=null):(p=p+"\0",g=0,C=Math.max(C,p.length)),b=0,v=-32;v<C;++v)p&&(g^=p.charCodeAt((v+32)%p.length)),v===0&&(x=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,v>=0&&(x=x+1640531527|0,m=S[v&127]^=g+x,b=m==0?b+1:0);for(b>=128&&(S[(p&&p.length||0)&127]=-1),b=127,v=512;v>0;--v)g=S[b+34&127],m=S[b=b+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,S[b]=g^m;d.w=x,d.X=S,d.i=b}u(c,l)}function a(l,c){return c.i=l.i,c.w=l.w,c.X=l.X.slice(),c}function o(l,c){l==null&&(l=+new Date);var u=new r(l),d=c&&c.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(m+g)/(1<<21);while(b===0);return b},p.int32=u.next,p.quick=p,d&&(d.X&&a(d,u),p.state=function(){return a(u,{})}),p}t&&t.exports?t.exports=o:this.xor4096=o})(Vce,n)})(rC)),rC.exports}var iC={exports:{}},Hce=iC.exports,Nz;function Gce(){return Nz||(Nz=1,(function(n){(function(e,t,s){function r(l){var c=this,u="";c.next=function(){var p=c.b,m=c.c,g=c.d,b=c.a;return p=p<<25^p>>>7^m,m=m-g|0,g=g<<24^g>>>8^b,b=b-p|0,c.b=p=p<<20^p>>>12^m,c.c=m=m-g|0,c.d=g<<16^m>>>16^b,c.a=b-p|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,l===Math.floor(l)?(c.a=l/4294967296|0,c.b=l|0):u+=l;for(var d=0;d<u.length+20;d++)c.b^=u.charCodeAt(d)|0,c.next()}function a(l,c){return c.a=l.a,c.b=l.b,c.c=l.c,c.d=l.d,c}function o(l,c){var u=new r(l),d=c&&c.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(m+g)/(1<<21);while(b===0);return b},p.int32=u.next,p.quick=p,d&&(typeof d=="object"&&a(d,u),p.state=function(){return a(u,{})}),p}t&&t.exports?t.exports=o:this.tychei=o})(Hce,n)})(iC)),iC.exports}var aC={exports:{}};const qce={},Xce=Object.freeze(Object.defineProperty({__proto__:null,default:qce},Symbol.toStringTag,{value:"Module"})),Yce=aK(Xce);var Kce=aC.exports,Az;function Zce(){return Az||(Az=1,(function(n){(function(e,t,s){var r=256,a=6,o=52,l="random",c=s.pow(r,a),u=s.pow(2,o),d=u*2,p=r-1,m;function g(k,O,F){var $=[];O=O==!0?{entropy:!0}:O||{};var M=S(x(O.entropy?[k,A(t)]:k??C(),3),$),R=new b($),z=function(){for(var I=R.g(a),j=c,H=0;I<u;)I=(I+H)*r,j*=r,H=R.g(1);for(;I>=d;)I/=2,j/=2,H>>>=1;return(I+H)/j};return z.int32=function(){return R.g(4)|0},z.quick=function(){return R.g(4)/4294967296},z.double=z,S(A(R.S),t),(O.pass||F||function(I,j,H,q){return q&&(q.S&&v(q,R),I.state=function(){return v(R,{})}),H?(s[l]=I,j):I})(z,M,"global"in O?O.global:this==s,O.state)}function b(k){var O,F=k.length,$=this,M=0,R=$.i=$.j=0,z=$.S=[];for(F||(k=[F++]);M<r;)z[M]=M++;for(M=0;M<r;M++)z[M]=z[R=p&R+k[M%F]+(O=z[M])],z[R]=O;($.g=function(I){for(var j,H=0,q=$.i,re=$.j,X=$.S;I--;)j=X[q=p&q+1],H=H*r+X[p&(X[q]=X[re=p&re+j])+(X[re]=j)];return $.i=q,$.j=re,H})(r)}function v(k,O){return O.i=k.i,O.j=k.j,O.S=k.S.slice(),O}function x(k,O){var F=[],$=typeof k,M;if(O&&$=="object")for(M in k)try{F.push(x(k[M],O-1))}catch{}return F.length?F:$=="string"?k:k+"\0"}function S(k,O){for(var F=k+"",$,M=0;M<F.length;)O[p&M]=p&($^=O[p&M]*19)+F.charCodeAt(M++);return A(O)}function C(){try{var k;return m&&(k=m.randomBytes)?k=k(r):(k=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(k)),A(k)}catch{var O=e.navigator,F=O&&O.plugins;return[+new Date,e,F,e.screen,A(t)]}}function A(k){return String.fromCharCode.apply(0,k)}if(S(s.random(),t),n.exports){n.exports=g;try{m=Yce}catch{}}else s["seed"+l]=g})(typeof self<"u"?self:Kce,[],Math)})(aC)),aC.exports}var G5,Ez;function Jce(){if(Ez)return G5;Ez=1;var n=Fce(),e=Pce(),t=Bce(),s=Uce(),r=Wce(),a=Gce(),o=Zce();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=a,G5=o,G5}var vy=Jce();const Qce=.001,XV=.1;function eue(n,e,t){return t==null&&(t=r$()),aI(n,e,(s,r)=>i$(s,r,t))}function r$(){return be.backend.floatPrecision()===32?Qce:XV}function aI(n,e,t){let s=!0;if((di(n)||di(e))&&(s=!1),di(n)&&di(e)&&(s=!0),s){const o=n.constructor.name,l=e.constructor.name;if(o!==l)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${l}`)}if(Array.isArray(n)&&Array.isArray(e)){const o=wh(n),l=wh(e);if(!jn(o,l))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${l}]`)}const r=di(n)?n:vh(n),a=di(e)?e:vh(e);if(r.length!==a.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${a.length}.
Actual:   ${r}.
Expected: ${a}.`);for(let o=0;o<a.length;++o){const l=r[o],c=a[o];if(!t(l,c))throw new Error(`Arrays differ: actual[${o}] = ${l}, expected[${o}] = ${c}.
Actual:   ${r}.
Expected: ${a}.`)}typeof expect<"u"&&expect().nothing()}function tue(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function nue(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return ih(n)||ih(n[0])||ih(e)||ih(e[0])?aI(n,t,(s,r)=>s==r):aI(n,e,(s,r)=>i$(s,r,0))}function sue(n,e,t){if(t==null&&(t=r$()),!i$(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function i$(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function rue(n,e,t){for(let s=0;s<n.length;s++)if(n[s]<e||n[s]>t)throw new Error(`Value out of range:${n[s]} low: ${e}, high: ${t}`)}function iue(n,e){const t=new Float32Array(n),s=new Float32Array(e);if(t.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${t.length}`);for(let r=0;r<s.length;r++)if(t[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${t[r]} instead`)}function YV(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?YV(t):n[e]=ch(t)}return n}function aue(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",s=>t(e)),e.load()})}async function oue(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const lue=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:XV,createVideoElement:aue,encodeStrings:YV,expectArrayBuffersEqual:iue,expectArraysClose:eue,expectArraysEqual:nue,expectNumbersClose:sue,expectPromiseToFail:tue,expectValuesInRange:rue,play:oue,testEpsilon:r$},Symbol.toStringTag,{value:"Module"}));class a${constructor(e,t,s,r,a){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=a||Math.random();this.random=vy.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,a,o;do r=2*this.random()-1,a=2*this.random()-1,o=r*r+a*a;while(o>=1||o===0);const l=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*l,t=this.mean+this.stdDev*a*l,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class cue{constructor(e,t,s,r){this.alpha=e,this.beta=1/t,this.dtype=s;const a=r||Math.random();this.randu=vy.alea(a.toString()),this.randn=new a$(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,s,r,a,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,t=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),a=this.randu(),a<t||Math.log(a)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class uue{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=vy.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}function hue(n,e,t=1,s="float32",r){if(Jo(n),t==null&&(t=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const a=new cue(e,t,s,r),o=Dn(n,s);for(let l=0;l<o.values.length;l++)o.values[l]=a.nextValue();return o.toTensor()}const KV=ve({randomGamma_:hue});function due(n,e=0,t=1,s,r){if(Jo(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const a=new a$(e,t,s,!1,r),o=Dn(n,s);for(let l=0;l<o.values.length;l++)o.values[l]=a.nextValue();return o.toTensor()}const kT=ve({randomNormal_:due});function fue(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return kT(n,0,1,e,t)}const ZV=ve({randomStandardNormal_:fue});function pue(n,e=0,t=1,s="float32",r){Jo(n);const a=Dn(n,s),o=new uue(e,t,null,r);for(let l=0;l<a.values.length;l++)a.values[l]=o.nextValue();return a.toTensor()}const op=ve({randomUniform_:pue});function mue(n,e,t,s){return op(n,e,t,"int32",s)}const JV=ve({randomUniformInt_:mue});function Lm(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return be.runKernel(Wk,{},r)}function gue(n){const t={input:ie(n,"input","real")};return be.runKernel(Hk,t)}const q0=ve({real_:gue});function yue(n){const t={x:ie(n,"x","reciprocal")};return be.runKernel(Y1,t)}const o$=ve({reciprocal_:yue});function bue(n){const t={x:ie(n,"x","relu")};return be.runKernel(K1,t)}const Cu=ve({relu_:bue});function vue(n){const t={x:ie(n,"x","relu6")};return be.runKernel(Z1,t)}const TT=ve({relu6_:vue});function wue(n,e){const s={x:ie(n,"x","reverse")},r={dims:e};return be.runKernel(p2,s,r)}const Rl=ve({reverse_:wue});function xue(n){const e=ie(n,"x","reverse");return ee(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Rl(e,0)}const QV=ve({reverse1d_:xue});function Sue(n,e){const t=ie(n,"x","reverse");return ee(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Rl(t,e)}const e3=ve({reverse2d_:Sue});function Cue(n,e){const t=ie(n,"x","reverse");return ee(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Rl(t,e)}const t3=ve({reverse3d_:Cue});function _ue(n,e){const t=ie(n,"x","reverse");return ee(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Rl(t,e)}const n3=ve({reverse4d_:_ue});function kue(n){const t={x:ie(n,"x","round")};return be.runKernel(J1,t)}const NT=ve({round_:kue});function Tue(n){const t={x:ie(n,"x","rsqrt","float32")};return be.runKernel(Q1,t)}const AT=ve({rsqrt_:Tue});function Nue(n){const t={x:ie(n,"x","selu")};return be.runKernel(ey,t)}const ET=ve({selu_:Nue});function Aue(n,e,t,s,r,a=[1,1],o="NHWC"){const l=ie(n,"x","separableConv2d"),c=ie(e,"depthwiseFilter","separableConv2d"),u=ie(t,"pointwiseFilter","separableConv2d");let d=l,p=!1;if(l.rank===3&&(p=!0,d=_e(l,[1,l.shape[0],l.shape[1],l.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ee(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),ee(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),ee(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),ee(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),ee(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const m=c.shape[2],g=c.shape[3];ee(u.shape[2]===m*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*g}, but got ${u.shape[2]}.`);const b=py(d,c,s,r,o,a),x=Cd(b,u,1,"valid",o);return p?_e(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const IT=ve({separableConv2d_:Aue});async function Eue(n,e){const t=ie(n,"x","setdiff1d"),s=ie(e,"y","setdiff1d");ee(t.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${s.dtype}).`),ee(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),ee(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await t.data(),a=await s.data(),o=new Set(a);let l=0;for(let d=0;d<r.length;d++)o.has(r[d])||l++;const c=new ni([l],t.dtype),u=new ni([l],"int32");for(let d=0,p=0;d<r.length;d++)o.has(r[d])||(c.values[p]=r[d],u.values[p]=d,p++);return[c.toTensor(),u.toTensor()]}const s3=Eue;function Iue(n){const t={x:ie(n,"x","sign")};return be.runKernel(sy,t)}const l$=ve({sign_:Iue});function Oue(n){const t={x:ie(n,"x","sin","float32")};return be.runKernel(ty,t)}const OT=ve({sin_:Oue});function Due(n){const t={x:ie(n,"x","sinh")};return be.runKernel(ny,t)}const DT=ve({sinh_:Due});function $ue(n,e,t){const s=ie(n,"x","slice1d");return ee(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Xn(s,[e],[t])}const B2=ve({slice1d_:$ue});function Rue(n,e,t){const s=ie(n,"x","slice2d");return ee(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Xn(s,e,t)}const $T=ve({slice2d_:Rue});function Lue(n,e,t){const s=ie(n,"x","slice3d");return ee(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Xn(s,e,t)}const j2=ve({slice3d_:Lue});function Fue(n,e,t){const s=ie(n,"x","slice4d");return ee(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Xn(s,e,t)}const X0=ve({slice4d_:Fue});function Mue(n,e=-1){const t=ie(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return be.runKernel(w2,s,r)}const U2=ve({softmax_:Mue});function Pue(n){ee(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return be.runKernel(Tk,e)}const V2=ve({fft_:Pue});function zue(n){ee(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return be.runKernel(Ik,e)}const Y0=ve({ifft_:zue});function Bue(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=_e(n,[t,e]);s=Y0(r)}else{const r=[t,2*(e-1)],a=_e(q0(n),[t,e]),o=_e(O2(n),[t,e]),l=Rl(Xn(a,[0,1],[t,e-2]),1),c=Se(Rl(Xn(o,[0,1],[t,e-2]),1),Xt(-1)),u=Pr([a,l],1),d=Pr([o,c],1),p=_e(Sd(u,d),[r[0],r[1]]);s=Y0(p)}if(s=q0(s),n.rank===3&&n.shape[0]!==0){const r=s,a=n.shape[0];s=_e(s,[a,s.shape[0]/a,s.shape[1]]),r.dispose()}return s}const RT=ve({irfft_:Bue});function jue(n,e,t=0){const r={x:ie(n,"x","split")},a={numOrSizeSplits:e,axis:t};return be.runKernel(v2,r,a)}const ro=ve({split_:jue});function Uue(n,e){ee(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const b=n.shape.map(x=>0),v=n.shape.map(x=>x);v[n.shape.length-1]=e,r=Xn(n,b,v),t=e}else if(e!=null&&e>t){const b=n.shape.map(v=>v);b[n.shape.length-1]=e-t,r=Pr([n,Qr(b)],n.shape.length-1),t=e}else r=n;const a=Kn(r),o=_e(Sd(r,a),[s,t]),l=V2(o),c=Math.floor(t/2)+1,u=q0(l),d=O2(l),p=ro(u,[c,t-c],u.shape.length-1),m=ro(d,[c,t-c],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=c,_e(Sd(p[0],m[0]),g)}const W2=ve({rfft_:Uue});function Vue(n,e){let t=ie(n,"a","squaredDifference"),s=ie(e,"b","squaredDifference");[t,s]=gr(t,s),Sn(t.shape,s.shape);const r={a:t,b:s},a={};return be.runKernel(oy,r,a)}const LT=ve({squaredDifference_:Vue});function Wue(n,e){const t=ie(n,"x","squeeze","string_or_numeric");return _e(t,Id(t.shape,e).newShape)}const lp=ve({squeeze_:Wue});function Hue(n,e=0){const t=Lv(n,"tensors","stack","string_or_numeric");ee(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ee(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return be.runKernel(o2,s,r)}const Ra=ve({stack_:Hue});function Gue(n,e=0){const s={x:ie(n,"x","step")},r={alpha:e};return be.runKernel(dy,s,r)}const og=ve({step_:Gue});function que(n,e,t,s,r=0,a=0,o=0,l=0,c=0){const d={x:ie(n,"x","stridedSlice","string_or_numeric")},p={begin:e,end:t,strides:s,beginMask:r,endMask:a,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:c};return be.runKernel(sT,d,p)}const c$=ve({stridedSlice_:que});function Xue(n){const t={x:ie(n,"x","tan","float32")};return be.runKernel(cy,t)}const u$=ve({tan_:Xue});function Ki(n,e){tg(n);const t=wh(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return sp(n,null,t,e)}function Pf(n,e,t){if(tg(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=wh(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return sp(n,e,s,t)}function h$(n,e,t){if(tg(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=wh(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return sp(n,e,s,t)}function r3(n,e,t){if(tg(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=wh(n,t);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return sp(n,e,s,t)}function i3(n,e,t){if(tg(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=wh(n,t);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return sp(n,e,s,t)}function a3(n,e,t){if(tg(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=wh(n,t);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,sp(n,e,s,t)}function d$(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(a+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(a+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(a+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(a+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(a+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function FT(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}d$(t,e,n)}function cp(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,a=t.length;let o=1;for(let p=r;p<a;++p)o*=t[p];const l=r<1?1:r,c=We(e.shape)/l,u=[...Ht(t.slice(0,r)),1],d=We(t);return{sliceRank:r,numUpdates:c,sliceSize:o,strides:u,outputSize:d}}const Yue=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:cp,validateInput:FT,validateUpdateShape:d$},Symbol.toStringTag,{value:"Module"}));function Kue(n,e,t){const s=ie(n,"tensor","tensorScatterupdate"),r=ie(e,"indices","tensorScatterupdate","int32"),a=ie(t,"updates","tensorScatterupdate");if(FT(a,r,s.shape),s.dtype!==a.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${a.dtype}.`);const o={tensor:s,indices:r,updates:a},l={};return be.runKernel(Yk,o,l)}const o3=ve({tensorScatterUpdate_:Kue});function Zue(n,e=1,t=!0){const s=ie(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const a={x:s},o={k:e,sorted:t},[l,c]=be.runKernel(oT,a,o);return{values:l,indices:c}}const f$=ve({topk_:Zue});function Jue(n,e=0,t=1,s,r){if(Jo(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const a=new a$(e,t,s,!0,r),o=Dn(n,s);for(let l=0;l<o.values.length;l++)o.values[l]=a.nextValue();return o.toTensor()}const MT=ve({truncatedNormal_:Jue});function Que(n,e=0){const t=ie(n,"x","unique","string_or_numeric");ee(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[a,o]=be.runKernel(cT,s,r);return{values:a,indices:o}}const p$=ve({unique_:Que});function ehe(n,e,t){const s=ie(n,"x","unsortedSegmentSum"),r=ie(e,"segmentIds","unsortedSegmentSum","int32");ee(Nm(t),()=>"numSegments must be of dtype int");const a={x:s,segmentIds:r},o={numSegments:t};return be.runKernel(C2,a,o)}const PT=ve({unsortedSegmentSum_:ehe});function the(n,e=0){const t=ie(n,"x","unstack","string_or_numeric");ee(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return be.runKernel(S2,s,r)}const Ll=ve({unstack_:the});function l3(n,e){return _T(n,e,"right")}function m$(n,e=!0,t,s){return be.makeVariable(n,e,t,s)}function zT(n,e){const t=[];for(let a=0;a<e.length;a++)e[a]&&t.push(a);const s=Dn(n,"int32"),r=Dn([t.length,n.length],"int32");for(let a=0;a<t.length;a++){const o=s.indexToLoc(t[a]),l=a*n.length;r.values.set(o,l)}return r.toTensor()}async function nhe(n){const e=ie(n,"condition","whereAsync","bool"),t=await e.data(),s=zT(e.shape,t);return n!==e&&e.dispose(),s}const g$=nhe;async function she(n,e,t){const s=ie(n,"tensor","boolMask"),r=ie(e,"mask","boolMask","bool"),a=t??0,o=r.rank,l=s.shape;ee(o>0,()=>"mask cannot be scalar"),ea(l.slice(a,a+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let c=1;for(let v=a;v<a+o;v++)c*=l[v];const u=l.slice(0,a).concat([c],l.slice(a+o)),d=_e(s,u),p=_e(r,[-1]),m=await g$(p),g=lp(m,[1]),b=by(d,g,a);return n!==s&&s.dispose(),e!==r&&r.dispose(),g.dispose(),d.dispose(),p.dispose(),m.dispose(),b}const c3=she;function rhe(n,e,t){const s=ie(n,"x","transpose");if(e==null&&(e=s.shape.map((o,l)=>l).reverse()),ee(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{ee(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},a={perm:e};return s.dtype==="complex64"?Le(()=>{let o=q0(s),l=O2(s);return o=be.runKernel(mm,{x:o},a),l=be.runKernel(mm,{x:l},a),t&&(l=Gs(l)),Sd(o,l)}):be.runKernel(mm,r,a)}const Wn=ve({transpose_:rhe});function ihe(n,e,t,s,r=!0){const a=ie(n,"v","movingAverage"),o=ie(e,"x","movingAverage"),l=ie(t,"decay","movingAverage");oV(a,o),ee(jn(a.shape,o.shape),()=>"Shape mismatch in v and x");const c=Xt(1),u=St(c,l);let d=Se(St(o,a),u);if(r){ee(s!=null,()=>"When using zeroDebias: true, step is required.");const p=ie(s,"step","movingAverage");d=Bt(d,St(c,_d(l,p)))}return at(a,d)}const u3=ve({movingAverage_:ihe});function ahe(n,e,t){Jo(t);const s=ie(n,"indices","scatterND","int32"),r=ie(e,"updates","scatterND");FT(r,s,t);const a={indices:s,updates:r},o={shape:t};return be.runKernel(Xk,a,o)}const h3=ve({scatterND_:ahe});function ohe(n,e,t,s){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const r=n.rank>0?n.shape[0]:1,a=n.rank>1?n.shape[1]:1;if(t.length!==a)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${a}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function lhe(n,e,t,s=0){Jo(t);const r=ie(n,"sparseIndices","sparseToDense","int32"),a=ie(e,"sparseValues","sparseToDense","string_or_numeric"),o=ie(s,"defaultValue","sparseToDense",a.dtype);ohe(r,a,t,o);const l={sparseIndices:r,sparseValues:a,defaultValue:o},c={outputShape:t};return be.runKernel(tT,l,c)}const d3=ve({sparseToDense_:lhe});function che(n,e){const t=ie(e,"indices","gatherND","int32"),r={params:ie(n,"x","gatherND","string_or_numeric"),indices:t};return be.runKernel(Ek,r)}const f3=ve({gatherND_:che});function uhe(n,e){if(e==null)return n.shape.slice();if(jn(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}function hhe(n,e,t,s){const r=ie(n,"x","dropout");if(ee(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),ee(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Yn?r.clone():r;const a=uhe(r,t),o=1-e,l=Bt(yy(at(op(a,0,1,"float32",s),o)),o);return Se(r,l)}const y$=ve({dropout_:hhe});function b$(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function BT(n,e,t){const s=1-n%2,r=new Float32Array(n);for(let a=0;a<n;++a){const o=2*Math.PI*a/(n+s-1);r[a]=e-t*Math.cos(o)}return Ki(r,"float32")}async function dhe(n,e,t=1){const s=ie(n,"predictions","inTopK"),r=ie(e,"targets","inTopK");ee(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),ee(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),ea(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=s.shape[s.shape.length-1];ee(t>0&&t<=a,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${a}), but got ${t}`);const o=await s.data(),l=await r.data(),[c,u]=[o.length/a,a],d=$i("bool",c);for(let p=0;p<c;p++){const m=p*u,g=o.subarray(m,m+u),b=[];for(let v=0;v<g.length;v++)b.push({value:g[v],index:v});b.sort((v,x)=>x.value-v.value),d[p]=0;for(let v=0;v<t;v++)if(b[v].index===l[p]){d[p]=1;break}}return n!==s&&s.dispose(),e!==r&&r.dispose(),Wo(d,r.shape,"bool")}const p3=dhe;function fhe(n,e,t,s,r,a="NHWC",o){let l=n;n.rank===3&&(l=_e(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ee(l.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`),ee(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),ee(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=a==="NHWC"?l.shape[3]:l.shape[1],d=a==="NHWC"?c.shape[3]:c.shape[1];ee(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),ee(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Fa("conv2dDerFilter",r,o);const p={x:l,dy:c},m={strides:s,pad:r,dataFormat:a,dimRoundingMode:o,filterShape:t};return be.runKernel(fk,p,m)}const v$=ve({conv2DBackpropFilter_:fhe});function jT(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Se(n,og(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function UT(n,e){let t=e;const s=si(n.shape,e.shape);return s.length>0&&(t=It(t,s)),_e(t,n.shape)}function VT(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Cu(n);if(e==="elu")return my(n);if(e==="relu6")return TT(n);if(e==="prelu")return z2(n,t);if(e==="leakyrelu")return D2(n,s);if(e==="sigmoid")return lu(n);throw new Error(`Unknown fused activation ${e}.`)}const WT=(n,e)=>!(n>0)||e==="linear";function phe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(c=c||"linear",WT(be.state.gradientDepth,c)===!1){ee(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let F=Cd(n,e,t,s,r,a,o);return l!=null&&(F=at(F,l)),VT(F,c,u,d)}const p=ie(n,"x","conv2d","float32"),m=ie(e,"filter","conv2d","float32");let g=p,b=!1;p.rank===3&&(b=!0,g=_e(p,[1,p.shape[0],p.shape[1],p.shape[2]])),ee(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),ee(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Fa("fused conv2d",s,o);const v=r==="NHWC"?g.shape[3]:g.shape[1];ee(m.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${m.shape[2]}.`),ee(ta(t,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`);const x=Li(g.shape,m.shape,t,a,s,o);let S;l!=null&&(S=ie(l,"bias","fused conv2d"),[S]=gr(S,p),r==="NHWC"?Sn(x.outShape,S.shape):(ee(S.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${S.shape.length}.`),ee(S.shape.length===0||S.shape[0]===x.outChannels||S.shape[0]===1,()=>`Error in fused conv2d: bias shape (${S.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let C;if(u!=null){const F=u.shape;if(ee(F.length<=1||F.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${F.length}.`),F.length===1)ee(F[0]===1||F[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${F}) is not compatible with the number of output channels (${x.outChannels}).`);else if(F.length===3)try{Sn(F,x.outShape)}catch{const M=`Error in fused conv2d: PReLU activation weights (${F}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(M)}C=ie(u,"prelu weights","fused conv2d")}const A=(F,$)=>{ee(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[M,R,z,I]=$,j=jT(F,z,c);ee(Gf(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const H=FD(R.shape,j,M,t,s),q=v$(R,j,M.shape,t,s),re=[H,q];if(I!=null){const X=UT(I,j);re.push(X)}return re},k={x:g,filter:m,bias:S,preluActivationWeights:C},O={strides:t,pad:s,dataFormat:r,dilations:a,dimRoundingMode:o,activation:c,leakyreluAlpha:d};return l==null?xh(($,M,R)=>{let z=be.runKernel(Iv,k,O);return R([M,$,z]),b&&(z=_e(z,[z.shape[1],z.shape[2],z.shape[3]])),{value:z,gradFunc:A}})(g,m):xh(($,M,R,z)=>{let I=be.runKernel(Iv,k,O);return z([M,$,I,R]),b&&(I=_e(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:A}})(g,m,S)}const m3=ve({fusedConv2d_:phe});function mhe(n,e,t,s,r,a=[1,1],o){let l=n;n.rank===3&&(l=_e(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:l,dy:c},d={strides:s,pad:r,dimRoundingMode:o,dilations:a,filterShape:t};return be.runKernel(wk,u,d)}const g3=ve({depthwiseConv2dNativeBackpropFilter_:mhe});function ghe(n,e,t,s,r,a=[1,1],o){let l=e,c=!1;e.rank===3&&(c=!0,l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:l,filter:t},d={strides:s,pad:r,dimRoundingMode:o,dilations:a,inputShape:n},p=be.runKernel(xk,u,d);return c?_e(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const y3=ve({depthwiseConv2dNativeBackpropInput_:ghe});function yhe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(WT(be.state.gradientDepth,c)===!1){let O=py(n,e,t,s,r,a,o);return l!=null&&(O=at(O,l)),VT(O,c,u,d)}const p=ie(n,"x","depthwiseConv2d","float32"),m=ie(e,"filter","depthwiseConv2d","float32");let g=p,b=!1;p.rank===3&&(b=!0,g=_e(p,[1,p.shape[0],p.shape[1],p.shape[2]])),ee(g.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`),ee(m.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${m.rank}.`),ee(g.shape[3]===m.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${g.shape[3]}) must match the inChannels dimension in filter ${m.shape[2]}.`),a==null&&(a=[1,1]),ee(ta(t,a),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),Fa("fused depthwiseConv2d",s,o);const v=Li(g.shape,m.shape,t,a,s,o,!0);let x;l!=null&&(x=ie(l,"bias","fused conv2d"),[x]=gr(x,p),Sn(v.outShape,x.shape));let S;u!=null&&(S=ie(u,"prelu weights","fused depthwiseConv2d"));const C=(O,F)=>{ee(Gf(a),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[$,M,R,z]=F,I=jT(O,R,c),j=y3(M.shape,I,$,t,s,a,o),H=g3(M,I,$.shape,t,s,a,o);if(z!=null){const q=UT(x,I);return[j,H,q]}return[j,H]},A={x:g,filter:m,bias:x,preluActivationWeights:S},k={strides:t,pad:s,dataFormat:r,dilations:a,dimRoundingMode:o,activation:c,leakyreluAlpha:d};return l==null?xh((F,$,M)=>{let R=be.runKernel(Ov,A,k);return M([$,F,R]),b&&(R=_e(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:C}})(g,m):xh((F,$,M,R)=>{let z=be.runKernel(Ov,A,k);return R([$,F,z,M]),b&&(z=_e(z,[z.shape[1],z.shape[2],z.shape[3]])),{value:z,gradFunc:C}})(g,m,x)}const bhe=ve({fusedDepthwiseConv2d_:yhe});function vhe({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:a="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}){if(WT(be.state.gradientDepth,a)===!1){let I=Ln(n,e,t,s);return r!=null&&(I=at(I,r)),VT(I,a,o,l)}let c=ie(n,"a","fused matMul"),u=ie(e,"b","fused matMul");[c,u]=gr(c,u);const d=t?c.shape[c.rank-2]:c.shape[c.rank-1],p=s?u.shape[u.rank-1]:u.shape[u.rank-2],m=t?c.shape[c.rank-1]:c.shape[c.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],b=c.shape.slice(0,-2),v=u.shape.slice(0,-2),x=We(b),S=We(v);ee(d===p,()=>`Error in fused matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${c.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const A=Sn(c.shape.slice(0,-2),u.shape.slice(0,-2)).concat([m,g]),k=t?_e(c,[x,d,m]):_e(c,[x,m,d]),O=s?_e(u,[S,g,p]):_e(u,[S,p,g]);let F;r!=null&&(F=ie(r,"bias","fused matMul"),[F]=gr(F,c),Sn(A,F.shape));let $;o!=null&&($=ie(o,"prelu weights","fused matMul"));const M=(I,j)=>{const[H,q,re,X]=j,ne=jT(_e(I,re.shape),re,a);let Q,he;if(!t&&!s?(Q=Ln(ne,q,!1,!0),he=Ln(H,ne,!0,!1)):!t&&s?(Q=Ln(ne,q,!1,!1),he=Ln(ne,H,!0,!1)):t&&!s?(Q=Ln(q,ne,!1,!0),he=Ln(H,ne,!1,!1)):(Q=Ln(q,ne,!0,!0),he=Ln(ne,H,!0,!0)),r!=null){const ye=UT(X,ne);return[Q,he,ye]}else return[Q,he]},R={a:k,b:O,bias:F,preluActivationWeights:$},z={transposeA:t,transposeB:s,activation:a,leakyreluAlpha:l};return r==null?xh((j,H,q)=>{const re=be.runKernel(Ev,R,z);return q([j,H,re]),{value:_e(re,A),gradFunc:M}})(k,O):xh((j,H,q,re)=>{const X=be.runKernel(Ev,R,z);return re([j,H,X,q]),{value:_e(X,A),gradFunc:M}})(k,O,F)}const oI=ve({fusedMatMul_:vhe});const b3=Object.freeze(Object.defineProperty({__proto__:null,conv2d:m3,depthwiseConv2d:bhe,matMul:oI},Symbol.toStringTag,{value:"Module"}));function whe(n){return BT(n,.54,.46)}const xhe=ve({hammingWindow_:whe});function She(n){return BT(n,.5,.5)}const v3=ve({hannWindow_:She});function Che(n,e,t,s=!1,r=0){let a=0;const o=[];for(;a+e<=n.size;)o.push(Xn(n,a,e)),a+=t;if(s)for(;a<n.size;){const l=a+e-n.size,c=Pr([Xn(n,a,e-l),ig([l],r)]);o.push(c),a+=t}return o.length===0?Pf([],[0,e]):_e(Pr(o),[o.length,e])}const w3=ve({frame_:Che});function _he(n,e,t,s,r=v3){s==null&&(s=b$(e));const a=w3(n,e,t),o=Se(a,r(e));return W2(o,s)}const khe=ve({stft_:_he});function The(n,e,t,s,r="bilinear",a=0){const o=ie(n,"image","cropAndResize"),l=ie(e,"boxes","cropAndResize","float32"),c=ie(t,"boxInd","cropAndResize","int32"),u=l.shape[0];ee(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),ee(l.rank===2&&l.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${l.shape}.`),ee(c.rank===1&&c.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${l.shape}.`),ee(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),ee(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),ee(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:l,boxInd:c},p={method:r,extrapolationValue:a,cropSize:s};return be.runKernel(yk,d,p)}const Nhe=ve({cropAndResize_:The});function Ahe(n){const e=ie(n,"image","flipLeftRight","float32");ee(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return be.runKernel(Ak,t,{})}const Ehe=ve({flipLeftRight_:Ahe});function Ihe(n){const e=ie(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];ee(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),ee(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,kl(e,r)}const Ohe=ve({grayscaleToRGB_:Ihe});function Dhe(n){const e=ie(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];ee(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),ee(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,a=ft(e,"float32"),o=Ki([.2989,.587,.114]);let l;switch(e.rank){case 2:l=tm("ij,j->i",a,o);break;case 3:l=tm("ijk,k->ij",a,o);break;case 4:l=tm("ijkl,l->ijk",a,o);break;case 5:l=tm("ijklm,m->ijkl",a,o);break;case 6:l=tm("ijklmn,n->ijklm",a,o);break;default:throw new Error("Not a valid tensor rank.")}return l=qi(l,-1),ft(l,r)}const $he=ve({rgbToGrayscale_:Dhe});function Rhe(n,e,t=0,s=.5){const r=ie(n,"image","rotateWithOffset","float32");ee(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const a={image:r},o={radians:e,fillValue:t,center:s};return be.runKernel(uT,a,o)}const Lhe=ve({rotateWithOffset_:Rhe});function wy(n,e,t,s,r,a){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),a==null&&(a=0);const o=n.shape[0];return t=Math.min(t,o),ee(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),ee(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),ee(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),ee(e.rank===1,()=>"scores must be a 1D tensor"),ee(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),ee(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:a}}function Fhe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const a=ie(n,"boxes","nonMaxSuppression","float32"),o=ie(e,"scores","nonMaxSuppression","float32"),l=wy(a,o,t,s,r);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold;const c={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return be.runKernel(Pk,{boxes:a,scores:o},c)}const Mhe=ve({nonMaxSuppression_:Fhe});function Phe(n,e,t){const s=zhe(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function zhe(n,e,t){return jhe(n,e,t||Bhe)}function Bhe(n,e){return n>e?1:n<e?-1:0}function jhe(n,e,t){let s=0,r=n.length,a=0,o=!1;for(;s<r;){a=s+(r-s>>>1);const l=t(e,n[a]);l>0?s=a+1:(r=a,o=!l)}return o?s:-s-1}function HT(n,e,t,s,r){return w$(n,e,t,s,r,0)}function GT(n,e,t,s,r,a){return w$(n,e,t,s,r,0,!1,a,!0)}function qT(n,e,t,s,r,a){return w$(n,e,t,s,r,a,!0)}function w$(n,e,t,s,r,a,o=!1,l=!1,c=!1){const u=[];for(let x=0;x<e.length;x++)e[x]>r&&u.push({score:e[x],boxIndex:x,suppressBeginIndex:0});u.sort(Iz);const d=a>0?-.5/a:0,p=[],m=[];for(;p.length<t&&u.length>0;){const x=u.pop(),{score:S,boxIndex:C,suppressBeginIndex:A}=x;if(S<r)break;let k=!1;for(let O=p.length-1;O>=A;--O){const F=Uhe(n,C,p[O]);if(F>=s){k=!0;break}if(x.score=x.score*Vhe(s,d,F),x.score<=r)break}x.suppressBeginIndex=p.length,k||(x.score===S?(p.push(C),m.push(x.score)):x.score>r&&Phe(u,x,Iz))}const g=p.length,b=t-g;l&&b>0&&(p.push(...new Array(b).fill(0)),m.push(...new Array(b).fill(0)));const v={selectedIndices:p};return o&&(v.selectedScores=m),c&&(v.validOutputs=g),v}function Uhe(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),a=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),l=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),p=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),g=(l-a)*(c-o),b=(p-u)*(m-d);if(g<=0||b<=0)return 0;const v=Math.max(a,u),x=Math.max(o,d),S=Math.min(l,p),C=Math.min(c,m),A=Math.max(S-v,0)*Math.max(C-x,0);return A/(g+b-A)}function Vhe(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function Iz(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}async function Whe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const a=ie(n,"boxes","nonMaxSuppressionAsync"),o=ie(e,"scores","nonMaxSuppressionAsync"),l=wy(a,o,t,s,r);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold;const c=await Promise.all([a.data(),o.data()]),u=c[0],d=c[1],{selectedIndices:p}=HT(u,d,t,s,r);return a!==n&&a.dispose(),o!==e&&o.dispose(),Ki(p,"int32")}const Hhe=Whe;function Ghe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,a=0){const o=ie(n,"boxes","nonMaxSuppression"),l=ie(e,"scores","nonMaxSuppression"),c=wy(o,l,t,s,r,a);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,a=c.softNmsSigma;const u={boxes:o,scores:l},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:a},p=be.runKernel(Bk,u,d);return{selectedIndices:p[0],selectedScores:p[1]}}const qhe=ve({nonMaxSuppressionWithScore_:Ghe});async function Xhe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,a=0){const o=ie(n,"boxes","nonMaxSuppressionAsync"),l=ie(e,"scores","nonMaxSuppressionAsync"),c=wy(o,l,t,s,r,a);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,a=c.softNmsSigma;const u=await Promise.all([o.data(),l.data()]),d=u[0],p=u[1],{selectedIndices:m,selectedScores:g}=qT(d,p,t,s,r,a);return o!==n&&o.dispose(),l!==e&&l.dispose(),{selectedIndices:Ki(m,"int32"),selectedScores:Ki(g)}}const Yhe=Xhe;function Khe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,a=!1){const o=ie(n,"boxes","nonMaxSuppression"),l=ie(e,"scores","nonMaxSuppression"),c=wy(o,l,t,s,r,null),u=c.maxOutputSize,d=c.iouThreshold,p=c.scoreThreshold,m={boxes:o,scores:l},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:p,padToMaxOutputSize:a},b=be.runKernel(zk,m,g);return{selectedIndices:b[0],validOutputs:b[1]}}const Zhe=ve({nonMaxSuppressionPadded_:Khe});async function Jhe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,a=!1){const o=ie(n,"boxes","nonMaxSuppressionAsync"),l=ie(e,"scores","nonMaxSuppressionAsync"),c=wy(o,l,t,s,r,null),u=c.maxOutputSize,d=c.iouThreshold,p=c.scoreThreshold,[m,g]=await Promise.all([o.data(),l.data()]),{selectedIndices:b,validOutputs:v}=GT(m,g,u,d,p,a);return o!==n&&o.dispose(),l!==e&&l.dispose(),{selectedIndices:Ki(b,"int32"),validOutputs:Xt(v,"int32")}}const Qhe=Jhe;function ede(n,e,t=!1,s=!1){const r=ie(n,"images","resizeBilinear");ee(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),ee(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ee(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=r,o=!1;r.rank===3&&(o=!0,a=_e(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:a},c={alignCorners:t,halfPixelCenters:s,size:e},u=be.runKernel(f2,l,c);return o?_e(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const x3=ve({resizeBilinear_:ede});function tde(n,e,t=!1,s=!1){const r=ie(n,"images","resizeNearestNeighbor");ee(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),ee(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ee(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ee(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=r,o=!1;r.rank===3&&(o=!0,a=_e(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:a},c={alignCorners:t,halfPixelCenters:s,size:e},u=be.runKernel(d2,l,c);return o?_e(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const S3=ve({resizeNearestNeighbor_:tde});function nde(n,e="binary",t=!1,s=.5){const r=ie(n,"image","threshold"),a=.2989,o=.587,l=.114,c=r.shape[0]*r.shape[1];let u=Se(Ki([s]),255),d,p,m,g;if(ee(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),ee(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),ee(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),ee(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,p,m]=ro(r,[1,1,1],-1);const x=Se(d,a),S=Se(p,o),C=Se(m,l);g=at(at(x,S),C)}else g=n;if(e==="otsu"){const x=ID(ft(NT(g),"int32"),Wo([]),256);u=sde(x,c)}const b=t?ap(g,u):Ma(g,u);return ft(Se(b,255),"int32")}function sde(n,e){let t=Ki([-1]),s=Ki([0]),r=Ki([0]),a,o,l,c,u,d;for(let p=0;p<n.size-1;p++){a=Xn(n,0,p+1),o=Xn(n,p+1),u=Bt(It(a),e),d=Bt(It(o),e);const m=It(Se(a,Lm(0,a.size)));l=Bt(m,It(a));const g=ig(o.shape,a.size),b=at(Lm(0,o.size),g),v=Se(o,b);c=Bt(It(v),It(o));const x=St(l,c),S=St(l,c),C=Se(u,d);r=Se(Se(C,x),S);const A=Ma(r,s);s=Di(A,r,s),t=Di(A,Ki([p]),t)}return t}const rde=ve({threshold_:nde});function ide(n,e,t="nearest",s="constant",r=0,a){const o=ie(n,"image","transform","float32"),l=ie(e,"transforms","transform","float32");ee(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),ee(l.rank===2&&(l.shape[0]===o.shape[0]||l.shape[0]===1)&&l.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),ee(a==null||a.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`);const c={image:o,transforms:l},u={interpolation:t,fillMode:s,fillValue:r,outputShape:a};return be.runKernel(lT,c,u)}const ade=ve({transform_:ide});function ode(n,e,t){const s=ie(n,"a","bandPart");ee(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[a,o]=s.shape.slice(-2);let l,c;typeof e=="number"?(ee(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),ee(e<=a,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${a}).`),l=ie(e<0?a:e,"numLower","bandPart")):(ee(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),l=Di(H0(e,0),a,qf(e,a))),typeof t=="number"?(ee(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),ee(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),c=ie(t<0?o:t,"numUpper","bandPart")):(ee(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=Di(H0(t,0),o,qf(t,o)));const u=_e(Lm(0,a,1,"int32"),[-1,1]),d=Lm(0,o,1,"int32"),p=St(u,d),m=mc(ap(p,l),Rd(p,Gs(c))),g=Qr([a,o],s.dtype);return _e(Ra(Ll(_e(s,[-1,a,o])).map(b=>Di(m,b,g))),r)}const lde=ve({bandPart_:ode});function cde(n){let e;if(Array.isArray(n)){e=!1,ee(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let a=1;a<n.length;++a)ee(n[a].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[a].shape[0]} vs. ${r})`)}else e=!0,n=ro(n,n.shape[0],0).map(r=>lp(r,[0]));ee(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(be.tidy(()=>{let a=s[r];if(r>0)for(let o=0;o<r;++o){const l=Se(It(Se(t[o],a)),t[o]);a=St(a,l)}return Bt(a,gy(a,"euclidean"))}));return e?Ra(t,0):t}const ude=ve({gramSchmidt_:cde});function hde(n,e=!1){if(ee(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return Oz(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((c,u)=>c*u),s=Ll(_e(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],a=[];s.forEach(c=>{const[u,d]=Oz(c,e);r.push(u),a.push(d)});const o=_e(Ra(r,0),n.shape),l=_e(Ra(a,0),n.shape);return[o,l]}}function Oz(n,e=!1){return be.tidy(()=>{ee(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=wT(t),a=uh(n);const o=Pf([[1]],[1,1]);let l=uh(o);const c=t>=s?s:t;for(let u=0;u<c;++u){const d=a,p=l,m=r;[l,a,r]=be.tidy(()=>{const g=Xn(a,[u,u],[t-u,1]),b=gy(g),v=Xn(a,[u,u],[1,1]),x=Di(Ma(v,0),Pf([[-1]]),Pf([[1]])),S=St(v,Se(x,b)),C=Bt(g,S);C.shape[0]===1?l=uh(o):l=Pr([o,Xn(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const A=Gs(Bt(Ln(x,S),b)),k=Xn(a,[u,0],[t-u,s]),O=Se(A,l),F=Wn(l);if(u===0)a=St(k,Ln(O,Ln(F,k)));else{const R=St(k,Ln(O,Ln(F,k)));a=Pr([Xn(a,[0,0],[u,s]),R],0)}const $=Wn(O),M=Xn(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=St(M,Ln(Ln(M,l),$));else{const R=St(M,Ln(Ln(M,l),$));r=Pr([Xn(r,[0,0],[t,u]),R],1)}return[l,a,r]}),xn([d,p,m])}return!e&&t>s&&(r=Xn(r,[0,0],[t,s]),a=Xn(a,[0,0],[s,s])),[r,a]})}const dde=ve({qr_:hde});var Ia;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ia||(Ia={}));function fde(n,e,t=Ia.SUM_BY_NONZERO_WEIGHTS){const s=ie(n,"losses","computeWeightedLoss");let r=null;e!=null&&(r=ie(e,"weights","computeWeightedLoss"));const a=r==null?s:Se(s,r);if(t===Ia.NONE)return a;if(t===Ia.SUM)return It(a);if(t===Ia.MEAN){if(r==null)return pr(a);{const o=s.size/r.size,l=Bt(It(a),It(r));return o>1?Bt(l,Xt(o)):l}}if(t===Ia.SUM_BY_NONZERO_WEIGHTS){if(r==null)return Bt(It(a),Xt(s.size));{const o=Se(r,to(s.shape)),l=ft(It(Rm(o,Xt(0))),"float32");return Bt(It(a),l)}}throw Error(`Unknown reduction: ${t}`)}const Fd=ve({computeWeightedLoss_:fde});function pde(n,e,t,s=Ia.SUM_BY_NONZERO_WEIGHTS){const r=ie(n,"labels","absoluteDifference"),a=ie(e,"predictions","absoluteDifference");let o=null;t!=null&&(o=ie(t,"weights","absoluteDifference")),ea(r.shape,a.shape,"Error in absoluteDifference: ");const l=Xr(St(r,a));return Fd(l,o,s)}const mde=ve({absoluteDifference_:pde});function gde(n,e,t,s,r=Ia.SUM_BY_NONZERO_WEIGHTS){const a=ie(n,"labels","cosineDistance"),o=ie(e,"predictions","cosineDistance");let l=null;s!=null&&(l=ie(s,"weights","cosineDistance")),ea(a.shape,o.shape,"Error in cosineDistance: ");const c=Xt(1),u=St(c,It(Se(a,o),t,!0));return Fd(u,l,r)}const yde=ve({cosineDistance_:gde});function bde(n,e,t,s=Ia.SUM_BY_NONZERO_WEIGHTS){let r=ie(n,"labels","hingeLoss");const a=ie(e,"predictions","hingeLoss");let o=null;t!=null&&(o=ie(t,"weights","hingeLoss")),ea(r.shape,a.shape,"Error in hingeLoss: ");const l=Xt(1);r=St(Se(Xt(2),r),l);const c=Cu(St(l,Se(r,a)));return Fd(c,o,s)}const vde=ve({hingeLoss_:bde});function wde(n,e,t,s=1,r=Ia.SUM_BY_NONZERO_WEIGHTS){const a=ie(n,"labels","huberLoss"),o=ie(e,"predictions","huberLoss");let l=null;t!=null&&(l=ie(t,"weights","huberLoss")),ea(a.shape,o.shape,"Error in huberLoss: ");const c=Xt(s),u=Xr(St(o,a)),d=qf(u,c),p=St(u,d),m=at(Se(Xt(.5),As(d)),Se(c,p));return Fd(m,l,r)}const xde=ve({huberLoss_:wde});function Sde(n,e,t,s=1e-7,r=Ia.SUM_BY_NONZERO_WEIGHTS){const a=ie(n,"labels","logLoss"),o=ie(e,"predictions","logLoss");let l=null;t!=null&&(l=ie(t,"weights","logLoss")),ea(a.shape,o.shape,"Error in logLoss: ");const c=Xt(1),u=Xt(s),d=Gs(Se(a,qo(at(o,u)))),p=Se(St(c,a),qo(at(St(c,o),u))),m=St(d,p);return Fd(m,l,r)}const Cde=ve({logLoss_:Sde});function _de(n,e,t,s=Ia.SUM_BY_NONZERO_WEIGHTS){const r=ie(n,"labels","meanSquaredError"),a=ie(e,"predictions","meanSquaredError");let o=null;t!=null&&(o=ie(t,"weights","meanSquaredError")),ea(r.shape,a.shape,"Error in meanSquaredError: ");const l=LT(r,a);return Fd(l,o,s)}const kde=ve({meanSquaredError_:_de});function Tde(n,e){const t=ie(n,"labels","sigmoidCrossEntropyWithLogits"),s=ie(e,"logits","sigmoidCrossEntropyWithLogits");ea(t.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=Cu(s),a=Se(s,t),o=$2(ho(Gs(Xr(s))));return at(St(r,a),o)}function Nde(n,e,t,s=0,r=Ia.SUM_BY_NONZERO_WEIGHTS){let a=ie(n,"multiClassLabels","sigmoidCrossEntropy");const o=ie(e,"logits","sigmoidCrossEntropy");let l=null;if(t!=null&&(l=ie(t,"weights","sigmoidCrossEntropy")),ea(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=Xt(s),d=Xt(1),p=Xt(.5);a=at(Se(a,St(d,u)),Se(p,u))}const c=Tde(a,o);return Fd(c,l,r)}const Ade=ve({sigmoidCrossEntropy_:Nde});function Ede(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return xh((r,a,o)=>{const c=R2(a,[t],!0),u=St(ft(a,"float32"),c);o([r,u]);const d=Gs(Se(u,r));return{value:It(d,[t]),gradFunc:(g,b)=>{const[v,x]=b,S=zr(g.shape,[t]);return[Se(_e(g,S),St(ft(v,"float32"),ho(x))),Se(_e(g,S),St(ho(x),ft(v,"float32")))]}}})(n,e)}function Ide(n,e,t,s=0,r=Ia.SUM_BY_NONZERO_WEIGHTS){let a=ie(n,"onehotLabels","softmaxCrossEntropy");const o=ie(e,"logits","softmaxCrossEntropy");let l=null;if(t!=null&&(l=ie(t,"weights","softmaxCrossEntropy")),ea(a.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const u=Xt(s),d=Xt(1),p=Xt(a.shape[1]);a=at(Se(a,St(d,u)),Bt(u,p))}const c=Ede(a,o);return Fd(c,l,r)}const Ode=ve({softmaxCrossEntropy_:Ide});function Dde(n,e,t,s){const r=ie(n,"indices","sparseFillEmptyRows","int32"),a=ie(e,"values","sparseFillEmptyRows"),o=ie(t,"denseShape","sparseFillEmptyRows","int32"),l=ie(s,"defaultValue","sparseFillEmptyRows",a.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(a.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${a.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(l.rank!==0)throw new Error(`Default value should be a scalar but received shape ${l.shape}`);const c={indices:r,values:a,denseShape:o,defaultValue:l},u=be.runKernel(Zk,c);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const $de=ve({sparseFillEmptyRows_:Dde});function Rde(n,e,t){const s=ie(n,"inputIndices","sparseReshape","int32"),r=ie(e,"inputShape","sparseReshape","int32"),a=ie(t,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(a.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${a.shape}`);const o={inputIndices:s,inputShape:r,newShape:a},l=be.runKernel(Jk,o);return{outputIndices:l[0],outputShape:l[1]}}const Lde=ve({sparseReshape_:Rde});function Fde(n,e,t){const s=ie(n,"data","sparseSegmentMean"),r=ie(e,"indices","sparseSegmentMean","int32"),a=ie(t,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${a.shape}`);const o={data:s,indices:r,segmentIds:a};return be.runKernel(Qk,o)}const Mde=ve({sparseSegmentMean_:Fde});function Pde(n,e,t){const s=ie(n,"data","sparseSegmentSum"),r=ie(e,"indices","sparseSegmentSum","int32"),a=ie(t,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${a.shape}`);const o={data:s,indices:r,segmentIds:a};return be.runKernel(eT,o)}const zde=ve({sparseSegmentSum_:Pde});function Bde(n,e,t,s,r,a,o,l){const c=ie(n,"data","stringNGrams","string");if(c.dtype!=="string")throw new Error("Data must be of datatype string");if(c.shape.length!==1)throw new Error(`Data must be a vector, saw: ${c.shape}`);const u=ie(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const d={separator:t,nGramWidths:s,leftPad:r,rightPad:a,padWidth:o,preserveShortSequences:l},p={data:c,dataSplits:u},m=be.runKernel(rT,p,d);return{nGrams:m[0],nGramsSplits:m[1]}}const jde=ve({stringNGrams_:Bde});function Ude(n,e,t=!0){const s=ie(n,"input","stringSplit","string"),r=ie(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const a={skipEmpty:t},o={input:s,delimiter:r},l=be.runKernel(iT,o,a);return{indices:l[0],values:l[1],shape:l[2]}}const Vde=ve({stringSplit_:Ude});function Wde(n,e){const t=ie(n,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:t};return be.runKernel(aT,r,s)}const Hde=ve({stringToHashBucketFast_:Wde});function Gde(n,e,t,s=!0){const r=ie(n,"input","staticRegexReplace","string"),a={pattern:e,rewrite:t,replaceGlobal:s};return be.runKernel(x2,{x:r},a)}const qde=ve({staticRegexReplace_:Gde});const C3={fft:V2,ifft:Y0,rfft:W2,irfft:RT},_3={hammingWindow:xhe,hannWindow:v3,frame:w3,stft:khe},hc={flipLeftRight:Ehe,grayscaleToRGB:Ohe,resizeNearestNeighbor:S3,resizeBilinear:x3,rgbToGrayscale:$he,rotateWithOffset:Lhe,cropAndResize:Nhe,nonMaxSuppression:Mhe,nonMaxSuppressionAsync:Hhe,nonMaxSuppressionWithScore:qhe,nonMaxSuppressionWithScoreAsync:Yhe,nonMaxSuppressionPadded:Zhe,nonMaxSuppressionPaddedAsync:Qhe,threshold:rde,transform:ade},x$={bandPart:lde,gramSchmidt:ude,qr:dde},k3={absoluteDifference:mde,computeWeightedLoss:Fd,cosineDistance:yde,hingeLoss:vde,huberLoss:xde,logLoss:Cde,meanSquaredError:kde,sigmoidCrossEntropy:Ade,softmaxCrossEntropy:Ode},T3={sparseFillEmptyRows:$de,sparseReshape:Lde,sparseSegmentMean:Mde,sparseSegmentSum:zde},N3={stringNGrams:jde,stringSplit:Vde,stringToHashBucketFast:Hde,staticRegexReplace:qde};const Xde=new Map,lI=new Map;class lg{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Sl{constructor(){this.classNameMap={}}static getMap(){return Sl.instance==null&&(Sl.instance=new Sl),Sl.instance}static register(e){Sl.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function lt(n,e,t){ee(n.className!=null,()=>"Class being registered does not have the static className property defined."),ee(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),ee(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Sl.register(n),Xde.set(r,n),lI.set(n,r),n}function Yde(n){return lI.has(n)?lI.get(n):n.className}const Kde=Object.freeze(Object.defineProperty({__proto__:null,Serializable:lg,SerializationMap:Sl,getRegisteredName:Yde,registerClass:lt},Symbol.toStringTag,{value:"Module"}));class Md extends lg{minimize(e,t=!1,s){const{value:r,grads:a}=this.computeGradients(e,s);if(s!=null){const o=s.map(l=>({name:l.name,tensor:a[l.name]}));this.applyGradients(o)}else this.applyGradients(a);return xn(a),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return $V(e,t)}dispose(){this.iterations_!=null&&xn(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Xt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Md,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});class S$ extends Md{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=be.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const a=be.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:Le(()=>Kn(a).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:Le(()=>Kn(a).variable(o))});const l=Array.isArray(e)?e[r].tensor:e[s];if(l==null)return;const c=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;Le(()=>{const d=at(Se(c,this.rho),Se(As(l),1-this.rho)),p=Se(Bt(Qi(at(u,this.epsilon)),Qi(at(c,this.epsilon))),l),m=at(Se(u,this.rho),Se(As(p),1-this.rho));c.assign(d),u.assign(m);const g=at(Se(p,-this.learningRate),a);a.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(xn(this.accumulatedGrads.map(e=>e.variable)),xn(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}class C$ extends Md{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const a=be.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:Le(()=>ig(a.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const l=this.accumulatedGrads[r].variable;Le(()=>{const c=at(l,As(o));l.assign(c);const u=at(Se(Bt(o,Qi(at(c,be.backend.epsilon()))),-this.learningRate),a);a.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&xn(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}class _$ extends Md{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Le(()=>{this.accBeta1=Xt(t).variable(),this.accBeta2=Xt(s).variable()}),r==null&&(this.epsilon=be.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Le(()=>{const s=St(1,this.accBeta1),r=St(1,this.accBeta2);t.forEach((a,o)=>{const l=be.registeredVariables[a],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${a}/m`,variable:Le(()=>Kn(l).variable(c))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${a}/v`,variable:Le(()=>Kn(l).variable(c))});const u=Array.isArray(e)?e[o].tensor:e[a];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,p=this.accumulatedSecondMoment[o].variable,m=at(Se(d,this.beta1),Se(u,1-this.beta1)),g=at(Se(p,this.beta2),Se(As(u),1-this.beta2)),b=Bt(m,s),v=Bt(g,r);d.assign(m),p.assign(g);const x=at(Se(Bt(b,at(Qi(v),this.epsilon)),-this.learningRate),l);l.assign(x)}),this.accBeta1.assign(Se(this.accBeta1,this.beta1)),this.accBeta2.assign(Se(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&xn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&xn(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),Le(()=>{this.accBeta1.assign(_d(this.beta1,this.iterations_+1)),this.accBeta2.assign(_d(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}class k$ extends Md{static get className(){return"Adamax"}constructor(e,t,s,r=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Le(()=>{this.iteration=Xt(0).variable(),this.accBeta1=Xt(t).variable()}),r==null&&(this.epsilon=be.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Le(()=>{const s=St(1,this.accBeta1),r=Bt(-this.learningRate,at(Se(this.iteration,this.decay),1));t.forEach((a,o)=>{const l=be.registeredVariables[a],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${a}/m`,variable:Kn(l).variable(c)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${a}/v`,variable:Kn(l).variable(c)});const u=Array.isArray(e)?e[o].tensor:e[a];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,p=this.accumulatedWeightedInfNorm[o].variable,m=at(Se(d,this.beta1),Se(u,1-this.beta1)),g=Se(p,this.beta2),b=Xr(u),v=Th(g,b);d.assign(m),p.assign(v);const x=at(Se(Bt(r,s),Bt(m,at(v,this.epsilon))),l);l.assign(x)}),this.iteration.assign(at(this.iteration,1)),this.accBeta1.assign(Se(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&xn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&xn(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class XT extends Md{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const o=be.registeredVariables[s];Le(()=>{const l=at(Se(this.c,a),o);o.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=fi(Xt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class T$ extends XT{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Xt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const a=be.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:Le(()=>Kn(a).variable(!1))});const o=this.accumulations[r].variable,l=Array.isArray(e)?e[r].tensor:e[s];l!=null&&Le(()=>{let c;const u=at(Se(this.m,o),l);this.useNesterov?c=at(Se(this.c,at(l,Se(u,this.m))),a):c=at(Se(this.c,u),a),o.assign(u),a.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&xn(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class N$ extends Md{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,r==null&&(this.epsilon=be.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const a=be.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:Le(()=>Kn(a).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:Le(()=>Kn(a).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:Le(()=>Kn(a).variable(o))});const l=Array.isArray(e)?e[r].tensor:e[s];if(l==null)return;const c=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;Le(()=>{const d=at(Se(c,this.decay),Se(As(l),1-this.decay));if(this.centered){const p=this.accumulatedMeanGrads[r].variable,m=at(Se(p,this.decay),Se(l,1-this.decay)),g=Bt(Se(l,this.learningRate),Qi(St(d,at(As(m),this.epsilon)))),b=at(Se(u,this.momentum),g);c.assign(d),p.assign(m),u.assign(b);const v=St(a,b);a.assign(v)}else{const p=at(Se(c,this.decay),Se(As(l),1-this.decay)),m=at(Se(u,this.momentum),Bt(Se(l,this.learningRate),Qi(at(p,this.epsilon))));c.assign(p),u.assign(m);const g=St(a,m);a.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&xn(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&xn(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&xn(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const Zde=[S$,C$,_$,k$,T$,N$,XT];function Jde(){for(const n of Zde)lt(n)}const Qde="model",efe=".json",tfe=".weights.bin";function Dz(n){return new Promise(e=>setTimeout(e)).then(n)}class Fm{constructor(e){if(!Re().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Fm.URL_SCHEME)&&(e=e.slice(Fm.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Qde),this.modelJsonFileName=e+efe,this.weightDataFileName=e+tfe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=Su.join(e.weightData),s=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=dV(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=o,await Dz(()=>l.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=s,await Dz(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:T2(e)}}}}Fm.URL_SCHEME="downloads://";class nfe{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const s=new FileReader;s.onload=r=>{const a=JSON.parse(r.target.result),o=a.modelTopology;if(o==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(a.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const c=fD(a,u=>this.loadWeights(u));e(c)},s.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const t=[],s=[];for(const o of e)t.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),a=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(a).then(o=>[t,o])}loadWeightsFile(e,t){return new Promise((s,r)=>{const a=new FileReader;a.onload=o=>{const l=o.target.result;s(l)},a.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],s=this.weightsFiles.map(a=>xz(a.name)),r={};for(const a of e)a.paths.forEach(o=>{const l=xz(o);if(t.indexOf(l)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${l}'`);if(t.push(l),s.indexOf(l)===-1)throw new Error(`Weight file with basename '${l}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(l)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const sfe=n=>Re().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Fm.URL_SCHEME)?rfe(n.slice(Fm.URL_SCHEME.length)):null;dr.registerSaveRouter(sfe);function rfe(n="model"){return new Fm(n)}function ife(n){return new nfe(n)}function $z(n,e,t,s){o(n),t=t??0,s=s??1,l(t,s);let r=0;const a=c=>(c.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),c);function o(c){ee(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function l(c,u){ee(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),ee(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),ee(u>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${u}`)}return Promise.all(n.map(a))}async function A3(n,e){e==null&&(e={});const t=e.fetchFunc==null?Re().platform.fetch:e.fetchFunc,s=n.map(p=>t(p,e.requestInit,{isBinary:!0})),l=(e.onProgress==null?await Promise.all(s):await $z(s,e.onProgress,0,.5)).map(p=>p.arrayBuffer());return e.onProgress==null?await Promise.all(l):await $z(l,e.onProgress,.5,1)}async function E3(n,e="",t,s){return I3(o=>A3(o,{requestInit:s}))(n,e,t)}function I3(n){return async(e,t="",s)=>{const r=e.map(()=>!1),a={},o=s!=null?s.map(()=>!1):[],l=[];if(e.forEach((g,b)=>{let v=0;g.weights.forEach(x=>{const S="quantization"in x?x.quantization.dtype:x.dtype,C=QE[S]*We(x.shape),A=()=>{r[b]=!0,a[b]==null&&(a[b]=[]),a[b].push({manifestEntry:x,groupOffset:v,sizeBytes:C})};s!=null?s.forEach((k,O)=>{k===x.name&&(A(),o[O]=!0)}):A(),l.push(x.name),v+=C})}),!o.every(g=>g)){const g=s.filter((b,v)=>!o[v]);throw new Error(`Could not find weights in manifest with names: ${g.join(", ")}. 
Manifest JSON has weights with names: ${l.join(", ")}.`)}const c=r.reduce((g,b,v)=>(b&&g.push(v),g),[]),u=[];c.forEach(g=>{e[g].paths.forEach(b=>{const v=t+(t.endsWith("/")?"":"/")+b;u.push(v)})});const d=await n(u),p={};let m=0;return c.forEach(g=>{const b=e[g].paths.length,v=new Su(d.slice(m,m+b));a[g].forEach(S=>{const C=v.slice(S.groupOffset,S.groupOffset+S.sizeBytes),A=uD(C,[S.manifestEntry]);for(const k in A)p[k]=A[k]}),m+=b}),p}}const afe="application/octet-stream",ofe="application/json";class A${constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ee(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Re().platform.fetch,ee(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ee(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=dV(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:ofe}),"model.json"),e.weightData!=null){const o=Su.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:afe}),"model.weights.bin")}const a=await this.fetch(this.path,t);if(a.ok)return{modelArtifactsInfo:T2(e),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return fD(t,a=>this.loadWeights(a))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=lfe(t),a=this.weightPathPrefix||s,o=pD(e),l=[],c=[];for(const d of e)for(const p of d.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(p)):l.push(a+p+r);this.weightUrlConverter&&l.push(...await Promise.all(c));const u=await A3(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,u]}}A$.URL_SCHEME_REGEX=/^https?:\/\//;function lfe(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function cI(n){return n.match(A$.URL_SCHEME_REGEX)!=null}const O3=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>cI(s)):t=cI(n),t)return E$(n,e)}return null};dr.registerSaveRouter(O3);dr.registerLoadRouter(O3);function E$(n,e){return new A$(n,e)}function D3(n,e){return E$(n,e)}class q5{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class $3{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class cfe{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function ufe(n,e,t,s){const r=arguments;return new cfe(r_(...r))}function r_(n,e,t,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new q5(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new q5({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new q5({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:s}))}function hfe(n){return new $3(n)}function dfe(n){return new $3(n)}const I$=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Su,browserFiles:ife,browserHTTPRequest:D3,concatenateArrayBuffers:hV,copyModel:Oae,decodeWeights:uD,encodeWeights:eI,fromMemory:ufe,fromMemorySync:r_,getLoadHandlers:pV,getModelArtifactsForJSON:fD,getModelArtifactsForJSONSync:dD,getModelArtifactsInfoForJSON:T2,getSaveHandlers:fV,getWeightSpecs:pD,http:E$,isHTTPScheme:cI,listModels:Eae,loadWeights:E3,moveModel:Dae,registerLoadRouter:yae,registerSaveRouter:gae,removeModel:Iae,weightsLoaderFactory:I3,withSaveHandler:hfe,withSaveHandlerSync:dfe},Symbol.toStringTag,{value:"Module"}));function ffe(n,e,t){const s=ie(n,"labels","confusionMatrix"),r=ie(e,"predictions","confusionMatrix");ee(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),ee(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),ee(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),ee(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),ee(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const a=G0(ft(s,"int32"),t),o=G0(ft(r,"int32"),t),l=Wn(a),c=Ln(l,o);return ft(c,"int32")}const pfe=ve({confusionMatrix_:ffe});const mfe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:pfe},Symbol.toStringTag,{value:"Module"}));let Hp,Rz=!1;function R3(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,s=!1,r=!1,a=!1,o=!1,l=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)a=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)l=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if($v(e_,be.backendName)!=null){const b={pixels:n},v={numChannels:e};return be.runKernel(e_,b,v)}const[u,d]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let p;if(o)p=n.getContext("2d").getImageData(0,0,u,d).data;else if(s||t)p=n.data;else if(a||r||l){if(Hp==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Hp=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Hp=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Hp.canvas.width=u,Hp.canvas.height=d,Hp.drawImage(n,0,0,u,d),p=Hp.getImageData(0,0,u,d).data}let m;if(e===4)m=new Int32Array(p);else{const b=u*d;m=new Int32Array(b*e);for(let v=0;v<b;v++)for(let x=0;x<e;++x)m[v*e+x]=p[v*4+x]}return h$(m,[d,u,e],"int32")}function gfe(n){return n!=null&&n.data instanceof Uint8Array}function yfe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function bfe(n){return n!=null&&n.width!==0&&n.height!==0}function vfe(n){return yfe()&&!(n instanceof ImageBitmap)&&bfe(n)&&!gfe(n)}async function L3(n,e=3){let t=null;if(Re().getBool("WRAP_TO_IMAGEBITMAP")&&vfe(n)){let s;try{s=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===n.width&&s.height===n.height?t=s:t=n}else t=n;return R3(t,e)}function F3(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const e=n.rank===2?1:n.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function wfe(n){const e=n?.alpha||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function xfe(n,e){let t=ie(n,"img","toPixels");if(!(n instanceof Yn)){const u=t;t=ft(u,"int32"),u.dispose()}F3(t);const[s,r]=t.shape.slice(0,2),a=t.rank===2?1:t.shape[2],o=await t.data(),l=t.dtype==="float32"?255:1,c=new Uint8ClampedArray(r*s*4);for(let u=0;u<s*r;++u){const d=[0,0,0,255];for(let m=0;m<a;m++){const g=o[u*a+m];if(t.dtype==="float32"){if(g<0||g>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${g}.`)}else if(t.dtype==="int32"&&(g<0||g>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${g}.`);a===1?(d[0]=g*l,d[1]=g*l,d[2]=g*l):d[m]=g*l}const p=u*4;c[p+0]=Math.round(d[0]),c[p+1]=Math.round(d[1]),c[p+2]=Math.round(d[2]),c[p+3]=Math.round(d[3])}if(e!=null){Rz||$v(Ck,be.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),Rz=!0),e.width=r,e.height=s;const u=e.getContext("2d"),d=new ImageData(c,r,s);u.putImageData(d,0,0)}return t!==n&&t.dispose(),c}function Sfe(n,e,t){let s=ie(n,"img","draw");if(!(n instanceof Yn)){const o=s;s=ft(o,"int32"),o.dispose()}F3(s),wfe(t?.imageOptions);const r={image:s},a={canvas:e,options:t};be.runKernel(Ck,r,a)}const M3=ve({fromPixels_:R3}),Cfe=Object.freeze(Object.defineProperty({__proto__:null,draw:Sfe,fromPixels:M3,fromPixelsAsync:L3,toPixels:xfe},Symbol.toStringTag,{value:"Module"}));function YT(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(We(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,a=r[r.length-1];let o=1;for(let p=0;p<r.length-1;++p)o*=r[p];const l=n.shape,c=r.slice();c.pop();let u=1;for(let p=a;p<t;++p)u*=l[p],c.push(l[p]);const d=[...Ht(n.shape).map(p=>p/u),1].slice(0,a);return[c,o,u,d]}const _fe=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:YT},Symbol.toStringTag,{value:"Module"}));const uI=-2,kfe=-1;function O$(n,e,t){const s=n.shape.length;ee(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),ee(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)ee(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function Tfe(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function D$(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function P3(n,e,t,s){const r=[...n];for(let a=r.length;a<s.length;a++)r.push(1);for(let a=0;a<t;a++)a===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function z3(n,e,t){return t<=n?t:t-(e-1)}function B3(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function Nfe(n,e,t,s,r,a,o,l,c){const u=n.length;let d=new Array(u),p=new Array(u),m=new Array(u);if(e.length&&t>0){const g=e[0],b=t+1;d=j3(o,g,b,s,n),p=U3(l,g,b,r,n),m=P3(a,g,b,n)}else for(let g=0;g<u;g++)d[g]=W3(o,s,a,n,g,c),p[g]=H3(l,r,a,n,g,c),m[g]=V3(a,g,c);return{begin:d,end:p,strides:m}}function j3(n,e,t,s,r){const a=[...r],o=B3(t,e);for(let l=0;l<a.length;l++)if(o.indexOf(l)>-1)a[l]=0;else{const c=z3(e,t,l);let u=s[c];n&1<<c&&(u=0),a[l]=u}return a}function U3(n,e,t,s,r){const a=[...r],o=B3(t,e);for(let l=0;l<a.length;l++)if(o.indexOf(l)>-1)a[l]=Number.MAX_SAFE_INTEGER;else{const c=z3(e,t,l);let u=s[c];n&1<<c&&(u=Number.MAX_SAFE_INTEGER),a[l]=u}for(let l=0;l<a.length;l++){const c=r[l];a[l]<0&&(a[l]+=c),a[l]=Wf(0,a[l],r[l])}return a}function V3(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function W3(n,e,t,s,r,a){let o=e[r];const l=t[r]||1;(n&1<<r||a&1<<r||o==null)&&(l>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const c=s[r];return o<0&&(o+=c),o=Wf(0,o,c-1),o}function H3(n,e,t,s,r,a){let o=e[r];const l=t[r]||1;(n&1<<r||a&1<<r||o==null)&&(l>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const c=s[r];return o<0&&(o+=c),l>0?o=Wf(0,o,c):o=Wf(-1,o,c-1),o}function $$(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function R$(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function KT(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{ee(o!==-1,()=>"slice() does not support negative begin indexing.")});let a;return t==null?a=new Array(r).fill(-1):typeof t=="number"?a=[t,...new Array(r-1).fill(-1)]:t.length<r?a=t.concat(new Array(r-t.length).fill(-1)):a=t,a=a.map((o,l)=>o>=0?o:(ee(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${l}.`),n.shape[l]-s[l])),[s,a]}function L$(n,e,t,s,r,a,o,l,c){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const p={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:a,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:c};for(let A=0;A<p.dims;A++)d&&(1<<A&l)!==0&&p.numAddAxisAfterEllipsis++,1<<A&o&&(d=!0);d||(p.ellipsisMask|=1<<p.dims,p.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Afe(p,m);let g=!0,b=!0,v=!0;const x=[],S=[];for(let A=0;A<n.length;++A){if(m.strides[A]===0)throw Error(`strides[${A}] must be non-zero`);const k=!!(m.shrinkAxisMask&1<<A),O=n[A];if(O===-1){x.push(k?1:-1);continue}const F=[m.beginMask&1<<A,m.endMask&1<<A],$=[m.strides[A]>0?0:-1,m.strides[A]>0?O:O-1];if(k&&m.strides[A]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&m.strides[A]===1;const M=!!(m.beginMask&1<<A&&m.endMask&1<<A);if(m.beginValid&&m.endValid){if(k){const j=m.begin[A]<0?O+m.begin[A]:m.begin[A];if(m.begin[A]=j,m.end[A]=m.begin[A]+1,j<0||j>=O)throw Error(`slice index ${m.begin[A]} of dimension ${A} out of bounds.`)}else m.begin[A]=Lz(m.begin[A],0,m.strides[A],O,F,$),m.end[A]=Lz(m.end[A],1,m.strides[A],O,F,$);const I=m.strides[A]===1&&m.begin[A]===0&&m.end[A]===O;g=g&&I,b=b&&(A===0&&m.strides[A]===1||I)}else g=g&&m.strides[A]===1&&M,b=b&&(A===0&&m.strides[A]===1||M);let R,z=!1;if(m.beginValid&&m.endValid?(R=m.end[A]-m.begin[A],z=!0):k?(R=1,z=!0):M&&O>=0&&(m.strides[A]<0?R=-O:R=O,z=!0),z){let I;R===0||R<0!=m.strides[A]<0?I=0:I=Math.trunc(R/m.strides[A])+(R%m.strides[A]!==0?1:0),x.push(I)}else x.push(-1)}for(let A=0;A<m.finalShapeGatherIndices.length;++A){const k=m.finalShapeGatherIndices[A];k>=0?S.push(x[k]):k===uI&&S.push(1)}return{finalShapeSparse:S.filter((A,k)=>m.finalShapeGatherIndices[k]!==uI),finalShape:S,isIdentity:g,sliceDim0:b,isSimpleSlice:v,begin:m.begin,end:m.end,strides:m.strides}}function Afe(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(uI),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(kfe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function Lz(n,e,t,s,r,a){if(r[e])return t>0?a[e]:a[e+1&1];{const o=n<0?s+n:n;return o<a[0]?a[0]:o>a[1]?a[1]:o}}const G3=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:O$,computeFlatOffset:R$,computeOutShape:D$,getNormalizedAxes:Nfe,isSliceContinous:$$,maskToAxes:Tfe,parseSliceParams:KT,sliceInfo:L$,startForAxis:W3,startIndicesWithElidedDims:j3,stopForAxis:H3,stopIndicesWithElidedDims:U3,stridesForAxis:V3,stridesWithElidedDims:P3},Symbol.toStringTag,{value:"Module"}));const q3="4.11.0";class X3{static sgd(e){return new XT(e)}static momentum(e,t,s=!1){return new T$(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,a=!1){return new N$(e,t,s,r,a)}static adam(e=.001,t=.9,s=.999,r=null){return new _$(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new S$(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,a=0){return new k$(e,t,s,r,a)}static adagrad(e,t=.1){return new C$(e,t)}}const Kp=X3;const Efe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function F$(){return new Promise(n=>Efe(()=>n()))}function M$(n,e){const t=n[0].length;n.forEach((r,a)=>{ee(r.length===t,()=>`Error in concat${t}D: rank of tensors[${a}] must be the same as the rank of the rest (${t})`)}),ee(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,a)=>{for(let o=0;o<t;o++)ee(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${a}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${a}.`)})}function hh(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}var nu;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(nu||(nu={}));function Y3(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const a=t[r],o=s[s.length-t.length+r],l=s[o];if(a>=0)if(l>=0){if(l!==a)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${a} but shape[${r+n}] = ${l}`)}else s[o]=a}return s}function K3(n){const e={FIRST_DIM_SIZE:nu.FIRST_DIM_SIZE,VALUE_ROWIDS:nu.VALUE_ROWIDS,ROW_LENGTHS:nu.ROW_LENGTHS,ROW_SPLITS:nu.ROW_SPLITS,ROW_LIMITS:nu.ROW_LIMITS,ROW_STARTS:nu.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Z3(n){return n.length===0?0:n[0]===nu.FIRST_DIM_SIZE?n.length-1:n.length}function J3(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const a=n[r],o=e[r+1];if(a>=0&&o>=0&&a!==1&&a!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${a} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}const P$=30;function ZT(n){return n<=P$?n:ZC(n,Math.floor(Math.sqrt(n)))}function z$(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}function H2(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const a=e.length;for(let o=0;o<a;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(a+1))}return r}function G2(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],a=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?a.push(o):r.push(o);s.push(...r),s.push(0),s.push(...a)}return s}function q2(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let a=1;a<n.length;++a)a<=e.length?s?r.push(e[a-1]*n[a]):r.push(n[a]/e[a-1]):r.push(n[a]);return r}function B$(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function j$(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}const JT=1.7580993408473768,QT=1.0507009873554805;const U$=.3275911,V$=.254829592,W$=-.284496736,H$=1.421413741,G$=-1.453152027,q$=1.061405429;function kd(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function Q3(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function e9(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function t9(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function X$(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function n9(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function s9(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const a=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(a),s[r]=Math.sin(a)}return{real:t,imag:s}}function r9(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),a=Math.sin(s);return{real:r,imag:a}}const X5="->",Ife=/->/g,Fz=",",Mz="...";function Y$(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Ife,"").length)/X5.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${X5}").`);const[s,r]=n.split(X5);ee(s.indexOf(Mz)===-1,()=>`The ellipsis notation ("${Mz}") is not supported yet.`);const a=s.split(Fz),o=a.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const l=[];for(let m=0;m<r.length;++m){const g=r[m];if(!a.some(b=>b.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);l.indexOf(g)===-1&&l.push(g)}for(let m=0;m<s.length;++m){const g=s[m];l.indexOf(g)===-1&&g!==Fz&&l.push(g)}const c=new Array(a.length);for(let m=0;m<o;++m){if(new Set(a[m].split("")).size!==a[m].length)throw new Error(`Found duplicate axes in input component ${a[m]}. Support for duplicate axes in input is not implemented yet.`);c[m]=[];for(let g=0;g<a[m].length;++g)c[m].push(l.indexOf(a[m][g]))}const u=l.length,d=r.length,p=[];for(let m=d;m<u;++m)p.push(m);return{allDims:l,summedDims:p,idDims:c}}function K$(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function Z$(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const a=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=a[o]:ee(s[e[r][o]]===a[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(a)}, but got dimension ${a[o]}`)}}function J$(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const a=[];for(let o=0;o<t.length;++o){const l=t[o],c=Ofe(e,l);for(const u of c)a.indexOf(u)===-1&&(s[o].push(u),a.push(u))}return{path:t,steps:s}}function Q$(n){return n.every((e,t)=>e===t)}function Ofe(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function eR(n,e,t=0){let s=[];if(typeof e=="number")ee(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,l)=>(l===-1&&(o+=1),o),0);ee(r<=1,()=>"There should be only one negative value in split array.");const a=e.indexOf(-1);if(a!==-1){const o=e.reduce((l,c)=>c>0?l+c:l);e[a]=n.shape[t]-o}ee(n.shape[t]===e.reduce((o,l)=>o+l),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}function i9(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function a9(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function o9(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}function l9(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function c9(n,e){return`size ${n} must be non-negative, not ${e}`}function u9(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function h9(n,e){const t=We(n),s=We(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function d9(n,e){const t=We(n),s=We(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}function hI(){return"segment ids must be >= 0"}function f9(){return"segment ids are not increasing"}function p9(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function m9(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}function g9(n,e){let t=!1,s;for(n<=P$?(s=n,t=!0):s=ZC(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=ZC(n,s+1);return s}function y9(n,e,t){const s=[],r=n.length;for(let a=0;a<r;a++)a!==e?s.push(n[a]):s.push(t);return s}function tR(n,e,t,s){const r=e.shape.length,a=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>a)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${a}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let p=0;p<s;++p)if(n.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${n.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);const o=n.shape[t],l=[];let c=1,u=1,d=1;for(let p=0;p<s;++p)l.push(n.shape[p]),c*=n.shape[p];for(let p=s;p<t;p++)l.push(n.shape[p]),u*=n.shape[p];for(let p=s;p<r;p++)l.push(e.shape[p]);for(let p=t+1;p<a;p++)l.push(n.shape[p]),d*=n.shape[p];return{batchSize:c,sliceSize:d,outerSize:u,dimSize:o,outputShape:l}}const Dfe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:tR,computeOutShape:y9,segOpComputeOptimalWindowSize:g9},Symbol.toStringTag,{value:"Module"}));function Td(n){try{return n.map(e=>wd(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function b9(n){return n.map(e=>ch(e))}const v9=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:V$,ERF_A2:W$,ERF_A3:H$,ERF_A4:G$,ERF_A5:q$,ERF_P:U$,PARALLELIZE_THRESHOLD:P$,get RowPartitionType(){return nu},SELU_SCALE:QT,SELU_SCALEALPHA:JT,applyActivation:VT,assertAndGetBroadcastShape:Sn,assertAxesAreInnerMostDims:na,assertParamsConsistent:M$,assignToTypedArray:n9,axesAreInnerMostDims:WD,calculateShapes:cp,checkEinsumDimSizes:Z$,checkPadOnDimRoundingMode:Fa,combineLocations:IV,combineRaggedTensorToTensorShapes:Y3,complexWithEvenIndex:e9,complexWithOddIndex:t9,computeConv2DInfo:Li,computeConv3DInfo:rp,computeDefaultPad:kD,computeDilation2DInfo:N2,computeOptimalWindowSize:ZT,computeOutAndReduceShapes:Fi,computeOutShape:hh,computePool2DInfo:yc,computePool3DInfo:Dd,convertConv2DDataFormat:$d,decodeEinsumEquation:Y$,eitherStridesOrDilationsAreOne:ta,expandShapeToKeepDim:zr,exponent:r9,exponents:s9,fromStringArrayToUint8:b9,fromUint8ToStringArray:Td,getAxesPermutation:yr,getBroadcastDims:$m,getComplexWithIndex:X$,getEinsumComputePath:J$,getEinsumPermutation:K$,getFusedBiasGradient:UT,getFusedDyActivation:jT,getImageCenter:z$,getInnerMostAxes:Br,getPermuted:G2,getRaggedRank:Z3,getReductionAxes:si,getReshaped:H2,getReshapedPermuted:q2,getRowPartitionTypesHelper:K3,getSliceBeginCoords:B$,getSliceSize:j$,getSparseFillEmptyRowsIndicesDenseShapeMismatch:i9,getSparseFillEmptyRowsNegativeIndexErrorMessage:a9,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:o9,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:u9,getSparseReshapeInputOutputMismatchErrorMessage:d9,getSparseReshapeInputOutputMultipleErrorMessage:h9,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:l9,getSparseReshapeNegativeOutputDimErrorMessage:c9,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:m9,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:hI,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:f9,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:p9,getUndoAxesPermutation:ip,isIdentityPermutation:Q$,log:Die,mergeRealAndImagArrays:kd,prepareAndValidate:YT,prepareSplitSize:eR,segment_util:Dfe,shouldFuse:WT,slice_util:G3,splitRealAndImagArrays:Q3,stridesOrDilationsArePositive:Om,tupleValuesAreOne:Gf,upcastType:lo,validateDefaultValueShape:J3,validateInput:FT,validateUpdateShape:d$,warn:xl},Symbol.toStringTag,{value:"Module"}));const $fe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:HT,nonMaxSuppressionV4Impl:GT,nonMaxSuppressionV5Impl:qT,whereImpl:zT},Symbol.toStringTag,{value:"Module"}));Jde();var ym;(function(n){n.UNDEFINED="undefined",n.INVALID_MODEL_TYPE="invalidModelType",n.MISSING_PATH="missingPath"})(ym||(ym={}));const w9=n=>!n||!Array.isArray(n)||n.length!==4?!1:n.every(e=>e===null||typeof e=="number"),x9=n=>w9(n)&&n[1]!==null&&n[2]!==null&&n[1]>0&&n[2]>0;function S9(n){function e(t){try{return t.shape.length===n}catch{}return!1}return e}const C9=S9(4),Rfe=S9(3),X2=n=>n instanceof Yn,Lfe=n=>typeof n=="string",Ffe=n=>typeof n=="string"&&["layers","graph"].includes(n);class oC extends Error{type;constructor(e){super(e),this.type=e}}const Mfe=n=>{if(n===void 0)throw new oC(ym.UNDEFINED);if(!Ffe(n.modelType??"layers"))throw new oC(ym.INVALID_MODEL_TYPE);if(!n.path&&!n._internals?.path)throw new oC(ym.MISSING_PATH);return!0},Pfe=n=>typeof n=="number",_9=n=>Array.isArray(n)&&n.length===2&&n.every(Pfe),gv=n=>{console.warn(Array.isArray(n)?n.join(`
`):n)};function nR(n){return n!==void 0&&typeof n=="function"}function zfe(n){return nR(n)&&n.length<=1}const Bfe=(n,e,t)=>!nR(n)||n.length<=1?!1:t===void 0&&e==="tensor"?!0:t==="tensor",jfe=n=>n?n.aborted:!1;async function k9(n,e){let t;for(t=await n.next();!t.done;t=await n.next())e&&await e(t.value);return t.value}function T9(n){return n!=null}function yv(n,e,...t){const s=t.filter(T9);if(s.length){const r=n.tidy(()=>s.reduce((a,o)=>o(a),e));return!e.isDisposed&&e!==r&&e.dispose(),r}return e}const Ufe=n=>n instanceof oC,Vfe="https://upscalerjs.com/documentation/troubleshooting#deprecated-model-definition-function",Wfe=["Passing a model definition as a function is deprecated and will be removed in a future version.","To leverage model lifecycle methods, use the setup and teardown methods.",`For more information, see ${Vfe}.`].join(" "),Hfe="https://upscalerjs.com/documentation/troubleshooting#padding-is-undefined",Gfe=['"padding" is undefined, but "patchSize" is explicitly defined.',"Without padding, patches of images often have visible artifacting at the seams. Defining an explicit padding will resolve the artifacting.",`For more information, see ${Hfe}.`,'To hide this warning, pass an explicit padding of "0".'].join(" "),qfe="https://upscalerjs.com/documentation/troubleshooting#progress-specified-without-patch-size",Xfe=['The "progress" callback was provided but "patchSize" was not defined.','Without a "patchSize", the "progress" callback will never be called.',`For more information, see ${qfe}.`].join(" "),Yfe="https://upscalerjs.com/documentation/troubleshooting#invalid-predicted-tensor",Kfe=n=>[`The tensor returned by the model was not a valid rank-4 tensor. It's shape is ${JSON.stringify(n)}.}`,"UpscalerJS only supports models returning valid image-like data in four dimensional form.",`For more information, see ${Yfe}.`].join(" "),Zfe="https://upscalerjs.com/documentation/troubleshooting#invalid-model-prediction",Jfe=["The model output was not a valid tensor. UpscalerJS only supports models returning valid tensors.","This is likely an error with the model itself, not UpscalerJS.",`For more information, see ${Zfe}.`].join(" "),Qfe=new Error("No defined tensors were passed to concatTensors");class epe extends Error{message="The upscale request received an abort signal"}const tpe="https://upscalerjs.com/documentation/troubleshooting#invalid-model-type",npe="https://upscalerjs.com/documentation/troubleshooting#input-size-and-patch-size",spe="https://upscalerjs.com/documentation/troubleshooting#error-with-model-input-shape",rpe=n=>[`You've provided an invalid model type: ${JSON.stringify(n)}. Accepted types are "layers" and "graph".`,`For more information, see ${tpe}.`].join(" "),sR="There is a bug with the upscaler code. Please report this.",ipe=["You have provided a patchSize, but the model definition already includes an input size.","Your patchSize will be ignored.",`For more information, see ${npe}.`].join(" "),ape=n=>[`Expected model to have a rank-4 compatible input shape. Instead got: ${JSON.stringify(n)}.`,`For more information, see ${spe}.`].join(" "),ope=n=>new Error([`Invalid patch size: ${n}. Patch size must be greater than 0.`].join(" ")),lpe=(n,e)=>new Error([`Invalid patch size and padding: ${n} and ${e}. Patch size must be greater than padding * 2.`].join(" ")),cpe="https://upscalerjs.com/documentation/troubleshooting#patch-size-indivisible-by-divisibility-factor",upe=(n,e,t)=>[`Invalid patch size: ${n}. The model has a defined divibility factor of ${e} and patch size must be a multiple of this number.`,`Patch size has been scaled up to ${t}.`,`
For more information, see ${cpe}.`].join(" "),hpe=new Error(["Model input sizes must be square. If you are using a model with a non-square input size and would like to request support,","please file a feature request at https://github.com/thekevinscott/upscalerjs"].join(" ")),dpe="https://upscalerjs.com/documentation/troubleshooting#missing-path-and-internals",fpe=n=>['Provided model configuration is missing both a "path" and "_internals". A valid path to a model JSON file must be provided.',`For more information, see ${dpe}.`,`The model configuration provided was: ${JSON.stringify(n)}`].join(" ");function ppe(n,e){switch(n){case ym.INVALID_MODEL_TYPE:return new Error(rpe(e?.modelType));case ym.MISSING_PATH:return new Error(fpe(e));default:return new Error(sR)}}const N9=(n,e,t)=>async s=>{if(t&&await n.nextFrame(),jfe(e))throw Array.isArray(s)?s.forEach(r=>r?.dispose()):X2(s)&&s.dispose(),new epe},i_=n=>!n||typeof n!="object"?!1:"patchSize"in n&&typeof n.patchSize=="number",dI=n=>!!n&&typeof n=="number"&&n>0,mpe="https://upscalerjs.com/documentation/troubleshooting#invalid-warmup-value",gpe=n=>["Invalid value passed to warmup in warmupSizes:",JSON.stringify(n),`For more information, see ${mpe}.`].join(`
`),fI=n=>new Error(gpe(n)),ype=n=>{if(i_(n)){const{patchSize:e}=n;return e}return n};async function*bpe(n,e,t){const{model:s,modelDefinition:r}=await e;for(const a of t){if(!i_(a)&&!dI(a))throw fI(a);const o=ype(a);let l=n.zeros([1,o,o,3]);yield[l];const c=[r.preprocess,u=>s.predict(u),r.postprocess].filter(Boolean);for(const u of c)l=yv(n,l,u),yield[l];l.dispose(),yield}}const vpe=n=>{if(Array.isArray(n)){for(const e of n)if(!i_(e)&&!dI(e))throw fI(n);return n}else if(i_(n)||dI(n))return[n];throw fI(n)},Pz=async(n,e,t,{signal:s=void 0,awaitNextFrame:r=!1}={},a)=>{const o=N9(n,s||a.signal,r);await o(),await k9(bpe(n,e,vpe(t)),o)},wpe=(n,e)=>e instanceof n.LayersModel,xpe=n=>({...n});function Spe(n){return typeof n=="function"}function Cpe(n,e){return Spe(e)?(gv(Wfe),e(n)):e}async function _pe(n,e){const t=Cpe(n,e);return t.setup&&await t.setup(n),t}function zz(n,e,t){return t==="graph"?n.loadGraphModel(e):n.loadLayersModel(e)}const kpe=(n,e)=>wpe(n,e)?e.layers[0].batchInputShape:e.inputs[0].shape,Tpe=(n,{model:e})=>{const t=kpe(n,e);if(!w9(t))throw new Error(ape(t));return t},Y5=(n,e)=>Math.ceil(e/n)*n,Npe=(n,e,{patchSize:t,padding:s},r)=>{const a=Tpe(n,e);if(t!==void 0){if(t<=0)throw ope(t);if(s!==void 0&&s*2>=t)throw lpe(t,s)}if(x9(a)){if(t!==void 0&&gv(ipe),a[1]!==a[2])throw hpe;return{patchSize:a[1],padding:s,modelInputShape:a}}t!==void 0&&s===void 0&&gv(Gfe);const{divisibilityFactor:o}=e.modelDefinition;if(o!==void 0){if(t!==void 0){const l=Y5(o,t);return l!==t&&gv(upe(t,o,l)),{patchSize:l,padding:s,modelInputShape:[null,l,l,3]}}return{patchSize:void 0,padding:void 0,modelInputShape:[null,Y5(o,r[1]),Y5(o,r[2]),3]}}return{patchSize:t,padding:s,modelInputShape:void 0}},Ape=(n,e)=>t=>{const s=t.shape[1],r=t.shape[2];return x9(e)&&(e[1]>s||e[2]>r)?n.tidy(()=>{const a=Math.max(s,e[1]),o=Math.max(r,e[2]),l=n.zeros([1,s,o-r,3]),c=n.zeros([1,a-s,o,3]),u=n.concat([t,l],2);return n.concat([u,c],1)}):t},Bz=(n,e,t)=>s=>{const r=e[1]*t,a=e[2]*t;return r<s.shape[1]||a<s.shape[2]?n.tidy(()=>n.slice(s,[0,0,0],[1,r,a,3])):s},jz=n=>e=>{const t=_9(n)?n[1]:255;return e.clipByValue(0,t).mul(t===1?255:1)},Epe=(n,e)=>t=>_9(e)&&e[1]===1?n.mul(t,1/255):t,Ipe=(n,e)=>n.tidy(()=>{const[t,s]=e.shape,r=n.fill([t,s],255).expandDims(2);return e.clipByValue(0,255).concat([r],2).dataSync()});function Ope(n){return X2(n)?n.clone():n}function Uz(n,e,t=0){const s=e.filter(T9);if(s.length===0)throw Qfe;const r=n.concat(s,t);return e.forEach(a=>a?.dispose()),r}const Vz=(n,e,t,s)=>{let r=e;const a=e===0||t===n?0:s,o=r+t>n;let l=o?t-(n-r):0;const c=o||t===n?0:s,u=o?0:a;let d=t-(o?l:0);o&&(r=n-t),r-=u,l+=u,d-=u+c;const p=t>n?n:t-a-c;return{pre:{origin:r,size:t},post:{origin:l,size:d},increment:p}},Dpe=([n,e],t,s)=>{const r=[];let a=0,o=0;for(;o<e;){const{pre:{origin:l,size:c},post:{origin:u,size:d},increment:p}=Vz(e,o,Math.min(t,e),s),m=[];for(;a<n;){const{pre:{origin:g,size:b},post:{origin:v,size:x},increment:S}=Vz(n,a,Math.min(t,n),s);m.push({pre:{origin:[l,g],size:[c,b]},post:{origin:[u,v],size:[d,x]}}),a+=S}r.push(m),a=0,o+=p}return r},$pe=(n,e,t,s)=>(n*t+e+1)/s,Wz=(n,e)=>{const t=n.predict(e);if(!X2(t))throw new Error(Jfe);if(C9(t))return t;throw new Error(Kfe(t.shape))};async function*Rpe(n,e,{output:t,progress:s,progressOutput:r},a,{originalImageSize:o,patchSize:l,padding:c=0},{tensorAsBase64:u}){const{model:d,modelDefinition:p}=a,m=p.scale??1;if(l){const[x,S]=e.shape.slice(1),C=Dpe([S,x],l,c);yield;let A;const k=C.length*C[0].length;for(let $=0;$<C.length;$++){const M=C[$],R=M.length;let z;yield[z,A];for(let I=0;I<R;I++){const{pre:j,post:H}=M[I];yield[A,z];const q=e.slice([0,...j.origin],[-1,...j.size]);yield[A,z,q];const re=Wz(d,q);q.dispose(),yield[A,z,re];const X=[0,H.origin[0]*m,H.origin[1]*m],ne=[-1,H.size[0]*m,H.size[1]*m],Q=re.slice(X,ne);re.dispose(),yield[A,z,Q];const he=yv(n,Q,p.postprocess,jz(p.outputRange));if(yield[A,z,he],s!==void 0&&nR(s)){const ye=$pe($,I,R,k);if(zfe(s))s(ye);else{const Y=he.squeeze(),B={row:$,col:I,patchCoordinates:{pre:j,post:H}};if(Bfe(s,t,r))s(ye,Y,B);else{const G=u(n,Y);Y.dispose(),s(ye,G,B)}}}yield[A,z,he],z=Uz(n,[z,he],2),he.dispose(),yield[A,z]}A=Uz(n,[A,z],1),z.dispose(),yield[A]}const O=yv(n,A.clone(),Bz(n,o,m));A?.dispose(),yield[O];const F=O.squeeze();return O.dispose(),F}s&&gv(Xfe);const g=Wz(d,e);yield[g];const b=yv(n,g.clone(),p.postprocess,jz(p.outputRange),Bz(n,o,m));g.dispose(),yield[b];const v=b.squeeze();return b.dispose(),v}async function*Lpe(n,e,t,s,{getImageAsTensor:r,tensorAsBase64:a}){const o=Ope(e),l=await r(n,o);yield l;const c=l.shape,{patchSize:u,padding:d,modelInputShape:p}=Npe(n,s,t,c),m=yv(n,l,s.modelDefinition.preprocess,Epe(n,s.modelDefinition.inputRange),p?Ape(n,p):void 0);yield m;const g=Rpe(n,m,{output:t.output,progressOutput:t.progressOutput,progress:t.progress},s,{originalImageSize:c,patchSize:u,padding:d},{tensorAsBase64:a});let b=await g.next();for(yield b.value;!b.done;)b=await g.next(),Array.isArray(b.value)?yield[...b.value,m]:X2(b.value)?yield[b.value,m]:yield m;m.dispose();const v=b.value;if(t.output==="tensor")return v;const x=a(n,v);return v.dispose(),x}async function Fpe(n,e,{signal:t,awaitNextFrame:s,...r},a,{checkValidEnvironment:o,...l}){o(e,{output:r.output,progressOutput:r.progressOutput});const c=N9(n,t||a.signal,s);await c();const u=await k9(Lpe(n,e,r,a,l),c);return await c(),u}const Mpe=fie;function Ppe({tf:n,getUpscaleOptions:e,checkValidEnvironment:t,getImageAsTensor:s,tensorAsBase64:r,loadModel:a}){class o{_opts;_model;ready;_abortController=new AbortController;constructor(c={}){this._opts={...c},this._model=a(n,_pe(n,this._opts.model||Mpe)),this.ready=new Promise((u,d)=>{this._model.then(()=>Pz(n,this._model,this._opts.warmupSizes||[],void 0,{signal:this._abortController.signal})).then(u).catch(d)})}async execute(c,u){const d={checkValidEnvironment:t,getImageAsTensor:s,tensorAsBase64:r};await this.ready;const p=await this._model;return Fpe(n,c,e(u),{...p,signal:this._abortController.signal},d)}upscale=this.execute.bind(this);warmup=async(c=[],u)=>(await this.ready,Pz(n,this._model,c,u,{signal:this._abortController.signal}));abort=()=>{this._abortController.abort(),this._abortController=new AbortController};dispose=async()=>{await this.ready;const{model:c,modelDefinition:u}=await this._model;u.teardown&&await u.teardown(n),c.dispose()};getModel=()=>this._model}return o}const A9={kernelName:Sw,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,og(ft(t,"float32"),-1))}}};const zpe={kernelName:b1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=As(ft(t,"float32")),r=Qi(St(Xt(1),s));return Gs(Bt(n,r))}}}};const Bpe={kernelName:v1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Qi(St(As(ft(t,"float32")),1));return Bt(n,s)}}}};const jpe={kernelName:rg,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{let l=n;const c=si(t.shape,r);return c.length>0&&(l=It(l,c)),_e(l,t.shape)},b:()=>{let l=n;const c=si(s.shape,r);return c.length>0&&(l=It(l,c)),_e(l,s.shape)}}}};const Upe={kernelName:Cw,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};const Vpe={kernelName:_w,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kn(t)}}};const Wpe={kernelName:kw,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kn(t)}}};const Hpe={kernelName:w1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,Qi(St(Xt(1),As(ft(t,"float32")))))}}};const Gpe={kernelName:x1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Qi(at(Xt(1),As(ft(t,"float32"))));return Bt(n,s)}}}};const qpe={kernelName:_1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{const l=at(As(t),As(s));let c=Se(n,Bt(s,l));const u=si(t.shape,r);return u.length>0&&(c=It(c,u)),_e(c,t.shape)},b:()=>{const l=at(As(t),As(s));let c=Gs(Se(n,Bt(t,l)));const u=si(s.shape,r);return u.length>0&&(c=It(c,u)),_e(c,s.shape)}}}};const Xpe={kernelName:S1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,at(As(ft(t,"float32")),1))}}};const Ype={kernelName:C1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,St(Xt(1),As(ft(t,"float32"))))}}};function Kpe(n,e,t,s,r,a){const o=ie(n,"dy","avgPool3dGrad"),l=ie(e,"input","avgPool3dGrad");let c=o,u=l,d=!1;l.rank===4&&(d=!0,c=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=_e(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),ee(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),ee(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Fa("avgPool3dGrad",r,a);const p={dy:c,input:u},m={filterSize:t,strides:s,pad:r,dimRoundingMode:a},g=be.runKernel(ck,p,m);return d?_e(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const Zpe=ve({avgPool3dGrad_:Kpe});const Jpe={kernelName:Nw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:a,pad:o,dimRoundingMode:l}=t;return{x:()=>Zpe(n,s,r,a,o,l)}}};function Qpe(n,e,t,s,r){const a=ie(n,"dy","avgPoolGrad"),o=ie(e,"input","avgPoolGrad");ee(o.rank===a.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${a.rank})`);let l=o,c=a,u=!1;o.rank===3&&(u=!0,l=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ee(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),ee(l.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`);const d={dy:c,input:l},p={filterSize:t,strides:s,pad:r},m=be.runKernel(lk,d,p);return u?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const eme=ve({avgPoolGrad_:Qpe});const tme={kernelName:Tw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:a,pad:o}=t;return{x:()=>eme(n,s,r,a,o)}}};const nme={kernelName:Aw,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:a,transposeB:o}=t;return!a&&!o?{a:()=>Ln(n,r,!1,!0),b:()=>Ln(s,n,!0,!1)}:!a&&o?{a:()=>Ln(n,r,!1,!1),b:()=>Ln(n,s,!0,!1)}:a&&!o?{a:()=>Ln(r,n,!1,!0),b:()=>Ln(s,n,!1,!1)}:{a:()=>Ln(r,n,!0,!0),b:()=>Ln(n,s,!0,!0)}}};const sme={kernelName:Ew,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>P2(n,s,r)}}};const rme={kernelName:XU,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,a=s.shape,o=Array.from(a);for(let c=r.length-1;c>=0;c--)if(r[c]===a[c])o[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${a}].`);const l=[];for(let c=0;c<o.length;c++)o[c]>1&&l.push(c);return{x:()=>It(n,l,!0)}}};const ime={kernelName:k1,gradFunc:n=>({x:()=>n.clone()})};const ame={kernelName:T1,gradFunc:n=>({x:()=>Kn(n)})};const ome={kernelName:N1,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:a}=t;return{x:()=>Di(mc(Rd(s,r),ap(s,a)),n,Kn(n))}}};const lme={kernelName:Ow,inputsToSave:["x"],gradFunc:A9.gradFunc};const cme={kernelName:Dw,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(c=>c.shape),{axis:r}=t,a=Fn(r,e[0].shape)[0],o=s.map(c=>c[a]);return ro(n,o,a).map(c=>()=>c)}};const ume={kernelName:$w,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:a,strides:o,pad:l,dataFormat:c}=t;return ee(Gf(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>FD(s.shape,n,r,o,l,c),filter:()=>v$(s,n,r.shape,o,l,c)}}};const hme={kernelName:Rw,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c}=t;return{dy:()=>Cd(n,r,a,o,l,1,c),filter:()=>v$(n,s,r.shape,a,o,l,c)}}};function dme(n,e,t,s,r){let a=n;n.rank===4&&(a=_e(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=_e(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ee(a.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`),ee(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ee(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ee(a.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${t[3]}.`),ee(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const l={x:a,dy:o},c={strides:s,pad:r,filterShape:t};return be.runKernel(pk,l,c)}const fme=ve({conv3DBackpropFilter_:dme});const pme={kernelName:Lw,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:a}=t;ee(Gf(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,l]=e;return{x:()=>NV(o.shape,n,l,r,a),filter:()=>fme(o,n,l.shape,r,a)}}};const mme={kernelName:A1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(Gs(OT(ft(t,"float32"))),n)}}};const gme={kernelName:E1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(DT(ft(t,"float32")),n)}}};const yme={kernelName:Fw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:a,reverse:o}=t;return{x:()=>{const l=yr([r],s.rank);let c=vT(n,r,a,!o);return l!=null&&(c=Wn(c,l)),c}}}};const bme={kernelName:Mw,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:a,dimRoundingMode:o}=t,l=s??[1,1];ee(Gf(l),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);const[c,u]=e;return ee(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),ee(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),ee(c.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),ee(ta(r,l),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${l}'.`),Fa("depthwiseConv2d",a,o),{x:()=>y3(c.shape,n,u,r,a,l,o),filter:()=>g3(c,n,u.shape,r,a,l,o)}}};const vme={kernelName:Pw,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,a={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>be.runKernel(JC,a,t),filter:()=>be.runKernel(QC,o,t)}}};const wme={kernelName:O1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>be.runKernel(kk,s)}}};const xme={kernelName:D1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=Se(ho(Gs(As(t))),2/Math.sqrt(Math.PI));return{x:()=>Se(n,s)}}};const Sme={kernelName:$1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,t)}}};const Cme={kernelName:Bw,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>_e(n,t.shape)}}};const _me={kernelName:R1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,ho(t))}}};const kme={kernelName:L1,gradFunc:n=>({x:()=>Kn(n)})};const Tme={kernelName:F1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{const l=Bt(n,ft(s,"float32")),c=si(t.shape,r);return c.length>0?_e(It(l,c),t.shape):l},b:()=>{let l=Se(n,ft(t,"float32"));const c=si(s.shape,r);c.length>0&&(l=_e(It(l,c),s.shape));const u=As(s);return Gs(Bt(l,ft(u,"float32")))}}}};const Nme={kernelName:jw,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,a,o,l]=e,c=l??Xt(1),u=si(a.shape,r.shape),d=[];if(a.rank===1){for(let k=0;k<r.shape.length-1;++k)d.push(r.shape[k]);d.push(1)}const p=St(r,a),m=Se(n,c),g=AT(at(o,Xt(s))),b=Se(Se(Se(g,g),g),Xt(-.5));return{x:()=>a.rank===1?_e(Se(Se(n,kl(_e(g,[1,1,1,a.shape[0]]),d)),c),r.shape):_e(Se(Se(n,g),c),r.shape),mean:()=>{let k=Se(Se(g,Xt(-1)),m);return a.rank===1&&(k=It(k,u)),_e(k,a.shape)},variance:()=>{let k=Se(Se(b,p),m);return a.rank===1&&(k=It(k,u)),_e(k,a.shape)},scale:()=>{const k=Se(p,g);let O=Se(n,k);return a.rank===1&&(O=It(O,u)),_e(O,a.shape)},offset:()=>{let k=n;return a.rank===1&&(k=It(k,u)),_e(k,a.shape)}}}};const Ame={kernelName:Uw,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:a,batchDims:o}=t,l=Fn(a,s.shape)[0],c=(u,d,p)=>()=>{const m=u.shape,g=d.size,b=m.slice(0,l),v=b.length,x=m.slice(a,m.length).slice(1),S=x.length,C=Hz(0,v),A=Hz(v+1,v+1+S),k=Gz([b,[g],x]),O=_e(p,k),F=_e(d,[g]),$=Gz([[v],C,A]),M=Wn(O,$);let R=PT(M,F,u.shape[l]);const z=ip($);return R=Wn(R,z),R};if(o===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>Ra(d.map((g,b)=>c(g,r.slice(b,1),n.slice(b,1))())).reshape(s.shape),indices:()=>r}}else return{x:c(s,r,n),indices:()=>r}}};function Hz(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function Gz(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}const Eme={kernelName:M1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Kn(t),b:()=>Kn(s)}}};const Ime={kernelName:P1,gradFunc:n=>({x:()=>ft(n,"float32")})};const Ome={kernelName:z1,gradFunc:n=>({x:()=>Kn(n)})};const Dme={kernelName:B1,gradFunc:n=>({x:()=>Kn(n)})};const $me={kernelName:j1,gradFunc:n=>({x:()=>Kn(n)})};const Rme={kernelName:Ww,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,a=Ma(s,0);return{x:()=>Di(a,n,Se(n,r))}}};const Lme={kernelName:V1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,at(t,1))}}};const Fme={kernelName:U1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,ft(t,"float32"))}}};const Mme={kernelName:YU,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=ho(s);return St(n,Se(It(n,r,!0),o))}}}};function Pme(n,e,t,s=5,r=1,a=1,o=.5){const l={x:n,y:e,dy:t},c={depthRadius:s,bias:r,alpha:a,beta:o};return be.runKernel($k,l,c)}const zme=ve({localResponseNormalizationBackprop_:Pme});const Bme={kernelName:Kw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:a,bias:o,alpha:l,beta:c}=t;return{x:()=>zme(s,r,n,a,o,l,c)}}};function E9(n,e,t,s){return e.rank<t.rank&&(e=_e(e,zr(e.shape,s))),n.rank<t.rank&&(n=_e(n,zr(n.shape,s))),{x:()=>Se(n,ft(Go(t,e),n.dtype))}}const qz={kernelName:Zw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,a=e[0],o=e[1],l=Fn(r,a.shape),c=E9(n,o,a,l);return{x:()=>c.x()}}};const jme={kernelName:W1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Se(n,ft(Rd(t,s),"float32")),b:()=>Se(n,ft(H0(t,s),"float32"))}}};function Ume(n,e,t,s,r,a,o){const l=ie(n,"dy","maxPool3dGrad"),c=ie(e,"input","maxPool3dGrad"),u=ie(t,"output","maxPool3dGrad");let d=l,p=c,m=u,g=!1;c.rank===4&&(g=!0,d=_e(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=_e(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),m=_e(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),ee(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),ee(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),ee(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Fa("maxPool3dGrad",a,o);const b={dy:d,input:p,output:m},v={filterSize:s,strides:r,pad:a,dimRoundingMode:o},x=be.runKernel(Lk,b,v);return g?_e(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const Vme=ve({maxPool3dGrad_:Ume});const Wme={kernelName:Qw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=t;return{x:()=>Vme(n,s,r,a,o,l,c)}}};function Hme(n,e,t,s,r,a,o){const l=ie(n,"dy","maxPoolGrad"),c=ie(e,"input","maxPoolGrad"),u=ie(t,"output","maxPoolGrad");ee(c.rank===l.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${l.rank})`),ee(l.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),ee(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),Fa("maxPoolGrad",a,o);const d={dy:l,input:c,output:u},p={filterSize:s,strides:r,pad:a,dimRoundingMode:o};return be.runKernel(Rk,d,p)}const Gme=ve({maxPoolGrad_:Hme});const qme={kernelName:Jw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:a,strides:o,pad:l}=t;return{x:()=>Gme(n,s,r,a,o,l)}}};const Xme={kernelName:e2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,a=Fn(r,s.shape),l=Fi(s.shape,a)[1],c=We(l);return{x:()=>{const d=s.shape.slice();a.forEach(g=>{d[g]=1});const p=_e(n,d);return Bt(Se(p,to(s.shape,"float32")),c)}}}};const Yme={kernelName:t2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[a,o]=e,l=Fn(r,a.shape),c=E9(n,o,a,l);return{x:()=>c.x()}}};const Kme={kernelName:H1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Se(n,ft(ap(t,s),"float32")),b:()=>Se(n,ft(Ma(t,s),"float32"))}}};const Zme={kernelName:n2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,a=r.map(o=>o[0]);return{x:()=>Xn(n,a,s.shape)}}};const Jme={kernelName:G1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{const l=si(t.shape,r);return l.length>0?_e(It(n,l),t.shape):n},b:()=>{const l=Se(n,Gs(yy(Bt(t,s)))),c=si(s.shape,r);return c.length>0?_e(It(l,c),s.shape):l}}}};const Qme={kernelName:q1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{const l=Se(n,ft(s,"float32")),c=si(t.shape,r);return c.length>0?_e(It(l,c),t.shape):l},b:()=>{const l=Se(n,ft(t,"float32")),c=si(s.shape,r);return c.length>0?_e(It(l,c),s.shape):l}}}};const ege={kernelName:s2,gradFunc:n=>({x:()=>Gs(n)})};const tge={kernelName:a2,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Qr(t.shape,"float32")}}};const nge={kernelName:i2,gradFunc:n=>({x:()=>Kn(n)})};const sge={kernelName:o2,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Ll(n,s).map(a=>()=>a)}};const Xz={kernelName:l2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,a=r.map(o=>o[0]);return{x:()=>Xn(n,a,s.shape)}}};const rge={kernelName:X1,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,a=t,o=s,l=Sn(a.shape,o.shape);return{a:()=>{const d=ft(o,"float32");let p=Se(n,Se(d,_d(a,St(d,Xt(1)))));const m=si(a.shape,l);return m.length>0&&(p=It(p,m)),_e(p,a.shape)},b:()=>{const d=Ma(a,0),p=Di(d,qo(a),Kn(a));let m=Se(n,Se(r,p));const g=si(o.shape,l);return g.length>0&&(m=It(m,g)),_e(m,o.shape)}}}};const ige={kernelName:c2,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Ma(t,0);return{x:()=>Di(r,n,Se(n,s)),alpha:()=>{let a=Di(r,Kn(n),Se(n,t));const o=si(s.shape,n.shape);return o.length>0&&(a=It(a,o)),_e(a,s.shape)}}}};function age(n,e,t){const s=n.shape.slice();s[t]=1;const r=_e(e,s),a=zv(n,t,!0,!1),o=zv(n,t,!0,!0),l=Se(a,o);return Se(r,l)}function oge(n,e,t){const s=n.shape.length,r=s-t.length,a=yr(t,s);let o=n;a!=null&&(o=Wn(n,a));const l=o.shape.slice(),u=l.splice(s-t.length,t.length).reduce((m,g)=>m*g,1);l.push(u);const d=o.reshape(l);let p=age(d,e,r);if(p=p.reshape(o.shape),a!=null){const m=ip(a);p=Wn(p,m)}return p}const lge={kernelName:u2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let a=[];return r==null?a=s.shape.map((o,l)=>l):typeof r=="number"?a=[r]:a=r,{x:()=>oge(s,n,a)}}};const cge={kernelName:I1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{const l=Bt(n,ft(s,"float32")),c=si(t.shape,r);return c.length>0?_e(It(l,c),t.shape):l},b:()=>{let l=Se(n,ft(t,"float32"));const c=si(s.shape,r);c.length>0&&(l=_e(It(l,c),s.shape));const u=As(s);return Gs(Bt(l,ft(u,"float32")))}}}};const uge={kernelName:Y1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,Gs(As(t)))}}};const hge={kernelName:Z1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=Se(ap(t,6),og(t));return{x:()=>Se(n,ft(s,"float32"))}}};const dge={kernelName:K1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,ft(og(t),"float32"))}}};const fge={kernelName:h2,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>_e(n,t.shape)}}};const pge={kernelName:f2,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>be.runKernel(qk,r,t)}}};const mge={kernelName:d2,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>be.runKernel(Gk,r,t)}}};const gge={kernelName:p2,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Fn(s,n.shape);return{x:()=>Rl(n,r)}}};const yge={kernelName:J1,gradFunc:n=>({x:()=>Kn(n)})};const bge={kernelName:Q1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Gs(Bt(n,Se(_d(t,1.5),2)))}}};const vge={kernelName:m2,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>ft(Kn(t),"float32"),t:()=>Se(n,ft(t,n.dtype)),e:()=>Se(n,ft(L2(t),n.dtype))}}};const wge={kernelName:ey,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ma(t,Xt(0)),r=Xt(JT),a=Xt(QT),o=Se(n,a),l=Se(Se(n,r),ho(ft(t,"float32")));return Di(s,o,l)}}}};const xge={kernelName:ry,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,Se(t,St(Xt(1),t)))}}};const Sge={kernelName:sy,gradFunc:n=>({x:()=>Kn(n)})};const Cge={kernelName:ty,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(I2(ft(t,"float32")),n)}}};const _ge={kernelName:ny,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(bT(ft(t,"float32")),n)}}};const kge={kernelName:g2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:a}=t,o=s.shape,[l,c]=KT(s,r,a),u=[];for(let d=0;d<n.rank;d++)u.push([l[d],o[d]-l[d]-c[d]]);return{x:()=>Ld(n,u)}}};const Tge={kernelName:w2,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,a=!0,o=Se(n,s);return{logits:()=>St(o,Se(It(o,[r],a),s))}}};const Nge={kernelName:iy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,lu(t))}}};const Yz={kernelName:b2,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>E2(n,s,r)}}};const Kz={kernelName:v2,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Pr(n,s)}}};const Age={kernelName:ay,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,Se(Qi(ft(t,"float32")),2))}}};const Ege={kernelName:nT,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(n,Se(ft(t,"float32"),2))}}};const Ige={kernelName:oy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Xt(2);return{a:()=>Se(n,Se(r,St(t,s))),b:()=>Se(n,Se(r,St(s,t)))}}};const Oge={kernelName:dy,gradFunc:n=>({x:()=>Kn(n)})};const Dge={kernelName:ly,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Sn(t.shape,s.shape);return{a:()=>{let l=n;const c=si(t.shape,r);return c.length>0&&(l=It(l,c)),_e(l,t.shape)},b:()=>{let l=n;const c=si(s.shape,r);return c.length>0&&(l=It(l,c)),_e(Gs(l),s.shape)}}}};const $ge={kernelName:y2,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:a}=t;Fn(a,s.shape).forEach(u=>{r[u]=1});const l=_e(n,r),c=Se(l,to(s.shape,"float32"));return{x:()=>c}}};const Rge={kernelName:cy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bt(n,As(I2(t)))}}};const Lge={kernelName:uy,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Se(St(Xt(1),As(t)),n)}}};const Fge={kernelName:hy,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=Kn(s);if(s.rank===1)for(let l=0;l<r[0];++l)o=at(o,Xn(n,[l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let l=0;l<r[0];++l)for(let c=0;c<r[1];++c)o=at(o,Xn(n,[l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let l=0;l<r[0];++l)for(let c=0;c<r[1];++c)for(let u=0;u<r[2];++u)o=at(o,Xn(n,[l*s.shape[0],c*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let l=0;l<r[0];++l)for(let c=0;c<r[1];++c)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)o=at(o,Xn(n,[l*s.shape[0],c*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};const Mge={kernelName:mm,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,a=ip(r);return{x:()=>Wn(n,a)}}};const Pge={kernelName:S2,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Ra(n,r)}}};const zge={kernelName:C2,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bge(n,t)}}};function Bge(n,e){const t=Th(e,Kn(e)),s=by(n,t);let r=Rd(e,Xt(0,"int32"));const a=s.rank-r.rank;for(let l=0;l<a;++l)r=qi(r,l+1);r=mc(r,to(s.shape,"bool"));const o=Kn(s);return Di(r,s,o)}const jge={kernelName:_2,gradFunc:n=>({x:()=>Kn(n)})};const Uge=[A9,zpe,Bpe,jpe,Upe,Vpe,Wpe,Hpe,Gpe,qpe,Xpe,Ype,Jpe,tme,nme,sme,rme,ime,ame,ome,lme,cme,hme,ume,pme,mme,gme,yme,bme,vme,cge,wme,xme,Sme,Cme,_me,Tme,kme,Nme,Ame,Eme,Ime,Ome,Dme,$me,Rme,Lme,Fme,Mme,Bme,qz,qz,jme,Wme,qme,Xme,Yme,Kme,Zme,Jme,Qme,ege,tge,nge,sge,Xz,Xz,rge,ige,lge,uge,hge,dge,fge,pge,mge,gge,yge,bge,vge,wge,xge,Sge,Cge,_ge,kge,Tge,Nge,Yz,Yz,Kz,Kz,Age,Ige,Ege,Oge,Dge,$ge,Rge,Lge,Fge,Mge,Pge,zge,jge];for(const n of Uge)KU(n);qe().prototype.abs=function(){return this.throwIfDisposed(),Xr(this)};qe().prototype.acos=function(){return this.throwIfDisposed(),yD(this)};qe().prototype.acosh=function(){return this.throwIfDisposed(),bD(this)};qe().prototype.add=function(n){return this.throwIfDisposed(),at(this,n)};qe().prototype.all=function(n,e){return this.throwIfDisposed(),mT(this,n,e)};qe().prototype.any=function(n,e){return this.throwIfDisposed(),Fv(this,n,e)};qe().prototype.argMax=function(n){return this.throwIfDisposed(),Im(this,n)};qe().prototype.argMin=function(n){return this.throwIfDisposed(),vD(this,n)};qe().prototype.asScalar=function(){return this.throwIfDisposed(),ee(this.size===1,()=>"The array must have only 1 element."),_e(this,[])};qe().prototype.asType=function(n){return this.throwIfDisposed(),ft(this,n)};qe().prototype.as1D=function(){return this.throwIfDisposed(),_e(this,[this.size])};qe().prototype.as2D=function(n,e){return this.throwIfDisposed(),_e(this,[n,e])};qe().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),_e(this,[n,e,t])};qe().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),_e(this,[n,e,t,s])};qe().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),_e(this,[n,e,t,s,r])};qe().prototype.asin=function(){return this.throwIfDisposed(),wD(this)};qe().prototype.asinh=function(){return this.throwIfDisposed(),xD(this)};qe().prototype.atan=function(){return this.throwIfDisposed(),SD(this)};qe().prototype.atan2=function(n){return this.throwIfDisposed(),CD(this,n)};qe().prototype.atanh=function(){return this.throwIfDisposed(),_D(this)};qe().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),A2(this,n,e,t,s)};qe().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),E2(this,n,e)};qe().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),fy(this,n,e,t,s,r)};qe().prototype.broadcastTo=function(n){return this.throwIfDisposed(),gm(this,n)};qe().prototype.cast=function(n){return this.throwIfDisposed(),ft(this,n)};qe().prototype.ceil=function(){return this.throwIfDisposed(),OD(this)};qe().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),uo(this,n,e)};qe().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Yn&&(n=[n]),Pr([this,...n],e)};qe().prototype.conv1d=function(n,e,t,s,r,a){return this.throwIfDisposed(),gT(this,n,e,t,s,r,a)};qe().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),yT(this,n,e,t,s,r)};qe().prototype.conv2d=function(n,e,t,s,r,a){return this.throwIfDisposed(),Cd(this,n,e,t,s,r,a)};qe().prototype.cos=function(){return this.throwIfDisposed(),I2(this)};qe().prototype.cosh=function(){return this.throwIfDisposed(),bT(this)};qe().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),zv(this,n,e,t)};qe().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),vT(this,n,e,t)};qe().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),zD(this,n,e)};qe().prototype.depthwiseConv2d=function(n,e,t,s,r,a){return this.throwIfDisposed(),py(this,n,e,t,s,r,a)};qe().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),BD(this,n,e,t,s,r)};qe().prototype.divNoNan=function(n){return this.throwIfDisposed(),jD(this,n)};qe().prototype.div=function(n){return this.throwIfDisposed(),Bt(this,n)};qe().prototype.dot=function(n){return this.throwIfDisposed(),UD(this,n)};qe().prototype.elu=function(){return this.throwIfDisposed(),my(this)};qe().prototype.equal=function(n){return this.throwIfDisposed(),Go(this,n)};qe().prototype.erf=function(){return this.throwIfDisposed(),VD(this)};qe().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),HD(this,n,e)};qe().prototype.exp=function(){return this.throwIfDisposed(),ho(this)};qe().prototype.expandDims=function(n){return this.throwIfDisposed(),qi(this,n)};qe().prototype.expm1=function(){return this.throwIfDisposed(),GD(this)};qe().prototype.fft=function(){return this.throwIfDisposed(),V2(this)};qe().prototype.flatten=function(){return this.throwIfDisposed(),_e(this,[this.size])};qe().prototype.floor=function(){return this.throwIfDisposed(),yy(this)};qe().prototype.floorDiv=function(n){return this.throwIfDisposed(),pT(this,n)};qe().prototype.gather=function(n,e,t){return this.throwIfDisposed(),by(this,n,e,t)};qe().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Rd(this,n)};qe().prototype.greater=function(n){return this.throwIfDisposed(),Ma(this,n)};qe().prototype.ifft=function(){return this.throwIfDisposed(),Y0(this)};qe().prototype.irfft=function(){return this.throwIfDisposed(),RT(this)};qe().prototype.isFinite=function(){return this.throwIfDisposed(),qD(this)};qe().prototype.isInf=function(){return this.throwIfDisposed(),XD(this)};qe().prototype.isNaN=function(){return this.throwIfDisposed(),YD(this)};qe().prototype.leakyRelu=function(n){return this.throwIfDisposed(),D2(this,n)};qe().prototype.lessEqual=function(n){return this.throwIfDisposed(),ap(this,n)};qe().prototype.less=function(n){return this.throwIfDisposed(),H0(this,n)};qe().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),KD(this,n,e,t,s)};qe().prototype.logSigmoid=function(){return this.throwIfDisposed(),ZD(this)};qe().prototype.logSoftmax=function(n){return this.throwIfDisposed(),ST(this,n)};qe().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),R2(this,n,e)};qe().prototype.log=function(){return this.throwIfDisposed(),qo(this)};qe().prototype.log1p=function(){return this.throwIfDisposed(),$2(this)};qe().prototype.logicalAnd=function(n){return this.throwIfDisposed(),mc(this,n)};qe().prototype.logicalNot=function(){return this.throwIfDisposed(),L2(this)};qe().prototype.logicalOr=function(n){return this.throwIfDisposed(),CT(this,n)};qe().prototype.logicalXor=function(n){return this.throwIfDisposed(),JD(this,n)};qe().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Ln(this,n,e,t)};qe().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),F2(this,n,e,t,s)};qe().prototype.max=function(n,e){return this.throwIfDisposed(),Il(this,n,e)};qe().prototype.maximum=function(n){return this.throwIfDisposed(),Th(this,n)};qe().prototype.mean=function(n,e){return this.throwIfDisposed(),pr(this,n,e)};qe().prototype.min=function(n,e){return this.throwIfDisposed(),W0(this,n,e)};qe().prototype.minimum=function(n){return this.throwIfDisposed(),qf(this,n)};qe().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),e$(this,n,e)};qe().prototype.mod=function(n){return this.throwIfDisposed(),t$(this,n)};qe().prototype.mul=function(n){return this.throwIfDisposed(),Se(this,n)};qe().prototype.neg=function(){return this.throwIfDisposed(),Gs(this)};qe().prototype.norm=function(n,e,t){return this.throwIfDisposed(),gy(this,n,e,t)};qe().prototype.notEqual=function(n){return this.throwIfDisposed(),Rm(this,n)};qe().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),G0(this,n,e,t)};qe().prototype.onesLike=function(){return this.throwIfDisposed(),Xo(this)};qe().prototype.pad=function(n,e){return this.throwIfDisposed(),Ld(this,n,e)};qe().prototype.pool=function(n,e,t,s,r,a){return this.throwIfDisposed(),n$(this,n,e,t,s,r,a)};qe().prototype.pow=function(n){return this.throwIfDisposed(),_d(this,n)};qe().prototype.prelu=function(n){return this.throwIfDisposed(),z2(this,n)};qe().prototype.prod=function(n,e){return this.throwIfDisposed(),s$(this,n,e)};qe().prototype.reciprocal=function(){return this.throwIfDisposed(),o$(this)};qe().prototype.relu=function(){return this.throwIfDisposed(),Cu(this)};qe().prototype.relu6=function(){return this.throwIfDisposed(),TT(this)};qe().prototype.reshapeAs=function(n){return this.throwIfDisposed(),_e(this,n.shape)};qe().prototype.reshape=function(n){return this.throwIfDisposed(),_e(this,n)};qe().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),x3(this,n,e,t)};qe().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),S3(this,n,e,t)};qe().prototype.reverse=function(n){return this.throwIfDisposed(),Rl(this,n)};qe().prototype.rfft=function(){return this.throwIfDisposed(),W2(this)};qe().prototype.round=function(){return this.throwIfDisposed(),NT(this)};qe().prototype.rsqrt=function(){return this.throwIfDisposed(),AT(this)};qe().prototype.selu=function(){return this.throwIfDisposed(),ET(this)};qe().prototype.separableConv2d=function(n,e,t,s,r,a){return this.throwIfDisposed(),IT(this,n,e,t,s,r,a)};qe().prototype.sigmoid=function(){return this.throwIfDisposed(),lu(this)};qe().prototype.sign=function(){return this.throwIfDisposed(),l$(this)};qe().prototype.sin=function(){return this.throwIfDisposed(),OT(this)};qe().prototype.sinh=function(){return this.throwIfDisposed(),DT(this)};qe().prototype.slice=function(n,e){return this.throwIfDisposed(),Xn(this,n,e)};qe().prototype.softmax=function(n){return this.throwIfDisposed(),U2(this,n)};qe().prototype.softplus=function(){return this.throwIfDisposed(),ag(this)};qe().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),P2(this,n,e)};qe().prototype.split=function(n,e){return this.throwIfDisposed(),ro(this,n,e)};qe().prototype.sqrt=function(){return this.throwIfDisposed(),Qi(this)};qe().prototype.square=function(){return this.throwIfDisposed(),As(this)};qe().prototype.squaredDifference=function(n){return this.throwIfDisposed(),LT(this,n)};qe().prototype.squeeze=function(n){return this.throwIfDisposed(),lp(this,n)};qe().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Yn?[this,n]:[this,...n];return Ra(t,e)};qe().prototype.step=function(n){return this.throwIfDisposed(),og(this,n)};qe().prototype.stridedSlice=function(n,e,t,s,r,a,o,l){return this.throwIfDisposed(),c$(this,n,e,t,s,r,a,o,l)};qe().prototype.sub=function(n){return this.throwIfDisposed(),St(this,n)};qe().prototype.sum=function(n,e){return this.throwIfDisposed(),It(this,n,e)};qe().prototype.tan=function(){return this.throwIfDisposed(),u$(this)};qe().prototype.tanh=function(){return this.throwIfDisposed(),Dm(this)};qe().prototype.tile=function(n){return this.throwIfDisposed(),kl(this,n)};qe().prototype.toBool=function(){return this.throwIfDisposed(),ft(this,"bool")};qe().prototype.toFloat=function(){return this.throwIfDisposed(),ft(this,"float32")};qe().prototype.toInt=function(){return this.throwIfDisposed(),ft(this,"int32")};qe().prototype.topk=function(n,e){return this.throwIfDisposed(),f$(this,n,e)};qe().prototype.transpose=function(n){return this.throwIfDisposed(),Wn(this,n)};qe().prototype.unique=function(n){return this.throwIfDisposed(),p$(this,n)};qe().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),PT(this,n,e)};qe().prototype.unstack=function(n){return this.throwIfDisposed(),Ll(this,n)};qe().prototype.where=function(n,e){return this.throwIfDisposed(),Di(n,this,e)};qe().prototype.zerosLike=function(){return this.throwIfDisposed(),Kn(this)};class Ku extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ku.prototype)}}class dc extends Error{constructor(e){super(e),Object.setPrototypeOf(this,dc.prototype)}}class Ne extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ne.prototype)}}class On extends Error{constructor(e){super(e),Object.setPrototypeOf(this,On.prototype)}}class rR extends Error{constructor(e){super(e),Object.setPrototypeOf(this,rR.prototype)}}class I9{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}function Mm(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Zu(n,e){if(!n)throw new rR(e)}function Zz(n,e){let t=0;for(const s of n)s===e&&t++;return t}function eo(n){return n.length===1?n[0]:n}function Ms(n){return Array.isArray(n)?n:[n]}function ld(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function nm(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ic={};function iR(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function pI(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>pI(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:pI(s))}}}function Y2(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const a=n;let o;if(a in t)o=t[a];else if(a in ic)o=ic[a];else if(o=e[a],o==null)throw new Ne(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const a=n;if(a.className==null||a.config==null)throw new Ne(`${s}: Improper config format: ${JSON.stringify(a)}.
'className' and 'config' must set.`);const o=a.className;let l,c;if(o in t?[l,c]=t[o]:o in ic?[l,c]=ic.className:o in e&&([l,c]=e[o]),l==null)throw new Ne(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const u={};for(const g of Object.keys(ic))u[g]=ic[g];for(const g of Object.keys(t))u[g]=t[g];const d=a.config;d.customObjects=u;const p=Object.assign({},ic);for(const g of Object.keys(t))ic[g]=t[g];pI(a.config);const m=c(l,a.config,t,r);return ic=Object.assign({},p),m}else{const u=Object.assign({},ic);for(const p of Object.keys(t))ic[p]=t[p];const d=new l(a.config);return ic=Object.assign({},u),d}}}function Vge(n,e){return n<e?-1:n>e?1:0}function TS(n,e){return-1*Vge(n,e)}function zf(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function Wge(n){if(n==null)throw new Ne(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function cg(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new Ne(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function aR(n,e,t=0,s=1/0){return Zu(t>=0),Zu(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Oi(n,e){Array.isArray(n)?(ee(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Oi(t,`element ${s+1} of ${e}`))):ee(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${O9(n)}.`)}function O9(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>O9(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function Hge(n,e,t){let s=t!=null?t():Gi(),r;return(...o)=>{const l=t!=null?t():Gi();return l-s<e||(s=l,r=n(...o)),r}}function D9(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}let Gge=0;function $9(){return Gge++}const NS={};function eN(n=""){return n in NS||(NS[n]=0),NS[n]+=1,n+NS[n].toString()}const qge=["channelsFirst","channelsLast"],Xge=["nearest","bilinear"],Yge=["valid","same","causal"],Kge=["max","avg"],Zge=["sum","mul","concat","ave"];const h0=new Map;function jr(n){cg(qge,"DataFormat",n)}function Jge(n){cg(Xge,"InterpolationFormat",n)}function Pl(n){cg(Yge,"PaddingMode",n)}function R9(n){cg(Kge,"PoolMode",n)}const bv=[],Jz="/";function bm(n,e){bv.push(n);try{const t=e();return bv.pop(),t}catch(t){throw bv.pop(),t}}function Qge(){return bv.length===0?"":bv.join(Jz)+Jz}function L9(n){if(!M9(n))throw new Error("Not a valid tensor name: '"+n+"'");return Qge()+n}function F9(n){if(!M9(n))throw new Error("Not a valid tensor name: '"+n+"'");h0.has(n)||h0.set(n,0);const e=h0.get(n);if(h0.set(n,h0.get(n)+1),e>0){const t=`${n}_${e}`;return h0.set(t,1),t}else return n}const e0e=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function M9(n){return!!n.match(e0e)}function t0e(n){return n===parseInt(n.toString(),10)}function Bf(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function K0(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Xf(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function mu(n,e){if(e<n)throw new Ne(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}let K5;function pi(){return K5==null&&(K5=SV().epsilon()),K5}function gu(){return"channelsLast"}function dh(n,e){return ft(n,e)}function K2(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),_e(n,t)}function n0e(n,e){return Le(()=>{if(n.shape.length!==2)throw new Ne(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=K2(n,1);return mI(t,[1,e,1])})}function s0e(n){const e=[Bf(n.shape)];return _e(n,e)}function r0e(n){if(n.rank<=1)throw new Ne(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Bf(n.shape,1)];return _e(n,e)}function vm(n,e,t){return Le(()=>{switch(n.rank){case 1:return B2(n,e,t);case 2:return $T(n,[e,0],[t,n.shape[1]]);case 3:return j2(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return X0(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Xn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Xn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new Ne(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Z5(n,e,t){return Le(()=>{switch(n.rank){case 1:return B2(n,e,t);case 2:return $T(n,[0,e],[n.shape[0],t]);case 3:return j2(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return X0(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new Ne(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function AS(n,e,t,s){return Le(()=>{switch(n.rank){case 1:return B2(n,e,t);case 2:switch(s){case 1:return vm(n,e,t);case 2:return Z5(n,e,t);default:throw new Ne(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return vm(n,e,t);case 2:return j2(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Z5(n,e,t);default:throw new Ne(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return vm(n,e,t);case 2:return X0(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return X0(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Z5(n,e,t);default:throw new Ne(`The axis is not within the rank of the tensor ${s}`)}default:throw new Ne(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function oR(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Pr(n,e)}function Qz(n,e){switch(n.rank){case 1:return DD([n,e]);case 2:return $D([n,e],0);case 3:return RD([n,e],0);case 4:return LD([n,e],0);default:throw new Ne(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function mI(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new Ne(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return kl(n,e)}function tN(n,e=0,t=1,s,r){return kT(n,e,t,s,r)}function fh(n,e,t,s){if(n.rank<2||e.rank<2)throw new On(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],a=e.shape.slice(-2)[0];if(r!==a)throw new On(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return oI({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?gI(n.rank,s,gu()):null,activation:t});{const r=n.shape.slice(),a=r.pop();n=_e(n,[-1,a]);const o=e.shape.slice(),l=o.pop(),c=o.pop(),u=[...o,l],d=Array.from({length:e.rank},(b,v)=>v===0?e.rank-2:v<=e.rank-2?v-1:v);e=_e(Wn(e,d),[c,-1]);const p=[...r,...u];return _e(oI({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?gI(n.rank,s,gu()):null,activation:t}),p)}}function P9(n,e,t){return Le(()=>(Array.isArray(e)?e=Ki(e,"int32"):e=ft(e,"int32"),by(n,e,t)))}function Z2(n){return Se(n,n)}function gI(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new Ne(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?_e(e,[1,s[0],1,1,1]):_e(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?_e(e,[1,1,1,1,s[0]]):_e(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?_e(e,[1,s[0],1,1]):_e(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?_e(e,[1,1,1,s[0]]):_e(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?_e(e,[1,s[0],1]):_e(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?_e(e,[1,1,s[0]]):_e(e,[1].concat(s))}else if(n<3)return e;throw new Ne(`Unsupported input rank by biasAdd: ${e.rank}`)}function _u(n,e,t){return Le(()=>(t==null&&(t=gu()),jr(t),at(n,gI(n.rank,e,t))))}function i0e(n,e=1){if(e!==1)throw new On(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return my(n)}function a0e(n){return Le(()=>Bt(n,at(Xr(n),1)))}function z9(n,e,t,s){return Le(()=>y$(n,e,t,s))}function o0e(n){return Le(()=>{const e=at(.5,Se(.2,n));return uo(e,0,1)})}function J2(n,e,t=!1){return t?n():e()}const l0e=["fanIn","fanOut","fanAvg"],c0e=["normal","uniform","truncatedNormal"];function u0e(n){cg(l0e,"FanMode",n)}function h0e(n){cg(c0e,"Distribution",n)}class bc extends lg{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class lR extends bc{apply(e,t){return Qr(e,t)}}lR.className="Zeros";lt(lR);class nN extends bc{apply(e,t){return to(e,t)}}nN.className="Ones";lt(nN);class cR extends bc{constructor(e){if(super(),typeof e!="object")throw new Ne(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new Ne(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return Le(()=>Se(Xt(this.value),to(e,t)))}getConfig(){return{value:this.value}}}cR.className="Constant";lt(cR);class uR extends bc{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return op(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}uR.className="RandomUniform";lt(uR);class hR extends bc{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new On(`randomNormal does not support dType ${t}.`);return tN(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}hR.className="RandomNormal";lt(hR);class dR extends bc{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new On(`truncatedNormal does not support dType ${t}.`);return MT(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}dR.className="TruncatedNormal";lt(dR);class fR extends bc{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return Le(()=>{if(e.length!==2||e[0]!==e[1])throw new Ne("Identity matrix initializer can only be used for 2D square matrices.");return Se(this.gain,wT(e[0]))})}getConfig(){return{gain:this.gain}}}fR.className="Identity";lt(fR);function d0e(n,e="channelsLast"){let t,s;if(jr(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Bf(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Bf(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Bf(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class fo extends bc{constructor(e){if(super(),e.scale<0)throw new Ne(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,u0e(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,h0e(this.distribution),this.seed=e.seed}apply(e,t){const s=d0e(e),r=s[0],a=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,a):o/=Math.max(1,(r+a)/2),this.distribution==="normal"){const l=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new On(`${this.getClassName()} does not support dType ${t}.`);return MT(e,0,l,t,this.seed)}else{const l=Math.sqrt(3*o);return op(e,-l,l,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}fo.className="VarianceScaling";lt(fo);class sN extends fo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return fo.className}}sN.className="GlorotUniform";lt(sN);class rN extends fo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return fo.className}}rN.className="GlorotNormal";lt(rN);class iN extends fo{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return fo.className}}iN.className="HeNormal";lt(iN);class aN extends fo{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return fo.className}}aN.className="HeUniform";lt(aN);class oN extends fo{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return fo.className}}oN.className="LeCunNormal";lt(oN);class lN extends fo{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return fo.className}}lN.className="LeCunUniform";lt(lN);class pR extends bc{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return Le(()=>{if(e.length<2)throw new On("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=We(e.slice(0,-1)),r=e[e.length-1],a=s*r;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],l=tN(o,0,1,t,this.seed),c=x$.qr(l,!1);let u=c[0];const p=c[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=Se(u,p.sign()),s<r&&(u=u.transpose()),Se(Xt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}pR.className="Orthogonal";lt(pR);const eB={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function tB(n,e={}){return Y2(n,Sl.getMap().classNameMap,e,"initializer")}function mr(n){return iR(n)}function rr(n){if(typeof n=="string"){const e=n in eB?eB[n]:n;if(e==="GlorotNormal")return new rN;if(e==="GlorotUniform")return new sN;if(e==="HeNormal")return new iN;if(e==="HeUniform")return new aN;if(e==="LeCunNormal")return new oN;if(e==="LeCunUniform")return new lN;{const t={};return t.className=e,t.config={},tB(t)}}else return n instanceof bc?n:tB(n)}function yI(n){return Array.isArray(n)&&Array.isArray(n[0])}function a_(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function dn(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new Ne(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function ls(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new Ne(`Expected exactly 1 Shape; got ${n.length}`)}else return n}function o_(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}const nB="Variable";class B9{constructor(e,t="float32",s=nB,r=!0,a=null){this.dtype=t??"float32",this.shape=e.shape,this.id=$9(),s=s??nB,this.originalName=L9(s),this.name=F9(this.originalName),this.trainable_=r,this.constraint=a,this.val=m$(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),f0e(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function f0e(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function bI(n){return n.map(e=>e.read())}function mR(n){n.forEach(e=>{e[0].write(e[1])})}class ti{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class yu{constructor(e,t,s,r,a,o,l){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=a,this.outputTensorIndex=l,this.id=$9(),o!=null&&(this.originalName=L9(o),this.name=F9(this.originalName)),this.rank=t.length}}let p0e=0;class cN{constructor(e,t){this.callArgs=t,this.id=p0e++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let m0e=0;class Mn extends lg{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=m0e++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=ld(s)+"_"+eN(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let a=null;e.batchSize!=null&&(a=e.batchSize),s=[a].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new dc(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new Ne(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return eo(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return eo(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ku(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ku(`Layer ${this.name} is not connected, no input to return.`);return eo(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ku(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ku(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return eo(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Ms(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Ms(this.inputSpec);if(t.length!==s.length)throw new Ne(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const a=t[r],o=s[r];if(o==null)continue;const l=a.rank;if(o.ndim!=null&&l!==o.ndim)throw new Ne(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${l}`);if(o.maxNDim!=null&&l>o.maxNDim)throw new Ne(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${l}`);if(o.minNDim!=null&&l<o.minNDim)throw new Ne(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${l}.`);if(o.dtype!=null&&a.dtype!==o.dtype)throw new Ne(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${a.dtype}.`);if(o.axes){const c=a.shape;for(const u in o.axes){const d=Number(u),p=o.axes[u],m=d>=0?c[d]:c[c.length+d];if(p!=null&&[p,null].indexOf(m)===-1)throw new Ne(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${p} but got shape ${c}.`)}}if(o.shape!=null)for(let c=0;c<o.shape.length;++c){const u=o.shape[c],d=a.shape[c];if(u!=null&&d!=null&&u!==d)throw new Ne(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${a.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=Ms(e),r=b0e(e),a=v0e(e);if(r===a)throw new Ne("Arguments to apply() must be all SymbolicTensors or all Tensors");return bm(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const l of Ms(e))o.push(l.shape);this.build(eo(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const l=Ms(o),c=[];for(let u of l)s.indexOf(u)!==-1&&(u=u.clone()),c.push(u);if(o=eo(c),this.activityRegularizer!=null)throw new On("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=g0e(e),l=this.computeOutputShape(o);let c;const u=y0e(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),l!=null&&l.length>0&&Array.isArray(l[0])?c=l.map((d,p)=>new yu(u,d,this,Ms(e),t,this.name,p)):c=new yu(u,l,this,Ms(e),t,this.name),this.addInboundNode(e,c,null,null,o,l,t),this._refCount++,this.activityRegularizer!=null)throw new On("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ku(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Ku(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new dc(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return o_(this.weights)}build(e){this.built=!0}getWeights(e=!1){return bI(e?this.trainableWeights:this.weights)}setWeights(e){Le(()=>{const t=this.weights;if(t.length!==e.length)throw new Ne(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=bI(t);for(let a=0;a<r.length;++a){const o=r[a],l=t[a],c=e[a];if(!jn(o.shape,c.shape))throw new Ne(`Layer weight shape ${o.shape} not compatible with provided weight shape ${c.shape}`);s.push([l,c])}mR(s)})}addWeight(e,t,s,r,a,o,l,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new Ne(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():rr("zeros"));const u=r.apply(t,s),d=new B9(u,s,e,o,l);return u.dispose(),a!=null&&this.addLoss(()=>a.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Ms(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s);if(t instanceof Array&&r instanceof Array){if(t.length!==r.length)throw new Error(`${this.name} outputs ${t.length} tensors but ${r.length} masks for those tensors`);for(let a=0;a<t.length;a++)t[a].kerasMask=r[a]}else{if(r instanceof Array)throw new Error(`{this.name} outputs a single tensor but ${r.length} masks`);if(t instanceof Array)throw new Error(`{this.name} outputs ${t.length} tensors but only one mask`);t.kerasMask=r}}addInboundNode(e,t,s,r,a,o,l=null){const c=Ms(e);t=Ms(t),s=Ms(s),r=Ms(r),a=a_(a),o=a_(o);const u=[],d=[],p=[];for(const m of c)u.push(m.sourceLayer),d.push(m.nodeIndex),p.push(m.tensorIndex);new cN({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:p,inputTensors:c,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:a,outputShapes:o},l);for(let m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function g0e(n){n=Ms(n);const e=[];for(const t of n)e.push(t.shape);return eo(e)}function y0e(n){return"float32"}function j9(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let a=0;a<s.inboundLayers.length;a++){const o=s.inputTensors[a],l=s.inboundLayers[a],c=s.nodeIndices[a],u=j9(o,l,c);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function b0e(n){let e=!0;for(const t of Ms(n))if(!(t instanceof yu)){e=!1;break}return e}function v0e(n){let e=!0;for(const t of Ms(n))if(t instanceof yu){e=!1;break}return e}class xy extends Mn{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:eN("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new Ne("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new Ne("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new Ne("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new yu(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new cN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Ne(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}xy.className="InputLayer";lt(xy);function U9(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new Ne("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new xy({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}function w0e(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return ft(e,n.dtype)}catch{throw new Ne(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Rf{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Rf)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=w0e(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new Ne(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof yu){if(this.id2Value[e.id]==null)throw new Ne(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Ne(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof yu){if(this.id2Value[e.id]==null)throw new Ne(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Ne(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&xn(this.id2Mask)}}const l_=new I9,c_=new I9;function x0e(n){l_?.setMaxEntries(n),c_?.setMaxEntries(n)}function Zb(n,e,t,s){const r=t==null?!1:t.training,a=Array.isArray(n),o=a?n:[n],l=o.map(b=>b.name),c=[],u=e.names();for(const b of l)u.indexOf(b)!==-1?c.push(e.getValue(b)):c.push(null);const d=l.join(",")+"|"+e.names().sort().join(",");let p=l_.get(d),m;if(p==null){const b=S0e(o,e);p=b.sorted,m=b.recipientCounts,l_.put(d,p),c_.put(d,m)}m={},r||Object.assign(m,c_.get(d));const g=new Rf(e);for(let b=0;b<p.length;++b){const v=p[b],x=v.sourceLayer;if(x instanceof xy)continue;const S=[],C=[],A=[];let k=!1;for(const R of v.inputs){const z=g.getValue(R),I=g.getMask(R);S.push(z),C.push(I),I!=null&&(k=!0),r||(m[R.name]--,m[R.name]===0&&!e.hasKey(R)&&l.indexOf(R.name)===-1&&!z.isDisposed&&R.sourceLayer.stateful!==!0&&A.push(z))}k&&(t=t||{},t.mask=C[0]);const O=Ms(x.apply(S,t));let F=null;x.supportsMasking&&(F=x.computeMask(S,C));const $=_0e(v),M=Array.isArray($)?$:[$];for(let R=0;R<M.length;++R){g.hasKey(M[R])||g.add(M[R],O[R],Array.isArray(F)?F[0]:F);const z=l.indexOf(M[R].name);z!==-1&&(c[z]=O[R])}r||xn(A)}return g.disposeMasks(),a?c:c[0]}function S0e(n,e){ee(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=sB(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const a of n){const{sorted:o,recipientMap:l}=sB(a,e);for(const c of o)r.has(c.name)||(t.push(c),r.add(c.name));for(const c in l)s[c]==null&&(s[c]=new Set),l[c].forEach(u=>s[c].add(u))}}return{sorted:t,recipientCounts:C0e(s)}}function C0e(n){const e={};for(const t in n)e[t]=n[t].size;return e}function sB(n,e){const t=new Set,s=[],r={};for(const l of e.names())t.add(l);const a=[],o=[];for(a.push(n);a.length>0;){const l=a[a.length-1];if(t.has(l.name)){a.pop();continue}const c=o[o.length-1]===a.length-1;if(l.inputs.length===0||c)a.pop(),s.push(l),t.add(l.name),c&&o.pop();else{o.push(a.length-1);for(const u of l.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(l.name),!t.has(u.name)&&a.push(u)}}return{sorted:s,recipientMap:r}}function _0e(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}const k0e=Re();k0e.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,x0e);function gR(n,e){return Le(()=>Qi(It(Se(n,n),e,!0)))}class Q2 extends lg{getConfig(){return{}}}class yR extends Q2{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Le(()=>{const t=gR(e,this.axis),s=uo(t,0,this.maxValue);return Se(e,Bt(s,at(pi(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}yR.className="MaxNorm";lt(yR);class bR extends Q2{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Le(()=>Bt(e,at(pi(),gR(e,this.axis))))}getConfig(){return{axis:this.axis}}}bR.className="UnitNorm";lt(bR);class vR extends Q2{apply(e){return Cu(e)}}vR.className="NonNeg";lt(vR);class wR extends Q2{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Le(()=>{const t=gR(e,this.axis),s=at(Se(this.rate,uo(t,this.minValue,this.maxValue)),Se(1-this.rate,t));return Se(e,Bt(s,at(pi(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}wR.className="MinMaxNorm";lt(wR);const rB={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function gi(n){return iR(n)}function iB(n,e={}){return Y2(n,Sl.getMap().classNameMap,e,"constraint")}function yi(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in rB?rB[n]:n,config:{}};return iB(t)}else return n instanceof Q2?n:iB(n)}function T0e(n){return new yR(n)}function N0e(n){return new bR(n)}function A0e(){return new vR}function E0e(n){return new wR(n)}const I0e=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:T0e,minMaxNorm:E0e,nonNeg:A0e,unitNorm:N0e},Symbol.toStringTag,{value:"Module"}));function O0e(){return new lR}function D0e(){return new nN}function $0e(n){return new cR(n)}function R0e(n){return new uR(n)}function L0e(n){return new hR(n)}function F0e(n){return new dR(n)}function M0e(n){return new fR(n)}function P0e(n){return new fo(n)}function z0e(n){return new sN(n)}function B0e(n){return new rN(n)}function j0e(n){return new iN(n)}function U0e(n){return new aN(n)}function V0e(n){return new oN(n)}function W0e(n){return new lN(n)}function H0e(n){return new pR(n)}const G0e=Object.freeze(Object.defineProperty({__proto__:null,constant:$0e,glorotNormal:B0e,glorotUniform:z0e,heNormal:j0e,heUniform:U0e,identity:M0e,leCunNormal:V0e,leCunUniform:W0e,ones:D0e,orthogonal:H0e,randomNormal:L0e,randomUniform:R0e,truncatedNormal:F0e,varianceScaling:P0e,zeros:O0e},Symbol.toStringTag,{value:"Module"}));async function Tf(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const a=n[r];if(typeof a!="number"){const o=a;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let a=0;a<r.length;++a)n[t[a]]=r[a][0];xn(s)}}function V9(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}var aB;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(aB||(aB={}));const q0e=125;class Z0{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class W9{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class X0e extends Z0{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const a=t[r];if(typeof a=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+a*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const l=Le(()=>at(this.totals[r],Se(a,s)));this.totals[r]=l,o?.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:Le(()=>{const r=Se(Bt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),fi(t[s])}))}}class H9 extends Z0{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const a in this.history){const o=this.history[a];for(let l=0;l<o.length;++l)if(typeof o[l]!="number"){const c=o[l];e.push(c.data()),t.push(a),s.push(l)}}const r=await Promise.all(e);for(let a=0;a<r.length;++a)this.history[t[a]][s[a]].dispose(),this.history[t[a]][s[a]]=r[a][0]}}class G9 extends Z0{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||F$,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=q0e),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");KC(this.yieldEvery)&&(this.maybeWait=Hge(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Tf(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Tf(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Tf(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Tf(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Tf(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):KC(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Tf(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Tf(e),await this.trainEnd(e))}}function q9(n,e){return n==null&&(n={}),n instanceof Z0?[n]:Array.isArray(n)&&n[0]instanceof Z0?n:Ms(n).map(s=>new G9(s,e))}class vl{constructor(){}static registerCallbackConstructor(e,t){ee(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),vl.checkForDuplicate(t),vl.constructors[e]==null&&(vl.constructors[e]=[]),vl.constructors[e].push(t)}static checkForDuplicate(e){for(const t in vl.constructors)vl.constructors[+t].forEach(r=>{if(r===e)throw new Ne("Duplicate callback constructor.")})}static clear(){vl.constructors={}}static createCallbacks(e){const t=[];for(const s in vl.constructors){const r=+s;e>=r&&t.push(...vl.constructors[r])}return t.map(s=>new s)}}vl.constructors={};function X9(n,e,t,s,r,a,o,l,c){const u=new H9,d=[new X0e,...vl.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const p=new W9(d);return p.setParams({epochs:t,initialEpoch:s,samples:r,steps:a,batchSize:o,verbose:e,doValidation:l,metrics:c}),{callbackList:p,history:u}}function cu(n,e={},t=!1){return Y2(n,Sl.getMap().classNameMap,e,"layer",t)}function u_(n,e){return Le(()=>{n.dtype!=="float32"&&(n=ft(n,"float32"));const t=It(Z2(n),e,!0),s=ig(t.shape,pi()),r=Qi(Th(t,s));return Bt(n,r)})}function ug(n,e){return Le(()=>pr(Z2(St(e,n)),-1))}function uN(n,e){return Le(()=>pr(Xr(St(e,n)),-1))}function Sy(n,e){return Le(()=>{const t=St(n,e),s=uo(Xr(n),pi(),Number.MAX_VALUE),r=Xr(Bt(t,s));return Se(100,pr(r,-1))})}function Y0e(n,e){return Le(()=>{const t=uo(e,pi(),Number.MAX_VALUE),s=qo(at(1,t)),r=uo(n,pi(),Number.MAX_VALUE),a=qo(at(1,r));return pr(Z2(St(s,a)),-1)})}function K0e(n,e){return Le(()=>{const t=Th(0,St(1,Se(n,e)));return pr(Z2(t),-1)})}function Z0e(n,e){return Le(()=>{const t=Th(0,St(1,Se(n,e)));return pr(t,-1)})}function J0e(n,e){return Le(()=>{const t=It(Se(n,e),-1),s=Il(Se(St(1,n),e),-1);return Th(0,at(1,St(s,t)))})}function Q0e(n,e){return Le(()=>{const t=Math.log(2),s=St(e,n),r=St(at(s,ag(Se(-2,s))),t);return pr(r,-1)})}function Bv(n,e,t=!1){return Le(()=>{if(t)e=U2(e);else{const s=It(e,e.shape.length-1,!0);e=Bt(e,s)}return e=uo(e,pi(),1-pi()),Gs(It(Se(ft(n,"float32"),qo(e)),e.shape.length-1))})}function h_(n,e,t=!1){return Le(()=>{const s=ft(yy(s0e(n)),"int32");e=uo(e,pi(),1-pi());const r=e.shape,a=_e(G0(s,r[r.length-1]),r);return Bv(a,e,t)})}function e1e(n,e){if(!jn(n.shape,e.shape))throw new Ne(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return Le(()=>{const t=Cu(e),s=Gs(Xr(e));return at(St(t,Se(e,n)),$2(ho(s)))})}function hN(n,e){return Le(()=>{let t;return t=uo(e,pi(),1-pi()),t=qo(Bt(t,St(1,t))),pr(e1e(n,t),-1)})}function t1e(n,e){return Le(()=>{const t=uo(n,pi(),1),s=uo(e,pi(),1);return It(Se(n,qo(Bt(t,s))),-1)})}function n1e(n,e){return Le(()=>{const t=qo(at(pi(),e));return pr(St(e,Se(n,t)),-1)})}function xR(n,e){return Le(()=>{const t=u_(n,-1),s=u_(e,-1),r=Se(t,s);return Gs(It(r,-1))})}const d_={meanSquaredError:ug,meanAbsoluteError:uN,meanAbsolutePercentageError:Sy,meanSquaredLogarithmicError:Y0e,squaredHinge:K0e,hinge:Z0e,categoricalHinge:J0e,logcosh:Q0e,categoricalCrossentropy:Bv,sparseCategoricalCrossentropy:h_,binaryCrossentropy:hN,kullbackLeiblerDivergence:t1e,poisson:n1e,cosineProximity:xR};function J5(n){if(typeof n=="string"){if(n in d_)return d_[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Ne(e)}else return n}function SR(n,e){return Le(()=>{const t=Se(.5,Xo(e)),s=dh(Ma(e,t),n.dtype);return pr(Go(n,s),-1)})}function CR(n,e){return Le(()=>dh(Go(Im(n,-1),Im(e,-1)),"float32"))}function Y9(n,e){return Le(()=>ft(It(mc(Go(n,1),Go(e,1))),"float32"))}function s1e(n,e){return Le(()=>ft(It(mc(Go(n,1),Go(e,0))),"float32"))}function r1e(n,e){return Le(()=>ft(It(mc(Go(n,0),Go(e,1))),"float32"))}function K9(n,e){return Le(()=>{const t=Y9(n,e),s=r1e(n,e),r=at(t,s);return ft(Di(Ma(r,0),Bt(t,r),0),"float32")})}function i1e(n,e){return Le(()=>{const t=Y9(n,e),s=s1e(n,e),r=at(t,s);return ft(Di(Ma(r,0),Bt(t,r),0),"float32")})}function Z9(n,e){return hN(n,e)}function J9(n,e){return n.rank===e.rank&&(n=lp(n,[n.rank-1])),e=Im(e,-1),e.dtype!==n.dtype&&(e=ft(e,n.dtype)),ft(Go(n,e),"float32")}const a1e=ug,o1e=ug,l1e=uN,c1e=uN,u1e=Sy,h1e=Sy,_R=Bv,d1e=xR,Q9=h_,f_={binaryAccuracy:SR,categoricalAccuracy:CR,precision:K9,categoricalCrossentropy:_R,sparseCategoricalCrossentropy:Q9,mse:a1e,MSE:o1e,mae:l1e,MAE:c1e,mape:u1e,MAPE:h1e,cosine:d1e};function f1e(n){if(typeof n=="string"&&n in f_)return f_[n];if(typeof n!="string"&&n!=null)return n;throw new Ne(`Unknown metric ${n}`)}function ES(n){if(Zu(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(d_))if(d_[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(f_))if(f_[t]===n){e=t;break}return e!==void 0?e:n.name}}function p1e(n){const e={Adagrad:()=>Kp.adagrad(.01),Adadelta:()=>Kp.adadelta(1,.95,pi()),Adam:()=>Kp.adam(.001,.9,.999,pi()),Adamax:()=>Kp.adamax(.002,.9,.999,pi(),0),RMSProp:()=>Kp.rmsprop(.001,.9,0,pi()),SGD:()=>Kp.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new Ne(`Unknown Optimizer ${n}`)}const oB=1*1024*1024;function lB(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!vI(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>oB&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${oB}.`)}}function vI(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!vI(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!vI(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}function m1e(n,e,t,s=console.log){const r=y1e(n),a=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!r){a.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(e)),p_(a,t,s),s("=".repeat(e));const l=n.layers;for(let d=0;d<l.length;++d)r?b1e(l[d],t,s):v1e(l[d],t,o,s),s((d===l.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const c=g1e(n),u=o_(n.nonTrainableWeights);s(`Total params: ${c+u}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function g1e(n){let e;return n.collectedTrainableWeights!=null?e=o_(n.collectedTrainableWeights):e=o_(n.trainableWeights),e}function y1e(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let a=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(a){e=!1;break}else a=!0;if(!e)break}return e}function p_(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function b1e(n,e,t){let s,r;try{r=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const a=n.name,o=n.getClassName(),l=[`${a} (${o})`,r,s,n.countParams().toString()];p_(l,e,t)}function v1e(n,e,t,s){let r,a;try{a=n.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{a="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const p of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(p)===-1))for(let m=0;m<p.inboundLayers.length;++m){const g=p.inboundLayers[m].name,b=p.nodeIndices[m],v=p.tensorIndices[m];o.push(`${g}[${b}][${v}]`)}const l=n.name,c=n.getClassName(),u=o.length===0?"":o[0],d=[`${l} (${c})`,a,r,n.countParams().toString(),u];p_(d,e,s);for(let p=1;p<o.length;++p)p_(["","","","",o[p]],e,s)}function eW(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function jv(n,e){if(n===null)return null;if(typeof n=="string")return nm(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const a=n[r];eW(e,r,a)?t.push(a):t.push(jv(a,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const a=nm(s);t[a]=jv(r,a)}}return t}}function wI(n,e){if(n==null)return null;if(typeof n=="string")return ld(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const a=n[r];eW(e,r,a)?t.push(a):t.push(wI(a,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],a=ld(s);(s==="name"||s==="className")&&typeof r=="string"?t[a]=r:t[a]=wI(r,s)}return t}}const dN="4.11.0";const w1e=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Jc extends Mn{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=eN(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],zf(this.inputs).length!==this.inputs.length)throw new Ne(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);zf(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const A=C.sourceLayer,k=C.nodeIndex,O=C.tensorIndex;this.outputLayers.push(A),this.outputLayersNodeIndices.push(k),this.outputLayersTensorIndices.push(O)}for(const C of this.inputs){const A=C.sourceLayer,k=C.nodeIndex,O=C.tensorIndex;Zu(k===0,"input layer has >1 nodes"),Zu(O===0,"input layer has >1 tensors"),this.inputLayers.push(A),this.inputLayersNodeIndices.push(k),this.inputLayersTensorIndices.push(O)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const A=this.inputLayers[C];if(!(A instanceof xy))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${A.getClassName()}.`);this.inputNames.push(A.name),this.feedInputShapes.push(A.batchInputShape),this.feedInputNames.push(A.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},s={},r={},a={},o={},l=[],c=(C,A,k,O,F,$)=>{(O==null||F==null||$==null)&&(O=C.sourceLayer,F=C.nodeIndex,$=C.tensorIndex);const M=O.inboundNodes[F];if(k.indexOf(M)!==-1)throw new dc(`The tensor ${C.name} at layer "${O.name}" is part of a cycle.`);if(A.indexOf(M)!==-1)return;this.containerNodes.add(Jc.nodeKey(O,F)),O.id in o||(o[O.id]=Object.keys(o).length),k.indexOf(M)===-1&&k.push(M);const R=M.inboundLayers.length;for(let z=0;z<R;z++){const I=M.inputTensors[z],j=M.inboundLayers[z],H=M.nodeIndices[z],q=M.tensorIndices[z];c(I,A,k,j,H,q)}for(A.push(M);k.indexOf(M)>=0;)k.splice(k.indexOf(M),1);l.push(M)},u=[],d=[];for(const C of this.outputs)c(C,u,d);const p=l.slice().reverse();for(const C of p){s[C.id]=C,C.id in t||(t[C.id]=0);let A=t[C.id];const k=r[C.outboundLayer.id]==null?0:r[C.outboundLayer.id];A=Math.max(A,k),r[C.outboundLayer.id]=A,a[C.outboundLayer.id]=C.outboundLayer,t[C.id]=A;for(let O=0;O<C.inboundLayers.length;O++){const F=C.inboundLayers[O],$=C.nodeIndices[O],M=F.inboundNodes[$],R=t[M.id]==null?0:t[M.id];t[M.id]=Math.max(A+1,R),s[M.id]=M}}const m={};for(const C in t){const A=t[C];A in m||(m[A]=[]),m[A].push(s[C])}const g={};for(const C in r){const A=r[C];A in g||(g[A]=[]),g[A].push(a[C])}let b=Object.keys(g).map(C=>parseInt(C,10)).sort(TS);this.layers=[];for(const C of b){const A=g[C];A.sort((k,O)=>{const F=o[k.id],$=o[O.id];return F<$?-1:F>$?1:0});for(const k of A)k instanceof Jc&&this.internalContainerRefs.push(k),this.layers.push(k)}this.layersByDepth=g,b=Object.keys(m).map(C=>parseInt(C,10)).sort(TS);const v=this.inputs.slice(),x=[];for(const C of b)for(const A of m[C]){const k=A.outboundLayer;if(k!=null){for(const O of A.inputTensors)if(v.indexOf(O)===-1)throw new dc(`Graph disconnected: cannot obtain value for tensor ${O} at layer "${k.name}". The following previous layers were accessed without issue: ${x}`);for(const O of A.outputTensors)v.push(O);x.push(k.name)}}this.nodesByDepth=m;const S=this.layers.map(C=>C.name);for(const C of S){const A=S.filter(k=>k===C).length;if(A!==1)throw new dc(`The name "${C}" is used ${A} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(S))}this.outboundNodes=[],this.inboundNodes=[],new cN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Ne("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const a=w1e(e);a&&this.parseWeights(e);for(const l of this.layers)for(const[c,u]of l.weights.entries()){const d=a?`${u.name.split("/").slice(0,-1).join("/")+"/"}${c}`:u.originalName;if(s[d]!=null)throw new Ne(`Duplicate weight name: ${d}`);s[d]=u,r++}const o=[];for(const l in e){let c=l;if(s[l]==null){const u=l.split("/");c=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[c]!=null)o.push([s[c],e[l]]);else if(t)throw new Ne(`Provided weight data has no target variable: ${l}`);delete s[c]}if(t){const l=[];for(const c in s)l.push(c);if(l.length>0)throw new Ne(`${l.length} of ${r} weights are not set: ${l}`)}mR(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],a=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");a!==t&&(e[a]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${dN}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=wI(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return Le(()=>{e=Ms(e);const s=new Rf;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Zb(this.outputs,s,t)})}computeMask(e,t){return Le(()=>{e=Ms(e);let s;return t==null?s=Mm(null,e.length):s=Ms(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=a_(e);if(t.length!==this.inputLayers.length)throw new Ne(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let l=0;l<t.length;l++){const c=this.inputLayers[l],u=t[l],d=c.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(TS);if(r.length>1)for(const l of r){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(d.id)!==-1)continue;const p=[];for(let v=0;v<u.inboundLayers.length;v++){const x=u.inboundLayers[v],S=u.nodeIndices[v],C=u.tensorIndices[v],A=`${x.name}_${S}_${C}`,k=s[A];p.push(k)}const m=d.computeOutputShape(eo(p)),g=a_(m),b=d.inboundNodes.indexOf(u);for(let v=0;v<g.length;v++){const x=`${d.name}_${b}_${v}`;s[x]=g[v]}}}const a=[],o=[];for(let l=0;l<this.outputLayers.length;l++){const c=this.outputLayers[l],u=this.outputLayersNodeIndices[l],d=this.outputLayersTensorIndices[l],p=`${c.name}_${u}_${d}`;o.push(p)}for(let l=0;l<o.length;l++){const c=o[l];Zu(c in s),a.push(s[c])}return eo(a)}runInternalGraph(e,t){t==null&&(t=Mm(null,e.length));const s={};for(let c=0;c<this.inputs.length;++c){const u=this.inputs[c],d=e[c],p=t[c];s[u.id]=[d,p]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(TS);for(const c of r){const u=this.nodesByDepth[c];for(const d of u){const p=d.outboundLayer,m=d.inputTensors,g=d.outputTensors,b=new Array;for(const v of m)v.id in s&&b.push(s[v.id]);if(b.length===m.length){let v={},x,S,C,A;if(d.callArgs!=null&&(v=d.callArgs),b.length===1){const[k,O]=b[0];v.mask==null&&(v.mask=O),C=Ms(p.call(k,v)),A=Ms(p.computeMask(k,O)),x=[k],S=[O]}else x=b.map(k=>k[0]),S=b.map(k=>k[1]),v.mask==null&&(v.mask=S),C=Ms(p.call(x,v)),A=Ms(p.computeMask(x,S));if(p.activityRegularizer)throw new On("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let k=0;k<g.length;++k){const O=g[k],F=C[k],$=A[k];s[O.id]=[F,$]}}}}const a=[],o=[],l=[];for(const c of this.outputs){Zu(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[u,d]=s[c.id];l.push(u.shape),a.push(u),o.push(d)}return[a,o,l]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Jc?1:0;for(let a=0;a<r.inboundNodes.length;a++){const o=Jc.nodeKey(r,a);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new Ne("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new Ne(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new Ne(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Le(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Jc.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const l=o.getClassName(),c=o.getConfig(),u=[];for(let p=0;p<o.inboundNodes.length;p++){const m=o.inboundNodes[p],g=Jc.nodeKey(o,p);let b={};if(this.containerNodes.has(g)){if(m.callArgs)try{JSON.stringify(m.callArgs),b=m.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),b={}}if(m.inboundLayers.length>0){const v=[];for(let x=0;x<m.inboundLayers.length;x++){const S=m.inboundLayers[x],C=m.nodeIndices[x],A=m.tensorIndices[x],k=Jc.nodeKey(S,C);let O=t[k];O==null&&(O=0),v.push([S.name,O,A,b])}u.push(v)}}}const d={};d.name=o.name,d.className=l,d.config=c,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const l=this.inputLayers[o],c=this.inputLayersNodeIndices[o],u=Jc.nodeKey(l,c);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const p=this.inputLayersTensorIndices[o];r.push([l.name,d,p])}e.inputLayers=r;const a=[];for(let o=0;o<this.outputLayers.length;o++){const l=this.outputLayers[o],c=this.outputLayersNodeIndices[o],u=Jc.nodeKey(l,c);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const p=this.outputLayersTensorIndices[o];a.push([l.name,d,p])}return e.outputLayers=a,e}static fromConfig(e,t,s={},r=!1){const a={},o={};function l(x,S){x.name in o?o[x.name].push(S):o[x.name]=[S]}function c(x,S){const C=[];let A;for(const k of S){const O=k[0],F=k[1],$=k[2];if(A=k[3]==null?{}:k[3],!(O in a)){l(x,S);return}const M=a[O];if(M.inboundNodes.length<=F){l(x,S);return}const R=M.inboundNodes[F];C.push(R.outputTensors[$])}C.length>0&&x.apply(eo(C),A)}function u(x){const S=x.name,C=cu(x,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(r),a[S]=C,x.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new Ne(`Corrupted configuration, expected array for nodeData: ${k}`);l(C,k)})}const d=t.name,p=t.layers;for(const x of p)u(x);for(;!Wge(o);)for(const x of p){const S=a[x.name];if(S.name in o){const C=o[S.name];delete o[S.name];for(const A of C)c(S,A)}}const m=[],g=[],b=t.inputLayers;for(const x of b){const S=x[0],C=x[1],A=x[2];Zu(S in a);const O=a[S].inboundNodes[C].outputTensors;m.push(O[A])}const v=t.outputLayers;for(const x of v){const S=x[0],C=x[1],A=x[2];Zu(S in a);const O=a[S].inboundNodes[C].outputTensors;g.push(O[A])}return new e({inputs:m,outputs:g,name:d})}get stateful(){if(this._stateful)throw new Ne("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Le(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function x1e(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(a=>{a in n?r.push(n[a]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function tW(n,e){return x1e(n,e,"classWeight")}async function nW(n,e,t,s){if(t!=null){const r=Le(()=>{if(n.shape.length===1)return uh(n);if(n.shape.length===2){if(n.shape[1]>1)return Im(n,1);if(n.shape[1]===1)return _e(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),a=Array.from(await r.data());xn(r);const o=[];return a.forEach(l=>{if(t[l]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${l} exists in the data but not in classWeight`);o.push(t[l])}),Ki(o,"float32")}else return null}function S1e(n,e){return Se(n,e)}const C1e=32;function sW(n,e){let t,s;const r=e;t=r.xs,s=r.ys,ee(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const a=cB("input",n.inputNames,t),o=cB("output",n.outputNames,s),l=a[0].shape[0];ee(a.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),ee(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<a.length;c++)ee(a[c].shape[0]===l,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${a[c].shape[0]}; expected  ${l} based on input ${n.inputNames[0]}.`);for(let c=0;c<o.length;c++)ee(o[c].shape[0]===l,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${o[c].shape[0]}; expected  ${l} based on input ${n.inputNames[0]}.`);return{xs:a,ys:o}}function cB(n,e,t){if(t instanceof Yn)return[t];if(Array.isArray(t))return ee(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new Ne(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function _1e(n){if(n.length===3)throw new On("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function k1e(n,e,t){const s=t.batchesPerEpoch!=null;if(ee(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),ee(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),ee(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),ee(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),ee(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let a,o;if(r)if(uB(t.validationData))ee(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=_1e(t.validationData);a=x.xs,o=x.ys}const l=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let u;r?u=c.slice().concat(c.map(x=>"val_"+x)):u=c.slice();const d=q9(t.callbacks,t.yieldEvery),p=t.verbose==null?1:t.verbose,{callbackList:m,history:g}=X9(d,p,t.epochs,null,null,T1e(e,t),null,r,u);m.setModel(n),n.history=g,await m.onTrainBegin(),n.stopTraining_=!1;let b=t.initialEpoch==null?0:t.initialEpoch,v=await e.iterator();for(;b<t.epochs;){const x={};await m.onEpochBegin(b);let S=0,C=0;for(s||(v=await e.iterator());!s||S<t.batchesPerEpoch;){const A=await v.next();if(s&&A.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${S} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(A.value!=null){const{xs:k,ys:O}=sW(n,A.value),F={};F.batch=C,F.size=k[0].shape[0],await m.onBatchBegin(C,F);const $=[];if(t.classWeight!=null){const z=tW(t.classWeight,n.outputNames);for(let I=0;I<z.length;++I)$.push(await nW(O[I],null,z[I]))}const M=k.concat(O).concat($),R=l(M);xn(M);for(let z=0;z<c.length;++z){const I=c[z],j=R[z];F[I]=j,fi(j)}await m.onBatchEnd(C,F),V9(F),C++,S++}if(s?S>=t.batchesPerEpoch:A.done){if(r){let k;uB(t.validationData)?k=Ms(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):k=Ms(n.evaluate(a,o,{batchSize:t.validationBatchSize==null?C1e:t.validationBatchSize,verbose:0}));for(let O=0;O<n.metricsNames.length;++O)x[`val_${n.metricsNames[O]}`]=k[O]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(b,x),b++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function T1e(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function uB(n){return typeof n.iterator=="function"}function N1e(n){return typeof n.next=="function"}async function A1e(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let a=[];if(t.verbose>0)throw new On("Verbose mode is not implemented yet.");ee(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=N1e(e)?e:await e.iterator();let l=0,c=0;for(;!s||c<t.batches;){const u=await o.next();if(a=Le(()=>{if(u.value){const{xs:d,ys:p}=sW(n,u.value),m=d.concat(p),g=Le(()=>r(m));if(xn(m),c===0)for(let v=0;v<g.length;++v)a.push(Xt(0));const b=m[0].shape[0];for(let v=0;v<g.length;++v){const x=g[v],S=a[v];a[v]=Le(()=>at(a[v],Se(b,x))),c>0&&xn(S)}xn(g),l+=b,++c}return a}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<a.length;++u){const d=a[u];a[u]=Bt(a[u],l),xn(d)}return eo(a)}function Q5(n){ee(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Nb(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>vm(s,e,t-e)):vm(n,e,t-e)}function xI(n,e){return Le(()=>n==null?null:Array.isArray(n)?n.map(t=>xI(t,e)):P9(n,e.dtype==="int32"?e:ft(e,"int32")))}function eE(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function rW(n){const e=[];n instanceof Yn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(K2(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Kc(n,e){if(n==null)return;const t=[];if(e instanceof Yn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const a=e[r];t.push(a.id)}const s=[];if(n instanceof Yn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const a=n[r];t.indexOf(a.id)===-1&&s.push(a)}s.forEach(r=>{r.isDisposed||r.dispose()})}function E1e(n){return n instanceof Yn}function SI(n){return Array.isArray(n)}function hB(n){return!E1e(n)&&!SI(n)}function dB(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(SI(n)&&n.length>0)o=!0;else if(hB(n)){for(const l in n)if(n.hasOwnProperty(l)){o=!0;break}}else o=!0;if(o)throw new Ne(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let a;if(hB(n)){n=n,a=[];for(const o of e){if(n[o]==null)throw new Ne(`No data provided for "${o}". Need data for each key in: ${e}`);a.push(n[o])}}else if(SI(n)){if(n=n,n.length!==e.length)throw new Ne(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);a=n}else{if(n=n,e.length>1)throw new Ne(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);a=[n]}if(a=rW(a),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const l=a[o];if(l.shape.length!==t[o].length)throw new Ne(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${l.shape}`);for(let c=0;c<t[o].length;++c){if(c===0&&!s)continue;const u=l.shape[c],d=t[o][c];if(d!=null&&d>=0&&u!==d)throw new Ne(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${l.shape[0]} examples, each with shape [${l.shape.slice(1,l.shape.length)}] (tensor shape [${l.shape}])`)}}return a}function I1e(n,e,t){const s=zf(n.map(a=>a.shape[0]));s.sort();const r=zf(e.map(a=>a.shape[0]));if(r.sort(),s.length>1)throw new Ne(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(a=>a.shape))}`);if(r.length>1)throw new Ne(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(a=>a.shape))}`);if(s.length>0&&r.length>0&&!jn(s,r))throw new Ne(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function O1e(n,e,t){const s=[ug,hN,Bv];for(let r=0;r<n.length;++r){const a=n[r],o=e[r],l=t[r];if(o!=null){if(o===Bv&&a.shape[a.shape.length-1]===1)throw new Ne(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const c=a.shape.slice(1),u=l.slice(1);for(let d=0;d<c.length;++d){const p=c[d],m=u[d];if(m!=null&&p!==m)throw new Ne(`A target Tensor with shape ${a.shape} was passed for an output of shape ${l}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function fB(n,e,t,s=!0,r=""){let a;if(Array.isArray(n)){if(n.length!==e.length)throw new Ne(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);a=n}else{if(e.length>1)throw new Ne(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);a=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const l=a[o];if(l.shape.length!==t[o].length)throw new Ne(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(l.shape)}`);for(let c=0;c<t[o].length;++c){if(c===0&&!s)continue;const u=l.shape[c],d=t[o][c];if(d!=null&&d!==u)throw new Ne(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(l.shape)}.`)}}}function D1e(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let a=t.hasOwnProperty(r)?t[r]:[];Array.isArray(a)||(a=[a]),s.push(a)}return s}}const $1e="layers-model";class gd extends Jc{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new Ne("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");m1e(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=p1e(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Md))throw new Ne("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new Ne(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(J5(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Ne(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(l=>J5(l))}else{const o=J5(e.loss);this.outputs.forEach(l=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const l=this.internalOutputShapes[o],c=this.outputNames[o];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],bm("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const l=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([l,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=D1e(e.metrics,this.outputNames),a=(o,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[o]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,o])};bm("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const l=r[o];(u=>{let p,m,g;for(const b of u){if(typeof b=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(b)!==-1){const x=this.internalOutputShapes[o];x[x.length-1]===1||this.lossFunctions[o]===hN?["accuracy","acc"].indexOf(b)!==-1?m=SR:["crossentropy","ce"].indexOf(b)!==-1&&(m=Z9):this.lossFunctions[o]===h_?["accuracy","acc"].indexOf(b)!==-1?m=J9:["crossentropy","ce"].indexOf(b)!==-1&&(m=Q9):["accuracy","acc"].indexOf(b)!==-1?m=CR:["crossentropy","ce"].indexOf(b)!==-1&&(m=_R);let S;["accuracy","acc"].indexOf(b)!==-1?S="acc":["crossentropy","ce"].indexOf(b)!==-1&&(S="ce"),g=m,p=""+S}else g=f1e(b),p=""+ES(b);let v;bm(p,()=>{v=g}),a(o,p,v)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;Q5(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const l=o[0].concat(o[1]);this.makeTestFunction();const c=this.testFunction,u=this.testLoop(c,l,r,s.verbose,s.steps);return eo(u)}finally{Kc(o[0],e),Kc(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),A1e(this,e,t)}checkNumSamples(e,t,s,r="steps"){let a;if(s!=null){if(a=null,t!=null)throw new Ne(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?a=e[0].shape[0]:a=e.shape[0];else throw new Ne(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return a}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new Ne("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],a=this.retrieveSymbolicTensors(r),o=new Rf;if(e instanceof Yn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Ne(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)o.add(this.inputs[c],e[c])}else for(const c of this.inputs){const u=e[c.name];if(u==null)throw new Ne(`No value is provided for the model's input ${c.name}`);o.add(c,u)}const l=Zb(a,o);return s?l:l[0]}retrieveSymbolicTensors(e){const t=Mm(null,e.length);let s=e.length;for(const r of this.layers){const a=Array.isArray(r.output)?r.output:[r.output],o=a.map(l=>l.name);for(let l=0;l<e.length;++l){const c=o.indexOf(e[l]);if(c!==-1&&(t[l]=a[c],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((a,o)=>{a==null&&r.push(e[o])}),new Ne(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return Le(()=>{const r=this.checkNumSamples(e);if(s)throw new On("Verbose predictLoop() is not implemented yet.");const a=eE(r,t),o=this.outputs.map(l=>[]);for(let l=0;l<a.length;++l)Le(()=>{const u=a[l][0],d=a[l][1],p=Nb(e,u,d),m=[];if(Array.isArray(p))for(let b=0;b<p.length;++b)m.push({key:this.inputs[b],value:p[b]});else m.push({key:this.inputs[0],value:p});const g=new Rf(m);return Zb(this.outputs,g)}).forEach((u,d)=>o[d].push(u));return eo(o.map(l=>Pr(l,0)))})}predict(e,t={}){const s=rW(e);fB(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return Q5(r),this.predictLoop(s,r)}finally{Kc(s,e)}}predictOnBatch(e){fB(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new dc("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let o=0;o<this.feedOutputShapes.length;++o){const l=this.feedOutputShapes[o];this.feedLossFns[o]===h_?a.push(l.slice(0,l.length-1).concat([1])):a.push(l)}if(e=dB(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=dB(t,this.feedOutputNames,a,!1,"target"),I1e(e,t),O1e(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new Ne(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,a=!0,o){const[l,c]=this.standardizeUserDataXY(e,t,a,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=tW(r,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(await nW(c[p],null,d[p]))}return[l,c,u]}testLoop(e,t,s,r=0,a){return Le(()=>{const o=this.checkNumSamples(t,s,a,"steps"),l=[];if(r>0)throw new On("Verbose mode is not implemented yet.");if(a!=null)throw new On("steps mode in testLoop() is not implemented yet");{const c=eE(o,s),u=Ki(mu(0,o));for(let d=0;d<c.length;++d){const p=c[d][0],m=c[d][1],g=vm(u,p,m-p),b=xI(t,g),v=e(b);if(d===0)for(let x=0;x<v.length;++x)l.push(Xt(0));for(let x=0;x<v.length;++x){const S=v[x];l[x]=at(l[x],Se(m-p,S))}}for(let d=0;d<l.length;++d)l[d]=Bt(l[d],o)}return l})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let a=r;if(Zz(e,r)>1){const o=Zz(e.slice(0,s),r);a+=`_${o}`}t.push(a)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],l=()=>{const p=[];for(let v=0;v<this.inputs.length;++v)p.push({key:this.inputs[v],value:s[v]});const m=new Rf(p),g=Zb(this.outputs,m,{training:!0});let b;for(let v=0;v<this.lossFunctions.length;++v){const x=this.lossFunctions[v];let S=x(r[v],g[v]);a[v]!=null&&(S=S1e(S,a[v]));const C=pr(S);t.push(C),v===0?b=S:b=at(b,S)}for(let v=0;v<this.metricsTensors.length;++v){let x;if(this.outputs.length>1&&v<this.outputs.length)x=t[v];else{const S=this.metricsTensors[v][0],C=this.metricsTensors[v][1];x=pr(S(r[C],g[C]))}fi(x),o.push(x)}return b=pr(b),this.calculateLosses().forEach(v=>{b=at(b,v)}),b},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(o)}}makeTestFunction(){this.testFunction=e=>Le(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const l=new Rf(o),c=Zb(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],p=pr(d(a[u],c[u]));u===0?s=p:s=at(s,p),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],m=pr(d(a[p],c[p]));t.push(m)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,a,o,l,c,u,d,p,m;try{const g=s.batchSize==null?32:s.batchSize;Q5(g);const v=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=v[0],a=v[1],m=v[2];let x=!1,S;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)c=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new On("validationData including sample weights is not supported yet."):new Ne(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const z=await this.standardizeUserData(c,u,null,null,!0,g);d=z[0],p=z[1],S=d.concat(p)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const R=Math.floor(r[0].shape[0]*(1-s.validationSplit)),z=r[0].shape[0];d=Nb(r,R,z),o=r,r=Nb(r,0,R),p=Nb(a,R,z),l=a,a=Nb(a,0,R),S=d.concat(p)}else s.validationSteps!=null&&(x=!0);const C=r.concat(a).concat(m);this.checkTrainableWeightsConsistency();const A=this.makeTrainFunction(),k=this.getDedupedMetricsNames();let O,F;x?(this.makeTestFunction(),O=this.testFunction,F=k.slice().concat(k.map(R=>"val_"+R))):(O=null,S=[],F=k.slice());const $=q9(s.callbacks,s.yieldEvery);return await this.fitLoop(A,C,k,g,s.epochs,s.verbose,$,O,S,s.shuffle,F,s.initialEpoch,null,null)}finally{this.isTraining=!1,Kc(r,e),Kc(a,t),Kc(o,e),Kc(l,t),Kc(d,c),Kc(p,u),m!=null&&xn(m)}}async fitLoop(e,t,s,r,a,o,l,c,u,d,p,m,g,b){r==null&&(r=32),a==null&&(a=1),d==null&&(d=!0),m==null&&(m=0);let v=!1;if(c!=null&&u!=null&&(v=!0),b!=null&&(v=!0,g==null))throw new Ne("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,r,g,"steps_per_epoch");let S;x!=null&&(S=mu(0,x)),o==null&&(o=1);const{callbackList:C,history:A}=X9(l,o,a,m,x,g,r,v,p);C.setModel(this),this.history=A,await C.onTrainBegin(),this.stopTraining_=!1;for(let k=m;k<a;++k){await C.onEpochBegin(k);const O={};if(g!=null)throw new On("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new On("batch shuffling is not implemneted yet");d&&eD(S);const F=Ki(S),$=eE(x,r);for(let M=0;M<$.length;++M){const R={};if(await C.onBatchBegin(M,R),Le(()=>{const z=$[M][0],I=$[M][1],j=vm(F,z,I-z);R.batch=M,R.size=I-z;const H=xI(t,j),q=e(H);for(let re=0;re<s.length;++re){const X=s[re],ne=q[re];R[X]=ne,fi(ne)}if(M===$.length-1&&v){const re=this.testLoop(c,u,r);for(let X=0;X<s.length;++X){const ne=s[X],Q=re[X];fi(Q),O["val_"+ne]=Q}}}),await C.onBatchEnd(M,R),V9(R),this.stopTraining_)break}F.dispose()}if(await C.onEpochEnd(k,O),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return k1e(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],a=s[1],l=this.makeTrainFunction()(r.concat(a)),c=[];for(const u of l){const d=await u.data();c.push(d[0])}return xn(l),Kc(s[0],e),Kc(s[1],t),eo(c)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,a=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:a[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=rI().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-rI().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ld(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>ld(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=ld(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ld(ES(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ld(ES(e)));{const e={};for(const t in this.metrics)e[t]=ld(ES(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=jv(e.optimizer_config),s=cu(t);let r;if(typeof e.loss=="string")r=nm(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>nm(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=nm(e.loss[o])}let a;if(Array.isArray(e.metrics))a=e.metrics.map(o=>nm(o));else if(e.metrics!=null){a={};for(const o in e.metrics)a[o]=nm(e.metrics[o])}this.compile({loss:r,metrics:a,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=fV(e);if(u.length===0)throw new Ne(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new Ne(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new Ne("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await eI(this.getNamedWeights(t)),l={modelTopology:this.toJSON(null,!1),format:$1e,generatedBy:`TensorFlow.js tfjs-layers v${dN}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:p}=await eI(await this.optimizer.getWeights(),u);s.specs.push(...p),s.data=hV([s.data,d])}return this.userDefinedMetadata!=null&&(lB(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=s.data,l.weightSpecs=s.specs,e.save(l)}setUserDefinedMetadata(e){lB(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}gd.className="Model";lt(gd);class iW extends gd{}iW.className="Functional";lt(iW);async function R1e(n,e){"modelTopology"in n||(n={modelTopology:n}),n=n;let t=n.modelTopology;t.model_config!=null&&(t=t.model_config);const s=jv(t),r=cu(s,e);if(n.weightsManifest!=null){const a=await E3(n.weightsManifest,n.pathPrefix,r.weights.map(l=>l.originalName)),o={};for(const l of r.weights)o[l.originalName]=a[l.originalName];r.loadWeights(o),xn(a)}return r}async function L1e(n,e){if(e==null&&(e={}),typeof n=="string"){const t=pV(n,e);if(t.length===0)t.push(D3(n,e));else if(t.length>1)throw new Ne(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return F1e(n,void 0,e)}async function F1e(n,e,t){if(t==null&&(t={}),n.load==null)throw new Ne("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const a=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&a,l=cu(jv(r),e,o),c=s.trainingConfig;if(c!=null&&l.loadTrainingConfig(c),s.userDefinedMetadata!=null&&l.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new Ne("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=M1e(s.weightData,s.weightSpecs);l.loadWeights(u,a),l.optimizer!=null&&d.length>0&&await l.optimizer.setWeights(d),xn(u),xn(d.map(p=>p.tensor))}return l}function M1e(n,e){const t=uD(n,e),s={},r=[];return e.forEach(a=>{a.group==="optimizer"?r.push({name:a.name,tensor:t[a.name]}):s[a.name]=t[a.name]}),{modelWeights:s,optimizerWeights:r}}class Pm extends gd{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:eN("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new Ne(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Pm||e instanceof gd;let s;if(t){if(s=e,s.outputs.length!==1)throw new Ne("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new Ne("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new Ne("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=U9({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new Ne(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new Ne("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=j9(this.outputs[0])}this.inboundNodes=[],new cN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Mm(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(ls(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new gd({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new dc("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new dc("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new dc("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new dc("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let a,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new Ne("Legacy serialization format not supported yet.");a=t}else ee(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),a=t.layers,delete t.layers,o=t;const l=new e(o);if(!(l instanceof Pm))throw new On(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(const c of a){const d=cu(c,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new Ne("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new Ne("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Pm.className="Sequential";lt(Pm);function P1e(n){return new gd(n)}function z1e(n){return new Pm(n)}function aW(n){return U9(n)}function B1e(n,e){vl.registerCallbackConstructor(n,e)}let yo=class extends lg{getConfig(){return{}}};class oW extends yo{apply(e,t=1){return i0e(e,t)}}oW.className="elu";lt(oW);class lW extends yo{apply(e){return ET(e)}}lW.className="selu";lt(lW);class cW extends yo{apply(e){return Cu(e)}}cW.className="relu";lt(cW);class uW extends yo{apply(e){return Le(()=>qf(6,Cu(e)))}}uW.className="relu6";lt(uW);class hW extends yo{apply(e){return e}}hW.className="linear";lt(hW);class dW extends yo{apply(e){return lu(e)}}dW.className="sigmoid";lt(dW);class fW extends yo{apply(e){return o0e(e)}}fW.className="hardSigmoid";lt(fW);class pW extends yo{apply(e){return ag(e)}}pW.className="softplus";lt(pW);class mW extends yo{apply(e){return a0e(e)}}mW.className="softsign";lt(mW);class gW extends yo{apply(e){return Dm(e)}}gW.className="tanh";lt(gW);let kR=class extends yo{apply(e,t=-1){return U2(e,t)}};kR.className="softmax";lt(kR);class yW extends yo{apply(e,t=-1){return ST(e,t)}}yW.className="logSoftmax";lt(yW);class bW extends yo{apply(e,t=1){return Le(()=>Se(lu(Se(e,t)),e))}}bW.className="swish";lt(bW);class vW extends yo{apply(e){return Le(()=>Se(e,Dm(ag(e))))}}vW.className="mish";lt(vW);function Yf(n){return n.getClassName()}function tE(n,e={}){return Y2(n,Sl.getMap().classNameMap,e,"activation")}function Kf(n){if(n==null){const e={};return e.className="linear",e.config={},tE(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},tE(e)}else return n instanceof yo?n:tE(n)}function TR(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class wW extends lg{}class ex extends wW{constructor(e){super(),TR(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Le(()=>{let t=Qr([1]);return this.hasL1&&(t=at(t,It(Se(this.l1,Xr(e))))),this.hasL2&&(t=at(t,It(Se(this.l2,Z2(e))))),_e(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}ex.className="L1L2";lt(ex);function j1e(n){return TR(n),new ex({l1:n!=null?n.l1:null,l2:0})}function U1e(n){return TR(n),new ex({l2:n!=null?n.l2:null,l1:0})}const pB={l1l2:"L1L2"};function zs(n){return iR(n)}function mB(n,e={}){return Y2(n,Sl.getMap().classNameMap,e,"regularizer")}function ir(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in pB?pB[n]:n,config:{}};return mB(t)}else return n instanceof wW?n:mB(n)}class NR extends Mn{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=dn(e);let s=Cu(e);return this.maxValue!=null&&(s=uo(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}NR.className="ReLU";lt(NR);class AR extends Mn{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=dn(e);return D2(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}AR.className="LeakyReLU";lt(AR);class ER extends Mn{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=rr(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=ir(e.alphaRegularizer),this.alphaConstraint=yi(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new Ne(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=ls(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new ti({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=dn(e),z2(e,this.alpha.read())}getConfig(){const e={alphaInitializer:mr(this.alphaInitializer),alphaRegularizer:zs(this.alphaRegularizer),alphaConstraint:gi(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}ER.className="PReLU";lt(ER);let IR=class extends Mn{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new On(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=dn(e);return my(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};IR.className="ELU";lt(IR);class OR extends Mn{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=dn(e);return Se(s,ft(Ma(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}OR.className="ThresholdedReLU";lt(OR);class DR extends Mn{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new kR().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return Le(()=>{let s=dn(e);const r=t.mask;if(r!=null){const a=Se(St(to(s.shape),ft(r,s.dtype)),Xt(-1e9));s=at(s,a)}return this.axis instanceof Array?this.axis.length>1?ho(St(s,R2(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}DR.className="Softmax";lt(DR);function F0(n,e,t){if(typeof n=="number")return Mm(n,e);if(n.length!==e)throw new Ne(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!t0e(r))throw new Ne(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function uu(n,e,t,s,r=1){if(n==null)return n;const a=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-a+1,Math.floor((o+s-1)/s)}function Ju(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Xf([t-e,0]);else if(s==="same")n=n*e;else throw new Ne(`Unsupport padding mode: ${s}.`);return n}function $R(n,e){return Le(()=>(jr(e),e==="channelsFirst"?Wn(n,[0,2,3,1]):n))}function xW(n,e){return Le(()=>(jr(e),e==="channelsFirst"?Wn(n,[0,2,3,4,1]):n))}function V1e(n,e,t,s=1,r="valid",a,o=1){return Le(()=>{if(a==null&&(a=gu()),jr(a),n.shape.length!==3)throw new Ne(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new Ne(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new Ne(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(a==="channelsFirst"&&(n=Wn(n,[0,2,1])),r==="causal")throw new On("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let l=gT(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(l=_u(l,t)),l})}function gB(n,e,t,s=[1,1],r="valid",a,o,l=null){return Le(()=>{if(a==null&&(a=gu()),jr(a),n.rank!==3&&n.rank!==4)throw new Ne(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new Ne(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=$R(n,a);if(r==="causal")throw new On("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=m3({x:c,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:l}),a==="channelsFirst"&&(c=Wn(c,[0,3,1,2])),c})}function W1e(n,e,t,s=[1,1,1],r="valid",a,o){return Le(()=>{if(a==null&&(a=gu()),jr(a),n.rank!==4&&n.rank!==5)throw new Ne(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new Ne(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let l=xW(n,a);if(r==="causal")throw new On("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return l=MD(l,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(l=_u(l,t)),a==="channelsFirst"&&(l=Wn(l,[0,4,1,2,3])),l})}class fN extends Mn{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",fN.verifyArgs(t),this.rank=e,Oi(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new On(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=F0(t.kernelSize,e,"kernelSize"),this.strides=F0(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Pl(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jr(this.dataFormat),this.activation=Kf(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=rr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=yi(t.biasConstraint),this.biasRegularizer=ir(t.biasRegularizer),this.activityRegularizer=ir(t.activityRegularizer),this.dilationRate=F0(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new Ne(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new Ne(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new Ne(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Zu("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!aR(e.kernelSize,"number",1,3))throw new Ne(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Yf(this.activation),useBias:this.useBias,biasInitializer:mr(this.biasInitializer),biasRegularizer:zs(this.biasRegularizer),activityRegularizer:zs(this.activityRegularizer),biasConstraint:gi(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Cy extends fN{constructor(e,t){super(e,t),this.kernel=null,Cy.verifyArgs(t),this.filters=t.filters,Oi(this.filters,"filters"),this.kernelInitializer=rr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=yi(t.kernelConstraint),this.kernelRegularizer=ir(t.kernelRegularizer)}build(e){e=ls(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Ne(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return Le(()=>{e=dn(e);let s;const r=this.bias==null?null:this.bias.read(),a=D9(this.activation.getClassName());if(a!=null&&this.rank===2)s=gB(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,a);else{if(this.rank===1)s=V1e(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=gB(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=W1e(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new On("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=ls(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let a=0;a<s.length;++a){const o=uu(s[a],this.kernelSize[a],this.padding,this.strides[a],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[a]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:mr(this.kernelInitializer),kernelRegularizer:zs(this.kernelRegularizer),kernelConstraint:gi(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new Ne(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class _y extends Cy{constructor(e){super(2,e),_y.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!aR(e.kernelSize,"number",1,2))throw new Ne(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}_y.className="Conv2D";lt(_y);class ky extends Cy{constructor(e){super(3,e),ky.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new Ne(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}ky.className="Conv3D";lt(ky);class RR extends _y{constructor(e){if(super(e),this.inputSpec=[new ti({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new Ne(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ls(e),e.length!==4)throw new Ne("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Ne("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ti({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return Le(()=>{let s=dn(e);if(s.shape.length!==4)throw new Ne(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,a=r[0];let o,l;this.dataFormat==="channelsFirst"?(o=2,l=3):(o=1,l=2);const c=r[o],u=r[l],d=this.kernelSize[0],p=this.kernelSize[1],m=this.strides[0],g=this.strides[1],b=Ju(c,m,d,this.padding),v=Ju(u,g,p,this.padding),x=[a,b,v,this.filters];this.dataFormat!=="channelsLast"&&(s=Wn(s,[0,2,3,1]));let S=yT(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=Wn(S,[0,3,1,2])),this.bias!=null&&(S=_u(S,this.bias.read(),this.dataFormat)),this.activation!=null&&(S=this.activation.apply(S)),S})}computeOutputShape(e){e=ls(e);const t=e.slice();let s,r,a;this.dataFormat==="channelsFirst"?(s=1,r=2,a=3):(s=3,r=1,a=2);const o=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=Ju(t[r],c,o,this.padding),t[a]=Ju(t[a],u,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}RR.className="Conv2DTranspose";lt(RR);class LR extends ky{constructor(e){if(super(e),this.inputSpec=[new ti({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new Ne(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ls(e),e.length!==5)throw new Ne("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Ne("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ti({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return Le(()=>{let s=dn(e);if(s.shape.length!==5)throw new Ne(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,a=r[0];let o,l,c;this.dataFormat==="channelsFirst"?(c=2,o=3,l=4):(c=1,o=2,l=3);const u=r[c],d=r[o],p=r[l],m=this.kernelSize[0],g=this.kernelSize[1],b=this.kernelSize[2],v=this.strides[0],x=this.strides[1],S=this.strides[2],C=Ju(u,v,m,this.padding),A=Ju(d,x,g,this.padding),k=Ju(p,S,b,this.padding),O=[a,C,A,k,this.filters];this.dataFormat!=="channelsLast"&&(s=Wn(s,[0,2,3,4,1]));let F=PD(s,this.kernel.read(),O,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(F=Wn(F,[0,4,1,2,3])),this.bias!==null&&(F=_u(F,this.bias.read(),this.dataFormat)),this.activation!==null&&(F=this.activation.apply(F)),F})}computeOutputShape(e){e=ls(e);const t=e.slice();let s,r,a,o;this.dataFormat==="channelsFirst"?(s=1,r=2,a=3,o=4):(s=4,r=1,a=2,o=3);const l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],m=this.strides[2];return t[s]=this.filters,t[r]=Ju(t[r],d,l,this.padding),t[a]=Ju(t[a],p,c,this.padding),t[o]=Ju(t[o],m,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}LR.className="Conv3DTranspose";lt(LR);class SW extends Cy{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new Ne("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new Ne("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new Ne(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=rr(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=ir(t.depthwiseRegularizer),this.depthwiseConstraint=yi(t.depthwiseConstraint),this.pointwiseInitializer=rr(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=ir(t.pointwiseRegularizer),this.pointwiseConstraint=yi(t.pointwiseConstraint)}build(e){if(e=ls(e),e.length<this.rank+2)throw new Ne(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new Ne(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),a=[];for(let l=0;l<this.rank;++l)a.push(1);a.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new ti({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return Le(()=>{e=dn(e);let s;if(this.rank===1)throw new On("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Wn(e,[0,2,3,1])),s=IT(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=_u(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Wn(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=mr(this.depthwiseInitializer),e.pointwiseInitializer=mr(this.pointwiseInitializer),e.depthwiseRegularizer=zs(this.depthwiseRegularizer),e.pointwiseRegularizer=zs(this.pointwiseRegularizer),e.depthwiseConstraint=gi(this.depthwiseConstraint),e.pointwiseConstraint=gi(this.pointwiseConstraint),e}}SW.className="SeparableConv";class FR extends SW{constructor(e){super(2,e)}}FR.className="SeparableConv2D";lt(FR);class tx extends Cy{constructor(e){super(1,e),tx.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!aR(e.kernelSize,"number",1,1))throw new Ne(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}tx.className="Conv1D";lt(tx);class MR extends Mn{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Le(()=>{if(e=dn(e),this.dataFormat==="channelsLast"){const s=AS(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return AS(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=AS(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return AS(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}MR.className="Cropping2D";lt(MR);class PR extends Mn{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Jge(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return Le(()=>{let s=dn(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Wn(s,[0,2,3,1]);const a=this.size[0]*r[2],o=this.size[1]*r[3],l=this.interpolation==="nearest"?hc.resizeNearestNeighbor(s,[a,o]):hc.resizeBilinear(s,[a,o]);return Wn(l,[0,3,1,2])}else{const a=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?hc.resizeNearestNeighbor(s,[a,o]):hc.resizeBilinear(s,[a,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}PR.className="UpSampling2D";lt(PR);function H1e(n,e,t=[1,1],s="valid",r,a){return Le(()=>{r==null&&(r=gu()),jr(r);let o=$R(n,r);if(n.rank!==4)throw new Ne(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new Ne(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=py(o,e,t,s==="same"?"same":"valid","NHWC",a),r==="channelsFirst"&&(o=Wn(o,[0,3,1,2])),o})}class zR extends fN{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=rr(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=yi(e.depthwiseConstraint),this.depthwiseRegularizer=ir(e.depthwiseRegularizer)}build(e){if(e=ls(e),e.length<4)throw new Ne(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new Ne(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Le(()=>{e=dn(e);let s=H1e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=_u(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=ls(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=uu(t,this.kernelSize[0],this.padding,this.strides[0]),o=uu(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,a,o]:[e[0],a,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=mr(this.depthwiseInitializer),e.depthwiseRegularizer=zs(this.depthwiseRegularizer),e.depthwiseConstraint=gi(this.depthwiseRegularizer),e}}zR.className="DepthwiseConv2D";lt(zR);function CW(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new Ne("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(a){return a==null||Array.isArray(a)?a:[a]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function _W(n,e,t,s=!1,r,a,o=!1,l=!1){return Le(()=>{const c=e.shape.length;if(c<3)throw new Ne(`Input should be at least 3D, but is ${c}D.`);const u=[1,0].concat(mu(2,c));e=Wn(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ft(ft(r,"bool"),"float32"),r.rank===c-1&&(r=qi(r,-1)),r=Wn(r,u)),s&&(e=Rl(e,0),r!=null&&(r=Rl(r,0)));const d=[];let p,m=t;const g=e.shape[0],b=Ll(e);let v;r!=null&&(v=Ll(r));for(let S=0;S<g;++S){const C=b[S],A=Le(()=>n(C,m));if(r==null)p=A[0],m=A[1];else{const k=Le(()=>{const O=v[S],F=St(Xo(O),O),$=at(Se(A[0],O),Se(m[0],F)),M=m.map((R,z)=>at(Se(A[1][z],O),Se(R,F)));return{output:$,newStates:M}});p=k.output,m=k.newStates}l&&d.push(p)}let x;return l&&(x=Ra(d,1)),[p,x,m]})}class ku extends Mn{constructor(e){super(e);let t;if(e.cell==null)throw new Ne("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new gN({cells:e.cell}):t=e.cell,t.stateSize==null)throw new Ne("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new ti({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return mu(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){yI(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const a=[];for(const o of t)a.push([e[0],o]);return[r].concat(a)}else return r}computeMask(e,t){return Le(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(a=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new On("Constants support is not implemented in RNN yet.");yI(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new ti({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!jn(this.stateSpec.map(o=>o.shape[o.shape.length-1]),a))throw new Ne(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(o=>new ti({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){Le(()=>{if(!this.stateful)throw new Ku("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new Ne("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qr([s,r])):this.states_=[Qr([s,this.cell.stateSize])];else if(e==null)xn(this.states_),this.keptStates!=null&&(xn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qr([s,r])):this.states_[0]=Qr([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Ne(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):xn(this.states_);for(let r=0;r<this.states_.length;++r){const a=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,l=[s,o];if(!jn(a.shape,l))throw new Ne(`State ${r} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${a.shape}`);this.states_[r]=a}}this.states_=this.states_.map(r=>fi(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const a=CW(e,s,r,this.numConstants);e=a.inputs,s=a.initialState,r=a.constants;let o=[],l=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new ti({shape:u.shape}));l=l.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof yu){const u=[e].concat(o),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;const m=super.apply(u,t);return this.inputSpec=p,m}else return super.apply(e,t)}call(e,t){return Le(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let a=t==null?null:t.initialState;e=dn(e),a==null&&(this.stateful?a=this.states_:a=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==o)throw new Ne(`RNN Layer has ${o} state(s) but was passed ${a.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const l={training:r},u=_W((b,v)=>{const x=this.cell.call([b].concat(v),l);return[x[0],x.slice(1)]},e,a,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],p=u[1],m=u[2];this.stateful&&this.resetStates(m,r);const g=this.returnSequences?p:d;return this.returnState?[g].concat(m):g})}getInitialState(e){return Le(()=>{let t=Qr(e.shape);return t=It(t,[1,2]),t=K2(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?mI(t,[1,s]):t):this.cell.stateSize>1?[mI(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ku.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,a=cu(r,s);return new e(Object.assign(t,{cell:a}))}}ku.className="RNN";lt(ku);class nx extends Mn{}class pN extends nx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Oi(this.units,"units"),this.activation=Kf(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=ir(e.kernelRegularizer),this.recurrentRegularizer=ir(e.recurrentRegularizer),this.biasRegularizer=ir(e.biasRegularizer),this.kernelConstraint=yi(e.kernelConstraint),this.recurrentConstraint=yi(e.recurrentConstraint),this.biasConstraint=yi(e.biasConstraint),this.dropout=K0([1,Xf([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=K0([1,Xf([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ls(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Le(()=>{if(e=e,e.length!==2)throw new Ne(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zf({ones:()=>Xo(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zf({ones:()=>Xo(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let a;const o=this.dropoutMask,l=this.recurrentDropoutMask;o!=null?a=fh(Se(e,o),this.kernel.read()):a=fh(e,this.kernel.read()),this.bias!=null&&(a=_u(a,this.bias.read())),l!=null&&(s=Se(s,l));let c=at(a,fh(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Yf(this.activation),useBias:this.useBias,kernelInitializer:mr(this.kernelInitializer),recurrentInitializer:mr(this.recurrentInitializer),biasInitializer:mr(this.biasInitializer),kernelRegularizer:zs(this.kernelRegularizer),recurrentRegularizer:zs(this.recurrentRegularizer),biasRegularizer:zs(this.biasRegularizer),activityRegularizer:zs(this.activityRegularizer),kernelConstraint:gi(this.kernelConstraint),recurrentConstraint:gi(this.recurrentConstraint),biasConstraint:gi(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}pN.className="SimpleRNNCell";lt(pN);class BR extends ku{constructor(e){e.cell=new pN(e),super(e)}call(e,t){return Le(()=>{this.cell.dropoutMask!=null&&(xn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(xn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:a})})}static fromConfig(e,t){return new e(t)}}BR.className="SimpleRNN";lt(BR);class mN extends nx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Ne("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Oi(this.units,"units"),this.activation=Kf(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Kf(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=ir(e.kernelRegularizer),this.recurrentRegularizer=ir(e.recurrentRegularizer),this.biasRegularizer=ir(e.biasRegularizer),this.kernelConstraint=yi(e.kernelConstraint),this.recurrentConstraint=yi(e.recurrentConstraint),this.biasConstraint=yi(e.biasConstraint),this.dropout=K0([1,Xf([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=K0([1,Xf([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ls(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Le(()=>{if(e=e,e.length!==2)throw new Ne(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zf({ones:()=>Xo(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zf({ones:()=>Xo(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=this.recurrentDropoutMask;let l,c,u;0<this.dropout&&this.dropout<1&&(e=Se(e,a[0]));let d=fh(e,this.kernel.read());this.useBias&&(d=_u(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Se(r,o[0]));const p=this.recurrentKernel.read(),[m,g]=ro(p,[2*this.units,this.units],p.rank-1),b=fh(r,m),[v,x,S]=ro(d,3,d.rank-1),[C,A]=ro(b,2,b.rank-1);l=this.recurrentActivation.apply(at(v,C)),c=this.recurrentActivation.apply(at(x,A));const k=fh(Se(c,r),g);u=this.activation.apply(at(S,k));const O=at(Se(l,r),Se(at(1,Gs(l)),u));return[O,O]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Yf(this.activation),recurrentActivation:Yf(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mr(this.kernelInitializer),recurrentInitializer:mr(this.recurrentInitializer),biasInitializer:mr(this.biasInitializer),kernelRegularizer:zs(this.kernelRegularizer),recurrentRegularizer:zs(this.recurrentRegularizer),biasRegularizer:zs(this.biasRegularizer),activityRegularizer:zs(this.activityRegularizer),kernelConstraint:gi(this.kernelConstraint),recurrentConstraint:gi(this.recurrentConstraint),biasConstraint:gi(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}mN.className="GRUCell";lt(mN);class jR extends ku{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new mN(e),super(e)}call(e,t){return Le(()=>{this.cell.dropoutMask!=null&&(xn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(xn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}jR.className="GRU";lt(jR);class sx extends nx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Oi(this.units,"units"),this.activation=Kf(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Kf(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=ir(e.kernelRegularizer),this.recurrentRegularizer=ir(e.recurrentRegularizer),this.biasRegularizer=ir(e.biasRegularizer),this.kernelConstraint=yi(e.kernelConstraint),this.recurrentConstraint=yi(e.recurrentConstraint),this.biasConstraint=yi(e.biasConstraint),this.dropout=K0([1,Xf([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=K0([1,Xf([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=ls(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const a=this.biasInitializer,o=this.units;r=new(t=class extends bc{apply(c,u){const d=a.apply([o]),p=new nN().apply([o]),m=a.apply([o*2]);return Qz(Qz(d,p),m)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Le(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new Ne(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zf({ones:()=>Xo(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zf({ones:()=>Xo(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,l=this.recurrentDropoutMask;let c,u,d,p;0<this.dropout&&this.dropout<1&&(e=Se(e,o[0]));let m=fh(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Se(r,l[0])),m=at(m,fh(r,this.recurrentKernel.read())),this.useBias&&(m=_u(m,this.bias.read()));const[g,b,v,x]=ro(m,4,m.rank-1);c=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(b),d=at(Se(u,a),Se(c,this.activation.apply(v))),p=this.recurrentActivation.apply(x);const S=Se(p,this.activation.apply(d));return[S,S,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Yf(this.activation),recurrentActivation:Yf(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mr(this.kernelInitializer),recurrentInitializer:mr(this.recurrentInitializer),biasInitializer:mr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:zs(this.kernelRegularizer),recurrentRegularizer:zs(this.recurrentRegularizer),biasRegularizer:zs(this.biasRegularizer),activityRegularizer:zs(this.activityRegularizer),kernelConstraint:gi(this.kernelConstraint),recurrentConstraint:gi(this.recurrentConstraint),biasConstraint:gi(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}sx.className="LSTMCell";lt(sx);class UR extends ku{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new sx(e),super(e)}call(e,t){return Le(()=>{this.cell.dropoutMask!=null&&(xn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(xn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}UR.className="LSTM";lt(UR);class gN extends nx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Le(()=>{e=e;let s=e.slice(1);const r=[];for(const l of this.cells.slice().reverse())Array.isArray(l.stateSize)?r.push(s.splice(0,l.stateSize.length)):r.push(s.splice(0,1));r.reverse();const a=[];let o;for(let l=0;l<this.cells.length;++l){const c=this.cells[l];s=r[l],l===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=c.call(o,t),a.push(o.slice(1))}s=[];for(const l of a.slice().reverse())s.push(...l);return[o[0]].concat(s)})}build(e){yI(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{bm(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=a=>({className:a.getClassName(),config:a.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const a of t.cells)r.push(cu(a,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return bI(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,a=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],a[o]])}mR(t)}}gN.className="StackedRNNCells";lt(gN);function Zf(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:a}=n,o=()=>a!=null?a(e(),t):z9(e(),t),l=()=>J2(o,e,s);return!r||r<=1?fi(l().clone()):Array(r).fill(void 0).map(l).map(u=>fi(u.clone()))}var G1e=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class kW extends ku{constructor(e){if(e.unroll)throw new On("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new On("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new ti({ndim:5})]}call(e,t){return Le(()=>{if(this.cell.dropoutMask!=null&&(xn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(xn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Ne("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Le(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),a=[r[0],...r.slice(2)],o=Qr(a);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){Le(()=>{if(!this.stateful)throw new Ku("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),a=[r[0],...r.slice(2)];if(s[0]==null)throw new Ne("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qr(a)):this.states_=[Qr(a)];else if(e==null)xn(this.states_),this.keptStates!=null&&(xn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qr(a)):this.states_[0]=Qr(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Ne(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):xn(this.states_);for(let l=0;l<this.states_.length;++l){const c=e[l],u=a;if(!jn(c.shape,u))throw new Ne(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>fi(l.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:a,strides:o,dilationRate:l}=this.cell,c=t==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=uu(u,r[0],a,o[0],l[0]),m=uu(d,r[1],a,o[1],l[1]);return[...e.slice(0,2),...c?[s,p,m]:[p,m,s]]}}kW.className="ConvRNN2D";class yN extends sx{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:a,dataFormat:o,dilationRate:l}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Oi(this.filters,"filters"),this.kernelSize=F0(s,2,"kernelSize"),this.kernelSize.forEach(c=>Oi(c,"kernelSize")),this.strides=F0(r||1,2,"strides"),this.strides.forEach(c=>Oi(c,"strides")),this.padding=a||"valid",Pl(this.padding),this.dataFormat=o||"channelsLast",jr(this.dataFormat),this.dilationRate=F0(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>Oi(c,"dilationRate"))}build(e){var t;e=ls(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new Ne(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],a=4,o=this.kernelSize.concat([r,this.filters*a]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const l=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;c=new(t=class extends bc{apply(m,g){const b=u.apply([d]),v=to([d]),x=u.apply([d*2]);return oR([b,v,x])}},t.className="CustomInit",t)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Le(()=>{if(e.length!==3)throw new Ne(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],a=e[1],o=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Zf({ones:()=>Xo(r),rate:this.dropout,training:s,count:l,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,u=(ye,Y,B)=>!Y||!Y[B]?ye:Se(Y[B],ye);let d=u(r,c,0),p=u(r,c,1),m=u(r,c,2),g=u(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Zf({ones:()=>Xo(a),rate:this.recurrentDropout,training:s,count:l,dropoutFunc:this.dropoutFunc}));const b=this.recurrentDropoutMask;let v=u(a,b,0),x=u(a,b,1),S=u(a,b,2),C=u(a,b,3);const A=3,[k,O,F,$]=ro(this.kernel.read(),l,A),[M,R,z,I]=this.useBias?ro(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,k,M,this.padding),p=this.inputConv(p,O,R,this.padding),m=this.inputConv(m,F,z,this.padding),g=this.inputConv(g,$,I,this.padding);const[j,H,q,re]=ro(this.recurrentKernel.read(),l,A);v=this.recurrentConv(v,j),x=this.recurrentConv(x,H),S=this.recurrentConv(S,q),C=this.recurrentConv(C,re);const X=this.recurrentActivation.apply(at(d,v)),ne=this.recurrentActivation.apply(at(p,x)),Q=at(Se(ne,o),Se(X,this.activation.apply(at(m,S)))),he=Se(this.recurrentActivation.apply(at(g,C)),this.activation.apply(Q));return[he,he,Q]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=G1e(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const a=Cd(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?_u(a,s,this.dataFormat):a}recurrentConv(e,t){return Cd(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}yN.className="ConvLSTM2DCell";lt(yN);class VR extends kW{constructor(e){const t=new yN(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}VR.className="ConvLSTM2D";lt(VR);class bN extends Mn{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,a=this.getNoiseShape(s);return J2(()=>z9(s,this.rate,a,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}bN.className="Dropout";lt(bN);class WR extends bN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}WR.className="SpatialDropout1D";lt(WR);class HR extends Mn{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Oi(this.units,"units"),this.activation=Kf(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=yi(e.kernelConstraint),this.biasConstraint=yi(e.biasConstraint),this.kernelRegularizer=ir(e.kernelRegularizer),this.biasRegularizer=ir(e.biasRegularizer),this.activityRegularizer=ir(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=ls(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=ls(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e),r=D9(this.activation.getClassName());let a;return r!=null?a=fh(s,this.kernel.read(),r,this.bias?this.bias.read():null):(a=fh(s,this.kernel.read()),this.bias!=null&&(a=_u(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){const e={units:this.units,activation:Yf(this.activation),useBias:this.useBias,kernelInitializer:mr(this.kernelInitializer),biasInitializer:mr(this.biasInitializer),kernelRegularizer:zs(this.kernelRegularizer),biasRegularizer:zs(this.biasRegularizer),activityRegularizer:zs(this.activityRegularizer),kernelConstraint:gi(this.kernelConstraint),biasConstraint:gi(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}HR.className="Dense";lt(HR);class GR extends Mn{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=ls(e);for(const t of e.slice(1))if(t==null)throw new Ne(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Bf(e,1)]}call(e,t){return Le(()=>{this.invokeCallHook(e,t);let s=dn(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let a=2;a<s.rank;++a)r.push(a);r.push(1),s=Wn(s,r)}return r0e(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}GR.className="Flatten";lt(GR);class qR extends Mn{constructor(e){super(e),this.supportsMasking=!0,this.activation=Kf(e.activation)}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e);return this.activation.apply(s)})}getConfig(){const e={activation:Yf(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}qR.className="Activation";lt(qR);class XR extends Mn{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Le(()=>(e=dn(e),n0e(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}XR.className="RepeatVector";lt(XR);class YR extends Mn{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let a=1,o=null;for(let c=0;c<r.length;++c){const u=r[c];if(this.isUnknown(u))if(o===null)o=c;else throw new Ne("Can only specifiy one unknown dimension.");else a*=u}const l=Bf(e);if(o!==null){if(a===0||l%a!==0)throw new Ne(s);r[o]=l/a}else if(l!==a)throw new Ne(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e),r=s.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return _e(s,a)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}YR.className="Reshape";lt(YR);class KR extends Mn{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=mu(1,e.dims.length+1);if(!jn(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new ti({ndim:this.dims.length+1})]}computeOutputShape(e){e=ls(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return Wn(dn(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}KR.className="Permute";lt(KR);class ZR extends Mn{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=dn(e);return Fv(Rm(s,this.maskValue),-1)}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e),o=Fv(Rm(s,this.maskValue),-1,!0);return Se(s,ft(o,s.dtype))})}}ZR.className="Masking";lt(ZR);class JR extends Mn{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Ms(e.inputLength))}this.inputDim=e.inputDim,Oi(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Oi(this.outputDim,"outputDim"),this.embeddingsInitializer=rr(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=ir(e.embeddingsRegularizer),this.activityRegularizer=ir(e.activityRegularizer),this.embeddingsConstraint=yi(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Le(()=>this.maskZero?(e=dn(e),Rm(e,Kn(e))):null)}computeOutputShape(e){if(e=ls(e),this.inputLength==null)return[...e,this.outputDim];const t=Ms(this.inputLength);if(t.length!==e.length-1)throw new Ne(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const a=t[r],o=e[r+1];if(a!=null&&o!=null&&a!==o)throw new Ne(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);a==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return Le(()=>{this.invokeCallHook(e,t);let s=dn(e);s.dtype!=="int32"&&(s=dh(s,"int32"));const r=P9(this.embeddings.read(),_e(s,[s.size]));return _e(r,ls(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:mr(this.embeddingsInitializer),embeddingsRegularizer:zs(this.embeddingsRegularizer),activityRegularizer:zs(this.activityRegularizer),embeddingsConstraint:gi(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}JR.className="Embedding";lt(JR);class hg extends Mn{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new On}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const a=e[e.length-t.length+r],o=t[r];if(a==null||o==null||a<0||o<0)s.push(null);else if(a===1)s.push(o);else if(o===1)s.push(a);else{if(a!==o)throw new Ne("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(a)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[ls(e)]),e=e,e.length<2)throw new Ne(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const a of e)a!=null&&a[0]!==null&&t.push(a[0]);if(t=zf(t),t.length>1)throw new Ne(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let a=1;a<e.length;++a){const o=e[a]==null?null:e[a].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(a=>a.length);e.indexOf(null)===-1&&zf(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return Le(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(a=>a.rank);if(r.indexOf(null)===-1){const a=Xf(r);for(let o of e){const l=o.rank;for(let c=0;c<a-l;++c)o=K2(o,1);s.push(o)}return this.mergeFunction(s)}else{let a=!1;for(const c of e){const u=c.rank;if(u==null){const d=c.shape,p=d[0],m=d.slice(1).concat([p]);let g=_e(c,[p].concat(Bf(d.slice(1))));g=Wn(g,[1,0]),g=_e(g,m),s.push(g),a=!0}else if(u>1){const d=mu(1,u).concat([0]);s.push(Wn(c,d)),a=!0}else s.push(c)}let o=this.mergeFunction(s);const l=o.rank;if(a){if(l==null){const c=o.shape,u=c.length,d=c[u-1],p=[d].concat(c.slice(0,c.length-1));o=_e(Wn(_e(o,[-1,d]),[1,0]),p)}else if(l>1){const c=[l-1].concat(mu(0,l-1));o=Wn(o,c)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const a=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,a)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=zf(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return Le(()=>{if(t==null)return null;if(!Array.isArray(t))throw new Ne("`mask` should be an Array");if(!Array.isArray(e))throw new Ne("`inputs` should be an Array");if(t.length!==e.length)throw new Ne(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:qi(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=mc(s,t[r]);return s})}}class QR extends hg{constructor(e){super(e)}mergeFunction(e){return Le(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=at(t,e[s]);return t})}}QR.className="Add";lt(QR);class eL extends hg{constructor(e){super(e)}mergeFunction(e){return Le(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Se(t,e[s]);return t})}}eL.className="Multiply";lt(eL);class tL extends hg{constructor(e){super(e)}mergeFunction(e){return Le(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=at(t,e[s]);return Se(1/e.length,t)})}}tL.className="Average";lt(tL);class nL extends hg{constructor(e){super(e)}mergeFunction(e){return Le(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Th(t,e[s]);return t})}}nL.className="Maximum";lt(nL);class sL extends hg{constructor(e){super(e)}mergeFunction(e){return Le(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=qf(t,e[s]);return t})}}sL.className="Minimum";lt(sL);class rL extends hg{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new Ne("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const a=e[r].slice();a.splice(this.axis,1);let o=!1;for(const l of s)if(jn(l,a)){o=!0;break}o||s.push(a)}if(s.length>1)throw new Ne("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Le(()=>oR(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new Ne("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const a of t.slice(1)){if(s[r]==null||a[r]==null){s[r]=null;break}s[r]+=a[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new Ne("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Ne("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Ne(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return Le(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(ft(Xo(e[o]),"bool")):t[o].rank<e[o].rank?r.push(qi(t[o],-1)):r.push(t[o]);const a=Pr(r,this.axis);return mT(a,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}rL.className="Concatenate";lt(rL);function Ab(n,e){for(;n<0;)n+=e;return n}function q1e(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new On("batchDot is not implemented for tensors of 4D or higher rank yet");if(ee(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),ee(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new On("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const a=t;return Le(()=>{let o;if(s>r){o=s-r;const c=[];for(let u=0;u<o;++u)c.push(1);e=_e(e,e.shape.concat(c))}else if(r>s){o=r-s;const c=[];for(let u=0;u<o;++u)c.push(1);n=_e(n,n.shape.concat(c))}else o=0;let l;if(n.shape.length===2&&e.shape.length===2)a[0]===a[1]?l=It(Se(n,e),a[0]):l=It(Se(Wn(n,[1,0]),e),a[1]);else{const c=a[0]!==n.shape.length-1,u=a[1]===e.shape.length-1;l=Ln(n,e,c,u)}if(o>0){let c;s>r?c=s+r-3:c=s-1;const u=[];for(let d=c;d<c+o;++d)u.push(d);l=lp(l,u)}return l.shape.length===1&&(l=qi(l,1)),l})}class iL extends hg{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){ee(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new On("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new Ne(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new Ne(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((a,o)=>Ab(a,e[o].shape.length)):r=[Ab(this.axes,t.shape.length),Ab(this.axes,s.shape.length)],this.normalize&&(t=u_(t,r[0]),s=u_(s,r[1])),q1e(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Ab(this.axes,e.length),Ab(this.axes,t.length)],s}computeOutputShape(e){ee(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new On("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const a=t.concat(s);return a.length===1&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}iL.className="Dot";lt(iL);class aL extends Mn{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e);return J2(()=>at(tN(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}aL.className="GaussianNoise";lt(aL);class oL extends Mn{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Le(()=>{this.invokeCallHook(e,t);const s=dn(e);return this.rate>0&&this.rate<1?J2(()=>{const a=Math.sqrt(this.rate/(1-this.rate));return Se(s,tN(s.shape,1,a))},()=>s,t.training||!1):s})}}oL.className="GaussianDropout";lt(oL);class lL extends Mn{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||dn(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Le(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return J2(()=>{const a=dn(e),l=-1.6732632423543772*1.0507009873554805;let c=Rd(op(s),this.rate);c=dh(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,p=at(Se(a,c),Se(at(c,-1),l));return at(Se(p,u),d)},()=>dn(e),t.training||!1)}return e})}}lL.className="AlphaDropout";lt(lL);function Uv(n,e,t,s,r,a=.001){let o;if(n.rank===2)o=ND(n,e,t,s,r,a);else if(n.rank===3)o=AD(n,e,t,s,r,a);else if(n.rank===4)o=ED(n,e,t,s,r,a);else throw new On(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function X1e(n,e,t,s,r=.001){return Le(()=>{const a=M2(n,s),o=a.mean,l=a.variance;return[Uv(n,o,l,t,e,r),o,l]})}function Y1e(n,e,t,s,r=.001){return Le(()=>{const a=M2(n,s),o=a.mean,l=a.variance,c=[];for(const b of mu(0,n.rank))s.indexOf(b)!==-1?c.push(1):c.push(n.shape[b]);const u=_e(o,c),d=_e(l,c),p=e==null?null:_e(e,c),m=t==null?null:_e(t,c);return[Uv(n,u,d,m,p,r),o,l]})}function K1e(n,e,t,s,r=.001){return jn(s.slice().sort(),mu(0,n.rank-1))?X1e(n,e,t,s,r):Y1e(n,e,t,s,r)}class cL extends Mn{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=rr(e.betaInitializer||"zeros"),this.gammaInitializer=rr(e.gammaInitializer||"ones"),this.movingMeanInitializer=rr(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=rr(e.movingVarianceInitializer||"ones"),this.betaConstraint=yi(e.betaConstraint),this.gammaConstraint=yi(e.gammaConstraint),this.betaRegularizer=ir(e.betaRegularizer),this.gammaRegularizer=ir(e.gammaRegularizer)}build(e){e=ls(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new Ne(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new ti({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Le(()=>{const s=t.training==null?!1:t.training,r=dn(e),a=r.shape,o=a.length,l=mu(0,o),c=this.axis>=0?this.axis:this.axis+o;l.splice(c,1);const u=Mm(1,o);u[c]=a[c];const d=l.slice();d.sort();const p=!jn(d,mu(0,o).slice(0,o-1)),m=()=>{if(p){const C=_e(this.movingMean.read(),u),A=_e(this.movingVariance.read(),u),k=this.center?_e(this.beta.read(),u):null,O=this.scale?_e(this.gamma.read(),u):null;return Uv(r,C,A,k,O,this.epsilon)}else return Uv(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[g,b,v]=K1e(r,this.gamma.read(),this.beta.read(),l,this.epsilon),x=(C,A,k)=>{Le(()=>{const O=1-k,F=C.read(),$=Se(St(F,A),O);C.write(St(F,$))})};return x(this.movingMean,b,this.momentum),x(this.movingVariance,v,this.momentum),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mr(this.betaInitializer),gammaInitializer:mr(this.gammaInitializer),movingMeanInitializer:mr(this.movingMeanInitializer),movingVarianceInitializer:mr(this.movingVarianceInitializer),betaRegularizer:zs(this.betaRegularizer),gammaRegularizer:zs(this.gammaRegularizer),betaConstraint:gi(this.betaConstraint),gammaConstraint:gi(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}cL.className="BatchNormalization";lt(cL);class uL extends Mn{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=rr(e.betaInitializer||"zeros"),this.gammaInitializer=rr(e.gammaInitializer||"ones"),this.betaRegularizer=ir(e.betaRegularizer),this.gammaRegularizer=ir(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=ls(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(const a of this.axis)if(a<0||a>=t)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==zf(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(a=>e[a]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=dn(e),r=s.shape,a=r.length;return Le(()=>{let{mean:l,variance:c}=M2(s,this.axis,!0);const u=Mm(1,a);for(const v of this.axis)u[v]=r[v];const d=v=>v!=null&&v.shape.length!==a?_e(v,u):v;let p=this.scale?d(this.gamma.read()):null,m=this.center?d(this.beta.read()):null;const g=[],b=[];for(let v=0;v<a;++v)this.axis.indexOf(v)!==-1?(g.push(r[v]),b.push(1)):(g.push(1),b.push(r[v]));return l=kl(l,g),c=kl(c,g),p!=null&&(p=kl(p,b)),m!=null&&(m=kl(m,b)),Uv(s,l,c,m,p,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mr(this.betaInitializer),gammaInitializer:mr(this.gammaInitializer),betaRegularizer:zs(this.betaRegularizer),gammaRegularizer:zs(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}uL.className="LayerNormalization";lt(uL);function Z1e(n,e,t){return Le(()=>{if(n.rank!==4)throw new Ne(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Ne("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=gu()),t!=="channelsLast"&&t!=="channelsFirst")throw new Ne(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Ld(n,s)})}class hL extends Mn{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?gu():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new Ne(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new Ne(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new Ne(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new ti({ndim:4})]}computeOutputShape(e){e=ls(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return Le(()=>Z1e(dn(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}hL.className="ZeroPadding2D";lt(hL);function vN(n,e,t,s,r,a){return Le(()=>{jr(r),R9(a),Pl(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=gu()),a==null&&(a="max"),n=$R(n,r);let o;const l=s==="same"?"same":"valid";return a==="max"?o=F2(n,e,t,l):o=A2(n,e,t,l),r==="channelsFirst"&&(o=Wn(o,[0,3,1,2])),o})}function TW(n,e,t,s,r,a){return Le(()=>{jr(r),R9(a),Pl(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=gu()),a==null&&(a="max"),n=xW(n,r);let o;const l=s==="same"?"same":"valid";return a==="max"?o=QD(n,e,t,l):o=TD(n,e,t,l),r==="channelsFirst"&&(o=Wn(o,[0,4,1,2,3])),o})}class NW extends Mn{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new Ne(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Oi(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new Ne(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Oi(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Pl(this.padding),this.inputSpec=[new ti({ndim:3})]}computeOutputShape(e){e=ls(e);const t=uu(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Le(()=>{this.invokeCallHook(e,t),e=K2(dn(e),2);const s=this.poolingFunction(dn(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return lp(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class dL extends NW{constructor(e){super(e)}poolingFunction(e,t,s,r,a){return jr(a),Pl(r),vN(e,t,s,r,a,"max")}}dL.className="MaxPooling1D";lt(dL);class fL extends NW{constructor(e){super(e)}poolingFunction(e,t,s,r,a){return jr(a),Pl(r),vN(e,t,s,r,a,"avg")}}fL.className="AveragePooling1D";lt(fL);class AW extends Mn{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new Ne(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Oi(this.poolSize,"poolSize"),Oi(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),Pl(this.padding),this.inputSpec=[new ti({ndim:4})]}computeOutputShape(e){e=ls(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=uu(t,this.poolSize[0],this.padding,this.strides[0]),s=uu(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return Le(()=>(this.invokeCallHook(e,t),this.poolingFunction(dn(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class pL extends AW{constructor(e){super(e)}poolingFunction(e,t,s,r,a){return jr(a),Pl(r),vN(e,t,s,r,a,"max")}}pL.className="MaxPooling2D";lt(pL);class mL extends AW{constructor(e){super(e)}poolingFunction(e,t,s,r,a){return jr(a),Pl(r),vN(e,t,s,r,a,"avg")}}mL.className="AveragePooling2D";lt(mL);class EW extends Mn{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new Ne(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Oi(this.poolSize,"poolSize"),Oi(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),Pl(this.padding),this.inputSpec=[new ti({ndim:5})]}computeOutputShape(e){e=ls(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=uu(t,this.poolSize[0],this.padding,this.strides[0]),s=uu(s,this.poolSize[1],this.padding,this.strides[1]),r=uu(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return Le(()=>(this.invokeCallHook(e,t),this.poolingFunction(dn(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class gL extends EW{constructor(e){super(e)}poolingFunction(e,t,s,r,a){return jr(a),Pl(r),TW(e,t,s,r,a,"max")}}gL.className="MaxPooling3D";lt(gL);class yL extends EW{constructor(e){super(e)}poolingFunction(e,t,s,r,a){return jr(a),Pl(r),TW(e,t,s,r,a,"avg")}}yL.className="AveragePooling3D";lt(yL);class IW extends Mn{constructor(e){super(e),this.inputSpec=[new ti({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new On}}class bL extends IW{constructor(e){super(e||{})}call(e,t){return Le(()=>{const s=dn(e);return pr(s,1)})}}bL.className="GlobalAveragePooling1D";lt(bL);class vL extends IW{constructor(e){super(e||{})}call(e,t){return Le(()=>{const s=dn(e);return Il(s,1)})}}vL.className="GlobalMaxPooling1D";lt(vL);class OW extends Mn{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jr(this.dataFormat),this.inputSpec=[new ti({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new On}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class wL extends OW{call(e,t){return Le(()=>{const s=dn(e);return this.dataFormat==="channelsLast"?pr(s,[1,2]):pr(s,[2,3])})}}wL.className="GlobalAveragePooling2D";lt(wL);class xL extends OW{call(e,t){return Le(()=>{const s=dn(e);return this.dataFormat==="channelsLast"?Il(s,[1,2]):Il(s,[2,3])})}}xL.className="GlobalMaxPooling2D";lt(xL);class DW extends Mn{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,a=cu(r,s);delete t.layer;const o={layer:a};return Object.assign(o,t),new e(o)}}class SL extends DW{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=ls(e),e.length<3)throw new Ne(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=ls(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return Le(()=>(e=dn(e),_W((o,l)=>[dn(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}SL.className="TimeDistributed";lt(SL);function J1e(n){cg(Zge,"BidirectionalMergeMode",n)}const Q1e="concat";class CL extends DW{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=cu(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=cu(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Q1e:e.mergeMode,J1e(this.mergeMode),e.weights)throw new On("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,a;return this.returnState&&(a=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(a).concat(a.slice()):[s].concat(a).concat(a.slice()):eo(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const a=CW(e,s,r,this.numConstants);if(e=a.inputs,s=a.initialState,r=a.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],l=[];if(s!=null){const u=s.length;if(u%2>0)throw new Ne("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const d=s.map(p=>new ti({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(r!=null)throw new On("Support for constants in Bidirectional layers is not implemented yet.");const c=o[0]instanceof yu;for(const u of o)if(u instanceof yu!==c)throw new Ne("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const u=[e].concat(o),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;const m=super.apply(u,t);return this.inputSpec=p,m}else return super.apply(e,t)}call(e,t){return Le(()=>{const s=t.initialState;let r,a;if(s==null)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{const c=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:c})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=Rl(a,1));let l;return this.mergeMode==="concat"?l=oR([r,a]):this.mergeMode==="sum"?l=at(r,a):this.mergeMode==="ave"?l=Se(.5,at(r,a)):this.mergeMode==="mul"?l=Se(r,a):this.mergeMode==null&&(l=[r,a]),this.returnState?this.mergeMode==null?l.concat(o):[l].concat(o):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){bm(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),bm(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const a=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(a).concat(a):[s].concat(a).concat(a)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=cu(t.layer);if(delete t.layer,t.numConstants!=null)throw new On("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}CL.className="Bidirectional";lt(CL);class _L extends Mn{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Le(()=>(e=dn(e),e.dtype!=="float32"&&(e=dh(e,"float32")),at(Se(e,this.scale),this.offset)))}}_L.className="Rescaling";lt(_L);const{resizeBilinear:eye,cropAndResize:tye}=hc;class kL extends Mn{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,a,o,l,c){return Le(()=>{let u,d=!1;const p=t/o,m=s/l,g=(r+t)/o,b=(a+s)/l,v=[p,m,g,b],x=[];e.rank===3?(d=!0,u=Ra([e])):u=e;for(let O=0;O<u.shape[0];O++)x.push(v);const S=Wo(x,[x.length,4]),C=Lm(0,x.length,1,"int32"),k=tye(u,S,C,[r,a],"nearest");return dh(d?dn(Ll(k)):k,c)})}upsize(e,t,s,r){return Le(()=>{const a=eye(e,[t,s]);return dh(a,r)})}call(e,t){return Le(()=>{const s=dn(e),r=s.dtype,a=s.shape,o=a[a.length-3],l=a[a.length-2];let c=0;o!==this.height&&(c=Math.floor((o-this.height)/2));let u=0;return l!==this.width&&(u=Math.floor((l-this.width)/2),u===0&&(u=1)),c>=0&&u>=0?this.centerCrop(s,c,u,this.height,this.width,o,l,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ls(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}kL.className="CenterCrop";lt(kL);function nye(n,e,t,s){let r=dn(n);if(r.dtype!=="int32"&&(r=dh(r,"int32")),e==="int")return r;const a=r.shape;if(r.rank===0&&(r=qi(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=qi(r,-1)),r.rank>2)throw new Ne(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${a} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),l=r;let c;if(typeof s<"u"&&e==="count"?c=s_(l,s,t,o):c=s_(l,[],t,o),e!=="tfIdf")return c;if(s)return Se(c,s);throw new Ne("When outputMode is 'tfIdf', weights must be provided.")}class TL extends Mn{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=ls(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return Le(()=>{e=dn(e),e.dtype!=="int32"&&(e=dh(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new Ne(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=dn(t.countWeights)}const r=Il(e),a=W0(e),o=Ma(this.numTokens,r).bufferSync().get(0),l=Rd(a,0).bufferSync().get(0);if(!(o&&l))throw new Ne(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return nye(e,this.outputMode,this.numTokens,s)})}}TL.className="CategoryEncoding";lt(TL);const sye=["bilinear","nearest"],yB=new Set(sye);class NL extends Mn{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(yB.has(e.interpolation))this.interpolation=e.interpolation;else throw new Ne(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=ls(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Le(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return hc.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return hc.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...yB]} are supported`)})}}NL.className="Resizing";lt(NL);class $W{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}$W.className="RandomSeed";class RW extends Mn{constructor(e){super(e),this.randomGenerator=new $W(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}RW.className="BaseRandomLayer";const rye=["bilinear","nearest"],bB=new Set(rye);class AL extends RW{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new Ne(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new Ne(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new Ne(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(bB.has(s))this.interpolation=s;else throw new Ne(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ls(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return Le(()=>{const s=dn(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=op([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*r;a=Math.round(a);const o=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return hc.resizeBilinear(e,o);case"nearest":return hc.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...bB]} are supported`)}})}}AL.className="RandomWidth";lt(AL);function iye(n){return new xy(n)}function aye(n){return new IR(n)}function oye(n){return new NR(n)}function lye(n){return new AR(n)}function cye(n){return new ER(n)}function uye(n){return new DR(n)}function hye(n){return new OR(n)}function dye(n){return new tx(n)}function fye(n){return new _y(n)}function pye(n){return new RR(n)}function mye(n){return new ky(n)}function gye(n){return new LR(n)}function yye(n){return new FR(n)}function bye(n){return new MR(n)}function vye(n){return new PR(n)}function wye(n){return new zR(n)}function xye(n){return new qR(n)}function Sye(n){return new HR(n)}function Cye(n){return new bN(n)}function _ye(n){return new WR(n)}function kye(n){return new GR(n)}function Tye(n){return new XR(n)}function Nye(n){return new YR(n)}function Aye(n){return new KR(n)}function Eye(n){return new JR(n)}function Iye(n){return new QR(n)}function Oye(n){return new tL(n)}function Dye(n){return new rL(n)}function $ye(n){return new nL(n)}function Rye(n){return new sL(n)}function Lye(n){return new eL(n)}function Fye(n){return new iL(n)}function Mye(n){return new cL(n)}function Pye(n){return new uL(n)}function zye(n){return new hL(n)}function EL(n){return new fL(n)}function Bye(n){return EL(n)}function jye(n){return EL(n)}function IL(n){return new mL(n)}function Uye(n){return IL(n)}function Vye(n){return IL(n)}function OL(n){return new yL(n)}function Wye(n){return OL(n)}function Hye(n){return OL(n)}function Gye(n){return new bL(n)}function qye(n){return new wL(n)}function LW(n){return new vL(n)}function FW(n){return new xL(n)}function MW(n){return new dL(n)}function PW(n){return new pL(n)}function Xye(n){return new gL(n)}function Yye(n){return new jR(n)}function Kye(n){return new mN(n)}function Zye(n){return new UR(n)}function Jye(n){return new sx(n)}function Qye(n){return new BR(n)}function ebe(n){return new pN(n)}function tbe(n){return new VR(n)}function nbe(n){return new yN(n)}function sbe(n){return new ku(n)}function rbe(n){return new gN(n)}function ibe(n){return new CL(n)}function abe(n){return new SL(n)}const obe=LW,lbe=FW,cbe=MW,ube=PW;function hbe(n){return new aL(n)}function dbe(n){return new oL(n)}function fbe(n){return new lL(n)}function pbe(n){return new ZR(n)}function mbe(n){return new _L(n)}function gbe(n){return new kL(n)}function ybe(n){return new NL(n)}function bbe(n){return new TL(n)}function vbe(n){return new AL(n)}const wbe=Object.freeze(Object.defineProperty({__proto__:null,Layer:Mn,RNN:ku,RNNCell:nx,activation:xye,add:Iye,alphaDropout:fbe,average:Oye,averagePooling1d:EL,averagePooling2d:IL,averagePooling3d:OL,avgPool1d:Bye,avgPool2d:Uye,avgPool3d:Wye,avgPooling1d:jye,avgPooling2d:Vye,avgPooling3d:Hye,batchNormalization:Mye,bidirectional:ibe,categoryEncoding:bbe,centerCrop:gbe,concatenate:Dye,conv1d:dye,conv2d:fye,conv2dTranspose:pye,conv3d:mye,conv3dTranspose:gye,convLstm2d:tbe,convLstm2dCell:nbe,cropping2D:bye,dense:Sye,depthwiseConv2d:wye,dot:Fye,dropout:Cye,elu:aye,embedding:Eye,flatten:kye,gaussianDropout:dbe,gaussianNoise:hbe,globalAveragePooling1d:Gye,globalAveragePooling2d:qye,globalMaxPool1d:obe,globalMaxPool2d:lbe,globalMaxPooling1d:LW,globalMaxPooling2d:FW,gru:Yye,gruCell:Kye,input:aW,inputLayer:iye,layerNormalization:Pye,leakyReLU:lye,lstm:Zye,lstmCell:Jye,masking:pbe,maxPool1d:cbe,maxPool2d:ube,maxPooling1d:MW,maxPooling2d:PW,maxPooling3d:Xye,maximum:$ye,minimum:Rye,multiply:Lye,permute:Aye,prelu:cye,randomWidth:vbe,reLU:oye,repeatVector:Tye,rescaling:mbe,reshape:Nye,resizing:ybe,rnn:sbe,separableConv2d:yye,simpleRNN:Qye,simpleRNNCell:ebe,softmax:uye,spatialDropout1d:_ye,stackedRNNCells:rbe,thresholdedReLU:hye,timeDistributed:abe,upSampling2d:vye,zeroPadding2d:zye},Symbol.toStringTag,{value:"Module"}));function xbe(n,e){return SR(n,e)}function Sbe(n,e){return Z9(n,e)}function Cbe(n,e){return J9(n,e)}function _be(n,e){return CR(n,e)}function kbe(n,e){return _R(n,e)}function Tbe(n,e){return K9(n,e)}function Nbe(n,e){return i1e(n,e)}function Abe(n,e){return xR(n,e)}function Ebe(n,e){return uN(n,e)}function Ibe(n,e){return Sy(n,e)}function Obe(n,e){return Sy(n,e)}function Dbe(n,e){return Sy(n,e)}function $be(n,e){return ug(n,e)}function Rbe(n,e){return ug(n,e)}function Lbe(n,e){return ug(n,e)}const Fbe=Object.freeze(Object.defineProperty({__proto__:null,MAPE:Obe,MSE:Rbe,binaryAccuracy:xbe,binaryCrossentropy:Sbe,categoricalAccuracy:_be,categoricalCrossentropy:kbe,cosineProximity:Abe,mape:Dbe,meanAbsoluteError:Ebe,meanAbsolutePercentageError:Ibe,meanSquaredError:$be,mse:Lbe,precision:Tbe,recall:Nbe,sparseCategoricalAccuracy:Cbe},Symbol.toStringTag,{value:"Module"}));const Mbe=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:R1e},Symbol.toStringTag,{value:"Module"}));function Pbe(n){return new ex(n)}function zbe(n){return j1e(n)}function Bbe(n){return U1e(n)}const jbe=Object.freeze(Object.defineProperty({__proto__:null,l1:zbe,l1l2:Pbe,l2:Bbe},Symbol.toStringTag,{value:"Module"}));class zW extends Z0{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof gd))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function IS(n,e){return n<e}function vB(n,e){return n>e}class BW extends zW{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new On("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=IS:this.mode==="max"?this.monitorFunc=vB:this.monitor.indexOf("acc")!==-1?this.monitorFunc=vB:this.monitorFunc=IS,this.monitorFunc===IS&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===IS?1/0:-1/0}async onEpochEnd(e,t){await Tf(t);const s=this.getMonitorValue(t);s!=null&&(this.monitorFunc(s-this.minDelta,this.best)?(this.best=s,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});const t=e[this.monitor];return t==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),t}}function Ube(n){return new BW(n)}const Vbe={earlyStopping:Ube};const Wbe=Re();Wbe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var lc;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(lc||(lc={}));var wB;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(wB||(wB={}));const DL={};function Hbe(n,e){const t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};DL[n]=t}function jW(n){return DL[n]}function Gbe(n){delete DL[n]}function U(n,e,t,s,r){const a=e.inputParams[n];if(a&&a.inputIndexStart!==void 0){const l=a.inputIndexStart,c=a.inputIndexEnd===0?void 0:a.inputIndexEnd===void 0?l+1:a.inputIndexEnd,u=l<0?e.inputNames.length+l:l;if(a.type==="tensor")return Xi(e.inputNames[u],t,s,r);if(a.type==="tensors"){const m=e.inputs.slice(l,c);return e.inputNames.slice(l,c).filter((b,v)=>{var x;return((x=m[v])===null||x===void 0?void 0:x.op)!=="NoOp"}).map(b=>Xi(b,t,s,r))}const d=Xi(e.inputNames[u],t,s,r),p=d.dataSync();return a.type==="number"?p[0]:El(d.shape,p)}const o=e.attrParams[n];return o&&o.value}function Xi(n,e,t,s){const[r,a]=zo(n,t);if(s!=null){const l=s.getHashTableHandleByName(r);if(l!=null)return l}const o=t.currentContextIds.find(l=>!!e[m_(r,l)]);return o!==void 0?e[m_(r,o)][a]:void 0}function xB(n,e,t){return e[m_(n,t.currentContextId)]}function cd(n,e){const[t,s,r]=zo(n,e);return[m_(t,e&&e.currentContextId),s,r]}function m_(n,e){return e?`${n}-${e}`:n}function zo(n,e){if(n==="")return["",0,void 0];const t=e!=null&&e.parseNodeNameCache!=null;if(t){const a=e.parseNodeNameCache.get(n);if(a!=null)return a}const s=n.split(":");let r;if(s.length===1)r=[n,0,void 0];else{const a=s[0],o=s.length===3?s[1]:void 0,l=Number(s[s.length-1]);r=[a,l,o]}return t&&e.parseNodeNameCache.set(n,r),r}function lC(n,e,t){let s=U("pad",n,e,t);if(s==="explicit"){s=U("explicitPaddings",n,e,t);const r=[[0,0],[0,0],[0,0],[0,0]];for(let a=0;a<4;a++)r[a][0]=s[a*2],r[a][1]=s[a*2+1];return r}return s}function ud(n){return n.kept?n:uh(n)}const qbe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Xbe=Object.freeze(Object.defineProperty({__proto__:null,json:qbe},Symbol.toStringTag,{value:"Module"}));const Ybe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Kbe=Object.freeze(Object.defineProperty({__proto__:null,json:Ybe},Symbol.toStringTag,{value:"Module"}));const Zbe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Jbe=Object.freeze(Object.defineProperty({__proto__:null,json:Zbe},Symbol.toStringTag,{value:"Module"}));const Qbe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],eve=Object.freeze(Object.defineProperty({__proto__:null,json:Qbe},Symbol.toStringTag,{value:"Module"}));const tve=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],nve=Object.freeze(Object.defineProperty({__proto__:null,json:tve},Symbol.toStringTag,{value:"Module"}));const sve=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],rve=Object.freeze(Object.defineProperty({__proto__:null,json:sve},Symbol.toStringTag,{value:"Module"}));const ive=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],ave=Object.freeze(Object.defineProperty({__proto__:null,json:ive},Symbol.toStringTag,{value:"Module"}));const ove=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],lve=Object.freeze(Object.defineProperty({__proto__:null,json:ove},Symbol.toStringTag,{value:"Module"}));const cve=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],uve=Object.freeze(Object.defineProperty({__proto__:null,json:cve},Symbol.toStringTag,{value:"Module"}));const hve=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],dve=Object.freeze(Object.defineProperty({__proto__:null,json:hve},Symbol.toStringTag,{value:"Module"}));const fve=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],pve=Object.freeze(Object.defineProperty({__proto__:null,json:fve},Symbol.toStringTag,{value:"Module"}));const mve=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],gve=Object.freeze(Object.defineProperty({__proto__:null,json:mve},Symbol.toStringTag,{value:"Module"}));const yve=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],bve=Object.freeze(Object.defineProperty({__proto__:null,json:yve},Symbol.toStringTag,{value:"Module"}));const vve=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],wve=Object.freeze(Object.defineProperty({__proto__:null,json:vve},Symbol.toStringTag,{value:"Module"}));const xve=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Sve=Object.freeze(Object.defineProperty({__proto__:null,json:xve},Symbol.toStringTag,{value:"Module"}));const Cve=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],_ve=Object.freeze(Object.defineProperty({__proto__:null,json:Cve},Symbol.toStringTag,{value:"Module"}));const kve=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Tve=Object.freeze(Object.defineProperty({__proto__:null,json:kve},Symbol.toStringTag,{value:"Module"}));const Nve=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Ave=Object.freeze(Object.defineProperty({__proto__:null,json:Nve},Symbol.toStringTag,{value:"Module"}));const Eve=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Ive=Object.freeze(Object.defineProperty({__proto__:null,json:Eve},Symbol.toStringTag,{value:"Module"}));class SB{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Xbe,Kbe,Jbe,eve,nve,rve,ave,lve,uve,dve,pve,gve,bve,wve,Sve,_ve,Tve,Ave,Ive],t=[].concat(...e.map(s=>s.json));this.opMappers=t.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,t={}){const s=e.node,r=[],a=[],o=[],l=s.reduce((v,x)=>(v[x.name]=this.mapNode(x),x.op.startsWith("Placeholder")?r.push(v[x.name]):x.op==="Const"?a.push(v[x.name]):(x.input==null||x.input.length===0)&&o.push(v[x.name]),v),{});let c=[];const u=[];let d={},p={};t!=null&&(d=this.mapSignatureEntries(t.inputs),p=this.mapSignatureEntries(t.outputs));const m=Object.keys(l);m.forEach(v=>{const x=l[v];x.inputNames.forEach((S,C)=>{const[A,,k]=cd(S),O=l[A];if(O.outputs!=null){const F=O.outputs.indexOf(k);if(F!==-1){const $=`${A}:${F}`;x.inputNames[C]=$}}x.inputs.push(O),O.children.push(x)})}),Object.keys(p).length===0?m.forEach(v=>{const x=l[v];x.children.length===0&&u.push(x)}):Object.keys(p).forEach(v=>{const[x]=cd(v),S=l[x];S!=null&&(S.signatureKey=p[v],u.push(S))}),Object.keys(d).length>0?Object.keys(d).forEach(v=>{const[x]=cd(v),S=l[x];S&&(S.signatureKey=d[v],c.push(S))}):c=r;let g={};e.library!=null&&e.library.function!=null&&(g=e.library.function.reduce((v,x)=>(v[x.signature.name]=this.mapFunction(x),v),{}));const b={nodes:l,inputs:c,outputs:u,weights:a,placeholders:r,signature:t,functions:g};return o.length>0&&(b.initNodes=o),b}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,s)=>(t[e[s].name]=s,t),{})}mapNode(e){const t=jW(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(s.inputParams=t.inputs.reduce((r,a)=>(r[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},r),{})),t.attrs!=null&&(s.attrParams=t.attrs.reduce((r,a)=>{const o=a.type;let l;switch(a.type){case"string":l=CI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=CI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":l=II(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=II(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":l=kI(e.attr,a.tfName,a.defaultValue||0),l===void 0&&a.tfDeprecatedName&&(l=kI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":l=EI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=EI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":l=_I(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=_I(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":l=DI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=DI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":l=AI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=AI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":l=OI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=OI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":l=TI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=TI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":l=NI(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=NI(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":l=CB(e.attr,a.tfName,a.defaultValue),l===void 0&&a.tfDeprecatedName&&(l=CB(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${a.type} for op: ${e.op}`)}return r[a.name]={value:l,type:o},r},{})),s}mapFunction(e){const t=e.nodeDef,s=[],r=[];let a={};t!=null&&(a=t.reduce((p,m)=>(p[m.name]=this.mapNode(m),m.op==="Const"&&r.push(p[m.name]),p),{}));const o=[],l=[];e.signature.inputArg.forEach(p=>{const[m]=cd(p.name),g={name:m,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:$L(p.type),type:"dtype"}},children:[]};g.signatureKey=p.name,o.push(g),a[m]=g}),Object.keys(a).forEach(p=>{const m=a[p];m.inputNames.forEach((g,b)=>{const[v,,x]=cd(g),S=a[v];if(S.outputs!=null){const C=S.outputs.indexOf(x);if(C!==-1){const A=`${v}:${C}`;m.inputNames[b]=A}}m.inputs.push(S),S.children.push(m)})});const u=e.ret;e.signature.outputArg.forEach(p=>{const[m,g]=cd(u[p.name]),b=a[m];b!=null&&(b.defaultOutput=g,l.push(b))});const d=this.mapArgsToSignature(e);return{nodes:a,inputs:o,outputs:l,weights:r,placeholders:s,signature:d}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s),t),{}),outputs:e.signature.outputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s,e.ret),t),{})}}mapArgToTensorInfo(e,t){let s=e.name;return t!=null&&(s=t[s]),{name:s,dtype:e.type}}}function Ove(n){const e=Re().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function UW(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):Ove(n);return e?t:t.toLowerCase()}function CI(n,e,t,s=!1){const r=n[e];return r!=null?UW(r.s,s):t}function _I(n,e,t){const s=n[e];return s?s.b:t}function kI(n,e,t){const s=n[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:t;return typeof r=="number"?r:parseInt(r,10)}function $L(n){switch(typeof n=="string"&&(n=lc[n]),n){case lc.DT_FLOAT:case lc.DT_HALF:return"float32";case lc.DT_INT32:case lc.DT_INT64:case lc.DT_INT8:case lc.DT_UINT8:return"int32";case lc.DT_BOOL:return"bool";case lc.DT_DOUBLE:return"float32";case lc.DT_STRING:return"string";default:return null}}function CB(n,e,t){const s=n[e];return s&&s.func?s.func.name:t}function TI(n,e,t){const s=n[e];return s&&s.type?$L(s.type):t}function NI(n,e,t){const s=n[e];return s&&s.list&&s.list.type?s.list.type.map(r=>$L(r)):t}function VW(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function AI(n,e,t){const s=n[e];return s&&s.shape?VW(s.shape):t}function EI(n,e,t){const s=n[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):t}function II(n,e,t,s=!1){const r=n[e];return r&&r.list&&r.list.s?r.list.s.map(a=>UW(a,s)):t}function OI(n,e,t){const s=n[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>VW(r)):t}function DI(n,e,t){const s=n[e];return s&&s.list&&s.list.b?s.list.b:t}class Dve{constructor(e,t,s){this.node=e,this.tensorMap=t,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,a)=>(r[a]=this.getAttr(a),r),{}))}getInput(e){return Xi(e,this.tensorMap,this.context)}getAttr(e,t){const s=this.node.rawAttrs[e];if(s.tensor!=null)return Xi(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return kI(this.node.rawAttrs,e,t);if(s.s!=null)return CI(this.node.rawAttrs,e,t);if(s.b!=null)return _I(this.node.rawAttrs,e,t);if(s.shape!=null)return AI(this.node.rawAttrs,e,t);if(s.type!=null)return TI(this.node.rawAttrs,e,t);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return EI(this.node.rawAttrs,e,t);if(s.list.s!=null)return II(this.node.rawAttrs,e,t);if(s.list.shape!=null)return OI(this.node.rawAttrs,e,t);if(s.list.b!=null)return DI(this.node.rawAttrs,e,t);if(s.list.type!=null)return NI(this.node.rawAttrs,e,t)}return t}}const sa=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:cD,abs:Xr,acos:yD,acosh:bD,add:at,addN:CV,all:mT,any:Fv,argMax:Im,argMin:vD,asin:wD,asinh:xD,atan:SD,atan2:CD,atanh:_D,avgPool:A2,avgPool3d:TD,basicLSTMCell:_V,batchNorm:fy,batchNorm2d:ND,batchNorm3d:AD,batchNorm4d:ED,batchToSpaceND:E2,bincount:ID,bitwiseAnd:kV,booleanMaskAsync:c3,broadcastArgs:TV,broadcastTo:gm,buffer:Dn,cast:ft,ceil:OD,clipByValue:uo,clone:uh,complex:Sd,concat:Pr,concat1d:DD,concat2d:$D,concat3d:RD,concat4d:LD,conv1d:gT,conv2d:Cd,conv2dTranspose:yT,conv3d:MD,conv3dTranspose:PD,cos:I2,cosh:bT,cosineWindow:BT,cumprod:zv,cumsum:vT,denseBincount:s_,depthToSpace:zD,depthwiseConv2d:py,diag:AV,dilation2d:BD,div:Bt,divNoNan:jD,dot:UD,dropout:y$,einsum:tm,elu:my,enclosingPowerOfTwo:b$,ensureShape:EV,equal:Go,erf:VD,euclideanNorm:HD,exp:ho,expandDims:qi,expm1:GD,eye:wT,fft:V2,fill:ig,floor:yy,floorDiv:pT,fused:b3,gather:by,gatherND:f3,greater:Ma,greaterEqual:Rd,ifft:Y0,imag:O2,image:hc,inTopKAsync:p3,irfft:RT,isFinite:qD,isInf:XD,isNaN:YD,leakyRelu:D2,less:H0,lessEqual:ap,linalg:x$,linspace:DV,localResponseNormalization:KD,log:qo,log1p:$2,logSigmoid:ZD,logSoftmax:ST,logSumExp:R2,logicalAnd:mc,logicalNot:L2,logicalOr:CT,logicalXor:JD,losses:k3,lowerBound:RV,matMul:Ln,max:Il,maxPool:F2,maxPool3d:QD,maxPoolWithArgmax:LV,maximum:Th,mean:pr,meshgrid:FV,min:W0,minimum:qf,mirrorPad:e$,mod:t$,moments:M2,movingAverage:u3,mul:Se,multiRNNCell:MV,multinomial:PV,neg:Gs,norm:gy,notEqual:Rm,oneHot:G0,ones:to,onesLike:Xo,op:ve,outerProduct:zV,pad:Ld,pad1d:BV,pad2d:jV,pad3d:UV,pad4d:VV,pool:n$,pow:_d,prelu:z2,print:mD,prod:s$,raggedGather:WV,raggedRange:HV,raggedTensorToTensor:GV,rand:qV,randomGamma:KV,randomNormal:kT,randomStandardNormal:ZV,randomUniform:op,randomUniformInt:JV,range:Lm,real:q0,reciprocal:o$,relu:Cu,relu6:TT,reshape:_e,reverse:Rl,reverse1d:QV,reverse2d:e3,reverse3d:t3,reverse4d:n3,rfft:W2,round:NT,rsqrt:AT,scalar:Xt,scatterND:h3,searchSorted:_T,selu:ET,separableConv2d:IT,setdiff1dAsync:s3,sigmoid:lu,sign:l$,signal:_3,sin:OT,sinh:DT,slice:Xn,slice1d:B2,slice2d:$T,slice3d:j2,slice4d:X0,softmax:U2,softplus:ag,spaceToBatchND:P2,sparse:T3,sparseToDense:d3,spectral:C3,split:ro,sqrt:Qi,square:As,squaredDifference:LT,squeeze:lp,stack:Ra,step:og,stridedSlice:c$,string:N3,sub:St,sum:It,tan:u$,tanh:Dm,tensor:Wo,tensor1d:Ki,tensor2d:Pf,tensor3d:h$,tensor4d:r3,tensor5d:i3,tensor6d:a3,tensorScatterUpdate:o3,tile:kl,topk:f$,transpose:Wn,truncatedNormal:MT,unique:p$,unsortedSegmentSum:PT,unstack:Ll,upperBound:l3,variable:m$,where:Di,whereAsync:g$,zeros:Qr,zerosLike:Kn},Symbol.toStringTag,{value:"Module"}));const $ve=(n,e,t,s=sa)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(U("a",n,e,t),U("b",n,e,t))];case"AddN":return[s.addN(U("tensors",n,e,t))];case"FloorMod":case"Mod":return[s.mod(U("a",n,e,t),U("b",n,e,t))];case"Mul":return[s.mul(U("a",n,e,t),U("b",n,e,t))];case"RealDiv":case"Div":return[s.div(U("a",n,e,t),U("b",n,e,t))];case"DivNoNan":return[s.divNoNan(U("a",n,e,t),U("b",n,e,t))];case"FloorDiv":return[s.floorDiv(U("a",n,e,t),U("b",n,e,t))];case"Sub":return[s.sub(U("a",n,e,t),U("b",n,e,t))];case"Minimum":return[s.minimum(U("a",n,e,t),U("b",n,e,t))];case"Maximum":return[s.maximum(U("a",n,e,t),U("b",n,e,t))];case"Pow":return[s.pow(U("a",n,e,t),U("b",n,e,t))];case"SquaredDifference":return[s.squaredDifference(U("a",n,e,t),U("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Rve=(n,e,t,s=sa)=>{switch(n.op){case"Abs":case"ComplexAbs":return[s.abs(U("x",n,e,t))];case"Acos":return[s.acos(U("x",n,e,t))];case"Acosh":return[s.acosh(U("x",n,e,t))];case"Asin":return[s.asin(U("x",n,e,t))];case"Asinh":return[s.asinh(U("x",n,e,t))];case"Atan":return[s.atan(U("x",n,e,t))];case"Atan2":return[s.atan2(U("x",n,e,t),U("y",n,e,t))];case"Atanh":return[s.atanh(U("x",n,e,t))];case"Ceil":return[s.ceil(U("x",n,e,t))];case"Complex":return[s.complex(U("real",n,e,t),U("imag",n,e,t))];case"Cos":return[s.cos(U("x",n,e,t))];case"Cosh":return[s.cosh(U("x",n,e,t))];case"Elu":return[s.elu(U("x",n,e,t))];case"Erf":return[s.erf(U("x",n,e,t))];case"Exp":return[s.exp(U("x",n,e,t))];case"Expm1":return[s.expm1(U("x",n,e,t))];case"Floor":return[s.floor(U("x",n,e,t))];case"Log":return[s.log(U("x",n,e,t))];case"Log1p":return[s.log1p(U("x",n,e,t))];case"Imag":return[s.imag(U("x",n,e,t))];case"Neg":return[s.neg(U("x",n,e,t))];case"Reciprocal":return[s.reciprocal(U("x",n,e,t))];case"Real":return[s.real(U("x",n,e,t))];case"Relu":return[s.relu(U("x",n,e,t))];case"Round":return[s.round(U("x",n,e,t))];case"Selu":return[s.selu(U("x",n,e,t))];case"Sigmoid":return[s.sigmoid(U("x",n,e,t))];case"Sin":return[s.sin(U("x",n,e,t))];case"Sign":return[s.sign(U("x",n,e,t))];case"Sinh":return[s.sinh(U("x",n,e,t))];case"Softplus":return[s.softplus(U("x",n,e,t))];case"Sqrt":return[s.sqrt(U("x",n,e,t))];case"Square":return[s.square(U("x",n,e,t))];case"Tanh":return[s.tanh(U("x",n,e,t))];case"Tan":return[s.tan(U("x",n,e,t))];case"ClipByValue":return[s.clipByValue(U("x",n,e,t),U("clipValueMin",n,e,t),U("clipValueMax",n,e,t))];case"Relu6":return[s.relu6(U("x",n,e,t))];case"Rsqrt":return[s.rsqrt(Xi(n.inputNames[0],e,t))];case"LeakyRelu":return[s.leakyRelu(U("x",n,e,t),U("alpha",n,e,t))];case"Prelu":return[s.prelu(U("x",n,e,t),U("alpha",n,e,t))];case"IsNan":return[s.isNaN(Xi(n.inputNames[0],e,t))];case"IsInf":return[s.isInf(Xi(n.inputNames[0],e,t))];case"IsFinite":return[s.isFinite(Xi(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};function cc(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){ee(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let s=0;s<n.length;s++){const r=n[s],a=e[s];ee(r<0||a<0||r===a,()=>t+` Shapes ${n} and ${e} must match`)}}}function _B(n){return!(typeof n=="number"||n.some(e=>e<0))}function Eb(n,e,t){let s=$I(n,t);const r=!_B(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(a=>{s=$I(a.shape,s)}),!_B(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function $I(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let s=0;s<n.length;++s){const r=n[s],a=e[s];if(r>=0&&a>=0&&r!==a)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[s]=r>=0?r:a}return t}class Lve{constructor(e,t,s,r,a,o,l){this.name=e,this.dtype=t,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=l,this.tensors=[],this.closed_=!1,this.idTensor=Xt(0),fi(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),cc(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=t,fi(t),s.written=!0,this.tensors[e]=s}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((s,r)=>this.write(s,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Wo([],[0].concat(this.elementShape));const s=this.readMany(e);return cc(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Ra(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Wo([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const s=this.readMany(t);return cc(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Pr(s,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Ll(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let s=0;const r=e.map(c=>(s+=c,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const a=s===0?0:t.size/s,o=[];Le(()=>{t=_e(t,[1,s,a]);for(let c=0;c<e.length;++c){const d=[0,c===0?0:r[c-1],0],p=[1,e[c],a];o[c]=_e(Xn(t,d,p),this.elementShape)}return o});const l=[];for(let c=0;c<e.length;c++)l[c]=c;this.writeMany(l,o)}}class zm{get id(){return this.idTensor.id}constructor(e,t,s,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=s,e?.forEach(a=>{if(s!==a.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${a.dtype}`);cc(t,a.shape,"TensorList shape mismatch: "),fi(a)}),this.idTensor=Xt(0),this.maxNumElements=r,fi(this.idTensor)}copy(){return new zm([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,s=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);cc(e,this.elementShape,"TensorList shape mismatch: ");const r=Eb(this.elementShape,this.tensors,e);return Le(()=>{const a=this.tensors.map(o=>_e(o,r));return Ra(a,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Eb(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,cc(r.shape,e,"TensorList shape mismatch: "),_e(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(cc(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");fi(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new zm([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)t.tensors[s]=this.tensors[s];return t}getItem(e,t,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);cc(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=Eb(this.elementShape,this.tensors,t);return _e(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);cc(this.elementShape,t.shape,"TensorList shape mismatch: "),fi(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,s){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);cc(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=Eb(this.elementShape,this.tensors,s);return e.length===0?Wo([],[0].concat(r)):Le(()=>{const a=e.map(o=>_e(this.tensors[o],r));return Ra(a,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);cc(this.elementShape,t,"TensorList shape mismatch: ");const s=Eb(this.elementShape,this.tensors,t);return this.size()===0?Wo([],[0].concat(s)):Le(()=>{const r=this.tensors.map(a=>_e(a,s));return Pr(r,0)})}}function Fve(n,e,t){const s=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const r=n.shape.slice(1);cc(r,e,"TensorList shape mismatch: ");const a=Ll(n);return new zm(a,e,s)}function Mve(n,e,t,s){return new zm([],n,e,s)}function Pve(n,e,t,s){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const a=new zm([],t,n.dtype,s),o=Ll(n,0);return e.forEach((l,c)=>{a.setItem(l,o[c])}),a}function zve(n,e,t){let s=0;const r=e.map(d=>(s+=d,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);const a=n.shape.slice(1),o=$I(a,t),l=s===0?0:n.size/s,c=Le(()=>{const d=[];n=_e(n,[1,s,l]);for(let p=0;p<e.length;++p){const g=[0,p===0?0:r[p-1],0],b=[1,e[p],l];d[p]=_e(Xn(n,g,b),o)}return n.dispose(),d}),u=new zm([],t,n.dtype,e.length);for(let d=0;d<c.length;d++)u.setItem(d,c[d]);return u}const Bve=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const s=U("thenBranch",n,e,t),r=U("elseBranch",n,e,t),a=U("cond",n,e,t),o=U("args",n,e,t);return(await a.data())[0]?t.functionMap[s].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap):t.functionMap[r].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const s=U("body",n,e,t),r=U("cond",n,e,t),a=U("args",n,e,t),o=await t.functionMap[r].executeFunctionAsync(a,t.tensorArrayMap,t.tensorListMap),l=a.map(d=>d.id);let c=await o[0].data();o.forEach(d=>{!d.kept&&l.indexOf(d.id)===-1&&d.dispose()});let u=a;for(;c[0];){const d=u;u=await t.functionMap[s].executeFunctionAsync(u,t.tensorArrayMap,t.tensorListMap);const p=u.map(g=>g.id);d.forEach(g=>{!g.kept&&l.indexOf(g.id)===-1&&p.indexOf(g.id)===-1&&g.dispose()});const m=await t.functionMap[r].executeFunctionAsync(u,t.tensorArrayMap,t.tensorListMap);c=await m[0].data(),m.forEach(g=>{!g.kept&&l.indexOf(g.id)===-1&&p.indexOf(g.id)===-1&&g.dispose()})}return u}case"LoopCond":{const s=U("pred",n,e,t);return[ud(s)]}case"Switch":{const s=U("pred",n,e,t);let r=U("data",n,e,t);return r.kept||(r=ud(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=n.inputNames.find(r=>Xi(r,e,t)!==void 0);if(s){const r=Xi(s,e,t);return[ud(r)]}return}case"Enter":{const s=U("frameName",n,e,t),r=U("tensor",n,e,t);return t.enterFrame(s),[ud(r)]}case"Exit":{const s=U("tensor",n,e,t);return t.exitFrame(),[ud(s)]}case"NextIteration":{const s=U("tensor",n,e,t);return t.nextIteration(),[ud(s)]}case"TensorArrayV3":{const s=U("size",n,e,t),r=U("dtype",n,e,t),a=U("elementShape",n,e,t),o=U("dynamicSize",n,e,t),l=U("clearAfterRead",n,e,t),c=U("identicalElementShapes",n,e,t),u=U("name",n,e,t),d=new Lve(u,r,s,a,c,o,l);return t.addTensorArray(d),[d.idTensor,Xt(1)]}case"TensorArrayWriteV3":{const s=U("tensorArrayId",n,e,t),r=U("index",n,e,t),a=U("tensor",n,e,t),o=t.getTensorArray(s.id);return o.write(r,a),[o.idTensor]}case"TensorArrayReadV3":{const s=U("tensorArrayId",n,e,t),r=U("index",n,e,t);return[t.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=U("tensorArrayId",n,e,t),r=U("indices",n,e,t),a=U("dtype",n,e,t);return[t.getTensorArray(s.id).gather(r,a)]}case"TensorArrayScatterV3":{const s=U("tensorArrayId",n,e,t),r=U("indices",n,e,t),a=U("tensor",n,e,t),o=t.getTensorArray(s.id);return o.scatter(r,a),[o.idTensor]}case"TensorArrayConcatV3":{const s=U("tensorArrayId",n,e,t),r=t.getTensorArray(s.id),a=U("dtype",n,e,t);return[r.concat(a)]}case"TensorArraySplitV3":{const s=U("tensorArrayId",n,e,t),r=U("tensor",n,e,t),a=U("lengths",n,e,t),o=t.getTensorArray(s.id);return o.split(a,r),[o.idTensor]}case"TensorArraySizeV3":{const s=U("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return[Xt(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=U("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=U("tensorListId",n,e,t),r=U("index",n,e,t),a=U("tensor",n,e,t),o=t.getTensorList(s.id);return o.setItem(r,a),[o.idTensor]}case"TensorListGetItem":{const s=U("tensorListId",n,e,t),r=U("index",n,e,t),a=U("elementShape",n,e,t),o=U("elementDType",n,e,t);return[t.getTensorList(s.id).getItem(r,a,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=U("indices",n,e,t),r=U("tensor",n,e,t),a=U("elementShape",n,e,t),o=U("numElements",n,e,t),l=Pve(r,s,a,o);return t.addTensorList(l),[l.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=U("elementShape",n,e,t),r=U("elementDType",n,e,t);let a;n.op==="TensorListReserve"?a="numElements":a="maxNumElements";const o=U(a,n,e,t),l=n.op==="TensorListReserve"?-1:o,c=Mve(s,r,o,l);return t.addTensorList(c),[c.idTensor]}case"TensorListGather":{const s=U("tensorListId",n,e,t),r=U("indices",n,e,t),a=U("elementShape",n,e,t),o=U("elementDType",n,e,t);return[t.getTensorList(s.id).gather(r,o,a)]}case"TensorListStack":{const s=U("tensorListId",n,e,t),r=U("elementShape",n,e,t),a=U("elementDType",n,e,t),o=U("numElements",n,e,t);return[t.getTensorList(s.id).stack(r,a,o)]}case"TensorListFromTensor":{const s=U("tensor",n,e,t),r=U("elementShape",n,e,t),a=U("elementDType",n,e,t),o=Fve(s,r,a);return t.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=U("tensorListId",n,e,t),r=t.getTensorList(s.id),a=U("dtype",n,e,t),o=U("elementShape",n,e,t);return[r.concat(a,o)]}case"TensorListPushBack":{const s=U("tensorListId",n,e,t),r=U("tensor",n,e,t),a=t.getTensorList(s.id);return a.pushBack(r),[a.idTensor]}case"TensorListPopBack":{const s=U("tensorListId",n,e,t),r=U("elementShape",n,e,t),a=U("elementDType",n,e,t);return[t.getTensorList(s.id).popBack(r,a)]}case"TensorListSplit":{const s=U("tensor",n,e,t),r=U("elementShape",n,e,t),a=U("lengths",n,e,t),o=zve(s,a,r);return t.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=U("tensorListId",n,e,t),r=t.getTensorList(s.id);return[Xt(r.size(),"int32")]}case"TensorListResize":{const s=U("tensorListId",n,e,t),r=U("size",n,e,t),o=t.getTensorList(s.id).resize(r);return t.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};function kB(n,e,t){const[s,r]=U("fusedOps",n,e,t),a=s==="biasadd",o=!a,l=r==="prelu",c=s==="fusedbatchnorm",u=U("numArgs",n,e,t);if(a){if(l&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&a&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const d=U("strides",n,e,t),p=lC(n,e,t),m=U("dataFormat",n,e,t).toUpperCase(),g=U("dilations",n,e,t);let[b,v]=U("args",n,e,t);o&&(v=b,b=void 0);const x=U("leakyreluAlpha",n,e,t);return{stride:d,pad:p,dataFormat:m,dilations:g,biasArg:b,preluArg:v,activationFunc:r,leakyreluAlpha:x}}const jve=(n,e,t,s=sa)=>{switch(n.op){case"Conv1D":{const r=U("stride",n,e,t),a=U("pad",n,e,t),o=U("dataFormat",n,e,t).toUpperCase(),l=U("dilation",n,e,t);return[s.conv1d(U("x",n,e,t),U("filter",n,e,t),r,a,o,l)]}case"Conv2D":{const r=U("strides",n,e,t),a=lC(n,e,t),o=U("dataFormat",n,e,t).toUpperCase(),l=U("dilations",n,e,t);return[s.conv2d(U("x",n,e,t),U("filter",n,e,t),[r[1],r[2]],a,o,[l[1],l[2]])]}case"_FusedConv2D":{const{stride:r,pad:a,dataFormat:o,dilations:l,biasArg:c,preluArg:u,activationFunc:d,leakyreluAlpha:p}=kB(n,e,t);return[s.fused.conv2d({x:U("x",n,e,t),filter:U("filter",n,e,t),strides:[r[1],r[2]],pad:a,dataFormat:o,dilations:[l[1],l[2]],bias:c,activation:d,preluActivationWeights:u,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:a,dataFormat:o,dilations:l,biasArg:c,preluArg:u,activationFunc:d,leakyreluAlpha:p}=kB(n,e,t);return[s.fused.depthwiseConv2d({x:U("x",n,e,t),filter:U("filter",n,e,t),strides:[r[1],r[2]],pad:a,dataFormat:o,dilations:[l[1],l[2]],bias:c,activation:d,preluActivationWeights:u,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=U("outputShape",n,e,t),a=U("strides",n,e,t),o=lC(n,e,t);return[s.conv2dTranspose(U("x",n,e,t),U("filter",n,e,t),r,[a[1],a[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=U("strides",n,e,t),a=lC(n,e,t),o=U("dilations",n,e,t),l=U("dataFormat",n,e,t).toUpperCase();return[s.depthwiseConv2d(U("input",n,e,t),U("filter",n,e,t),[r[1],r[2]],a,l,[o[1],o[2]])]}case"Conv3D":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("dataFormat",n,e,t).toUpperCase(),l=U("dilations",n,e,t);return[s.conv3d(U("x",n,e,t),U("filter",n,e,t),[r[1],r[2],r[3]],a,o,[l[1],l[2],l[3]])]}case"AvgPool":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("kernelSize",n,e,t);return[s.avgPool(U("x",n,e,t),[o[1],o[2]],[r[1],r[2]],a)]}case"MaxPool":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("kernelSize",n,e,t);return[s.maxPool(U("x",n,e,t),[o[1],o[2]],[r[1],r[2]],a)]}case"MaxPoolWithArgmax":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("kernelSize",n,e,t),l=U("includeBatchInIndex",n,e,t),{result:c,indexes:u}=s.maxPoolWithArgmax(U("x",n,e,t),[o[1],o[2]],[r[1],r[2]],a,l);return[c,u]}case"AvgPool3D":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("kernelSize",n,e,t);return[s.avgPool3d(U("x",n,e,t),[o[1],o[2],o[3]],[r[1],r[2],r[3]],a)]}case"MaxPool3D":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("kernelSize",n,e,t);return[s.maxPool3d(U("x",n,e,t),[o[1],o[2],o[3]],[r[1],r[2],r[3]],a)]}case"Dilation2D":{const r=U("strides",n,e,t),a=U("pad",n,e,t),o=U("dilations",n,e,t),l=r[1],c=r[2],u=o[1],d=o[2];return[s.dilation2d(U("x",n,e,t),U("filter",n,e,t),[l,c],a,[u,d],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Uve=(n,e,t,s=sa)=>{switch(n.op){case"Fill":{const r=U("shape",n,e,t),a=U("dtype",n,e,t),o=U("value",n,e,t);return[s.fill(r,o,a)]}case"LinSpace":{const r=U("start",n,e,t),a=U("stop",n,e,t),o=U("num",n,e,t);return[s.linspace(r,a,o)]}case"Multinomial":{const r=U("logits",n,e,t),a=U("numSamples",n,e,t),o=U("seed",n,e,t);return[s.multinomial(r,a,o)]}case"OneHot":{const r=U("indices",n,e,t),a=U("depth",n,e,t),o=U("onValue",n,e,t),l=U("offValue",n,e,t),c=U("dtype",n,e,t);return[s.oneHot(r,a,o,l,c)]}case"Ones":return[s.ones(U("shape",n,e,t),U("dtype",n,e,t))];case"OnesLike":return[s.onesLike(U("x",n,e,t))];case"RandomStandardNormal":return[s.randomStandardNormal(U("shape",n,e,t),U("dtype",n,e,t),U("seed",n,e,t))];case"RandomUniform":return[s.randomUniform(U("shape",n,e,t),U("minval",n,e,t),U("maxval",n,e,t),U("dtype",n,e,t))];case"RandomUniformInt":return[s.randomUniformInt(U("shape",n,e,t),U("minval",n,e,t),U("maxval",n,e,t),U("seed",n,e,t))];case"Range":{const r=U("start",n,e,t),a=U("stop",n,e,t),o=U("step",n,e,t);return[s.range(r,a,o,U("dtype",n,e,t))]}case"TruncatedNormal":{const r=U("shape",n,e,t),a=U("mean",n,e,t),o=U("stdDev",n,e,t),l=U("seed",n,e,t);return[s.truncatedNormal(r,a,o,U("dtype",n,e,t),l)]}case"Zeros":return[s.zeros(U("shape",n,e,t),U("dtype",n,e,t))];case"ZerosLike":return[s.zerosLike(U("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};function nE(n,e,t){const s=U("boxes",n,e,t),r=U("scores",n,e,t),a=U("maxOutputSize",n,e,t),o=U("iouThreshold",n,e,t),l=U("scoreThreshold",n,e,t),c=U("softNmsSigma",n,e,t);return{boxes:s,scores:r,maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}}const Vve=async(n,e,t,s,r=sa)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:a,scores:o,maxOutputSize:l,iouThreshold:c,scoreThreshold:u,softNmsSigma:d}=nE(n,e,t),p=await r.image.nonMaxSuppressionWithScoreAsync(a,o,l,c,u,d);return[p.selectedIndices,p.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:a,scores:o,maxOutputSize:l,iouThreshold:c,scoreThreshold:u}=nE(n,e,t),d=U("padToMaxOutputSize",n,e,t),p=await r.image.nonMaxSuppressionPaddedAsync(a,o,l,c,u,d);return[p.selectedIndices,p.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:a,scores:o,maxOutputSize:l,iouThreshold:c,scoreThreshold:u}=nE(n,e,t);return[await r.image.nonMaxSuppressionAsync(a,o,l,c,u)]}case"Where":{const a=r.cast(U("condition",n,e,t),"bool"),o=[await r.whereAsync(a)];return a.dispose(),o}case"ListDiff":return r.setdiff1dAsync(U("x",n,e,t),U("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Wve=(n,e,t,s=sa)=>{switch(n.op){case"LowerBound":{const r=U("sortedSequence",n,e,t),a=U("values",n,e,t);return[s.lowerBound(r,a)]}case"TopKV2":{const r=U("x",n,e,t),a=U("k",n,e,t),o=U("sorted",n,e,t),l=s.topk(r,a,o);return[l.values,l.indices]}case"UpperBound":{const r=U("sortedSequence",n,e,t),a=U("values",n,e,t);return[s.upperBound(r,a)]}case"Unique":{const r=U("x",n,e,t),a=s.unique(r);return[a.values,a.indices]}case"UniqueV2":{const r=U("x",n,e,t),a=U("axis",n,e,t),o=s.unique(r,a);return[o.values,o.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Hve=(n,e,t,s=sa)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const r=U("default",n,e,t);return[Xi(n.name,e,t)||r];case"Placeholder":return[Xi(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const d=U("x",n,e,t);return[ud(d)]}case"IdentityN":return U("x",n,e,t).map(d=>ud(d));case"Snapshot":const a=U("x",n,e,t);return[ud(a)];case"Shape":return[s.tensor1d(U("x",n,e,t).shape,"int32")];case"ShapeN":return U("x",n,e,t).map(d=>s.tensor1d(d.shape));case"Size":return[s.scalar(U("x",n,e,t).size,"int32")];case"Rank":return[s.scalar(U("x",n,e,t).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=U("x",n,e,t),l=U("data",n,e,t),c=U("message",n,e,t),u=U("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(let d=0;d<l.length;d++)console.log(Array.prototype.slice.call(l[d].dataSync()).slice(0,u));return[o];default:throw TypeError(`Node type ${n.op} is not implemented`)}};class Gve{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Xt(0),this.tensorMap=new Map,fi(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Xt(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),Le(()=>{const r=Ll(t),a=s.length,o=r.length;ee(a===o,()=>`The number of elements doesn't match, keys has ${a} elements, the values has ${o} elements.`);for(let l=0;l<a;l++){const c=s[l],u=r[l];fi(u),this.tensorMap.set(c,u)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return Le(()=>{const r=[];for(let a=0;a<s.length;a++){const o=s[a],l=this.findWithDefault(o,t);r.push(l)}return Ra(r)})}findWithDefault(e,t){const s=this.tensorMap.get(e);return s??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}const qve=async(n,e,t,s)=>{switch(n.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(n.name);if(r!=null)return[r];{const a=U("keyDType",n,e,t),o=U("valueDType",n,e,t),l=new Gve(a,o);return s.addHashTable(n.name,l),[l.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=U("tableHandle",n,e,t,s),a=U("keys",n,e,t),o=U("values",n,e,t);return[await s.getHashTableById(r.id).import(a,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=U("tableHandle",n,e,t,s),a=U("keys",n,e,t),o=U("defaultValue",n,e,t);return[await s.getHashTableById(r.id).find(a,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=U("tableHandle",n,e,t,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Xve=(n,e,t,s=sa)=>{switch(n.op){case"ResizeBilinear":{const r=U("images",n,e,t),a=U("size",n,e,t),o=U("alignCorners",n,e,t),l=U("halfPixelCenters",n,e,t);return[s.image.resizeBilinear(r,[a[0],a[1]],o,l)]}case"ResizeNearestNeighbor":{const r=U("images",n,e,t),a=U("size",n,e,t),o=U("alignCorners",n,e,t),l=U("halfPixelCenters",n,e,t);return[s.image.resizeNearestNeighbor(r,[a[0],a[1]],o,l)]}case"CropAndResize":{const r=U("image",n,e,t),a=U("boxes",n,e,t),o=U("boxInd",n,e,t),l=U("cropSize",n,e,t),c=U("method",n,e,t),u=U("extrapolationValue",n,e,t);return[s.image.cropAndResize(r,a,o,l,c,u)]}case"ImageProjectiveTransformV3":{const r=U("images",n,e,t),a=U("transforms",n,e,t),o=U("outputShape",n,e,t),l=U("fillValue",n,e,t),c=U("interpolation",n,e,t),u=U("fillMode",n,e,t);return[s.image.transform(r,a,c.toLowerCase(),u.toLowerCase(),l,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Yve=(n,e,t,s=sa)=>{switch(n.op){case"Equal":return[s.equal(U("a",n,e,t),U("b",n,e,t))];case"NotEqual":return[s.notEqual(U("a",n,e,t),U("b",n,e,t))];case"Greater":return[s.greater(U("a",n,e,t),U("b",n,e,t))];case"GreaterEqual":return[s.greaterEqual(U("a",n,e,t),U("b",n,e,t))];case"Less":return[s.less(U("a",n,e,t),U("b",n,e,t))];case"LessEqual":return[s.lessEqual(U("a",n,e,t),U("b",n,e,t))];case"LogicalAnd":return[s.logicalAnd(U("a",n,e,t),U("b",n,e,t))];case"LogicalNot":return[s.logicalNot(U("a",n,e,t))];case"LogicalOr":return[s.logicalOr(U("a",n,e,t),U("b",n,e,t))];case"Select":case"SelectV2":return[s.where(U("condition",n,e,t),U("a",n,e,t),U("b",n,e,t))];case"BitwiseAnd":return[s.bitwiseAnd(U("a",n,e,t),U("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Kve=(n,e,t,s=sa)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(U("a",n,e,t),U("b",n,e,t),U("transposeA",n,e,t),U("transposeB",n,e,t))];case"Einsum":return[s.einsum(U("equation",n,e,t),...U("tensors",n,e,t))];case"Transpose":return[s.transpose(U("x",n,e,t),U("perm",n,e,t))];case"_FusedMatMul":const[r,a]=U("fusedOps",n,e,t),o=r==="biasadd",l=a==="prelu",c=U("numArgs",n,e,t),u=U("leakyreluAlpha",n,e,t);if(o){if(l&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[d,p]=U("args",n,e,t);return[s.fused.matMul({a:U("a",n,e,t),b:U("b",n,e,t),transposeA:U("transposeA",n,e,t),transposeB:U("transposeB",n,e,t),bias:d,activation:a,preluActivationWeights:p,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart(U("a",n,e,t),U("numLower",n,e,t),U("numUpper",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Zve=(n,e,t,s=sa)=>{switch(n.op){case"EuclideanNorm":return[s.euclideanNorm(U("x",n,e,t),U("axis",n,e,t),U("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(U("x",n,e,t),U("mean",n,e,t),U("variance",n,e,t),U("offset",n,e,t),U("scale",n,e,t),U("epsilon",n,e,t))];case"FusedBatchNormV3":return[s.batchNorm(U("x",n,e,t),U("mean",n,e,t),U("variance",n,e,t),U("offset",n,e,t),U("scale",n,e,t),U("epsilon",n,e,t))];case"LRN":return[s.localResponseNormalization(U("x",n,e,t),U("radius",n,e,t),U("bias",n,e,t),U("alpha",n,e,t),U("beta",n,e,t))];case"Softmax":return[s.softmax(U("x",n,e,t))];case"LogSoftmax":return[s.logSoftmax(U("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Jve=(n,e,t,s=sa)=>{switch(n.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:a}=s.raggedGather(U("paramsNestedSplits",n,e,t),U("paramsDenseValues",n,e,t),U("indices",n,e,t),U("outputRaggedRank",n,e,t));return r.concat(a)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:a}=s.raggedRange(U("starts",n,e,t),U("limits",n,e,t),U("splits",n,e,t));return[r,a]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(U("shape",n,e,t),U("values",n,e,t),U("defaultValue",n,e,t),U("rowPartitionTensors",n,e,t),U("rowPartitionTypes",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const Qve=(n,e,t,s=sa)=>{switch(n.op){case"Max":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.max(U("x",n,e,t),l,c)]}case"Mean":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.mean(U("x",n,e,t),l,c)]}case"Min":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.min(U("x",n,e,t),l,c)]}case"Sum":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.sum(U("x",n,e,t),l,c)]}case"All":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.all(U("x",n,e,t),l,c)]}case"Any":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.any(U("x",n,e,t),l,c)]}case"ArgMax":{const l=U("axis",n,e,t);return[s.argMax(U("x",n,e,t),l)]}case"ArgMin":{const l=U("axis",n,e,t);return[s.argMin(U("x",n,e,t),l)]}case"Prod":{const l=U("axis",n,e,t),c=U("keepDims",n,e,t);return[s.prod(U("x",n,e,t),l,c)]}case"Cumprod":{const l=U("axis",n,e,t),c=U("exclusive",n,e,t),u=U("reverse",n,e,t);return[s.cumprod(U("x",n,e,t),l,c,u)]}case"Cumsum":{const l=U("axis",n,e,t),c=U("exclusive",n,e,t),u=U("reverse",n,e,t);return[s.cumsum(U("x",n,e,t),l,c,u)]}case"Bincount":const r=U("x",n,e,t),a=U("weights",n,e,t),o=U("size",n,e,t);return[s.bincount(r,a,o)];case"DenseBincount":{const l=U("x",n,e,t),c=U("weights",n,e,t),u=U("size",n,e,t),d=U("binaryOutput",n,e,t);return[s.denseBincount(l,c,u,d)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};const ewe=(n,e,t,s=sa)=>{switch(n.op){case"ConcatV2":case"Concat":{const r=U("n",n,e,t),a=U("axis",n,e,t);let o=U("tensors",n,e,t);return o=o.slice(0,r),[s.concat(o,a)]}case"Gather":{const r=U("x",n,e,t),a=U("indices",n,e,t);return[s.gather(r,s.cast(a,"int32"),0)]}case"GatherV2":{const r=U("axis",n,e,t),a=U("batchDims",n,e,t),o=U("x",n,e,t),l=U("indices",n,e,t);return[s.gather(o,s.cast(l,"int32"),r,a)]}case"Reverse":{const r=U("dims",n,e,t),a=[];for(let l=0;l<r.length;l++)r[l]&&a.push(l);const o=U("x",n,e,t);return[s.reverse(o,a)]}case"ReverseV2":{const r=U("axis",n,e,t),a=U("x",n,e,t);return[s.reverse(a,r)]}case"Slice":{const r=U("begin",n,e,t),a=U("size",n,e,t);return[s.slice(U("x",n,e,t),r,a)]}case"StridedSlice":{const r=U("begin",n,e,t),a=U("end",n,e,t),o=U("strides",n,e,t),l=U("beginMask",n,e,t),c=U("endMask",n,e,t),u=U("ellipsisMask",n,e,t),d=U("newAxisMask",n,e,t),p=U("shrinkAxisMask",n,e,t),m=U("x",n,e,t);return[s.stridedSlice(m,r,a,o,l,c,u,d,p)]}case"Pack":return Le(()=>{const r=U("axis",n,e,t),a=U("tensors",n,e,t),o=a[0].shape,l=s.squeeze(a[0]).shape,c=a.map(u=>{const d=jn(u.shape,o);if(!d&&!jn(s.squeeze(u).shape,l))throw new Error("the input tensors shape does not match");return d?u:s.reshape(u,o)});return[s.stack(c,r)]});case"Unpack":{const r=U("axis",n,e,t),a=U("tensor",n,e,t);return s.unstack(a,r)}case"Tile":{const r=U("reps",n,e,t);return[s.tile(U("x",n,e,t),r)]}case"Split":case"SplitV":{const r=U("axis",n,e,t),a=U("numOrSizeSplits",n,e,t),o=U("x",n,e,t);return s.split(o,a,r)}case"ScatterNd":{const r=U("indices",n,e,t),a=U("values",n,e,t),o=U("shape",n,e,t);return[s.scatterND(r,a,o)]}case"GatherNd":{const r=U("x",n,e,t),a=U("indices",n,e,t);return[s.gatherND(r,a)]}case"SparseToDense":{const r=U("sparseIndices",n,e,t),a=U("outputShape",n,e,t),o=U("sparseValues",n,e,t),l=U("defaultValue",n,e,t);return[s.sparseToDense(r,o,a,o.dtype===l.dtype?l:s.cast(l,o.dtype))]}case"TensorScatterUpdate":{const r=U("indices",n,e,t),a=U("values",n,e,t),o=U("tensor",n,e,t);return[s.tensorScatterUpdate(o,r,a)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};const twe=(n,e,t,s=sa)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:a,emptyRowIndicator:o,reverseIndexMap:l}=s.sparse.sparseFillEmptyRows(U("indices",n,e,t),U("values",n,e,t),U("denseShape",n,e,t),U("defaultValue",n,e,t));return[r,a,o,l]}case"SparseReshape":{const{outputIndices:r,outputShape:a}=s.sparse.sparseReshape(U("inputIndices",n,e,t),U("inputShape",n,e,t),U("newShape",n,e,t));return[r,a]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(U("data",n,e,t),U("indices",n,e,t),U("segmentIds",n,e,t))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(U("data",n,e,t),U("indices",n,e,t),U("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const nwe=(n,e,t,s=sa)=>{switch(n.op){case"FFT":return[s.fft(U("x",n,e,t))];case"IFFT":return[s.ifft(U("x",n,e,t))];case"RFFT":return[s.rfft(U("x",n,e,t))];case"IRFFT":return[s.irfft(U("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const swe=(n,e,t,s=sa)=>{switch(n.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(U("input",n,e,t),U("pattern",n,e,t),U("rewrite",n,e,t),U("replaceGlobal",n,e,t))];case"StringNGrams":{const{nGrams:r,nGramsSplits:a}=s.string.stringNGrams(U("data",n,e,t),U("dataSplits",n,e,t),U("separator",n,e,t),U("nGramWidths",n,e,t),U("leftPad",n,e,t),U("rightPad",n,e,t),U("padWidth",n,e,t),U("preserveShortSequences",n,e,t));return[r,a]}case"StringSplit":{const{indices:r,values:a,shape:o}=s.string.stringSplit(U("input",n,e,t),U("delimiter",n,e,t),U("skipEmpty",n,e,t));return[r,a,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(U("input",n,e,t),U("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};const rwe=(n,e,t,s=sa)=>{switch(n.op){case"Cast":return[s.cast(U("x",n,e,t),U("dtype",n,e,t))];case"ExpandDims":{const r=U("axis",n,e,t);return[s.expandDims(U("x",n,e,t),r)]}case"Squeeze":{const r=U("axis",n,e,t);return[s.squeeze(U("x",n,e,t),r)]}case"Reshape":return[s.reshape(U("x",n,e,t),U("shape",n,e,t))];case"EnsureShape":return[s.ensureShape(U("x",n,e,t),U("shape",n,e,t))];case"MirrorPad":return[s.mirrorPad(U("x",n,e,t),U("padding",n,e,t),U("mode",n,e,t))];case"PadV2":case"Pad":return[s.pad(U("x",n,e,t),U("padding",n,e,t),U("constantValue",n,e,t))];case"SpaceToBatchND":{const r=U("blockShape",n,e,t),a=U("paddings",n,e,t);return[s.spaceToBatchND(U("x",n,e,t),r,a)]}case"BatchToSpaceND":{const r=U("blockShape",n,e,t),a=U("crops",n,e,t);return[s.batchToSpaceND(U("x",n,e,t),r,a)]}case"DepthToSpace":{const r=U("blockSize",n,e,t),a=U("dataFormat",n,e,t).toUpperCase();return[s.depthToSpace(U("x",n,e,t),r,a)]}case"BroadcastTo":return[s.broadcastTo(U("x",n,e,t),U("shape",n,e,t))];case"BroadcastArgs":return[s.broadcastArgs(U("s0",n,e,t),U("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};function TB(n,e,t,s,r=Le){const a=((o,l,c)=>{switch(o.category){case"arithmetic":return r(()=>$ve(o,l,c));case"basic_math":return r(()=>Rve(o,l,c));case"control":return Bve(o,l,c);case"convolution":return r(()=>jve(o,l,c));case"creation":return r(()=>Uve(o,l,c));case"dynamic":return Vve(o,l,c);case"evaluation":return r(()=>Wve(o,l,c));case"image":return r(()=>Xve(o,l,c));case"graph":return r(()=>Hve(o,l,c));case"logical":return r(()=>Yve(o,l,c));case"matrices":return r(()=>Kve(o,l,c));case"normalization":return r(()=>Zve(o,l,c));case"ragged":return r(()=>Jve(o,l,c));case"reduction":return r(()=>Qve(o,l,c));case"slice_join":return r(()=>ewe(o,l,c));case"sparse":return r(()=>twe(o,l,c));case"spectral":return r(()=>nwe(o,l,c));case"string":return r(()=>swe(o,l,c));case"transformation":return r(()=>rwe(o,l,c));case"hash_table":return qve(o,l,c,s);case"custom":const u=jW(o.op);if(u&&u.customExecutor)return u.customExecutor(new Dve(o,l,c));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return vd(a)?a.then(o=>[].concat(o)):[].concat(a)}class NB{constructor(e={},t={},s={},r={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const s=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function AB(n,e,t,s){const r=new Set,a=[];let o=null,l=null;const c=new Set,u=new Set(Object.keys(n).map(m=>zo(m)[0]));s=s||[];const d=new Set(s.map(m=>zo(m.name)[0])),p=[...e];for(;p.length>0;){const m=p.pop();if((sm(m)||dwe(m)||fwe(m))&&o==null&&(o=m,l=o.children.map(g=>g.name).filter(g=>r.has(g))),r.add(m.name),t[m.name]==null&&!u.has(m.name)&&!d.has(m.name)){if(m.inputs.length===0){a.push(m.name);continue}m.inputs.forEach(g=>{c.has(g.name)||(c.add(g.name),p.push(g))})}}return{inputs:n,outputs:e,usedNodes:r,missingInputs:a,dynamicNode:o,syncInputs:l}}function iwe(n,e){const{usedNodes:t,inputs:s}=e,r=Object.keys(s).map(x=>zo(x)[0]).map(x=>n.nodes[x]),a=n.initNodes||[],o=x=>t.has(typeof x=="string"?x:x.name);function l(x){return[...new Map(x.map(S=>[S.name,S])).values()]}const c=l([...r,...n.weights,...a]).filter(o),u=l([...c,...Object.values(n.nodes)]).filter(o),d=new Map(u.map(x=>[x.name,x])),p={};for(const x of u){p[x.name]=p[x.name]||0;for(const S of x.children)o(S)||(p[S.name]=Number.POSITIVE_INFINITY),p[S.name]=(p[S.name]||0)+1}const m=Object.entries(p).filter(([,x])=>x===0).map(([x])=>x),g=[...m];for(;m.length>0;){const x=m.pop(),S=d.get(x);for(const C of S.children.filter(o))--p[C.name]===0&&(g.push(C.name),m.push(C.name))}const b=g.map(x=>d.get(x)),v=awe(b,c);return owe(v,c),v}function awe(n,e){const t=new Map(n.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),l=t.get(o);for(const c of l.children)!t.has(c.name)||r.has(c.name)||(r.add(c.name),s.push(c.name))}return n.filter(o=>r.has(o.name))}class OS extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function owe(n,e){const t=new Map(n.map((l,c)=>[l.name,c])),s=new Set(e.map(l=>l.name)),r=l=>s.has(typeof l=="string"?l:l.name),a=new Set(n.map(l=>l.name)),o=l=>a.has(typeof l=="string"?l:l.name);for(const l of n){for(const c of l.children.filter(o)){if(!t.has(c.name))throw new OS(`Child ${c.name} of node ${l.name} is unreachable.`);if(t.get(l.name)>t.get(c.name))throw new OS(`Node ${l.name} is scheduled to run after its child ${c.name}.`)}if(!r(l))for(const c of l.inputs){if(!t.has(c.name))throw new OS(`Input ${c.name} of node ${l.name} is unreachable.`);if(t.get(c.name)>t.get(l.name))throw new OS(`Node ${l.name} is scheduled to run before its input ${c.name}.`)}}}function lwe(n){const e=new Map(n.map((l,c)=>[l.name,c])),t=Number.MAX_SAFE_INTEGER,s=n.map((l,c)=>sm(l)?t:c),r=l=>{const c=s[e.get(l.name)];return c??-1},a=n.map((l,c)=>l.children.map(r).reduce((u,d)=>Math.max(u,d),s[c])),o=new Map;for(let l=0;l<n.length;++l){const c=a[l];if(c===t)continue;const u=n[l],d=n[c];o.has(d.name)||o.set(d.name,[]),o.get(d.name).push(u)}return o}const cwe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),uwe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),hwe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function sm(n){return cwe.has(n.op)}function dwe(n){return uwe.has(n.op)}function fwe(n){return hwe.has(n.op)}class g_{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new g_(e.functions[s],this)})}getCompilationKey(e,t){const s=e.map(a=>a.name).sort(),r=t.map(a=>a.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const s=AB(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:a,syncInputs:o}=s;if(a!=null)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const u=t.map(p=>p.name),d=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${d}]. Missing the following inputs: [${r}]`)}const l=iwe(this.graph,s),c=lwe(l);return{orderedNodes:l,nodeLiveUntilMap:c}}cloneAndKeepTensor(e){if(e==null)return null;const t=e.clone();return fi(t),t}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,this.cloneTensorList(s)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=s.map(m=>this.graph.nodes[zo(m)[0]]),a=t.map(m=>zo(m)[0]),o=new Set(a);let l=a.map(m=>this.graph.nodes[m]);l.length===0&&(l=this._outputs);const c=this.getCompilationKey(r,l);let u=this.compiledMap.get(c);u==null&&(u=this.compile(e,l),this.compiledMap.set(c,u));try{this.keepIntermediateTensors=Re().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(m){this.keepIntermediateTensors=!1,console.warn(m.message)}const d={},p={};return Le(()=>{const m=new NB(this.weightMap,d,p,this.functionExecutorMap,this.parseNodeNameCache),g=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(S=>{const[C,A]=zo(S,m),k=[];k[A]=e[S],g[C]=k,this.keepIntermediateTensors&&(this.clonedTensorsMap[C]=this.cloneTensorList(k))});const b=this.getFrozenTensorIds(g),{orderedNodes:v,nodeLiveUntilMap:x}=u;for(const S of v){if(g[S.name])continue;const C=TB(S,g,m,this._resourceManager);if(vd(C))throw new Error(`The execution of the op '${S.op}' returned a promise. Please use model.executeAsync() instead.`);g[S.name]=C,this.keepIntermediateTensors&&(this.clonedTensorsMap[S.name]=this.cloneTensorList(C)),this.checkTensorForDisposalWithNodeLiveUntilInfo(S,g,m,b,o,x.get(S.name))}return this.parent==null&&m.dispose(b),t.map(S=>Xi(S,g,m))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(t)}checkTensorForDisposal(e,t,s,r,a,o,l){if(!(sm(t)||o.has(e))){for(const c of s[e])c!=null&&(l[c.id]=(l[c.id]||0)+t.children.length);for(const c of t.inputs){if(sm(c))continue;const u=xB(c.name,s,r);if(u!=null)for(const d of u){if(!d||d.kept||a.has(d.id))continue;const p=l[d.id];p===1?(d.dispose(),delete l[d.id]):p!=null&&l[d.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,s,r,a,o){function l(c){return sm(c)||a.has(c.name)}if(!(sm(e)||o==null))for(const c of o){if(l(c))continue;const u=xB(c.name,t,s);for(const d of u)!d||d.kept||r.has(d.id)||d.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,s=!1,r={},a={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Re().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(m){this.keepIntermediateTensors=!1,console.warn(m.message)}const o=new NB(this.weightMap,r,a,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const l=await this.executeWithControlFlow(e,o,t,s),c=t.map(m=>Xi(m,l,o)),u=c.map(m=>m.id),d=Object.keys(e).map(m=>e[m].id),p=new Set([...u,...d,...this.weightIds]);return Object.values(l).forEach(m=>{m.forEach(g=>{g&&!g.isDisposed&&!p.has(g.id)&&g.dispose()})}),this.parent==null&&o.dispose(p),c}async executeFunctionAsync(e,t,s){const r=e.reduce((a,o,l)=>(a[this.inputs[l].name]=o,a),{});return this._executeAsync(r,this.outputNodes,!0,t,s)}async executeWithControlFlow(e,t,s,r){const a=Object.keys(e),o=a.map(k=>this.graph.nodes[zo(k)[0]]),l=s.map(k=>zo(k)[0]),c=new Set(l);let u=l.map(k=>this.graph.nodes[k]);u.length===0&&(u=this._outputs);const{usedNodes:d,missingInputs:p,dynamicNode:m,syncInputs:g}=AB(e,u,this.weightMap,this._initNodes),b=[...o,...this.graph.weights,...this._initNodes||[]].map(k=>({node:k,contexts:t.currentContext})),v=Object.assign({},this.weightMap);Object.keys(e).forEach(k=>{const[O,F]=zo(k),$=[];$[F]=e[k],v[O]=$});const x={},S=this.getFrozenTensorIds(v),C={};for(;b.length>0;){const k=this.processStack(o,b,t,v,C,S,c,x,d);await Promise.all(k)}m==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const A=u.filter(k=>!sm(k)&&!Xi(k.name,v,t)).map(k=>k.name);if(A.length>0){let k="";throw m!=null&&(k=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${g}]`),new Error(`Cannot compute the outputs [${A}] from the provided inputs [${a}]. Consider providing the following inputs: [${p}]. ${k}`)}return v}processStack(e,t,s,r,a,o,l,c,u){const d=[];for(;t.length>0;){const p=t.pop();s.currentContext=p.contexts;let m="";if(p.node.op==="Enter"&&U("isConstant",p.node,r,s)&&([m]=cd(p.node.name,s)),r[p.node.name]==null){const g=TB(p.node,r,s,this._resourceManager);m||([m]=cd(p.node.name,s));const b=s.currentContext;vd(g)?d.push(g.then(v=>(r[m]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[m]=this.cloneTensorList(v)),s.currentContext=b,this.checkTensorForDisposal(m,p.node,r,s,o,l,c),this.processChildNodes(p.node,t,s,r,a,u),v))):(r[m]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[m]=this.cloneTensorList(g)),this.checkTensorForDisposal(m,p.node,r,s,o,l,c),this.processChildNodes(p.node,t,s,r,a,u))}else this.processChildNodes(p.node,t,s,r,a,u)}return d}processChildNodes(e,t,s,r,a,o){e.children.forEach(l=>{const[c]=cd(l.name,s);a[c]||!o.has(l.name)||(l.op==="Merge"?l.inputNames.some(u=>!!Xi(u,r,s))&&(a[c]=!0,t.push({contexts:s.currentContext,node:l})):l.inputNames.every(u=>!!Xi(u,r,s))&&(a[c]=!0,t.push({contexts:s.currentContext,node:l})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const s=e[t],[r]=zo(t),a=this.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){const o=a.attrParams.shape.value,l=o.length===s.shape.length&&s.shape.every((c,u)=>o[u]===-1||o[u]===c);ee(l,()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}a.attrParams.dtype&&a.attrParams.dtype.value&&ee(s.dtype===a.attrParams.dtype.value,()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var t,s;const r={};for(const a in e){const o=(s=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||s===void 0?void 0:s[a];o!=null?r[o.name]=e[a]:r[a]=e[a]}return r}checkInputs(e){const t=Object.keys(e).filter(s=>{const[r]=zo(s);return this.graph.nodes[r]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var s,r;const a=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[t];return a!=null?a.name:t},{})}checkOutputs(e){e.forEach(t=>{const[s]=zo(t);if(!this.graph.nodes[s])throw new Error(`The output '${t}' is not found in the graph`)})}}class pwe{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}const mwe="?tfjs-format=file",gwe="model.json";class RL{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},s=I$){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=s,t==null&&(this.loadOptions={}),this.resourceManager=new pwe}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return vd(e)?e.then(t=>this.loadSync(t)):this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const a=this.artifacts.userDefinedMetadata;a.signature!=null&&(s=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=s,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new g_(SB.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const a=SB.Instance.transformGraph(e.modelInitializer);this.initializer=new g_(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t=e instanceof Yn?[e]:e,s={};return t.forEach((r,a)=>s[this.structuredOutputKeys[a]]=r),s}return e}predict(e,t){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,t){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var t;if(!(e instanceof Yn)&&!Array.isArray(e)){const a=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(a!=null)for(const o in a){const l=a[o];l.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[l.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((a,o)=>{var l,c,u;const d=(u=(c=(l=this.signature)===null||l===void 0?void 0:l.inputs)===null||c===void 0?void 0:c[o])===null||u===void 0?void 0:u.resourceId;return d!=null?a[o]=this.resourceIdToCapturedInput[d]:a[o]=e[r++],a},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,s=Object.keys(t);for(let r=0;r<s.length;r++){const a=s[r],o=t[a];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=this.executor.execute(e,t);return s.length>1?s:s[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=await this.executor.executeAsync(e,t);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=[e[s]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&xn(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function ywe(n,e={},t=I$){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=vwe(n));const s=new RL(n,e,t);return await s.load(),s}function bwe(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(n instanceof Array){const[s,r]=n;if(!s)throw new Error("modelJSON must be the first element of the array");if(!r||!(r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in s))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in s))throw new Error("Model JSON is missing 'weightsManifest'");const a=pD(s.weightsManifest),o=dD(s,a,r);e=r_(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=r_(n);else throw new Error("Unknown model format");const t=new RL(e);return t.load(),t}function vwe(n){return n.endsWith("/")||(n=n+"/"),`${n}${gwe}${mwe}`}const WW="4.11.0";function wwe(n,e){return y_(n,e)}function y_(n,e,t=new Map,s=new Set){if(n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(s.has(n))throw new Error("Circular references are not supported.");if(t.has(n))return t.get(n);const r=e(n);if(r.recurse&&r.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse)if(J0(n)){const a=Array.isArray(n)?[]:{};s.add(n);for(const o in n){const l=n[o],c=y_(l,e,t,s);a[o]=c}return s.delete(n),n.__proto__&&(a.__proto__=n.__proto__),a}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return t.set(n,r.value),r.value}function xwe(n,e=GW){return HW(n,e)}function HW(n,e,t=new Set){const s=n[0];if(t.has(s))throw new Error("Circular references are not supported.");const r=e(n);if(r.recurse&&r.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse)if(J0(s)){const a=Array.isArray(s)?[]:{};t.add(s);for(const o in s){const l=n.map(u=>u[o]),c=HW(l,e,t);a[o]=c}return t.delete(s),a}else throw new Error(`Can't recurse into non-iterable type: ${s}`);else return r.value}function GW(n){return n===null?null:J0(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}async function qW(n,e){const t=new Map;y_(n,e,t);for(const r of Array.from(t.keys())){const a=t.get(r);if(vd(a)){const o=await a;t.set(r,o)}}return y_(n,e,t)}function J0(n){let e=!1;if(Re().get("IS_BROWSER"))e=n instanceof TextDecoder;else{const{StringDecoder:t}=require("string_decoder");e=n instanceof t}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof Yn)&&!(n instanceof Promise)&&!e)}function Swe(n){return n==null||Cwe(n)||Array.isArray(n)||typeof n=="object"&&n instanceof Yn||di(n)}function Cwe(n){return n===null||typeof n!="object"&&typeof n!="function"}function _we(n){return wwe(n,kwe)}function kwe(n){return n instanceof Yn?{value:n.clone(),recurse:!1}:J0(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}class XW{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),s=this.get(t);return this.set(t,this.pop()),s}}class wN extends XW{constructor(){super(wN.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=this.capacity*2,t=new Array(e),s=this.length();for(let r=0;r<s;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}wN.INITIAL_CAPACITY=32;function YW(n){return new Awe(n)}function LL(n){return new Ewe(n)}function Twe(n,e){return new KW(n,e)}function Nwe(n,e=Lf.FAIL){return new Pwe(n,e)}class Ri{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let s=await e.next();for(;!s.done;)t.push(s.value),s=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),s=e(t.value);for(;!t.done&&s;)t=await this.next(),s=e(t.value)}handleErrors(e){return new Fwe(this,e)}filter(e){return new Rwe(this,e)}map(e){return new Lwe(this,e)}mapAsync(e){return new EB(this,e)}serialMapAsync(e){return new EB(this,e).serial()}flatmap(e){return new Mwe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(t=>t===!0)}rowMajorBatch(e,t=!0){return new $we(this,e,t)}columnMajorBatch(e,t=!0,s=GW){return this.rowMajorBatch(e,t).map(a=>xwe(a,s))}concatenate(e,t){return new KW(YW([this,e]),t)}take(e){return e<0||e==null?this:new Dwe(this,e)}skip(e){return e<0||e==null?this:new Owe(this,e)}prefetch(e){return new ZW(this,e)}shuffle(e,t){return new zwe(this,e,t)}serial(){return new Iwe(this)}}class Awe extends Ri{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:_we(e),done:!1}}}class Ewe extends Ri{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class Iwe extends Ri{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class Owe extends Ri{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;xn(e.value)}return this.upstream.next()}}class Dwe extends Ri{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class $we extends Ri{constructor(e,t,s=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class Rwe extends Ri{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;xn(e.value)}}}class Lwe extends Ri{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=xd(e.value),s=this.transform(e.value),r=xd(s);for(const a of t)fT(a,r)||a.dispose();return{value:s,done:!1}}}class Fwe extends Ri{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class EB extends Ri{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=xd(e.value),s=await this.transform(e.value),r=xd(s);for(const a of t)fT(a,r)||a.dispose();return{value:s,done:!1}}}class FL extends Ri{constructor(){super(),this.outputQueue=new wN,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Mwe extends FL{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=xd(e.value),s=this.transform(e.value),r=xd(s);this.outputQueue.pushAll(s);for(const a of t)fT(a,r)||a.dispose();return!0}}class KW extends Ri{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){const s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var Lf;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Lf||(Lf={}));class Pwe extends Ri{constructor(e,t=Lf.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,s=0;function r(o){return o instanceof Ri?{value:o.next().then(c=>(t++,c.done&&s++,c.value)),recurse:!1}:{value:null,recurse:!0}}const a=await qW(this.iterators,r);if(t===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case Lf.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case Lf.SHORTEST:return{value:null,done:!0};case Lf.LONGEST:}return this.count++,{value:a,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class ZW extends Ri{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new XW(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class zwe extends ZW{constructor(e,t,s){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=vy.alea(s||Gi().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(t.done)this.upstreamExhausted=!0;else return this.refill(),t}return{value:null,done:!0}}}class Ty{constructor(){this.size=null}batch(e,t=!0){const s=this;ee(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:t?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),Po(async()=>(await s.iterator()).columnMajorBatch(e,t,Uwe),r)}concatenate(e){const t=this;let s;return this.size===1/0||e.size===1/0?s=1/0:this.size!=null&&e.size!=null?s=this.size+e.size:s=null,Po(async()=>(await t.iterator()).concatenate(await e.iterator()),s)}filter(e){const t=this;let s;return this.size===1/0?s=1/0:s=null,Po(async()=>(await t.iterator()).filter(r=>Le(()=>e(r))),s)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return Po(async()=>(await t.iterator()).map(s=>Le(()=>e(s))),this.size)}mapAsync(e){const t=this;return Po(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return Po(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let s;return this.size!=null&&e>0?s=this.size*e:e===0?s=0:this.size!=null&&(e===void 0||e<0)?s=1/0:s=null,Po(async()=>{const r=LL(async()=>({value:await t.iterator(),done:!1}));return Twe(r.take(e))},s)}skip(e){const t=this;let s;return this.size!=null&&e>=0&&this.size>=e?s=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?s=0:s=null,Po(async()=>(await t.iterator()).skip(e),s)}shuffle(e,t,s=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,a=vy.alea(t||Gi().toString());return Po(async()=>{let o=a.int32();return s&&(o+=a.int32()),(await r.iterator()).shuffle(e,o.toString())},this.size)}take(e){const t=this;let s;return this.size!=null&&this.size>e?s=e:this.size!=null&&this.size<=e?s=this.size:s=null,Po(async()=>(await t.iterator()).take(e),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}Ty.MAX_BUFFER_SIZE=1e4;function Po(n,e=null){return new class extends Ty{constructor(){super(...arguments),this.size=e}async iterator(){return n()}}}function Bwe(n){return Po(async()=>YW(n),n.length)}function jwe(n){if(!J0(n))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(n))for(let t=0;t<n.length;t++)e=e==null?n[t].size:Math.min(e,n[t].size);else if(n instanceof Object)for(const t in n)e=e==null?n[t].size:Math.min(e,n[t].size);return Po(async()=>{const t=await qW(n,s=>{if(s instanceof Ty)return{value:s.iterator(),recurse:!1};if(J0(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return Nwe(t,Lf.SHORTEST)},e)}function Uwe(n){if(n===null)return null;const e=n[0];return Swe(e)?{value:Vwe(n),recurse:!1}:{value:null,recurse:!0}}function Vwe(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof Yn?Ra(n):Wo(n)}class JW extends Ty{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(r=>(r.endsWith("\r")&&(r=r.slice(0,-1)),r))}}const DS='"',Ib=Symbol("out"),IB=Symbol("field"),$S=Symbol("quote"),sE=Symbol("quoteafterquote"),OB=Symbol("quoteinquote");class QW extends Ty{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&ee(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const t=this.fullColumnNames.reduce((r,a)=>(r[a]=r[a]+1||1,r),{}),s=Object.keys(t).filter(r=>t[r]>1);if(ee(s.length===0,()=>"Duplicate column names found: "+s.toString()),this.columnConfigs){for(const r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const t=await(await this.base.iterator()).next();if(t.done)throw new Error("No data was found for CSV parsing.");const s=t.value;return this.parseRow(s,!1)}else return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new JW(e),t||(t={}),this.hasHeader=t.hasHeader!==!1,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(ee(t.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(t=>this.makeDataElement(t))}makeDataElement(e){const t=this.parseRow(e),s={},r={};for(let a=0;a<this.fullColumnNames.length;a++){const o=this.fullColumnNames[a],l=this.columnConfigs?this.columnConfigs[o]:null;if(!(this.configuredColumnsOnly&&!l)){const c=t[a];let u=null;if(c==="")if(l&&l.default!==void 0)u=l.default;else{if(l&&(l.required||l.isLabel))throw new Error(`Required column ${o} is empty in this line: ${e}`);u=void 0}else{const d=Number(c);if(isNaN(d))l&&l.dtype==="bool"?u=this.getBoolean(c):u=c;else if(!l||!l.dtype)u=d;else switch(l.dtype){case"float32":u=d;break;case"int32":u=Math.floor(d);break;case"bool":u=this.getBoolean(c);break;default:u=d}}l&&l.isLabel?r[o]=u:s[o]=u}}return Object.keys(r).length===0?s:{xs:s,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,t=!0){const s=[];let r=0;const a=e.length;let o=Ib;for(let l=0;l<a;l++)switch(o){case Ib:switch(e.charAt(l)){case DS:r=l+1,o=$S;break;case this.delimiter:if(r=l+1,this.delimiter===" "&&this.delimWhitespace)break;s.push(""),o=Ib;break;default:o=IB,r=l;break}break;case IB:e.charAt(l)===this.delimiter&&(s.push(e.substring(r,l)),o=Ib,r=l+1);break;case $S:e.charAt(l)===DS&&(o=sE);break;case sE:switch(e.charAt(l)){case this.delimiter:s.push(e.substring(r,l-1)),o=Ib,r=l+1;break;case DS:o=$S;break;default:o=OB;break}break;case OB:e.charAt(l)===DS&&(o=$S);break}if(o===sE?s.push(e.substring(r,a-1)):s.push(e.substring(r)),t&&s.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${s}`);return s}}class ML extends Ri{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const t=Math.log2(this.fftSize);if(this.fftSize<0||t<4||t>14||!Number.isInteger(t))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=e.includeSpectrogram!==!1,this.includeWaveform=e.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(!Re().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const t=new ML(e);return await t.start(),t}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(s){throw new Error(`Error thrown while initializing video stream: ${s.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,t.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,t;const s=await this.getAudioData();if(this.includeSpectrogram){const r=this.flattenQueue(s.freqDataQueue);e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const r=this.flattenQueue(s.timeDataQueue);t=this.getTensorFromAudioDataArray(r,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:t},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],t=[];let s=0;return new Promise(r=>{const a=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:e,timeDataQueue:t}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),t.push(this.timeData.slice())),++s===this.numFrames&&(clearInterval(a),r({freqDataQueue:e,timeDataQueue:t}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const t=e[0].length,s=new Float32Array(e.length*t);return e.forEach((r,a)=>s.set(r,a*t)),s}getTensorFromAudioDataArray(e,t){const s=new Float32Array(We(t));return s.set(e,s.length-e.length),Wo(s,t)}}class PL extends Ri{constructor(e,t){if(super(),this.webcamVideoElement=e,this.webcamConfig=t,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=Ki([0],"int32"),this.webcamConfig.centerCrop){const s=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,r=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,a=(1-s)/2,o=(1-r)/2,l=a+s,c=r+o;this.cropBox=Pf([o,a,c,l],[1,4])}else this.cropBox=Pf([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,t={}){if(!Re().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!t.resizeWidth||!t.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=t.resizeWidth,e.height=t.resizeHeight}const s=new PL(e,t);return await s.start(),s}async start(){this.webcamConfig.facingMode&&ee(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message=`Error thrown while initializing video stream: ${e.message}`,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=M3(this.webcamVideoElement)}catch(t){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(t)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(t){throw new Error(`Error thrown cropping the video: ${t.message}`)}finally{e.dispose()}else return{value:e,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(e){return Le(()=>{const t=qi(ft(e,"float32"),0);let s;s=hc.cropAndResize(t,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const r=s.shape;return _e(s,r.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class eH{}class tH extends Ri{split(e){return new Wwe(this,e)}}class Wwe extends tH{constructor(e,t){super(),this.upstream=e,this.impl=new Hwe(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Hwe extends FL{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);const t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(const s of t.slice(0,-1))this.outputQueue.push(s);return this.carryover=t[t.length-1],!0}}class Gwe extends Ri{decodeUTF8(){return new qwe(this)}}class qwe extends tH{constructor(e){super(),this.upstream=e,this.impl=new Xwe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Xwe extends FL{constructor(e){if(super(),this.upstream=e,Re().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:t}=require("string_decoder");this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const e=await this.upstream.next();let t;if(e.done)return!1;t=e.value;let s;return Re().get("IS_BROWSER")?s=this.decoder.decode(t,{stream:!0}):s=this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(s),!0}}class nH extends Gwe{constructor(e,t={}){super(),this.file=e,this.options=t,ee(e instanceof Uint8Array||(Re().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((t,s)=>{const r=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)t(new Uint8Array(this.file.slice(this.offset,r)));else{const a=new FileReader;a.onload=l=>{let c=a.result;if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),!(c instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));t(c)},a.onabort=l=>s(new Error("Aborted")),a.onerror=l=>s(new Error(l.type));const o=this.file.slice(this.offset,r);a.readAsArrayBuffer(o)}this.offset=r}),done:!1}}}async function Ywe(n,e={},t){let s,r;typeof n=="string"?s=n:(s=n.url,r=Kwe(n));const a=await sV(s,r);if(a.ok){const o=new Uint8Array(await a.arrayBuffer());return new nH(o,e)}else throw new Error(a.statusText)}const Kwe=n=>({method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity});function sH(n){return typeof n=="string"&&n.slice(0,7)==="file://"}class rH extends eH{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(sH(this.input)&&Re().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new nH(this.input,this.options)}}class iH extends eH{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return sH(this.url)?new rH(this.url,this.fileOptions).iterator():Ywe(this.url,this.fileOptions)}}function Zwe(n,e={}){return new QW(new iH(n),e)}function Jwe(n){const e=LL(n);return Po(async()=>e)}function Qwe(n){return Po(async()=>{const e=await n();return LL(()=>e.next())})}async function e2e(n,e){return PL.create(n,e)}async function t2e(n){return ML.create(n)}const aH="4.11.0";const n2e=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:QW,Dataset:Ty,FileDataSource:rH,TextLineDataset:JW,URLDataSource:iH,array:Bwe,csv:Zwe,func:Jwe,generator:Qwe,microphone:t2e,version_data:aH,webcam:e2e,zip:jwe},Symbol.toStringTag,{value:"Module"}));function Rt(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&ee(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}const s2e=zT;class rx extends sk{nextDataId(){return rx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new QO(this,Qc())}write(e,t,s){this.firstUse&&(this.firstUse=!1,Re().get("IS_NODE")&&xl(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&ih(s[0])){const a=s.map(o=>ch(o));r=this.write(a,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),a=this.readSync(s.imag.dataId);return kd(r,a)}return HU(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>wd(r));return Dn(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Dn(e.shape,e.dtype,t)}makeOutput(e,t,s){return Qc().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Gi();return e(),{kernelMs:Gi()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Rt([e],"where");const t=this.readSync(e.dataId);return s2e(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}rx.nextDataId=0;function oH(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const r2e=n=>{const{x:e}=n.inputs,t=n.backend;Rt(e,"abs");let s=new Float32Array(We(e.shape));const r=t.data.get(e.dataId).values;return s=oH(r),t.makeOutput(s,e.shape,e.dtype)},i2e={kernelName:Sw,backendName:"cpu",kernelFunc:r2e};function Ur(n){return(e,t,s,r,a)=>{const o=Sn(e,t),l=o.length,c=Ht(o),u=We(o),d=$i(a,u),p=e.length,m=t.length,g=Ht(e),b=Ht(t),v=$m(e,o),x=$m(t,o);if(v.length+x.length===0)for(let S=0;S<d.length;++S)d[S]=n(s[S%s.length],r[S%r.length]);else for(let S=0;S<d.length;++S){const C=sg(S,l,c),A=C.slice(-p);v.forEach($=>A[$]=0);const k=ou(A,p,g),O=C.slice(-m);x.forEach($=>O[$]=0);const F=ou(O,m,b);d[S]=n(s[k],r[F])}return[d,o]}}function Bo(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,a=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,l=t.makeTensorInfo(s.shape,"complex64"),c=t.data.get(l.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",a),imag:t.makeTensorInfo(r.shape,"float32",o)},l}const a2e={kernelName:dk,backendName:"cpu",kernelFunc:Bo};function b_(n,e,t="float32"){if(t==="complex64"){const r=b_(n,e,"float32"),a=b_(n,e,"float32");return Bo({inputs:{real:r,imag:a},backend:n})}const s=Ji(We(e),t);return n.makeTensorInfo(e,t,s)}function Sh(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const o2e={kernelName:P1,backendName:"cpu",kernelFunc:Sh};function Bm(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,a=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,a)}const l2e={kernelName:Hk,backendName:"cpu",kernelFunc:Bm};function lH(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=np([0],t),[a,o]=Ur((l,c)=>l!==c?1:0)(e,[],n,r,"bool");return[o,"bool",a]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Jf(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:a}=s;if(a==="complex64"){if(r.dtype==="complex64")return Sh({inputs:{x:r},backend:t});const d=b_(t,r.shape,r.dtype),p=Jf({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),m=Bo({inputs:{real:p,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),m}if(r.dtype==="complex64"){const d=Bm({inputs:{input:r},backend:t}),p=Jf({inputs:{x:d},backend:t,attrs:{dtype:a}});return t.disposeIntermediateTensorInfo(d),p}if(!nD(r.dtype,a)){const d=Sh({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:a}}const o=t.data.get(r.dataId).values,[l,c,u]=lH(o,r.shape,r.dtype,a);return t.makeTensorInfo(l,c,u)}const c2e={kernelName:k1,backendName:"cpu",kernelFunc:Jf};function vi(n,e,t,s){return t==null?({inputs:r,backend:a})=>{const{a:o,b:l}=r,c=a;Rt([o,l],n);const u=c.data.get(o.dataId).values,d=c.data.get(l.dataId).values,p=o.dtype==="string"?Td(u):u,m=o.dtype==="string"?Td(d):d,g=s||o.dtype,[b,v]=e(o.shape,l.shape,p,m,g);return c.makeTensorInfo(v,g,b)}:({inputs:r,backend:a})=>{const{a:o,b:l}=r,c=a;if(o.dtype==="complex64"||l.dtype==="complex64"){const u=Jf({inputs:{x:o},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(u.dataId),p=d.complexTensorInfos.real,m=d.complexTensorInfos.imag,g=c.data.get(p.dataId).values,b=c.data.get(m.dataId).values,v=Jf({inputs:{x:l},backend:c,attrs:{dtype:"complex64"}}),x=c.data.get(v.dataId),S=x.complexTensorInfos.real,C=x.complexTensorInfos.imag,A=c.data.get(S.dataId).values,k=c.data.get(C.dataId).values,[O,F,$]=t(o.shape,l.shape,g,b,A,k),M=c.makeTensorInfo($,"float32",O),R=c.makeTensorInfo($,"float32",F),z=Bo({inputs:{real:M,imag:R},backend:c});return c.disposeIntermediateTensorInfo(u),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(M),c.disposeIntermediateTensorInfo(R),z}else{const u=c.data.get(o.dataId).values,d=c.data.get(l.dataId).values,p=s||o.dtype,[m,g]=e(o.shape,l.shape,u,d,p);return c.makeTensorInfo(g,p,m)}}}function zL(n){return(e,t,s,r,a,o)=>{const l=Sn(e,t),c=We(l),u=l.length,d=Ht(l),p=$i("float32",c),m=$i("float32",c),g=$m(e,l),b=$m(t,l),v=kd(s,r),x=kd(a,o),S=e.length,C=Ht(e),A=t.length,k=Ht(t);if(g.length+b.length===0)for(let O=0;O<p.length;O++){const F=O%v.length,$=O%x.length,M=n(v[F*2],v[F*2+1],x[$*2],x[$*2+1]);p[O]=M.real,m[O]=M.imag}else for(let O=0;O<p.length;O++){const F=sg(O,u,d),$=F.slice(-S);g.forEach(j=>$[j]=0);const M=ou($,S,C),R=F.slice(-A);b.forEach(j=>R[j]=0);const z=ou(R,A,k),I=n(v[M*2],v[M*2+1],x[z*2],x[z*2+1]);p[O]=I.real,m[O]=I.imag}return[p,m,l]}}const cH=Ur(((n,e)=>n+e)),u2e=zL(((n,e,t,s)=>({real:n+t,imag:e+s}))),Q0=vi(rg,cH,u2e),h2e={kernelName:rg,backendName:"cpu",kernelFunc:Q0};function BL(n,e,t,s,r){const a=We(s),o=Ji(r,t);for(let l=0;l<n.length;l++){const c=n[l];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(a>0?o[c]+=e[l]:o[c]+=1)}return o}function uH(n,e,t,s=!1){const r=n.shape[0],a=n.shape[1],o=Dn([r,t],e.dtype);for(let l=0;l<r;l++)for(let c=0;c<a;c++){const u=n.get(l,c);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,l,u):e.size>0?o.set(o.get(l,u)+e.get(l,c),l,u):o.set(o.get(l,u)+1,l,u))}return o}const hH=Ur(((n,e)=>n&e)),d2e=vi(Iw,hH),f2e={kernelName:Iw,backendName:"cpu",kernelFunc:d2e};function Nh(n){return(e,t,s)=>{const r=kr(t,e.length);for(let a=0;a<e.length;++a)r[a]=n(e[a],s);return r}}function xs(n,e,t){const s=Nh(e);return up(n,s,t)}function up(n,e,t){return({inputs:s,attrs:r,backend:a})=>{const{x:o}=s;Rt(o,n);const l=a,c=l.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");u=Td(c)}else u=c;const d=t||o.dtype,p=e(u,d,r);return l.makeTensorInfo(o.shape,d,p)}}const dH=Nh(n=>Math.ceil(n)),p2e=up(T1,dH),m2e={kernelName:T1,backendName:"cpu",kernelFunc:p2e};function fH(n,e,t,s){const r=kr(t,We(e));if(s&&t!=="string"){let a=0;n.forEach(o=>{const l=We(o.shape);r.set(o.vals,a),a+=l})}else{let a=0;n.forEach(o=>{const l=t==="string"?Td(o.vals):o.vals;let c=0;for(let u=0;u<o.shape[0];++u){const d=u*e[1]+a;for(let p=0;p<o.shape[1];++p)r[d+p]=l[c++]}a+=o.shape[1]})}return r}const pH=Ur((n,e)=>n===e?1:0),mH=vi(zw,pH,null,"bool"),g2e={kernelName:zw,backendName:"cpu",kernelFunc:mH};const gH=Nh(n=>Math.exp(n)),yH=up($1,gH,"float32"),y2e={kernelName:$1,backendName:"cpu",kernelFunc:yH};const bH=Nh(n=>Math.expm1(n)),b2e=up(R1,bH),v2e={kernelName:R1,backendName:"cpu",kernelFunc:b2e};const vH=Nh(n=>Math.floor(n)),w2e=up(L1,vH),x2e={kernelName:L1,backendName:"cpu",kernelFunc:w2e};const wH=Ur((n,e)=>Math.floor(n/e)),S2e=vi(F1,wH,null,"int32"),C2e={kernelName:F1,backendName:"cpu",kernelFunc:S2e};function xH(n,e,t,s,r,a,o,l,c){const u=Dn([s,a],t);for(let d=0;d<s;d++){const p=[];let m=0;for(let g=0;g<r;g++){const b=n[d*r+g];m+=b*o[g],p.push(b)}if(m<0||m>=c/a)throw new Error(`Invalid indices: ${p} does not index into ${l}`);for(let g=0;g<a;g++)u.values[d*a+g]=e.get(...e.indexToLoc(m*a+g))}return u}function SH(n,e,t){const s=Dn(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),l=o[0],c=o[2],u=e.locToIndex([l,c]);o[2]=e.values[u];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}const CH=Ur((n,e)=>n>e?1:0),_2e=vi(Vw,CH,null,"bool"),k2e={kernelName:Vw,backendName:"cpu",kernelFunc:_2e};const _H=Ur((n,e)=>n>=e?1:0),T2e=vi(M1,_H,null,"bool"),N2e={kernelName:M1,backendName:"cpu",kernelFunc:T2e};const kH=Ur((n,e)=>n<e?1:0),A2e=vi(Hw,kH,null,"bool"),E2e={kernelName:Hw,backendName:"cpu",kernelFunc:A2e};const TH=Ur((n,e)=>n<=e?1:0),I2e=vi(Gw,TH,null,"bool"),O2e={kernelName:Gw,backendName:"cpu",kernelFunc:I2e};function NH(n,e,t){const s=(e-n)/(t-1),r=Ji(t,"float32");r[0]=n;for(let a=1;a<r.length;a++)r[a]=r[a-1]+s;return r}const AH=Nh(n=>Math.log(n)),D2e=up(U1,AH),$2e={kernelName:U1,backendName:"cpu",kernelFunc:D2e};function EH(n,e,t,s){const r=$i(s,We(t));for(let a=0;a<r.length;++a){const o=a*e;let l=n[o];for(let c=0;c<e;++c){const u=n[o+c];(Number.isNaN(u)||u>l)&&(l=u)}r[a]=l}return r}const IH=Ur(((n,e)=>Math.max(n,e))),R2e=vi(W1,IH),L2e={kernelName:W1,backendName:"cpu",kernelFunc:R2e};const OH=Ur(((n,e)=>Math.min(n,e))),F2e=vi(H1,OH),M2e={kernelName:H1,backendName:"cpu",kernelFunc:F2e};const jL=Ur(((n,e)=>n*e)),P2e=zL(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),xN=vi(q1,jL,P2e),z2e={kernelName:q1,backendName:"cpu",kernelFunc:xN};function DH(n,e,t){const s=Od(-1,t);return jL([],e,s,n,t)}function B2e(n){const{inputs:e,backend:t}=n,{x:s}=e;Rt(s,"neg");const r=t.data.get(s.dataId).values,[a,o]=DH(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,a)}const j2e={kernelName:s2,backendName:"cpu",kernelFunc:B2e};const $H=Ur(((n,e)=>n!==e?1:0)),U2e=vi(r2,$H,null,"bool"),V2e={kernelName:r2,backendName:"cpu",kernelFunc:U2e};function UL(n,e,t,s,r){const a=e.length,o=We(e),l=Ht(e),c=Ht(r),u=$i(t,We(r));for(let d=0;d<o;++d){const p=sg(d,a,l),m=new Array(p.length);for(let b=0;b<m.length;b++)m[b]=p[s[b]];const g=ou(m,a,c);u[g]=n[d]}return u}function po(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:a}=t;Rt(r,"transpose");const o=r.shape.length,l=new Array(o);for(let p=0;p<l.length;p++)l[p]=r.shape[a[p]];const c=s.data.get(r.dataId).values,u=UL(c,r.shape,r.dtype,a,l);return{dataId:s.write(u,l,r.dtype),shape:l,dtype:r.dtype}}const W2e={kernelName:mm,backendName:"cpu",kernelFunc:po};function RH(n,e,t,s){const[r,a]=Fi(n,s),o=lo(e,"int32"),l=Ji(We(r),o),c=We(a);for(let u=0;u<l.length;++u){const d=u*c;let p=1;for(let m=0;m<c;++m)p*=t[d+m];l[u]=p}return{outVals:l,outShape:r,outDtype:o}}function H2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s;Rt(r,"prod");const l=r.shape.length,c=Fn(a,r.shape),u=yr(c,l);let d=c,p=r;const m=[];u!=null&&(p=po({inputs:{x:r},backend:t,attrs:{perm:u}}),m.push(p),d=Br(d.length,l));const g=t.data.get(p.dataId).values,{outVals:b,outShape:v,outDtype:x}=RH(p.shape,p.dtype,g,d);let S=v;return o&&(S=zr(v,c)),m.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(S,x,b)}const G2e={kernelName:u2,backendName:"cpu",kernelFunc:H2e};function q2e(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const a=sg(r,e.length,Ht(e)).join(",");throw new Error(`indices[${a}] = ${s} is not in [0, ${t})`)}})}function X2e(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let a=1;a<s.length;++a)if(s[a-1]>s[a])throw new Error("Ragged splits must be sorted in ascending order")}}function Y2e(n,e,t,s){const r=[];let a=0;const o=e.length-1+t.length,l=new Array(o).fill(null).map(()=>[0]);X2e(t,s);let c=1;for(let u=0;u<e.length-1;++u){c*=e[u];const d=e[u+1];for(let p=1;p<c+1;++p)l[u].push(p*d)}for(let u=0;u<n.length;++u){let d=n[u],p=n[u]+1;for(let m=0;m<t.length;++m){const g=t[m],b=m+e.length-1;if(b>=0){const v=l[b],x=v[v.length-1]-g[d];for(let S=d;S<p;++S)l[b].push(g[S+1]+x)}d=g[d],p=g[p]}p!==d&&(r.push([d,p]),a+=p-d)}return{outSplits:l,valueSlices:r,numValues:a}}function K2e(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=kr("int32",s);e.push(r),n[t].forEach((a,o)=>r[o]=a)}return e}function DB(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function Z2e(n,e,t,s,r,a){const o=DB(e,2)[1],l=DB(a,2)[1];let c=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let p=0;p<s;++p)r[c*l+p]=n[d*o+p];++c}}function J2e(n,e,t,s,r){const a=e.slice();a[0]=r;const o=kr(t,We(a)),l=n.length,c=l===0?0:l/e[0];return Z2e(n,e,s,c,o,a),[o,a]}function LH(n,e,t,s,r,a,o,l){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(q2e(a,o,c),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:p,numValues:m}=Y2e(a,o,n,u),g=K2e(d),b=J2e(t,s,r,p,m);return[g,b[0],b[1]]}const $B=2147483647;function FH(n,e,t,s,r,a,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const l=e.length===0,c=r.length===0,u=o.length===0,d=[];l||d.push(e[0]),c||d.push(r[0]),u||d.push(o[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const p=d.length===0?1:d[0],m=kr("int32",p+1);m[0]=0;for(let x=0;x<p;++x){const S=l?n[0]:n[x],C=c?s[0]:s[x],A=u?a[0]:a[x];if(A===0)throw new Error("Requires delta != 0");let k;if(A>0&&C<S||A<0&&C>S)k=0;else if(k=Math.ceil(Math.abs((C-S)/A)),k>$B)throw new Error(`Requires ((limit - start) / delta) <= ${$B}`);m[x+1]=m[x]+k}const g=m[p],b=kr(t,g);let v=0;for(let x=0;x<p;++x){const S=m[x+1]-m[x];let C=l?n[0]:n[x];const A=u?a[0]:a[x];for(let k=0;k<S;++k)b[v++]=C,C+=A}return[m,b]}var ac=nu;class v_{constructor(e,t,s,r,a,o,l,c,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=a,this.defaultValue=o,this.defaultValueShape=l,this.rowPartitionValues=c,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=K3(d),this.raggedRank=Z3(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ac.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ac.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ac.VALUE_ROWIDS:return v_.getMaxWidthValueRowID(t);case ac.ROW_SPLITS:return v_.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${ac[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const a=e[r+1]-e[r];a>s&&(s=a)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],a=0;for(let o=1;o<t;++o){const l=e[o];l!==r&&(r=l,a=Math.max(o-s,a),s=o)}return Math.max(t-s,a)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return LB(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;J3(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Y3(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let l=1;l<=this.raggedRank;++l)o[l]<0&&(o[l]=this.getMaxWidth(l));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),a=[];let o=0;for(let l=0;l<r;++l,o+=t)a.push(o);for(let l=r;l<e;++l)a.push(-1);return ee(a.length===e,()=>"Final length of result must be equal to firstDimension."),a}calculateOutputIndexRowSplit(e,t,s,r){const a=e.length,o=[];for(let l=0;l<a-1;++l){const c=e[l+1]-e[l];let u=Math.min(r,c),d=t[l];d===-1&&(u=0);for(let p=0;p<u;++p)o.push(d),d+=s;for(let p=0;p<c-u;++p)o.push(-1)}if(a>0&&o.length!==e[a-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const a=e.length,o=[];if(a===0)return[];let l=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let u=t[c];o.push(u);for(let d=1;d<a;++d){const p=e[d];if(p===c)u>=0&&(++l,l<r?u+=s:u=-1);else{if(l=0,c=p,p>=t.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${t.length}`);u=t[p]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const a=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ac.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,s,r);case ac.ROW_SPLITS:if(a.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${a.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(a,t,s,r);default:throw new Error(`Unsupported partition type: ${ac[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case ac.FIRST_DIM_SIZE:return e[0];case ac.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ac.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ac[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*s[c+1];const a=LB(s,!1),o=kr(this.valuesDType,We(a));if(r[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)c=this.calculateOutputIndex(u-1,c,r[u],s[u]);this.setOutput(this.raggedRank,c,o,a)}return[a,o]}setOutput(e,t,s,r){if(s.length===0)return;const a=this.values,o=s;let l=r.slice();l=l.slice(e+1);const c=We(l),u=t.length;let d=this.defaultValue;if(d.length!==c&&d.length!==1){const b=this.defaultValueShape;Le(()=>{const v=_e(d,b);d=gm(v,l).dataSync()})}let p=0,m=0,g=0;for(let b=0;b<=u;++b){let v=b<u?t[b]:-1;if(v===g){++g;continue}if(m<g){const x=a.subarray(p*c),S=o.subarray(m*c),C=(g-m)*c;RB(S,x,C)}if(b>=u){const x=s.length;v=Math.floor(x/c)}if(v>g)if(this.defaultValue.length===1)o.subarray(g*c,v*c).fill(this.defaultValue[0]),g=v;else for(;v>g;){const x=o.slice(g*c);RB(x,d,c),++g}v<0?(p=b+1,m=g):(p=b,m=g,g=m+1)}}}function RB(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function LB(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function MH(n,e,t,s,r,a,o,l,c,u){return new v_(n,e,t,s,r,a,o,l,c,u).compute()}function PH(n,e,t,s){const r=n===e,a=n<e&&t<0,o=e<n&&t>1;if(r||a||o)return Ji(0,s);const l=Math.abs(Math.ceil((e-n)/t)),c=Ji(l,s);e<n&&t===1&&(t=-1),c[0]=n;for(let u=1;u<c.length;u++)c[u]=c[u-1]+t;return c}const zH=Nh(n=>1/Math.sqrt(n)),Q2e=up(Q1,zH),exe={kernelName:Q1,backendName:"cpu",kernelFunc:Q2e};function lm(n,e,t,s,r,a,o,l,c,u){const d=[s/r,r],p=n.values,m=e.values;if(s===0)return Dn(t,e.dtype);const g=c instanceof ni?c:Dn(d,e.dtype);typeof c=="string"||typeof c=="number"?g.values.fill(c):typeof c=="boolean"&&g.values.fill(+c);for(let b=0;b<a;b++){const v=[];let x=0;for(let S=0;S<o;S++){const C=p[b*o+S];v.push(C),x+=C*l[S]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${v} does not index into ${t}`);for(let S=0;S<r;S++)u?g.values[x*r+S]+=m[b*r+S]:g.values[x*r+S]=e.rank===0?m[0]:m[b*r+S]}return g}const txe=Nh(n=>1/(1+Math.exp(-n))),BH=xs(ry,n=>1/(1+Math.exp(-n))),nxe={kernelName:ry,backendName:"cpu",kernelFunc:BH};function jH(n,e,t,s,r){const a=$$(s,e,t),o=We(t),l=Ht(s);if(a){const p=R$(e,l);return r==="string"?n.slice(p,p+o):n.subarray(p,p+o)}const c=r==="string"?Td(n):n,u=Dn(s,r,c),d=Dn(t,r);for(let p=0;p<d.size;++p){const m=d.indexToLoc(p),g=m.map((b,v)=>b+e[v]);d.set(u.get(...g),...m)}return r==="string"?b9(d.values):d.values}function jm(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:a,size:o}=s;Rt(r,"slice");const[l,c]=KT(r,a,o);O$(r,l,c);const u=t.data.get(r.dataId).values,d=jH(u,l,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,d)}const sxe={kernelName:g2,backendName:"cpu",kernelFunc:jm};function UH(n,e,t,s,r,a,o){const l=e[0],c=a[0],u=new Array(c),d=new Array(l),p=e[1];if(c===0){if(l!==0)throw new Error(i9(l));const x=kr(t,0),S=kr(r,0);return[x,[0,p],S,u,d]}let m=!0,g=0;const b=new Array(c).fill(0);for(let x=0;x<l;++x){const S=n[x*p];if(S<0)throw new Error(a9(x,S));if(S>=c)throw new Error(o9(x,S,c));++b[S],m=m&&S>=g,g=S}let v=!0;for(let x=0;x<c;++x){const S=b[x]===0;u[x]=S,v=v&&!S,b[x]=Math.max(b[x],1),x>0&&(b[x]+=b[x-1])}if(v&&m){const x=n,S=s;for(let C=0;C<l;++C)d[C]=C;return[x,[l,p],S,u,d]}else{const x=b[c-1],S=kr(t,x*p),C=kr(r,x),A=new Array(c).fill(0);for(let k=0;k<l;++k){const O=n[k*p],F=A[O],$=(O===0?0:b[O-1])+F;A[O]++;for(let M=0;M<p;++M)S[$*p+M]=n[k*p+M];C[$]=s[k],d[k]=$}for(let k=0;k<c;++k)if(A[k]===0){const F=k===0?0:b[k-1];S[F*p+0]=k;for(let $=1;$<p;++$)S[F*p+$]=0;C[F]=o}return[S,[x,p],C,u,d]}}function VH(n,e,t,s,r){const a=We(s),o=e[0],l=r.length,c=[];let u=1,d=-1;for(let x=0;x<l;++x){const S=r[x];if(S===-1){if(d!==-1)throw new Error(l9(d,x));d=x,c.push(1)}else{if(S<0)throw new Error(c9(x,S));u*=S,c.push(S)}}if(d!==-1){if(u<=0)throw new Error(u9());const x=Math.trunc(a/u);if(u*x!==a)throw new Error(h9(s,c));c[d]=x}if(We(c)!==a)throw new Error(d9(s,c));const m=s.length,g=[];if(m>0){g[m-1]=1;for(let x=m-2;x>=0;--x)g[x]=g[x+1]*s[x+1]}const b=[];if(l>0){b[l-1]=1;for(let x=l-2;x>=0;--x)b[x]=b[x+1]*c[x+1]}const v=kr(t,o*l);for(let x=0;x<o;++x){let S=0;for(let C=0;C<m;++C)S+=n[x*m+C]*g[C];for(let C=0;C<l;++C)v[x*l+C]=Math.trunc(S/b[C]),S%=b[C]}return[v,[o,l],c]}function VL(n,e,t,s,r,a=!1,o=0){const l=s.length,c=[e[0],n.length/e[0]],u=c[1],p=l>0?r[l-1]+1:0;if(p<0)throw new Error(hI());const m=e.slice();m[0]=p;const g=m.reduce((A,k)=>A*k,1),b=kr(t,g);if(l===0)return p>0&&b.fill(o),[b,m];if(p<=0)throw new Error(hI());let v=0,x=1,S=0,C=r[v];for(;;){let A=0;if(x<l){if(A=r[x],C===A){++x;continue}if(C>=A)throw new Error(f9())}if(C<0||C>=p)throw new Error(p9(C,p));C>S&&b.fill(o,S*u,C*u);for(let k=v;k<x;++k){const O=s[k];if(O<0||O>=c[0])throw new Error(m9(k,s[k],c[0]));for(let F=0;F<u;F++)b[C*u+F]+=n[O*u+F]}if(a)for(let k=0;k<u;k++)b[C*u+k]/=x-v;if(v=x,++x,S=C+1,C=A,x>l)break}return S<p&&b.fill(o,S*u,p*u),[b,m]}const rxe=Nh(n=>Math.sqrt(n)),ixe=xs(ay,n=>Math.sqrt(n)),axe={kernelName:ay,backendName:"cpu",kernelFunc:ixe};const WH=Ur(((n,e)=>{const t=n-e;return t*t})),oxe=vi(oy,WH),lxe={kernelName:oy,backendName:"cpu",kernelFunc:oxe};const HH=Nh((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),cxe=up(x2,HH),uxe={kernelName:x2,backendName:"cpu",kernelFunc:cxe};function GH(n,e,t,s){const r=Dn(n,e.dtype);for(let a=0;a<r.size;a++){const o=r.indexToLoc(a),l=new Array(o.length);for(let c=0;c<l.length;c++)l[c]=o[c]*t[c]+s[c];r.set(e.get(...l),...o)}return r}class hxe{constructor(e,t,s,r,a,o){this.separator=ch(e),this.nGramWidths=t,this.leftPad=ch(s),this.rightPad=ch(r),this.padWidth=a,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,a,o){for(let l=0;l<a;++l){const c=this.getPadWidth(o),u=Math.max(0,c-l),d=Math.max(0,c-(a-(l+1))),p=o-(u+d),m=t+(u>0?0:l-c);let g=0;g+=u*this.leftPad.length;for(let C=0;C<p;++C)g+=e[m+C].length;g+=d*this.rightPad.length;const b=u+d+p-1;g+=b*this.separator.length,s[r+l]=new Uint8Array(g);const v=s[r+l];let x=0;const S=C=>C.forEach(A=>v[x++]=A);for(let C=0;C<u;++C)S(this.leftPad),S(this.separator);for(let C=0;C<p-1;++C)S(e[m+C]),S(this.separator);if(p>0){S(e[m+p-1]);for(let C=0;C<d;++C)S(this.separator),S(this.rightPad)}else{for(let C=0;C<d-1;++C)S(this.rightPad),S(this.separator);S(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let u=1;u<r;++u){let d=t[u]>=c;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${c}, ${s}]`);c=t[u]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const a=r-1,o=kr("int32",r);if(s===0||r===0){const c=new Array(s);for(let u=0;u<=a;++u)o[u]=0;return[c,o]}o[0]=0;for(let c=1;c<=a;++c){const u=t[c]-t[c-1];let d=0;this.nGramWidths.forEach(p=>{d+=this.getNumNGrams(u,p)}),this.preserveShort&&u>0&&d===0&&(d=1),o[c]=o[c-1]+d}const l=new Array(o[a]);for(let c=0;c<a;++c){const u=t[c];let d=o[c];if(this.nGramWidths.forEach(p=>{const m=t[c+1]-t[c],g=this.getNumNGrams(m,p);this.createNGrams(e,u,l,d,g,p),d+=g}),this.preserveShort&&d===o[c]){const p=t[c+1]-t[c];if(p===0)continue;const m=p+2*this.padWidth;this.createNGrams(e,u,l,d,1,m)}}return[l,o]}}function qH(n,e,t,s,r,a,o,l){return new hxe(t,s,r,a,o,l).compute(n,e)}function dxe(n,e,t,s){if(!n.length)return;if(e.length===0){for(let a=0;a<n.length;++a)s.push(n.subarray(a,a+1));return}if(e.length===1){const a=e[0];let o=n.indexOf(a);for(;o!==-1;){const l=n.subarray(0,o);(!t||l.length!==0)&&s.push(l),n=n.subarray(o+1),o=n.indexOf(a)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){const o=n.subarray(r,a);(!t||o.length!==0)&&s.push(o),r=a+1}}function XH(n,e,t){const s=n.length,r=[];let a=0,o=0;const l=new Array(s);for(let m=0;m<s;++m){const g=r.length;dxe(n[m],e,t,r);const b=r.length-g;l[m]=b,a+=b,o=Math.max(o,b)}const c=kr("int32",a*2),u=new Array(a),d=[s,o];let p=0;for(let m=0;m<s;++m)for(let g=0;g<l[m];++g)c[p*2]=m,c[p*2+1]=g,u[p]=r[p],++p;return[c,u,d]}function YH(n,e){const t=kr("int32",n.length);for(let s=0;s<n.length;++s)t[s]=nV(n[s]).modulo(e).getLowBitsUnsigned();return t}const KH=Ur(((n,e)=>n-e)),fxe=zL(((n,e,t,s)=>({real:n-t,imag:e-s}))),WL=vi(ly,KH,fxe),pxe={kernelName:ly,backendName:"cpu",kernelFunc:WL};function ZH(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=Dn(t,n.dtype);for(let r=0;r<s.values.length;++r){const a=s.indexToLoc(r),o=new Array(n.rank);for(let c=0;c<o.length;c++)o[c]=a[c]%n.shape[c];const l=n.locToIndex(o);s.values[r]=n.values[l]}return s}const Jb=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function JH(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const l=s-t+1,c=e-t+1,u=Math.log(l),d=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*d*(l-d)/l)*Math.sign(c-l/2),m=Math.max(t,Math.floor(e-c*d/l+p)),g=Math.min(s,Math.floor(e+(l-c)*d/l+p));JH(n,e,m,g)}const r=n[e];let a=t,o=s;for(dd(n,t,e),Jb(n[s],r)>0&&dd(n,t,s);a<o;){for(dd(n,a,o),a++,o--;Jb(n[a],r)<0;)a=a+1;for(;Jb(n[o],r)>0;)o=o-1}Jb(n[t],r)===0?dd(n,t,o):(o=o+1,dd(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function QH(n,e,t,s,r){const a=e[e.length-1],[o,l]=[n.length/a,a],c=$i(t,o*s),u=$i("int32",o*s);for(let p=0;p<o;p++){const m=p*l,g=n.subarray(m,m+l);let b=new Array(g.length);g.forEach((C,A)=>b[A]={value:C,index:A}),s<b.length&&(JH(b,s),b=b.slice(0,s)),r&&b.sort(Jb);const v=p*s,x=c.subarray(v,v+s),S=u.subarray(v,v+s);for(let C=0;C<s;C++)x[C]=b[C].value,S[C]=b[C].index}const d=e.slice();return d[d.length-1]=s,[Dn(d,t,c),Dn(d,"int32",u)]}function eG(n,e,t,s){const r=Fn(e,t)[0],a=[1,t[0],1];for(let b=0;b<r;b++)a[0]*=t[b];a[1]=t[r];for(let b=r+1;b<t.length;b++)a[2]*=t[b];const o=new Map,l=new Int32Array(t[r]),c=new ni(a,s,n),u=[],d=a[0]===1&&a[2]===1;for(let b=0;b<t[r];b++){let v;if(d)v=n[b].toString();else{const S=[];for(let C=0;C<a[0];C++)for(let A=0;A<a[2];A++)S.push(c.get(C,b,A));v=S.join(",")}const x=o.get(v);if(x!=null)l[b]=x;else{const S=o.size;o.set(v,S),l[b]=S,u.push(b)}}const p=a.slice();p[1]=o.size;const m=new ni(p,s);u.forEach((b,v)=>{for(let x=0;x<a[0];x++)for(let S=0;S<a[2];S++)m.set(c.get(x,b,S),x,v,S)});const g=t.slice();return g[r]=p[1],{outputValues:m.values,outputShape:g,indices:l}}const tG=Object.freeze(Object.defineProperty({__proto__:null,addImpl:cH,bincountImpl:BL,bincountReduceImpl:uH,bitwiseAndImpl:hH,castImpl:lH,ceilImpl:dH,concatImpl:fH,equalImpl:pH,expImpl:gH,expm1Impl:bH,floorDivImpl:wH,floorImpl:vH,gatherNdImpl:xH,gatherV2Impl:SH,greaterEqualImpl:_H,greaterImpl:CH,lessEqualImpl:TH,lessImpl:kH,linSpaceImpl:NH,logImpl:AH,maxImpl:EH,maximumImpl:IH,minimumImpl:OH,multiplyImpl:jL,negImpl:DH,notEqualImpl:$H,prodImpl:RH,raggedGatherImpl:LH,raggedRangeImpl:FH,raggedTensorToTensorImpl:MH,rangeImpl:PH,rsqrtImpl:zH,scatterImpl:lm,sigmoidImpl:txe,simpleAbsImpl:oH,sliceImpl:jH,sparseFillEmptyRowsImpl:UH,sparseReshapeImpl:VH,sparseSegmentReductionImpl:VL,sqrtImpl:rxe,squaredDifferenceImpl:WH,staticRegexReplaceImpl:HH,stridedSliceImpl:GH,stringNGramsImpl:qH,stringSplitImpl:XH,stringToHashBucketFastImpl:YH,subImpl:KH,tileImpl:ZH,topKImpl:QH,transposeImpl:UL,uniqueImpl:eG},Symbol.toStringTag,{value:"Module"}));const nG="4.11.0";gD("cpu",()=>new rx,1);const sG=xs(O1,n=>n>=0?n:Math.exp(n)-1),mxe={kernelName:O1,backendName:"cpu",kernelFunc:sG};function rG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:a}=s;Rt([r],"leakyRelu");const o=We(r.shape),l=t.data.get(r.dataId).values,c=$i("float32",o);for(let u=0;u<l.length;u++)c[u]=l[u]<0?a*l[u]:l[u];return t.makeTensorInfo(r.shape,"float32",c)}const gxe={kernelName:Ww,backendName:"cpu",kernelFunc:rG};const yxe=Ur((n,e)=>n<0?e*n:n);function iG(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Rt([s,r],"prelu");const a=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[l,c]=yxe(s.shape,r.shape,a,o,"float32");return t.makeTensorInfo(c,"float32",l)}const bxe={kernelName:c2,backendName:"cpu",kernelFunc:iG};const aG=xs(K1,n=>Math.max(0,n)),vxe={kernelName:K1,backendName:"cpu",kernelFunc:aG};const oG=xs(Z1,n=>Math.min(Math.max(0,n),6)),wxe={kernelName:Z1,backendName:"cpu",kernelFunc:oG};function w_(n,e,t,s,r){if(t==="linear")return Sh({inputs:{x:e},backend:n});if(t==="relu")return aG({inputs:{x:e},backend:n});if(t==="elu")return sG({inputs:{x:e},backend:n});if(t==="relu6")return oG({inputs:{x:e},backend:n});if(t==="prelu")return iG({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return rG({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return BH({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}function qs(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:a}=s,o=We(r.shape),l=tD(a,o),c=We(l);ee(o===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag;d.shape=l,p.shape=l}return{dataId:r.dataId,shape:l,dtype:r.dtype}}const xxe={kernelName:h2,backendName:"cpu",kernelFunc:qs};function lG(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:a}=e,{transposeA:o,transposeB:l}=s;Rt([r,a],"matMul");const c=r.shape.length,u=a.shape.length,d=o?r.shape[c-2]:r.shape[c-1],p=l?a.shape[u-1]:a.shape[u-2],m=o?r.shape[c-1]:r.shape[c-2],g=l?a.shape[u-2]:a.shape[u-1],b=r.shape.slice(0,-2),v=a.shape.slice(0,-2),x=We(b),S=We(v),A=Sn(r.shape.slice(0,-2),a.shape.slice(0,-2)).concat([m,g]);ee(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${r.shape} and ${a.shape} and transposeA=${o} and transposeB=${l} must match.`);const k=o?[x,d,m]:[x,m,d],O=l?[S,g,p]:[S,p,g],F=qs({inputs:{x:r},backend:t,attrs:{shape:k}}),$=qs({inputs:{x:a},backend:t,attrs:{shape:O}}),M=o?F.shape[1]:F.shape[2],R=o?F.shape[2]:F.shape[1],z=l?$.shape[1]:$.shape[2],I=Math.max(x,S),j=t.data.get(F.dataId).values,H=t.data.get($.dataId).values,q=Ht(F.shape),re=Ht($.shape),[X,ne,Q]=o?[q[0],1,q[1]]:[q[0],q[1],1],[he,ye,Y]=l?[1,re[1],re[0]]:[re[1],1,re[0]],B=R*z,G=Dn([I,R,z],F.dtype),J=G.values,oe=t.blockSize;for(let de=0;de<I;de++){const ge=de%x,Ae=de%S;for(let Ce=0;Ce<R;Ce+=oe){const Fe=Math.min(Ce+oe,R);for(let Ge=0;Ge<z;Ge+=oe){const ot=Math.min(Ge+oe,z);for(let ut=0;ut<M;ut+=oe){const pt=Math.min(ut+oe,M);for(let ce=Ce;ce<Fe;ce++)for(let rt=Ge;rt<ot;rt++){let At=0;for(let yt=ut;yt<pt;yt++){const nt=j[ge*X+ce*ne+yt*Q],xt=H[yt*he+rt*ye+Ae*Y];At+=nt*xt}J[de*B+(ce*z+rt)]+=At}}}}}return t.disposeIntermediateTensorInfo(F),t.disposeIntermediateTensorInfo($),t.makeTensorInfo(A,G.dtype,G.values)}const Sxe={kernelName:Aw,backendName:"cpu",kernelFunc:lG};function Cxe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:a,bias:o,preluActivationWeights:l}=e,{transposeA:c,transposeB:u,activation:d,leakyreluAlpha:p}=s;let m,g,b;const v=[];m=lG({inputs:{a:r,b:a},attrs:{transposeA:c,transposeB:u},backend:t}),o&&(g=Q0({inputs:{a:m,b:o},backend:t}),v.push(m),m=g),d&&(b=w_(t,m,d,l,p),v.push(m),m=b);for(const S of v)t.disposeIntermediateTensorInfo(S);return m}const _xe={kernelName:Ev,backendName:"cpu",kernelFunc:Cxe};const kxe=xs(b1,n=>Math.acos(n)),Txe={kernelName:b1,backendName:"cpu",kernelFunc:kxe};const Nxe=xs(v1,n=>Math.acosh(n)),Axe={kernelName:v1,backendName:"cpu",kernelFunc:Nxe};function Exe(n){const{inputs:e,backend:t}=n,s=e;Rt(e,"addN");const r=s.map(l=>t.data.get(l.dataId).values),a=Dn(s[0].shape,s[0].dtype),o=a.values;for(let l=0;l<s.length;l++){const c=r[l];for(let u=0;u<o.length;u++)o[u]+=c[u]}return t.makeTensorInfo(a.shape,a.dtype,a.values)}const Ixe={kernelName:Cw,backendName:"cpu",kernelFunc:Exe};function Oxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s;Rt(r,"all");const l=Fn(a,r.shape);let c=l;const u=yr(c,r.shape.length);let d=r;u!=null&&(d=po({inputs:{x:r},backend:t,attrs:{perm:u}}),c=Br(c.length,r.shape.length)),na("all",c,d.shape.length);const[p,m]=Fi(d.shape,c),g=We(m),b=Ji(We(p),d.dtype),v=t.data.get(d.dataId).values;for(let S=0;S<b.length;++S){const C=S*g;let A=v[C];for(let k=0;k<g;++k){const O=v[C+k];A=A&&O}b[S]=A}u!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(p,d.dtype,b);if(o){const S=zr(p,l),C=qs({inputs:{x},backend:t,attrs:{shape:S}});return t.disposeIntermediateTensorInfo(x),C}return x}const Dxe={kernelName:ak,backendName:"cpu",kernelFunc:Oxe};function $xe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s;Rt(r,"any");const l=Fn(a,r.shape);let c=l;const u=yr(c,r.shape.length);let d=r;u!=null&&(d=po({inputs:{x:r},backend:t,attrs:{perm:u}}),c=Br(c.length,r.shape.length)),na("any",c,d.shape.length);const[p,m]=Fi(d.shape,c),g=We(m),b=Ji(We(p),d.dtype),v=t.data.get(d.dataId).values;for(let S=0;S<b.length;++S){const C=S*g;let A=v[C];for(let k=0;k<g;++k){const O=v[C+k];A=A||O}b[S]=A}u!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(p,d.dtype,b);if(o){const S=zr(p,l),C=qs({inputs:{x},backend:t,attrs:{shape:S}});return t.disposeIntermediateTensorInfo(x),C}return x}const Rxe={kernelName:ok,backendName:"cpu",kernelFunc:$xe};function Lxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a}=s;Rt(r,"argMax");let o=Fn(a,r.shape);const l=yr(o,r.shape.length);let c=r;const u=[];l!=null&&(c=po({inputs:{x:r},backend:t,attrs:{perm:l}}),u.push(c),o=Br(o.length,c.shape.length)),o=[o[0]],na("argMax",o,c.shape.length);const[d,p]=Fi(c.shape,o),m=We(d),g=Ji(m,"int32"),b=We(p),v=t.data.get(c.dataId).values;for(let x=0;x<g.length;++x){const S=x*b;let C=v[S],A=0;for(let k=0;k<b;++k){const O=v[S+k];O>C&&(C=O,A=k)}g[x]=A}return u.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",g)}const Fxe={kernelName:_w,backendName:"cpu",kernelFunc:Lxe};function Mxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a}=s;Rt(r,"argMin");let o=Fn(a,r.shape);const l=yr(o,r.shape.length);let c=r;const u=[];l!=null&&(c=po({inputs:{x:r},backend:t,attrs:{perm:l}}),u.push(c),o=Br(o.length,c.shape.length)),o=[o[0]],na("argMin",o,c.shape.length);const[d,p]=Fi(c.shape,o),m=We(d),g=Ji(m,"int32"),b=We(p),v=t.data.get(c.dataId).values;for(let x=0;x<g.length;++x){const S=x*b;let C=v[S],A=0;for(let k=0;k<b;++k){const O=v[S+k];O<C&&(C=O,A=k)}g[x]=A}return u.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",g)}const Pxe={kernelName:kw,backendName:"cpu",kernelFunc:Mxe};const zxe=xs(w1,n=>Math.asin(n)),Bxe={kernelName:w1,backendName:"cpu",kernelFunc:zxe};const jxe=xs(x1,n=>Math.asinh(n)),Uxe={kernelName:x1,backendName:"cpu",kernelFunc:jxe};const Vxe=xs(S1,n=>Math.atan(n)),Wxe={kernelName:S1,backendName:"cpu",kernelFunc:Vxe};const Hxe=Ur((n,e)=>Math.atan2(n,e)),Gxe=vi(_1,Hxe),qxe={kernelName:_1,backendName:"cpu",kernelFunc:Gxe};const Xxe=xs(C1,n=>Math.atanh(n)),Yxe={kernelName:C1,backendName:"cpu",kernelFunc:Xxe};function HL(n,e,t,s,r,a){const o=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,g=r.padInfo.left,b=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Dn(r.outShape,t),x=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3],C=r.outShape[2]*r.outShape[3],A=r.outShape[3];for(let k=0;k<r.batchSize;++k){const O=k*S,F=k*s[0];for(let $=0;$<r.inChannels;++$)for(let M=0;M<r.outHeight;++M){const R=M*o-m,z=Math.max(0,R),I=Math.min(r.inHeight,d+R),j=O+M*C;for(let H=0;H<r.outWidth;++H){const q=H*l-g,re=Math.max(0,q),X=Math.min(r.inWidth,p+q);let ne=b,Q=0,he=0;for(let Y=z;Y<I;Y+=c){const B=F+Y*s[1];for(let G=re;G<X;G+=u){const J=B+G*s[2],oe=n[J+$];a==="max"&&oe>ne?ne=oe:a==="avg"&&(Q+=oe,he++)}if(isNaN(ne))break}const ye=j+H*A+$;x[ye]=a==="avg"?Q/he:ne}}}return v}function cG(n,e,t,s,r=!1,a=!1){const o=Dn(s.outShape,"int32"),l=s.strideHeight,c=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,p=s.effectiveFilterHeight,m=s.effectiveFilterWidth,g=s.padInfo.top,b=s.padInfo.left,v=Dn(e,t,n);for(let x=0;x<s.batchSize;++x)for(let S=0;S<s.inChannels;++S)for(let C=0;C<s.outHeight;++C){const A=C*l-g;let k=A;for(;k<0;)k+=u;const O=Math.min(s.inHeight,p+A);for(let F=0;F<s.outWidth;++F){const $=F*c-b;let M=$;for(;M<0;)M+=d;const R=Math.min(s.inWidth,m+$);let z=Number.NEGATIVE_INFINITY,I=-1;for(let j=k;j<O;j+=u){const H=j-A;for(let q=M;q<R;q+=d){const re=q-$,X=v.get(x,j,q,S);X>z&&(z=X,r?I=a?((x*s.inHeight+j)*s.inWidth+q)*s.inChannels+S:(j*s.inWidth+q)*s.inChannels+S:I=H*m+re)}}o.set(I,x,C,F,S)}}return o}function uG(n,e,t,s,r,a){const o=r.strideDepth,l=r.strideHeight,c=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,p=r.dilationWidth,m=r.effectiveFilterDepth,g=r.effectiveFilterHeight,b=r.effectiveFilterWidth,v=r.padInfo.front,x=r.padInfo.top,S=r.padInfo.left,C=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,A=Dn(r.outShape,t),k=A.values,O=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],F=r.outShape[2]*r.outShape[3]*r.outShape[4],$=r.outShape[3]*r.outShape[4],M=r.outShape[4];for(let R=0;R<r.batchSize;++R){const z=R*O,I=R*s[0];for(let j=0;j<r.inChannels;++j)for(let H=0;H<r.outDepth;++H){const q=H*o-v;let re=q;for(;re<0;)re+=u;const X=Math.min(r.inDepth,m+q),ne=z+H*F;for(let Q=0;Q<r.outHeight;++Q){const he=Q*l-x;let ye=he;for(;ye<0;)ye+=d;const Y=Math.min(r.inHeight,g+he),B=ne+Q*$;for(let G=0;G<r.outWidth;++G){const J=G*c-S;let oe=J;for(;oe<0;)oe+=p;const de=Math.min(r.inWidth,b+J),ge=B+G*M;let Ae=C,Ce=0,Fe=0;for(let ot=re;ot<X;ot+=u){const ut=I+ot*s[1];for(let pt=ye;pt<Y;pt+=d){const ce=ut+pt*s[2];for(let rt=oe;rt<de;rt+=p){const At=ce+rt*s[3],yt=n[At+j];if(a==="max"&&yt>Ae?Ae=yt:a==="avg"&&(Ce+=yt,Fe++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}const Ge=ge+j;k[Ge]=a==="avg"?Ce/Math.max(Fe,1):Ae}}}}return A}function Kxe(n,e){const t=Dn(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,b=e.padInfo.left;for(let v=0;v<e.batchSize;++v)for(let x=0;x<e.inChannels;++x)for(let S=0;S<e.outDepth;++S){const C=S*s-m;let A=C;for(;A<0;)A+=o;const k=Math.min(e.inDepth,u+C);for(let O=0;O<e.outHeight;++O){const F=O*r-g;let $=F;for(;$<0;)$+=l;const M=Math.min(e.inHeight,d+F);for(let R=0;R<e.outWidth;++R){const z=R*a-b;let I=z;for(;I<0;)I+=c;const j=Math.min(e.inWidth,p+z);let H=Number.NEGATIVE_INFINITY,q=-1;for(let re=A;re<k;re+=o){const X=re-C;for(let ne=$;ne<M;ne+=l){const Q=ne-F;for(let he=I;he<j;he+=c){const ye=he-z,Y=n.get(v,re,ne,he,x);Y>=H&&(H=Y,q=X*d*p+Q*d+ye)}}}t.set(q,v,S,O,R,x)}}}return t}function Zxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Rt(r,"avgPool");const{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=s,u=1;ee(ta(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=yc(r.shape,a,o,u,l,c);let p;if(d.filterWidth===1&&d.filterHeight===1&&jn(d.inShape,d.outShape))p=Sh({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=Ht(r.shape),b=HL(m,r.shape,r.dtype,g,d,"avg");p=t.makeTensorInfo(d.outShape,r.dtype,b.values)}return p}const Jxe={kernelName:Tw,backendName:"cpu",kernelFunc:Zxe};function Qxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:c,dataFormat:u}=s;Rt(r,"avgPool3d");const d=Dd(r.shape,a,o,1,l,c,u),p=t.data.get(r.dataId).values,m=uG(p,r.shape,r.dtype,Ht(r.shape),d,"avg");return t.makeTensorInfo(m.shape,"float32",m.values)}const eSe={kernelName:Nw,backendName:"cpu",kernelFunc:Qxe};function tSe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=s;Rt([r,a],"avgPool3DGrad");const d=Dd(a.shape,o,l,1,c,u),p=d.strideDepth,m=d.strideHeight,g=d.strideWidth,b=d.filterDepth,v=d.filterHeight,x=d.filterWidth,S=d.dilationDepth,C=d.dilationHeight,A=d.dilationWidth,k=d.effectiveFilterDepth,O=d.effectiveFilterHeight,F=d.effectiveFilterWidth,$=k-1-d.padInfo.front,M=F-1-d.padInfo.left,R=O-1-d.padInfo.top,z=Dn(a.shape,"float32"),I=1/(b*v*x),j=t.bufferSync(r);for(let H=0;H<d.batchSize;++H)for(let q=0;q<d.inChannels;++q)for(let re=0;re<d.inDepth;++re)for(let X=0;X<d.inHeight;++X)for(let ne=0;ne<d.inWidth;++ne){const Q=re-$,he=X-R,ye=ne-M;let Y=0;for(let B=0;B<k;B+=S){const G=(Q+B)/p;if(!(G<0||G>=d.outDepth||Math.floor(G)!==G))for(let J=0;J<O;J+=C){const oe=(he+J)/m;if(!(oe<0||oe>=d.outHeight||Math.floor(oe)!==oe))for(let de=0;de<F;de+=A){const ge=(ye+de)/g;if(ge<0||ge>=d.outWidth||Math.floor(ge)!==ge)continue;const Ae=j.get(H,G,oe,ge,q);Y+=Ae}}}z.set(Y*I,H,re,X,ne,q)}return t.makeTensorInfo(z.shape,z.dtype,z.values)}const nSe={kernelName:ck,backendName:"cpu",kernelFunc:tSe};function sSe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a}=e,o=a;Rt([r,a],"avgPoolGrad");const{filterSize:l,strides:c,pad:u}=s,d=yc(o.shape,l,c,1,u),p=d.strideHeight,m=d.strideWidth,g=d.filterHeight,b=d.filterWidth,v=d.dilationHeight,x=d.dilationWidth,S=d.effectiveFilterHeight,C=d.effectiveFilterWidth,A=C-1-d.padInfo.left,k=S-1-d.padInfo.top,O=Dn(o.shape,"float32"),F=1/(g*b),$=t.data.get(r.dataId).values,M=Dn(r.shape,"float32",$);for(let R=0;R<d.batchSize;++R)for(let z=0;z<d.inChannels;++z)for(let I=0;I<d.inHeight;++I)for(let j=0;j<d.inWidth;++j){const H=I-k,q=j-A;let re=0;for(let X=0;X<S;X+=v){const ne=(H+X)/p;if(!(ne<0||ne>=d.outHeight||Math.floor(ne)!==ne))for(let Q=0;Q<C;Q+=x){const he=(q+Q)/m;if(he<0||he>=d.outWidth||Math.floor(he)!==he)continue;const ye=M.get(R,ne,he,z);re+=ye}}O.set(re*F,R,I,j,z)}return t.makeTensorInfo(O.shape,O.dtype,O.values)}const rSe={kernelName:lk,backendName:"cpu",kernelFunc:sSe};function iSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:a,offset:o,mean:l,variance:c}=e;ee(l.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ee(o==null||l.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ee(a==null||l.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Rt([r,l,c,a,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,p=t.data.get(l.dataId).values,m=t.data.get(c.dataId).values,g=a?t.data.get(a.dataId).values:new Float32Array([1]),b=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(d.length),x=b.length,S=g.length,C=m.length,A=p.length;let k=0,O=0,F=0,$=0;for(let M=0;M<d.length;++M)v[M]=b[k++]+(d[M]-p[O++])*g[F++]/Math.sqrt(m[$++]+u),k>=x&&(k=0),O>=A&&(O=0),F>=S&&(F=0),$>=C&&($=0);return t.makeTensorInfo(r.shape,r.dtype,v)}const aSe={kernelName:jw,backendName:"cpu",kernelFunc:iSe};function oSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:a,crops:o}=s;Rt([r],"batchToSpaceND");const l=a.reduce((S,C)=>S*C),c=H2(r.shape,a,l),u=G2(c.length,a.length),d=q2(r.shape,a,l),p=B$(o,a.length),m=j$(d,o,a.length),g=qs({inputs:{x:r},backend:t,attrs:{shape:c}}),b=po({inputs:{x:g},backend:t,attrs:{perm:u}}),v=qs({inputs:{x:b},backend:t,attrs:{shape:d}}),x=jm({inputs:{x:v},backend:t,attrs:{begin:p,size:m}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v),x}const lSe={kernelName:Ew,backendName:"cpu",kernelFunc:oSe};function cSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:a}=e,{size:o}=s,l=t.data.get(r.dataId).values,c=t.data.get(a.dataId).values,u=BL(l,c,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,u)}const uSe={kernelName:uk,backendName:"cpu",kernelFunc:cSe};function hSe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,a=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,l=Sn(Array.from(a),Array.from(o));return t.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const dSe={kernelName:hk,backendName:"cpu",kernelFunc:hSe};const fSe=xs(N1,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),pSe={kernelName:N1,backendName:"cpu",kernelFunc:fSe};const mSe=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(We(e.shape)),r=t.data.get(e.dataId),a=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,l=t.data.get(a.dataId).values,c=t.data.get(o.dataId).values;for(let u=0;u<l.length;u++){const d=l[u],p=c[u];s[u]=Math.hypot(d,p)}return t.makeOutput(s,e.shape,"float32")},gSe={kernelName:Ow,backendName:"cpu",kernelFunc:mSe};function e1(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,a=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,a)}const ySe={kernelName:Ok,backendName:"cpu",kernelFunc:e1};function t1(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,a=Fn(r,e[0].shape)[0],o=e.map(v=>v.shape);M$(o,a);let l=hh(e.map(v=>v.shape),a);if(We(l)===0)return t.makeTensorInfo(l,e[0].dtype,[]);const c=e.filter(v=>We(v.shape)>0);if(c.length===1)return Sh({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){const v=c.map(k=>Bm({inputs:{input:k},backend:t})),x=c.map(k=>e1({inputs:{input:k},backend:t})),S=t1({inputs:v,backend:t,attrs:{axis:a}}),C=t1({inputs:x,backend:t,attrs:{axis:a}}),A=Bo({inputs:{real:S,imag:C},backend:t});return v.forEach(k=>t.disposeIntermediateTensorInfo(k)),x.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(C),A}const u=c.map(v=>{const S=[-1,We(v.shape.slice(a))];return qs({inputs:{x:v},backend:t,attrs:{shape:S}})}),d=u.map(v=>({vals:t.data.get(v.dataId).values,shape:v.shape}));l=hh(u.map(v=>v.shape),1);const p=u[0].shape[0]===1,m=fH(d,l,e[0].dtype,p),g=hh(c.map(v=>v.shape),a),b=t.makeTensorInfo(g,e[0].dtype,m);return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),b}const bSe={kernelName:Dw,backendName:"cpu",kernelFunc:t1};function hG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dataFormat:c,dilations:u,dimRoundingMode:d}=s;Rt([r,a],"conv2d");const p=$d(c),m=Li(r.shape,a.shape,o,u,l,d,!1,p),g=m.filterHeight,b=m.filterWidth,v=m.dilationHeight,x=m.dilationWidth,S=m.padInfo.left,C=m.padInfo.top,A=m.dataFormat==="channelsLast",k=new ni(m.outShape,r.dtype),O=Ht(r.shape),F=Ht(a.shape),$=O[0],M=A?O[1]:O[2],R=A?O[2]:1,z=A?1:O[1],I=k.strides[0],j=A?k.strides[1]:k.strides[2],H=A?k.strides[2]:1,q=A?1:k.strides[1],re=t.data.get(r.dataId).values,X=t.data.get(a.dataId).values,ne=k.values;for(let Q=0;Q<m.batchSize;++Q){const he=Q*$,ye=Q*I;for(let Y=0;Y<m.outHeight;++Y){const B=ye+Y*j,G=Y*m.strideHeight-C;for(let J=0;J<g;++J){const oe=G+J*v;if(oe<0||oe>=m.inHeight)continue;const de=J*F[0],ge=he+oe*M;for(let Ae=0;Ae<m.outWidth;++Ae){const Ce=B+Ae*H,Fe=Ae*m.strideWidth-S;for(let Ge=0;Ge<b;++Ge){const ot=Fe+Ge*x;if(ot<0||ot>=m.inWidth)continue;const ut=de+Ge*F[1],pt=ge+ot*R;let ce=ut;for(let rt=0;rt<m.inChannels;++rt){const At=re[pt+rt*z];for(let yt=0;yt<m.outChannels;++yt)ne[Ce+yt*q]+=At*X[ce+yt];ce+=m.outChannels}}}}}}return t.makeTensorInfo(k.shape,k.dtype,ne)}const vSe={kernelName:$w,backendName:"cpu",kernelFunc:hG};function wSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:a}=e,{strides:o,pad:l,dataFormat:c,dimRoundingMode:u,filterShape:d}=s;Rt([r,a],"conv2dBackpropFilter");const p=$d(c),m=Li(r.shape,d,o,1,l,u,!1,p),{strideHeight:g,strideWidth:b,filterHeight:v,filterWidth:x}=m,S=m.dataFormat==="channelsLast",C=new ni(m.filterShape,"float32"),A=m.padInfo.left,k=m.padInfo.top,O=t.data.get(r.dataId).values,F=t.data.get(a.dataId).values,$=new ni(r.shape,r.dtype,O),M=new ni(a.shape,a.dtype,F);for(let R=0;R<v;++R){const z=Math.max(0,Math.ceil((k-R)/g)),I=Math.min(m.outHeight,(m.inHeight+k-R)/g);for(let j=0;j<x;++j){const H=Math.max(0,Math.ceil((A-j)/b)),q=Math.min(m.outWidth,(m.inWidth+A-j)/b);for(let re=0;re<m.inChannels;++re)for(let X=0;X<m.outChannels;++X){let ne=0;for(let Q=0;Q<m.batchSize;++Q)for(let he=z;he<I;++he){const ye=R+he*g-k;for(let Y=H;Y<q;++Y){const B=j+Y*b-A;S?ne+=$.get(Q,ye,B,re)*M.get(Q,he,Y,X):ne+=$.get(Q,re,ye,B)*M.get(Q,X,he,Y)}}C.set(ne,R,j,re,X)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const xSe={kernelName:fk,backendName:"cpu",kernelFunc:wSe};function SSe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:a}=e,{inputShape:o,strides:l,pad:c,dataFormat:u,dimRoundingMode:d}=s;Rt([r,a],"conv2dBackpropInput");const p=Ht(a.shape),m=Ht(r.shape);let g=$d(u);const b=Li(o,a.shape,l,1,c,d,!1,g),v=new ni(b.inShape,"float32"),x=v.values,S=t.data.get(r.dataId).values,C=t.data.get(a.dataId).values,[A,k,O]=p,{batchSize:F,filterHeight:$,filterWidth:M,inChannels:R,inHeight:z,inWidth:I,outChannels:j,outHeight:H,outWidth:q,strideHeight:re,strideWidth:X}=b;g=b.dataFormat;const ne=$-1-b.padInfo.top,Q=M-1-b.padInfo.left,he=g==="channelsLast",ye=v.strides[0],Y=he?v.strides[1]:v.strides[2],B=he?v.strides[2]:1,G=he?1:v.strides[1],J=m[0],oe=he?m[1]:m[2],de=he?m[2]:1,ge=he?1:m[1];for(let Ae=0;Ae<F;++Ae)for(let Ce=0;Ce<R;++Ce)for(let Fe=0;Fe<z;++Fe){const Ge=Fe-ne,ot=Math.max(0,Math.ceil(Ge/re)),ut=Math.min(H,($+Ge)/re);for(let pt=0;pt<I;++pt){const ce=pt-Q,rt=Math.max(0,Math.ceil(ce/X)),At=Math.min(q,(M+ce)/X);let yt=0;for(let xt=ot;xt<ut;++xt){const vt=xt*re-Ge;for(let Tt=rt;Tt<At;++Tt){const Lt=Tt*X-ce,Yt=J*Ae+oe*xt+de*Tt,mn=A*($-1-vt)+k*(M-1-Lt)+O*Ce;for(let Jt=0;Jt<j;++Jt){const bn=S[Yt+ge*Jt],cn=C[mn+Jt];yt+=bn*cn}}}const nt=ye*Ae+Y*Fe+B*pt+G*Ce;x[nt]=yt}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const CSe={kernelName:Rw,backendName:"cpu",kernelFunc:SSe};function _Se(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dilations:c}=s;Rt([r,a],"conv3d");const u=rp(r.shape,a.shape,o,c,l),{filterDepth:d,filterHeight:p,filterWidth:m,dilationDepth:g,dilationHeight:b,dilationWidth:v,padInfo:x}=u,S=x.front,C=x.left,A=x.top,k=new ni(u.outShape,r.dtype),O=t.data.get(r.dataId).values,F=t.data.get(a.dataId).values,$=k.values,M=Ht(r.shape),R=Ht(a.shape);for(let z=0;z<u.batchSize;++z){const I=z*M[0],j=z*k.strides[0];for(let H=0;H<u.outDepth;++H){const q=j+H*k.strides[1],re=H*u.strideDepth-S;for(let X=0;X<d;++X){const ne=re+X*g;if(ne<0||ne>=u.inDepth)continue;const Q=X*R[0],he=I+ne*M[1];for(let ye=0;ye<u.outHeight;++ye){const Y=q+ye*k.strides[2],B=ye*u.strideHeight-A;for(let G=0;G<p;++G){const J=B+G*b;if(J<0||J>=u.inHeight)continue;const oe=Q+G*R[1],de=he+J*M[2];for(let ge=0;ge<u.outWidth;++ge){const Ae=Y+ge*u.outChannels,Ce=ge*u.strideWidth-C;for(let Fe=0;Fe<m;++Fe){const Ge=Ce+Fe*v;if(Ge<0||Ge>=u.inWidth)continue;const ot=oe+Fe*R[2],ut=de+Ge*u.inChannels;let pt=ot;for(let ce=0;ce<u.inChannels;++ce){const rt=O[ut+ce];for(let At=0;At<u.outChannels;++At)$[Ae+At]+=rt*F[pt+At];pt+=u.outChannels}}}}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const kSe={kernelName:Lw,backendName:"cpu",kernelFunc:_Se};function TSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:a}=e,{strides:o,pad:l,filterShape:c}=s;Rt([r,a],"conv3dBackpropFilterV2");const u=Ht(r.shape),d=Ht(a.shape),p=rp(r.shape,c,o,1,l),m=p.strideDepth,g=p.strideHeight,b=p.strideWidth,v=p.filterDepth,x=p.filterHeight,S=p.filterWidth,C=new ni(p.filterShape,"float32"),A=C.values,[k,O,F,$]=C.strides,M=t.data.get(a.dataId).values,[R,z,I,j]=d,H=t.data.get(r.dataId).values,[q,re,X,ne]=u,Q=p.padInfo.front,he=p.padInfo.left,ye=p.padInfo.top;for(let Y=0;Y<v;++Y){const B=Math.max(0,Math.ceil((Q-Y)/m)),G=Math.min(p.outDepth,(p.inDepth+Q-Y)/m),J=Y*k;for(let oe=0;oe<x;++oe){const de=Math.max(0,Math.ceil((ye-oe)/g)),ge=Math.min(p.outHeight,(p.inHeight+ye-oe)/g),Ae=oe*O+J;for(let Ce=0;Ce<S;++Ce){const Fe=Math.max(0,Math.ceil((he-Ce)/b)),Ge=Math.min(p.outWidth,(p.inWidth+he-Ce)/b),ot=Ce*F+Ae;for(let ut=0;ut<p.inChannels;++ut){const pt=ut*$+ot;for(let ce=0;ce<p.outChannels;++ce){let rt=0;for(let At=0;At<p.batchSize;++At){const yt=At*q,nt=At*R;for(let xt=B;xt<G;++xt){const Tt=(Y+xt*m-Q)*re+yt,Lt=xt*z+nt;for(let Yt=de;Yt<ge;++Yt){const Jt=(oe+Yt*g-ye)*X+Tt,bn=Yt*I+Lt;for(let cn=Fe;cn<Ge;++cn){const fn=(Ce+cn*b-he)*ne+Jt,zt=cn*j+bn;rt+=H[fn+ut]*M[zt+ce]}}}}A[pt+ce]=rt}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const NSe={kernelName:pk,backendName:"cpu",kernelFunc:TSe};function ASe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:a}=e,{pad:o,strides:l,inputShape:c}=s;Rt([r],"conv3dBackpropInputV2");const u=Ht(r.shape),d=Ht(a.shape),p=rp(c,a.shape,l,1,o),m=new ni(p.inShape,"float32"),g=m.values,[b,v,x,S]=m.strides,C=t.data.get(r.dataId).values,[A,k,O,F]=u,$=t.data.get(a.dataId).values,[M,R,z,I]=d,{batchSize:j,filterDepth:H,filterHeight:q,filterWidth:re,inChannels:X,inDepth:ne,inHeight:Q,inWidth:he,outChannels:ye,outDepth:Y,outHeight:B,outWidth:G,strideDepth:J,strideHeight:oe,strideWidth:de}=p,ge=H-1-p.padInfo.front,Ae=q-1-p.padInfo.top,Ce=re-1-p.padInfo.left;for(let Fe=0;Fe<j;++Fe)for(let Ge=0;Ge<X;++Ge)for(let ot=0;ot<ne;++ot){const ut=ot-ge,pt=Math.max(0,Math.ceil(ut/J)),ce=Math.min(Y,(H+ut)/J);for(let rt=0;rt<Q;++rt){const At=rt-Ae,yt=Math.max(0,Math.ceil(At/oe)),nt=Math.min(B,(q+At)/oe);for(let xt=0;xt<he;++xt){const vt=xt-Ce,Tt=Math.max(0,Math.ceil(vt/de)),Lt=Math.min(G,(re+vt)/de);let Yt=0;for(let mn=pt;mn<ce;++mn){const Jt=mn*J-ut;for(let bn=yt;bn<nt;++bn){const cn=bn*oe-At;for(let Et=Tt;Et<Lt;++Et){const fn=Et*de-vt,zt=A*Fe+k*mn+O*bn+F*Et,Ks=M*(H-1-Jt)+R*(q-1-cn)+z*(re-1-fn)+I*Ge;for(let Cn=0;Cn<ye;++Cn){const Qt=C[zt+Cn],un=$[Ks+Cn];Yt+=Qt*un}}}}g[b*Fe+v*ot+x*rt+S*xt+Ge]=Yt}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const ESe={kernelName:mk,backendName:"cpu",kernelFunc:ASe};const ISe=xs(A1,n=>Math.cos(n)),OSe={kernelName:A1,backendName:"cpu",kernelFunc:ISe};const DSe=xs(E1,n=>Math.cosh(n)),$Se={kernelName:E1,backendName:"cpu",kernelFunc:DSe};function RSe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:a,boxInd:o}=e,{cropSize:l,method:c,extrapolationValue:u}=s,[d,p,m,g]=r.shape,b=a.shape[0],[v,x]=l,S=Dn([b,v,x,g],"float32"),C=t.data.get(a.dataId).values,A=t.data.get(o.dataId).values,k=t.data.get(r.dataId).values,O=Ht(r.shape),F=Ht(S.shape);for(let $=0;$<b;$++){const M=$*4,R=C[M],z=C[M+1],I=C[M+2],j=C[M+3],H=A[$];if(H>=d)continue;const q=v>1?(I-R)*(p-1)/(v-1):0,re=x>1?(j-z)*(m-1)/(x-1):0;for(let X=0;X<v;X++){const ne=v>1?R*(p-1)+X*q:.5*(R+I)*(p-1);if(ne<0||ne>p-1){for(let Q=0;Q<x;Q++)for(let he=0;he<g;he++){const ye=he+Q*F[2]+X*F[1]+$*F[0];S.values[ye]=u}continue}if(c==="bilinear"){const Q=Math.floor(ne),he=Math.ceil(ne),ye=ne-Q;for(let Y=0;Y<x;Y++){const B=x>1?z*(m-1)+Y*re:.5*(z+j)*(m-1);if(B<0||B>m-1){for(let de=0;de<g;de++){const ge=de+Y*F[2]+X*F[1]+$*F[0];S.values[ge]=u}continue}const G=Math.floor(B),J=Math.ceil(B),oe=B-G;for(let de=0;de<g;de++){let ge=de+G*O[2]+Q*O[1]+H*O[0];const Ae=k[ge];ge=de+J*O[2]+Q*O[1]+H*O[0];const Ce=k[ge];ge=de+G*O[2]+he*O[1]+H*O[0];const Fe=k[ge];ge=de+J*O[2]+he*O[1]+H*O[0];const Ge=k[ge],ot=Ae+(Ce-Ae)*oe,ut=Fe+(Ge-Fe)*oe;ge=de+Y*F[2]+X*F[1]+$*F[0],S.values[ge]=ot+(ut-ot)*ye}}}else for(let Q=0;Q<x;++Q){const he=x>1?z*(m-1)+Q*re:.5*(z+j)*(m-1);if(he<0||he>m-1){for(let B=0;B<g;B++){const G=B+Q*F[2]+X*F[1]+$*F[0];S.values[G]=u}continue}const ye=Math.round(he),Y=Math.round(ne);for(let B=0;B<g;B++){const G=B+ye*O[2]+Y*O[1]+H*O[0],J=B+Q*F[2]+X*F[1]+$*F[0];S.values[J]=k[G]}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const LSe={kernelName:yk,backendName:"cpu",kernelFunc:RSe};function FSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,exclusive:o,reverse:l}=s;Rt(r,"cumprod");const c=yr([a],r.shape.length);let u=r;c!=null&&(u=po({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Br(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const p=lo(u.dtype,"int32"),m=ik(We(u.shape),p),g=t.data.get(u.dataId).values,b=u.shape[u.shape.length-1],v=l?(S,C)=>S+b-C-1:(S,C)=>S+C;for(let S=0;S<g.length;S+=b)for(let C=0;C<b;C++){const A=v(S,C);if(C===0)m[A]=o?1:g[A];else{const k=v(S,C-1);m[A]=o?g[k]*m[k]:g[A]*m[k]}}const x=t.makeTensorInfo(u.shape,p,m);if(c!=null){const S=ip(c),C=po({inputs:{x},backend:t,attrs:{perm:S}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(u),C}return x}const MSe={kernelName:gk,backendName:"cpu",kernelFunc:FSe};function PSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,exclusive:o,reverse:l}=s;Rt(r,"cumsum");const c=yr([a],r.shape.length);let u=r;c!=null&&(u=po({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Br(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const p=lo(u.dtype,"int32"),m=Ji(We(u.shape),p),g=t.data.get(u.dataId).values,b=u.shape[u.shape.length-1],v=l?(S,C)=>S+b-C-1:(S,C)=>S+C;for(let S=0;S<g.length;S+=b)for(let C=0;C<b;C++){const A=v(S,C);if(C===0)m[A]=o?0:g[A];else{const k=v(S,C-1);m[A]=o?g[k]+m[k]:g[A]+m[k]}}const x=t.makeTensorInfo(u.shape,p,m);if(c!=null){const S=ip(c),C=po({inputs:{x},backend:t,attrs:{perm:S}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(u),C}return x}const zSe={kernelName:Fw,backendName:"cpu",kernelFunc:PSe};function BSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:a}=e,{size:o,binaryOutput:l}=s;if(r.shape.length===1){const c=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,d=BL(c,u,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),u=t.bufferSync(a),d=uH(c,u,o,l);return t.makeTensorInfo(d.shape,a.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const jSe={kernelName:bk,backendName:"cpu",kernelFunc:BSe};function USe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:a,dataFormat:o}=s;ee(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const l=r.shape[0],c=r.shape[1],u=r.shape[2],d=r.shape[3],p=c*a,m=u*a,g=d/(a*a),b=t.data.get(r.dataId).values,v=new Float32Array(l*p*m*g);let x=0;for(let S=0;S<l;++S)for(let C=0;C<p;++C){const A=Math.floor(C/a),k=C%a;for(let O=0;O<m;++O){const F=Math.floor(O/a),$=O%a,M=(k*a+$)*g;for(let R=0;R<g;++R){const I=R+M+d*(F+u*(A+c*S));v[x++]=b[I]}}}return t.makeTensorInfo([l,p,m,g],r.dtype,v)}const VSe={kernelName:vk,backendName:"cpu",kernelFunc:USe};function dG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dilations:c,dimRoundingMode:u}=s;Rt([r,a],"depthwiseConv2DNative");const d=Ht(r.shape),p=Ht(a.shape);let m=c;m==null&&(m=[1,1]),ee(ta(o,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${m}'`);const g=Li(r.shape,a.shape,o,m,l,u,!0),{filterHeight:b,filterWidth:v,dilationHeight:x,dilationWidth:S,padInfo:C}=g,A=C.left,k=C.top,O=g.outChannels/g.inChannels,F=new ni(g.outShape,r.dtype),$=t.data.get(r.dataId).values,M=t.data.get(a.dataId).values,R=F.values;for(let z=0;z<g.batchSize;++z){const I=z*d[0],j=z*F.strides[0];for(let H=0;H<g.outHeight;++H){const q=j+H*F.strides[1],re=H*g.strideHeight-k;for(let X=0;X<b;++X){const ne=re+X*x;if(ne<0||ne>=g.inHeight)continue;const Q=X*p[0],he=I+ne*d[1];for(let ye=0;ye<g.outWidth;++ye){const Y=q+ye*F.strides[2],B=ye*g.strideWidth-A;for(let G=0;G<v;++G){const J=B+G*S;if(J<0||J>=g.inWidth)continue;const oe=Q+G*p[1],de=he+J*g.inChannels;let ge=Y,Ae=oe;for(let Ce=0;Ce<g.inChannels;++Ce){const Fe=$[de+Ce];for(let Ge=0;Ge<O;++Ge)R[ge+Ge]+=Fe*M[Ae+Ge];ge+=O,Ae+=O}}}}}}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const WSe={kernelName:Mw,backendName:"cpu",kernelFunc:dG};function HSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:a}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:u,filterShape:d}=s;Rt([r,a],"depthwiseConv2dNativeBackpropFilter");const p=Li(r.shape,d,o,l,c,u,!0),{strideHeight:m,strideWidth:g,filterHeight:b,filterWidth:v}=p,x=new ni(p.filterShape,"float32"),S=p.padInfo.left,C=p.padInfo.top,A=p.outChannels/p.inChannels,k=t.data.get(r.dataId).values,O=new ni(r.shape,r.dtype,k),F=t.data.get(a.dataId).values,$=new ni(a.shape,a.dtype,F);for(let M=0;M<b;++M){const R=Math.max(0,Math.ceil((C-M)/m)),z=Math.min(p.outHeight,(p.inHeight+C-M)/m);for(let I=0;I<v;++I){const j=Math.max(0,Math.ceil((S-I)/g)),H=Math.min(p.outWidth,(p.inWidth+S-I)/g);for(let q=0;q<p.outChannels;++q){const re=Math.trunc(q/A),X=q%A;let ne=0;for(let Q=0;Q<p.batchSize;++Q)for(let he=R;he<z;++he){const ye=M+he*m-C;for(let Y=j;Y<H;++Y){const B=I+Y*g-S;ne+=O.get(Q,ye,B,re)*$.get(Q,he,Y,q)}}x.set(ne,M,I,re,X)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const GSe={kernelName:wk,backendName:"cpu",kernelFunc:HSe};function qSe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:a}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:u,inputShape:d}=s;Rt([r,a],"depthwiseConv2DNativeBackpropInput");const p=Ht(r.shape),m=Ht(a.shape),g=Li(d,a.shape,o,l,c,u,!0),b=new ni(g.inShape,"float32"),v=b.values,[x,S,C]=b.strides,A=t.data.get(r.dataId).values,[k,O,F]=p,$=t.data.get(a.dataId).values,[M,R,z]=m,{batchSize:I,filterHeight:j,filterWidth:H,inChannels:q,inHeight:re,inWidth:X,outChannels:ne,outHeight:Q,outWidth:he,strideHeight:ye,strideWidth:Y}=g,B=j-1-g.padInfo.top,G=H-1-g.padInfo.left,J=ne/q;for(let oe=0;oe<I;++oe)for(let de=0;de<q;++de)for(let ge=0;ge<re;++ge){const Ae=ge-B,Ce=Math.max(0,Math.ceil(Ae/ye)),Fe=Math.min(Q,(j+Ae)/ye);for(let Ge=0;Ge<X;++Ge){const ot=Ge-G,ut=Math.max(0,Math.ceil(ot/Y)),pt=Math.min(he,(H+ot)/Y);let ce=0;for(let rt=Ce;rt<Fe;++rt){const At=rt*ye-Ae;for(let yt=ut;yt<pt;++yt){const nt=yt*Y-ot,xt=k*oe+O*rt+F*yt,vt=M*(j-1-At)+R*(H-1-nt)+z*de;for(let Tt=0;Tt<J;++Tt){const Lt=de*J+Tt,Yt=A[xt+Lt],mn=$[vt+Tt];ce+=Yt*mn}}}v[x*oe+S*ge+C*Ge+de]=ce}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const XSe={kernelName:xk,backendName:"cpu",kernelFunc:qSe};function YSe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=We(s.shape),a=t.data.get(s.dataId).values,o=Dn([r,r],s.dtype),l=o.values;for(let u=0;u<a.length;u++)l[u*r+u]=a[u];const c=[...s.shape,...s.shape];return t.makeTensorInfo(c,o.dtype,o.values)}const KSe={kernelName:Sk,backendName:"cpu",kernelFunc:YSe};const ZSe={kernelName:Pw,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:a,pad:o,dilations:l}=t,c=e,u=c.data.get(s.dataId).values,d=s.shape.length,p=c.data.get(r.dataId).values,m=r.shape.length,{batchSize:g,inHeight:b,inWidth:v,inChannels:x,outHeight:S,outWidth:C,padInfo:A,strideHeight:k,strideWidth:O,filterHeight:F,filterWidth:$,dilationHeight:M,dilationWidth:R,outShape:z}=N2(s.shape,r.shape,a,o,"NHWC",l),I=We(z),j=z.length,H=kr(s.dtype,I);for(let re=0;re<g;++re)for(let X=0;X<S;++X){const ne=X*k-A.top;for(let Q=0;Q<C;++Q){const he=Q*O-A.left;for(let ye=0;ye<x;++ye){let Y=Number.MIN_SAFE_INTEGER;for(let G=0;G<F;++G){const J=ne+G*M;if(J>=0&&J<b)for(let oe=0;oe<$;++oe){const de=he+oe*R;if(de>=0&&de<v){const ge=ou([re,J,de,ye],d,Ht(s.shape)),Ae=ou([G,oe,ye],m,Ht(r.shape)),Ce=u[ge]+p[Ae];Ce>Y&&(Y=Ce)}}}const B=ou([re,X,Q,ye],j,Ht(z));H[B]=Y}}}return{dataId:c.write(np(H,s.dtype),z,s.dtype),shape:z,dtype:s.dtype}}};const JSe={kernelName:QC,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:a}=n,{strides:o,pad:l,dilations:c}=t,u=e,d=El(s.shape,u.data.get(s.dataId).values),p=El(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:b,inChannels:v,outHeight:x,outWidth:S,padInfo:C,strideHeight:A,strideWidth:k,filterHeight:O,filterWidth:F,dilationHeight:$,dilationWidth:M,outShape:R}=N2(s.shape,r.shape,o,l,"NHWC",c);ee(a.rank===R.length,()=>`Error in ${QC}, dy must have the same rank as output ${R.length}, but got ${a.rank}`);const z=El(R,u.data.get(a.dataId).values),I=sD(r.shape,r.dtype);for(let H=0;H<m;++H)for(let q=0;q<x;++q){const re=q*A-C.top;for(let X=0;X<S;++X){const ne=X*k-C.left;for(let Q=0;Q<v;++Q){let he=Number.MIN_SAFE_INTEGER,ye=0,Y=0;for(let B=0;B<O;++B){const G=re+B*$;if(G>=0&&G<g)for(let J=0;J<F;++J){const oe=ne+J*M;if(oe>=0&&oe<b){const de=d[H][G][oe][Q]+p[B][J][Q];de>he&&(he=de,ye=B,Y=J)}}}I[ye][Y][Q]+=z[H][q][X][Q]}}}return{dataId:u.write(np(I,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};const QSe={kernelName:JC,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:a}=n,{strides:o,pad:l,dilations:c}=t,u=e,d=El(s.shape,u.data.get(s.dataId).values),p=El(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:b,inChannels:v,outHeight:x,outWidth:S,padInfo:C,strideHeight:A,strideWidth:k,filterHeight:O,filterWidth:F,dilationHeight:$,dilationWidth:M,outShape:R}=N2(s.shape,r.shape,o,l,"NHWC",c);ee(a.rank===R.length,()=>`Error in ${JC}, dy must have the same rank as output ${R.length}, but got ${a.rank}`);const z=El(R,u.data.get(a.dataId).values),I=sD(s.shape,s.dtype);for(let H=0;H<m;++H)for(let q=0;q<x;++q){const re=q*A-C.top;for(let X=0;X<S;++X){const ne=X*k-C.left;for(let Q=0;Q<v;++Q){let he=Number.MIN_SAFE_INTEGER,ye=re<0?0:re,Y=ne<0?0:ne;for(let B=0;B<O;++B){const G=re+B*$;if(G>=0&&G<g)for(let J=0;J<F;++J){const oe=ne+J*M;if(oe>=0&&oe<b){const de=d[H][G][oe][Q]+p[B][J][Q];de>he&&(he=de,ye=G,Y=oe)}}}I[H][ye][Y][Q]+=z[H][q][X][Q]}}}return{dataId:u.write(np(I,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};function eCe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:a,options:o}=s,{contextOptions:l,imageOptions:c}=o||{},u=c?.alpha||1,d=l?.contextType||"2d";if(d!=="2d")throw new Error(`Context type ${l.contextType} is not supported by the CPU backend.`);const p=a.getContext(d,l?.contextAttributes||{});if(p==null)throw new Error(`Could not get the context with ${d} type.`);const[m,g]=r.shape.slice(0,2),b=r.shape.length===2?1:r.shape[2],v=t.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,S=new Uint8ClampedArray(g*m*4);for(let A=0;A<m*g;++A){const k=[0,0,0,255*u];for(let F=0;F<b;F++){const $=v[A*b+F];if(r.dtype==="float32"){if($<0||$>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${$}.`)}else if(r.dtype==="int32"&&($<0||$>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${$}.`);b===1?(k[0]=$*x,k[1]=$*x,k[2]=$*x):k[F]=$*x}const O=A*4;S[O+0]=Math.round(k[0]),S[O+1]=Math.round(k[1]),S[O+2]=Math.round(k[2]),S[O+3]=Math.round(k[3])}a.width=g,a.height=m;const C=new ImageData(S,g,m);return p.putImageData(C,0,0),r}const tCe={kernelName:Ck,backendName:"cpu",kernelFunc:eCe};function ix(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s;Rt(r,"sum");let l;r.dtype==="bool"?l=Jf({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):l=Sh({inputs:{x:r},backend:t});const c=l.shape.length,u=Fn(a,l.shape),d=yr(u,c);let p=u,m=l;d!=null&&(m=po({inputs:{x:l},backend:t,attrs:{perm:d}}),p=Br(p.length,c)),na("sum",p,m.shape.length);const[g,b]=Fi(m.shape,p),v=lo(m.dtype,"int32");let x=b_(t,g,v);const S=We(b),C=t.data.get(x.dataId).values,A=t.data.get(m.dataId).values;for(let k=0;k<C.length;++k){const O=k*S;let F=0;for(let $=0;$<S;++$)F+=A[O+$];C[k]=F}if(o){const k=zr(x.shape,u),O=x;x=qs({inputs:{x},backend:t,attrs:{shape:k}}),t.disposeIntermediateTensorInfo(O)}return t.disposeIntermediateTensorInfo(l),d!=null&&t.disposeIntermediateTensorInfo(m),x}const nCe={kernelName:y2,backendName:"cpu",kernelFunc:ix};function sCe(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,a=e,{allDims:o,summedDims:l,idDims:c}=Y$(r,a.length);Z$(o.length,c,a);const{path:u,steps:d}=J$(l,c),p=d.length;let m=null,g=o.length;const b=[];for(let v=0;v<p;++v){for(const x of d[v]){const{permutationIndices:S,expandDims:C}=K$(g,c[x]);let A;Q$(S)?A=a[x]:(A=po({inputs:{x:a[x]},backend:t,attrs:{perm:S}}),b.push(A));const k=A.shape.slice();for(let O=0;O<C.length;++O)k.splice(C[O],0,1);jn(A.shape,k)||(A=qs({inputs:{x:A},backend:t,attrs:{shape:k}}),b.push(A)),m===null?m=A:(m=xN({inputs:{a:A,b:m},backend:t}),b.push(m))}v<p-1&&(u[v]>=0&&(m=ix({inputs:{x:m},backend:t,attrs:{axis:u[v]-(o.length-g),keepDims:!1}}),b.push(m)),g--)}for(const v of b)v!==m&&t.disposeIntermediateTensorInfo(v);return m}const rCe={kernelName:_k,backendName:"cpu",kernelFunc:sCe};function iCe(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Rt([s,r],"eluGrad");const a=new Float32Array(We(r.shape)),o=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values;for(let c=0;c<o.length;++c){const u=o[c];u>=0?a[c]=l[c]:a[c]=l[c]*(u+1)}return t.makeTensorInfo(r.shape,"float32",a)}const aCe={kernelName:kk,backendName:"cpu",kernelFunc:iCe};const oCe=U$,lCe=V$,cCe=W$,uCe=H$,hCe=G$,dCe=q$,fCe=xs(D1,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+oCe*t);return e*(1-((((dCe*s+hCe)*s+uCe)*s+cCe)*s+lCe)*s*Math.exp(-t*t))}),pCe={kernelName:D1,backendName:"cpu",kernelFunc:fCe};function x_(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:a}=s,o=r.shape.length,l=r.shape.slice();let c=a;return a<0&&(ee(-(o+1)<=a,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+a+1),l.splice(c,0,1),qs({inputs:{x:r},backend:t,attrs:{shape:l}})}const mCe={kernelName:Bw,backendName:"cpu",kernelFunc:x_};const gCe=Ur((n,e)=>n/e),GL=vi(I1,gCe),RI={kernelName:I1,backendName:"cpu",kernelFunc:GL};function fG(n,e,t){const s=n.shape,r=s[0],a=s[1],o=t.data.get(n.dataId),l=o.complexTensorInfos.real,c=o.complexTensorInfos.imag,u=[r,a],d=We(u),p=$i("float32",d),m=$i("float32",d);for(let x=0;x<r;x++){const S=jm({inputs:{x:l},backend:t,attrs:{begin:[x,0],size:[1,a]}}),C=jm({inputs:{x:c},backend:t,attrs:{begin:[x,0],size:[1,a]}}),A=Bo({inputs:{real:S,imag:C},backend:t}),{real:k,imag:O}=yCe(A,e,t),F=kd(k,O);for(let $=0;$<a;$++){const M=X$(F,$);p[x*a+$]=M.real,m[x*a+$]=M.imag}t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(A)}const g=t.makeTensorInfo(u,"float32",p),b=t.makeTensorInfo(u,"float32",m),v=Bo({inputs:{real:g,imag:b},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),v}function yCe(n,e,t){const s=We(n.shape),r=t.data.get(n.dataId),a=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(bCe(s)){const l=LI(a,o,s,e,t),c=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(c,"float32",l.real),d=t.makeTensorInfo(c,"float32",l.imag),p=t.makeTensorInfo([],"float32",Od(s,"float32")),m=Sh({inputs:{x:p},backend:t}),g=RI.kernelFunc({inputs:{a:u,b:p},backend:t}),b=RI.kernelFunc({inputs:{a:d,b:m},backend:t}),v=t.data.get(g.dataId).values,x=t.data.get(b.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),{real:v,imag:x}}return l}else{const l=kd(a,o),c=vCe(l,s,e);return Q3(c)}}function bCe(n){return(n&n-1)===0}function LI(n,e,t,s,r){if(t===1)return{real:n,imag:e};const a=kd(n,e),o=t/2,l=e9(a),c=l.real,u=l.imag,d=[c.length],p=r.makeTensorInfo(d,"float32",c),m=r.makeTensorInfo(d,"float32",u),g=Bo({inputs:{real:p,imag:m},backend:r}),b=t9(a),v=b.real,x=b.imag,S=[v.length],C=r.makeTensorInfo(S,"float32",v),A=r.makeTensorInfo(S,"float32",x),k=Bo({inputs:{real:C,imag:A},backend:r}),O=LI(c,u,o,s,r),F=O.real,$=O.imag,M=[F.length],R=r.makeTensorInfo(M,"float32",F),z=r.makeTensorInfo(M,"float32",$),I=Bo({inputs:{real:R,imag:z},backend:r}),j=LI(v,x,o,s,r),H=j.real,q=j.imag,re=[H.length],X=r.makeTensorInfo(re,"float32",H),ne=r.makeTensorInfo(re,"float32",q),Q=Bo({inputs:{real:X,imag:ne},backend:r}),he=s9(t,s),ye=[he.real.length],Y=r.makeTensorInfo(ye,"float32",he.real),B=r.makeTensorInfo(ye,"float32",he.imag),G=Bo({inputs:{real:Y,imag:B},backend:r}),J=xN({inputs:{a:G,b:Q},backend:r}),oe=Q0({inputs:{a:I,b:J},backend:r}),de=WL({inputs:{a:I,b:J},backend:r}),ge=Bm({inputs:{input:oe},backend:r}),Ae=Bm({inputs:{input:de},backend:r}),Ce=e1({inputs:{input:oe},backend:r}),Fe=e1({inputs:{input:de},backend:r}),Ge=t1({inputs:[ge,Ae],backend:r,attrs:{axis:0}}),ot=t1({inputs:[Ce,Fe],backend:r,attrs:{axis:0}}),ut=r.data.get(Ge.dataId).values,pt=r.data.get(ot.dataId).values;return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(Ce),r.disposeIntermediateTensorInfo(Ae),r.disposeIntermediateTensorInfo(Fe),r.disposeIntermediateTensorInfo(Ge),r.disposeIntermediateTensorInfo(ot),{real:ut,imag:pt}}function vCe(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let a=0,o=0;for(let l=0;l<e;l++){const c=r9(r*l,e,t),u=X$(n,l);a+=u.real*c.real-u.imag*c.imag,o+=u.real*c.imag+u.imag*c.real}t&&(a/=e,o/=e),n9(s,a,o,r)}return s}function wCe(n){const{inputs:e,backend:t}=n,{input:s}=e,r=We(s.shape),a=s.shape[s.shape.length-1],o=r/a,l=qs({inputs:{x:s},backend:t,attrs:{shape:[o,a]}}),c=fG(l,!1,t),u=qs({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),u}const xCe={kernelName:Tk,backendName:"cpu",kernelFunc:wCe};function qL(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:a}=t,o=a||ng(r),l=kr(o,We(s));return CCe(l,r,o),e.makeTensorInfo(s,o,l)}const SCe={kernelName:Nk,backendName:"cpu",kernelFunc:qL};function CCe(n,e,t){n.fill(e)}const _Ce={kernelName:Ak,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,a=$i(s.dtype,We(s.shape)),[o,l,c,u]=s.shape,d=r.data.get(s.dataId).values;for(let m=0;m<o;m++){const g=m*c*l*u;for(let b=0;b<l;b++){const v=b*(c*u);for(let x=0;x<c;x++){const S=x*u;for(let C=0;C<u;C++){const A=Math.round(c-x-1),k=g+v+S+C;let O=d[k];if(A>=0&&A<c){const F=A*u,$=g+v+F+C;O=d[$]}a[k]=O}}}}return{dataId:r.write(a,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};function kCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a,bias:o,preluActivationWeights:l}=e,{strides:c,pad:u,dataFormat:d,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=s;let v=hG({inputs:{x:r,filter:a},backend:t,attrs:{strides:c,pad:u,dataFormat:d,dilations:p,dimRoundingMode:m}});if(o){const x=v;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const S=qs({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=Q0({inputs:{a:v,b:S},backend:t}),t.disposeIntermediateTensorInfo(S)}else v=Q0({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(x)}if(g){const x=v;if(d==="NCHW"&&g==="prelu"&&l.shape.length===1&&l.shape[0]!==1){const S=qs({inputs:{x:l},backend:t,attrs:{shape:[l.shape[0],1,1]}});v=w_(t,v,g,S,b),t.disposeIntermediateTensorInfo(S)}else v=w_(t,v,g,l,b);t.disposeIntermediateTensorInfo(x)}return v}const TCe={kernelName:Iv,backendName:"cpu",kernelFunc:kCe};function NCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a,bias:o,preluActivationWeights:l}=e,{strides:c,pad:u,dataFormat:d,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=s;let v=dG({inputs:{x:r,filter:a},backend:t,attrs:{strides:c,pad:u,dataFormat:d,dilations:p,dimRoundingMode:m}});if(o){const x=v;v=Q0({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(x)}if(g){const x=v;v=w_(t,v,g,l,b),t.disposeIntermediateTensorInfo(x)}return v}const ACe={kernelName:Ov,backendName:"cpu",kernelFunc:NCe};function ECe(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,a=We(s.shape),o=r.shape,l=o[o.length-1],[c,u,d,p]=YT(s,r);if(u===0)return t.makeTensorInfo(c,s.dtype,[]);const m=t.data.get(r.dataId).values,g=t.bufferSync(s),b=xH(m,g,s.dtype,u,l,d,p,s.shape,a);return t.makeTensorInfo(c,s.dtype,b.values)}const ICe={kernelName:Ek,backendName:"cpu",kernelFunc:ECe};function OCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:a}=e,{axis:o,batchDims:l}=s;Rt([r,a],"gatherV2");const c=Fn(o,r.shape)[0],u=t.data.get(a.dataId).values,d=r.shape[c];for(let k=0;k<u.length;++k){const O=u[k];ee(O<=d-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${d-1}]`)}let p=l;l==null&&(p=0);const m=We(a.shape),g=tR(r,a,c,p),b=qs({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),v=qs({inputs:{x:a},backend:t,attrs:{shape:[g.batchSize,m/g.batchSize]}}),x=[g.batchSize,g.outerSize,m/g.batchSize,g.sliceSize],S=t.bufferSync(v),C=t.bufferSync(b),A=SH(C,S,x);return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v),t.makeTensorInfo(g.outputShape,A.dtype,A.values)}const DCe={kernelName:Uw,backendName:"cpu",kernelFunc:OCe};function $Ce(n){const{inputs:e,backend:t}=n,{input:s}=e,r=We(s.shape),a=s.shape[s.shape.length-1],o=r/a,l=qs({inputs:{x:s},backend:t,attrs:{shape:[o,a]}}),c=fG(l,!0,t),u=qs({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),u}const RCe={kernelName:Ik,backendName:"cpu",kernelFunc:$Ce};const LCe=xs(z1,n=>Number.isFinite(n)?1:0,"bool"),FCe={kernelName:z1,backendName:"cpu",kernelFunc:LCe};const MCe=xs(B1,n=>Math.abs(n)===1/0?1:0,"bool"),PCe={kernelName:B1,backendName:"cpu",kernelFunc:MCe};const zCe=xs(j1,n=>Number.isNaN(n)?1:0,"bool"),BCe={kernelName:j1,backendName:"cpu",kernelFunc:zCe};function jCe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:a}=t,o=NH(s,r,a);return e.makeTensorInfo([o.length],"float32",o)}const UCe={kernelName:Dk,backendName:"cpu",kernelFunc:jCe};const VCe=xs(V1,n=>Math.log1p(n)),WCe={kernelName:V1,backendName:"cpu",kernelFunc:VCe};const HCe=Ur((n,e)=>n&&e),GCe=vi(qw,HCe,null,"bool"),qCe={kernelName:qw,backendName:"cpu",kernelFunc:GCe};const XCe=xs(Xw,n=>n?0:1,"bool"),YCe={kernelName:Xw,backendName:"cpu",kernelFunc:XCe};const KCe=Ur((n,e)=>n||e),ZCe=vi(Yw,KCe,null,"bool"),JCe={kernelName:Yw,backendName:"cpu",kernelFunc:ZCe};function QCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:a,bias:o,alpha:l,beta:c}=s;Rt(r,"LRN");const u=r.shape[3],d=u-1,p=t.data.get(r.dataId).values,m=We(r.shape),g=new Float32Array(m);function b(v){const x=v%u;let S=v-x+Math.max(0,x-a);const C=v-x+Math.min(x+a,d);let A=0;for(;S<=C;S++){const k=p[S];A+=k*k}return A}for(let v=0;v<m;v++){const x=b(v),S=p[v]*Math.pow(o+l*x,-c);g[v]=S}return t.makeTensorInfo(r.shape,r.dtype,g)}const e_e={kernelName:Kw,backendName:"cpu",kernelFunc:QCe};function t_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:a,dy:o}=e,{depthRadius:l,bias:c,alpha:u,beta:d}=s;Rt(o,"LRNGrad");const p=We(o.shape),m=o.shape[3],g=t.data.get(o.dataId).values,b=t.data.get(r.dataId).values,v=t.data.get(a.dataId).values,x=new Float32Array(p),S=p;for(let C=0;C<S;C++){const A=C%m,k=C-A+Math.max(0,A-l),O=C-A+Math.min(m,A+l+1);let F=0;for(let $=k;$<O;$++)F+=Math.pow(b[$],2);F=u*F+c;for(let $=k;$<O;$++){let M=-2*u*d*b[$]*v[C]/F;C===$&&(M+=Math.pow(F,-d)),M*=g[C],x[$]+=M}}return t.makeTensorInfo(o.shape,r.dtype,x)}const n_e={kernelName:$k,backendName:"cpu",kernelFunc:t_e};function pG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:a,keepDims:o}=s,l=t;let c=r.shape;const u=c.length,d=Fn(a,c);let p=d;const m=yr(p,u);let g=l.data.get(r.dataId).values;if(m!=null){const k=new Array(u);for(let O=0;O<k.length;O++)k[O]=c[m[O]];g=UL(g,c,r.dtype,m,k),p=Br(p.length,u),c=k}Rt(r,"max"),na("max",p,u);const[b,v]=Fi(c,p),x=We(v),S=EH(g,x,b,r.dtype),C=l.write(S,b,r.dtype);let A=b;return o&&(A=zr(b,d)),{dataId:C,shape:A,dtype:r.dtype}}const s_e={kernelName:Zw,backendName:"cpu",kernelFunc:pG};function r_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Rt(r,"maxPool");const{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=s,u=1;ee(ta(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=yc(r.shape,a,o,u,l,c);let p;if(d.filterWidth===1&&d.filterHeight===1&&jn(d.inShape,d.outShape))p=Sh({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=Ht(r.shape),b=HL(m,r.shape,r.dtype,g,d,"max");p=t.makeTensorInfo(d.outShape,r.dtype,b.values)}return p}const i_e={kernelName:Jw,backendName:"cpu",kernelFunc:r_e};function a_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:c,dataFormat:u}=s;Rt(r,"maxPool3d");const d=Dd(r.shape,a,o,1,l,c,u),p=t.data.get(r.dataId).values,m=uG(p,r.shape,r.dtype,Ht(r.shape),d,"max");return t.makeTensorInfo(m.shape,"float32",m.values)}const o_e={kernelName:Qw,backendName:"cpu",kernelFunc:a_e};function l_e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=s;Rt([r,a],"maxPool3DGrad");const d=Dd(a.shape,o,l,1,c,u),p=t.bufferSync(a),m=Kxe(p,d),g=d.strideDepth,b=d.strideHeight,v=d.strideWidth,x=d.dilationDepth,S=d.dilationHeight,C=d.dilationWidth,A=d.effectiveFilterDepth,k=d.effectiveFilterHeight,O=d.effectiveFilterWidth,F=A-1-d.padInfo.front,$=O-1-d.padInfo.left,M=k-1-d.padInfo.top,R=Dn(a.shape,"float32"),z=t.bufferSync(r);for(let I=0;I<d.batchSize;++I)for(let j=0;j<d.inChannels;++j)for(let H=0;H<d.inDepth;++H)for(let q=0;q<d.inHeight;++q)for(let re=0;re<d.inWidth;++re){const X=H-F,ne=q-M,Q=re-$;let he=0;for(let ye=0;ye<A;ye+=x){const Y=(X+ye)/g;if(!(Y<0||Y>=d.outDepth||Math.floor(Y)!==Y))for(let B=0;B<k;B+=S){const G=(ne+B)/b;if(!(G<0||G>=d.outHeight||Math.floor(G)!==G))for(let J=0;J<O;J+=C){const oe=(Q+J)/v;if(oe<0||oe>=d.outWidth||Math.floor(oe)!==oe)continue;const de=A*k*O-1-m.get(I,Y,G,oe,j),ge=ye*k*O+B*O+J,Ae=de===ge?1:0;if(Ae===0)continue;const Ce=z.get(I,Y,G,oe,j);he+=Ce*Ae}}}R.set(he,I,H,q,re,j)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const c_e={kernelName:Lk,backendName:"cpu",kernelFunc:l_e};function u_e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a,output:o}=e,l=a;Rt([a,o],"maxPoolGrad");const{filterSize:c,strides:u,pad:d,dimRoundingMode:p}=s,m=yc(l.shape,c,u,1,d,p),g=t.data.get(l.dataId).values,b=Dn(m.outShape,l.dtype,cG(g,l.shape,l.dtype,m).values),v=m.strideHeight,x=m.strideWidth,S=m.dilationHeight,C=m.dilationWidth,A=m.effectiveFilterHeight,k=m.effectiveFilterWidth,O=k-1-m.padInfo.left,F=A-1-m.padInfo.top,$=Dn(l.shape,"float32"),M=t.data.get(r.dataId).values,R=Dn(r.shape,"float32",M);for(let z=0;z<m.batchSize;++z)for(let I=0;I<m.inChannels;++I)for(let j=0;j<m.inHeight;++j)for(let H=0;H<m.inWidth;++H){const q=j-F,re=H-O;let X=0;for(let ne=0;ne<A;ne+=S){const Q=(q+ne)/v;if(!(Q<0||Q>=m.outHeight||Math.floor(Q)!==Q))for(let he=0;he<k;he+=C){const ye=(re+he)/x;if(ye<0||ye>=m.outWidth||Math.floor(ye)!==ye)continue;const Y=A*k-1-b.get(z,Q,ye,I),B=ne*k+he,G=Y===B?1:0;if(G===0)continue;const J=R.get(z,Q,ye,I);X+=J*G}}$.set(X,z,j,H,I)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const h_e={kernelName:Rk,backendName:"cpu",kernelFunc:u_e};function d_e(n,e,t,s,r){const a=Ht(e),o=HL(n,e,t,a,r,"max"),l=cG(n,e,t,r,!0,s);return[o.values,l.values]}const f_e={kernelName:Fk,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:a,pad:o,includeBatchInIndex:l}=e,c=t;Rt(s,"MaxPoolWithArgmax");const u=c.data.get(s.dataId).values,d=yc(s.shape,r,a,[1,1],o),[p,m]=d_e(u,s.shape,s.dtype,l,d),g=c.write(p,d.outShape,s.dtype),b=c.write(m,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:b,shape:d.outShape,dtype:"int32"}]}};function p_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s,l=Fn(a,r.shape),u=Fi(r.shape,l)[1],d=We(u),p=[],m=t.makeTensorInfo([],"float32",new Float32Array([d]));p.push(m);const g=Jf({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});p.push(g);const b=GL({inputs:{a:g,b:m},backend:t});p.push(b);const v=ix({inputs:{x:b},backend:t,attrs:{axis:a,keepDims:o}});return p.forEach(x=>t.disposeIntermediateTensorInfo(x)),v}const m_e={kernelName:e2,backendName:"cpu",kernelFunc:p_e};function g_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s;Rt(r,"min");const l=Fn(a,r.shape);let c=l;const u=yr(c,r.shape.length);let d=r;u!=null&&(d=po({inputs:{x:r},backend:t,attrs:{perm:u}}),c=Br(c.length,r.shape.length)),na("min",c,d.shape.length);const[p,m]=Fi(d.shape,c),g=We(m),b=Ji(We(p),d.dtype),v=t.data.get(d.dataId).values;for(let S=0;S<b.length;++S){const C=S*g;let A=v[C];for(let k=0;k<g;++k){const O=v[C+k];(Number.isNaN(O)||O<A)&&(A=O)}b[S]=A}u!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(p,d.dtype,b);if(o){const S=zr(p,l),C=qs({inputs:{x},backend:t,attrs:{shape:S}});return t.disposeIntermediateTensorInfo(x),C}return x}const y_e={kernelName:t2,backendName:"cpu",kernelFunc:g_e};function b_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:a,mode:o}=s;Rt(r,"mirrorPad");const l=a.map((A,k)=>A[0]+r.shape[k]+A[1]),c=a.map(A=>A[0]),u=a.map((A,k)=>A[0]+r.shape[k]),d=o==="reflect"?0:1,p=t.data.get(r.dataId).values,m=r.shape.length,g=Ht(r.shape),b=We(l),v=l.length,x=Ht(l),S=$i(r.dtype,b);for(let A=0;A<b;A++){let k=sg(A,v,x);for(let F=0;F<v;F++)k[F]<c[F]?k[F]=c[F]*2-k[F]-d:k[F]>=u[F]&&(k[F]=(u[F]-1)*2-k[F]+d);k=k.map((F,$)=>F-c[$]);const O=ou(k,m,g);S[A]=p[O]}return{dataId:t.write(S,l,r.dtype),shape:l,dtype:r.dtype}}const v_e={kernelName:n2,backendName:"cpu",kernelFunc:b_e};const w_e=Ur(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),x_e=vi(G1,w_e),S_e={kernelName:G1,backendName:"cpu",kernelFunc:x_e};function mG(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:a}=s,o=r.shape.length;let l=a;if(l===-1&&(l=o-1),l!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${l}`);const c=Fn([l],r.shape),u=pG({inputs:{x:r},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),d=zr(u.shape,c),p=qs({inputs:{x:u},backend:t,attrs:{shape:d}}),m=WL({inputs:{a:r,b:p},backend:t}),g=yH({inputs:{x:m},backend:t}),b=ix({inputs:{x:g},backend:t,attrs:{axis:c,keepDims:!1}}),v=qs({inputs:{x:b},backend:t,attrs:{shape:d}}),x=GL({inputs:{a:g,b:v},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v),x}const C_e={kernelName:w2,backendName:"cpu",kernelFunc:mG};function __e(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:a,seed:o,normalized:l}=s;Rt(r,"multinomial");const c=l?r:mG({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=c.shape[0],d=c.shape[1],p=t.data.get(c.dataId).values,m=[u,a],g=Ji(We(m),"int32");for(let b=0;b<u;++b){const v=b*d,x=new Float32Array(d-1);x[0]=p[v];for(let A=1;A<x.length;++A)x[A]=x[A-1]+p[v+A];const S=vy.alea(o.toString()),C=b*a;for(let A=0;A<a;++A){const k=S();g[C+A]=x.length;for(let O=0;O<x.length;O++)if(k<x[O]){g[C+A]=O;break}}}return l||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(m,"int32",g)}const k_e={kernelName:Mk,backendName:"cpu",kernelFunc:__e};const T_e=HT;function N_e(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:a}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=s;Rt(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(a.dataId).values,{selectedIndices:p}=T_e(u,d,o,l,c);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}const A_e={kernelName:Pk,backendName:"cpu",kernelFunc:N_e};const E_e=GT;function I_e(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:a}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,padToMaxOutputSize:u}=s;Rt(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,p=t.data.get(a.dataId).values,{selectedIndices:m,validOutputs:g}=E_e(d,p,o,l,c,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const O_e={kernelName:zk,backendName:"cpu",kernelFunc:I_e};const D_e=qT;function $_e(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:a}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:u}=s;Rt(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,p=t.data.get(a.dataId).values,m=o,g=l,b=c,v=u,{selectedIndices:x,selectedScores:S}=D_e(d,p,m,g,b,v);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([S.length],"float32",new Float32Array(S))]}const R_e={kernelName:Bk,backendName:"cpu",kernelFunc:$_e};function L_e(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:a,depth:o,onValue:l,offValue:c}=s;Rt(r,"oneHot");const u=We(r.shape),d=new Float32Array(u*o);d.fill(c);const p=t.data.get(r.dataId).values;for(let m=0;m<u;++m)p[m]>=0&&p[m]<o&&(d[m*o+p[m]]=l);return t.makeTensorInfo([...r.shape,o],a,d)}const F_e={kernelName:a2,backendName:"cpu",kernelFunc:L_e};function S_(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Bm({inputs:{input:s},backend:t}),a=S_({inputs:{x:r},backend:t}),o=e1({inputs:{input:s},backend:t}),l=S_({inputs:{x:o},backend:t}),c=Bo({inputs:{real:a,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}else return qL({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const M_e={kernelName:_2,backendName:"cpu",kernelFunc:S_};function gG(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Bm({inputs:{input:s},backend:t}),a=gG({inputs:{x:r},backend:t}),o=e1({inputs:{input:s},backend:t}),l=S_({inputs:{x:o},backend:t}),c=Bo({inputs:{real:a,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}else return qL({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const P_e={kernelName:i2,backendName:"cpu",kernelFunc:gG};function yG(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return x_({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const a=e[0].shape,o=e[0].dtype;e.forEach(d=>{ea(a,d.shape,"All tensors passed to stack must have matching shapes"),ee(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],c=e.map(d=>{const p=x_({inputs:{input:d},backend:t,attrs:{dim:r}});return l.push(p),p}),u=t1({inputs:c,backend:t,attrs:{axis:r}});return l.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const z_e={kernelName:o2,backendName:"cpu",kernelFunc:yG};function B_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:a,constantValue:o}=s;Rt(r,"pad");const l=a.map((C,A)=>C[0]+r.shape[A]+C[1]),c=a.map(C=>C[0]),u=t.data.get(r.dataId).values,d=We(r.shape),p=r.shape.length,m=Ht(r.shape),g=We(l),b=l.length,v=Ht(l),x=$i(r.dtype,g);o!==0&&x.fill(o);for(let C=0;C<d;C++){const k=sg(C,p,m).map((F,$)=>F+c[$]),O=ou(k,b,v);x[O]=u[C]}return{dataId:t.write(x,l,r.dtype),shape:l,dtype:r.dtype}}const bG={kernelName:l2,backendName:"cpu",kernelFunc:B_e};const j_e=Ur((n,e)=>Math.pow(n,e)),U_e=vi(X1,j_e),V_e={kernelName:X1,backendName:"cpu",kernelFunc:U_e};function W_e(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:a,indices:o}=e,{outputRaggedRank:l}=s,c=r.map(S=>t.data.get(S.dataId).values),u=r.map(S=>S.shape),d=t.data.get(a.dataId).values,p=t.data.get(o.dataId).values,[m,g,b]=LH(c,u,d,a.shape,a.dtype,p,o.shape),v=m.map(S=>t.makeTensorInfo([S.length],"int32",S)),x=t.makeTensorInfo(b,a.dtype,g);return v.concat([x])}const H_e={kernelName:jk,backendName:"cpu",kernelFunc:W_e};function G_e(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:a}=e,o=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(a.dataId).values,[u,d]=FH(o,s.shape,s.dtype,l,r.shape,c,a.shape),p=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([d.length],s.dtype,d);return[p,m]}const q_e={kernelName:Uk,backendName:"cpu",kernelFunc:G_e};function X_e(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:a,defaultValue:o,rowPartitionTensors:l}=e,{rowPartitionTypes:c}=s,u=t.data.get(r.dataId).values,d=t.data.get(a.dataId).values,p=t.data.get(o.dataId).values,m=l.map(x=>t.data.get(x.dataId).values),g=l.map(x=>x.shape),[b,v]=MH(u,r.shape,d,a.shape,a.dtype,p,o.shape,m,g,c);return t.makeTensorInfo(b,a.dtype,v)}const Y_e={kernelName:Vk,backendName:"cpu",kernelFunc:X_e};function K_e(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:a,step:o}=t,l=PH(s,r,o,a);return e.makeTensorInfo([l.length],a,l)}const Z_e={kernelName:Wk,backendName:"cpu",kernelFunc:K_e};const J_e=xs(Y1,n=>1/n),Q_e={kernelName:Y1,backendName:"cpu",kernelFunc:J_e};function eke(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:a,halfPixelCenters:o,size:l}=s;Rt(r,"resizeBilinear");const c=Ht(r.shape),[u,d]=l,[p,m,g,b]=r.shape,v=t.data.get(r.dataId).values,x=new Float32Array(We([p,u,d,b])),S=[a&&u>1?m-1:m,a&&d>1?g-1:g],C=[a&&u>1?u-1:u,a&&d>1?d-1:d];let A=0;const k=S[0]/C[0],O=S[1]/C[1];for(let F=0;F<p;F++)for(let $=0;$<u;$++){let M;o?M=k*($+.5)-.5:M=k*$;const R=Math.max(0,Math.floor(M)),z=M-R,I=Math.min(m-1,Math.ceil(M)),j=F*c[0]+R*c[1],H=F*c[0]+I*c[1];for(let q=0;q<d;q++){let re;o?re=O*(q+.5)-.5:re=O*q;const X=Math.max(0,Math.floor(re)),ne=re-X,Q=Math.min(g-1,Math.ceil(re)),he=j+X*c[2],ye=H+X*c[2],Y=j+Q*c[2],B=H+Q*c[2];for(let G=0;G<b;G++){const J=v[he+G],oe=v[ye+G],de=v[Y+G],ge=v[B+G],Ae=J+(de-J)*ne,Ce=oe+(ge-oe)*ne,Fe=Ae+(Ce-Ae)*z;x[A++]=Fe}}}return t.makeTensorInfo([p,u,d,b],"float32",x)}const tke={kernelName:f2,backendName:"cpu",kernelFunc:eke};function nke(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:a}=e,{alignCorners:o}=s;Rt([a,r],"resizeBilinearGrad");const l=Ht(r.shape),[c,u,d,p]=r.shape,[,m,g]=a.shape,b=new Float32Array(c*u*d*p),v=[o&&m>1?u-1:u,o&&g>1?d-1:d],x=[o&&m>1?m-1:m,o&&g>1?g-1:g],S=v[0]/x[0],C=v[1]/x[1],A=t.data.get(a.dataId).values;let k=0;for(let O=0;O<c;O++){const F=O*l[0];for(let $=0;$<m;$++){const M=$*S,R=Math.floor(M),z=Math.min(Math.ceil(M),u-1),I=F+R*l[1],j=F+z*l[1],H=M-R,q=1-H;for(let re=0;re<g;re++){const X=re*C,ne=Math.floor(X),Q=Math.min(Math.ceil(X),d-1),he=X-ne,ye=1-he,Y=I+ne*l[2],B=I+Q*l[2],G=j+ne*l[2],J=j+Q*l[2],oe=q*ye,de=q*he,ge=H*ye,Ae=H*he;for(let Ce=0;Ce<p;Ce++){const Fe=A[k++];b[Y+Ce]+=Fe*oe,b[B+Ce]+=Fe*de,b[G+Ce]+=Fe*ge,b[J+Ce]+=Fe*Ae}}}}return t.makeTensorInfo([c,d,u,p],"float32",b)}const ske={kernelName:qk,backendName:"cpu",kernelFunc:nke};function rke(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:a,halfPixelCenters:o,size:l}=s;Rt(r,"resizeNearestNeighbor");const c=Ht(r.shape),[u,d]=l,[p,m,g,b]=r.shape,v=t.data.get(r.dataId).values,x=new Float32Array(p*u*d*b),S=[a&&u>1?m-1:m,a&&d>1?g-1:g],C=[a&&u>1?u-1:u,a&&d>1?d-1:d],A=S[0]/C[0],k=S[1]/C[1];let O=0;for(let F=0;F<p;F++){const $=F*c[0];for(let M=0;M<u;M++){const R=o?A*(M+.5):A*M;let z=Math.min(m-1,a?Math.round(R):Math.floor(R));o&&(z=Math.max(0,z));const I=$+z*c[1];for(let j=0;j<d;j++){const H=o?k*(j+.5):k*j;let q=Math.min(g-1,a?Math.round(H):Math.floor(H));o&&(q=Math.max(0,q));const re=I+q*c[2];for(let X=0;X<b;X++){const ne=v[re+X];x[O++]=ne}}}}return t.makeTensorInfo([p,u,d,b],r.dtype,x)}const ike={kernelName:d2,backendName:"cpu",kernelFunc:rke};function ake(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:a}=e,{alignCorners:o}=s;Rt([a,r],"resizeNearestNeighborGrad");const l=Ht(r.shape),c=Ht(a.shape),[u,d,p,m]=r.shape,[,g,b]=a.shape,v=new Float32Array(u*d*p*m),x=t.data.get(a.dataId).values,S=[o&&g>1?d-1:d,o&&b>1?p-1:p],C=[o&&g>1?g-1:g,o&&b>1?b-1:b],A=S[0]/C[0],k=S[1]/C[1],O=1/A,F=1/k,$=Math.ceil(O)*2+2,M=Math.ceil(F)*2+2;for(let R=0;R<u;R++){const z=R*l[0];for(let I=0;I<d;I++){const j=z+I*l[1],H=Math.floor(I*O),q=Math.floor(H-$/2);for(let re=0;re<p;re++){const X=j+re*l[2],ne=Math.floor(re*F),Q=Math.floor(ne-M/2);for(let he=0;he<m;he++){let ye=0;for(let Y=0;Y<$;Y++){const B=Y+q;if(B<0||B>=g)continue;const G=z+B*c[1],J=B*A,oe=Math.min(d-1,o?Math.round(J):Math.floor(J));if(I===oe)for(let de=0;de<M;de++){const ge=de+Q;if(ge<0||ge>=b)continue;const Ae=G+ge*c[2],Ce=ge*k,Fe=Math.min(p-1,o?Math.round(Ce):Math.floor(Ce));re===Fe&&(ye+=x[Ae+he])}}v[X+he]=ye}}}}return t.makeTensorInfo(r.shape,r.dtype,v)}const oke={kernelName:Gk,backendName:"cpu",kernelFunc:ake};function lke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:a}=s;Rt(r,"reverse");const o=r.shape.length,l=Fn(a,r.shape);if(o===0)return Sh({inputs:{x:r},backend:t});const c=new ni(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<c.size;d++){const p=c.indexToLoc(d),m=p.slice();l.forEach(g=>m[g]=r.shape[g]-1-m[g]),c.set(u.get(...m),...p)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}const cke={kernelName:p2,backendName:"cpu",kernelFunc:lke};const uke={kernelName:uT,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:a,center:o}=e,l=t,c=$i(s.dtype,We(s.shape)),[u,d,p,m]=s.shape,[g,b]=z$(o,d,p),v=255,x=Math.sin(r),S=Math.cos(r),C=l.data.get(s.dataId).values;for(let k=0;k<u;k++){const O=k*p*d*m;for(let F=0;F<d;F++){const $=F*(p*m);for(let M=0;M<p;M++){const R=M*m;for(let z=0;z<m;z++){const I=[u,F,M,z],j=I[2],H=I[1];let q=(j-g)*S-(H-b)*x,re=(j-g)*x+(H-b)*S;q=Math.round(q+g),re=Math.round(re+b);let X=a;if(typeof a!="number"&&(z===3?X=v:X=a[z]),q>=0&&q<p&&re>=0&&re<d){const Q=re*(p*m),he=q*m,ye=O+Q+he+z;X=C[ye]}const ne=O+$+R+z;c[ne]=X}}}}return{dataId:l.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};const hke=xs(J1,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),dke={kernelName:J1,backendName:"cpu",kernelFunc:hke};function fke(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:a}=e,{shape:o}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=cp(a,r,o),m=!0,g=t.bufferSync(r),b=t.bufferSync(a),v=lm(g,b,o,p,u,c,l,d,0,m);return t.makeTensorInfo(o,v.dtype,v.values)}const pke={kernelName:Xk,backendName:"cpu",kernelFunc:fke};function mke(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function gke(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function yke(n,e,t,s,r,a){const o=kr("int32",t*r);for(let l=0;l<t;++l){const c=n.slice(l*s,(l+1)*s),u=l*r;for(let d=0;d<r;++d)o[u+d]=a==="left"?mke(c,e[d+u]):gke(c,e[d+u])}return o}function bke(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:a}=e,{side:o}=s,l=t.data.get(r.dataId).values,c=t.data.get(a.dataId).values,u=yke(l,c,r.shape[0],r.shape[1],a.shape[1],o);return t.makeTensorInfo(a.shape,"int32",u)}const vke={kernelName:Kk,backendName:"cpu",kernelFunc:bke};function wke(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:a}=e;Rt([s,r,a],"select");const o=s.shape.length,l=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,d=lo(r.dtype,a.dtype),p=Ji(We(r.shape),d);let m=0;const g=o===0||o>1||r.shape.length===1?1:We(r.shape.slice(1));for(let b=0;b<l.length;b++)for(let v=0;v<g;v++)l[b]===1?p[m++]=c[b]:p[m++]=u[b];return t.makeTensorInfo(r.shape,d,p)}const xke={kernelName:m2,backendName:"cpu",kernelFunc:wke};const Ske=JT,Cke=QT,_ke=xs(ey,n=>n>=0?Cke*n:Ske*(Math.exp(n)-1)),kke={kernelName:ey,backendName:"cpu",kernelFunc:_ke};const Tke=xs(sy,n=>n<0?-1:n>0?1:0),Nke={kernelName:sy,backendName:"cpu",kernelFunc:Tke};const Ake=xs(ty,n=>Math.sin(n)),Eke={kernelName:ty,backendName:"cpu",kernelFunc:Ake};const Ike=xs(ny,n=>Math.sinh(n)),Oke={kernelName:ny,backendName:"cpu",kernelFunc:Ike};const Dke=11920928955078125e-23,FB=Math.log(Dke)+2,$ke=xs(iy,n=>{const e=n>-FB,t=n<FB,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),Rke={kernelName:iy,backendName:"cpu",kernelFunc:$ke};function Lke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:a,paddings:o}=s;Rt([r],"spaceToBatchND");const l=We(a),c=[[0,0]];c.push(...o);for(let F=1+a.length;F<r.shape.length;++F)c.push([0,0]);const u=bG.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),d=H2(u.shape,a,l,!1),p=G2(d.length,a.length,!1),m=q2(u.shape,a,l,!1),v=qs({inputs:{x:u},backend:t,attrs:{shape:d}}),C=po({inputs:{x:v},backend:t,attrs:{perm:p}}),O=qs({inputs:{x:C},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(C),O}const Fke={kernelName:b2,backendName:"cpu",kernelFunc:Lke};function Mke(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:a,defaultValue:o}=e;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${a.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const l=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,d=t.data.get(o.dataId).values[0],[p,m,g,b,v]=UH(l,s.shape,s.dtype,c,r.dtype,u,d);return[t.makeTensorInfo(m,s.dtype,p),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(x=>Number(x)))),t.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const Pke={kernelName:Zk,backendName:"cpu",kernelFunc:Mke};function zke(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:a}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const o=Array.from(t.data.get(r.dataId).values),l=t.data.get(s.dataId).values,c=Array.from(t.data.get(a.dataId).values),[u,d,p]=VH(l,s.shape,s.dtype,o,c);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([p.length],a.dtype,new Int32Array(p))]}const Bke={kernelName:Jk,backendName:"cpu",kernelFunc:zke};function jke(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:a}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${a.shape}`);if(r.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(a.dataId).values,[u,d]=VL(o,s.shape,s.dtype,l,c,!0);return t.makeTensorInfo(d,s.dtype,u)}const Uke={kernelName:Qk,backendName:"cpu",kernelFunc:jke};function Vke(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:a}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${a.shape}`);if(r.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(a.dataId).values,[u,d]=VL(o,s.shape,s.dtype,l,c);return t.makeTensorInfo(d,s.dtype,u)}const Wke={kernelName:eT,backendName:"cpu",kernelFunc:Vke};function Hke(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:a,defaultValue:o}=e,{outputShape:l}=s,{sliceRank:c,numUpdates:u,sliceSize:d,strides:p,outputSize:m}=cp(a,r,l),g=!1,b=t.bufferSync(r);let v;switch(a.dtype){case"bool":{const x=t.bufferSync(a),S=!!t.data.get(o.dataId).values[0];v=lm(b,x,l,m,d,u,c,p,S,g);break}case"float32":{const x=t.bufferSync(a),S=t.data.get(o.dataId).values[0];v=lm(b,x,l,m,d,u,c,p,S,g);break}case"int32":{const x=t.bufferSync(a),S=t.data.get(o.dataId).values[0];v=lm(b,x,l,m,d,u,c,p,S,g);break}case"string":{const x=t.bufferSync(a),S=wd(t.data.get(o.dataId).values[0]);v=lm(b,x,l,m,d,u,c,p,S,g);break}default:throw new Error(`Unsupported type ${a.dtype}`)}return t.makeTensorInfo(l,v.dtype,v.values)}const Gke={kernelName:tT,backendName:"cpu",kernelFunc:Hke};function qke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:a,axis:o}=s,l=Fn(o,r.shape)[0],c=eR(r,a,l),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return c.map(p=>{const m=[...d];m[l]=p;const g=jm({inputs:{x:r},backend:t,attrs:{begin:u,size:m}});return u[l]+=p,g})}const Xke={kernelName:v2,backendName:"cpu",kernelFunc:qke};const Yke={kernelName:nT,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Rt(t,"square");const r=s.data.get(t.dataId).values,a=new Float32Array(r.length);for(let l=0;l<r.length;++l){const c=r[l];a[l]=c*c}return{dataId:s.write(a,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};const Kke=xs(dy,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),Zke={kernelName:dy,backendName:"cpu",kernelFunc:Kke};function Jke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:a,end:o,strides:l,beginMask:c,endMask:u,ellipsisMask:d,newAxisMask:p,shrinkAxisMask:m}=s;Rt(r,"stridedSlice");const{finalShapeSparse:g,finalShape:b,isIdentity:v,sliceDim0:x,isSimpleSlice:S,begin:C,end:A,strides:k}=L$(r.shape,a,o,l,c,u,d,p,m);let O;if(v)O=qs({inputs:{x:r},backend:t,attrs:{shape:b}});else if(x||S){ee(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const F=D$(C,A,k),$=jm({inputs:{x:r},backend:t,attrs:{begin:C,size:F}});O=qs({inputs:{x:$},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo($)}else{const F=t.bufferSync(r),$=GH(g,F,k,C);O=t.makeTensorInfo(b,$.dtype,$.values)}return O}const Qke={kernelName:sT,backendName:"cpu",kernelFunc:Jke};function eTe(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:a,leftPad:o,rightPad:l,padWidth:c,preserveShortSequences:u}=s,{data:d,dataSplits:p}=e,m=t.data.get(d.dataId).values,g=t.data.get(p.dataId).values,[b,v]=qH(m,g,r,a,o,l,c,u);return[t.makeTensorInfo([b.length],"string",b),t.makeTensorInfo(p.shape,"int32",v)]}const tTe={kernelName:rT,backendName:"cpu",kernelFunc:eTe};function nTe(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:a,delimiter:o}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const l=t.data.get(a.dataId).values,c=t.data.get(o.dataId).values[0],[u,d,p]=XH(l,c,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(p))]}const sTe={kernelName:iT,backendName:"cpu",kernelFunc:nTe};function rTe(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:a}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(a.dataId).values,l=YH(o,r);return t.makeTensorInfo(a.shape,"int32",l)}const iTe={kernelName:aT,backendName:"cpu",kernelFunc:rTe};const aTe=xs(cy,n=>Math.tan(n)),oTe={kernelName:cy,backendName:"cpu",kernelFunc:aTe};const lTe=xs(uy,n=>Math.tanh(n)),cTe={kernelName:uy,backendName:"cpu",kernelFunc:lTe};function uTe(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:a}=e,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=cp(a,r,s.shape),p=!1,m=t.bufferSync(r),g=t.bufferSync(a),b=t.bufferSync(s),v=lm(m,g,s.shape,d,c,l,o,u,b,p);return t.makeTensorInfo(s.shape,v.dtype,v.values)}const hTe={kernelName:Yk,backendName:"cpu",kernelFunc:uTe};function dTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:a}=s;Rt(r,"tile");const o=ZH(t.bufferSync(r),a);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const fTe={kernelName:hy,backendName:"cpu",kernelFunc:dTe};function pTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:a,sorted:o}=s;Rt(r,"topk");const l=t.data.get(r.dataId).values,[c,u]=QH(l,r.shape,r.dtype,a,o);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const mTe={kernelName:oT,backendName:"cpu",kernelFunc:pTe};function gTe(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:a}=e,{interpolation:o,fillMode:l,fillValue:c,outputShape:u}=t,[d,p,m,g]=r.shape,[b,v]=u??[p,m],x=[d,b,v,g],S=Ht(r.shape),C=S[0],A=S[1],k=S[2],O=Ht(x),F=O[0],$=O[1],M=O[2],R=$i(r.dtype,We(x));R.fill(c);const z=s.data.get(r.dataId).values,I=s.data.get(a.dataId).values;for(let H=0;H<d;++H){const q=a.shape[0]===1?I:I.subarray(H*8,H*8+8);for(let re=0;re<b;++re)for(let X=0;X<v;++X)for(let ne=0;ne<g;++ne){let Q;const he=q[6]*X+q[7]*re+1;if(he===0)continue;const ye=(q[0]*X+q[1]*re+q[2])/he,Y=(q[3]*X+q[4]*re+q[5])/he,B=MB(ye,m,l),G=MB(Y,p,l);switch(o){case"nearest":Q=STe(z,p,m,C,A,k,H,G,B,ne,c);break;case"bilinear":Q=CTe(z,p,m,C,A,k,H,G,B,ne,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const J=H*F+re*$+X*M+ne;R[J]=Q}return s.makeTensorInfo(x,r.dtype,R)}return{dataId:s.write(R,x,r.dtype),shape:r.shape,dtype:r.dtype}}const yTe={kernelName:lT,backendName:"cpu",kernelFunc:gTe};function MB(n,e,t){switch(t){case"reflect":return bTe(n,e);case"wrap":return vTe(n,e);case"nearest":return xTe(n,e);default:return wTe(n)}}function bTe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Wf(0,t,e-1)}function vTe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Wf(0,t,e-1)}function wTe(n,e){return n}function xTe(n,e){return Wf(0,n,e-1)}function Qb(n,e,t,s,r,a,o,l,c,u,d){const p=o*s+l*r+c*a+u;return 0<=l&&l<e&&0<=c&&c<t?n[p]:d}function STe(n,e,t,s,r,a,o,l,c,u,d){const p=Math.round(l),m=Math.round(c);return Qb(n,e,t,s,r,a,o,p,m,u,d)}function CTe(n,e,t,s,r,a,o,l,c,u,d){const p=Math.floor(l),m=Math.floor(c),g=p+1,b=m+1,v=(b-c)*Qb(n,e,t,s,r,a,o,p,m,u,d)+(c-m)*Qb(n,e,t,s,r,a,o,p,b,u,d),x=(b-c)*Qb(n,e,t,s,r,a,o,g,m,u,d)+(c-m)*Qb(n,e,t,s,r,a,o,g,b,u,d);return(g-l)*v+(l-p)*x}function _Te(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:a}=e;Rt(a,"unique");const o=s.data.get(a.dataId).values,{outputValues:l,outputShape:c,indices:u}=eG(o,r,a.shape,a.dtype);return[s.makeTensorInfo(c,a.dtype,l),s.makeTensorInfo([u.length],"int32",u)]}const kTe={kernelName:cT,backendName:"cpu",kernelFunc:_Te};function TTe(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:a}=s;a<0&&(a+=r.shape.length);const o=r.shape.length,l=r.shape[a],c=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==a&&(c[u++]=r.shape[g]);const d=new Array(o).fill(0),p=r.shape.slice();p[a]=1;const m=new Array(l);for(let g=0;g<m.length;g++){d[a]=g;const b=jm({inputs:{x:r},backend:t,attrs:{begin:d,size:p}});m[g]=qs({inputs:{x:b},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(b)}return m}const NTe={kernelName:S2,backendName:"cpu",kernelFunc:TTe};function ATe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:a}=e,{numSegments:o}=s;Rt(r,"unsortedSegmentSum");const l=r.shape.length,c=a.shape.length,u=[],d=[],p=l-c;let m=a;for(let b=0;b<p;++b){const v=x_({inputs:{input:m},backend:t,attrs:{dim:b+1}});m=v,d.push(v)}for(let b=0;b<o;++b){const v=Od(b,"int32"),x=t.makeTensorInfo([],"int32",v),S=mH({inputs:{a:x,b:m},backend:t}),C=Jf({inputs:{x:S},backend:t,attrs:{dtype:"float32"}}),A=xN({inputs:{a:C,b:r},backend:t}),k=ix({inputs:{x:A},backend:t,attrs:{axis:0,keepDims:!1}});u.push(k),d.push(x),d.push(S),d.push(C),d.push(A),d.push(k)}const g=yG({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(b=>t.disposeIntermediateTensorInfo(b)),g}const ETe={kernelName:C2,backendName:"cpu",kernelFunc:ATe};const ITe=[_xe,i2e,Txe,Axe,h2e,Ixe,Dxe,Rxe,Fxe,Pxe,Bxe,Uxe,Wxe,qxe,Yxe,Jxe,eSe,nSe,rSe,Sxe,aSe,lSe,uSe,f2e,dSe,c2e,m2e,pSe,a2e,gSe,bSe,vSe,xSe,CSe,kSe,NSe,ESe,OSe,$Se,LSe,MSe,zSe,jSe,VSe,WSe,GSe,XSe,KSe,ZSe,JSe,QSe,tCe,rCe,mxe,aCe,g2e,pCe,y2e,mCe,v2e,xCe,SCe,_Ce,x2e,C2e,TCe,ACe,ICe,DCe,k2e,N2e,o2e,RCe,ySe,FCe,PCe,BCe,gxe,E2e,O2e,UCe,$2e,WCe,qCe,YCe,JCe,e_e,n_e,s_e,L2e,i_e,o_e,c_e,h_e,f_e,m_e,y_e,M2e,v_e,S_e,k_e,z2e,j2e,A_e,O_e,R_e,V2e,F_e,P_e,z_e,bG,V_e,bxe,G2e,H_e,q_e,Y_e,Z_e,l2e,RI,Q_e,vxe,wxe,xxe,tke,ske,ike,oke,cke,uke,dke,exe,pke,vke,xke,kke,nxe,Nke,Eke,Oke,sxe,C_e,Rke,Fke,Pke,Bke,Uke,Wke,Gke,Xke,axe,Yke,lxe,uxe,Zke,Qke,tTe,sTe,iTe,pxe,nCe,oTe,cTe,hTe,fTe,mTe,yTe,W2e,kTe,NTe,ETe,M_e];for(const n of ITe)hT(n);const rm={},RS={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function vG(n,e){rm[n]=e}function bu(n,e){if(!(n in rm)||e!=null){const s=DTe(n,e);if(s!==null)rm[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=rm[n];return t==null||t.isContextLost()?(delete rm[n],bu(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),rm[n])}function OTe(n){if(!Re().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function DTe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??OTe(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete rm[n]},!1),Re().getBool("SOFTWARE_WEBGL_ENABLED")&&(RS.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",RS)||t.getContext("experimental-webgl",RS):t.getContext("webgl2",RS)}var Vv;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Vv||(Vv={}));var Tl;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Tl||(Tl={}));var Yi;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Yi||(Yi={}));function ax(n,e){return[e,n]}function $Te(n,e){return n*e}function LS(n){const e=We(n),t=Math.ceil(e/4);return YC(t)}function Ny(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function RTe(n,e){const[t,s]=Ny(n,e);return t*s*4}function XL(n,e){const t=n;let s,r,a,o,l,c,u,d,p,m;return Re().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,a=t.RGBA16F,o=t.RGBA32F,l=t.RED,u=4,d=1,p=t.HALF_FLOAT,m=t.FLOAT,c=t.RGBA8):(s=n.RGBA,r=n.RGBA,a=n.RGBA,o=t.RGBA,l=n.RGBA,u=4,d=4,p=e!=null?e.HALF_FLOAT_OES:null,m=n.FLOAT,c=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:l,downloadTextureFormat:c,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:p,textureTypeFloat:m}}function bt(n,e){const t=e();return Re().getBool("DEBUG")&&LTe(n),t}function LTe(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+xG(n,e))}const FTe=596e-10,MTe=65504;function wG(n){return!!(Re().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||FTe<Math.abs(n)&&Math.abs(n)<MTe)}function xG(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function ev(n,e){return Pd(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function SG(n,e){const t=Pd(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(bt(n,()=>n.shaderSource(t,e)),bt(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function CG(n,e){const t=Pd(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(bt(n,()=>n.shaderSource(t,e)),bt(n,()=>n.compileShader(t)),Re().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw YL(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const PTe=/ERROR: [0-9]+:([0-9]+):/g;function YL(n,e){const t=PTe.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),a=r.length.toString().length+2,o=r.map((p,m)=>pm((m+1).toString(),a)+p);let l=0;for(let p=0;p<o.length;p++)l=Math.max(o[p].length,l);const c=o.slice(0,s-1),u=o.slice(s-1,s),d=o.slice(s);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${pm(u[0],l)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function _G(n){return Pd(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function kG(n,e){if(bt(n,()=>n.linkProgram(e)),!Re().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function cC(n,e){if(bt(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function TG(n,e){const t=Pd(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return bt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),bt(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function NG(n,e){const t=Pd(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return bt(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),bt(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function zTe(){return Re().getNumber("WEBGL_VERSION")===2?1:4}function AG(n){return Pd(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function EG(n,e){const t=Re().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function IG(n){return Pd(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function FI(n,e,t,s,r,a,o){const l=n.getAttribLocation(e,t);return l===-1?!1:(bt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),bt(n,()=>n.vertexAttribPointer(l,r,n.FLOAT,!1,a,o)),bt(n,()=>n.enableVertexAttribArray(l)),!0)}function OG(n,e,t){FG(n,t),bt(n,()=>n.activeTexture(n.TEXTURE0+t)),bt(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function BTe(n,e){FG(n,e),bt(n,()=>n.activeTexture(n.TEXTURE0+e)),bt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function DG(n,e,t){return Pd(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function $G(n,e,t){return n.getUniformLocation(e,t)}function RG(n,e,t,s){bt(n,()=>OG(n,e,s)),bt(n,()=>n.uniform1i(t,s))}function jTe(n){bt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),bt(n,()=>n.viewport(0,0,n.canvas.width,n.canvas.height)),bt(n,()=>n.scissor(0,0,n.canvas.width,n.canvas.height))}function uC(n,e,t){bt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),bt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function MI(n,e){bt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),bt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function tv(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+LG(n,e))}function LG(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Pd(n,e,t){const s=bt(n,()=>e());if(s==null)throw new Error(t);return s}function FG(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Um(n,e=2){return We(n.slice(0,n.length-e))}function Vm(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function nv(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Um(n),...Vm(n)]),e}function MG(n,e=!1){let t=Re().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=Re().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&Re().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((l,c)=>c>=n.length-2?rk(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Id(n).newShape);let r=We(n),a=null;n.length<=1&&r<=t?a=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?a=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?a=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?a=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?a=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(a=[n[0],n[1]*n[2]*n[3]]);const o=a!=null&&Math.max(...a)>s&&Math.min(...a)<=(e?2:1)&&Math.min(...a)>0;if(a==null||o)if(e){const l=Um(n);let c=2,u=2;n.length&&([c,u]=Vm(n)),r=l*(c/2)*(u/2),a=YC(r).map(d=>d*2)}else a=YC(r);return a}function FS(n){return n%2===0}function Wv(n,e){if(n=n.slice(-2),e=e.slice(-2),jn(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||FS(t)&&FS(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&FS(n[0])&&FS(e[0])}let hC,dC;function PG(n){if(hC==null){const e=bu(n);hC=e.getParameter(e.MAX_TEXTURE_SIZE)}return hC}function UTe(){hC=null}function VTe(){dC=null}function zG(n){if(dC==null){const e=bu(n);dC=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,dC)}function BG(n){if(n===0)return 0;let e;const t=bu(n);return Nl(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Nl(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Nl(n,e){return n.getExtension(e)!=null}function PI(n){try{if(bu(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function jG(n){if(n===0)return!1;const e=bu(n);if(n===1){if(!Nl(e,"OES_texture_float"))return!1}else if(!Nl(e,"EXT_color_buffer_float"))return!1;return zI(e)}function UG(n){if(n===0)return!1;const e=bu(n);if(n===1){if(!Nl(e,"OES_texture_float")||!Nl(e,"WEBGL_color_buffer_float"))return!1}else{if(Nl(e,"EXT_color_buffer_float"))return zI(e);const s="EXT_color_buffer_half_float";if(Nl(e,s)){const r=e.getExtension(s);return WTe(e,r)}return!1}return zI(e)}function zI(n){const e=XL(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(a),o}function WTe(n,e){const t=XL(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const l=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),l}function VG(n){return n!==2?!1:bu(n).fenceSync!=null}function Ay(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&ee(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const HTe=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:Ay,bindCanvasToFramebuffer:jTe,bindColorTextureToFramebuffer:uC,bindTextureToProgramUniformSampler:RG,bindTextureUnit:OG,bindVertexBufferToProgramAttribute:FI,callAndCheck:bt,canBeRepresented:wG,createFragmentShader:CG,createFramebuffer:IG,createProgram:_G,createStaticIndexBuffer:NG,createStaticVertexBuffer:TG,createTexture:AG,createVertexShader:SG,getBatchDim:Um,getExtensionOrThrow:ev,getFramebufferErrorMessage:LG,getMaxTexturesInShader:zG,getNumChannels:zTe,getProgramUniformLocation:$G,getProgramUniformLocationOrThrow:DG,getRowsCols:Vm,getShapeAs3D:nv,getTextureShapeFromLogicalShape:MG,getWebGLDisjointQueryTimerVersion:BG,getWebGLErrorMessage:xG,getWebGLMaxTextureSize:PG,hasExtension:Nl,isCapableOfRenderingToFloatTexture:jG,isDownloadFloatTextureEnabled:UG,isReshapeFree:Wv,isWebGLFenceEnabled:VG,isWebGLVersionEnabled:PI,linkProgram:kG,logShaderSourceAndInfoLog:YL,resetMaxTextureSize:UTe,resetMaxTexturesInShader:VTe,unbindColorTextureFromFramebuffer:MI,unbindTextureUnit:BTe,validateFramebuffer:tv,validateProgram:cC,validateTextureSize:EG},Symbol.toStringTag,{value:"Module"}));const Pt=Re();Pt.registerFlag("HAS_WEBGL",()=>Pt.getNumber("WEBGL_VERSION")>0);Pt.registerFlag("WEBGL_VERSION",()=>PI(2)?2:PI(1)?1:0);Pt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Pt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Pt.get("WEBGL_VERSION")===2);Pt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Pt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Pt.registerFlag("WEBGL_PACK",()=>Pt.getBool("HAS_WEBGL"));Pt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_CLIP",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_REDUCE",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_LAZILY_UNPACK",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_CONV_IM2COL",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Pt.getBool("WEBGL_PACK"));Pt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>PG(Pt.getNumber("WEBGL_VERSION")));Pt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>zG(Pt.getNumber("WEBGL_VERSION")));Pt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Pt.getNumber("WEBGL_VERSION");return n===0?0:BG(n)});Pt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Pt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!oD());Pt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>jG(Pt.getNumber("WEBGL_VERSION")));Pt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Pt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Pt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Pt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>UG(Pt.getNumber("WEBGL_VERSION")));Pt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>VG(Pt.getNumber("WEBGL_VERSION")));Pt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Pt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Pt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Pt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>oD()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Pt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Pt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Pt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Pt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Pt.registerFlag("WEBGL_EXP_CONV",()=>!1);Pt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Pt.getBool("IS_TEST"));Pt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Pt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Pt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Pt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function Pa(){let n,e,t,s,r,a,o,l,c,u;return Re().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",a="outputColor",o="out vec4 outputColor;",l=Re().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",a="gl_FragColor",o="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:a,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:c,defineRound:u}}function dg(n,e,t="index"){const s=Ht(e);return s.map((r,a)=>{const o=`int ${n[a]} = ${t} / ${r}`,l=a===s.length-1?`int ${n[a+1]} = ${t} - ${n[a]} * ${r}`:`index -= ${n[a]} * ${r}`;return`${o}; ${l};`}).join("")}function SN(n,e,t="index"){const s=Ht(e);return s.map((r,a)=>{const o=`int ${n[a]} = ${t} / outShapeStrides[${a}]`,l=a===s.length-1?`int ${n[a+1]} = ${t} - ${n[a]} * outShapeStrides[${a}]`:`index -= ${n[a]} * outShapeStrides[${a}]`;return`${o}; ${l};`}).join("")}function GTe(n,e){const t=n.length,s=n.map(a=>`${e}[${a}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let a=t-3;a>=0;--a)r[a]=`(${r[a+1]} * ${s[a+1]})`;return r}function qTe(n,e,t="index"){const s=n.map((a,o)=>o),r=GTe(s,e);return r.map((a,o)=>{const l=`int ${n[o]} = ${t} / ${r[o]}`,c=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${l}; ${c};`}).join("")}function KL(n){const e=Ht(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function ZL(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const WG=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;const{getBroadcastDims:HG}=v9;function XTe(n,e,t){const s=[];if(n.forEach(g=>{const b=We(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${b>1?`[${b}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:v}=JL(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(v.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),a=n.map(g=>YTe(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,l=Pa(),c=JTe(l);let u,d,p=tNe(l);return e.isPacked?(u=KTe(e.logicalShape,o,t.enableShapeUniforms),d=eNe(l)):(u=ZTe(e.logicalShape,o,t.enableShapeUniforms),d=QTe(l)),t.packedInputs&&(p+=iNe),[p,c,d,r,u,a,t.userCode].join(`
`)}function Ey(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return yNe(n,e);case 1:return vNe(n,e);case 2:return xNe(n,e);case 3:return CNe(n,e);case 4:return kNe(n,e);case 5:return TNe(n);case 6:return NNe(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function GG(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return gNe(n);case 1:return bNe(n,e);case 2:return wNe(n,e);case 3:return SNe(n,e);default:return _Ne(n,e)}}function YTe(n,e,t=!1,s){let r="";t?r+=GG(n,s):r+=Ey(n,s);const a=n.shapeInfo.logicalShape,o=e.logicalShape;return a.length<=o.length&&(t?r+=ANe(n,e):r+=ENe(n,e)),r}function KTe(n,e,t){switch(n.length){case 0:return qG();case 1:return aNe(n,e,t);case 2:return pNe(n,e,t);case 3:return lNe(n,e,t);default:return uNe(n,e,t)}}function ZTe(n,e,t){switch(n.length){case 0:return qG();case 1:return oNe(n,e,t);case 2:return mNe(n,e,t);case 3:return cNe(n,e,t);case 4:return hNe(n,e,t);case 5:return dNe(n,e);case 6:return fNe(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function JTe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function QTe(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function eNe(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function tNe(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${nNe}
    ${sNe}
    ${rNe}
  `}const nNe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,sNe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,rNe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,iNe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function qG(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function aNe(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function oNe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function lNe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),a=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function cNe(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${SN(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=dg(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function uNe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),a=r*Math.ceil(n[n.length-2]/2);let o=a,l="",c="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],l=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+l,c=`b${u}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${l}

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${c});
    }
  `}function hNe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${SN(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=dg(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function dNe(n,e){const t=dg(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function fNe(n,e){const t=dg(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function pNe(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(jn(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function mNe(n,e,t){return jn(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function fg(n){return`offset${n}`}function gNe(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Pa();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function yNe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,a]=n.shapeInfo.texShape;if(r===1&&a===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=fg(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[l,c]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${l}, ${c}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function bNe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,a=Pa();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${a.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${a.texture2D}(${t}, uv);
    }
  `}function vNe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Iy(n)}
      }
    `;const r=n.shapeInfo.texShape,a=r[0],o=r[1];if(o===1&&a===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const l=fg(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / ${a}.0);
        return sampleTexture(${t}, uv);
      }
    `:a===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${l});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${a}, ${o}, index + ${l});
      return sampleTexture(${t}, uv);
    }
  `}function wNe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),a=n.shapeInfo.texShape,o=a[0],l=a[1],c=Pa();if(a!=null&&jn(t,a))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}.0, ${o}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function xNe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),a=n.shapeInfo.texShape;if(a!=null&&jn(t,a)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=a[0],g=a[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:l}=Id(t),c=o;if(c.length<t.length){const m=Oy(n,c),g=["row","col"];return`
      ${Ey(m,e)}
      float ${r}(int row, int col) {
        return ${r}(${Dy(g,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Iy(n)}
      }
    `;const u=a[0],d=a[1],p=fg(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${p};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function SNe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),a=n.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(t[0]===1){const m=t.slice(1),g=[1,2],b=Oy(n,m),v=["b","row","col"];return`
        ${GG(b,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Dy(v,g)});
        }
      `}const l=Pa();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=o[0],u=o[1],d=Math.ceil(t[2]/2),p=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${u}, ${p}, ${d}, b, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function CNe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),a=t[1]*t[2],o=t[2],{newShape:l,keptDims:c}=Id(t),u=l;if(u.length<t.length){const v=Oy(n,u),x=["row","col","depth"];return`
        ${Ey(v,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Dy(x,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${a}, ${o}, 1)));
        ${Iy(n)}
      }
    `;const d=n.shapeInfo.texShape,p=d[0],m=d[1],g=n.shapeInfo.flatOffset;if(m===a&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${p}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `;const b=fg(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${b};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${a} + col * ${o} + depth + ${b};
        vec2 uv = uvFromFlat(${p}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function _Ne(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Pa();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const a=n.shapeInfo.logicalShape,o=a.length,l=n.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],u=c[0],d=c[1],p=Math.ceil(a[o-1]/2);let m=p*Math.ceil(a[o-2]/2),g="int b, int row, int col",b=`b * ${m} + (row / 2) * ${p} + (col / 2)`;for(let v=2;v<o-1;v++)g=`int b${v}, `+g,m*=a[o-v-1],b=`b${v} * ${m} + `+b;return`
    vec4 ${s}(${g}) {
      int index = ${b};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function kNe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),a=t[3],o=t[2]*a,l=t[1]*o,{newShape:c,keptDims:u}=Id(t);if(c.length<t.length){const C=Oy(n,c),A=["row","col","depth","depth2"];return`
      ${Ey(C,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Dy(A,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${l}, ${o}, ${a}, 1)));
        ${Iy(n)}
      }
    `;const d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],g=p[1],b=`int stride2 = ${s}Shape[3];`,v=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(g===l&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${b}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const S=fg(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${b}
      ${v}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${S});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} +
          depth * ${a} + depth2;
      vec2 uv = uvFromFlat(${m}, ${g}, index + ${S});
      return sampleTexture(${s}, uv);
    }
  `}function TNe(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],a=e[3]*r,o=e[2]*a,l=e[1]*o,{newShape:c,keptDims:u}=Id(e);if(c.length<e.length){const v=Oy(n,c),x=["row","col","depth","depth2","depth3"];return`
      ${Ey(v)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Dy(x,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${o}, ${a}, ${r})) +
          depth3;
        ${Iy(n)}
      }
    `;const d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],g=p[1];if(g===l&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${a}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const b=fg(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} + depth * ${a} +
          depth2 * ${r} + depth3 + ${b};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function NNe(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:a}=Id(e);if(r.length<e.length){const x=Oy(n,r),S=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ey(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Dy(S,a)});
      }
    `}const o=e[5],l=e[4]*o,c=e[3]*l,u=e[2]*c,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${c}, ${l})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Iy(n)}
      }
    `;const p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],b=m[1];if(b===d&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${c}, ${l}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${b}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(b===o&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${b}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const v=fg(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${c} +
          depth2 * ${l} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${g}, ${b}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Iy(n){const e=n.name,t=We(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function ANe(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",a=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,l=HG(n.shapeInfo.logicalShape,e.logicalShape),c=Es(o),u=o-a;let d;const p=["x","y","z","w","u","v"];a===0?d="":o<2&&l.length>=1?d="coords = 0;":d=l.map(C=>`coords.${p[C+u]} = 0;`).join(`
`);let m="";o<2&&a>0?m="coords":m=n.shapeInfo.logicalShape.map((C,A)=>`coords.${p[A+u]}`).join(", ");let g="return outputValue;";const v=We(n.shapeInfo.logicalShape)===1,S=We(e.logicalShape)===1;if(a===1&&!v&&!S)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!S)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(l.length){const C=a-2,A=a-1;l.indexOf(C)>-1&&l.indexOf(A)>-1?g="return vec4(outputValue.x);":l.indexOf(C)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(A)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${m});
      ${g}
    }
  `}function ENe(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",a=e.texShape,o=n.shapeInfo.texShape,l=n.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!n.shapeInfo.isUniform&&l===c&&n.shapeInfo.flatOffset==null&&jn(o,a))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Es(c),d=HG(n.shapeInfo.logicalShape,e.logicalShape),p=c-l;let m;const g=["x","y","z","w","u","v"];l===0?m="":c<2&&d.length>=1?m="coords = 0;":m=d.map(v=>`coords.${g[v+p]} = 0;`).join(`
`);let b="";return c<2&&l>0?b="coords":b=n.shapeInfo.logicalShape.map((v,x)=>`coords.${g[x+p]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${m}
      return get${s}(${b});
    }
  `}function Es(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function JL(n,e,t){const{newShape:s,keptDims:r}=Id(e),a=e.length,o=n&&a===3&&e[0]===1,l=o?e.slice(1):s,c=!n&&a>1&&!jn(e,t)&&s.length<a||o;return{useSqueezeShape:c,uniformShape:c?l:e,keptDims:r}}function Oy(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Dy(n,e){return e.map(t=>n[t]).join(", ")}function INe(n,e,t,s){const r=t.map((d,p)=>{const m={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(m.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[p],shapeInfo:m}}),a=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},l=XTe(r,o,e),c=CG(n.gl,l),u=n.createProgram(c);return Re().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:l,webGLProgram:u,inShapeInfos:a,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:c,source:l,webGLProgram:u,inShapeInfos:a,outShapeInfo:o},XG(n,e,u)))}function XG(n,e,t){const s=[],r=[];let a,o,l,c=null,u=null;u=n.getUniformLocation(t,"NAN",!1),Re().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const p of e.variableNames){const m={name:p,uniform:n.getUniformLocation(t,p,d),offset:n.getUniformLocation(t,`offset${p}`,d)};e.enableShapeUniforms&&(m.shape=n.getUniformLocation(t,`${p}Shape`,d),m.texShape=n.getUniformLocation(t,`${p}TexShape`,d)),s.push(m)}if(e.enableShapeUniforms&&(a=n.getUniformLocation(t,"outShape",d),l=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const p of e.customUniforms)r.push(n.getUniformLocation(t,p.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:c,nanLoc:u,outShapeLocation:a,outShapeStridesLocation:l,outTexShapeLocation:o}}function PB(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,a=e[s],o=a.shape;if(!jn(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&a.isUniform)return;const l=t.texShape,c=a.isUniform?null:a.texData.texShape;if(!jn(l,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${l} and ${c} must match`)})}function ONe(n,e,t,s,r){e.program.enableShapeUniforms||(PB(e.inShapeInfos,t),PB([e.outShapeInfo],[s]));const a=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(a.texture,o[0],o[1]):n.setOutputMatrixTexture(a.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),Re().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){const u=t[c],{uniform:d,offset:p,shape:m,texShape:g}=e.variablesLocations[c];if(m){const{uniformShape:b}=JL(e.program.packedInputs,u.shape,u.texData.texShape);switch(b.length){case 1:n.gl.uniform1iv(m,new Int32Array(b));break;case 2:n.gl.uniform2iv(m,new Int32Array(b));break;case 3:n.gl.uniform3iv(m,new Int32Array(b));break;case 4:n.gl.uniform4iv(m,new Int32Array(b));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(We(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let b=u.uniformValues;b instanceof Float32Array||(b=new Float32Array(b)),n.gl.uniform1fv(d,b)}continue}u.texData.slice!=null&&p!=null&&n.gl.uniform1i(p,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,c)}}const l=e.outShapeLocation;if(l)switch(s.shape.length){case 1:n.gl.uniform1iv(l,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(l,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(l,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(l,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const c=Ht(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const u=e.program.customUniforms[c],d=e.customUniformLocations[c],p=r[c];if(u.type==="float")n.gl.uniform1fv(d,p);else if(u.type==="vec2")n.gl.uniform2fv(d,p);else if(u.type==="vec3")n.gl.uniform3fv(d,p);else if(u.type==="vec4")n.gl.uniform4fv(d,p);else if(u.type==="int")n.gl.uniform1iv(d,p);else if(u.type==="ivec2")n.gl.uniform2iv(d,p);else if(u.type==="ivec3")n.gl.uniform3iv(d,p);else if(u.type==="ivec4")n.gl.uniform4iv(d,p);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function DNe(n,e,t){let s="";e.concat(t).forEach(o=>{const l=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const c=o.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:p}=JL(n.packedInputs,o.shape,c);let m="",g="",b="";if(d.length===1&&n.packedInputs){const O=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];m=`${O[0]>1}_${O[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const O=Ht(d);b=`${O[0]===c[1]}_${O[O.length-1]===c[1]}`}const v=o.shape.length,x=d.length===2&&jn(o.shape,c),S=We(o.shape)===1,C=$m(o.shape,t.shape),A=!n.packedInputs&&v===t.shape.length&&jn(c,t.texData.texShape),k=n.packedInputs||d.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${v}_${A}_${u?p:""}_${d.length}_${S}_${C}_${x}_${m}_${g}_${b}_${k}_${l}`}else{const c=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${c}_${l}`}});const r=n.userCode;let a=n.constructor.name;return a+="_"+s+"_"+r+`${Re().getNumber("WEBGL_VERSION")}`,a}function ga(n){return Re().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}class $Ne{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Vv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Pa();this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?SN(["r","c","d"],e):dg(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}class RNe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Vv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Pa();this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?SN(["r","c","d"],e):dg(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}class LNe{constructor(e){this.variableNames=["A"],this.outTexUsage=Tl.DOWNLOAD;const t=Pa();this.outputShape=e,this.userCode=`
      ${WG}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}class FNe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Tl.DOWNLOAD;const t=Pa();this.outputShape=e,this.userCode=`
      ${WG}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}const MNe={R:0,G:1,B:2,A:3};class zB{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Pa();this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let o="";for(let l=0;l<s.length;l++){const c=s[l];o+=`
          if(offset == ${l}) {
            result = values[${MNe[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?ZL():KL(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${a}, 0., 0., 0.);
      }
    `}}class PNe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Pa();this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){const c=o*2+l;r+=`
          localCoords = coords;
          if(localCoords[2] + ${l} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${l};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?ZL():KL(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${a};
        }
    `}}function YG(n){const e=Pa(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return SG(n,t)}function KG(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return TG(n,e)}function ZG(n){const e=new Uint16Array([0,1,2,2,1,3]);return NG(n,e)}function ox(n,e,t,s,r,a){EG(e,t);const o=AG(n),l=n.TEXTURE_2D;return bt(n,()=>n.bindTexture(l,o)),bt(n,()=>n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),bt(n,()=>n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),bt(n,()=>n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)),bt(n,()=>n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)),Re().getNumber("WEBGL_VERSION")===1?bt(n,()=>n.texImage2D(l,0,s,e,t,0,r,a,null)):bt(n,()=>n.texStorage2D(l,1,s,e,t)),bt(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function QL(n){return n.internalFormatFloat}function JG(n,e,t,s){const[r,a]=ax(e,t);return ox(n,r,a,QL(s),s.textureFormatFloat,n.FLOAT)}function eF(n){return n.internalFormatHalfFloat}function QG(n,e,t,s){const[r,a]=ax(e,t);return ox(n,r,a,eF(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function tF(n){return n.downloadTextureFormat}function eq(n,e,t,s){const[r,a]=ax(e,t);return ox(n,r,a,tF(s),n.RGBA,n.UNSIGNED_BYTE)}function nF(n){return n.internalFormatPackedFloat}function tq(n,e,t,s){const[r,a]=Ny(e,t);return ox(n,r,a,nF(s),n.RGBA,n.FLOAT)}function sF(n){return n.internalFormatPackedHalfFloat}function nq(n,e,t,s){const[r,a]=Ny(e,t);return ox(n,r,a,sF(s),n.RGBA,s.textureTypeHalfFloat)}function sq(n,e,t){return bt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),FI(n,e,"clipSpacePos",t,3,20,0)&&FI(n,e,"uv",t,2,20,12)}function rq(n,e,t,s,r,a){bt(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,l,c;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),l=n.UNSIGNED_BYTE,c=n.RGBA):(o=new Float32Array(t*s*4),l=n.FLOAT,c=a.internalFormatPackedFloat),o.set(r),Re().getNumber("WEBGL_VERSION")===2?bt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,l,o)):bt(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,t,s,0,n.RGBA,l,o)),bt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function iq(n,e,t){bt(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?Re().getNumber("WEBGL_VERSION")===2?bt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):bt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):Re().getNumber("WEBGL_VERSION")===2?bt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):bt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),bt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function aq(n,e,t,s){const r=n.createBuffer();bt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const l=4*4*e*t;return bt(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,l,n.STREAM_READ)),bt(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),bt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function oq(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function lq(n,e,t,s){const[r,a]=ax(e,t),o=4,l=new Uint8Array($Te(e*t,o));return bt(n,()=>n.readPixels(0,0,r,a,s.downloadTextureFormat,n.UNSIGNED_BYTE,l)),new Float32Array(l.buffer)}function cq(n,e,t,s,r,a,o,l){const c=n,u=new Float32Array(RTe(a,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function uq(n,e,t){const s=new Float32Array(e*t*4);return bt(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}const zNe=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:sq,createBufferFromOutputTexture:aq,createFloat16MatrixTexture:QG,createFloat16PackedMatrixTexture:nq,createFloat32MatrixTexture:JG,createIndexBuffer:ZG,createPackedMatrixTexture:tq,createUnsignedBytesMatrixTexture:eq,createVertexBuffer:KG,createVertexShader:YG,downloadByteEncodedFloatMatrixFromOutputTexture:lq,downloadFloat32MatrixFromBuffer:oq,downloadMatrixFromPackedOutputTexture:uq,downloadPackedMatrixFromBuffer:cq,getInternalFormatForFloat16MatrixTexture:eF,getInternalFormatForFloat16PackedMatrixTexture:sF,getInternalFormatForFloat32MatrixTexture:QL,getInternalFormatForPackedMatrixTexture:nF,getInternalFormatForUnsignedBytesMatrixTexture:tF,uploadDenseMatrixToTexture:rq,uploadPixelDataToTexture:iq},Symbol.toStringTag,{value:"Module"}));class fC{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=Re().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,vG(t,e)):this.gl=bu(t),e=this.gl,Re().getNumber("WEBGL_VERSION")===2){const a=e;this.createVertexArray=()=>bt(a,()=>a.createVertexArray()),this.bindVertexArray=o=>bt(a,()=>a.bindVertexArray(o)),this.deleteVertexArray=o=>bt(a,()=>a.deleteVertexArray(o)),this.getVertexArray=()=>bt(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(e!=null){const a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>bt(e,()=>a.createVertexArrayOES()),this.bindVertexArray=o=>bt(e,()=>a.bindVertexArrayOES(o)),this.deleteVertexArray=o=>bt(e,()=>a.deleteVertexArrayOES(o)),this.getVertexArray=()=>bt(e,()=>e.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Re().getNumber("WEBGL_VERSION")===1){const a="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=ev(this.gl,a),Nl(this.gl,o))this.textureHalfFloatExtension=ev(this.gl,o);else if(Re().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Nl(this.gl,r))this.colorBufferHalfFloatExtension=ev(this.gl,r);else if(Re().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Nl(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Nl(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=KG(this.gl),this.indexBuffer=ZG(this.gl),this.framebuffer=IG(this.gl),this.textureConfig=XL(this.gl,this.textureHalfFloatExtension)}get debug(){return Re().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;bt(e,()=>e.finish()),bt(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),bt(e,()=>e.deleteFramebuffer(this.framebuffer)),bt(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),bt(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),bt(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),JG(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),QG(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),eq(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),iq(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),rq(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),nq(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),tq(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(MI(this.gl,this.framebuffer),this.outputTexture=null),bt(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>lq(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,a,o){return cq(this.gl,e,t,s,r,a,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return oq(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=aq(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(Re().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(a,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=a}else Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>uq(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=YG(t));const s=_G(t);bt(t,()=>t.attachShader(s,this.vertexShader)),bt(t,()=>t.attachShader(s,e)),kG(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&cC(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;bt(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),sq(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(bt(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&cC(this.gl,this.program),bt(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?DG(this.gl,e,t):$G(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),bt(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),RG(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,a]=Ny(t,s);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&cC(this.gl,this.program),tv(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}bt(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),bt(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ev(this.gl,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,a),a}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await WE(()=>this.disposed||this.isQueryAvailable(e,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=BNe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in Re().platform&&(s=Re().platform.setTimeoutCustom.bind(Re().platform)),WE(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),uC(this.gl,e,this.framebuffer),this.debug&&tv(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(uC(this.gl,this.outputTexture,this.framebuffer),this.debug&&tv(this.gl)):MI(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;uC(r,e,this.framebuffer),this.debug&&tv(r),this.outputTexture=e,bt(r,()=>r.viewport(0,0,t,s)),bt(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),bt(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function BNe(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}const{addImpl:jNe,bincountImpl:hq,bincountReduceImpl:UNe,bitwiseAndImpl:VNe,castImpl:WNe,ceilImpl:HNe,concatImpl:GNe,equalImpl:qNe,expImpl:XNe,expm1Impl:YNe,floorImpl:KNe,gatherNdImpl:ZNe,gatherV2Impl:JNe,greaterImpl:QNe,greaterEqualImpl:eAe,lessImpl:tAe,lessEqualImpl:nAe,linSpaceImpl:sAe,logImpl:rAe,maxImpl:iAe,maximumImpl:aAe,minimumImpl:oAe,multiplyImpl:lAe,negImpl:cAe,notEqualImpl:uAe,prodImpl:hAe,raggedGatherImpl:dAe,raggedRangeImpl:fAe,raggedTensorToTensorImpl:pAe,rangeImpl:mAe,rsqrtImpl:gAe,scatterImpl:yAe,sigmoidImpl:bAe,simpleAbsImpl:dq,sliceImpl:vAe,sparseFillEmptyRowsImpl:wAe,sparseReshapeImpl:xAe,sparseSegmentReductionImpl:fq,sqrtImpl:SAe,staticRegexReplaceImpl:CAe,stridedSliceImpl:_Ae,stringNGramsImpl:kAe,stringSplitImpl:TAe,stringToHashBucketFastImpl:NAe,subImpl:AAe,tileImpl:EAe,topKImpl:IAe,transposeImpl:rF,uniqueImpl:OAe}=tG;function pq(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Oa(n,e){return e===1?[n]:pq(n,e)}function DAe(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}class $Ae{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ga(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Oa("rc",this.rank),s=Es(this.rank),r=this.getOutOfBoundsCondition(t),a=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let a=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)a=`${e[e.length-1-o]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}class mq{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length);let s="";for(let r=0;r<4;r++){let a="thisRC = rc;";r%2===1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),s+=`
        ${a}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${RAe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?ZL():KL(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function RAe(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?qTe(["r","c","d"],"inputShape"):dg(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}class LAe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=jB(t,s),a=UB(e,r,s);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const o=BB(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const c=this.freeTextures[a].pop();return this.usedTextures[a].push(c),c}let l;return r===Yi.PACKED_2X2_FLOAT32?l=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Yi.PACKED_2X2_FLOAT16?l=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Yi.UNPACKED_FLOAT32?l=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Yi.UNPACKED_FLOAT16?l=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Yi.PACKED_4X1_UNSIGNED_BYTE&&(l=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(l),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),l}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const a=jB(s,r),o=UB(t,a,r);o in this.freeTextures||(this.freeTextures[o]=[]);const l=BB(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=Re().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=l):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=l),this.numUsedTextures--;const u=this.usedTextures[o],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function FAe(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function BB(n,e,t,s,r){const a=MAe(e,s);let o;if(r){const[c,u]=Ny(n[0],n[1]);o=c*u}else{const[c,u]=ax(n[0],n[1]);o=c*u}const l=FAe(t,a);return o*l}function MAe(n,e){switch(n){case Yi.PACKED_2X2_FLOAT32:return nF(e);case Yi.PACKED_2X2_FLOAT16:return sF(e);case Yi.UNPACKED_FLOAT32:return QL(e);case Yi.UNPACKED_FLOAT16:return eF(e);case Yi.PACKED_4X1_UNSIGNED_BYTE:return tF(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function PAe(n){return Re().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Yi.PACKED_2X2_FLOAT32:Yi.UNPACKED_FLOAT32:n?Yi.PACKED_2X2_FLOAT16:Yi.UNPACKED_FLOAT16}function jB(n,e){if(n===Tl.UPLOAD)return Yi.PACKED_2X2_FLOAT32;if(n===Tl.RENDER||n==null)return PAe(e);if(n===Tl.DOWNLOAD||n===Tl.PIXELS)return Yi.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function UB(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}class ah{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const vc="if (isnan(x)) return x;",zAe="return x;",VB="return abs(x);",BAe="return (x >= 0.0) ? x : (exp(x) - 1.0);",jAe=vc+`
  return (x < 0.0) ? 0.0 : x;
`,UAe=vc+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Nf="return x;",VAe="return 1.0 / (1.0 + exp(-1.0 * x));";const WAe="return x;",HAe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,GAe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qAe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,XAe="return 1.0 / (1.0 + exp(-1.0 * x));";class Ff{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}class YAe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length);const t=e.length,s=Oa("rc",t),r=Es(t),a=DAe(t,s),o=s.slice(-2),l=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${l}));
      }
    `}}const KAe=zT,ZAe=1e-7,JAe=1e-4,MS={};function QAe(n){return n in MS||(MS[n]={}),MS[n]}const e5e=Re().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),t5e=600;function n5e(){return Re().global.screen==null?1024:Re().global.screen.height*Re().global.screen.width*window.devicePixelRatio*t5e/1024/1024}class lx extends sk{nextDataId(){return lx.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Re().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof fC)t=e;else{const s=bu(Re().getNumber("WEBGL_VERSION"),e);t=new fC(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=bu(Re().getNumber("WEBGL_VERSION"));t=new fC(s),this.binaryCache=QAe(Re().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new LAe(this.gpgpu),this.numMBBeforeWarning=n5e(),this.texData=new QO(this,Qc())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,a,o){const l=this.makeTensorInfo(t,s),c=this.texData.get(l.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,a]},c.texShape=[r,a];const u=nv(t),d=new zB(u,!1,o),p=this.runWebGLProgram(d,[l],s,[[r,a]]);return p.shape=t,c.texture=null,this.disposeIntermediateTensorInfo(l),p.dataId}write(e,t,s){if((Re().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Re().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Tl.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,a){if(Re().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Tl.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:a,slice:o,shape:l,isPacked:c}=t;if(o!=null){let m;c?m=new Ff(l,Nf):m=new ah(l,Nf);const g=this.runWebGLProgram(m,[{dataId:e,shape:l,dtype:r}],r),b=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=Gi());let p;if(r==="complex64"){const m=this.readSync(a.real.dataId),g=this.readSync(a.imag.dataId);p=kd(m,g)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Gi()-d),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){const b=this.pendingRead.get(e);return new Promise(v=>b.push(v))}const t=this.texData.get(e),{values:s,shape:r,slice:a,dtype:o,complexTensorInfos:l,isPacked:c}=t;if(a!=null){let b;c?b=new Ff(r,Nf):b=new ah(r,Nf);const v=this.runWebGLProgram(b,[{dataId:e,shape:r,dtype:o}],o),x=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(Re().getBool("DEBUG")&&!Re().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Re().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(o!=="complex64"&&Re().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const b=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(b.texture.texture,...LS(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(o==="complex64"){const b=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),v=b[0],x=b[1];p=kd(v,x)}else if(u==null)p=this.getValuesFromTexture(e);else{const b=We(r);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,b)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const b=this.gpgpu.gl;bt(b,()=>b.deleteBuffer(u))}const m=this.convertAndCacheOnCPU(e,p),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(b=>b(m)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Qc().removeDataId(e,this),this.pendingDeletes--),m}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:a,slice:o,dtype:l,isPacked:c,texture:u}=s;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;c?g=new Ff(a,Nf):g=new ah(a,Nf);const b=this.runWebGLProgram(g,[{dataId:e,shape:a,dtype:l}],l),v=this.readToGPU(b,t);return this.disposeIntermediateTensorInfo(b),v}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),p=Qc().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:p},m.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>wd(r));return Dn(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Dn(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!wG(s))throw Re().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),a=We(t);if(Re().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(e),g=this.texData.get(m.dataId),b=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...LS(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(m),b}const o=Re().getBool("WEBGL_PACK")&&r===!0,l=o?nv(t):t,c=o?new FNe(l):new LNe(l),u=this.runWebGLProgram(c,[{shape:l,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const a=vh(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),o=vh(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(a);l.kernelMs=PU(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:o[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Gi(),endMs:null}}endTimer(e){return Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Gi(),e)}async getQueryTime(e){if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:a,isPacked:o,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,a,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=e5e){return Re().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&We(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){xl("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return KAe(e.shape,t)}packedUnaryOp(e,t,s){const r=new Ff(e.shape,t),a=this.compileAndRun(r,[e],s);return Qc().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=dq(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(Re().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,VB,e.dtype);const t=new ah(e.shape,VB),s=this.compileAndRun(t,[e]);return Qc().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&ih(s[0])){const a=s.map(o=>ch(o));r=this.write(a,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return Qc().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new YAe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new $Ae(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[Um(e.shape),...Vm(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},a=[Um(t),...Vm(t)],o=new mq(a,s),l=!0,c=[s],u=this.runWebGLProgram(o,[r],e.dtype,c,l);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:a,dtype:o}=s;if(t!=null){const m=We(a),g=t[0]*t[1]*4;ee(m<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const l=nv(a);let c;r?c=new RNe(l):c=new $Ne(l);const u=!0,d=[t??LS(l)],p=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],o,d,u,t);return{dtype:o,shape:a,dataId:p.dataId}}runWebGLProgram(e,t,s,r,a=!1,o){const l=this.makeTensorInfo(e.outputShape,s),c=this.texData.get(l.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Vv.DENSE){const S=o??LS(e.outputShape);c.texShape=S.map(C=>C*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),We(l.shape)===0)return c.values=$i(l.dtype,0),l;const u=[],d=t.map(S=>{if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(S.dataId);if(C.texture==null){if(!e.packedInputs&&We(S.shape)<=Re().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=S.shape)}if(this.uploadToGPU(S.dataId),!!C.isPacked!=!!e.packedInputs)S=C.isPacked?this.unpackTensor(S):this.packTensor(S),u.push(S),C=this.texData.get(S.dataId);else if(C.isPacked&&!Wv(C.shape,S.shape)){const A=S,k=S.shape;S.shape=C.shape,S=this.packedReshape(S,k),u.push(S),C=this.texData.get(S.dataId),A.shape=k}return{shape:S.shape,texData:C,isUniform:!1}});this.uploadToGPU(l.dataId);const p={shape:l.shape,texData:c,isUniform:!1},m=DNe(e,d,p),g=this.getAndSaveBinary(m,()=>INe(this.gpgpu,e,d,p)),b=this.activeTimers!=null;let v;b&&(v=this.startTimer()),Re().get("ENGINE_COMPILE_ONLY")||ONe(this.gpgpu,g,d,p,r),u.forEach(S=>this.disposeIntermediateTensorInfo(S)),b&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const x=Re().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const S=Gi();S-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=S)}if(!Re().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){const S=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),S}return l}compileAndRun(e,t,s,r,a=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Re().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Le(()=>{if(!Re().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Re().getBool("DEBUG");Re().set("DEBUG",!1);const t=this.abs(Xt(1e-8)).dataSync()[0];if(Re().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?ZAe:JAe}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:a,texture:o,usage:l,isPacked:c}=t;if(o!=null)return;const u=this.activeTimers!=null;let d;u&&(d=Gi());let p=t.texShape;if(p==null&&(p=MG(s,c),t.texShape=p),a!=null){const m=nv(s);let g,b=p[1],v=p[0];const x=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(c||!x)&&([b,v]=Ny(p[0],p[1])),c?g=new PNe(m,x):g=new zB(m,x);const S=x?[v,b]:p,C=this.makeTensorInfo(S,r),A=this.texData.get(C.dataId);x?A.usage=Tl.PIXELS:A.usage=Tl.UPLOAD,A.texShape=S,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),b,v,a);const k=[[v,b]],F=this.runWebGLProgram(g,[C],r,k,!0),$=this.texData.get(F.dataId);t.texShape=$.texShape,t.isPacked=$.isPacked,t.usage=$.usage,Re().get("ENGINE_COMPILE_ONLY")?this.disposeData(F.dataId):(t.texture=$.texture,t.values=null,this.texData.delete(F.dataId)),this.disposeIntermediateTensorInfo(C),u&&(this.uploadWaitMs+=Gi()-d)}else{const m=this.acquireTexture(p,l,r,c);t.texture=m}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=s5e(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${a} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Av(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(a){throw a}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await F$(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(YL(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:a,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:c}=XG(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=a,e.outShapeLocation=o,e.outShapeStridesLocation=l,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:a,width:o,channels:l}=e,c=Qc().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=c.writeTexture(r,t,s,a,o,l);return Qc().makeTensorFromDataId(u,t,s,c)}}lx.nextDataId=0;function s5e(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}const gq="4.11.0";function yq(){Re().set("WEBGL_FORCE_F16_TEXTURES",!0)}lD()&&gD("webgl",()=>new lx,2);const r5e={forceHalfFloat:yq};const iF=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Wm{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Sn(t,s),this.enableShapeUniforms=ga(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}const pg=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class $y{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Sn(t,s);const a=this.outputShape.length;this.enableShapeUniforms=ga(a);let o="";if(r)if(a===0||We(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Es(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=Oa("coords",a);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${c[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${c[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${c[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${c[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}function Yo(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const i5e={kernelName:P1,backendName:"webgl",kernelFunc:Yo};function hp(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,a=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(a.dataId),l=Yo({inputs:{x:s},backend:t}),c=Yo({inputs:{x:r},backend:t});return o.complexTensorInfos={real:l,imag:c},a}const a5e={kernelName:dk,backendName:"webgl",kernelFunc:hp};const bq="return (a < 0.) ? b * a : a;",vq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function o5e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:a}=s,o=t.makeTensorInfo([],"float32",Od(a,"float32")),l=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $y(vq,r.shape,o.shape):new Wm(bq,r.shape,o.shape),c=t.runWebGLProgram(l,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),c}const l5e={kernelName:Ww,backendName:"webgl",kernelFunc:o5e};const wq="return (a < 0.) ? b * a : a;",xq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function c5e(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,a=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $y(xq,s.shape,r.shape):new Wm(wq,s.shape,r.shape);return t.runWebGLProgram(a,[s,r],"float32")}const u5e={kernelName:c2,backendName:"webgl",kernelFunc:c5e};const Ry="if (isnan(x)) return x;";function ss({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:a})=>{const{x:o}=r,l=a,c=s||o.dtype;if(l.shouldExecuteOnCPU([o])&&t!=null){const p=l.texData.get(o.dataId),m=t(p.values,c);return l.makeTensorInfo(o.shape,c,m)}const u=Re().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new Ff(o.shape,e):d=new ah(o.shape,n),l.runWebGLProgram(d,[o],c)}}function ra({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:a}){return({inputs:o,backend:l})=>{const{a:c,b:u}=o,d=l;if(s&&c.dtype==="complex64"){const b=d.texData.get(c.dataId),v=d.texData.get(u.dataId),[x,S]=[[b.complexTensorInfos.real,v.complexTensorInfos.real],[b.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(A=>{const[k,O]=A,F={dataId:k.dataId,dtype:k.dtype,shape:c.shape},$={dataId:O.dataId,dtype:O.dtype,shape:u.shape},M=new Wm(n,c.shape,u.shape);return d.runWebGLProgram(M,[F,$],lo(k.dtype,O.dtype))}),C=hp({inputs:{real:x,imag:S},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(S),C}const p=a||lo(c.dtype,u.dtype);if((c.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([c,u]))&&r!=null){const b=d.texData.get(c.dataId).values,v=d.texData.get(u.dataId).values,x=c.dtype==="string"?Td(b):b,S=c.dtype==="string"?Td(v):v,[C,A]=r(c.shape,u.shape,x,S,p),k=d.makeTensorInfo(A,p),O=d.texData.get(k.dataId);return O.values=C,k}const m=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return m?g=new $y(e,c.shape,u.shape,t):g=new Wm(n,c.shape,u.shape),d.runWebGLProgram(g,[c,u],p)}}function Hv(n,e=!1){if(n==="linear")return e?WAe:zAe;if(n==="relu")return e?GAe:jAe;if(n==="elu")return e?HAe:BAe;if(n==="relu6")return e?qAe:UAe;if(n==="prelu")return e?xq:wq;if(n==="leakyrelu")return e?vq:bq;if(n==="sigmoid")return e?XAe:VAe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}class Sq{constructor(e,t,s,r=!1,a=!1,o=!1,l=null,c=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ga(this.outputShape.length);const d=r?e[1]:e[2],p=Math.ceil(d/2),m=r?"i * 2, rc.y":"rc.y, i * 2",g=a?"rc.z, i * 2":"i * 2, rc.z",b=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",S="";l&&(c?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${l}
        }`:u?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${l}
        }`:x=`vec4 activation(vec4 x) {
          ${l}
        }`,S="result = activation(result);");const C=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let A="rc.x",k="rc.x";e[0]<t[0]?A=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(k=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${A};
        int batchB = ${k};
        for (int i = 0; i < ${p}; i++) {
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${b[0]} * ${v[0]});
          result += (${b[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${S}

        setOutput(result);
      }
    `}}const WB={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class HB{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Sn(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}const GB="return a * b;";function aF(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,a=lo(s.dtype,r.dtype);if(s.dtype==="complex64"){const l=t.texData.get(s.dataId),c=t.texData.get(r.dataId),u=new HB(WB.REAL,s.shape,r.shape),d=new HB(WB.IMAG,s.shape,r.shape),p=[{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],m=t.runWebGLProgram(u,p,"float32"),g=t.runWebGLProgram(d,p,"float32"),b=hp({inputs:{real:m,imag:g},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),b}if(t.shouldExecuteOnCPU([s,r])){const l=t.texData.get(s.dataId),c=t.texData.get(r.dataId),[u,d]=lAe(s.shape,r.shape,l.values,c.values,a),p=t.makeTensorInfo(d,a),m=t.texData.get(p.dataId);return m.values=u,p}let o;return Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new $y(GB,s.shape,r.shape):o=new Wm(GB,s.shape,r.shape),t.runWebGLProgram(o,[s,r],a)}const h5e={kernelName:q1,backendName:"webgl",kernelFunc:aF};function d5e(n,e,t){const s=[Um(n.shape),...Vm(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},a=[Um(e),...Vm(e)],o=new mq(a,s),l=!0,c=[s],u=t.runWebGLProgram(o,[r],n.dtype,c,l);return{dataId:u.dataId,shape:e,dtype:u.dtype}}function gt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:a}=s,o=t,l=We(r.shape),c=tD(a,l),u=We(c);ee(l===u,()=>`The new shape (${c}) has ${u} elements and the old shape (${r.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!Wv(r.shape,c)&&!(d.texture!==null&&Wv(d.shape,c))?d5e(r,c,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const f5e={kernelName:h2,backendName:"webgl",kernelFunc:gt};class qB{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:a,outSize:o}=e;this.outputShape=[r,o];const l=Math.floor(s/4)*4,c=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const p=1/t;u=`sumValue += dot(values * ${Nm(p)?p.toPrecision(2):p}, ones);`}let d="";a%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${l}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${l};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}class p5e{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:a,outSize:o}=e;this.outputShape=[r,o];let l="0.0",c="";t==="prod"?l="1.0":t==="min"?(l="1.0 / 1e-20",c="min"):t==="max"&&(l="-1.0 / 1e-20",c="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,p=s%4;let m=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(l="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(l="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let b="";a%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${l};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${b}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${l});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${p===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${p===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${p===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}function m5e(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=ZT(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function mg(n,e,t,s){const r=m5e(n.shape);let a=n;for(let o=0;o<r.length;o++){const{inSize:l,windowSize:c,outSize:u}=r[o];let d,p;t==="mean"?d=o===0?new qB({windowSize:c,inSize:l,batchSize:n.shape[0],outSize:u},l):new qB({windowSize:c,inSize:l,batchSize:n.shape[0],outSize:u}):d=new p5e({windowSize:c,inSize:l,batchSize:n.shape[0],outSize:u},t),p=a,a=s.runWebGLProgram(d,[a],e),p.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(p)}return a}class g5e{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=Es(this.rank),a=y5e(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}}function y5e(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}class b5e{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Es(this.rank),a=pq("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=a[d];const l=`vec2(${o.slice(-2).join()})`,c=`++${a[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${l})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${c}) {
        result[1] = ${u};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${c}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}function CN(n,e,t){const s=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new b5e(n.shape,e):new g5e(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}function v5e(n,e,t,s){const r=e,a=n.shape.length,o=Fn(r,n.shape);let l=o;const c=yr(l,a),u=c!=null;let d=n;u&&(d=CN(n,c,s),l=Br(l.length,a)),na("sum",l,a);const[p,m]=Fi(d.shape,l);let g=p;t&&(g=zr(p,o));const b=We(m),x=We(n.shape)/b,S=gt({inputs:{x:d},attrs:{shape:[x,b]},backend:s}),C=dT(n.dtype),A=mg(S,C,"sum",s),k=gt({inputs:{x:A},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(A),u&&s.disposeIntermediateTensorInfo(d),k}function _N(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s;return v5e(r,a,o,t)}const w5e={kernelName:y2,backendName:"webgl",kernelFunc:_N};function La(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:a}=s,o=t,l=r.shape.length,c=new Array(l);for(let d=0;d<c.length;d++)c[d]=r.shape[a[d]];let u;if(o.shouldExecuteOnCPU([r])){const p=o.texData.get(r.dataId).values,m=rF(p,r.shape,r.dtype,a,c);u=o.makeTensorInfo(c,r.dtype);const g=o.texData.get(u.dataId);g.values=m}else u=CN(r,a,o);return u}const x5e={kernelName:mm,backendName:"webgl",kernelFunc:La};const Cq=1e3;function C_({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}){const u=n.shape.length,d=e.shape.length,p=t?n.shape[u-2]:n.shape[u-1],m=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],b=s?e.shape[d-2]:e.shape[d-1],v=n.shape.slice(0,-2),x=e.shape.slice(0,-2),S=We(v),C=We(x),k=Sn(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,b]);ee(p===m,()=>`Error in matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const O=t?[S,p,g]:[S,g,p],F=s?[C,b,m]:[C,m,b],$=gt({inputs:{x:n},backend:r,attrs:{shape:O}}),M=gt({inputs:{x:e},backend:r,attrs:{shape:F}}),R=[$,M],z=Math.max(S,C),I=t?$.shape[1]:$.shape[2],j=a!=null,H=o!=null,q=c==="leakyrelu",re=c!=null?Hv(c,!0):null,X=j||H||q||re!=null;let ne;if((g===1||b===1)&&I>Cq&&X===!1){let he=$,ye=M;t&&(he=La({inputs:{x:$},backend:r,attrs:{perm:[0,2,1]}}),R.push(he)),s&&(ye=La({inputs:{x:M},backend:r,attrs:{perm:[0,2,1]}}),R.push(ye));const Y=b!==1,B=b===1;let G=he;Y&&(G=gt({inputs:{x:he},backend:r,attrs:{shape:[z,I,1]}}),R.push(G));const J=b===1?2:1;let oe=ye;B&&(oe=gt({inputs:{x:ye},backend:r,attrs:{shape:[z,1,I]}}),R.push(oe));const de=aF({inputs:{a:G,b:oe},backend:r});ne=_N({inputs:{x:de},backend:r,attrs:{axis:J,keepDims:!0}}),R.push(de)}else{const he=lo(n.dtype,e.dtype),ye=new Sq(O,F,[z,g,b],t,s,j,re,H,q),Y=[$,M];if(a!=null&&Y.push(a),H&&Y.push(o),q){const B=r.makeTensorInfo([],"float32",Od(l,"float32"));Y.push(B),R.push(B)}ne=r.runWebGLProgram(ye,Y,he)}const Q=gt({inputs:{x:ne},backend:r,attrs:{shape:k}});R.push(ne);for(const he of R)r.disposeIntermediateTensorInfo(he);return Q}function S5e(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:a,bias:o,preluActivationWeights:l}=e,{transposeA:c,transposeB:u,activation:d,leakyreluAlpha:p}=s;return C_({a:r,b:a,transposeA:c,transposeB:u,backend:t,bias:o,preluActivationWeights:l,leakyreluAlpha:p,activation:d})}const C5e={kernelName:Ev,backendName:"webgl",kernelFunc:S5e};const XB="return abs(x);";function _5e(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const a=t.texData.get(s.dataId),o=dq(a.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return Re().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ff(s.shape,XB):r=new ah(s.shape,XB),t.runWebGLProgram(r,[s],s.dtype)}const k5e={kernelName:Sw,backendName:"webgl",kernelFunc:_5e};const T5e=vc+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,N5e=ss({opSnippet:T5e}),A5e={kernelName:b1,backendName:"webgl",kernelFunc:N5e};const E5e=vc+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,I5e=ss({opSnippet:E5e}),O5e={kernelName:v1,backendName:"webgl",kernelFunc:I5e};const YB="return a + b;",D5e=ra({opSnippet:YB,packedOpSnippet:YB,supportsComplex:!0,cpuKernelImpl:jNe}),$5e={kernelName:rg,backendName:"webgl",kernelFunc:D5e};class R5e{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((a,o)=>`T${o}`);const s=[];this.variableNames.forEach(a=>{s.push(`float v${a} = get${a}AtOutCoords();`)});const r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}class L5e{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((a,o)=>`T${o}`);const s=[];this.variableNames.forEach(a=>{s.push(`vec4 v${a} = get${a}AtOutCoords();`)});const r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}function pC(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Yo({inputs:{x:s[0]},backend:t});if(s.length>Re().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),u=pC({inputs:s.slice(0,c),backend:t}),d=pC({inputs:s.slice(c),backend:t});return pC({inputs:[u,d],backend:t})}const r=s.map(c=>c.dtype).reduce((c,u)=>lo(c,u)),a=s.map(c=>c.shape),l=Re().getBool("WEBGL_PACK")?new L5e(s[0].shape,a):new R5e(s[0].shape,a);return t.runWebGLProgram(l,s,r)}const F5e={kernelName:Cw,backendName:"webgl",kernelFunc:pC};function M5e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s,l=r.shape.length,c=Fn(a,r.shape);let u=c;const d=yr(u,l);let p=r;d!=null&&(p=La({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Br(u.length,l)),na("all",u,l);const[m,g]=Fi(p.shape,u),b=We(g),v=gt({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),x=mg(v,v.dtype,"all",t);let S;if(o){const C=zr(m,c);S=gt({inputs:{x},backend:t,attrs:{shape:C}})}else S=gt({inputs:{x},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(p),S}const P5e={kernelName:ak,backendName:"webgl",kernelFunc:M5e};function z5e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s,l=r.shape.length,c=Fn(a,r.shape);let u=c;const d=yr(u,l);let p=r;d!=null&&(p=La({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Br(u.length,l)),na("any",u,l);const[m,g]=Fi(p.shape,u),b=We(g),v=gt({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),x=mg(v,v.dtype,"any",t);let S;if(o){const C=zr(m,c);S=gt({inputs:{x},backend:t,attrs:{shape:C}})}else S=gt({inputs:{x},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(p),S}const B5e={kernelName:ok,backendName:"webgl",kernelFunc:z5e};class j5e{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];const l=t==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${l} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}class U5e{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ee(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const a=e[e.length-1],o=Math.ceil(a/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const l=this.outputShape,c=l.length,u=Es(c),d=Oa("coords",c);let p,m;if(o===1){m=c+1;const M=Es(m);p=`
        ${M} sourceLocR = ${M}(${d.join()}, 0);
        ++${d[c-1]};
        ${M} sourceLocG = ${M}(${d.join()}, 0);
        ++${d[c-2]};
        ${M} sourceLocA = ${M}(${d.join()}, 0);
        --${d[c-1]};
        ${M} sourceLocB = ${M}(${d.join()}, 0);
        --${d[c-2]};`}else m=c,p=`
        ${u} sourceLocR = coords;
        ++${d[c-1]};
        ${u} sourceLocG = coords;
        ++${d[c-2]};
        ${u} sourceLocA = coords;
        --${d[c-1]};
        ${u} sourceLocB = coords;
        --${d[c-2]};`;const g=["x","y","z","w","u","v"].slice(0,m),b="."+g[m-1],v=g.map(M=>"int "+M),x=Oa("sourceLocR",m-1).concat("inIdx.r"),S=Oa("sourceLocG",m-1).concat("inIdx.g"),C=Oa("sourceLocB",m-1).concat("inIdx.b"),A=Oa("sourceLocA",m-1).concat("inIdx.a"),k=s==="max"?"greaterThan":"lessThan",O=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${S.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${A.join()})));`,F=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${S.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${A.join()}) : 0.)`,$=r?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${$}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[c-1]} < ${l[c-1]-1};
        bool hasNextRow = ${d[c-2]} < ${l[c-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${b}, sourceLocG${b},
          sourceLocB${b}, sourceLocA${b}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${F};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${O}
          vec4 candidate = ${F};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}function _q(n,e,t,s=null){let r=e.shape[0],a=e.shape[1];s!=null&&(r=s.shape[0],a=s.shape[1]);const o=ZT(a),l={windowSize:o,inSize:a,batchSize:r,outSize:Math.ceil(a/o)},c=new j5e(l,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(c,u,"int32");if(d.shape[1]===1)return d;const p=_q(n,e,t,d);return n.disposeIntermediateTensorInfo(d),p}function kq(n,e,t,s=null){const r=s!=null?s.shape:e.shape,a=r[r.length-1],o=ZT(a),l=new U5e(r,o,t,s==null),c=s==null?[e]:[e,s],u=n.runWebGLProgram(l,c,"int32");if(u.shape.length===e.shape.length){const d=kq(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function Tq(n,e,t,s){const r=[t];if(na("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!Re().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const a=[],o=n.texData.get(e.dataId),l=o!==null&&o.isPacked;let c=e;l&&(c=n.unpackTensor(e),a.push(c));const[u,d]=Fi(c.shape,r),p=We(d),m=gt({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}});a.push(m);const g=_q(n,m,s);a.push(g);const b=gt({inputs:{x:g},backend:n,attrs:{shape:u}});return a.forEach(v=>n.disposeIntermediateTensorInfo(v)),b}return kq(n,e,s)}function V5e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a}=s;let o=Fn(a,r.shape);const l=yr(o,r.shape.length);let c=r;const u=[];l!=null&&(c=La({inputs:{x:r},backend:t,attrs:{perm:l}}),u.push(c),o=Br(o.length,c.shape.length)),na("argMax",[o[0]],c.shape.length);const d=Tq(t,c,o[0],"max");return u.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}const W5e={kernelName:_w,backendName:"webgl",kernelFunc:V5e};function H5e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a}=s;let o=Fn(a,r.shape);const l=yr(o,r.shape.length);let c=r;const u=[];l!=null&&(c=La({inputs:{x:r},backend:t,attrs:{perm:l}}),u.push(c),o=Br(o.length,c.shape.length)),na("argMin",[o[0]],c.shape.length);const d=Tq(t,c,o[0],"min");return u.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}const G5e={kernelName:kw,backendName:"webgl",kernelFunc:H5e};const q5e=vc+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,X5e=ss({opSnippet:q5e}),Y5e={kernelName:w1,backendName:"webgl",kernelFunc:X5e};const K5e=vc+"return log(x + sqrt(x * x + 1.0));",Z5e=ss({opSnippet:K5e}),J5e={kernelName:x1,backendName:"webgl",kernelFunc:Z5e};const Q5e=vc+`
  return atan(x);
`,eEe=ss({opSnippet:Q5e}),tEe={kernelName:S1,backendName:"webgl",kernelFunc:eEe};const nEe=iF+`
  return atan(a, b);
`,sEe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,rEe=ra({opSnippet:nEe,packedOpSnippet:sEe}),iEe={kernelName:_1,backendName:"webgl",kernelFunc:rEe};const aEe=vc+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,oEe=ss({opSnippet:aEe}),lEe={kernelName:C1,backendName:"webgl",kernelFunc:oEe};class Gv{constructor(e,t,s,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,S=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(v||(C="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${l}, ${c});
        const ivec2 pads = ivec2(${g}, ${b});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?a?x:S:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const A="max";let k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");const O=Math.floor(o/4)*4,F=o%4,$=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${A}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${g}, ${b});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${O}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${$}
          }

          int xC = xCCorner + ${O};
          if (${F===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${F===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${F===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${$}
          }
        }
        setOutput(${k});
      }
    `}}class oF{constructor(e,t,s,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,l=e.strideDepth,c=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,p=e.dilationHeight,m=e.dilationWidth,g=e.effectiveFilterDepth,b=e.effectiveFilterHeight,v=e.effectiveFilterWidth,x=e.padInfo.front,S=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const A=t==="avg";let k="0.0";if(A||(k="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${l}, ${c}, ${u});
        const ivec3 pads = ivec3(${x}, ${S}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${b};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${b} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const O="max";let F=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(F="avgValue / max(count, 1.0)");const $=Math.floor(o/4)*4,M=o%4,R=`
      if (${A}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${O}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${l}, ${c}, ${u});
      const ivec3 pads = ivec3(${x}, ${S}, ${C});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${b};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${$}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${$};
            if (${M===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${M===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${M===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${F});
      }
    `}}function cEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ay(r,"avgPool");const{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=s,u=1;ee(ta(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=yc(r.shape,a,o,u,l,c);if(d.filterWidth===1&&d.filterHeight===1&&jn(d.inShape,d.outShape))return Yo({inputs:{x:r},backend:t});const p=new Gv(d,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const uEe={kernelName:Tw,backendName:"webgl",kernelFunc:cEe};function hEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:c,dataFormat:u}=s,d=[1,1,1],p=Dd(r.shape,a,o,d,l,c,u),m=new oF(p,"avg",!1);return t.runWebGLProgram(m,[r],"float32")}const dEe={kernelName:Nw,backendName:"webgl",kernelFunc:hEe};class fEe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=c-1-e.padInfo.top,p=u-1-e.padInfo.left,m=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${p});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${l}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class pEe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,a=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,b=p-1-e.padInfo.front,v=m-1-e.padInfo.top,x=g-1-e.padInfo.left,S=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${b}, ${v}, ${x});
      const float avgMultiplier = float(${S});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function mEe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a}=e,o=a,{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,p=[1,1,1],m=Dd(o.shape,l,c,p,u,d),g=new pEe(m);return t.runWebGLProgram(g,[r],o.dtype)}const gEe={kernelName:ck,backendName:"webgl",kernelFunc:mEe};function yEe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a}=e,o=a;Ay([r,a],"avgPoolGrad");const{filterSize:l,strides:c,pad:u}=s,d=yc(o.shape,l,c,1,u),p=new fEe(d);return t.runWebGLProgram(p,[r],o.dtype)}const bEe={kernelName:lk,backendName:"webgl",kernelFunc:yEe};function vEe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:a}=e,{transposeA:o,transposeB:l}=s;return C_({a:r,b:a,transposeA:o,transposeB:l,backend:t})}const wEe={kernelName:Aw,backendName:"webgl",kernelFunc:vEe};class xEe{constructor(e,t,s,r,a,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Sn(e,t),Sn(e,s);let l="0.0";r!=null&&(Sn(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let c="1.0";a!=null&&(Sn(e,a),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${l};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}class SEe{constructor(e,t,s,r,a,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Sn(e,t),Sn(e,s);let l="vec4(0.0)";r!=null&&(Sn(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let c="vec4(1.0)";a!=null&&(Sn(e,a),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${l};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}const CEe=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:a,offset:o,scale:l}=n;ee(r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ee(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ee(l==null||r.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);const u=[s,r,a];let d=null;o!=null&&(d=o.shape,u.push(o));let p=null;l!=null&&(p=l.shape,u.push(l));const m=Re().getBool("WEBGL_PACK_NORMALIZATION")?new SEe(s.shape,r.shape,a.shape,d,p,c):new xEe(s.shape,r.shape,a.shape,d,p,c);return e.runWebGLProgram(m,u,u[0].dtype)},_Ee={kernelName:jw,backendName:"webgl",kernelFunc:CEe};class kEe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Es(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=TEe(this.rank);let r;const a=e.map((o,l)=>`sourceLoc.${BI[l]} = start[${l}] + coords.${BI[l]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const BI=["x","y","z","w","u","v"];function TEe(n){if(n===1)return"sourceLoc";if(n<=6)return BI.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}class NEe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Es(this.rank),s=Oa("coords",this.rank),r=Oa("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${a})`,l=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,p)=>`start[${p}]`).join()});`:e.map((d,p)=>`${r[p]} = ${s[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${l}
        ${c}
        setOutput(result);
      }
    `}}function AEe(n,e,t,s){const r=s.texData.get(n.dataId),a=s.makeTensorInfo(t,n.dtype),o=s.texData.get(a.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let l=R$(e,Ht(n.shape));r.slice&&(l+=r.slice.flatOffset),o.slice={flatOffset:l,origDataId:r.slice&&r.slice.origDataId||n.dataId};const c=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,c+1),a}function Ly(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:a,size:o}=s,[l,c]=KT(r,a,o);if(O$(r,l,c),We(c)===0)return t.makeTensorInfo(c,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const p=t.texData.get(r.dataId),m=vAe(p.values,l,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,m)}const{isPacked:u}=t.texData.get(r.dataId),d=$$(r.shape,l,c);if(u||!d){const p=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NEe(c):new kEe(c),m=[l];return t.runWebGLProgram(p,[r],r.dtype,m)}return t.uploadToGPU(r.dataId),AEe(r,l,c,t)}const EEe={kernelName:g2,backendName:"webgl",kernelFunc:Ly};const IEe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:a,crops:o}=s;ee(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const l=a.reduce((C,A)=>C*A),c=H2(r.shape,a,l),u=G2(c.length,a.length),d=q2(r.shape,a,l),p=B$(o,a.length),m=j$(d,o,a.length),g=[],b=gt({inputs:{x:r},backend:t,attrs:{shape:c}}),v=La({inputs:{x:b},backend:t,attrs:{perm:u}}),x=gt({inputs:{x:v},backend:t,attrs:{shape:d}}),S=Ly({inputs:{x},backend:t,attrs:{begin:p,size:m}});return g.push(b),g.push(v),g.push(x),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),S},OEe={kernelName:Ew,backendName:"webgl",kernelFunc:IEe};function DEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:a}=e,{size:o}=s,l=t.readSync(r.dataId),c=t.readSync(a.dataId),u=hq(l,c,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,u)}const $Ee={kernelName:uk,backendName:"webgl",kernelFunc:DEe};const REe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,LEe=`
  return float(int(a.r) & int(b.r));
`;function FEe(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,a=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Re().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const c=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,p]=VNe(s.shape,r.shape,c,u,s.dtype),m=t.makeTensorInfo(p,s.dtype),g=t.texData.get(m.dataId);return g.values=d,m}let l;return a?l=new $y(REe,s.shape,r.shape,!1):l=new Wm(LEe,s.shape,r.shape),t.runWebGLProgram(l,[s,r],s.dtype)}const MEe={kernelName:Iw,backendName:"webgl",kernelFunc:FEe};function PEe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,a=t.readSync(s.dataId),o=t.readSync(r.dataId),l=Sn(Array.from(a),Array.from(o));return t.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const zEe={kernelName:hk,backendName:"webgl",kernelFunc:PEe};const BEe="return float(a != b);",Nq=ra({opSnippet:BEe,cpuKernelImpl:uAe,dtype:"bool"}),jEe={kernelName:r2,backendName:"webgl",kernelFunc:Nq};function cx(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Yo({inputs:{x:r.complexTensorInfos.real},backend:t})}const UEe={kernelName:Hk,backendName:"webgl",kernelFunc:cx};const VEe="return float(int(x));";function WEe(n,e){const t=new ah(n.shape,VEe),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}function jI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:a}=s;if(a==="complex64"){if(r.dtype==="complex64")return Yo({inputs:{x:r},backend:t});const o=Qr(r.shape),l=jI({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),c=hp({inputs:{real:l,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(l),c}if(r.dtype==="complex64"){const o=cx({inputs:{input:r},backend:t}),l=jI({inputs:{x:o},backend:t,attrs:{dtype:a}});return t.disposeIntermediateTensorInfo(o),l}if(!nD(r.dtype,a)){const o=Yo({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:a}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[l,c,u]=WNe(o,r.shape,r.dtype,a);return t.makeTensorInfo(l,c,u)}if(a==="int32")return WEe(r,t);if(a==="bool"){const o=t.makeTensorInfo([],"bool",$i("bool",1)),c=Nq({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${a}`)}const HEe={kernelName:k1,backendName:"webgl",kernelFunc:jI};const KB="return ceil(x);",GEe=ss({opSnippet:KB,packedOpSnippet:KB,cpuKernelImpl:HNe}),qEe={kernelName:T1,backendName:"webgl",kernelFunc:GEe};class XEe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}class YEe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}function KEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:a,clipValueMax:o}=s;let l;Re().getBool("WEBGL_PACK_CLIP")?l=new YEe(r.shape):l=new XEe(r.shape);const c=[[a],[o]];return t.runWebGLProgram(l,[r],r.dtype,c)}const ZEe={kernelName:N1,backendName:"webgl",kernelFunc:KEe};class JEe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}function ZB(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function QEe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),a=new JEe(s.shape),o=[ZB(s,r.complexTensorInfos.real),ZB(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(a,o,o[0].dtype)}const eIe={kernelName:Ow,backendName:"webgl",kernelFunc:QEe};class tIe{constructor(e){this.outputShape=[],this.outputShape=hh(e,1),this.variableNames=e.map((o,l)=>`T${l}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const l=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${l}));`)}const r=t.length,a=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}class nIe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hh(e,t);const s=this.outputShape,r=s.length,a=Es(r),o=Oa("coords",r),l=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((v,x)=>`T${x}`);const c=new Array(e.length-1);c[0]=e[0][t];for(let v=1;v<c.length;v++)c[v]=c[v-1]+e[v][t];const u=l[t],d=l.slice(-2),p=l.join();let m=`if (${u} < ${c[0]}) {
        return getChannel(
            getT0(${p}), vec2(${d.join()}));
        }`;for(let v=1;v<c.length;v++){const x=c[v-1];m+=`
        if (${u} < ${c[v]}  && ${u} >= ${c[v-1]}) {
          return getChannel(
            getT${v}(${PS(l,u,x)}),
            vec2(${PS(d,u,x)}));
        }`}const g=c.length,b=c[c.length-1];m+=`
        return getChannel(
          getT${g}(${PS(l,u,b)}),
          vec2(${PS(d,u,b)}));`,this.userCode=`
      float getValue(${l.map(v=>"int "+v)}) {
        ${m}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function PS(n,e,t){const s=n.indexOf(e);return n.map((a,o)=>o===s?`${a} - ${t}`:a).join()}function kN(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Yo({inputs:{x:r.complexTensorInfos.imag},backend:t})}const sIe={kernelName:Ok,backendName:"webgl",kernelFunc:kN};function sv(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(C=>cx({inputs:{input:C},backend:t})),b=n.map(C=>kN({inputs:{input:C},backend:t})),v=sv(g,e,t),x=sv(b,e,t),S=hp({inputs:{real:v,imag:x},backend:t});return g.forEach(C=>t.disposeIntermediateTensorInfo(C)),b.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(x),S}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(k=>{const F=[-1,We(k.shape.slice(e))];return gt({inputs:{x:k},backend:t,attrs:{shape:F}})}),b=g.map(k=>({vals:t.readSync(k.dataId),shape:k.shape})),v=hh(g.map(k=>k.shape),1),x=g[0].shape[0]===1,S=GNe(b,v,s,x),C=hh(n.map(k=>k.shape),e),A=t.makeTensorInfo(C,s,S);return g.forEach(k=>t.disposeIntermediateTensorInfo(k)),A}const a=n.filter(g=>We(g.shape)>0),o=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].shape.length>1;if(a.length===1){const g=o?new ah(n[0].shape,Nf):new Ff(n[0].shape,Nf);return t.runWebGLProgram(g,n,s)}const l=Re().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(a.length>l){const g=[];for(let v=0;v<a.length;v+=l){const x=a.slice(v,v+l);g.push(sv(x,e,t))}const b=sv(g,e,t);for(const v of g)t.disposeIntermediateTensorInfo(v);return b}if(o){const g=new nIe(a.map(b=>b.shape),e);return t.runWebGLProgram(g,a,s)}const{tensors2D:c,outShape:u}=rIe(a,e,t),d=new tIe(c.map(g=>g.shape)),p=t.runWebGLProgram(d,c,s);c.forEach(g=>t.disposeIntermediateTensorInfo(g));const m=gt({inputs:{x:p},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(p),m}function rIe(n,e,t){const s=hh(n.map(a=>a.shape),e);return{tensors2D:n.map(a=>gt({inputs:{x:a},attrs:{shape:[-1,We(a.shape.slice(e))]},backend:t})),outShape:s}}function Aq(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,a=Fn(r,e[0].shape)[0],o=e.map(u=>u.shape);M$(o,a);const l=hh(e.map(u=>u.shape),a);if(We(l)===0)return t.makeTensorInfo(l,e[0].dtype,[]);const c=e.filter(u=>We(u.shape)>0);return c.length===1?Yo({inputs:{x:c[0]},backend:t}):sv(c,a,t)}const iIe={kernelName:Dw,backendName:"webgl",kernelFunc:Aq};class Eq{constructor(e,t=!1,s=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,l=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,m=e.filterHeight,g=e.filterWidth,b=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,x=e.dataFormat==="channelsLast",S=x?1:2,C=x?2:3,A=x?3:1;let k="",O="";s&&(r?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:a?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:k=`
          float activation(float x) {
            ${s}
          }
        `,O="result = activation(result);");const F=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${c}, ${u});
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${A}];

        ivec2 xRCCorner =
            ivec2(coords[${S}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${b}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${b}) *
                    getW(wR, wC, ${b}, d2);
              } else {
                dotProd +=
                    getX(batch, ${b}, xR, xC) *
                    getW(wR, wC, ${b}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2),
                getW(wR, wC, ${b} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1),
                  getX(batch, xR, xC, ${b} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC),
                  getX(batch, ${b} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${F}
        ${O}
        setOutput(result);
      }
    `}}class aIe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,p=e.filterDepth,m=e.filterHeight,g=e.filterWidth,b=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${o}, ${l});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${b}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${b}) *
                  getW(wF, wR, wC, ${b}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1),
                  getX(batch, xF, xR, xC, ${b} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2),
                  getW(wF, wR, wC, ${b} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Iq{constructor(e,t=!1,s=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ga(this.outputShape.length);const o=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,p=d;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)m+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;m+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)m+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(p+1)/2;x++){const S=x*2;if(m+=`
           xC = xCCorner + ${S*c};
           `,l===1){if(S<d&&(o%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }
               `,c===1&&S>0?m+=`
                 xC${S} = vec4(xTexelC${S-2}.zw, xTexelC${S}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${S} = vec4(previous.zw, xTexelC${S}.xy);
                   } else {
                     xC${S} = vec4(0.0, 0.0, xTexelC${S}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 xC${S} = xTexelC${S};
                 `,S+1<d)){const C=o%2===0?rk(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                     xTexelC${S+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${S+1}.zw = vec2(0.0);
                     }
                     xTexelC${S+1}Ready = 1;
                   }
                   `,c>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${S+1} = vec4(previous.zw, xTexelC${S+1}.xy);
                     } else {
                      xC${S+1} = vec4(0.0, 0.0, xTexelC${S+1}.xy);
                     }
                     `:m+=`
                     xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.xy);
                     `):C===1?m+=`
                     xC${S+1} = xTexelC${S};
                     `:m+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                       xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${S+1}.zw = vec2(0.0);
                       }
                       xTexelC${S+1}Ready = 1;
                     }

                     xC${S+1} = xTexelC${S+1};
                     `}}else S<d&&(o%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${S+1}Ready == 0) {
                   xTexelC${S+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${S+1}.zw = vec2(0.0);
                   }
                   xTexelC${S+1}Ready = 1;
                 }

                 xC${S} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
               `,S+1<d&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${S+1} = vec4(xTexelC${S+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                   xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S+1}.zw = vec2(0.);
                   }
                   xTexelC${S+1}Ready = 1;
                 }

                 xC${S} = vec4(
                   xTexelC${S}.xy, xTexelC${S+1}.xy);
               `,S+1<d&&(m+=`
                   xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
                 `)));S<d&&(m+=`
             wTexel = getW(r, ${S}, d1, d2);
             dotProd += xC${S}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${S}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,S+1<d&&(m+=`
               wTexel = getW(r, ${S+1}, d1, d2);
               dotProd += xC${S+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${S+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let g="",b="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:a?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,b="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${b}
         setOutput(result);
       }
     `}}class oIe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ga(this.outputShape.length);const{dataFormat:s}=t,r=Pa(),a=s==="channelsLast",o=a?1:2,l=a?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let p=0;p<=1;p++)u+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${d};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${l}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}function __(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function Oq({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}){const c=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,p=c[0]*c[1]*c[2],m=t.outChannels,g=t.dataFormat==="channelsLast",b=!1,v=!1;let x;const S=[];if(a!=null){const k=__(a.shape,g);k!=null&&(a=gt({inputs:{x:a},backend:s,attrs:{shape:k}}),S.push(a))}if(r!=null){const k=__(r.shape,g);k!=null&&(r=gt({inputs:{x:r},backend:s,attrs:{shape:k}}),S.push(r))}if(!((p===1||m===1)&&d>Cq)&&u.isPacked&&g&&u.texture!=null&&c[2]%2!==0&&jn(u.shape.slice(-3),c.slice(-3))){const k=c[0]*c[1]*(c[2]+1),O={dataId:n.dataId,shape:[1,k,t.inChannels],dtype:n.dtype},F=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,ee(Wv(u.shape,O.shape),()=>`packed reshape ${u.shape} to ${O.shape} isn't free`);const $=gt({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});S.push($);const M=C_({a:O,b:$,backend:s,transposeA:b,transposeB:v,bias:r,activation:l,preluActivationWeights:a,leakyreluAlpha:o}),R=s.texData.get(M.dataId);ee(R.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=F,R.shape=t.outShape,x=Yo({inputs:{x:M},backend:s}),x.shape=t.outShape,S.push(M)}else{const k=t.outHeight*t.outWidth,O=gt({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,k,t.inChannels]:[t.batchSize,t.inChannels,k]}}),F=gt({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),$=C_({a:g?O:F,b:g?F:O,transposeA:!g,transposeB:v,backend:s,bias:r,activation:l,preluActivationWeights:a,leakyreluAlpha:o});x=gt({inputs:{x:$},backend:s,attrs:{shape:t.outShape}}),S.push(O),S.push(F),S.push($)}for(const k of S)s.disposeIntermediateTensorInfo(k);return x}function Dq({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}){const{filterWidth:c,filterHeight:u,inChannels:d,outWidth:p,outHeight:m,dataFormat:g}=t,b=g==="channelsLast",v=c*u*d,x=m*p,S=[t.batchSize,v,x],C=!0,A=!1,k=[];if(a!=null){const Q=__(a.shape,b);Q!=null&&(a=gt({inputs:{x:a},backend:s,attrs:{shape:Q}}),k.push(a))}if(r!=null){const Q=__(r.shape,b);Q!=null&&(r=gt({inputs:{x:r},backend:s,attrs:{shape:Q}}),k.push(r))}const O=gt({inputs:{x:e},backend:s,attrs:{shape:[1,v,We(e.shape)/v]}});k.push(O);const F=new oIe(S,t),$=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],M=s.runWebGLProgram(F,[n],"float32",$),R=gt({inputs:{x:M},backend:s,attrs:{shape:S}});k.push(M),k.push(R);const z=r!=null,I=a!=null,j=l==="leakyrelu",H=l?Hv(l,!0):null,q=new Sq(b?R.shape:O.shape,b?O.shape:R.shape,b?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],C,A,z,H,I,j),re=b?[R,O]:[O,R];if(r&&re.push(r),I&&re.push(a),j){const Q=s.makeTensorInfo([],"float32",Od(o,"float32"));re.push(Q),k.push(Q)}const X=s.runWebGLProgram(q,re,"float32"),ne=gt({inputs:{x:X},backend:s,attrs:{shape:t.outShape}});k.push(X);for(const Q of k)s.disposeIntermediateTensorInfo(Q);return ne}function lIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dataFormat:c,dilations:u,dimRoundingMode:d}=s,p=$d(c),m=Li(r.shape,a.shape,o,u,l,d,!1,p);let g;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=Oq({x:r,filter:a,convInfo:m,backend:t});else if(m.strideWidth<=2&&p==="channelsLast"&&Re().getBool("WEBGL_EXP_CONV")){const v=new Iq(m),x=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];g=t.runWebGLProgram(v,[r,a],"float32",x)}else if(Re().getBool("WEBGL_CONV_IM2COL"))g=Dq({x:r,filter:a,convInfo:m,backend:t});else{const v=new Eq(m);g=t.runWebGLProgram(v,[r,a],"float32")}const b=gt({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return t.disposeIntermediateTensorInfo(g),b}const cIe={kernelName:$w,backendName:"webgl",kernelFunc:lIe};class uIe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class hIe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=e.dataFormat==="channelsLast",l=t-1-e.padInfo.top,c=s-1-e.padInfo.left,u=o?1:2,d=o?2:3,p=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class dIe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,o=e.padInfo.top,l=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${a};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${l};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class fIe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,a=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function pIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:a}=e,{strides:o,pad:l,dataFormat:c,dimRoundingMode:u,filterShape:d}=s,p=$d(c),m=Li(r.shape,d,o,1,l,u,!1,p),g=new uIe(m);return t.runWebGLProgram(g,[r,a],"float32")}const mIe={kernelName:fk,backendName:"webgl",kernelFunc:pIe};class gIe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ga(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,a=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}function yIe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:a}=e,{inputShape:o,strides:l,pad:c,dataFormat:u,dimRoundingMode:d}=s,p=$d(u),m=Li(o,a.shape,l,1,c,d,!1,p);if(Re().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){const g=[[m.strideHeight,m.strideWidth]],b=new gIe(m);return t.runWebGLProgram(b,[r,a],"float32",g)}else{const g=new hIe(m);return t.runWebGLProgram(g,[r,a],"float32")}}const bIe={kernelName:Rw,backendName:"webgl",kernelFunc:yIe};function vIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dilations:c}=s,u=rp(r.shape,a.shape,o,c,l),d=new aIe(u);return t.runWebGLProgram(d,[r,a],"float32")}const wIe={kernelName:Lw,backendName:"webgl",kernelFunc:vIe};function xIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:a}=e,{strides:o,pad:l,filterShape:c}=s,u=rp(r.shape,c,o,1,l),d=new dIe(u);return t.runWebGLProgram(d,[r,a],"float32")}const SIe={kernelName:pk,backendName:"webgl",kernelFunc:xIe};function CIe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:a}=e,{pad:o,strides:l,inputShape:c}=s,u=rp(c,a.shape,l,1,o),d=new fIe(u);return t.runWebGLProgram(d,[r,a],"float32")}const _Ie={kernelName:mk,backendName:"webgl",kernelFunc:CIe};const kIe=Ry+`
  return cos(x);
`,TIe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${pg}
  return result;
`,NIe=ss({opSnippet:kIe,packedOpSnippet:TIe}),AIe={kernelName:A1,backendName:"webgl",kernelFunc:NIe};const EIe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,IIe=ss({opSnippet:EIe}),OIe={kernelName:E1,backendName:"webgl",kernelFunc:IIe};class DIe{constructor(e,t,s,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,l,c,u]=e,[d]=t,[p,m]=s;this.outputShape=[d,p,m,u];const g=r==="bilinear"?1:0,[b,v]=[`${l-1}.0`,`${c-1}.0`],[x,S,C]=p>1?[`${(l-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${b} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${b}`],[A,k,O]=m>1?[`${(c-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${A});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${S};
        float width_scale = ${k};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${b} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${O};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}const $Ie=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:a,boxInd:o}=e,{cropSize:l,method:c,extrapolationValue:u}=s,d=new DIe(r.shape,a.shape,l,c,u);return t.runWebGLProgram(d,[r,a,o],"float32")},RIe={kernelName:yk,backendName:"webgl",kernelFunc:$Ie};var qv;(function(n){n.Prod="*",n.Sum="+"})(qv||(qv={}));class JB{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,o=this.op===qv.Prod?"1.0":"0.0",l=s?o:`getX(${QB(a,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${c-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${c}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Es(a)} coords = getOutputCoords();
        int end = ${ej(a,"coords",this.op)};
        float val = ${l};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${ej(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${QB(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function QB(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function ej(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function $q(n,e,t,s,r,a){const o=e.shape.length,l=yr([s],o);let c=e;l!=null&&(c=La({inputs:{x:e},backend:t,attrs:{perm:l}}));const u=Br(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=c.shape[u];let p=Yo({inputs:{x:c},backend:t});for(let m=0;m<=Math.ceil(Math.log2(d))-1;m++){const g=new JB(n,c.shape,!1,a),b=[[m]],v=p;p=t.runWebGLProgram(g,[p],p.dtype,b),t.disposeIntermediateTensorInfo(v)}if(r){const m=new JB(n,c.shape,r,a),g=p;p=t.runWebGLProgram(m,[p],p.dtype),t.disposeIntermediateTensorInfo(g)}if(l!=null){const m=ip(l),g=La({inputs:{x:p},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(c),g}return p}function LIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,exclusive:o,reverse:l}=s;return $q(qv.Prod,r,t,a,o,l)}const FIe={kernelName:gk,backendName:"webgl",kernelFunc:LIe};function MIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,exclusive:o,reverse:l}=s;return $q(qv.Sum,r,t,a,o,l)}const PIe={kernelName:Fw,backendName:"webgl",kernelFunc:MIe};function zIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:a}=e,{size:o,binaryOutput:l}=s;if(r.shape.length===1){const c=t.readSync(r.dataId),u=t.readSync(a.dataId),d=hq(c,u,a.dtype,a.shape,o);return t.makeTensorInfo([o],a.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),u=t.bufferSync(a),d=UNe(c,u,o,l);return t.makeTensorInfo(d.shape,a.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const BIe={kernelName:bk,backendName:"webgl",kernelFunc:zIe};class jIe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}function UIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:a,dataFormat:o}=s,l=r.shape[0],c=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],p=c*a,m=u*a,g=d/(a*a),b=o==="NHWC"?[l,p,m,g]:[l,g,p,m],v=new jIe(b,a,o);return t.runWebGLProgram(v,[r],r.dtype)}const VIe={kernelName:vk,backendName:"webgl",kernelFunc:UIe};class Rq{constructor(e,t=!1,s=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ga(this.outputShape.length);const o=e.filterHeight,l=e.filterWidth,c=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:a?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${l}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${d}
        setOutput(result);
      }
    `}}class Lq{constructor(e,t=!1,s=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ga(this.outputShape.length);const o=e.outChannels/e.inChannels,l=e.padInfo.left,c=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,m=p;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let S=0;S<p;S++)g+=`
          vec4 xTexelC${S*2};
          int xTexelC${S*2}Ready;
          vec4 xTexelC${S*2+1};
          int xTexelC${S*2+1}Ready;
          vec4 xC${S};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let S=0;S<p;S++)g+=`
          xTexelC${S*2} = vec4(0.0);
          xTexelC${S*2}Ready = 0;
          xTexelC${S*2+1} = vec4(0.0);
          xTexelC${S*2+1}Ready = 0;
          xC${S} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let S=0;S<(m+1)/2;S++){const C=S*2;if(g+=`
          xC = xCCorner + ${C*u};
          `,c===1){if(C<p&&(l%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,u===1&&C>0?g+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<p)){const A=l%2===0?rk(u):u;u%2===0&&l%2===1||u%2!==0&&l%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${A};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:g+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):A===1?g+=`
                    xC${C+1} = xTexelC${C};
                    `:g+=`
                    xCOffset = xC + ${A};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<p&&(l%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<p&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<p&&(g+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<p&&(g+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<p&&(g+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let b="",v="";s&&(r?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:a?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:b=`vec4 activation(vec4 x) {
          ${s}
        }`,v="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${v}
        setOutput(result);
      }
    `}}function WIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dilations:c,dimRoundingMode:u}=s;let d=c;d==null&&(d=[1,1]),ee(ta(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const p=Li(r.shape,a.shape,o,d,l,u,!0);let m;Re().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?m=new Lq(p):m=new Rq(p);const g=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return t.runWebGLProgram(m,[r,a],"float32",g)}const HIe={kernelName:Mw,backendName:"webgl",kernelFunc:WIe};class GIe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qIe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.top,l=s-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function XIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:a}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:u,filterShape:d}=s,p=Li(r.shape,d,o,l,c,u,!0),m=new GIe(p);return t.runWebGLProgram(m,[r,a],"float32")}const YIe={kernelName:wk,backendName:"webgl",kernelFunc:XIe};function KIe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:a}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:u,inputShape:d}=s,p=Li(d,a.shape,o,l,c,u,!0),m=new qIe(p);return t.runWebGLProgram(m,[r,a],"float32")}const ZIe={kernelName:xk,backendName:"webgl",kernelFunc:KIe};class JIe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}function QIe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],a=We(s.shape),o=gt({inputs:{x:s},backend:t,attrs:{shape:[a]}}),l=new JIe(a),c=t.runWebGLProgram(l,[o],o.dtype),u=gt({inputs:{x:c},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(c),u}const eOe={kernelName:Sk,backendName:"webgl",kernelFunc:QIe};class tOe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:a,strideWidth:o,filterHeight:l,filterWidth:c,dilationHeight:u,dilationWidth:d}=e,{top:p,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${o});
      const ivec2 pads = ivec2(${p}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${l}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}function nOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a}=e,{strides:o,pad:l,dilations:c}=s,u=N2(r.shape,a.shape,o,l,"NHWC",c);let d;const p=new tOe(u);d=t.runWebGLProgram(p,[r,a],"float32");const m=gt({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),m}const sOe={kernelName:Pw,backendName:"webgl",kernelFunc:nOe};function rOe(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,a=e,{allDims:o,summedDims:l,idDims:c}=Y$(r,a.length);Z$(o.length,c,a);const{path:u,steps:d}=J$(l,c),p=d.length;let m=null,g=o.length;const b=[];for(let v=0;v<p;++v){for(const x of d[v]){const{permutationIndices:S,expandDims:C}=K$(g,c[x]);let A;Q$(S)?A=a[x]:(A=La({inputs:{x:a[x]},backend:t,attrs:{perm:S}}),b.push(A));const k=A.shape.slice();for(let O=0;O<C.length;++O)k.splice(C[O],0,1);jn(A.shape,k)||(A=gt({inputs:{x:A},backend:t,attrs:{shape:k}}),b.push(A)),m===null?m=A:(m=aF({inputs:{a:A,b:m},backend:t}),b.push(m))}v<p-1&&(u[v]>=0&&(m=_N({inputs:{x:m},backend:t,attrs:{axis:u[v]-(o.length-g),keepDims:!1}}),b.push(m)),g--)}for(const v of b)v!==m&&t.disposeIntermediateTensorInfo(v);return m}const iOe={kernelName:_k,backendName:"webgl",kernelFunc:rOe};const aOe="return (x >= 0.0) ? x : (exp(x) - 1.0);",oOe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,lOe=ss({opSnippet:aOe,packedOpSnippet:oOe}),cOe={kernelName:O1,backendName:"webgl",kernelFunc:lOe};const uOe="return (b >= 0.0) ? a : a * (b + 1.0);",hOe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,dOe=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,a=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $y(hOe,s.shape,r.shape):new Wm(uOe,s.shape,r.shape);return t.runWebGLProgram(a,[s,r],s.dtype)},fOe={kernelName:kk,backendName:"webgl",kernelFunc:dOe};const pOe=`
  return vec4(equal(a, b));
`,mOe="return float(a == b);",gOe=ra({opSnippet:mOe,packedOpSnippet:pOe,dtype:"bool",cpuKernelImpl:qNe}),yOe={kernelName:zw,backendName:"webgl",kernelFunc:gOe};const bOe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${U$};
  float a1 = ${V$};
  float a2 = ${W$};
  float a3 = ${H$};
  float a4 = ${G$};
  float a5 = ${q$};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,vOe=ss({opSnippet:bOe}),wOe={kernelName:D1,backendName:"webgl",kernelFunc:vOe};const xOe=Ry+`
  return exp(x);
`,SOe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Fq=ss({opSnippet:xOe,packedOpSnippet:SOe,cpuKernelImpl:XNe,dtype:"float32"}),COe={kernelName:$1,backendName:"webgl",kernelFunc:Fq};function UI(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:a}=e,o=a.shape.length,l=a.shape.slice();let c=r;return r<0&&(ee(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+r+1),l.splice(c,0,1),gt({inputs:{x:a},backend:s,attrs:{shape:l}})}const _Oe={kernelName:Bw,backendName:"webgl",kernelFunc:UI};const tj="return exp(x) - 1.0;",kOe=ss({opSnippet:tj,packedOpSnippet:tj,cpuKernelImpl:YNe}),TOe={kernelName:R1,backendName:"webgl",kernelFunc:kOe};class nj{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const a=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let l;if(e==="real")l="return real * expR - imag * expI;";else if(e==="imag")l="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${l}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}function Mq(n,e,t){const s=t.texData.get(n.dataId),r=We(n.shape),a=n.shape[n.shape.length-1],o=r/a,l=gt({inputs:{x:n},backend:t,attrs:{shape:[o,a]}}),c=l.shape,u=new nj("real",c,e),d=new nj("imag",c,e),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],m=t.runWebGLProgram(u,p,"float32"),g=t.runWebGLProgram(d,p,"float32"),b=hp({inputs:{real:m,imag:g},backend:t});t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g);const v=gt({inputs:{x:b},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(b),v}function NOe(n){const{inputs:e,backend:t}=n,{input:s}=e;return Mq(s,!1,t)}const AOe={kernelName:Tk,backendName:"webgl",kernelFunc:NOe};class EOe{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}function ux(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:a}=t;if(a=a||ng(r),a==="string"){const o=kr(a,We(s));return o.fill(r),e.makeTensorInfo(s,a,o)}else{const o=new EOe(s,r),l=[[r]];return e.runWebGLProgram(o,[],a,l)}}const IOe={kernelName:Nk,backendName:"webgl",kernelFunc:ux};class OOe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}const DOe={kernelName:Ak,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new OOe(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};const sj="return floor(x);",$Oe=ss({opSnippet:sj,packedOpSnippet:sj,cpuKernelImpl:KNe}),ROe={kernelName:L1,backendName:"webgl",kernelFunc:$Oe};const LOe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,FOe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,MOe=ra({opSnippet:LOe,packedOpSnippet:FOe,dtype:"int32"}),POe={kernelName:F1,backendName:"webgl",kernelFunc:MOe};class zOe{constructor(e){this.variableNames=["A"];const t=Pa(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}class BOe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Pa(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}const jOe={kernelName:e_,backendName:"webgl",kernelFunc:UOe};let d0,rE=Re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function UOe(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:a}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,c],p=[u,c,a];if(l||o){const v=Re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(d0==null||v!==rE)&&(rE=v,d0=document.createElement("canvas").getContext("2d",{willReadFrequently:rE})),d0.canvas.width=c,d0.canvas.height=u,d0.drawImage(r,0,0,c,u),r=d0.canvas}const m=t.makeTensorInfo(d,"int32");t.texData.get(m.dataId).usage=Tl.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),r);const g=Re().getBool("WEBGL_PACK")?new BOe(p):new zOe(p),b=t.runWebGLProgram(g,[m],"int32");return t.disposeData(m.dataId),b}function VOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a,bias:o,preluActivationWeights:l}=e,{strides:c,pad:u,dataFormat:d,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:b}=s,v=$d(d),x=Li(r.shape,a.shape,c,p,u,m,!1,v);let S;const C=[],A=o!=null,k=l!=null,O=g==="leakyrelu",F=()=>{const M=[r,a],R=(z,I)=>{if(I==="NCHW"&&z.shape.length===1&&z.shape[0]!==1){const j=gt({inputs:{x:z},backend:t,attrs:{shape:[z.shape[0],1,1]}});return C.push(j),j}return z};if(A&&M.push(R(o,d)),k&&M.push(R(l,d)),O){const z=t.makeTensorInfo([],"float32",Od(b,"float32"));M.push(z),C.push(z)}return M};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))S=Oq({x:r,filter:a,convInfo:x,backend:t,bias:o,activation:g,preluActivationWeights:l,leakyreluAlpha:b});else if(x.strideWidth<=2&&v==="channelsLast"&&Re().getBool("WEBGL_EXP_CONV")){const M=g?Hv(g,!0):null,R=new Iq(x,A,M,k,O),z=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],I=F();S=t.runWebGLProgram(R,I,"float32",z)}else if(Re().getBool("WEBGL_CONV_IM2COL"))S=Dq({x:r,filter:a,convInfo:x,backend:t,bias:o,activation:g,preluActivationWeights:l,leakyreluAlpha:b});else{const M=g?Hv(g,!1):null,R=new Eq(x,A,M,k,O),z=F();S=t.runWebGLProgram(R,z,"float32")}const $=gt({inputs:{x:S},backend:t,attrs:{shape:x.outShape}});return C.push(S),C.forEach(M=>t.disposeIntermediateTensorInfo(M)),$}const WOe={kernelName:Iv,backendName:"webgl",kernelFunc:VOe};function HOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:a,bias:o,preluActivationWeights:l}=e,{strides:c,pad:u,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:g}=s,b=[];let v=d;v==null&&(v=[1,1]),ee(ta(c,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${v}'`);const x=Li(r.shape,a.shape,c,v,u,p,!0),S=Re().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,C=m?Hv(m,S):null,A=[r,a],k=o!=null,O=l!=null,F=m==="leakyrelu";if(k&&A.push(o),O&&A.push(l),F){const z=t.makeTensorInfo([],"float32",Od(g,"float32"));A.push(z),b.push(z)}let $;S?$=new Lq(x,k,C,O,F):$=new Rq(x,k,C,O,F);const M=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],R=t.runWebGLProgram($,A,"float32",M);return b.forEach(z=>t.disposeIntermediateTensorInfo(z)),R}const GOe={kernelName:Ov,backendName:"webgl",kernelFunc:HOe};class qOe{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const a=Es(s.length);let o=`
    int index;`;for(let l=0;l<this.sliceDim;l++)o+=`
          index = round(getIndices(coords[0], ${l}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[l]};
          flattenIndex += index * ${this.strides[l]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}function XOe(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,a=r.shape,o=a[a.length-1],l=We(s.shape),[c,u,d,p]=YT(s,r),m=gt({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=gt({inputs:{x:s},backend:t,attrs:{shape:[We(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const S=t.readSync(r.dataId),C=t.bufferSync(s),A=ZNe(S,C,s.dtype,u,o,d,p,s.shape,l);return t.makeTensorInfo(c,s.dtype,A.values)}const b=new qOe(o,p,[u,d],s.shape),v=t.runWebGLProgram(b,[g,m],g.dtype),x=gt({inputs:{x:v},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(v),x}const YOe={kernelName:Ek,backendName:"webgl",kernelFunc:XOe};class KOe{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Es(this.rank),r=ZOe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function ZOe(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}function Pq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:a}=e,{axis:o,batchDims:l}=s,c=Fn(o,r.shape)[0];if(Re().get("DEBUG")){const C=t.readSync(a.dataId),A=r.shape[c];for(let k=0;k<C.length;++k){const O=C[k];ee(O<=A-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${A-1}]`)}}const u=tR(r,a,c,l),d=We(a.shape),p=[],m=gt({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=gt({inputs:{x:a},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});p.push(m),p.push(g);const b=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,a])||r.dtype==="string"){const C=t.bufferSync(g),A=t.bufferSync(m),k=JNe(A,C,b);return p.forEach(O=>t.disposeIntermediateTensorInfo(O)),t.makeTensorInfo(u.outputShape,k.dtype,k.values)}const v=new KOe(m.shape,b),x=t.runWebGLProgram(v,[m,g],m.dtype);p.push(x);const S=gt({inputs:{x},backend:t,attrs:{shape:u.outputShape}});return p.forEach(C=>t.disposeIntermediateTensorInfo(C)),S}const JOe={kernelName:Uw,backendName:"webgl",kernelFunc:Pq};const QOe="return float(a > b);",eDe=`
  return vec4(greaterThan(a, b));
`,tDe=ra({opSnippet:QOe,packedOpSnippet:eDe,cpuKernelImpl:QNe,dtype:"bool"}),nDe={kernelName:Vw,backendName:"webgl",kernelFunc:tDe};const sDe="return float(a >= b);",rDe=`
  return vec4(greaterThanEqual(a, b));
`,iDe=ra({opSnippet:sDe,packedOpSnippet:rDe,dtype:"bool",cpuKernelImpl:eAe}),aDe={kernelName:M1,backendName:"webgl",kernelFunc:iDe};function oDe(n){const{inputs:e,backend:t}=n,{input:s}=e;return Mq(s,!0,t)}const lDe={kernelName:Ik,backendName:"webgl",kernelFunc:oDe};const cDe="return float(!isnan(x) && !isinf(x));",uDe=ss({opSnippet:cDe,dtype:"bool"}),hDe={kernelName:z1,backendName:"webgl",kernelFunc:uDe};const dDe="return float(isinf(x));",fDe=ss({opSnippet:dDe,dtype:"bool"}),pDe={kernelName:B1,backendName:"webgl",kernelFunc:fDe};const mDe="return float(isnan(x));",gDe=ss({opSnippet:mDe,dtype:"bool"}),yDe={kernelName:j1,backendName:"webgl",kernelFunc:gDe};const bDe="return float(a < b);",vDe=`
  return vec4(lessThan(a, b));
`,wDe=ra({opSnippet:bDe,packedOpSnippet:vDe,cpuKernelImpl:tAe,dtype:"bool"}),xDe={kernelName:Hw,backendName:"webgl",kernelFunc:wDe};const SDe="return float(a <= b);",CDe=`
  return vec4(lessThanEqual(a, b));
`,_De=ra({opSnippet:SDe,packedOpSnippet:CDe,cpuKernelImpl:nAe,dtype:"bool"}),kDe={kernelName:Gw,backendName:"webgl",kernelFunc:_De};function TDe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:a}=t,o=sAe(s,r,a);return e.makeTensorInfo([o.length],"float32",o)}const NDe={kernelName:Dk,backendName:"webgl",kernelFunc:TDe};const ADe=Ry+`
  return x < 0.0 ? 0./0. : log(x);
`,EDe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,IDe=ss({opSnippet:ADe,packedOpSnippet:EDe,cpuKernelImpl:rAe}),ODe={kernelName:U1,backendName:"webgl",kernelFunc:IDe};const DDe=Ry+`
  return log(1.0 + x);
`,$De=ss({opSnippet:DDe}),RDe={kernelName:V1,backendName:"webgl",kernelFunc:$De};const LDe="return float(a >= 1.0 && b >= 1.0);",FDe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,MDe=ra({opSnippet:LDe,packedOpSnippet:FDe,dtype:"bool"}),PDe={kernelName:qw,backendName:"webgl",kernelFunc:MDe};const zDe="return float(!(x >= 1.0));",BDe=ss({opSnippet:zDe}),jDe={kernelName:Xw,backendName:"webgl",kernelFunc:BDe};const UDe="return float(a >= 1.0 || b >= 1.0);",VDe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,WDe=ra({opSnippet:UDe,packedOpSnippet:VDe,dtype:"bool"}),HDe={kernelName:Yw,backendName:"webgl",kernelFunc:WDe};class GDe{constructor(e,t,s,r,a){this.variableNames=["x"],this.outputShape=[];const o=t,l=e[3]-1;this.outputShape=e;let c;const u=`float(${s}) + float(${r}) * sum`;a===.5?c=`inversesqrt(${u})`:a===1?c=`1.0/(${u})`:c=`exp(log(${u}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${l}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}class qDe{constructor(e,t,s,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,l=e[3]-1;this.outputShape=e;let c;const u=`float(${s}) + float(${r}) * sum`;a===.5?c=`inversesqrt(${u})`:a===1?c=`1.0/(${u})`:c=`exp(log(${u}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${l}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}const XDe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:a,bias:o,alpha:l,beta:c}=s,u=Re().getBool("WEBGL_PACK_NORMALIZATION")?new qDe(r.shape,a,o,l,c):new GDe(r.shape,a,o,l,c);return t.runWebGLProgram(u,[r],r.dtype)},YDe={kernelName:Kw,backendName:"webgl",kernelFunc:XDe};class KDe{constructor(e,t,s,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${a})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}const ZDe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:a,dy:o}=e,{depthRadius:l,bias:c,alpha:u,beta:d}=s,p=new KDe(r.shape,l,c,u,d);return t.runWebGLProgram(p,[r,a,o],r.dtype)},JDe={kernelName:$k,backendName:"webgl",kernelFunc:ZDe};function QDe(n,e,t,s){const r=We(e),o=We(n.shape)/r,l=gt({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),c=mg(l,n.dtype,"max",s),u=gt({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(c),u}function zq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:a,keepDims:o}=s,l=r.shape.length,c=Fn(a,r.shape);let u=c;const d=yr(u,l),p=d!=null,m=t.shouldExecuteOnCPU([r]);let g=r;if(p){if(m){const A=t.texData.get(g.dataId).values,k=new Array(l);for(let $=0;$<k.length;$++)k[$]=r.shape[d[$]];const O=rF(A,r.shape,r.dtype,d,k);g=t.makeTensorInfo(k,r.dtype);const F=t.texData.get(g.dataId);F.values=O}else g=CN(r,d,t);u=Br(u.length,l)}na("max",u,l);const[b,v]=Fi(g.shape,u);let x=b;o&&(x=zr(b,c));let S;if(m){const A=t.texData.get(g.dataId).values,k=iAe(A,We(v),x,r.dtype);S=t.makeTensorInfo(x,r.dtype);const O=t.texData.get(S.dataId);O.values=k}else S=QDe(g,v,x,t);return p&&t.disposeIntermediateTensorInfo(g),S}const e$e={kernelName:Zw,backendName:"webgl",kernelFunc:zq};const t$e=iF+`
  return max(a, b);
`,n$e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,s$e=ra({opSnippet:t$e,packedOpSnippet:n$e,cpuKernelImpl:aAe}),r$e={kernelName:W1,backendName:"webgl",kernelFunc:s$e};function i$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ay(r,"maxPool");const{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=s,u=1;ee(ta(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=yc(r.shape,a,o,u,l,c);if(d.filterWidth===1&&d.filterHeight===1&&jn(d.inShape,d.outShape))return Yo({inputs:{x:r},backend:t});const p=new Gv(d,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const a$e={kernelName:Jw,backendName:"webgl",kernelFunc:i$e};function o$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=s,d=[1,1,1],p=Dd(r.shape,a,o,d,l,u,c),m=new oF(p,"max",!1);return t.runWebGLProgram(m,[r],r.dtype)}const l$e={kernelName:Qw,backendName:"webgl",kernelFunc:o$e};class c$e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,o=e.effectiveFilterWidth,l=a-1-e.padInfo.top,c=o-1-e.padInfo.left,u=a*o-1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class u$e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=c-1-e.padInfo.front,m=u-1-e.padInfo.top,g=d-1-e.padInfo.left,b=c*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${l}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${b} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function h$e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a}=e,o=a,{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,p=[1,1,1],m=Dd(o.shape,l,c,p,u,d),g=new oF(m,"max",!0),b=t.runWebGLProgram(g,[o],o.dtype),v=new u$e(m),x=t.runWebGLProgram(v,[r,b],o.dtype);return t.disposeIntermediateTensorInfo(b),x}const d$e={kernelName:Lk,backendName:"webgl",kernelFunc:h$e};function f$e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:a,output:o}=e,l=a;Ay([a,o],"maxPoolGrad");const{filterSize:c,strides:u,pad:d,dimRoundingMode:p}=s,m=yc(l.shape,c,u,1,d,p),g=!0,b=new Gv(m,"max",g),v=t.runWebGLProgram(b,[l],l.dtype),x=new c$e(m),S=t.runWebGLProgram(x,[r,v],l.dtype);return t.disposeIntermediateTensorInfo(v),S}const p$e={kernelName:Rk,backendName:"webgl",kernelFunc:f$e};function m$e(n,e,t,s){let r=new Gv(t,"max",!1);const a=s.runWebGLProgram(r,[n],"float32");r=new Gv(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[a,o]}const g$e={kernelName:Fk,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:a,pad:o,includeBatchInIndex:l}=e,c=t;ee(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];ee(ta(a,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${u}'`);const d=yc(s.shape,r,a,u,o),[p,m]=m$e(s,l,d,c);return[p,m]}};function y$e(n,e,t,s){const r=We(e),o=We(n.shape)/r,l=gt({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),c=mg(l,"float32","mean",s),u=gt({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(c),u}const b$e={kernelName:e2,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:a}=e,o=t,l=s.shape.length,c=Fn(a,s.shape);let u=c;const d=yr(u,l),p=d!=null,m=o.shouldExecuteOnCPU([s]),g=[];let b=s;if(p){if(m){const k=o.texData.get(b.dataId).values,O=new Array(l);for(let M=0;M<O.length;M++)O[M]=s.shape[d[M]];const F=rF(k,s.shape,s.dtype,d,O);b=o.makeTensorInfo(O,s.dtype);const $=o.texData.get(b.dataId);$.values=F}else b=CN(s,d,o);g.push(b),u=Br(u.length,l)}na("sum",u,l);const[v,x]=Fi(b.shape,u);let S=v;r&&(S=zr(v,c));const C=y$e(b,x,S,o);for(const A of g)o.disposeIntermediateTensorInfo(A);return C}};function v$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s,l=r.shape.length,c=Fn(a,r.shape);let u=c;const d=yr(u,l);let p=r;d!=null&&(p=La({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Br(u.length,r.shape.length)),na("min",u,l);const[m,g]=Fi(p.shape,u),b=We(g),v=gt({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),x=mg(v,v.dtype,"min",t);let S;if(o){const C=zr(m,c);S=gt({inputs:{x},backend:t,attrs:{shape:C}})}else S=gt({inputs:{x},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(p),S}const w$e={kernelName:t2,backendName:"webgl",kernelFunc:v$e};const x$e=iF+`
  return min(a, b);
`,S$e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,C$e=ra({opSnippet:x$e,packedOpSnippet:S$e,cpuKernelImpl:oAe}),_$e={kernelName:H1,backendName:"webgl",kernelFunc:C$e};class k$e{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,p)=>d[0]+e[p]+d[1]);const r=e.length,a=Es(r),o=t.map(d=>d[0]).join(","),l=t.map((d,p)=>d[0]+e[p]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${o});
      ${a} end = ${a}(${l});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}class T$e{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((b,v)=>b[0]+e[v]+b[1]);const r=e.length,a=Es(r),o=t.map(b=>b[0]).join(","),l=t.map((b,v)=>b[0]+e[v]).join(","),c=Oa("rc",r),u=Oa("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${u.slice(-2).join()})`,m=s==="reflect"?0:1;let g="";if(r===1){const b=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;g=`
        ${a} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${c[r-1]} += 1;
        if(${d}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
      `}else{const b=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;g=`
        ${a} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${c[r-1]} += 1;
        if(${d}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${b}
          result[2] = getChannel(getX(${u.join()}), ${p});
          ${c[r-1]} += 1;
          if(${d}) {
            ${b}
            result[3] = getChannel(getX(${u.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${o});
      const ${a} end = ${a}(${l});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}const N$e=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:a}=t,o=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new T$e(s.shape,r,a):new k$e(s.shape,r,a);return e.runWebGLProgram(o,[s],s.dtype)},A$e={kernelName:n2,backendName:"webgl",kernelFunc:N$e};const E$e=`if (b == 0.0) return NAN;
  return mod(a, b);`,I$e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+pg+`
  return result;
`,O$e=ra({opSnippet:E$e,packedOpSnippet:I$e}),D$e={kernelName:G1,backendName:"webgl",kernelFunc:O$e};class $$e{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}const R$e=`
if (a == b) {
  return 1.0;
};
return a / b;`,L$e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Bq=ra({opSnippet:R$e,packedOpSnippet:L$e,checkOutOfBounds:!0}),F$e={kernelName:I1,backendName:"webgl",kernelFunc:Bq};const rj="return a - b;",jq=ra({opSnippet:rj,packedOpSnippet:rj,supportsComplex:!0,cpuKernelImpl:AAe}),M$e={kernelName:ly,backendName:"webgl",kernelFunc:jq};function Uq(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:a}=s,o=Fn([a],r.shape),l=zq({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),c=zr(l.shape,o),u=gt({inputs:{x:l},backend:t,attrs:{shape:c}}),d=jq({inputs:{a:r,b:u},backend:t}),p=Fq({inputs:{x:d},backend:t}),m=_N({inputs:{x:p},backend:t,attrs:{axis:o,keepDims:!1}}),g=gt({inputs:{x:m},backend:t,attrs:{shape:c}}),b=Bq({inputs:{a:p,b:g},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),b}const P$e={kernelName:w2,backendName:"webgl",kernelFunc:Uq};function z$e(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:a,seed:o,normalized:l}=s,c=l?r:Uq({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=c.shape[0],d=c.shape[1],p=new $$e(u,d,a),m=[[o]],g=t.runWebGLProgram(p,[c],"int32",m);return l||t.disposeIntermediateTensorInfo(c),g}const B$e={kernelName:Mk,backendName:"webgl",kernelFunc:z$e};const j$e=vc+`
  return -x;
`,U$e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function V$e(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const a=t.texData.get(s.dataId),[o,l]=cAe(a.values,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,o)}let r;return Re().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ff(s.shape,U$e):r=new ah(s.shape,j$e),t.runWebGLProgram(r,[s],s.dtype)}const W$e={kernelName:s2,backendName:"webgl",kernelFunc:V$e};const H$e=HT;function G$e(n){xl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:a}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=s,u=t.readSync(r.dataId),d=t.readSync(a.dataId),{selectedIndices:p}=H$e(u,d,o,l,c);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}const q$e={kernelName:Pk,backendName:"webgl",kernelFunc:G$e};const X$e=GT;function Y$e(n){xl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:a}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),p=t.readSync(a.dataId),{selectedIndices:m,validOutputs:g}=X$e(d,p,o,l,c,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const K$e={kernelName:zk,backendName:"webgl",kernelFunc:Y$e};const Z$e=qT;function J$e(n){xl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:a}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:u}=s,d=t.readSync(r.dataId),p=t.readSync(a.dataId),m=o,g=l,b=c,v=u,{selectedIndices:x,selectedScores:S}=Z$e(d,p,m,g,b,v);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([S.length],"float32",new Float32Array(S))]}const Q$e={kernelName:Bk,backendName:"webgl",kernelFunc:J$e};class eRe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}const tRe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:a,depth:o,onValue:l,offValue:c}=s,u=We(r.shape),d=new eRe(u,o,l,c),p=gt({inputs:{x:r},backend:t,attrs:{shape:[u]}}),m=t.runWebGLProgram(d,[p],a);t.disposeIntermediateTensorInfo(p);const g=[...r.shape,o],b=gt({inputs:{x:m},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(m),b},nRe={kernelName:a2,backendName:"webgl",kernelFunc:tRe};function k_(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=cx({inputs:{input:s},backend:t}),a=k_({inputs:{x:r},backend:t}),o=kN({inputs:{input:s},backend:t}),l=k_({inputs:{x:o},backend:t}),c=hp({inputs:{real:a,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}else return ux({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const sRe={kernelName:_2,backendName:"webgl",kernelFunc:k_};function Vq(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=cx({inputs:{input:s},backend:t}),a=Vq({inputs:{x:r},backend:t}),o=kN({inputs:{input:s},backend:t}),l=k_({inputs:{x:o},backend:t}),c=hp({inputs:{real:a,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}else return ux({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const rRe={kernelName:i2,backendName:"webgl",kernelFunc:Vq};function iRe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return UI({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const a=e[0].shape,o=e[0].dtype;e.forEach(d=>{ea(a,d.shape,"All tensors passed to stack must have matching shapes"),ee(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],c=e.map(d=>{const p=UI({inputs:{input:d},backend:t,attrs:{dim:r}});return l.push(p),p}),u=Aq({inputs:c,backend:t,attrs:{axis:r}});return l.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const aRe={kernelName:o2,backendName:"webgl",kernelFunc:iRe};class oRe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,a=Es(r),o=t.map(u=>u[0]).join(","),l=t.map((u,d)=>u[0]+e[d]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${o});
      ${a} end = ${a}(${l});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}class lRe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((v,x)=>v[0]+e[x]+v[1]);const r=e.length,a=Es(r),o=t.map(v=>v[0]).join(","),l=t.map((v,x)=>v[0]+e[x]).join(","),c=Oa("rc",r),u=Oa("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${u.slice(-2).join()})`,m=[`${a} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let b="";for(let v=0,x=r===1?2:4;v<x;v++)b+=`
        ${m[v]}
        if (${g}) {
          result[${v}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${v}] = getChannel(getX(${u.join()}), ${p});
        }
      `;b+=r===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${o});
      const ${a} end = ${a}(${l});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${b}
        setOutput(result);
      }
    `}}const Wq=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:a,constantValue:o}=s;if(We(r.shape)===0){const u=a.map((d,p)=>d[0]+r.shape[p]+d[1]);return ux({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const l=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lRe(r.shape,a,o):new oRe(r.shape,a,o),c=[[o]];return t.runWebGLProgram(l,[r],r.dtype,c)},cRe={kernelName:l2,backendName:"webgl",kernelFunc:Wq};const uRe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,hRe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+pg+`
  return result;
`,dRe=ra({opSnippet:uRe,packedOpSnippet:hRe}),fRe={kernelName:X1,backendName:"webgl",kernelFunc:dRe};function pRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:a,keepDims:o}=s,l=r.shape.length,c=[],u=Fn(a,r.shape);let d=u;const p=yr(d,l);let m=r;p!=null&&(m=La({inputs:{x:r},backend:t,attrs:{perm:p}}),d=Br(d.length,l),c.push(m)),na("prod",d,l);let g;if(t.shouldExecuteOnCPU([m])){const b=t.texData.get(m.dataId).values,{outVals:v,outShape:x,outDtype:S}=hAe(m.shape,m.dtype,b,d);g=t.makeTensorInfo(x,S,v)}else{const[b,v]=Fi(m.shape,d),x=We(v),S=gt({inputs:{x:m},backend:t,attrs:{shape:[-1,x]}}),C=dT(r.dtype),A=mg(S,C,"prod",t);g=gt({inputs:{x:A},backend:t,attrs:{shape:b}}),c.push(S),c.push(A)}if(o){c.push(g);const b=zr(g.shape,u);g=gt({inputs:{x:g},backend:t,attrs:{shape:b}})}return c.forEach(b=>t.disposeIntermediateTensorInfo(b)),g}const mRe={kernelName:u2,backendName:"webgl",kernelFunc:pRe};function gRe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:a,indices:o}=e,{outputRaggedRank:l}=s,c=r.map(S=>t.readSync(S.dataId)),u=r.map(S=>S.shape),d=t.readSync(a.dataId),p=t.readSync(o.dataId),[m,g,b]=dAe(c,u,d,a.shape,a.dtype,p,o.shape,l),v=m.map(S=>t.makeTensorInfo([S.length],"int32",S)),x=t.makeTensorInfo(b,a.dtype,g);return v.concat([x])}const yRe={kernelName:jk,backendName:"webgl",kernelFunc:gRe};function bRe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:a}=e,o=t.readSync(s.dataId),l=t.readSync(r.dataId),c=t.readSync(a.dataId),[u,d]=fAe(o,s.shape,s.dtype,l,r.shape,c,a.shape),p=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([d.length],s.dtype,d);return[p,m]}const vRe={kernelName:Uk,backendName:"webgl",kernelFunc:bRe};function wRe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:a,defaultValue:o,rowPartitionTensors:l}=e,{rowPartitionTypes:c}=s,u=t.readSync(r.dataId),d=t.readSync(a.dataId),p=t.readSync(o.dataId),m=l.map(x=>t.readSync(x.dataId)),g=l.map(x=>x.shape),[b,v]=pAe(u,r.shape,d,a.shape,a.dtype,p,o.shape,m,g,c);return t.makeTensorInfo(b,a.dtype,v)}const xRe={kernelName:Vk,backendName:"webgl",kernelFunc:wRe};const Hq=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:a,dtype:o}=t,l=mAe(s,r,a,o);return e.makeTensorInfo([l.length],o,l)},SRe={kernelName:Wk,backendName:"webgl",kernelFunc:Hq};const CRe="return 1.0 / x;",_Re=ss({opSnippet:CRe}),kRe={kernelName:Y1,backendName:"webgl",kernelFunc:_Re};const TRe=vc+`
  return (x < 0.0) ? 0.0 : x;
`,NRe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ARe=ss({opSnippet:TRe,packedOpSnippet:NRe}),ERe={kernelName:K1,backendName:"webgl",kernelFunc:ARe};const IRe=vc+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ORe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,DRe=ss({opSnippet:IRe,packedOpSnippet:ORe}),$Re={kernelName:Z1,backendName:"webgl",kernelFunc:DRe};class RRe{constructor(e,t,s,r,a){this.variableNames=["A"],this.outputShape=[];const[o,l,c,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?l-1:l,r&&s>1?c-1:c],p=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;a?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/p[0]},
          ${d[1]/p[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}class LRe{constructor(e,t,s,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,l,c,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?l-1:l,r&&s>1?c-1:c],p=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;a?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/p[0]},
          ${d[1]/p[1]},
          ${d[1]/p[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}function FRe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:a,halfPixelCenters:o,size:l}=s,[c,u]=l,d=Re().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new LRe(r.shape,c,u,a,o):new RRe(r.shape,c,u,a,o);return t.runWebGLProgram(d,[r],"float32")}const MRe={kernelName:f2,backendName:"webgl",kernelFunc:FRe};class PRe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,o,l]=e,c=[s&&o>1?r-1:r,s&&l>1?a-1:a],u=[s&&o>1?o-1:o,s&&l>1?l-1:l],d=c[0]/u[0],p=c[1]/u[1],m=1/d,g=1/p,b=Math.ceil(m)*2+2,v=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${p});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${b});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}function zRe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:a}=e,{alignCorners:o}=s,l=new PRe(a.shape,r.shape,o);return t.runWebGLProgram(l,[a],a.dtype)}const BRe={kernelName:qk,backendName:"webgl",kernelFunc:zRe};class jRe{constructor(e,t,s,r,a){this.variableNames=["A"],this.outputShape=[];const[o,l,c,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?l-1:l,r&&s>1?c-1:c],p=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;a?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/p[0]},
          ${d[1]/p[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}class URe{constructor(e,t,s,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,l,c,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?l-1:l,r&&s>1?c-1:c],p=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;a?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/p[0]},
          ${d[1]/p[1]},
          ${d[1]/p[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}function VRe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:a,halfPixelCenters:o,size:l}=s,[c,u]=l,d=Re().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new URe(r.shape,c,u,a,o):new jRe(r.shape,c,u,a,o);return t.runWebGLProgram(d,[r],r.dtype)}const WRe={kernelName:d2,backendName:"webgl",kernelFunc:VRe};class HRe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,o,l]=e,c=[s&&o>1?r-1:r,s&&l>1?a-1:a],u=[s&&o>1?o-1:o,s&&l>1?l-1:l],d=c[0]/u[0],p=c[1]/u[1],m=1/d,g=1/p,b=Math.ceil(m)*2+2,v=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${p});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${b});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}function GRe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:a}=e,{alignCorners:o}=s,l=new HRe(a.shape,r.shape,o);return t.runWebGLProgram(l,[a],a.dtype)}const qRe={kernelName:Gk,backendName:"webgl",kernelFunc:GRe};class XRe{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=l=>t.indexOf(l)!==-1&&e[l]!==1?`${e[l]} - coords[${l}] - 1`:`coords[${l}]`,a=e.map((l,c)=>r(c)).join(","),o=Es(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}class YRe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Oa("rc",s),a=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,l=Es(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${l} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${a}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${a}) {
              result.a = ${p(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(b){return m(b)}function u(b){return b[s-1]="("+b[s-1]+" + 1)",m(b)}function d(b){return b[s-2]="("+b[s-2]+" + 1)",m(b)}function p(b){return b[s-1]="("+b[s-1]+" + 1)",b[s-2]="("+b[s-2]+" + 1)",m(b)}function m(b){const v=e.map((C,A)=>g(A,b)),x=v.join(","),S=v.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${S}))`}function g(b,v){return t.indexOf(b)!==-1&&e[b]!==1?`${e[b]} - ${v[b]} - 1`:`${v[b]}`}}}function KRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:a}=s,o=r.shape.length,l=Fn(a,r.shape);if(o===0)return Yo({inputs:{x:r},backend:t});const c=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new YRe(r.shape,l):new XRe(r.shape,l);return t.runWebGLProgram(c,[r],r.dtype)}const ZRe={kernelName:p2,backendName:"webgl",kernelFunc:KRe};class JRe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let a="";typeof t=="number"?a=`float outputValue = ${t.toFixed(2)};`:a=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}const QRe={kernelName:uT,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:a,center:o}=e,l=t,c=new JRe(s.shape,a),[u,d]=z$(o,s.shape[1],s.shape[2]),p=[[u,d,Math.sin(r),Math.cos(r)]];return l.runWebGLProgram(c,[s],s.dtype,p)}};const eLe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,tLe=ss({opSnippet:eLe}),nLe={kernelName:J1,backendName:"webgl",kernelFunc:tLe};const sLe="return inversesqrt(x);",rLe=ss({opSnippet:sLe,cpuKernelImpl:gAe}),iLe={kernelName:Q1,backendName:"webgl",kernelFunc:rLe};class lF{constructor(e,t,s,r,a,o,l=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Es(a.length),d=Es(o.length);let p="";s===1?p="i":s===2&&(p="i, j");const m=`getIndices(${p})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const b=`getUpdates(${g})`;let v="";c&&(v="coords[0], coords[1]");const x=`getDefaultValue(${v})`,S=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${a});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${m});
              flattenedIndex += index * ${S};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${b};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}class aLe{constructor(e,t,s,r,a,o,l=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Es(a.length),d=Es(o.length);let p="";s===1?p="i":s===2&&(p="i, j");const m=`getIndices(${p})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const b=`getUpdates(${g})`;let v="";c&&(v="coords[0], coords[1]");const x=`getDefaultValue(${v})`,S=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${a});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${m});
              flattenedIndex += index.xz * ${S};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${b};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}function oLe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:a}=e,{shape:o}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=cp(a,r,o),m=[p/u,u];if(p===0)return t.makeTensorInfo(o,r.dtype);const g=gt({inputs:{x:r},backend:t,attrs:{shape:[c,l]}}),b=gt({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;Re().getBool("WEBGL_PACK")?x=new aLe(c,l,g.shape.length,b.shape.length,d,m):x=new lF(c,l,g.shape.length,b.shape.length,d,m);const S=t.runWebGLProgram(x,[b,g,v],b.dtype),C=gt({inputs:{x:S},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(v),C}const lLe={kernelName:Xk,backendName:"webgl",kernelFunc:oLe};class cLe{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const a="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,l=Re().getNumber("WEBGL_VERSION")===2?a:o,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${l}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}function uLe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:a}=e,{side:o}=s,l=new cLe(r.shape[0],r.shape[1],a.shape[1],o),c=[[r.shape[1]]];return t.runWebGLProgram(l,[r,a],"int32",c)}const hLe={kernelName:Kk,backendName:"webgl",kernelFunc:uLe};class dLe{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,a;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)a="resRC",r="resRC";else{const l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],u=[];for(let d=0;d<t.length;d++)u.push(`${l[d]}`),d<e&&c.push(`${l[d]}`);r=c.join(),a=u.join()}const o=Es(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}}function fLe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:a}=e,o=new dLe(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,a],lo(r.dtype,a.dtype))}const pLe={kernelName:m2,backendName:"webgl",kernelFunc:fLe};const mLe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${JT};
  float scale = ${QT};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,gLe=ss({opSnippet:mLe}),yLe={kernelName:ey,backendName:"webgl",kernelFunc:gLe};const bLe=Ry+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,vLe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wLe=ss({opSnippet:bLe,packedOpSnippet:vLe,cpuKernelImpl:bAe}),xLe={kernelName:ry,backendName:"webgl",kernelFunc:wLe};const SLe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,CLe=ss({opSnippet:SLe}),_Le={kernelName:sy,backendName:"webgl",kernelFunc:CLe};const kLe=Ry+`
  return sin(x);
`,TLe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${pg}
  return result;
`,NLe=ss({opSnippet:kLe,packedOpSnippet:TLe}),ALe={kernelName:ty,backendName:"webgl",kernelFunc:NLe};const ELe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,ILe=ss({opSnippet:ELe}),OLe={kernelName:ny,backendName:"webgl",kernelFunc:ILe};const DLe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,$Le=ss({opSnippet:DLe}),RLe={kernelName:iy,backendName:"webgl",kernelFunc:$Le};const LLe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:a,paddings:o}=s;ee(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const l=a.reduce((S,C)=>S*C),c=[[0,0]];c.push(...o);for(let S=1+a.length;S<r.shape.length;++S)c.push([0,0]);const u=[],d=Wq({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),p=H2(d.shape,a,l,!1),m=G2(p.length,a.length,!1),g=q2(d.shape,a,l,!1),b=gt({inputs:{x:d},backend:t,attrs:{shape:p}}),v=La({inputs:{x:b},backend:t,attrs:{perm:m}}),x=gt({inputs:{x:v},backend:t,attrs:{shape:g}});return u.push(d),u.push(b),u.push(v),u.forEach(S=>t.disposeIntermediateTensorInfo(S)),x},FLe={kernelName:b2,backendName:"webgl",kernelFunc:LLe};function MLe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:a,defaultValue:o}=e;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${a.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const l=t.readSync(s.dataId),c=t.readSync(r.dataId),u=t.readSync(a.dataId),d=t.readSync(o.dataId)[0],[p,m,g,b,v]=wAe(l,s.shape,s.dtype,c,r.dtype,u,d);return[t.makeTensorInfo(m,s.dtype,p),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(x=>Number(x)))),t.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const PLe={kernelName:Zk,backendName:"webgl",kernelFunc:MLe};function zLe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:a}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const o=Array.from(t.readSync(r.dataId)),l=t.readSync(s.dataId),c=Array.from(t.readSync(a.dataId)),[u,d,p]=xAe(l,s.shape,s.dtype,o,c);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([p.length],a.dtype,new Int32Array(p))]}const BLe={kernelName:Jk,backendName:"webgl",kernelFunc:zLe};function jLe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:a}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${a.shape}`);const o=t.readSync(s.dataId),l=t.readSync(r.dataId),c=t.readSync(a.dataId),[u,d]=fq(o,s.shape,s.dtype,l,c,!0);return t.makeTensorInfo(d,s.dtype,u)}const ULe={kernelName:Qk,backendName:"webgl",kernelFunc:jLe};function VLe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:a}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${a.shape}`);const o=t.readSync(s.dataId),l=t.readSync(r.dataId),c=t.readSync(a.dataId),[u,d]=fq(o,s.shape,s.dtype,l,c);return t.makeTensorInfo(d,s.dtype,u)}const WLe={kernelName:eT,backendName:"webgl",kernelFunc:VLe};function HLe(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:a,defaultValue:o}=e,{outputShape:l}=s,{sliceRank:c,numUpdates:u,sliceSize:d,strides:p,outputSize:m}=cp(a,r,l),g=!1;if(a.dtype==="string"){const S=t.bufferSync(r),C=t.bufferSync(a),A=wd(t.readSync(o.dataId)[0]),k=yAe(S,C,l,m,d,u,c,p,A,g);return t.makeTensorInfo(l,k.dtype,k.values)}const b=new lF(u,c,r.shape.length,a.shape.length,p,[m,1],g),v=t.runWebGLProgram(b,[a,r,o],a.dtype),x=gt({inputs:{x:v},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(v),x}const GLe={kernelName:tT,backendName:"webgl",kernelFunc:HLe};function qLe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:a,axis:o}=s,l=Fn(o,r.shape)[0],c=eR(r,a,l),u=r.shape.length,d=new Array(u).fill(0),p=r.shape.slice();return c.map(m=>{const g=[...p];g[l]=m;const b=Ly({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[l]+=m,b})}const XLe={kernelName:v2,backendName:"webgl",kernelFunc:qLe};const ij="return sqrt(x);",YLe=ss({opSnippet:ij,packedOpSnippet:ij,cpuKernelImpl:SAe}),KLe={kernelName:ay,backendName:"webgl",kernelFunc:YLe};const ZLe="return x * x;",JLe=ss({opSnippet:ZLe}),QLe={kernelName:nT,backendName:"webgl",kernelFunc:JLe};const aj="return (a - b) * (a - b);",eFe=ra({opSnippet:aj,packedOpSnippet:aj}),tFe={kernelName:oy,backendName:"webgl",kernelFunc:eFe};function nFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const a=t.readSync(r.dataId),o=Td(a),l=CAe(o,"string",s);return t.makeTensorInfo(r.shape,"string",l)}const sFe={kernelName:x2,backendName:"webgl",kernelFunc:nFe};function rFe({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=vc+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,a=new ah(s.shape,r);return t.runWebGLProgram(a,[s],s.dtype)}const iFe={kernelName:dy,backendName:"webgl",kernelFunc:rFe};class aFe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,a=Es(s.length),o=Es(s.length);let l="";if(r===1)l="coords * strides + begin";else{let c=0;l=s.map((u,d)=>(c++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${c-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${e});
      ${a} strides = ${a}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${l}));
      }
    `}}function oFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:a,end:o,strides:l,beginMask:c,endMask:u,ellipsisMask:d,newAxisMask:p,shrinkAxisMask:m}=s,{finalShapeSparse:g,finalShape:b,isIdentity:v,sliceDim0:x,isSimpleSlice:S,begin:C,end:A,strides:k}=L$(r.shape,a,o,l,c,u,d,p,m);let O;if(v)O=gt({inputs:{x:r},backend:t,attrs:{shape:b}});else if(x||S){ee(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const $=D$(C,A,k),M=Ly({inputs:{x:r},backend:t,attrs:{begin:C,size:$}});O=gt({inputs:{x:M},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo(M)}else if(t.shouldExecuteOnCPU([r])){const M=t.readSync(r.dataId),R=Dn(r.shape,r.dtype,M),z=_Ae(g,R,k,C);O=t.makeTensorInfo(b,r.dtype,z.values)}else{const M=new aFe(C,k,g);O=t.runWebGLProgram(M,[r],r.dtype)}const F=gt({inputs:{x:O},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(O),F}const lFe={kernelName:sT,backendName:"webgl",kernelFunc:oFe};function cFe(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:a,leftPad:o,rightPad:l,padWidth:c,preserveShortSequences:u}=s,{data:d,dataSplits:p}=e,m=t.readSync(d.dataId),g=t.readSync(p.dataId),[b,v]=kAe(m,g,r,a,o,l,c,u);return[t.makeTensorInfo([b.length],"string",b),t.makeTensorInfo(p.shape,"int32",v)]}const uFe={kernelName:rT,backendName:"webgl",kernelFunc:cFe};function hFe(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:a,delimiter:o}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const l=t.readSync(a.dataId),c=t.readSync(o.dataId)[0],[u,d,p]=TAe(l,c,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(p))]}const dFe={kernelName:iT,backendName:"webgl",kernelFunc:hFe};function fFe(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:a}=e;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(a.dataId),l=NAe(o,r);return t.makeTensorInfo(a.shape,"int32",l)}const pFe={kernelName:aT,backendName:"webgl",kernelFunc:fFe};const mFe="return tan(x);",gFe=ss({opSnippet:mFe}),yFe={kernelName:cy,backendName:"webgl",kernelFunc:gFe};const bFe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,vFe=ss({opSnippet:bFe}),wFe={kernelName:uy,backendName:"webgl",kernelFunc:vFe};function xFe(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:a,updates:o}=e,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=cp(o,a,r.shape),m=[p/u,u];if(p===0)return t.makeTensorInfo(r.shape,a.dtype);const g=gt({inputs:{x:a},backend:t,attrs:{shape:[c,l]}}),b=gt({inputs:{x:o},backend:t,attrs:{shape:[c,u]}}),v=gt({inputs:{x:r},backend:t,attrs:{shape:m}}),x=new lF(c,l,g.shape.length,b.shape.length,d,m,!1,!0),S=t.runWebGLProgram(x,[b,g,v],v.dtype),C=gt({inputs:{x:S},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(S),C}const SFe={kernelName:Yk,backendName:"webgl",kernelFunc:xFe};class CFe{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=Es(this.rank),a=_Fe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}}function _Fe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}function Gq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:a}=s;if(r.dtype==="string"||r.shape.length>5){const c=t.readSync(r.dataId),u=r.dtype==="string"?c.map(m=>wd(m)):c,d=Dn(r.shape,r.dtype,u),p=EAe(d,a);return t.makeTensorInfo(p.shape,p.dtype,p.values)}const o=new CFe(r.shape,a);return t.runWebGLProgram(o,[r],r.dtype)}const kFe={kernelName:hy,backendName:"webgl",kernelFunc:Gq};class TFe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class NFe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}function Gp(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function oj(n){let e=1;for(;e<n;)e*=2;return e}function AFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:a,sorted:o}=s,l=Re().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Re().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<l||a>c){const z=t.readSync(r.dataId),[I,j]=IAe(z,u,r.dtype,a,o);return[t.makeTensorInfo(I.shape,I.dtype,I.values),t.makeTensorInfo(j.shape,j.dtype,j.values)]}if(a===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,ux({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const p=t.texData.get(r.dataId),m=p!==null&&p.isPacked,g=m?t.unpackTensor(r):r,v=We(u)/d,x=gt({inputs:{x:g},attrs:{shape:[v,d]},backend:t});m&&Gp(t,g);const S=oj(a),C=oj(d);let A=null;const k=()=>A===null?[x,x]:[x,A],O=(z,I,j)=>{const H=k(),q=new TFe(j),X=[[d],[A===null?1:0],[Number.NEGATIVE_INFINITY],[z],[I]],ne=A;A=t.runWebGLProgram(q,H,"int32",X),Gp(t,ne)};for(let z=1;z<S;z*=2){const I=z*2;for(let j=z;j>=1;j/=2)O(I,j,[v,C])}for(let z=C;z>S;z/=2){const I=k(),j=new NFe([v,z/2]),q=[[d],[A===null?1:0],[S]],re=A;A=t.runWebGLProgram(j,I,"int32",q),Gp(t,re);const X=S/2,ne=X*2;for(let Q=X;Q>=1;Q/=2)O(ne,Q,A.shape)}let F=A;A=Ly({inputs:{x:A},backend:t,attrs:{begin:0,size:[v,a]}}),Gp(t,F);let $=Pq({inputs:{x,indices:A},backend:t,attrs:{axis:1,batchDims:1}});Gp(t,x);const M=u.slice(0,-1);M.push(a),F=A,A=gt({inputs:{x:A},attrs:{shape:M},backend:t}),Gp(t,F);const R=$;return $=gt({inputs:{x:$},attrs:{shape:M},backend:t}),Gp(t,R),[$,A]}const EFe={kernelName:oT,backendName:"webgl",kernelFunc:AFe};class IFe{constructor(e,t,s,r,a,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const l=s==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${l} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}function OFe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:a}=e,{interpolation:o,fillMode:l,fillValue:c,outputShape:u}=s,[d,p,m,g]=r.shape,[b,v]=u??[p,m],x=[d,b,v,g],S=new IFe(p,m,o,l,c,x);return t.runWebGLProgram(S,[r,a],"float32")}const DFe={kernelName:lT,backendName:"webgl",kernelFunc:OFe};function $Fe(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:a}=e;Ay(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(a.dataId),{outputValues:l,outputShape:c,indices:u}=OAe(o,r,a.shape,a.dtype);return[s.makeTensorInfo(c,a.dtype,l),s.makeTensorInfo([u.length],"int32",u)]}const RFe={kernelName:cT,backendName:"webgl",kernelFunc:$Fe};function LFe(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:a}=s;a<0&&(a+=r.shape.length);const o=r,l=o.shape.length,c=r.shape[a],u=new Array(l-1);let d=0;for(let v=0;v<l;v++)v!==a&&(u[d++]=o.shape[v]);const p=[],m=new Array(l).fill(0),g=o.shape.slice();g[a]=1;const b=new Array(c);for(let v=0;v<b.length;v++){m[a]=v;const x=Ly({inputs:{x:o},backend:t,attrs:{begin:m,size:g}}),S=gt({inputs:{x},backend:t,attrs:{shape:u}});b[v]=S,p.push(x)}return p.forEach(v=>t.disposeIntermediateTensorInfo(v)),b}const FFe={kernelName:S2,backendName:"webgl",kernelFunc:LFe};class MFe{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,a=e.inSize,o=e.numSegments,l=o*Math.ceil(a/s);this.outputShape=[r,l];const c="0.0",u="sumValue",d=Math.floor(s/4)*4,p=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let g="";a%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let b="";a%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${b}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}function PFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:a}=e,{numSegments:o}=s,l=r.shape.length,c=[];let u=0;const d=yr([u],l);let p=r;d!=null&&(p=La({inputs:{x:r},backend:t,attrs:{perm:d}}),c.push(p),u=Br(1,l)[0]);const m=y9(p.shape,u,o),g=We([p.shape[u]]),b=gt({inputs:{x:p},backend:t,attrs:{shape:[-1,g]}});c.push(b);const v=dT(r.dtype),x=(k,O,F,$,M)=>{const R=k.shape[0],z=k.shape[1],I=g9(z,M),j={windowSize:I,inSize:z,batchSize:R,numSegments:M},H=new MFe(j,O),q=t.compileAndRun(H,[k,F],$);if(c.push(q),q.shape[1]===M)return q;const re=Hq({backend:t,attrs:{start:0,stop:M,step:1,dtype:"float32"}}),X=Gq({inputs:{x:re},backend:t,attrs:{reps:[z/I]}});return c.push(re),c.push(X),x(q,O,X,$,M)},S=x(b,"unsortedSegmentSum",a,v,o),C=gt({inputs:{x:S},backend:t,attrs:{shape:m}});let A=C;if(d!=null){c.push(C);const k=ip(d);A=La({inputs:{x:A},backend:t,attrs:{perm:k}})}return c.forEach(k=>t.disposeIntermediateTensorInfo(k)),A}const zFe={kernelName:C2,backendName:"webgl",kernelFunc:PFe};const BFe=[C5e,k5e,A5e,O5e,$5e,F5e,P5e,B5e,W5e,G5e,Y5e,J5e,tEe,iEe,lEe,uEe,dEe,gEe,bEe,wEe,_Ee,OEe,$Ee,MEe,zEe,HEe,qEe,ZEe,a5e,eIe,iIe,cIe,mIe,bIe,wIe,SIe,_Ie,AIe,OIe,RIe,FIe,PIe,BIe,VIe,HIe,YIe,ZIe,eOe,sOe,iOe,cOe,fOe,yOe,wOe,COe,_Oe,TOe,AOe,IOe,DOe,ROe,POe,jOe,WOe,GOe,YOe,JOe,nDe,aDe,i5e,lDe,sIe,hDe,pDe,yDe,l5e,xDe,kDe,NDe,ODe,RDe,PDe,jDe,HDe,YDe,JDe,e$e,r$e,a$e,l$e,d$e,p$e,g$e,b$e,w$e,_$e,A$e,D$e,B$e,h5e,W$e,q$e,K$e,Q$e,jEe,nRe,rRe,aRe,cRe,fRe,u5e,mRe,yRe,vRe,xRe,SRe,UEe,F$e,kRe,ERe,$Re,f5e,MRe,BRe,WRe,qRe,ZRe,QRe,nLe,iLe,lLe,hLe,pLe,yLe,xLe,_Le,ALe,OLe,EEe,P$e,RLe,FLe,PLe,BLe,ULe,WLe,GLe,XLe,KLe,QLe,tFe,sFe,iFe,lFe,uFe,dFe,pFe,M$e,w5e,yFe,wFe,SFe,kFe,EFe,DFe,x5e,RFe,FFe,zFe,sRe];for(const n of BFe)hT(n);const jFe="4.11.0";const UFe={"tfjs-core":q3,"tfjs-backend-cpu":nG,"tfjs-backend-webgl":gq,"tfjs-data":aH,"tfjs-layers":dN,"tfjs-converter":WW,tfjs:jFe},VFe=Object.freeze(Object.defineProperty({__proto__:null,Abs:Sw,Acos:b1,Acosh:v1,AdadeltaOptimizer:S$,AdagradOptimizer:C$,AdamOptimizer:_$,AdamaxOptimizer:k$,Add:rg,AddN:Cw,All:ak,Any:ok,ArgMax:_w,ArgMin:kw,Asin:w1,Asinh:x1,Atan:S1,Atan2:_1,Atanh:C1,AvgPool:Tw,AvgPool3D:Nw,AvgPool3DGrad:ck,AvgPoolGrad:lk,BatchMatMul:Aw,BatchToSpaceND:Ew,Bincount:uk,BitwiseAnd:Iw,BroadcastArgs:hk,BroadcastTo:XU,Callback:zW,CallbackList:W9,Cast:k1,Ceil:T1,ClipByValue:N1,Complex:dk,ComplexAbs:Ow,Concat:Dw,Conv2D:$w,Conv2DBackpropFilter:fk,Conv2DBackpropInput:Rw,Conv3D:Lw,Conv3DBackpropFilterV2:pk,Conv3DBackpropInputV2:mk,Cos:A1,Cosh:E1,CropAndResize:yk,Cumprod:gk,Cumsum:Fw,CustomCallback:G9,DataStorage:QO,DenseBincount:bk,DepthToSpace:vk,DepthwiseConv2dNative:Mw,DepthwiseConv2dNativeBackpropFilter:wk,DepthwiseConv2dNativeBackpropInput:xk,Diag:Sk,Dilation2D:Pw,Dilation2DBackpropFilter:QC,Dilation2DBackpropInput:JC,Draw:Ck,get ENV(){return rD},EarlyStopping:BW,Einsum:_k,Elu:O1,EluGrad:kk,Environment:GU,Equal:zw,Erf:D1,Exp:$1,ExpandDims:Bw,Expm1:R1,FFT:Tk,Fill:Nk,FlipLeftRight:Ak,Floor:L1,FloorDiv:F1,FromPixels:e_,FusedBatchNorm:jw,FusedConv2D:Iv,FusedDepthwiseConv2D:Ov,GPGPUContext:fC,GatherNd:Ek,GatherV2:Uw,GraphModel:RL,Greater:Vw,GreaterEqual:M1,History:H9,IFFT:Ik,Identity:P1,Imag:Ok,InputSpec:ti,IsFinite:z1,IsInf:B1,IsNan:j1,KernelBackend:sk,LRN:Kw,LRNGrad:$k,LayerVariable:B9,LayersModel:gd,LeakyRelu:Ww,Less:Hw,LessEqual:Gw,LinSpace:Dk,Log:U1,Log1p:V1,LogSoftmax:YU,LogicalAnd:qw,LogicalNot:Xw,LogicalOr:Yw,LogicalXor:Nie,LowerBound:Aie,MathBackendCPU:rx,MathBackendWebGL:lx,MatrixBandPart:Eie,Max:Zw,MaxPool:Jw,MaxPool3D:Qw,MaxPool3DGrad:Lk,MaxPoolGrad:Rk,MaxPoolWithArgmax:Fk,Maximum:W1,Mean:e2,Min:t2,Minimum:H1,MirrorPad:n2,Mod:G1,MomentumOptimizer:T$,Multinomial:Mk,Multiply:q1,Neg:s2,NonMaxSuppressionV3:Pk,NonMaxSuppressionV4:zk,NonMaxSuppressionV5:Bk,NotEqual:r2,OP_SCOPE_SUFFIX:cD,OneHot:a2,OnesLike:i2,Optimizer:Md,OptimizerConstructors:X3,Pack:o2,PadV2:l2,Pool:Iie,Pow:X1,Prelu:c2,Prod:u2,RMSPropOptimizer:N$,RNN:ku,RaggedGather:jk,RaggedRange:Uk,RaggedTensorToTensor:Vk,Range:Wk,get Rank(){return qE},Real:Hk,RealDiv:I1,Reciprocal:Y1,get Reduction(){return Ia},Relu:K1,Relu6:Z1,Reshape:h2,ResizeBilinear:f2,ResizeBilinearGrad:qk,ResizeNearestNeighbor:d2,ResizeNearestNeighborGrad:Gk,Reverse:p2,RotateWithOffset:uT,Round:J1,Rsqrt:Q1,SGDOptimizer:XT,ScatterNd:Xk,SearchSorted:Kk,Select:m2,Selu:ey,Sequential:Pm,Sigmoid:ry,Sign:sy,Sin:ty,Sinh:ny,Slice:g2,Softmax:w2,Softplus:iy,SpaceToBatchND:b2,SparseFillEmptyRows:Zk,SparseReshape:Jk,SparseSegmentMean:Qk,SparseSegmentSum:eT,SparseToDense:tT,SplitV:v2,Sqrt:ay,Square:nT,SquaredDifference:oy,StaticRegexReplace:x2,Step:dy,StridedSlice:sT,StringNGrams:rT,StringSplit:iT,StringToHashBucketFast:aT,Sub:ly,Sum:y2,SymbolicTensor:yu,Tan:cy,Tanh:uy,Tensor:Yn,TensorBuffer:ni,TensorScatterUpdate:Yk,Tile:hy,TopK:oT,Transform:lT,Transpose:mm,Unique:cT,Unpack:S2,UnsortedSegmentSum:C2,UpperBound:Oie,Variable:Rv,ZerosLike:_2,_FusedMatMul:Ev,abs:Xr,acos:yD,acosh:bD,add:at,addN:CV,all:mT,any:Fv,argMax:Im,argMin:vD,asin:wD,asinh:xD,atan:SD,atan2:CD,atanh:_D,avgPool:A2,avgPool3d:TD,backend:SV,backend_util:v9,basicLSTMCell:_V,batchNorm:fy,batchNorm2d:ND,batchNorm3d:AD,batchNorm4d:ED,batchToSpaceND:E2,bincount:ID,bitwiseAnd:kV,booleanMaskAsync:c3,broadcastArgs:TV,broadcastTo:gm,broadcast_util:ole,browser:Cfe,buffer:Dn,callbacks:Vbe,cast:ft,ceil:OD,clipByValue:uo,clone:uh,complex:Sd,concat:Pr,concat1d:DD,concat2d:$D,concat3d:RD,concat4d:LD,constraints:I0e,conv1d:gT,conv2d:Cd,conv2dTranspose:yT,conv3d:MD,conv3dTranspose:PD,copyRegisteredKernels:Lie,cos:I2,cosh:bT,cosineWindow:BT,cumprod:zv,cumsum:vT,customGrad:xh,data:n2e,denseBincount:s_,deprecationWarn:Uae,depthToSpace:zD,depthwiseConv2d:py,deregisterOp:Gbe,device_util:aae,diag:AV,dilation2d:BD,disableDeprecationWarnings:jae,dispose:xn,disposeVariables:Vae,div:Bt,divNoNan:jD,dot:UD,dropout:y$,einsum:tm,elu:my,enableDebugMode:Bae,enableProdMode:zae,enclosingPowerOfTwo:b$,engine:Qc,ensureShape:EV,env:Re,equal:Go,erf:VD,euclideanNorm:HD,exp:ho,expandDims:qi,expm1:GD,eye:wT,fft:V2,fill:ig,findBackend:Kae,findBackendFactory:Zae,floor:yy,floorDiv:pT,forceHalfFloat:yq,fused:b3,gather:by,gatherND:f3,gather_util:_fe,getBackend:Xae,getGradient:HE,getKernel:$v,getKernelsForBackend:t_,gpgpu_util:zNe,grad:Wle,grads:Hle,greater:Ma,greaterEqual:Rd,ifft:Y0,imag:O2,image:hc,inTopKAsync:p3,initializers:G0e,input:aW,io:I$,irfft:RT,isFinite:qD,isInf:XD,isNaN:YD,keep:fi,kernel_impls:$fe,layers:wbe,leakyRelu:D2,less:H0,lessEqual:ap,linalg:x$,linspace:DV,loadGraphModel:ywe,loadGraphModelSync:bwe,loadLayersModel:L1e,localResponseNormalization:KD,log:qo,log1p:$2,logSigmoid:ZD,logSoftmax:ST,logSumExp:R2,logicalAnd:mc,logicalNot:L2,logicalOr:CT,logicalXor:JD,losses:k3,lowerBound:RV,matMul:Ln,math:mfe,max:Il,maxPool:F2,maxPool3d:QD,maxPoolWithArgmax:LV,maximum:Th,mean:pr,memory:rI,meshgrid:FV,metrics:Fbe,min:W0,minimum:qf,mirrorPad:e$,mod:t$,model:P1e,models:Mbe,moments:M2,movingAverage:u3,mul:Se,multiRNNCell:MV,multinomial:PV,neg:Gs,nextFrame:F$,norm:gy,notEqual:Rm,oneHot:G0,ones:to,onesLike:Xo,op:ve,outerProduct:zV,pad:Ld,pad1d:BV,pad2d:jV,pad3d:UV,pad4d:VV,pool:n$,pow:_d,prelu:z2,print:mD,prod:s$,profile:Wae,raggedGather:WV,raggedRange:HV,raggedTensorToTensor:GV,rand:qV,randomGamma:KV,randomNormal:kT,randomStandardNormal:ZV,randomUniform:op,randomUniformInt:JV,range:Lm,ready:qae,real:q0,reciprocal:o$,registerBackend:gD,registerCallbackConstructor:B1e,registerGradient:KU,registerKernel:hT,registerOp:Hbe,regularizers:jbe,relu:Cu,relu6:TT,removeBackend:Yae,reshape:_e,reverse:Rl,reverse1d:QV,reverse2d:e3,reverse3d:t3,reverse4d:n3,rfft:W2,round:NT,rsqrt:AT,scalar:Xt,scatterND:h3,scatter_util:Yue,searchSorted:_T,selu:ET,separableConv2d:IT,sequential:z1e,serialization:Kde,setBackend:Gae,setPlatform:Jae,setWebGLContext:vG,setdiff1dAsync:s3,shared:tG,sigmoid:lu,sign:l$,signal:_3,sin:OT,sinh:DT,slice:Xn,slice1d:B2,slice2d:$T,slice3d:j2,slice4d:X0,slice_util:G3,softmax:U2,softplus:ag,spaceToBatchND:P2,sparse:T3,sparseToDense:d3,spectral:C3,split:ro,sqrt:Qi,square:As,squaredDifference:LT,squeeze:lp,stack:Ra,step:og,stridedSlice:c$,string:N3,sub:St,sum:It,sumOutType:dT,tan:u$,tanh:Dm,tensor:Wo,tensor1d:Ki,tensor2d:Pf,tensor3d:h$,tensor4d:r3,tensor5d:i3,tensor6d:a3,tensorScatterUpdate:o3,tensor_util:tae,test_util:lue,tidy:Le,tile:kl,time:Hae,topk:f$,train:Kp,transpose:Wn,truncatedNormal:MT,unique:p$,unregisterGradient:Rie,unregisterKernel:$ie,unsortedSegmentSum:PT,unstack:Ll,upcastType:lo,upperBound:l3,util:Vie,valueAndGrad:Gle,valueAndGrads:qle,variable:m$,variableGrads:$V,version:UFe,version_converter:WW,version_core:q3,version_cpu:nG,version_layers:dN,version_webgl:gq,webgl:r5e,webgl_util:HTe,where:Di,whereAsync:g$,zeros:Qr,zerosLike:Kn},Symbol.toStringTag,{value:"Module"})),lj=n=>n==="tensor"?"tensor":"base64",WFe=({output:n,progressOutput:e,...t}={})=>({...t,output:lj(n),progressOutput:lj(e||n)}),HFe={jsdelivr:(n,e,t)=>`https://cdn.jsdelivr.net/npm/${n}@${e}/${t}`,unpkg:(n,e,t)=>`https://unpkg.com/${n}@${e}/${t}`},GFe=["jsdelivr","unpkg"],qFe=(n,e,t)=>new Error([`Could not resolve URL ${e} for package ${t?.name}@${t?.version}`,"Errors include:",...n.map(([s,r])=>`- ${s}: ${r.message}`)].join(`
`));async function XFe(n,e){const{modelType:t,_internals:s,path:r}=e;if(r)return await zz(n,r,t);if(!s)throw new Error(sR);const a=[];for(const o of GFe){const l=HFe[o];try{const c=l(s.name,s.version,s.path);return await zz(n,c,t)}catch(c){a.push([o,c instanceof Error?c:new Error(`There was an unknown error: ${JSON.stringify(c)}`)])}}throw qFe(a,r||s.path,s)}const YFe=async(n,e)=>{const t=await e;try{Mfe(t)}catch(a){throw Ufe(a)?ppe(a.type,t):new Error(sR)}const s=xpe(t);return{model:await XFe(n,s),modelDefinition:s}},KFe="https://upscalerjs.com/documentation/troubleshooting#environment-disallows-base64",ZFe="https://upscalerjs.com/documentation/troubleshooting#environment-disallows-string-input",JFe=()=>new Error(["Environment does not support a string URL as an input format.",`For more information, see ${ZFe}.`].join(`
`)),QFe=()=>new Error(["Environment does not support base64 as an output format.",`For more information, see ${KFe}.`].join(`
`)),eMe=n=>new Error([`Unsupported dimensions for incoming pixels: ${n.shape.length}.`,"Only 3 or 4 rank tensors are supported."].join(`
`)),tMe=()=>new Error(["Failed to load image"].join(" ")),nMe=n=>new Promise((e,t)=>{const s=new Image;s.src=n,s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=()=>t(tMe())}),cj=n=>L3(n),sMe=async(n,e)=>{if(X2(n))return n;if(Lfe(n)){const t=await nMe(n);return cj(t)}return cj(n)},rMe=async(n,e)=>{const t=await sMe(e);if(Rfe(t)){const s=t.expandDims(0);return t.dispose(),s}if(C9(t))return t;throw eMe(t)},iMe=(n,e)=>{const t=Ipe(n,e),[s,r]=e.shape,a=new ImageData(r,s);a.data.set(t);const o=document.createElement("canvas");o.width=r,o.height=s;const l=o.getContext("2d");if(!l)throw new Error("No context found");return l.putImageData(a,0,0),o.toDataURL()},uj=n=>{try{if((new Image&&"createElement"in document)!==!0)throw n()}catch{throw n()}},aMe=(n,{output:e="base64",progressOutput:t})=>{typeof n=="string"&&uj(JFe),(t==="base64"||e==="base64")&&uj(QFe)},oMe=Ppe({tf:VFe,getUpscaleOptions:WFe,loadModel:YFe,getImageAsTensor:rMe,tensorAsBase64:iMe,checkValidEnvironment:aMe}),rv={upscaler:null,init:()=>{rv.upscaler||(rv.upscaler=new oMe({}))},upscale:async(n,e={})=>{rv.init();try{let t=n;return typeof n=="string"&&(t=await new Promise((r,a)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=()=>r(o),o.onerror=a,o.src=n})),await rv.upscaler.upscale(t,{patchSize:64,padding:2,...e})}catch(t){throw console.error("Upscaling failed:",t),t}}};class lMe{constructor(e,t={}){this.canvas=new vE(e,{width:800,height:600,backgroundColor:"#18191b",...t}),this.originalWidth=800,this.originalHeight=600,this.projectProperties=["name","id","selectable","evented","subTargetCheck","interactive","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation"],this.initWorkspace(),this.viewport=new $re(this),this.events=new Rre(this),this.layoutManager=new Lre(this),this.clipboardManager=new Fre(this),this.guideManager=new Mre(this),this.objectManager=new Pre(this),this.shapeManager=new Bre(this),this.filterManager=new uz(this),this.filterManager=new uz(this),this.fontManager=new jre(this),this.historyManager=new nie(this),setTimeout(()=>this.fitToScreen(),100)}dispose(){this.events&&typeof this.events.dispose=="function"&&this.events.dispose(),this.viewport&&typeof this.viewport.dispose=="function"&&this.viewport.dispose(),this.canvas&&(this.canvas.dispose(),this.canvas=null)}async duplicateActiveObject(){await this.clipboardManager.duplicate()}toggleLockActiveObject(){this.objectManager.toggleLock()}getActiveObject(){return this.canvas?this.canvas.getActiveObject():null}enableDrawingMode(){this.canvas&&(this.canvas.isDrawingMode=!0,this.canvas.discardActiveObject(),this.canvas.requestRenderAll(),this.canvas.freeDrawingBrush||(this.canvas.freeDrawingBrush=new DC(this.canvas)),this.canvas.freeDrawingBrush.width=5,this.canvas.freeDrawingBrush.color="#000000")}disableDrawingMode(){this.canvas&&(this.canvas.isDrawingMode=!1)}setBrushColor(e){this.canvas&&this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=e)}setBrushWidth(e){this.canvas&&this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.width=parseInt(e,10))}initWorkspace(){const e=new wl({left:0,top:0,width:this.originalWidth,height:this.originalHeight,fill:"#ffffff",selectable:!1,evented:!1,stroke:"#cccccc",strokeWidth:1,originX:"left",originY:"top",shadow:{color:"rgba(0, 0, 0, 0.15)",blur:10,offsetX:0,offsetY:5}});this.canvas.backgroundImage=e,this.canvas.requestRenderAll(),this.canvas.backgroundColor="#18191b",this.workspace=e}setBackgroundColor(e){this.workspace&&(this.workspace.set("fill",e),this.canvas.requestRenderAll())}onSelectionChange(e){this.selectionCallback=e}onZoomChange(e){this.viewport.onZoomChange(e)}updateActiveObject(e,t){const s=this.getActiveObject();if(s){if(e.startsWith("shadow.")){const r=e.split(".")[1];let a=s.shadow;a||(s.set("shadow",{color:"#000000",blur:10,offsetX:5,offsetY:5}),a=s.shadow),s.shadow instanceof Object&&(r==="color"&&!t?s.set("shadow",null):s.shadow[r]=t),s.set("shadow",s.shadow)}else if(e.startsWith("filter.")){if(s.type==="image"||s instanceof Na){const r=e.split(".")[1];this.filterManager.applyImageFilter(s,r,parseFloat(t))}}else if(e==="fill")if(s.type==="image"||s instanceof Na)this.filterManager.applyImageFilter(s,"tint",t);else if(s.type==="group"||s.type==="path-group"){const r=a=>{a.forEach(o=>{o.type==="group"?r(o._objects):o.set&&o.set("fill",t)})};s._objects&&r(s._objects),s.set("fill",t)}else s.set("fill",t);else e==="width"?s.scaleToWidth(parseInt(t)):e==="height"?s.scaleToHeight(parseInt(t)):s.set(e,t);s.setCoords(),this.canvas.requestRenderAll()}}flipActiveObject(e){this.objectManager.flip(e)}layerActiveObject(e){this.objectManager.layer(e)}bringForward(){this.objectManager.bringForward()}sendBackward(){this.objectManager.sendBackward()}bringToFront(){this.objectManager.bringToFront()}bringToFront(){this.objectManager.bringToFront()}sendToBack(){this.objectManager.sendToBack()}async undo(){await this.historyManager.undo()}async redo(){await this.historyManager.redo()}setZoom(e){this.viewport.setZoom(e)}zoomIn(){this.viewport.zoomIn()}zoomOut(){this.viewport.zoomOut()}resetZoom(){this.viewport.resetZoom()}fitToScreen(){this.viewport.fitToScreen()}resize(e,t){this.viewport.resizePage(e,t)}toggleHandMode(){return this.viewport.toggleHandMode()}alignObjects(e,t=!1){this.layoutManager.align(e,t)}distributeObjects(e){console.log(`[CanvasManager] Proxying distributeObjects: ${e}`),this.layoutManager.distribute(e)}toggleGrid(){return this.guideManager.toggleGrid()}snapToGrid(e){this.guideManager.snapToGrid(e)}addGuide(e,t){return this.guideManager.addGuide(e,t)}handleObjectMoving(e){this.guideManager.handleObjectMoving(e)}clearGuidelines(){this.guideManager.clearGuidelines()}removeActiveObject(){this.objectManager.remove()}async copy(){await this.clipboardManager.copy()}async paste(){await this.clipboardManager.paste()}group(){this.objectManager.group()}async ungroup(){await this.objectManager.ungroup()}selectAll(){const e=this.canvas.getObjects().filter(t=>t.name!=="Background"&&t!==this.workspace&&t.selectable&&t.evented&&!t.excludeFromExport);if(e.length>0){this.canvas.discardActiveObject();const t=new iu(e,{canvas:this.canvas});this.canvas.setActiveObject(t),this.canvas.requestRenderAll()}}setBackgroundColor(e){this.workspace&&(this.workspace.set("fill",e),this.canvas.requestRenderAll())}setBackgroundGradient(e,t,s,r,a){const o=this.originalWidth,l=this.originalHeight;let c={x1:0,y1:0,x2:o,y2:0};s==="vertical"&&(c={x1:0,y1:0,x2:0,y2:l}),s==="diagonal"&&(c={x1:0,y1:0,x2:o,y2:l});const u=new x0({type:"linear",coords:c,colorStops:[{offset:0,color:e},{offset:1,color:t}]});this.workspace&&(this.workspace.set("fill",u),this.canvas.requestRenderAll())}addText(e="Double click to edit",t={}){this.shapeManager.addText(e,t)}async addImage(e,t={}){await this.shapeManager.addImage(e,t)}async replaceImage(e,t){if(!(!e||e.type!=="image"&&e.type!=="fabric-image"))try{const s=await fr.loadImage(t);e.setElement(s),e.setCoords(),this.canvas.requestRenderAll()}catch(s){throw console.error("Failed to replace image:",s),s}}async vectorizeActiveImage(){const e=this.getActiveObject();if(!e||e.type!=="image"&&e.type!=="fabric-image"){Bn.warning("Select an image to vectorize.");return}Bn.info("Vectorizing image. This may take a moment...");try{const t=e.getSrc(),s=await aie.trace(t),{objects:r,options:a}=await G8(s),o=fr.groupSVGElements(r,a),l=e.calcTransformMatrix(),c=fr.qrDecompose(l);o.set({left:c.translateX,top:c.translateY,angle:c.angle,scaleX:c.scaleX*(e.width/o.width),scaleY:c.scaleY*(e.height/o.height),flipX:c.flipX,flipY:c.flipY,originX:"center",originY:"center",selectable:!0,evented:!0}),this.canvas.add(o),this.canvas.remove(e),this.canvas.setActiveObject(o),this.canvas.requestRenderAll(),this.historyManager.saveState("Vectorize Image"),Bn.success("Image vectorized successfully!")}catch(t){console.error("Vectorization failed:",t),Bn.error("Failed to vectorize image.")}}async extractPaletteFromActiveImage(){const e=this.getActiveObject();if(!e||e.type!=="image"&&e.type!=="fabric-image")return Bn.warning("Select an image to extract colors."),null;Bn.info("Extracting color palette...");try{const t=e.getSrc(),s=await VE.extractColors(t);return Bn.success("Colors extracted!"),s}catch(t){return console.error("Color extraction failed:",t),Bn.error("Failed to extract colors."),null}}async upscaleActiveImage(){const e=this.getActiveObject();if(!e||e.type!=="image"&&e.type!=="fabric-image"){Bn.warning("Select an image to enhance.");return}Bn.info("Enhancing image quality. This may take a minute...");try{const t=e.getSrc(),s=await rv.upscale(t);await this.replaceImage(e,s),this.historyManager.saveState("Upscale Image"),Bn.success("Image enhanced successfully!")}catch(t){console.error("Upscaling failed:",t),Bn.error("Failed to enhance image.")}}addShape(e,t={}){this.shapeManager.addShape(e,t)}async addSVG(e,t={}){await this.shapeManager.addSVG(e,t)}async addSVGString(e,t={}){await this.shapeManager.addSVGString(e,t)}loadGoogleFont(e){this.fontManager.loadGoogleFont(e)}setTextStyle(e,t){this.fontManager.setTextStyle(e,t)}applyImageFilter(e,t,s){this.filterManager.applyImageFilter(e,t,s)}toggleTextDecoration(e){return this.fontManager.toggleTextDecoration(e)}async maskObject(){const e=this.getActiveObject();if(!e||e.type!=="activeSelection"&&e.type!=="activeselection")return;const t=e.getObjects();if(t.length!==2)return;let s=t.find(p=>p.type==="image"),r=t.find(p=>["rect","circle","triangle","polygon","path"].includes(p.type));if(!s||!r)return;const a=await r.clone(),o=s.calcTransformMatrix(),l=fr.invertTransform(o),c=r.calcTransformMatrix(),u=fr.multiplyTransformMatrices(l,c),d=fr.qrDecompose(u);a.set({flipX:!1,flipY:!1,scaleX:d.scaleX,scaleY:d.scaleY,angle:d.angle,skewX:d.skewX,skewY:d.skewY,left:d.translateX,top:d.translateY,originX:"center",originY:"center",absolutePositioned:!1}),s.clipPath=a,this.canvas.discardActiveObject(),this.canvas.remove(r),s.dirty=!0,this.canvas.requestRenderAll(),this.canvas.setActiveObject(s)}async exportImage(e={}){const{format:t="png",filename:s="design",quality:r=1}=e,a=this.workspace.stroke;this.workspace.set({stroke:"transparent"});const o=this.canvas.getObjects().filter(c=>c.excludeFromExport);o.forEach(c=>c.set({opacity:0}));const l=this.canvas.viewportTransform.slice();this.canvas.setViewportTransform([1,0,0,1,0,0]);try{if(t==="pdf"){const c=this.canvas.toDataURL({format:"png",multiplier:r,left:0,top:0,width:this.originalWidth,height:this.originalHeight,enableRetinaScaling:!1}),u=new qt({orientation:this.originalWidth>this.originalHeight?"landscape":"portrait",unit:"px",format:[this.originalWidth,this.originalHeight]});u.addImage(c,"PNG",0,0,this.originalWidth,this.originalHeight),u.save(`${s}.pdf`)}else if(t==="json"){const c=this.canvas.toDataURL({format:"jpeg",quality:.8,multiplier:.2,left:0,top:0,width:this.originalWidth,height:this.originalHeight,enableRetinaScaling:!1}),u=this.canvas.toJSON(["name","id","selectable","evented","subTargetCheck","interactive","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation"]);u.thumbnail=c;const d=b=>typeof b=="string"&&b.startsWith(window.location.origin)?b.replace(window.location.origin,""):b,p=b=>{b.forEach(v=>{v.src&&(v.src=d(v.src)),v.objects&&p(v.objects)})};u.objects&&p(u.objects);const m="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(u)),g=document.createElement("a");g.download=`${s}.json`,g.href=m,g.click()}else{const c=this.canvas.toDataURL({format:t==="jpg"?"jpeg":t,multiplier:r,left:0,top:0,width:this.originalWidth,height:this.originalHeight,enableRetinaScaling:!1}),u=document.createElement("a");u.download=`${s}.${t}`,u.href=c,u.click()}}finally{this.canvas.setViewportTransform(l),this.workspace.set({stroke:a}),o.forEach(c=>c.set({opacity:1})),this.canvas.requestRenderAll()}}startCropMode(){const e=this.getActiveObject();if(!e||e.type!=="image"&&e.type!=="fabric-image"){Bn.warning("Select an image to crop.");return}this.isCropping||(this.isCropping=!0,this.cropTarget=e,this._originalControls=e.controls,this._originalBorders={borderColor:e.borderColor,cornerColor:e.cornerColor,cornerStyle:e.cornerStyle,transparentCorners:e.transparentCorners},e.controls=Vte(),e.set({borderColor:"#ff9900",cornerColor:"#ff9900",cornerStyle:"circle",transparentCorners:!1,lockRotation:!0,lockScalingX:!0,lockScalingY:!0}),e.setCoords(),this.canvas.requestRenderAll(),this.onCropModeChange&&this.onCropModeChange(!0),Bn.info("Drag handles to crop image."))}applyCrop(){this.cancelCrop(),Bn.success("Crop applied.")}cancelCrop(){if(!this.isCropping||!this.cropTarget)return;const e=this.cropTarget;this._originalControls&&(e.controls=this._originalControls,this._originalControls=null),this._originalBorders&&(e.set(this._originalBorders),this._originalBorders=null),e.set({lockRotation:!1,lockScalingX:!1,lockScalingY:!1}),this.isCropping=!1,this.cropTarget=null,e.setCoords(),this.canvas.requestRenderAll(),this.onCropModeChange&&this.onCropModeChange(!1)}async loadProject(e){if(e)try{e.width&&e.height&&(this.originalWidth=e.width,this.originalHeight=e.height),await this.canvas.loadFromJSON(e);const t=this.canvas.getObjects().find(s=>s.name==="Background");t?(this.canvas.remove(t),t.set({selectable:!1,evented:!1,stroke:"#cccccc",strokeWidth:1}),this.canvas.backgroundImage=t,this.canvas.requestRenderAll(),this.workspace=t):this.canvas.backgroundImage?this.workspace=this.canvas.backgroundImage:this.initWorkspace(),this.viewport&&this.viewport.handleWindowResize&&this.viewport.handleWindowResize(),this.canvas.requestRenderAll(),Bn.success("Project loaded")}catch(t){console.error("Load Error:",t),Bn.error("Failed to load project")}}saveProject(){const e=this.canvas.toJSON(this.projectProperties);return e.width=this.originalWidth,e.height=this.originalHeight,e}}const qq=ct.createContext(null);function TN(){const n=ct.useContext(qq);if(!n)throw new Error("useCanvas must be used within a CanvasProvider");return n}function cMe({children:n}){const[e,t]=ct.useState(null),[s,r]=ct.useState(null),[a,o]=ct.useState("#000000");ct.useEffect(()=>{const c=new lMe("c",{width:800,height:600,backgroundColor:"#ffffff"});return t(c),window.canvasManager=c,()=>{c.dispose()}},[]),ct.useEffect(()=>{if(!e)return;const c=()=>{const u=e.getActiveObject();r(u),u&&u.fill&&typeof u.fill=="string"&&o(u.fill)};return e.canvas.on("selection:created",c),e.canvas.on("selection:updated",c),e.canvas.on("selection:cleared",()=>{r(null)}),e.canvas.on("object:updated",c),()=>{e.canvas&&(e.canvas.off("selection:created",c),e.canvas.off("selection:updated",c),e.canvas.off("selection:cleared",c),e.canvas.off("object:updated",c))}},[e]);const l={canvasManager:e,activeObject:s,currentColor:a,setCurrentColor:o};return P.jsx(qq.Provider,{value:l,children:n})}const uMe=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),hMe=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),hj=n=>{const e=hMe(n);return e.charAt(0).toUpperCase()+e.slice(1)},Xq=(...n)=>n.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),dMe=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var fMe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const pMe=ct.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:r="",children:a,iconNode:o,...l},c)=>ct.createElement("svg",{ref:c,...fMe,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:Xq("lucide",r),...!a&&!dMe(l)&&{"aria-hidden":"true"},...l},[...o.map(([u,d])=>ct.createElement(u,d)),...Array.isArray(a)?a:[a]]));const Wt=(n,e)=>{const t=ct.forwardRef(({className:s,...r},a)=>ct.createElement(pMe,{ref:a,iconNode:e,className:Xq(`lucide-${uMe(hj(n))}`,`lucide-${n}`,s),...r}));return t.displayName=hj(n),t};const mMe=[["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M10 16v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4",key:"11f1s0"}],["path",{d:"M10 8V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v4",key:"t14dx9"}],["path",{d:"M20 16v1a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-1",key:"1w07xs"}],["path",{d:"M14 8V7c0-1.1.9-2 2-2h2a2 2 0 0 1 2 2v1",key:"1apec2"}]],gMe=Wt("align-center-horizontal",mMe);const yMe=[["rect",{width:"6",height:"14",x:"4",y:"5",rx:"2",key:"1wwnby"}],["rect",{width:"6",height:"10",x:"14",y:"7",rx:"2",key:"1fe6j6"}],["path",{d:"M17 22v-5",key:"4b6g73"}],["path",{d:"M17 7V2",key:"hnrr36"}],["path",{d:"M7 22v-3",key:"1r4jpn"}],["path",{d:"M7 5V2",key:"liy1u9"}]],bMe=Wt("align-horizontal-distribute-center",yMe);const vMe=[["path",{d:"M22 17h-3",key:"1lwga1"}],["path",{d:"M22 7h-5",key:"o2endc"}],["path",{d:"M5 17H2",key:"1gx9xc"}],["path",{d:"M7 7H2",key:"6bq26l"}],["rect",{x:"5",y:"14",width:"14",height:"6",rx:"2",key:"1qrzuf"}],["rect",{x:"7",y:"4",width:"10",height:"6",rx:"2",key:"we8e9z"}]],wMe=Wt("align-vertical-distribute-center",vMe);const xMe=[["rect",{width:"14",height:"6",x:"5",y:"16",rx:"2",key:"1i8z2d"}],["rect",{width:"10",height:"6",x:"7",y:"2",rx:"2",key:"ypihtt"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],SMe=Wt("align-vertical-justify-center",xMe);const CMe=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],_Me=Wt("arrow-down-to-line",CMe);const kMe=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],cF=Wt("arrow-down",kMe);const TMe=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Yq=Wt("arrow-left-right",TMe);const NMe=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Kq=Wt("arrow-up-down",NMe);const AMe=[["path",{d:"M5 3h14",key:"7usisc"}],["path",{d:"m18 13-6-6-6 6",key:"1kf1n9"}],["path",{d:"M12 7v14",key:"1akyts"}]],EMe=Wt("arrow-up-to-line",AMe);const IMe=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],uF=Wt("arrow-up",IMe);const OMe=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],Zq=Wt("bold",OMe);const DMe=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],$Me=Wt("box",DMe);const RMe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Jq=Wt("check",RMe);const LMe=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],FMe=Wt("chevron-down",LMe);const MMe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Qq=Wt("chevron-left",MMe);const PMe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],eX=Wt("chevron-right",PMe);const zMe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],BMe=Wt("circle",zMe);const jMe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],hF=Wt("copy",jMe);const UMe=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],tX=Wt("crop",UMe);const VMe=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],nX=Wt("download",VMe);const WMe=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],HMe=Wt("eye-off",WMe);const GMe=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],qMe=Wt("eye",GMe);const XMe=[["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],YMe=Wt("folder-minus",XMe);const KMe=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],ZMe=Wt("folder-open",KMe);const JMe=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],QMe=Wt("folder-plus",JMe);const ePe=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],tPe=Wt("folder",ePe);const nPe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],sPe=Wt("grid-3x3",nPe);const rPe=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],iPe=Wt("grip-vertical",rPe);const aPe=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],oPe=Wt("hand",aPe);const lPe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],cPe=Wt("image",lPe);const uPe=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],sX=Wt("italic",uPe);const hPe=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],dPe=Wt("keyboard",hPe);const fPe=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],vv=Wt("layers",fPe);const pPe=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],rX=Wt("layout-grid",pPe);const mPe=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],iX=Wt("lock-open",mPe);const gPe=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],dF=Wt("lock",gPe);const yPe=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],bPe=Wt("maximize",yPe);const vPe=[["path",{d:"M5 12h14",key:"1ays0h"}]],wPe=Wt("minus",vPe);const xPe=[["path",{d:"M11 7 6 2",key:"1jwth8"}],["path",{d:"M18.992 12H2.041",key:"xw1gg"}],["path",{d:"M21.145 18.38A3.34 3.34 0 0 1 20 16.5a3.3 3.3 0 0 1-1.145 1.88c-.575.46-.855 1.02-.855 1.595A2 2 0 0 0 20 22a2 2 0 0 0 2-2.025c0-.58-.285-1.13-.855-1.595",key:"1nkol4"}],["path",{d:"m8.5 4.5 2.148-2.148a1.205 1.205 0 0 1 1.704 0l7.296 7.296a1.205 1.205 0 0 1 0 1.704l-7.592 7.592a3.615 3.615 0 0 1-5.112 0l-3.888-3.888a3.615 3.615 0 0 1 0-5.112L5.67 7.33",key:"1nk1rd"}]],SPe=Wt("paint-bucket",xPe);const CPe=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],_Pe=Wt("palette",CPe);const kPe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],TPe=Wt("pencil",kPe);const NPe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],aX=Wt("plus",NPe);const APe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],EPe=Wt("rotate-ccw",APe);const IPe=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],OPe=Wt("rotate-cw",IPe);const DPe=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],$Pe=Wt("ruler",DPe);const RPe=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]],oX=Wt("scaling",RPe);const LPe=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],lX=Wt("search",LPe);const FPe=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],MPe=Wt("shapes",FPe);const PPe=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],cX=Wt("sparkles",PPe);const zPe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],BPe=Wt("square",zPe);const jPe=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]],UPe=Wt("text-align-center",jPe);const VPe=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]],uX=Wt("text-align-end",VPe);const WPe=[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]],HPe=Wt("text-align-justify",WPe);const GPe=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],hX=Wt("text-align-start",GPe);const qPe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],NN=Wt("trash-2",qPe);const XPe=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],dX=Wt("type",XPe);const YPe=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],fX=Wt("underline",YPe);const KPe=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ZPe=Wt("upload",KPe);const JPe=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],fF=Wt("wand-sparkles",JPe);const QPe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],hx=Wt("x",QPe),dj=n=>{let e;const t=new Set,s=(u,d)=>{const p=typeof u=="function"?u(e):u;if(!Object.is(p,e)){const m=e;e=d??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(g=>g(e,m))}},r=()=>e,l={setState:s,getState:r,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=n(s,r,l);return l},e6e=(n=>n?dj(n):dj),t6e=n=>n;function n6e(n,e=t6e){const t=Ps.useSyncExternalStore(n.subscribe,Ps.useCallback(()=>e(n.getState()),[n,e]),Ps.useCallback(()=>e(n.getInitialState()),[n,e]));return Ps.useDebugValue(t),t}const fj=n=>{const e=e6e(n),t=s=>n6e(e,s);return Object.assign(t,e),t},s6e=(n=>n?fj(n):fj),Hm=s6e(n=>({activeTab:"elements",setActiveTab:e=>n({activeTab:e}),showRulers:!0,setShowRulers:e=>n({showRulers:e}),showShortcuts:!1,setShowShortcuts:e=>n({showShortcuts:e}),showExport:!1,setShowExport:e=>n({showExport:e}),showResize:!1,setShowResize:e=>n({showResize:e}),colorPickerVisible:!1,setColorPickerVisible:e=>n({colorPickerVisible:e}),colorPickerAnchor:null,setColorPickerAnchor:e=>n({colorPickerAnchor:e}),activeColorProp:"fill",setActiveColorProp:e=>n({activeColorProp:e}),colorPickerAlign:"left",setColorPickerAlign:e=>n({colorPickerAlign:e}),extractedPalette:null,setExtractedPalette:e=>n({extractedPalette:e})}));function r6e({canvasManager:n}){const[e,t]=ct.useState(100),[s,r]=ct.useState(!1),[a,o]=ct.useState(!1),[l,c]=ct.useState(!1),u=ct.useRef(null);ct.useEffect(()=>{if(!n)return;const S=C=>t(Math.round(C*100));n.onZoomChange(S),n.canvas&&t(Math.round(n.canvas.getZoom()*100))},[n]),ct.useEffect(()=>{function S(C){u.current&&!u.current.contains(C.target)&&c(!1)}return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[u]);const d=()=>{n&&(s?(n.disableDrawingMode(),r(!1)):(n.enableDrawingMode(),r(!0),o(!1)))},p=()=>{if(!n)return;const S=n.toggleHandMode();o(S),S&&r(!1)},m=()=>n?.zoomIn(),g=()=>n?.zoomOut(),b=()=>n?.resetZoom(),v=S=>{n?.setZoom(S/100),c(!1)},x=()=>{n?.fitToScreen(),c(!1)};return P.jsxs("div",{className:"zoom-toolbar-nav navbar-group",children:[P.jsx("button",{className:`icon-btn ${s?"active":""}`,onClick:d,title:"Free Drawing",children:P.jsx(TPe,{size:18})}),P.jsx("div",{className:"separator-vertical"}),P.jsx("button",{className:`icon-btn ${a?"active":""}`,onClick:p,title:"Hand Tool (Space)",children:P.jsx(oPe,{size:18})}),P.jsx("div",{className:"separator-vertical"}),P.jsx("button",{className:"icon-btn",onClick:g,title:"Zoom Out",children:P.jsx(wPe,{size:18})}),P.jsxs("div",{className:"zoom-dropdown-container",ref:u,style:{position:"relative"},children:[P.jsxs("button",{className:"zoom-display-btn",onClick:()=>c(!l),style:{display:"flex",alignItems:"center",gap:"4px",background:"transparent",border:"none",color:"white",fontSize:"14px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",minWidth:"70px",justifyContent:"center"},children:[e,"% ",P.jsx(FMe,{size:12})]}),l&&P.jsxs("div",{className:"zoom-dropdown-menu",style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"8px",background:"#2b2d30",border:"1px solid #3e4042",borderRadius:"6px",padding:"4px 0",minWidth:"120px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,display:"flex",flexDirection:"column",whiteSpace:"nowrap"},children:[[25,50,75,100,150,200,300].map(S=>P.jsxs("button",{onClick:()=>v(S),style:{background:"transparent",border:"none",color:"#e0e0e0",padding:"6px 16px",textAlign:"left",cursor:"pointer",fontSize:"13px",width:"100%"},onMouseEnter:C=>C.target.style.background="#3e4042",onMouseLeave:C=>C.target.style.background="transparent",children:[S,"%"]},S)),P.jsx("div",{style:{height:"1px",background:"#3e4042",margin:"4px 0"}}),P.jsx("button",{onClick:x,style:{background:"transparent",border:"none",color:"#e0e0e0",padding:"6px 16px",textAlign:"left",cursor:"pointer",fontSize:"13px",width:"100%"},onMouseEnter:S=>S.target.style.background="#3e4042",onMouseLeave:S=>S.target.style.background="transparent",children:"Fit to Screen"})]})]}),P.jsx("button",{className:"icon-btn",onClick:m,title:"Zoom In",children:P.jsx(aX,{size:18})}),P.jsx("button",{className:"icon-btn",onClick:b,title:"Reset Zoom",children:P.jsx(bPe,{size:18})})]})}function i6e({canvasManager:n,showRulers:e,setShowRulers:t}){const[s,r]=ct.useState(!1),a=()=>{t&&t(!e)},o=()=>{if(n){const l=n.toggleGrid();r(l)}};return P.jsxs("div",{className:"nav-action-group",children:[P.jsx("button",{className:`icon-btn ${e?"active":""}`,onClick:a,title:"Toggle Rulers",children:P.jsx($Pe,{size:16})}),P.jsx("button",{className:`icon-btn ${s?"active":""}`,onClick:o,title:"Toggle Grid",children:P.jsx(sPe,{size:16})})]})}function a6e({canvasManager:n}){const[e,t]=ct.useState(!1),[s,r]=ct.useState(!1);return ct.useEffect(()=>{const a=o=>{t(o.detail.canUndo),r(o.detail.canRedo)};return window.addEventListener("historyUpdate",a),n&&n.historyManager&&(t(n.historyManager.canUndo()),r(n.historyManager.canRedo())),()=>window.removeEventListener("historyUpdate",a)},[n]),ct.useEffect(()=>{const a=o=>{(o.ctrlKey||o.metaKey)&&o.key.toLowerCase()==="z"?(o.preventDefault(),o.shiftKey?n?.redo():n?.undo()):(o.ctrlKey||o.metaKey)&&o.key.toLowerCase()==="y"&&(o.preventDefault(),n?.redo())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[n]),P.jsxs("div",{className:"navbar-group",children:[P.jsx("button",{className:"icon-btn",title:"Undo (Ctrl+Z)",onClick:()=>n?.undo(),disabled:!e,children:P.jsx(EPe,{size:16})}),P.jsx("button",{className:"icon-btn",title:"Redo (Ctrl+Y)",onClick:()=>n?.redo(),disabled:!s,children:P.jsx(OPe,{size:16})})]})}function o6e({canvasManager:n,onExport:e}){const t=ct.useRef(null),s=()=>{n?.duplicateActiveObject()},r=()=>{n?.toggleLockActiveObject()},a=()=>{t.current?.click()},o=l=>{const c=l.target.files[0];if(!c)return;const u=new FileReader;u.onload=d=>{try{const p=JSON.parse(d.target.result);n.loadProject(p)}catch(p){console.error("Failed to load JSON",p),alert("Failed to load project file.")}},u.readAsText(c),l.target.value=""};return P.jsxs("div",{className:"nav-actions navbar-group",children:[P.jsx("input",{type:"file",ref:t,accept:".json,application/json",style:{display:"none"},onChange:o}),P.jsx("button",{className:"icon-btn",onClick:a,title:"Import JSON Project",children:P.jsx(ZMe,{size:16})}),P.jsx("button",{className:"icon-btn",onClick:e,title:"Export Design",children:P.jsx(nX,{size:16})}),P.jsx("div",{style:{width:"1px",height:"24px",background:"var(--border-color)",margin:"0 4px"}}),P.jsx("button",{id:"btn-duplicate",className:"icon-btn",onClick:s,title:"Duplicate",children:P.jsx(hF,{size:16})}),P.jsx("button",{id:"btn-lock",className:"icon-btn",onClick:r,title:"Lock/Unlock",children:P.jsx(dF,{size:16})})]})}function AN(){return(AN=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n}).apply(this,arguments)}function pX(n,e){if(n==null)return{};var t,s,r={},a=Object.keys(n);for(s=0;s<a.length;s++)e.indexOf(t=a[s])>=0||(r[t]=n[t]);return r}function VI(n){var e=ct.useRef(n),t=ct.useRef(function(s){e.current&&e.current(s)});return e.current=n,t.current}var Xv=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n<e?e:n},wv=function(n){return"touches"in n},WI=function(n){return n&&n.ownerDocument.defaultView||self},pj=function(n,e,t){var s=n.getBoundingClientRect(),r=wv(e)?(function(a,o){for(var l=0;l<a.length;l++)if(a[l].identifier===o)return a[l];return a[0]})(e.touches,t):e;return{left:Xv((r.pageX-(s.left+WI(n).pageXOffset))/s.width),top:Xv((r.pageY-(s.top+WI(n).pageYOffset))/s.height)}},mj=function(n){!wv(n)&&n.preventDefault()},mX=Ps.memo(function(n){var e=n.onMove,t=n.onKey,s=pX(n,["onMove","onKey"]),r=ct.useRef(null),a=VI(e),o=VI(t),l=ct.useRef(null),c=ct.useRef(!1),u=ct.useMemo(function(){var g=function(x){mj(x),(wv(x)?x.touches.length>0:x.buttons>0)&&r.current?a(pj(r.current,x,l.current)):v(!1)},b=function(){return v(!1)};function v(x){var S=c.current,C=WI(r.current),A=x?C.addEventListener:C.removeEventListener;A(S?"touchmove":"mousemove",g),A(S?"touchend":"mouseup",b)}return[function(x){var S=x.nativeEvent,C=r.current;if(C&&(mj(S),!(function(k,O){return O&&!wv(k)})(S,c.current)&&C)){if(wv(S)){c.current=!0;var A=S.changedTouches||[];A.length&&(l.current=A[0].identifier)}C.focus(),a(pj(C,S,l.current)),v(!0)}},function(x){var S=x.which||x.keyCode;S<37||S>40||(x.preventDefault(),o({left:S===39?.05:S===37?-.05:0,top:S===40?.05:S===38?-.05:0}))},v]},[o,a]),d=u[0],p=u[1],m=u[2];return ct.useEffect(function(){return m},[m]),Ps.createElement("div",AN({},s,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:r,onKeyDown:p,tabIndex:0,role:"slider"}))}),pF=function(n){return n.filter(Boolean).join(" ")},gX=function(n){var e=n.color,t=n.left,s=n.top,r=s===void 0?.5:s,a=pF(["react-colorful__pointer",n.className]);return Ps.createElement("div",{className:a,style:{top:100*r+"%",left:100*t+"%"}},Ps.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},ma=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t},l6e=function(n){return f6e(HI(n))},HI=function(n){return n[0]==="#"&&(n=n.substring(1)),n.length<6?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?ma(parseInt(n[3]+n[3],16)/255,2):1}:{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16),a:n.length===8?ma(parseInt(n.substring(6,8),16)/255,2):1}},c6e=function(n){return d6e(h6e(n))},u6e=function(n){var e=n.s,t=n.v,s=n.a,r=(200-e)*t/100;return{h:ma(n.h),s:ma(r>0&&r<200?e*t/100/(r<=100?r:200-r)*100:0),l:ma(r/2),a:ma(s,2)}},GI=function(n){var e=u6e(n);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},h6e=function(n){var e=n.h,t=n.s,s=n.v,r=n.a;e=e/360*6,t/=100,s/=100;var a=Math.floor(e),o=s*(1-t),l=s*(1-(e-a)*t),c=s*(1-(1-e+a)*t),u=a%6;return{r:ma(255*[s,l,o,o,c,s][u]),g:ma(255*[c,s,s,l,o,o][u]),b:ma(255*[o,o,c,s,s,l][u]),a:ma(r,2)}},zS=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},d6e=function(n){var e=n.r,t=n.g,s=n.b,r=n.a,a=r<1?zS(ma(255*r)):"";return"#"+zS(e)+zS(t)+zS(s)+a},f6e=function(n){var e=n.r,t=n.g,s=n.b,r=n.a,a=Math.max(e,t,s),o=a-Math.min(e,t,s),l=o?a===e?(t-s)/o:a===t?2+(s-e)/o:4+(e-t)/o:0;return{h:ma(60*(l<0?l+6:l)),s:ma(a?o/a*100:0),v:ma(a/255*100),a:r}},p6e=Ps.memo(function(n){var e=n.hue,t=n.onChange,s=pF(["react-colorful__hue",n.className]);return Ps.createElement("div",{className:s},Ps.createElement(mX,{onMove:function(r){t({h:360*r.left})},onKey:function(r){t({h:Xv(e+360*r.left,0,360)})},"aria-label":"Hue","aria-valuenow":ma(e),"aria-valuemax":"360","aria-valuemin":"0"},Ps.createElement(gX,{className:"react-colorful__hue-pointer",left:e/360,color:GI({h:e,s:100,v:100,a:1})})))}),m6e=Ps.memo(function(n){var e=n.hsva,t=n.onChange,s={backgroundColor:GI({h:e.h,s:100,v:100,a:1})};return Ps.createElement("div",{className:"react-colorful__saturation",style:s},Ps.createElement(mX,{onMove:function(r){t({s:100*r.left,v:100-100*r.top})},onKey:function(r){t({s:Xv(e.s+100*r.left,0,100),v:Xv(e.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+ma(e.s)+"%, Brightness "+ma(e.v)+"%"},Ps.createElement(gX,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:GI(e)})))}),yX=function(n,e){if(n===e)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0},g6e=function(n,e){return n.toLowerCase()===e.toLowerCase()||yX(HI(n),HI(e))};function y6e(n,e,t){var s=VI(t),r=ct.useState(function(){return n.toHsva(e)}),a=r[0],o=r[1],l=ct.useRef({color:e,hsva:a});ct.useEffect(function(){if(!n.equal(e,l.current.color)){var u=n.toHsva(e);l.current={hsva:u,color:e},o(u)}},[e,n]),ct.useEffect(function(){var u;yX(a,l.current.hsva)||n.equal(u=n.fromHsva(a),l.current.color)||(l.current={hsva:a,color:u},s(u))},[a,n,s]);var c=ct.useCallback(function(u){o(function(d){return Object.assign({},d,u)})},[]);return[a,c]}var b6e=typeof window<"u"?ct.useLayoutEffect:ct.useEffect,v6e=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},gj=new Map,w6e=function(n){b6e(function(){var e=n.current?n.current.ownerDocument:document;if(e!==void 0&&!gj.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,gj.set(e,t);var s=v6e();s&&t.setAttribute("nonce",s),e.head.appendChild(t)}},[])},x6e=function(n){var e=n.className,t=n.colorModel,s=n.color,r=s===void 0?t.defaultColor:s,a=n.onChange,o=pX(n,["className","colorModel","color","onChange"]),l=ct.useRef(null);w6e(l);var c=y6e(t,r,a),u=c[0],d=c[1],p=pF(["react-colorful",e]);return Ps.createElement("div",AN({},o,{ref:l,className:p}),Ps.createElement(m6e,{hsva:u,onChange:d}),Ps.createElement(p6e,{hue:u.h,onChange:d,className:"react-colorful__last-control"}))},S6e={defaultColor:"000",toHsva:l6e,fromHsva:function(n){return c6e({h:n.h,s:n.s,v:n.v,a:1})},equal:g6e},C6e=function(n){return Ps.createElement(x6e,AN({},n,{colorModel:S6e}))};function bX({color:n,onChange:e,onClose:t,anchorEl:s,align:r="left"}){const a=ct.useRef(null),[o,l]=ct.useState({top:100,left:100,right:0}),[c,u]=ct.useState(n);ct.useEffect(()=>{if(s){const m=s.getBoundingClientRect();l({top:m.bottom+10,left:m.left,right:window.innerWidth-m.right})}},[s]),ct.useEffect(()=>{const m=g=>{a.current&&!a.current.contains(g.target)&&!s?.contains(g.target)&&t()};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[t,s]),ct.useEffect(()=>{u(n==="transparent"?"":n.toUpperCase())},[n]);const d=m=>{const g=m.target.value;u(g),/^#([0-9A-F]{3}){1,2}$/i.test(g)?e(g):/^([0-9A-F]{3}){1,2}$/i.test(g)&&e("#"+g)},p=n==="transparent";return P.jsxs("div",{ref:a,style:{position:"fixed",top:`${o.top}px`,left:r==="left"?`${o.left}px`:"auto",right:r==="right"?`${o.right}px`:"auto",zIndex:99999,background:"white",padding:"12px",borderRadius:"8px",boxShadow:"0 4px 16px rgba(0,0,0,0.2)",border:"1px solid #e5e5e5",width:"200px"},children:[P.jsx(C6e,{color:p?"#FFFFFF":n,onChange:e,style:{width:"100%",height:"150px"}}),P.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[P.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",background:"#f3f4f6",border:"1px solid #e5e5e5",borderRadius:"4px",padding:"0 8px"},children:[P.jsx("span",{style:{color:"#9ca3af",fontSize:"13px",marginRight:"4px"},children:"#"}),P.jsx("input",{type:"text",value:p?"TRANSPARENT":c.replace("#",""),onChange:d,placeholder:"HEX",style:{border:"none",background:"transparent",width:"100%",padding:"6px 0",fontSize:"13px",fontFamily:"monospace",outline:"none",color:"#374151",textTransform:"uppercase"}})]}),P.jsx("button",{onClick:()=>e("transparent"),title:"No Color",style:{width:"32px",height:"32px",borderRadius:"4px",border:`1px solid ${p?"#6366f1":"#e5e5e5"}`,background:"conic-gradient(from 180deg at 50% 50%, #fff 0deg, #fff 90deg, #e5e5e5 90deg, #e5e5e5 180deg, #fff 180deg, #fff 270deg, #e5e5e5 270deg, #e5e5e5 360deg)",backgroundSize:"10px 10px",backgroundPosition:"center",cursor:"pointer",padding:0,position:"relative",flexShrink:0},children:P.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"2px",background:"#ef4444",transform:"translate(-50%, -50%) rotate(-45deg)"}})})]})]})}function _6e({canvasManager:n}){const[e,t]=ct.useState(!1),[s,r]=ct.useState("#ffffff"),a=ct.useRef(null),o=l=>{r(l),n&&n.setBackgroundColor(l)};return P.jsxs("div",{className:"nav-action-group",children:[P.jsx("button",{ref:a,className:`icon-btn ${e?"active":""}`,onClick:()=>t(!e),title:"Canvas Background Color",children:P.jsx(SPe,{size:18})}),e&&P.jsx(bX,{color:s,onChange:o,onClose:()=>t(!1),anchorEl:a.current,align:"right"})]})}function k6e({canvasManager:n,onOpenShortcuts:e,onOpenExport:t,onOpenResize:s}){const{showRulers:r,setShowRulers:a}=Hm();return P.jsxs("nav",{className:"navbar",children:[P.jsxs("div",{className:"nav-left",children:[P.jsx("a",{href:"index.html",className:"icon-btn nav-link-btn",title:"Back to Dashboard",children:P.jsx(rX,{size:20})}),P.jsx("a",{href:"index.html",className:"logo nav-brand",children:"CanvasPro"}),P.jsx("div",{style:{borderRight:"1px solid var(--border-color)",paddingRight:"12px",marginRight:"12px"},children:P.jsxs("button",{id:"btn-open-resize",className:"btn btn-sm",title:"Resize Canvas",onClick:s,children:[P.jsx(oX,{size:16}),P.jsx("span",{children:"Resize"})]})})]}),P.jsxs("div",{className:"nav-center",children:[P.jsx("div",{className:"separator-vertical"}),P.jsx(o6e,{canvasManager:n,onExport:t}),P.jsx("div",{className:"separator-vertical"}),P.jsx(a6e,{canvasManager:n}),P.jsx("div",{className:"separator-vertical"}),P.jsx(r6e,{canvasManager:n})]}),P.jsxs("div",{className:"nav-right nav-right-group",children:[P.jsx("button",{className:"icon-btn",onClick:e,title:"Keyboard Shortcuts",children:P.jsx(dPe,{size:18})}),P.jsx("div",{className:"separator-vertical"}),P.jsx(_6e,{canvasManager:n}),P.jsx("div",{className:"separator-vertical"}),P.jsx(i6e,{canvasManager:n,showRulers:r,setShowRulers:a})]})]})}var T6e=Object.create,vX=Object.defineProperty,N6e=Object.getOwnPropertyDescriptor,wX=Object.getOwnPropertyNames,A6e=Object.getPrototypeOf,E6e=Object.prototype.hasOwnProperty,mF=(n,e)=>function(){return e||(0,n[wX(n)[0]])((e={exports:{}}).exports,e),e.exports},I6e=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of wX(e))!E6e.call(n,r)&&r!==t&&vX(n,r,{get:()=>e[r],enumerable:!(s=N6e(e,r))||s.enumerable});return n},EN=(n,e,t)=>(t=n!=null?T6e(A6e(n)):{},I6e(!n||!n.__esModule?vX(t,"default",{value:n,enumerable:!0}):t,n)),O6e=mF({"../../node_modules/.pnpm/iota-array@1.0.0/node_modules/iota-array/iota.js"(n,e){function t(s){for(var r=new Array(s),a=0;a<s;++a)r[a]=a;return r}e.exports=t}}),D6e=mF({"../../node_modules/.pnpm/is-buffer@1.1.6/node_modules/is-buffer/index.js"(n,e){e.exports=function(r){return r!=null&&(t(r)||s(r)||!!r._isBuffer)};function t(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function s(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&t(r.slice(0,0))}}}),IN=mF({"../../node_modules/.pnpm/ndarray@1.0.19/node_modules/ndarray/ndarray.js"(n,e){var t=O6e(),s=D6e(),r=typeof Float64Array<"u";function a(p,m){return p[0]-m[0]}function o(){var p=this.stride,m=new Array(p.length),g;for(g=0;g<m.length;++g)m[g]=[Math.abs(p[g]),g];m.sort(a);var b=new Array(m.length);for(g=0;g<b.length;++g)b[g]=m[g][1];return b}function l(p,m){var g=["View",m,"d",p].join("");m<0&&(g="View_Nil"+p);var b=p==="generic";if(m===-1){var v="function "+g+"(a){this.data=a;};var proto="+g+".prototype;proto.dtype='"+p+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+g+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+g+"(a){return new "+g+"(a);}",z=new Function(v);return z()}else if(m===0){var v="function "+g+"(a,d) {this.data = a;this.offset = d};var proto="+g+".prototype;proto.dtype='"+p+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+g+"_copy() {return new "+g+"(this.data,this.offset)};proto.pick=function "+g+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+g+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+g+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+g+"(a,b,c,d){return new "+g+"(a,d)}",z=new Function("TrivialArray",v);return z(u[p][0])}var v=["'use strict'"],x=t(m),S=x.map(function(I){return"i"+I}),C="this.offset+"+x.map(function(I){return"this.stride["+I+"]*i"+I}).join("+"),A=x.map(function(I){return"b"+I}).join(","),k=x.map(function(I){return"c"+I}).join(",");v.push("function "+g+"(a,"+A+","+k+",d){this.data=a","this.shape=["+A+"]","this.stride=["+k+"]","this.offset=d|0}","var proto="+g+".prototype","proto.dtype='"+p+"'","proto.dimension="+m),v.push("Object.defineProperty(proto,'size',{get:function "+g+"_size(){return "+x.map(function(I){return"this.shape["+I+"]"}).join("*"),"}})"),m===1?v.push("proto.order=[0]"):(v.push("Object.defineProperty(proto,'order',{get:"),m<4?(v.push("function "+g+"_order(){"),m===2?v.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):m===3&&v.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):v.push("ORDER})")),v.push("proto.set=function "+g+"_set("+S.join(",")+",v){"),b?v.push("return this.data.set("+C+",v)}"):v.push("return this.data["+C+"]=v}"),v.push("proto.get=function "+g+"_get("+S.join(",")+"){"),b?v.push("return this.data.get("+C+")}"):v.push("return this.data["+C+"]}"),v.push("proto.index=function "+g+"_index(",S.join(),"){return "+C+"}"),v.push("proto.hi=function "+g+"_hi("+S.join(",")+"){return new "+g+"(this.data,"+x.map(function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")}).join(",")+","+x.map(function(I){return"this.stride["+I+"]"}).join(",")+",this.offset)}");var O=x.map(function(I){return"a"+I+"=this.shape["+I+"]"}),F=x.map(function(I){return"c"+I+"=this.stride["+I+"]"});v.push("proto.lo=function "+g+"_lo("+S.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+F.join(","));for(var $=0;$<m;++$)v.push("if(typeof i"+$+"==='number'&&i"+$+">=0){d=i"+$+"|0;b+=c"+$+"*d;a"+$+"-=d}");v.push("return new "+g+"(this.data,"+x.map(function(I){return"a"+I}).join(",")+","+x.map(function(I){return"c"+I}).join(",")+",b)}"),v.push("proto.step=function "+g+"_step("+S.join(",")+"){var "+x.map(function(I){return"a"+I+"=this.shape["+I+"]"}).join(",")+","+x.map(function(I){return"b"+I+"=this.stride["+I+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var $=0;$<m;++$)v.push("if(typeof i"+$+"==='number'){d=i"+$+"|0;if(d<0){c+=b"+$+"*(a"+$+"-1);a"+$+"=ceil(-a"+$+"/d)}else{a"+$+"=ceil(a"+$+"/d)}b"+$+"*=d}");v.push("return new "+g+"(this.data,"+x.map(function(I){return"a"+I}).join(",")+","+x.map(function(I){return"b"+I}).join(",")+",c)}");for(var M=new Array(m),R=new Array(m),$=0;$<m;++$)M[$]="a[i"+$+"]",R[$]="b[i"+$+"]";v.push("proto.transpose=function "+g+"_transpose("+S+"){"+S.map(function(I,j){return I+"=("+I+"===undefined?"+j+":"+I+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+g+"(this.data,"+M.join(",")+","+R.join(",")+",this.offset)}"),v.push("proto.pick=function "+g+"_pick("+S+"){var a=[],b=[],c=this.offset");for(var $=0;$<m;++$)v.push("if(typeof i"+$+"==='number'&&i"+$+">=0){c=(c+this.stride["+$+"]*i"+$+")|0}else{a.push(this.shape["+$+"]);b.push(this.stride["+$+"])}");v.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),v.push("return function construct_"+g+"(data,shape,stride,offset){return new "+g+"(data,"+x.map(function(I){return"shape["+I+"]"}).join(",")+","+x.map(function(I){return"stride["+I+"]"}).join(",")+",offset)}");var z=new Function("CTOR_LIST","ORDER",v.join(`
`));return z(u[p],o)}function c(p){if(s(p))return"buffer";if(r)switch(Object.prototype.toString.call(p)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(p)?"array":"generic"}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function d(p,m,g,b){if(p===void 0){var k=u.array[0];return k([])}else typeof p=="number"&&(p=[p]);m===void 0&&(m=[p.length]);var v=m.length;if(g===void 0){g=new Array(v);for(var x=v-1,S=1;x>=0;--x)g[x]=S,S*=m[x]}if(b===void 0){b=0;for(var x=0;x<v;++x)g[x]<0&&(b-=(m[x]-1)*g[x])}for(var C=c(p),A=u[C];A.length<=v+1;)A.push(l(C,A.length-1));var k=A[v+1];return k(p,m,g,b)}e.exports=d}}),$6e=typeof window=="object"&&window&&window.Object===Object&&window,R6e=$6e,L6e=typeof self=="object"&&self&&self.Object===Object&&self,F6e=R6e||L6e||Function("return this")(),gF=F6e,M6e=gF.Symbol,T_=M6e,xX=Object.prototype,P6e=xX.hasOwnProperty,z6e=xX.toString,Ob=T_?T_.toStringTag:void 0;function B6e(n){var e=P6e.call(n,Ob),t=n[Ob];try{n[Ob]=void 0;var s=!0}catch{}var r=z6e.call(n);return s&&(e?n[Ob]=t:delete n[Ob]),r}var j6e=B6e,U6e=Object.prototype,V6e=U6e.toString;function W6e(n){return V6e.call(n)}var H6e=W6e,G6e="[object Null]",q6e="[object Undefined]",yj=T_?T_.toStringTag:void 0;function X6e(n){return n==null?n===void 0?q6e:G6e:yj&&yj in Object(n)?j6e(n):H6e(n)}var Y6e=X6e;function K6e(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var SX=K6e,Z6e="[object AsyncFunction]",J6e="[object Function]",Q6e="[object GeneratorFunction]",e4e="[object Proxy]";function t4e(n){if(!SX(n))return!1;var e=Y6e(n);return e==J6e||e==Q6e||e==Z6e||e==e4e}var n4e=t4e,s4e=gF["__core-js_shared__"],iE=s4e,bj=(function(){var n=/[^.]+$/.exec(iE&&iE.keys&&iE.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r4e(n){return!!bj&&bj in n}var i4e=r4e,a4e=Function.prototype,o4e=a4e.toString;function l4e(n){if(n!=null){try{return o4e.call(n)}catch{}try{return n+""}catch{}}return""}var c4e=l4e,u4e=/[\\^$.*+?()[\]{}|]/g,h4e=/^\[object .+?Constructor\]$/,d4e=Function.prototype,f4e=Object.prototype,p4e=d4e.toString,m4e=f4e.hasOwnProperty,g4e=RegExp("^"+p4e.call(m4e).replace(u4e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function y4e(n){if(!SX(n)||i4e(n))return!1;var e=n4e(n)?g4e:h4e;return e.test(c4e(n))}var b4e=y4e;function v4e(n,e){return n?.[e]}var w4e=v4e;function x4e(n,e){var t=w4e(n,e);return b4e(t)?t:void 0}var CX=x4e,S4e=CX(Object,"create"),Yv=S4e;function C4e(){this.__data__=Yv?Yv(null):{},this.size=0}var _4e=C4e;function k4e(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var T4e=k4e,N4e="__lodash_hash_undefined__",A4e=Object.prototype,E4e=A4e.hasOwnProperty;function I4e(n){var e=this.__data__;if(Yv){var t=e[n];return t===N4e?void 0:t}return E4e.call(e,n)?e[n]:void 0}var O4e=I4e,D4e=Object.prototype,$4e=D4e.hasOwnProperty;function R4e(n){var e=this.__data__;return Yv?e[n]!==void 0:$4e.call(e,n)}var L4e=R4e,F4e="__lodash_hash_undefined__";function M4e(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Yv&&e===void 0?F4e:e,this}var P4e=M4e;function Fy(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}Fy.prototype.clear=_4e;Fy.prototype.delete=T4e;Fy.prototype.get=O4e;Fy.prototype.has=L4e;Fy.prototype.set=P4e;var vj=Fy;function z4e(){this.__data__=[],this.size=0}var B4e=z4e;function j4e(n,e){return n===e||n!==n&&e!==e}var U4e=j4e;function V4e(n,e){for(var t=n.length;t--;)if(U4e(n[t][0],e))return t;return-1}var ON=V4e,W4e=Array.prototype,H4e=W4e.splice;function G4e(n){var e=this.__data__,t=ON(e,n);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():H4e.call(e,t,1),--this.size,!0}var q4e=G4e;function X4e(n){var e=this.__data__,t=ON(e,n);return t<0?void 0:e[t][1]}var Y4e=X4e;function K4e(n){return ON(this.__data__,n)>-1}var Z4e=K4e;function J4e(n,e){var t=this.__data__,s=ON(t,n);return s<0?(++this.size,t.push([n,e])):t[s][1]=e,this}var Q4e=J4e;function My(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}My.prototype.clear=B4e;My.prototype.delete=q4e;My.prototype.get=Y4e;My.prototype.has=Z4e;My.prototype.set=Q4e;var eze=My,tze=CX(gF,"Map"),nze=tze;function sze(){this.size=0,this.__data__={hash:new vj,map:new(nze||eze),string:new vj}}var rze=sze;function ize(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var aze=ize;function oze(n,e){var t=n.__data__;return aze(e)?t[typeof e=="string"?"string":"hash"]:t.map}var DN=oze;function lze(n){var e=DN(this,n).delete(n);return this.size-=e?1:0,e}var cze=lze;function uze(n){return DN(this,n).get(n)}var hze=uze;function dze(n){return DN(this,n).has(n)}var fze=dze;function pze(n,e){var t=DN(this,n),s=t.size;return t.set(n,e),this.size+=t.size==s?0:1,this}var mze=pze;function Py(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}Py.prototype.clear=rze;Py.prototype.delete=cze;Py.prototype.get=hze;Py.prototype.has=fze;Py.prototype.set=mze;var _X=Py,gze="Expected a function";function yF(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(gze);var t=function(){var s=arguments,r=e?e.apply(this,s):s[0],a=t.cache;if(a.has(r))return a.get(r);var o=n.apply(this,s);return t.cache=a.set(r,o)||a,o};return t.cache=new(yF.Cache||_X),t}yF.Cache=_X;var yze=yF,bF=EN(IN()),kX=class qI{constructor(e,t){this.type="application/octet-stream",this.params={},this.type=e,this.params=t}toString(){const e=[];for(const t in this.params){const s=this.params[t];e.push(`${t}=${s}`)}return[this.type,...e].join(";")}static create(e,t){return new qI(e,t)}isIdentical(e){return this.type===e.type&&this.params===e.params}isEqual(e){return this.type===e.type}static fromString(e){const[t,...s]=e.split(";"),r={};for(const a of s){const[o,l]=a.split("=");r[o.trim()]=l.trim()}return new qI(t,r)}},aE=EN(IN());async function bze(n){const e=kX.fromString(n.type);switch(e.type){case"image/x-alpha8":{const t=parseInt(e.params.width),s=parseInt(e.params.height);return(0,aE.default)(new Uint8Array(await n.arrayBuffer()),[s,t,1])}case"image/x-rgba8":{const t=parseInt(e.params.width),s=parseInt(e.params.height);return(0,aE.default)(new Uint8Array(await n.arrayBuffer()),[s,t,4])}case"application/octet-stream":case"image/png":case"image/jpeg":case"image/jpg":case"image/webp":{const t=await createImageBitmap(n),s=xze(t);return(0,aE.default)(new Uint8Array(s.data),[s.height,s.width,4])}default:throw new Error(`Invalid format: ${e.type} with params: ${e.params}`)}}async function $N(n,e=.8,t="image/png"){const[s,r,a]=n.shape;switch(t){case"image/x-alpha8":case"image/x-rgba8":{const c=kX.create(t,{width:r.toString(),height:s.toString()});return new Blob([n.data],{type:c.toString()})}case"image/png":case"image/jpeg":case"image/webp":{const c=new ImageData(new Uint8ClampedArray(n.data),r,s);var o=TX(c.width,c.height),l=o.getContext("2d");return l.putImageData(c,0,0),o.convertToBlob({quality:e,type:t})}default:throw new Error(`Invalid format: ${t}`)}}function vze(n){return new RegExp("^(?:[a-z+]+:)?//","i").test(n)}function wze(n,e){return vze(n)?n:new URL(n,e).href}function xze(n){var e=TX(n.width,n.height),t=e.getContext("2d");return t.drawImage(n,0,0),t.getImageData(0,0,e.width,e.height)}function Sze(n){if(typeof Uint8Array<"u")return new Uint8Array(n);if(typeof Uint8ClampedArray<"u")return new Uint8ClampedArray(n);if(typeof Uint16Array<"u")return new Uint16Array(n);if(typeof Uint32Array<"u")return new Uint32Array(n);if(typeof Float32Array<"u")return new Float32Array(n);if(typeof Float64Array<"u")return new Float64Array(n);throw new Error("TypedArray not supported")}function XI(n,e,t,s=!1){const[r,a,o]=n.shape;let l=a/e,c=r/t;s&&(l=c=Math.max(l,c)>1?Math.max(l,c):Math.min(l,c));const u=(0,bF.default)(Sze(o*e*t),[t,e,o]);for(let d=0;d<t;d++)for(let p=0;p<e;p++){const m=p*l,g=d*c,b=Math.max(Math.floor(m),0),v=Math.min(Math.ceil(m),a-1),x=Math.max(Math.floor(g),0),S=Math.min(Math.ceil(g),r-1),C=m-b,A=g-x;for(let k=0;k<o;k++){const O=n.get(x,b,k),F=n.get(x,v,k),$=n.get(S,b,k),M=n.get(S,v,k),R=(1-C)*(1-A)*O+C*(1-A)*F+(1-C)*A*$+C*A*M;u.set(d,p,k,R)}}return u}function Cze(n,e=[128,128,128],t=[256,256,256]){var s=n.data;const[r,a,o]=n.shape,l=r*a,c=new Float32Array(3*l);for(let u=0,d=0;u<s.length;u+=4,d+=1)c[d]=(s[u]-e[0])/t[0],c[d+l]=(s[u+1]-e[1])/t[1],c[d+l+l]=(s[u+2]-e[2])/t[2];return(0,bF.default)(c,[1,3,r,a])}async function Kv(n,e){return typeof n=="string"&&(n=wze(n,e.publicPath),n=new URL(n)),n instanceof URL&&(n=await(await fetch(n,{})).blob()),(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n=new Blob([n])),n instanceof Blob&&(n=await bze(n)),n}function _ze(n){const e=new Uint8Array(n.data.length);for(let t=0;t<n.data.length;t++)e[t]=n.data[t]*255;return(0,bF.default)(e,n.shape)}function TX(n,e){let t;if(typeof OffscreenCanvas<"u"?t=new OffscreenCanvas(n,e):t=document.createElement("canvas"),!t)throw new Error("Canvas nor OffscreenCanvas are available in the current context.");return t}var kze=EN(IN()),NX=async()=>navigator.gpu===void 0?!1:await navigator.gpu.requestAdapter()!==null,Tze=()=>navigator.hardwareConcurrency??4;async function wj(n,e){return URL.createObjectURL(await AX(n,e))}async function AX(n,e){const t=new URL("resources.json",e.publicPath),s=await fetch(t);if(!s.ok)throw new Error("Resource metadata not found. Ensure that the config.publicPath is configured correctly.");const a=(await s.json())[n];if(!a)throw new Error(`Resource ${n} not found. Ensure that the config.publicPath is configured correctly.`);const o=a.chunks;let l=0;const c=o.map(async p=>{const m=p.offsets[1]-p.offsets[0],g=e.publicPath?new URL(p.name,e.publicPath).toString():p.name,v=await(await fetch(g,e.fetchArgs)).blob();if(m!==v.size)throw new Error(`Failed to fetch ${n} with size ${m} but got ${v.size}`);return e.progress&&(l+=m,e.progress(`fetch:${n}`,l,a.size)),v}),u=await Promise.all(c),d=new Blob(u,{type:a.mime});if(d.size!==a.size)throw new Error(`Failed to fetch ${n} with size ${a.size} but got ${d.size}`);return d}var Db=null,EX=async n=>(Db!==null||(n?Db=(await fv(async()=>{const{default:e}=await import("./ort.webgpu.bundle.min-YF0fTuDQ.js");return{default:e}},[],import.meta.url)).default:Db=(await fv(async()=>{const{default:e}=await import("./ort.bundle.min-DxUtdDM1.js");return{default:e}},[],import.meta.url)).default),Db);async function Nze(n,e){const t=e.device==="gpu"&&await NX(),s=t&&e.proxyToWorker,r=[t?"webgpu":"wasm"],a=await EX(t);e.debug&&(console.debug("	Using WebGPU:",t),console.debug("	Proxy to Worker:",s),a.env.debug=!0,a.env.logLevel="verbose"),a.env.wasm.numThreads=Tze(),a.env.wasm.proxy=s;const o=t?"/onnxruntime-web/ort-wasm-simd-threaded.jsep":"/onnxruntime-web/ort-wasm-simd-threaded",l=await wj(`${o}.wasm`,e),c=await wj(`${o}.mjs`,e);a.env.wasm.wasmPaths={mjs:c,wasm:l},e.debug&&console.debug("ort.env.wasm:",a.env.wasm);const u={executionProviders:r,graphOptimizationLevel:"all",executionMode:"parallel",enableCpuMemArena:!0};return await a.InferenceSession.create(n,u).catch(p=>{throw new Error(`Failed to create session: "${p}". Please check if the publicPath is set correctly.`)})}async function Aze(n,e,t,s){const r=s.device==="gpu"&&await NX(),a=await EX(r),o={};for(const[u,d]of e)o[u]=new a.Tensor("float32",new Float32Array(d.data),d.shape);const l=await n.run(o,{}),c=[];for(const u of t){const d=l[u],p=d.dims,m=d.data,g=(0,kze.default)(m,p);c.push(g)}return c}var os;(function(n){n.assertEqual=r=>r;function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const a={};for(const o of r)a[o]=o;return a},n.getValidEnumValues=r=>{const a=n.objectKeys(r).filter(l=>typeof r[r[l]]!="number"),o={};for(const l of a)o[l]=r[l];return n.objectValues(o)},n.objectValues=r=>n.objectKeys(r).map(function(a){return r[a]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const a=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&a.push(o);return a},n.find=(r,a)=>{for(const o of r)if(a(o))return o},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function s(r,a=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}n.joinValues=s,n.jsonStringifyReplacer=(r,a)=>typeof a=="bigint"?a.toString():a})(os||(os={}));var YI;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(YI||(YI={}));var kt=os.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),hd=n=>{switch(typeof n){case"undefined":return kt.undefined;case"string":return kt.string;case"number":return isNaN(n)?kt.nan:kt.number;case"boolean":return kt.boolean;case"function":return kt.function;case"bigint":return kt.bigint;case"symbol":return kt.symbol;case"object":return Array.isArray(n)?kt.array:n===null?kt.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?kt.promise:typeof Map<"u"&&n instanceof Map?kt.map:typeof Set<"u"&&n instanceof Set?kt.set:typeof Date<"u"&&n instanceof Date?kt.date:kt.object;default:return kt.unknown}},dt=os.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Eze=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),hu=class IX extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},s={_errors:[]},r=a=>{for(const o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let l=s,c=0;for(;c<o.path.length;){const u=o.path[c];c===o.path.length-1?(l[u]=l[u]||{_errors:[]},l[u]._errors.push(t(o))):l[u]=l[u]||{_errors:[]},l=l[u],c++}}};return r(this),s}static assert(e){if(!(e instanceof IX))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,os.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};hu.create=n=>new hu(n);var n1=(n,e)=>{let t;switch(n.code){case dt.invalid_type:n.received===kt.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case dt.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,os.jsonStringifyReplacer)}`;break;case dt.unrecognized_keys:t=`Unrecognized key(s) in object: ${os.joinValues(n.keys,", ")}`;break;case dt.invalid_union:t="Invalid input";break;case dt.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${os.joinValues(n.options)}`;break;case dt.invalid_enum_value:t=`Invalid enum value. Expected ${os.joinValues(n.options)}, received '${n.received}'`;break;case dt.invalid_arguments:t="Invalid function arguments";break;case dt.invalid_return_type:t="Invalid function return type";break;case dt.invalid_date:t="Invalid date";break;case dt.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:os.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case dt.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case dt.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case dt.custom:t="Invalid input";break;case dt.invalid_intersection_types:t="Intersection results could not be merged";break;case dt.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case dt.not_finite:t="Number must be finite";break;default:t=e.defaultError,os.assertNever(n)}return{message:t}},OX=n1;function Ize(n){OX=n}function N_(){return OX}var A_=n=>{const{data:e,path:t,errorMaps:s,issueData:r}=n,a=[...t,...r.path||[]],o={...r,path:a};if(r.message!==void 0)return{...r,path:a,message:r.message};let l="";const c=s.filter(u=>!!u).slice().reverse();for(const u of c)l=u(o,{data:e,defaultError:l}).message;return{...r,path:a,message:l}},Oze=[];function wt(n,e){const t=N_(),s=A_({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===n1?void 0:n1].filter(r=>!!r)});n.common.issues.push(s)}var Ko=class DX{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if(r.status==="aborted")return yn;r.status==="dirty"&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const a=await r.key,o=await r.value;s.push({key:a,value:o})}return DX.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:a,value:o}=r;if(a.status==="aborted"||o.status==="aborted")return yn;a.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(s[a.value]=o.value)}return{status:e.value,value:s}}},yn=Object.freeze({status:"aborted"}),_0=n=>({status:"dirty",value:n}),mo=n=>({status:"valid",value:n}),KI=n=>n.status==="aborted",ZI=n=>n.status==="dirty",Gm=n=>n.status==="valid",Zv=n=>typeof Promise<"u"&&n instanceof Promise;function E_(n,e,t,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function $X(n,e,t,s,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var Vt;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(Vt||(Vt={}));var iv,av,Ch=class{constructor(n,e,t,s){this._cachedPath=[],this.parent=n,this.data=e,this._path=t,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},xj=(n,e)=>{if(Gm(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new hu(n.common.issues);return this._error=t,this._error}}};function $n(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:r}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,l)=>{var c,u;const{message:d}=n;return o.code==="invalid_enum_value"?{message:d??l.defaultError}:typeof l.data>"u"?{message:(c=d??s)!==null&&c!==void 0?c:l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:(u=d??t)!==null&&u!==void 0?u:l.defaultError}},description:r}}var zn=class{get description(){return this._def.description}_getType(n){return hd(n.data)}_getOrReturnCtx(n,e){return e||{common:n.parent.common,data:n.data,parsedType:hd(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}_processInputParams(n){return{status:new Ko,ctx:{common:n.parent.common,data:n.data,parsedType:hd(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}}_parseSync(n){const e=this._parse(n);if(Zv(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(n){const e=this._parse(n);return Promise.resolve(e)}parse(n,e){const t=this.safeParse(n,e);if(t.success)return t.data;throw t.error}safeParse(n,e){var t;const s={common:{issues:[],async:(t=e?.async)!==null&&t!==void 0?t:!1,contextualErrorMap:e?.errorMap},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:hd(n)},r=this._parseSync({data:n,path:s.path,parent:s});return xj(s,r)}"~validate"(n){var e,t;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:hd(n)};if(!this["~standard"].async)try{const r=this._parseSync({data:n,path:[],parent:s});return Gm(r)?{value:r.value}:{issues:s.common.issues}}catch(r){!((t=(e=r?.message)===null||e===void 0?void 0:e.toLowerCase())===null||t===void 0)&&t.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:n,path:[],parent:s}).then(r=>Gm(r)?{value:r.value}:{issues:s.common.issues})}async parseAsync(n,e){const t=await this.safeParseAsync(n,e);if(t.success)return t.data;throw t.error}async safeParseAsync(n,e){const t={common:{issues:[],contextualErrorMap:e?.errorMap,async:!0},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:hd(n)},s=this._parse({data:n,path:t.path,parent:t}),r=await(Zv(s)?s:Promise.resolve(s));return xj(t,r)}refine(n,e){const t=s=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(s):e;return this._refinement((s,r)=>{const a=n(s),o=()=>r.addIssue({code:dt.custom,...t(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(n,e){return this._refinement((t,s)=>n(t)?!0:(s.addIssue(typeof e=="function"?e(t,s):e),!1))}_refinement(n){return new vu({schema:this,typeName:pn.ZodEffects,effect:{type:"refinement",refinement:n}})}superRefine(n){return this._refinement(n)}constructor(n){this.spa=this.safeParseAsync,this._def=n,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ph.create(this,this._def)}nullable(){return ep.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return qm.create(this)}promise(){return i1.create(this,this._def)}or(n){return rw.create([this,n],this._def)}and(n){return iw.create(this,n,this._def)}transform(n){return new vu({...$n(this._def),schema:this,typeName:pn.ZodEffects,effect:{type:"transform",transform:n}})}default(n){const e=typeof n=="function"?n:()=>n;return new cw({...$n(this._def),innerType:this,defaultValue:e,typeName:pn.ZodDefault})}brand(){return new vF({typeName:pn.ZodBranded,type:this,...$n(this._def)})}catch(n){const e=typeof n=="function"?n:()=>n;return new uw({...$n(this._def),innerType:this,catchValue:e,typeName:pn.ZodCatch})}describe(n){const e=this.constructor;return new e({...this._def,description:n})}pipe(n){return wF.create(this,n)}readonly(){return hw.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Dze=/^c[^\s-]{8,}$/i,$ze=/^[0-9a-z]+$/,Rze=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Lze=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Fze=/^[a-z0-9_-]{21}$/i,Mze=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Pze=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,zze=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Bze="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",oE,jze=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Uze=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Vze=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Wze=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Hze=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Gze=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,RX="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",qze=new RegExp(`^${RX}$`);function LX(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Xze(n){return new RegExp(`^${LX(n)}$`)}function FX(n){let e=`${RX}T${LX(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Yze(n,e){return!!((e==="v4"||!e)&&jze.test(n)||(e==="v6"||!e)&&Vze.test(n))}function Kze(n,e){if(!Mze.test(n))return!1;try{const[t]=n.split("."),s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(s));return!(typeof r!="object"||r===null||!r.typ||!r.alg||e&&r.alg!==e)}catch{return!1}}function Zze(n,e){return!!((e==="v4"||!e)&&Uze.test(n)||(e==="v6"||!e)&&Wze.test(n))}var s1=class ov extends zn{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==kt.string){const a=this._getOrReturnCtx(e);return wt(a,{code:dt.invalid_type,expected:kt.string,received:a.parsedType}),yn}const s=new Ko;let r;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="max")e.data.length>a.value&&(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,l=e.data.length<a.value;(o||l)&&(r=this._getOrReturnCtx(e,r),o?wt(r,{code:dt.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):l&&wt(r,{code:dt.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),s.dirty())}else if(a.kind==="email")zze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"email",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="emoji")oE||(oE=new RegExp(Bze,"u")),oE.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"emoji",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="uuid")Lze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"uuid",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="nanoid")Fze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"nanoid",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid")Dze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"cuid",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid2")$ze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"cuid2",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="ulid")Rze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"ulid",code:dt.invalid_string,message:a.message}),s.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),wt(r,{validation:"url",code:dt.invalid_string,message:a.message}),s.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"regex",code:dt.invalid_string,message:a.message}),s.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),s.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.invalid_string,validation:{startsWith:a.value},message:a.message}),s.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.invalid_string,validation:{endsWith:a.value},message:a.message}),s.dirty()):a.kind==="datetime"?FX(a).test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.invalid_string,validation:"datetime",message:a.message}),s.dirty()):a.kind==="date"?qze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.invalid_string,validation:"date",message:a.message}),s.dirty()):a.kind==="time"?Xze(a).test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.invalid_string,validation:"time",message:a.message}),s.dirty()):a.kind==="duration"?Pze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"duration",code:dt.invalid_string,message:a.message}),s.dirty()):a.kind==="ip"?Yze(e.data,a.version)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"ip",code:dt.invalid_string,message:a.message}),s.dirty()):a.kind==="jwt"?Kze(e.data,a.alg)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"jwt",code:dt.invalid_string,message:a.message}),s.dirty()):a.kind==="cidr"?Zze(e.data,a.version)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"cidr",code:dt.invalid_string,message:a.message}),s.dirty()):a.kind==="base64"?Hze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"base64",code:dt.invalid_string,message:a.message}),s.dirty()):a.kind==="base64url"?Gze.test(e.data)||(r=this._getOrReturnCtx(e,r),wt(r,{validation:"base64url",code:dt.invalid_string,message:a.message}),s.dirty()):os.assertNever(a);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(r=>e.test(r),{validation:t,code:dt.invalid_string,...Vt.errToObj(s)})}_addCheck(e){return new ov({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Vt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Vt.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Vt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Vt.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Vt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Vt.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Vt.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Vt.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Vt.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Vt.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Vt.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Vt.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Vt.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(s=e?.local)!==null&&s!==void 0?s:!1,...Vt.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...Vt.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Vt.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Vt.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Vt.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Vt.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Vt.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Vt.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Vt.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Vt.errToObj(t)})}nonempty(e){return this.min(1,Vt.errToObj(e))}trim(){return new ov({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ov({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ov({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};s1.create=n=>{var e;return new s1({checks:[],typeName:pn.ZodString,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...$n(n)})};function Jze(n,e){const t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,r=t>s?t:s,a=parseInt(n.toFixed(r).replace(".","")),o=parseInt(e.toFixed(r).replace(".",""));return a%o/Math.pow(10,r)}var Jv=class JI extends zn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==kt.number){const a=this._getOrReturnCtx(e);return wt(a,{code:dt.invalid_type,expected:kt.number,received:a.parsedType}),yn}let s;const r=new Ko;for(const a of this._def.checks)a.kind==="int"?os.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="multipleOf"?Jze(e.data,a.value)!==0&&(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.not_finite,message:a.message}),r.dirty()):os.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Vt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Vt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Vt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Vt.toString(t))}setLimit(e,t,s,r){return new JI({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Vt.toString(r)}]})}_addCheck(e){return new JI({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Vt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Vt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Vt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Vt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Vt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Vt.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Vt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Vt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Vt.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&os.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Jv.create=n=>new Jv({checks:[],typeName:pn.ZodNumber,coerce:n?.coerce||!1,...$n(n)});var Qv=class QI extends zn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==kt.bigint)return this._getInvalidInput(e);let s;const r=new Ko;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),wt(s,{code:dt.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):os.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return wt(t,{code:dt.invalid_type,expected:kt.bigint,received:t.parsedType}),yn}gte(e,t){return this.setLimit("min",e,!0,Vt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Vt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Vt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Vt.toString(t))}setLimit(e,t,s,r){return new QI({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Vt.toString(r)}]})}_addCheck(e){return new QI({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Vt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Vt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Vt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Vt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Vt.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Qv.create=n=>{var e;return new Qv({checks:[],typeName:pn.ZodBigInt,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...$n(n)})};var ew=class extends zn{_parse(n){if(this._def.coerce&&(n.data=!!n.data),this._getType(n)!==kt.boolean){const t=this._getOrReturnCtx(n);return wt(t,{code:dt.invalid_type,expected:kt.boolean,received:t.parsedType}),yn}return mo(n.data)}};ew.create=n=>new ew({typeName:pn.ZodBoolean,coerce:n?.coerce||!1,...$n(n)});var tw=class MX extends zn{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==kt.date){const a=this._getOrReturnCtx(e);return wt(a,{code:dt.invalid_type,expected:kt.date,received:a.parsedType}),yn}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return wt(a,{code:dt.invalid_date}),yn}const s=new Ko;let r;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(r=this._getOrReturnCtx(e,r),wt(r,{code:dt.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):os.assertNever(a);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new MX({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Vt.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Vt.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};tw.create=n=>new tw({checks:[],coerce:n?.coerce||!1,typeName:pn.ZodDate,...$n(n)});var I_=class extends zn{_parse(n){if(this._getType(n)!==kt.symbol){const t=this._getOrReturnCtx(n);return wt(t,{code:dt.invalid_type,expected:kt.symbol,received:t.parsedType}),yn}return mo(n.data)}};I_.create=n=>new I_({typeName:pn.ZodSymbol,...$n(n)});var nw=class extends zn{_parse(n){if(this._getType(n)!==kt.undefined){const t=this._getOrReturnCtx(n);return wt(t,{code:dt.invalid_type,expected:kt.undefined,received:t.parsedType}),yn}return mo(n.data)}};nw.create=n=>new nw({typeName:pn.ZodUndefined,...$n(n)});var sw=class extends zn{_parse(n){if(this._getType(n)!==kt.null){const t=this._getOrReturnCtx(n);return wt(t,{code:dt.invalid_type,expected:kt.null,received:t.parsedType}),yn}return mo(n.data)}};sw.create=n=>new sw({typeName:pn.ZodNull,...$n(n)});var r1=class extends zn{constructor(){super(...arguments),this._any=!0}_parse(n){return mo(n.data)}};r1.create=n=>new r1({typeName:pn.ZodAny,...$n(n)});var wm=class extends zn{constructor(){super(...arguments),this._unknown=!0}_parse(n){return mo(n.data)}};wm.create=n=>new wm({typeName:pn.ZodUnknown,...$n(n)});var Nd=class extends zn{_parse(n){const e=this._getOrReturnCtx(n);return wt(e,{code:dt.invalid_type,expected:kt.never,received:e.parsedType}),yn}};Nd.create=n=>new Nd({typeName:pn.ZodNever,...$n(n)});var O_=class extends zn{_parse(n){if(this._getType(n)!==kt.undefined){const t=this._getOrReturnCtx(n);return wt(t,{code:dt.invalid_type,expected:kt.void,received:t.parsedType}),yn}return mo(n.data)}};O_.create=n=>new O_({typeName:pn.ZodVoid,...$n(n)});var qm=class mC extends zn{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==kt.array)return wt(t,{code:dt.invalid_type,expected:kt.array,received:t.parsedType}),yn;if(r.exactLength!==null){const o=t.data.length>r.exactLength.value,l=t.data.length<r.exactLength.value;(o||l)&&(wt(t,{code:o?dt.too_big:dt.too_small,minimum:l?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(wt(t,{code:dt.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(wt(t,{code:dt.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,l)=>r.type._parseAsync(new Ch(t,o,t.path,l)))).then(o=>Ko.mergeArray(s,o));const a=[...t.data].map((o,l)=>r.type._parseSync(new Ch(t,o,t.path,l)));return Ko.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new mC({...this._def,minLength:{value:e,message:Vt.toString(t)}})}max(e,t){return new mC({...this._def,maxLength:{value:e,message:Vt.toString(t)}})}length(e,t){return new mC({...this._def,exactLength:{value:e,message:Vt.toString(t)}})}nonempty(e){return this.min(1,e)}};qm.create=(n,e)=>new qm({type:n,minLength:null,maxLength:null,exactLength:null,typeName:pn.ZodArray,...$n(e)});function b0(n){if(n instanceof gc){const e={};for(const t in n.shape){const s=n.shape[t];e[t]=ph.create(b0(s))}return new gc({...n._def,shape:()=>e})}else return n instanceof qm?new qm({...n._def,type:b0(n.element)}):n instanceof ph?ph.create(b0(n.unwrap())):n instanceof ep?ep.create(b0(n.unwrap())):n instanceof Qf?Qf.create(n.items.map(e=>b0(e))):n}var gc=class Zc extends zn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=os.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==kt.object){const u=this._getOrReturnCtx(e);return wt(u,{code:dt.invalid_type,expected:kt.object,received:u.parsedType}),yn}const{status:s,ctx:r}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Nd&&this._def.unknownKeys==="strip"))for(const u in r.data)o.includes(u)||l.push(u);const c=[];for(const u of o){const d=a[u],p=r.data[u];c.push({key:{status:"valid",value:u},value:d._parse(new Ch(r,p,r.path,u)),alwaysSet:u in r.data})}if(this._def.catchall instanceof Nd){const u=this._def.unknownKeys;if(u==="passthrough")for(const d of l)c.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(u==="strict")l.length>0&&(wt(r,{code:dt.unrecognized_keys,keys:l}),s.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const d of l){const p=r.data[d];c.push({key:{status:"valid",value:d},value:u._parse(new Ch(r,p,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const u=[];for(const d of c){const p=await d.key,m=await d.value;u.push({key:p,value:m,alwaysSet:d.alwaysSet})}return u}).then(u=>Ko.mergeObjectSync(s,u)):Ko.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return Vt.errToObj,new Zc({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var r,a,o,l;const c=(o=(a=(r=this._def).errorMap)===null||a===void 0?void 0:a.call(r,t,s).message)!==null&&o!==void 0?o:s.defaultError;return t.code==="unrecognized_keys"?{message:(l=Vt.errToObj(e).message)!==null&&l!==void 0?l:c}:{message:c}}}:{}})}strip(){return new Zc({...this._def,unknownKeys:"strip"})}passthrough(){return new Zc({...this._def,unknownKeys:"passthrough"})}extend(e){return new Zc({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Zc({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:pn.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Zc({...this._def,catchall:e})}pick(e){const t={};return os.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new Zc({...this._def,shape:()=>t})}omit(e){const t={};return os.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new Zc({...this._def,shape:()=>t})}deepPartial(){return b0(this)}partial(e){const t={};return os.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}),new Zc({...this._def,shape:()=>t})}required(e){const t={};return os.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let a=this.shape[s];for(;a instanceof ph;)a=a._def.innerType;t[s]=a}}),new Zc({...this._def,shape:()=>t})}keyof(){return VX(os.objectKeys(this.shape))}};gc.create=(n,e)=>new gc({shape:()=>n,unknownKeys:"strip",catchall:Nd.create(),typeName:pn.ZodObject,...$n(e)});gc.strictCreate=(n,e)=>new gc({shape:()=>n,unknownKeys:"strict",catchall:Nd.create(),typeName:pn.ZodObject,...$n(e)});gc.lazycreate=(n,e)=>new gc({shape:n,unknownKeys:"strip",catchall:Nd.create(),typeName:pn.ZodObject,...$n(e)});var rw=class extends zn{_parse(n){const{ctx:e}=this._processInputParams(n),t=this._def.options;function s(r){for(const o of r)if(o.result.status==="valid")return o.result;for(const o of r)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;const a=r.map(o=>new hu(o.ctx.common.issues));return wt(e,{code:dt.invalid_union,unionErrors:a}),yn}if(e.common.async)return Promise.all(t.map(async r=>{const a={...e,common:{...e.common,issues:[]},parent:null};return{result:await r._parseAsync({data:e.data,path:e.path,parent:a}),ctx:a}})).then(s);{let r;const a=[];for(const l of t){const c={...e,common:{...e.common,issues:[]},parent:null},u=l._parseSync({data:e.data,path:e.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!r&&(r={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(r)return e.common.issues.push(...r.ctx.common.issues),r.result;const o=a.map(l=>new hu(l));return wt(e,{code:dt.invalid_union,unionErrors:o}),yn}}get options(){return this._def.options}};rw.create=(n,e)=>new rw({options:n,typeName:pn.ZodUnion,...$n(e)});var id=n=>n instanceof aw?id(n.schema):n instanceof vu?id(n.innerType()):n instanceof ow?[n.value]:n instanceof dx?n.options:n instanceof lw?os.objectValues(n.enum):n instanceof cw?id(n._def.innerType):n instanceof nw?[void 0]:n instanceof sw?[null]:n instanceof ph?[void 0,...id(n.unwrap())]:n instanceof ep?[null,...id(n.unwrap())]:n instanceof vF||n instanceof hw?id(n.unwrap()):n instanceof uw?id(n._def.innerType):[],PX=class zX extends zn{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kt.object)return wt(t,{code:dt.invalid_type,expected:kt.object,received:t.parsedType}),yn;const s=this.discriminator,r=t.data[s],a=this.optionsMap.get(r);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(wt(t,{code:dt.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),yn)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const r=new Map;for(const a of t){const o=id(a.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const l of o){if(r.has(l))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(l)}`);r.set(l,a)}}return new zX({typeName:pn.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...$n(s)})}};function eO(n,e){const t=hd(n),s=hd(e);if(n===e)return{valid:!0,data:n};if(t===kt.object&&s===kt.object){const r=os.objectKeys(e),a=os.objectKeys(n).filter(l=>r.indexOf(l)!==-1),o={...n,...e};for(const l of a){const c=eO(n[l],e[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(t===kt.array&&s===kt.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let a=0;a<n.length;a++){const o=n[a],l=e[a],c=eO(o,l);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===kt.date&&s===kt.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var iw=class extends zn{_parse(n){const{status:e,ctx:t}=this._processInputParams(n),s=(r,a)=>{if(KI(r)||KI(a))return yn;const o=eO(r.value,a.value);return o.valid?((ZI(r)||ZI(a))&&e.dirty(),{status:e.value,value:o.data}):(wt(t,{code:dt.invalid_intersection_types}),yn)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([r,a])=>s(r,a)):s(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}};iw.create=(n,e,t)=>new iw({left:n,right:e,typeName:pn.ZodIntersection,...$n(t)});var Qf=class BX extends zn{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==kt.array)return wt(s,{code:dt.invalid_type,expected:kt.array,received:s.parsedType}),yn;if(s.data.length<this._def.items.length)return wt(s,{code:dt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),yn;!this._def.rest&&s.data.length>this._def.items.length&&(wt(s,{code:dt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new Ch(s,o,s.path,l)):null}).filter(o=>!!o);return s.common.async?Promise.all(a).then(o=>Ko.mergeArray(t,o)):Ko.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new BX({...this._def,rest:e})}};Qf.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Qf({items:n,typeName:pn.ZodTuple,rest:null,...$n(e)})};var jX=class tO extends zn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==kt.object)return wt(s,{code:dt.invalid_type,expected:kt.object,received:s.parsedType}),yn;const r=[],a=this._def.keyType,o=this._def.valueType;for(const l in s.data)r.push({key:a._parse(new Ch(s,l,s.path,l)),value:o._parse(new Ch(s,s.data[l],s.path,l)),alwaysSet:l in s.data});return s.common.async?Ko.mergeObjectAsync(t,r):Ko.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof zn?new tO({keyType:e,valueType:t,typeName:pn.ZodRecord,...$n(s)}):new tO({keyType:s1.create(),valueType:e,typeName:pn.ZodRecord,...$n(t)})}},D_=class extends zn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(n){const{status:e,ctx:t}=this._processInputParams(n);if(t.parsedType!==kt.map)return wt(t,{code:dt.invalid_type,expected:kt.map,received:t.parsedType}),yn;const s=this._def.keyType,r=this._def.valueType,a=[...t.data.entries()].map(([o,l],c)=>({key:s._parse(new Ch(t,o,t.path,[c,"key"])),value:r._parse(new Ch(t,l,t.path,[c,"value"]))}));if(t.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return yn;(c.status==="dirty"||u.status==="dirty")&&e.dirty(),o.set(c.value,u.value)}return{status:e.value,value:o}})}else{const o=new Map;for(const l of a){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return yn;(c.status==="dirty"||u.status==="dirty")&&e.dirty(),o.set(c.value,u.value)}return{status:e.value,value:o}}}};D_.create=(n,e,t)=>new D_({valueType:e,keyType:n,typeName:pn.ZodMap,...$n(t)});var $_=class nO extends zn{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==kt.set)return wt(s,{code:dt.invalid_type,expected:kt.set,received:s.parsedType}),yn;const r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(wt(s,{code:dt.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(wt(s,{code:dt.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function o(c){const u=new Set;for(const d of c){if(d.status==="aborted")return yn;d.status==="dirty"&&t.dirty(),u.add(d.value)}return{status:t.value,value:u}}const l=[...s.data.values()].map((c,u)=>a._parse(new Ch(s,c,s.path,u)));return s.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(e,t){return new nO({...this._def,minSize:{value:e,message:Vt.toString(t)}})}max(e,t){return new nO({...this._def,maxSize:{value:e,message:Vt.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};$_.create=(n,e)=>new $_({valueType:n,minSize:null,maxSize:null,typeName:pn.ZodSet,...$n(e)});var UX=class gC extends zn{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kt.function)return wt(t,{code:dt.invalid_type,expected:kt.function,received:t.parsedType}),yn;function s(l,c){return A_({data:l,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,N_(),n1].filter(u=>!!u),issueData:{code:dt.invalid_arguments,argumentsError:c}})}function r(l,c){return A_({data:l,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,N_(),n1].filter(u=>!!u),issueData:{code:dt.invalid_return_type,returnTypeError:c}})}const a={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof i1){const l=this;return mo(async function(...c){const u=new hu([]),d=await l._def.args.parseAsync(c,a).catch(g=>{throw u.addIssue(s(c,g)),u}),p=await Reflect.apply(o,this,d);return await l._def.returns._def.type.parseAsync(p,a).catch(g=>{throw u.addIssue(r(p,g)),u})})}else{const l=this;return mo(function(...c){const u=l._def.args.safeParse(c,a);if(!u.success)throw new hu([s(c,u.error)]);const d=Reflect.apply(o,this,u.data),p=l._def.returns.safeParse(d,a);if(!p.success)throw new hu([r(d,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new gC({...this._def,args:Qf.create(e).rest(wm.create())})}returns(e){return new gC({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new gC({args:e||Qf.create([]).rest(wm.create()),returns:t||wm.create(),typeName:pn.ZodFunction,...$n(s)})}},aw=class extends zn{get schema(){return this._def.getter()}_parse(n){const{ctx:e}=this._processInputParams(n);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};aw.create=(n,e)=>new aw({getter:n,typeName:pn.ZodLazy,...$n(e)});var ow=class extends zn{_parse(n){if(n.data!==this._def.value){const e=this._getOrReturnCtx(n);return wt(e,{received:e.data,code:dt.invalid_literal,expected:this._def.value}),yn}return{status:"valid",value:n.data}}get value(){return this._def.value}};ow.create=(n,e)=>new ow({value:n,typeName:pn.ZodLiteral,...$n(e)});function VX(n,e){return new dx({values:n,typeName:pn.ZodEnum,...$n(e)})}var dx=class sO extends zn{constructor(){super(...arguments),iv.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return wt(t,{expected:os.joinValues(s),received:t.parsedType,code:dt.invalid_type}),yn}if(E_(this,iv)||$X(this,iv,new Set(this._def.values)),!E_(this,iv).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return wt(t,{received:t.data,code:dt.invalid_enum_value,options:s}),yn}return mo(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return sO.create(e,{...this._def,...t})}exclude(e,t=this._def){return sO.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};iv=new WeakMap;dx.create=VX;var lw=class extends zn{constructor(){super(...arguments),av.set(this,void 0)}_parse(n){const e=os.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(n);if(t.parsedType!==kt.string&&t.parsedType!==kt.number){const s=os.objectValues(e);return wt(t,{expected:os.joinValues(s),received:t.parsedType,code:dt.invalid_type}),yn}if(E_(this,av)||$X(this,av,new Set(os.getValidEnumValues(this._def.values))),!E_(this,av).has(n.data)){const s=os.objectValues(e);return wt(t,{received:t.data,code:dt.invalid_enum_value,options:s}),yn}return mo(n.data)}get enum(){return this._def.values}};av=new WeakMap;lw.create=(n,e)=>new lw({values:n,typeName:pn.ZodNativeEnum,...$n(e)});var i1=class extends zn{unwrap(){return this._def.type}_parse(n){const{ctx:e}=this._processInputParams(n);if(e.parsedType!==kt.promise&&e.common.async===!1)return wt(e,{code:dt.invalid_type,expected:kt.promise,received:e.parsedType}),yn;const t=e.parsedType===kt.promise?e.data:Promise.resolve(e.data);return mo(t.then(s=>this._def.type.parseAsync(s,{path:e.path,errorMap:e.common.contextualErrorMap})))}};i1.create=(n,e)=>new i1({type:n,typeName:pn.ZodPromise,...$n(e)});var vu=class extends zn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===pn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(n){const{status:e,ctx:t}=this._processInputParams(n),s=this._def.effect||null,r={addIssue:a=>{wt(t,a),a.fatal?e.abort():e.dirty()},get path(){return t.path}};if(r.addIssue=r.addIssue.bind(r),s.type==="preprocess"){const a=s.transform(t.data,r);if(t.common.async)return Promise.resolve(a).then(async o=>{if(e.value==="aborted")return yn;const l=await this._def.schema._parseAsync({data:o,path:t.path,parent:t});return l.status==="aborted"?yn:l.status==="dirty"||e.value==="dirty"?_0(l.value):l});{if(e.value==="aborted")return yn;const o=this._def.schema._parseSync({data:a,path:t.path,parent:t});return o.status==="aborted"?yn:o.status==="dirty"||e.value==="dirty"?_0(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,r);if(t.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(t.common.async===!1){const o=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return o.status==="aborted"?yn:(o.status==="dirty"&&e.dirty(),a(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(o=>o.status==="aborted"?yn:(o.status==="dirty"&&e.dirty(),a(o.value).then(()=>({status:e.value,value:o.value}))))}if(s.type==="transform")if(t.common.async===!1){const a=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!Gm(a))return a;const o=s.transform(a.value,r);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(a=>Gm(a)?Promise.resolve(s.transform(a.value,r)).then(o=>({status:e.value,value:o})):a);os.assertNever(s)}};vu.create=(n,e,t)=>new vu({schema:n,typeName:pn.ZodEffects,effect:e,...$n(t)});vu.createWithPreprocess=(n,e,t)=>new vu({schema:e,effect:{type:"preprocess",transform:n},typeName:pn.ZodEffects,...$n(t)});var ph=class extends zn{_parse(n){return this._getType(n)===kt.undefined?mo(void 0):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}};ph.create=(n,e)=>new ph({innerType:n,typeName:pn.ZodOptional,...$n(e)});var ep=class extends zn{_parse(n){return this._getType(n)===kt.null?mo(null):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}};ep.create=(n,e)=>new ep({innerType:n,typeName:pn.ZodNullable,...$n(e)});var cw=class extends zn{_parse(n){const{ctx:e}=this._processInputParams(n);let t=e.data;return e.parsedType===kt.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};cw.create=(n,e)=>new cw({innerType:n,typeName:pn.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$n(e)});var uw=class extends zn{_parse(n){const{ctx:e}=this._processInputParams(n),t={...e,common:{...e.common,issues:[]}},s=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return Zv(s)?s.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new hu(t.common.issues)},input:t.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new hu(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}};uw.create=(n,e)=>new uw({innerType:n,typeName:pn.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...$n(e)});var R_=class extends zn{_parse(n){if(this._getType(n)!==kt.nan){const t=this._getOrReturnCtx(n);return wt(t,{code:dt.invalid_type,expected:kt.nan,received:t.parsedType}),yn}return{status:"valid",value:n.data}}};R_.create=n=>new R_({typeName:pn.ZodNaN,...$n(n)});var Qze=Symbol("zod_brand"),vF=class extends zn{_parse(n){const{ctx:e}=this._processInputParams(n),t=e.data;return this._def.type._parse({data:t,path:e.path,parent:e})}unwrap(){return this._def.type}},wF=class WX extends zn{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?yn:a.status==="dirty"?(t.dirty(),_0(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})})();{const r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?yn:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(e,t){return new WX({in:e,out:t,typeName:pn.ZodPipeline})}},hw=class extends zn{_parse(n){const e=this._def.innerType._parse(n),t=s=>(Gm(s)&&(s.value=Object.freeze(s.value)),s);return Zv(e)?e.then(s=>t(s)):t(e)}unwrap(){return this._def.innerType}};hw.create=(n,e)=>new hw({innerType:n,typeName:pn.ZodReadonly,...$n(e)});function Sj(n,e){const t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function HX(n,e={},t){return n?r1.create().superRefine((s,r)=>{var a,o;const l=n(s);if(l instanceof Promise)return l.then(c=>{var u,d;if(!c){const p=Sj(e,s),m=(d=(u=p.fatal)!==null&&u!==void 0?u:t)!==null&&d!==void 0?d:!0;r.addIssue({code:"custom",...p,fatal:m})}});if(!l){const c=Sj(e,s),u=(o=(a=c.fatal)!==null&&a!==void 0?a:t)!==null&&o!==void 0?o:!0;r.addIssue({code:"custom",...c,fatal:u})}}):r1.create()}var eBe={object:gc.lazycreate},pn;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(pn||(pn={}));var tBe=(n,e={message:`Input not instance of ${n.name}`})=>HX(t=>t instanceof n,e),GX=s1.create,qX=Jv.create,nBe=R_.create,sBe=Qv.create,XX=ew.create,rBe=tw.create,iBe=I_.create,aBe=nw.create,oBe=sw.create,lBe=r1.create,cBe=wm.create,uBe=Nd.create,hBe=O_.create,dBe=qm.create,fBe=gc.create,pBe=gc.strictCreate,mBe=rw.create,gBe=PX.create,yBe=iw.create,bBe=Qf.create,vBe=jX.create,wBe=D_.create,xBe=$_.create,SBe=UX.create,CBe=aw.create,_Be=ow.create,kBe=dx.create,TBe=lw.create,NBe=i1.create,Cj=vu.create,ABe=ph.create,EBe=ep.create,IBe=vu.createWithPreprocess,OBe=wF.create,DBe=()=>GX().optional(),$Be=()=>qX().optional(),RBe=()=>XX().optional(),LBe={string:n=>s1.create({...n,coerce:!0}),number:n=>Jv.create({...n,coerce:!0}),boolean:n=>ew.create({...n,coerce:!0}),bigint:n=>Qv.create({...n,coerce:!0}),date:n=>tw.create({...n,coerce:!0})},FBe=yn,pa=Object.freeze({__proto__:null,defaultErrorMap:n1,setErrorMap:Ize,getErrorMap:N_,makeIssue:A_,EMPTY_PATH:Oze,addIssueToContext:wt,ParseStatus:Ko,INVALID:yn,DIRTY:_0,OK:mo,isAborted:KI,isDirty:ZI,isValid:Gm,isAsync:Zv,get util(){return os},get objectUtil(){return YI},ZodParsedType:kt,getParsedType:hd,ZodType:zn,datetimeRegex:FX,ZodString:s1,ZodNumber:Jv,ZodBigInt:Qv,ZodBoolean:ew,ZodDate:tw,ZodSymbol:I_,ZodUndefined:nw,ZodNull:sw,ZodAny:r1,ZodUnknown:wm,ZodNever:Nd,ZodVoid:O_,ZodArray:qm,ZodObject:gc,ZodUnion:rw,ZodDiscriminatedUnion:PX,ZodIntersection:iw,ZodTuple:Qf,ZodRecord:jX,ZodMap:D_,ZodSet:$_,ZodFunction:UX,ZodLazy:aw,ZodLiteral:ow,ZodEnum:dx,ZodNativeEnum:lw,ZodPromise:i1,ZodEffects:vu,ZodTransformer:vu,ZodOptional:ph,ZodNullable:ep,ZodDefault:cw,ZodCatch:uw,ZodNaN:R_,BRAND:Qze,ZodBranded:vF,ZodPipeline:wF,ZodReadonly:hw,custom:HX,Schema:zn,ZodSchema:zn,late:eBe,get ZodFirstPartyTypeKind(){return pn},coerce:LBe,any:lBe,array:dBe,bigint:sBe,boolean:XX,date:rBe,discriminatedUnion:gBe,effect:Cj,enum:kBe,function:SBe,instanceof:tBe,intersection:yBe,lazy:CBe,literal:_Be,map:wBe,nan:nBe,nativeEnum:TBe,never:uBe,null:oBe,nullable:EBe,number:qX,object:fBe,oboolean:RBe,onumber:$Be,optional:ABe,ostring:DBe,pipeline:OBe,preprocess:IBe,promise:NBe,record:vBe,set:xBe,strictObject:pBe,string:GX,symbol:iBe,transformer:Cj,tuple:bBe,undefined:aBe,union:mBe,unknown:cBe,void:hBe,NEVER:FBe,ZodIssueCode:dt,quotelessJson:Eze,ZodError:hu}),_j={name:"@imgly/background-removal",version:"1.7.0"},MBe=pa.object({publicPath:pa.string().optional().describe("The public path to the wasm files and the onnx model.").default("https://staticimgly.com/@imgly/background-removal-data/${PACKAGE_VERSION}/dist/").transform(n=>n.replace("${PACKAGE_NAME}",_j.name).replace("${PACKAGE_VERSION}",_j.version)),debug:pa.boolean().default(!1).describe("Whether to enable debug logging."),rescale:pa.boolean().default(!0).describe("Whether to rescale the image."),device:pa.enum(["cpu","gpu"]).default("cpu").describe("The device to run the model on."),proxyToWorker:pa.boolean().default(!1).describe("Whether to proxy inference to a web worker."),fetchArgs:pa.any().default({}).describe("Arguments to pass to fetch when loading the model."),progress:pa.function().args(pa.string(),pa.number(),pa.number()).returns(pa.void()).describe("Progress callback.").optional(),model:pa.preprocess(n=>{switch(n){case"large":return"isnet";case"small":return"isnet_quint8";case"medium":return"isnet_fp16";default:return n}},pa.enum(["isnet","isnet_fp16","isnet_quint8"])).default("medium"),output:pa.object({format:pa.enum(["image/png","image/jpeg","image/webp","image/x-rgba8","image/x-alpha8"]).default("image/png"),quality:pa.number().default(.8)}).default({})}).default({}).transform(n=>(n.debug&&console.log("Config:",n),n.debug&&!n.progress&&(n.progress=n.progress??((e,t,s)=>{console.debug(`Downloading ${e}: ${t} of ${s}`)}),crossOriginIsolated||n.debug&&console.debug("Cross-Origin-Isolated is not enabled. Performance will be degraded. Please see  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer.")),n));function YX(n){return MBe.parse(n??{})}var PBe=EN(IN());async function zBe(n){n.debug&&console.debug("Loading model...",n.model);const e=n.model,s=await(await AX(`/models/${e}`,n)).arrayBuffer();return await Nze(s,n)}async function BBe(n){n=YX(n);const e=await zBe(n);return{config:n,session:{base:e}}}async function xF(n,e,t){const[r,a,o]=n.shape,l=!1;let c=XI(n,1024,1024,l);const u=Cze(c);let d=await Aze(t.base,[["input",u]],["output"],e),p=(0,PBe.default)(d[0].data,[1024,1024,1]),m=_ze(p);return e.rescale?(m=XI(m,a,r,l),[m,n]):[m,c]}var RN=yze(BBe,n=>JSON.stringify(n));async function jBe(n){await RN(n)}async function KX(n,e){const{config:t,session:s}=await RN(e);t.progress&&t.progress("compute:decode",0,4);const r=await Kv(n,t);t.progress?.("compute:inference",1,4);const[a,o]=await xF(r,t,s);t.progress?.("compute:mask",2,4);const l=o,[c,u]=l.shape,d=c*u;for(let m=0;m<d;m+=1)l.data[4*m+3]=a.data[m];t.progress?.("compute:encode",3,4);const p=await $N(l,t.output.quality,t.output.format);return t.progress?.("compute:encode",4,4),p}async function UBe(n,e){const{config:t,session:s}=await RN(e),r=await Kv(n,t),[a,o]=await xF(r,t,s),l=o,[c,u,d]=l.shape,p=c*u;for(let g=0;g<p;g+=1)l.data[4*g+3]=255-a.data[g];return await $N(l,t.output.quality,t.output.format)}var VBe=ZX;async function ZX(n,e){const{config:t,session:s}=await RN(e),r=await Kv(n,t);let[a,o,l]=r.shape;const[c,u]=await xF(r,t,s),d=o*a,p=r;for(let g=0;g<d;g+=1){const b=4*g;let v=c.data[g];p.data[b]=255,p.data[b+1]=255,p.data[b+2]=255,p.data[b+3]=v}return await $N(p,t.output.quality,t.output.format)}async function WBe(n,e,t){t=YX(t);const s=await Kv(n,t),[r,a,o]=s.shape,l=await Kv(e,t),[c,u,d]=l.shape,p=c!==r||u!==a?XI(l,a,r):l,m=a*r;for(let b=0;b<m;b+=1){const v=o*b,x=d*b;s.data[v+3]=p.data[x+3]}return await $N(s,t.output.quality,t.output.format)}const BS=Object.freeze(Object.defineProperty({__proto__:null,alphamask:VBe,applySegmentationMask:WBe,preload:jBe,removeBackground:KX,removeForeground:UBe,segmentForeground:ZX},Symbol.toStringTag,{value:"Module"})),SF={removeBackground:async(n,e={})=>{try{let t=KX||BS;if(typeof t!="function"&&t.removeBackground&&(t=t.removeBackground),typeof t!="function")if(console.warn("Could not find removeBackground function in @imgly/background-removal exports. Exports:",BS),typeof BS=="function")t=BS;else throw new Error("Could not find removeBackground function in @imgly/background-removal exports");const s={progress:(a,o,l)=>{},...e};return await t(n,s)}catch(t){throw console.error("Background removal failed:",t),t}}};function HBe(){const{canvasManager:n}=TN(),{setColorPickerVisible:e,setColorPickerAnchor:t,setExtractedPalette:s}=Hm(),r=ct.useRef(null),[a,o]=ct.useState(!1),[l,c]=ct.useState({x:0,y:0}),[u,d]=ct.useState(null),[p,m]=ct.useState(!1),[g,b]=ct.useState(!1);if(ct.useEffect(()=>{if(!n)return;const R=()=>{const z=n.getActiveObject();if(d(z),z){const I=z.getBoundingRect(!0,!0),H=n.canvas.getElement().getBoundingClientRect(),q=H.left+I.left,re=H.top+I.top,X=180,ne=44,Q=q+I.width/2-X/2;let he=re-ne-10;he<0&&(he=re+I.height+10),c({x:Q,y:he}),o(!0)}else o(!1)};return n.canvas.on("selection:created",R),n.canvas.on("selection:updated",R),n.canvas.on("selection:cleared",()=>o(!1)),n.canvas.on("object:moving",R),n.canvas.on("object:scaling",R),n.canvas.on("object:rotating",R),n.canvas.on("object:modified",R),()=>{n.canvas&&(n.canvas.off("selection:created",R),n.canvas.off("selection:updated",R),n.canvas.off("selection:cleared"),n.canvas.off("object:moving",R),n.canvas.off("object:scaling",R),n.canvas.off("object:rotating",R),n.canvas.off("object:modified",R))}},[n]),!a||!u)return null;const v=u,x=v.type==="i-text"||v.type==="text",S=v.type==="image"||v.type==="fabric-image",C=v.id==="crop-ui",A=v.type==="activeSelection",k=v.type==="group",O=async(R,z)=>{if(n)switch(R){case"duplicate":n.duplicateActiveObject();break;case"delete":n.removeActiveObject();break;case"layer-up":n.layerActiveObject("up");break;case"layer-down":n.layerActiveObject("down");break;case"group":n.group();break;case"ungroup":n.ungroup();break;case"font-family":n.updateActiveObject("fontFamily",z);break;case"format":z==="bold"&&n.toggleTextDecoration("fontWeight"),z==="italic"&&n.toggleTextDecoration("fontStyle"),z==="underline"&&n.toggleTextDecoration("underline");break;case"crop-apply":n.applyCrop();break;case"crop-cancel":n.cancelCrop();break;case"start-crop":n.startCropMode(),o(!1);break;case"toggle-color":t(z),e(j=>!j);break;case"remove-bg":if(p)return;m(!0),Bn.info("Removing background...",2e3);try{const j=u.getSrc(),H=await SF.removeBackground(j),q=URL.createObjectURL(H);await n.replaceImage(u,q),Bn.success("Background removed!")}catch(j){console.error("BG Removal error:",j),Bn.error("Failed to remove background")}finally{m(!1)}break;case"extract-palette":if(!n)return;const I=await n.extractPaletteFromActiveImage();I&&s(I);break;case"vectorize":o(!1),await n.vectorizeActiveImage();break;case"upscale":if(g)return;b(!0);try{await n.upscaleActiveImage()}finally{b(!1)}break}},F=()=>P.jsxs(P.Fragment,{children:[P.jsx("button",{className:"ft-btn",onClick:()=>O("crop-apply"),title:"Apply",style:{color:"#4ade80"},children:P.jsx(Jq,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("crop-cancel"),title:"Cancel",style:{color:"#f87171"},children:P.jsx(hx,{size:16})})]}),$=()=>P.jsxs(P.Fragment,{children:[P.jsxs("select",{className:"ft-select",value:v.fontFamily||"Arial",onChange:R=>O("font-family",R.target.value),title:"Font Family",children:[P.jsx("option",{value:"Arial",children:"Arial"}),P.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),P.jsx("option",{value:"Courier New",children:"Courier New"}),P.jsx("option",{value:"Noto Sans Lao",children:"Noto Sans Lao"}),P.jsx("option",{value:"Noto Serif Lao",children:"Noto Serif Lao"}),P.jsx("option",{value:"Phetsarath OT",children:"Phetsarath OT"}),P.jsx("option",{value:"Noto Sans Lao Looped",children:"Noto Sans Lao Looped"}),P.jsx("option",{value:"Roboto",children:"Roboto"}),P.jsx("option",{value:"Open Sans",children:"Open Sans"}),P.jsx("option",{value:"Montserrat",children:"Montserrat"}),P.jsx("option",{value:"Poppins",children:"Poppins"}),P.jsx("option",{value:"Lato",children:"Lato"}),P.jsx("option",{value:"Oswald",children:"Oswald"}),P.jsx("option",{value:"Playfair Display",children:"Playfair Display"}),P.jsx("option",{value:"Raleway",children:"Raleway"}),P.jsx("option",{value:"Impact",children:"Impact"})]}),P.jsx("div",{className:"ft-sep"}),P.jsx("button",{className:`ft-btn ${v.fontWeight==="bold"?"active":""}`,onClick:()=>O("format","bold"),title:"Bold",children:P.jsx(Zq,{size:16})}),P.jsx("button",{className:`ft-btn ${v.fontStyle==="italic"?"active":""}`,onClick:()=>O("format","italic"),title:"Italic",children:P.jsx(sX,{size:16})}),P.jsx("button",{className:`ft-btn ${v.underline?"active":""}`,onClick:()=>O("format","underline"),title:"Underline",children:P.jsx(fX,{size:16})}),P.jsx("div",{className:"ft-sep"})]}),M=()=>P.jsxs(P.Fragment,{children:[x&&$(),S&&P.jsxs(P.Fragment,{children:[P.jsx("button",{className:"ft-btn",onClick:()=>O("start-crop"),title:"Crop Image",children:P.jsx(tX,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("remove-bg"),title:"Remove Background",style:{color:p?"#8b5cf6":"inherit"},children:p?P.jsx("div",{className:"spinner-small",style:{border:"2px solid rgba(139, 92, 246, 0.3)",borderTopColor:"#8b5cf6",borderRadius:"50%",width:"14px",height:"14px",animation:"spin 1s linear infinite"}}):P.jsx(fF,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("extract-palette"),title:"Extract Color Palette",children:P.jsx(_Pe,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("vectorize"),title:"Vectorize Image",children:P.jsx(MPe,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("upscale"),title:"AI Quality Enhance",style:{color:g?"var(--accent-primary)":"inherit"},children:g?P.jsx("div",{className:"spinner-small",style:{border:"2px solid rgba(139, 92, 246, 0.3)",borderTopColor:"#8b5cf6",borderRadius:"50%",width:"14px",height:"14px",animation:"spin 1s linear infinite"}}):P.jsx(cX,{size:16})}),P.jsx("div",{className:"ft-sep"})]}),P.jsx("button",{className:"ft-btn",onClick:()=>O("duplicate"),title:"Duplicate",children:P.jsx(hF,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("delete"),title:"Delete",children:P.jsx(NN,{size:16})}),P.jsx("div",{className:"ft-sep"}),P.jsx("button",{className:"ft-btn",onClick:()=>O("layer-up"),title:"Bring Forward",children:P.jsx(uF,{size:16})}),P.jsx("button",{className:"ft-btn",onClick:()=>O("layer-down"),title:"Send Backward",children:P.jsx(cF,{size:16})}),A&&P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"ft-sep"}),P.jsx("button",{className:"ft-btn",onClick:()=>O("group"),title:"Group",children:P.jsx(vv,{size:16})})]}),k&&P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"ft-sep"}),P.jsx("button",{className:"ft-btn",onClick:()=>O("ungroup"),title:"Ungroup",children:P.jsx(rX,{size:16})})]}),P.jsx("div",{className:"ft-sep"}),P.jsx("div",{className:"color-swatch-wrap",children:P.jsx("div",{ref:r,className:"ft-color-swatch",onClick:()=>O("toggle-color",r.current),style:{backgroundColor:v.fill&&typeof v.fill=="string"?v.fill:"transparent"},title:"Change Color"})})]});return P.jsx("div",{className:"floating-toolbar",style:{position:"fixed",top:`${l.y}px`,left:`${l.x}px`,zIndex:1e3},children:C?F():M()})}const GBe=ct.memo(({obj:n,index:e,isSelected:t,isDragging:s,isEditing:r,editingName:a,onSelect:o,onToggleLock:l,onToggleVisible:c,onDragStart:u,onDragOver:d,onDrop:p,onDragEnd:m,onNameDoubleClick:g,onNameChange:b,onNameKeyDown:v,onNameBlur:x})=>{const S=n.name||n.type,C=n.lockMovementX,A=n.visible!==!1,k=O=>{switch(O){case"i-text":case"text":return P.jsx(dX,{size:14});case"image":return P.jsx(cPe,{size:14});case"rect":return P.jsx(BPe,{size:14});case"circle":return P.jsx(BMe,{size:14});case"group":return P.jsx(tPe,{size:14});default:return P.jsx($Me,{size:14})}};return P.jsxs("div",{className:`layer-item ${t?"selected":""} ${s?"dragging":""}`,onClick:O=>o(n,O),draggable:!0,onDragStart:O=>u(O,e),onDragOver:d,onDrop:O=>p(O,e),onDragEnd:m,style:{cursor:"pointer",opacity:s?.5:1},children:[P.jsx("div",{className:"layer-handle",style:{cursor:"grab"},children:P.jsx(iPe,{size:14})}),P.jsx("div",{className:"layer-icon",children:k(n.type)}),P.jsx("div",{className:"layer-name-wrap",style:{flex:1,overflow:"hidden"},onDoubleClick:O=>g(n,O),children:r?P.jsx("input",{type:"text",value:a,onChange:b,onKeyDown:O=>v(O,n),onBlur:()=>x(n),autoFocus:!0,onClick:O=>O.stopPropagation(),style:{width:"100%",border:"1px solid var(--accent-primary)",background:"var(--bg-primary)",color:"var(--text-primary)",padding:"2px 4px",fontSize:"inherit",borderRadius:"2px",outline:"none"}}):P.jsx("span",{className:"layer-name",children:S})}),P.jsxs("div",{className:"layer-actions",children:[P.jsx("button",{className:`icon-btn btn-xs btn-lock ${C?"active":""}`,onClick:O=>l(n,O),title:"Lock/Unlock",children:C?P.jsx(dF,{size:14}):P.jsx(iX,{size:14})}),P.jsx("button",{className:`icon-btn btn-xs btn-visible ${A?"":"active"}`,onClick:O=>c(n,O),title:"Toggle Visibility",children:A?P.jsx(qMe,{size:14}):P.jsx(HMe,{size:14})})]})]})});function qBe({canvasManager:n}){const[e,t]=ct.useState([]),[s,r]=ct.useState([]),[a,o]=ct.useState(null),[l,c]=ct.useState(null),[u,d]=ct.useState("");ct.useEffect(()=>{if(!n)return;const F=()=>{const M=n.canvas.getObjects().filter(R=>!R.excludeFromExport);t([...M].reverse())},$=()=>{const M=n.getActiveObject();if(M)if(M.type==="activeSelection"){const R=M.getObjects().map(z=>z.uid||z);r(R)}else r([M.uid||M]);else r([])};return n.canvas.on("object:added",F),n.canvas.on("object:removed",F),n.canvas.on("object:modified",F),n.canvas.on("selection:created",$),n.canvas.on("selection:updated",$),n.canvas.on("selection:cleared",$),n.canvas.on("layer:updated",F),F(),$(),()=>{n.canvas&&(n.canvas.off("object:added",F),n.canvas.off("object:removed",F),n.canvas.off("object:modified",F),n.canvas.off("selection:created",$),n.canvas.off("selection:updated",$),n.canvas.off("selection:cleared",$),n.canvas.off("layer:updated",F))}},[n]);const p=(F,$)=>{if(!n)return;const M=n.canvas;if($.shiftKey||$.ctrlKey||$.metaKey){const R=M.getActiveObject();let z=[];R&&(R.type==="activeSelection"?z=[...R.getObjects()]:z=[R]);const I=z.indexOf(F);if(I>-1?($.ctrlKey||$.metaKey)&&z.splice(I,1):z.push(F),z.length===0)M.discardActiveObject();else if(z.length===1)M.setActiveObject(z[0]);else{const j=new iu(z,{canvas:M});M.setActiveObject(j)}}else M.discardActiveObject(),M.setActiveObject(F);M.requestRenderAll()},m=(F,$)=>{$.stopPropagation();const M=!F.lockMovementX;F.set({lockMovementX:M,lockMovementY:M,lockRotation:M,lockScalingX:M,lockScalingY:M}),n.canvas.requestRenderAll(),t([...n.canvas.getObjects()].reverse())},g=(F,$)=>{$.stopPropagation(),F.set("visible",!F.visible),n.canvas.requestRenderAll(),t([...n.canvas.getObjects()].reverse())},b=(F,$)=>{o($),F.dataTransfer.effectAllowed="move"},v=F=>{F.preventDefault(),F.dataTransfer.dropEffect="move"},x=(F,$)=>{if(F.preventDefault(),a===null||a===$){o(null);return}const M=n.canvas.getObjects(),R=M.length,z=R-1-a;let I=R-1-$;if(n.objectManager&&n.objectManager.reorder){const j=M[z];n.canvas.moveObjectTo(j,I)}else{const j=M[z];n.canvas.moveObjectTo(j,I)}n.canvas.requestRenderAll(),t([...n.canvas.getObjects()].reverse()),o(null)},S=()=>o(null),C=(F,$)=>{$.stopPropagation(),c(F.uid||F),d(F.name||F.type)},A=F=>d(F.target.value),k=(F,$)=>{F.key==="Enter"?(F.preventDefault(),$.set("name",u),c(null),n.canvas.requestRenderAll(),t([...n.canvas.getObjects()].reverse())):F.key==="Escape"&&c(null)},O=F=>{F.set("name",u),c(null),n.canvas.requestRenderAll(),t([...n.canvas.getObjects()].reverse())};return P.jsx("div",{className:"layers-list",children:e.length===0?P.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",fontSize:"0.9em"},children:"No objects yet"}):e.map((F,$)=>P.jsx(GBe,{obj:F,index:$,isSelected:s.includes(F.uid||F),isDragging:a===$,isEditing:l===(F.uid||F),editingName:u,onSelect:p,onToggleLock:m,onToggleVisible:g,onDragStart:b,onDragOver:v,onDrop:x,onDragEnd:S,onNameDoubleClick:C,onNameChange:A,onNameKeyDown:k,onNameBlur:O},F.uid||$))})}function XBe({activeObject:n,onUpdate:e}){if(!n)return null;const t=(u,d)=>{let p=parseFloat(d);isNaN(p)&&(p=0),e(u,p)},s=Math.round(n.left||0),r=Math.round(n.top||0),a=Math.round(n.getScaledWidth()||0),o=Math.round(n.getScaledHeight()||0),l=Math.round(n.angle||0),c=Math.round((n.opacity||1)*100)/100;return P.jsxs("div",{className:"section",children:[P.jsx("div",{className:"section-title",children:"Transform"}),P.jsxs("div",{className:"inputs-grid-2 mb-2",children:[P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"X"}),P.jsx("input",{type:"number",className:"input-field input-sm",value:s,onChange:u=>t("left",u.target.value)})]}),P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"Y"}),P.jsx("input",{type:"number",className:"input-field input-sm",value:r,onChange:u=>t("top",u.target.value)})]})]}),P.jsxs("div",{className:"inputs-grid-2",children:[P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"W"}),P.jsx("input",{type:"number",className:"input-field input-sm",value:a,onChange:u=>t("width",u.target.value)})]}),P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"H"}),P.jsx("input",{type:"number",className:"input-field input-sm",value:o,onChange:u=>t("height",u.target.value)})]})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Rotation"}),P.jsxs("span",{className:"value-display",style:{marginLeft:"8px"},children:[l,""]})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"360",value:l,onChange:u=>t("angle",u.target.value)})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Opacity"}),P.jsxs("span",{className:"value-display",style:{marginLeft:"8px"},children:[Math.round(c*100),"%"]})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"1",step:"0.01",value:c,onChange:u=>t("opacity",u.target.value)})]})]})}function YBe({activeObject:n,canvasManager:e,onUpdate:t}){if(!n||!["i-text","text"].includes(n.type))return null;const s=[{label:"Arial (Standard)",value:"Arial"},{label:"Times New Roman",value:"Times New Roman"},{label:"Courier New",value:"Courier New"},{label:"Noto Sans Lao",value:"Noto Sans Lao"},{label:"Noto Serif Lao",value:"Noto Serif Lao"},{label:"Phetsarath OT",value:"Phetsarath OT"},{label:"Noto Sans Lao Looped",value:"Noto Sans Lao Looped"},{label:"Roboto",value:"Roboto"},{label:"Open Sans",value:"Open Sans"},{label:"Montserrat",value:"Montserrat"},{label:"Poppins",value:"Poppins"},{label:"Lato",value:"Lato"},{label:"Oswald",value:"Oswald"},{label:"Playfair Display",value:"Playfair Display"},{label:"Raleway",value:"Raleway"},{label:"Impact",value:"Impact"}],r=d=>{const p=d.target.value;e?.setTextStyle?e.setTextStyle("fontFamily",p):t("fontFamily",p)},a=d=>{e?.toggleTextDecoration&&e.toggleTextDecoration(d)},o=n.textAlign||"left",l=n.fontWeight||"normal",c=n.fontStyle||"normal",u=!!n.underline;return P.jsxs("div",{className:"section",children:[P.jsx("div",{className:"section-title",children:"Text Style"}),P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"Font"}),P.jsx("select",{className:"select-field",value:n.fontFamily||"Arial",onChange:r,children:s.map(d=>P.jsx("option",{value:d.value,children:d.label},d.value))})]}),P.jsxs("div",{className:"property-actions wide mt-2",children:[P.jsx("button",{className:`icon-btn ${o==="left"?"active":""}`,onClick:()=>t("textAlign","left"),title:"Align Left",children:P.jsx(hX,{size:16})}),P.jsx("button",{className:`icon-btn ${o==="center"?"active":""}`,onClick:()=>t("textAlign","center"),title:"Center",children:P.jsx(UPe,{size:16})}),P.jsx("button",{className:`icon-btn ${o==="right"?"active":""}`,onClick:()=>t("textAlign","right"),title:"Align Right",children:P.jsx(uX,{size:16})}),P.jsx("button",{className:`icon-btn ${o==="justify"?"active":""}`,onClick:()=>t("textAlign","justify"),title:"Justify",children:P.jsx(HPe,{size:16})})]}),P.jsxs("div",{className:"property-actions wide mt-2",children:[P.jsx("button",{className:`icon-btn ${l==="bold"?"active":""}`,onClick:()=>a("fontWeight"),title:"Bold",children:P.jsx(Zq,{size:16})}),P.jsx("button",{className:`icon-btn ${c==="italic"?"active":""}`,onClick:()=>a("fontStyle"),title:"Italic",children:P.jsx(sX,{size:16})}),P.jsx("button",{className:`icon-btn ${u?"active":""}`,onClick:()=>a("underline"),title:"Underline",children:P.jsx(fX,{size:16})})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",children:[P.jsx("label",{className:"input-label",children:"Line Height"}),P.jsx("span",{className:"value-display",children:Math.round((n.lineHeight||1.16)*10)/10})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0.8",max:"2.5",step:"0.1",value:n.lineHeight||1.16,onChange:d=>t("lineHeight",parseFloat(d.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",children:[P.jsx("label",{className:"input-label",children:"Char Spacing"}),P.jsx("span",{className:"value-display",children:n.charSpacing||0})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-50",max:"200",step:"10",value:n.charSpacing||0,onChange:d=>t("charSpacing",parseInt(d.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",children:[P.jsx("label",{className:"input-label",children:"Stroke Width"}),P.jsx("span",{className:"value-display",children:n.strokeWidth||0})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"20",step:"0.5",value:n.strokeWidth||0,onChange:d=>t("strokeWidth",parseFloat(d.target.value))})]})]})}function KBe({activeObject:n,onUpdate:e}){const{setColorPickerVisible:t,setColorPickerAnchor:s,setActiveColorProp:r,setColorPickerAlign:a}=Hm();if(!n)return null;const o=(A,k,O="left")=>{r(k),s(A.currentTarget),a(O),t(!0)},l=n.fill,c=n.stroke,u=n.strokeWidth||0,d=n.strokeDashArray;let p="solid";d&&d.length>0&&(d[0]<5?p="dotted":p="dashed");const m=A=>{let k=null;A==="dashed"&&(k=[10,5]),A==="dotted"&&(k=[2,2]),e("strokeDashArray",k)},g=n.shadow||{},b=g.color||"#000000",v=g.blur||0,x=g.offsetX||0,S=g.offsetY||0,C=(A,k)=>{e(`shadow.${A}`,k)};return P.jsxs("div",{className:"section",children:[P.jsx("div",{className:"section-title",children:"Appearance"}),P.jsxs("div",{className:"inputs-grid-2",children:[P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"Fill"}),P.jsx("div",{className:"color-swatch-btn",style:{backgroundColor:typeof l=="string"?l:"transparent",backgroundImage:typeof l!="string"?"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)":"none"},onClick:A=>o(A,"fill","right"),children:typeof l!="string"&&P.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(to right, transparent, rgba(0,0,0,0.1))"}})})]}),P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"Stroke"}),P.jsx("div",{className:"color-swatch-btn",style:{backgroundColor:typeof c=="string"?c:"transparent"},onClick:A=>o(A,"stroke","right")})]})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Stroke Width"}),P.jsx("span",{className:"value-display",children:u})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"50",value:u,onChange:A=>e("strokeWidth",parseFloat(A.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsx("label",{className:"input-label",children:"Stroke Style"}),P.jsxs("select",{className:"select-field",value:p,onChange:A=>m(A.target.value),children:[P.jsx("option",{value:"solid",children:"Solid"}),P.jsx("option",{value:"dashed",children:"Dashed"}),P.jsx("option",{value:"dotted",children:"Dotted"})]})]}),P.jsx("div",{className:"section-divider my-2"}),P.jsx("div",{className:"section-title",children:"Shadow"}),P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"Shadow Color"}),P.jsx("div",{className:"color-swatch-btn",style:{backgroundColor:b},onClick:A=>o(A,"shadow.color","right")})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Blur"}),P.jsx("span",{className:"value-display",children:v})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"50",value:v,onChange:A=>C("blur",parseInt(A.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"X Offset"}),P.jsx("span",{className:"value-display",children:x})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-50",max:"50",value:x,onChange:A=>C("offsetX",parseInt(A.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Y Offset"}),P.jsx("span",{className:"value-display",children:S})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-50",max:"50",value:S,onChange:A=>C("offsetY",parseInt(A.target.value))})]})]})}function ZBe({activeObject:n,canvasManager:e,onUpdate:t}){const{setColorPickerVisible:s,setColorPickerAnchor:r,setActiveColorProp:a}=Hm();if(!n||n.type!=="image"&&n.type!=="fabric-image")return null;const o=($,M)=>{a(M),r($.currentTarget),s(!0)},l=$=>{if(!n.filters)return 0;const R={brightness:"Brightness",contrast:"Contrast",blur:"Blur",saturation:"Saturation",grayscale:"Grayscale",sepia:"Sepia",hue:"HueRotation",noise:"Noise",pixelate:"Pixelate",tint:"BlendColor"}[$],z=n.filters.find(I=>I.type===R);return z?$==="blur"?z.blur||0:$==="pixelate"?z.blocksize||0:$==="hue"?z.rotation||0:$==="noise"?z.noise||0:$==="sharpen"?z.matrix?(z.matrix[4]-1)/4:0:z[$]||0:0},c=n.fill,[u,d]=Ps.useState(!1),[p,m]=Ps.useState(!1),[g,b]=Ps.useState(!1),[v,x]=Ps.useState(0),{extractedPalette:S,setExtractedPalette:C}=Hm();Ps.useEffect(()=>{const $=l("sharpen");Math.abs($-v)>.01&&x($)},[n]);const A=async()=>{if(n){m(!0),Bn.info("Removing background. This may take a moment...",3e3);try{const $=n.getSrc(),M=await SF.removeBackground($),R=URL.createObjectURL(M);await e.replaceImage(n,R),Bn.success("Background removed!")}catch($){console.error("Background removal failed:",$),Bn.error("Failed to remove background.")}finally{m(!1)}}},k=async()=>{if(!e)return;const $=await e.extractPaletteFromActiveImage();$&&C($)},O=async()=>{b(!0);try{await e.upscaleActiveImage()}finally{b(!1)}},F=$=>{x($),t("filter.sharpen",$)};return Ps.useEffect(()=>{if(!e)return;d(!!e.isCropping);const $=e.onCropModeChange;return e.onCropModeChange=M=>{d(M),$&&$(M)},()=>{e.onCropModeChange=$}},[e,n]),P.jsxs("div",{className:"section",children:[P.jsx("div",{className:"section-title",children:"Image Correction"}),P.jsxs("div",{className:"input-group mb-2",style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:"row"},children:[P.jsx("label",{className:"input-label",style:{margin:0},children:"Crop Image"}),P.jsx("div",{className:`switch-toggle ${u?"active":""}`,onClick:()=>u?e.cancelCrop():e.startCropMode(),title:"Toggle Crop Mode",style:{margin:0},children:P.jsx("div",{className:"switch-handle"})})]}),P.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"16px"},children:[P.jsx("button",{className:"btn-primary",onClick:A,disabled:p,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:"8px",padding:"12px 0",boxShadow:"0 4px 6px -1px rgba(99, 102, 241, 0.2), 0 2px 4px -1px rgba(99, 102, 241, 0.1)",transition:"all 0.3s ease",fontWeight:500,fontSize:"0.85rem"},children:p?P.jsx("div",{className:"spinner-small",style:{border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"#fff",borderRadius:"50%",width:"16px",height:"16px",animation:"spin 1s linear infinite"}}):P.jsxs(P.Fragment,{children:[P.jsx(fF,{size:16,color:"#fff"}),P.jsx("span",{children:"Remove BG"})]})}),P.jsxs("button",{className:"btn-secondary",onClick:()=>e.vectorizeActiveImage(),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:"var(--bg-tertiary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px 0",color:"var(--text-primary)",transition:"all 0.3s ease",fontWeight:500,fontSize:"0.85rem"},children:[P.jsx(vv,{size:16}),P.jsx("span",{children:"Vectorize"})]})]}),P.jsx("button",{className:"btn-secondary full-width mb-3",onClick:O,disabled:g,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px 0",borderRadius:"8px",fontSize:"0.85rem",background:"var(--bg-tertiary)",border:"1px solid var(--border-color)",color:"var(--text-primary)",transition:"all 0.3s ease",fontWeight:500},children:g?P.jsx("div",{className:"spinner-small",style:{border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"var(--accent-primary)",borderRadius:"50%",width:"16px",height:"16px",animation:"spin 1s linear infinite"}}):P.jsxs(P.Fragment,{children:[P.jsx(cX,{size:16,className:"text-accent",style:{color:"#fbbf24"}}),P.jsx("span",{children:"AI Enhance Quality (x2)"})]})}),P.jsxs("button",{className:"btn-secondary full-width mb-3",onClick:k,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"10px 0",borderRadius:"8px",fontSize:"0.85rem"},children:[P.jsxs("div",{style:{display:"flex",gap:"2px"},children:[P.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444"}}),P.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"#3b82f6"}}),P.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"#10b981"}})]}),P.jsx("span",{children:"Extract Color Palette"})]}),P.jsxs("div",{className:"input-group mb-3",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[P.jsx("label",{className:"input-label",style:{margin:0},children:"Sharpen (Clear)"}),P.jsx("span",{className:"value-display",style:{opacity:.6},children:v>0?`${Math.round(v*200)}%`:"Off"})]}),P.jsx("div",{style:{display:"flex",width:"100%",borderRadius:"4px",overflow:"hidden",border:"1px solid #333"},children:[{label:"Off",val:0},{label:"1x",val:.1},{label:"2x",val:.2},{label:"3x",val:.35},{label:"4x",val:.5}].map(($,M,R)=>{const z=Math.abs(v-$.val)<.01;return P.jsx("button",{onClick:()=>F($.val),title:$.label,style:{flex:1,padding:"6px 0",fontSize:"0.8em",backgroundColor:z?"var(--primary-color, #007bff)":"#2a2a2a",color:z?"#fff":"#888",border:"none",borderRight:M<R.length-1?"1px solid #333":"none",borderRadius:0,cursor:"pointer",transition:"all 0.2s ease"},children:$.label},$.label)})})]}),P.jsxs("div",{className:"input-group",children:[P.jsx("label",{className:"input-label",children:"Tint"}),P.jsx("div",{className:"color-swatch-btn",style:{backgroundColor:typeof c=="string"?c:"transparent"},onClick:$=>o($,"fill")})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Brightness"}),P.jsx("span",{className:"value-display",children:Math.round(l("brightness")*100)/100})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-1",max:"1",step:"0.05",value:l("brightness"),onChange:$=>t("filter.brightness",parseFloat($.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Contrast"}),P.jsx("span",{className:"value-display",children:Math.round(l("contrast")*100)/100})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-1",max:"1",step:"0.05",value:l("contrast"),onChange:$=>t("filter.contrast",parseFloat($.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Blur"}),P.jsx("span",{className:"value-display",children:Math.round(l("blur")*100)/100})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"1",step:"0.05",value:l("blur"),onChange:$=>t("filter.blur",parseFloat($.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Saturation"}),P.jsx("span",{className:"value-display",children:Math.round(l("saturation")*100)/100})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-1",max:"1",step:"0.1",value:l("saturation"),onChange:$=>t("filter.saturation",parseFloat($.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Hue"}),P.jsx("span",{className:"value-display",children:Math.round(l("hue"))})]}),P.jsx("input",{type:"range",className:"range-slider",min:"-1",max:"1",step:"0.1",value:l("hue"),onChange:$=>t("filter.hue",parseFloat($.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Noise"}),P.jsx("span",{className:"value-display",children:l("noise")})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"100",step:"5",value:l("noise"),onChange:$=>t("filter.noise",parseInt($.target.value))})]}),P.jsxs("div",{className:"input-group mt-2",children:[P.jsxs("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[P.jsx("label",{className:"input-label",children:"Pixelate"}),P.jsx("span",{className:"value-display",children:l("pixelate")})]}),P.jsx("input",{type:"range",className:"range-slider",min:"0",max:"20",step:"1",value:l("pixelate"),onChange:$=>t("filter.pixelate",parseInt($.target.value))})]})]})}function JBe({activeObject:n,canvasManager:e}){if(!n)return null;const t=c=>e.alignObjects(c,!1),s=c=>{e.distributeObjects(c)},r=c=>e.layerActiveObject(c),a=c=>e.flipActiveObject(c),o=n.type?n.type.toLowerCase():"",l=o==="activeselection"||o==="group";return P.jsxs("div",{className:"section",children:[P.jsx("div",{className:"section-header",style:{marginBottom:"8px"},children:P.jsx("div",{className:"section-title",children:"Align & Distribute"})}),P.jsxs("div",{className:"inputs-grid-4 mb-2",children:[P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>t("left"),title:"Left",children:P.jsx(hX,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>t("center"),title:"Center",children:P.jsx(gMe,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>t("right"),title:"Right",children:P.jsx(uX,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>s("horizontal"),title:"Distribute Horizontal",children:P.jsx(bMe,{size:14})})]}),P.jsxs("div",{className:"inputs-grid-4 mb-2",children:[P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>t("top"),title:"Top",children:P.jsx(EMe,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>t("middle"),title:"Middle",children:P.jsx(SMe,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>t("bottom"),title:"Bottom",children:P.jsx(_Me,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>s("vertical"),title:"Distribute Vertical",children:P.jsx(wMe,{size:14})})]}),P.jsx("div",{className:"section-title mt-3",children:"Order & Group"}),P.jsxs("div",{className:"inputs-grid-4 mb-2",children:[P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>a("horizontal"),title:"Flip Horizontal",children:P.jsx(Yq,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>a("vertical"),title:"Flip Vertical",children:P.jsx(Kq,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>r("up"),title:"Bring Forward",children:P.jsx(uF,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>r("down"),title:"Send Backward",children:P.jsx(cF,{size:14})})]}),l&&P.jsxs("div",{className:"inputs-grid-4",children:[P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>e.group(),title:"Group Objects",children:P.jsx(QMe,{size:14})}),P.jsx("button",{className:"icon-btn btn-xs",onClick:()=>e.ungroup(),title:"Ungroup Objects",children:P.jsx(YMe,{size:14})})]})]})}function QBe({onUpdate:n}){const{extractedPalette:e,setExtractedPalette:t}=Hm();if(!e)return null;const s=[e.dominant,...e.palette],r=a=>{n("fill",a),Bn.info(`Color ${a} applied!`)};return P.jsxs("div",{className:"section document-palette",children:[P.jsxs("div",{className:"section-title",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[P.jsx("span",{children:"Document Palette"}),P.jsx("button",{className:"ft-btn",onClick:()=>t(null),title:"Clear Palette",style:{padding:"2px",height:"auto"},children:P.jsx(NN,{size:12})})]}),P.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:s.map((a,o)=>P.jsx("div",{className:"color-swatch-btn",style:{backgroundColor:a,width:"28px",height:"28px",border:a.toLowerCase()==="#ffffff"?"1px solid var(--border-color)":"none",cursor:"pointer",borderRadius:"6px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",transition:"transform 0.2s ease"},onClick:()=>r(a),title:`Apply ${a}`,onMouseEnter:l=>l.currentTarget.style.transform="scale(1.1)",onMouseLeave:l=>l.currentTarget.style.transform="scale(1)"},`${a}-${o}`))})]})}function eje(){const{canvasManager:n,activeObject:e}=TN(),[,t]=ct.useState({});ct.useEffect(()=>{if(!n||!n.canvas)return;const u=()=>t({});return n.canvas.on("object:modified",u),()=>{n.canvas&&n.canvas.off("object:modified",u)}},[n]);const s=(u,d)=>{n&&e&&(n.updateActiveObject(u,d),t({}))};if(!e)return P.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",fontSize:"0.9em"},children:"Select an object"});const r=e.type,a=r==="i-text"||r==="text",o=r==="image"||r==="fabric-image",l=r==="group"||r==="activeSelection"||r==="activeselection",c=["rect","circle","triangle","polygon","path","line"].includes(r);return P.jsxs("div",{className:"property-panel",children:[P.jsx(QBe,{onUpdate:s}),P.jsx(XBe,{activeObject:e,onUpdate:s}),a&&P.jsx(YBe,{activeObject:e,canvasManager:n,onUpdate:s}),(c||l||a)&&P.jsx(KBe,{activeObject:e,onUpdate:s}),o&&P.jsx(ZBe,{activeObject:e,canvasManager:n,onUpdate:s}),P.jsx("div",{className:"section-divider my-2"}),P.jsx(JBe,{activeObject:e,canvasManager:n})]})}function tje({canvasManager:n}){const[e,t]=ct.useState([]),[s,r]=ct.useState("All"),[a,o]=ct.useState(""),[l,c]=ct.useState(20),[u,d]=ct.useState(!0),p=ct.useRef(null),m=ct.useRef(null),g=ct.useRef(null);ct.useEffect(()=>{fetch("data/elements.json").then($=>$.json()).then($=>{t($),d(!1)}).catch($=>{console.error("Error loading elements:",$),d(!1)})},[]);const b=["All",...e.map($=>$.category)],v=$=>{g.current&&($==="left"?g.current.scrollBy({left:-150,behavior:"smooth"}):g.current.scrollBy({left:150,behavior:"smooth"}))},x=()=>{if(m.current){const{scrollTop:$,scrollHeight:M,clientHeight:R}=m.current;$+R>=M-50&&c(z=>z+20)}},S=()=>{n&&n.addText("Heading",{fontSize:48,fontWeight:"bold"})},C=()=>{p.current.click()},A=$=>{n&&($.type==="shape"?n.addShape($.shapeType,$.options):$.type==="svg"?n.addSVG($.src):$.type==="image"&&n.addImage($.src))},k=$=>{const M=$.target.files[0];if(M&&n){const R=new FileReader;R.onload=z=>{n.addImage(z.target.result)},R.readAsDataURL(M)}$.target.value=""},F=e.flatMap($=>$.items.map(M=>({...M,category:$.category}))).filter($=>{const M=s==="All"||$.category===s,R=$.label.toLowerCase().includes(a.toLowerCase());return M&&R}).slice(0,l);return u?P.jsx("div",{style:{padding:"20px",color:"#888"},children:"Loading..."}):P.jsxs("div",{className:"elements-panel",children:[P.jsx("input",{type:"file",ref:p,style:{display:"none"},accept:"image/*",onChange:k}),P.jsxs("div",{className:"panel-search-box",children:[P.jsx(lX,{size:16,className:"search-icon-sm"}),P.jsx("input",{type:"text",placeholder:"Search elements...",value:a,onChange:$=>o($.target.value)})]}),P.jsxs("div",{className:"elements-basics-section",children:[P.jsx("div",{className:"section-title",children:"BASICS"}),P.jsxs("div",{className:"elements-basics-grid",children:[P.jsxs("button",{className:"btn-element-primary",onClick:S,title:"Add Text",children:[P.jsx(dX,{size:18}),P.jsx("span",{children:"Text"})]}),P.jsxs("button",{className:"btn-element-primary",onClick:C,title:"Upload Image",children:[P.jsx(ZPe,{size:18}),P.jsx("span",{children:"Upload"})]})]})]}),P.jsxs("div",{className:"panel-category-wrapper",children:[P.jsx("button",{className:"category-nav-btn",onClick:()=>v("left"),title:"Scroll Left",children:P.jsx(Qq,{size:16})}),P.jsx("div",{className:"panel-filter-bar",ref:g,children:b.map($=>P.jsx("button",{className:`filter-chip ${s===$?"active":""}`,onClick:()=>r($),children:$},$))}),P.jsx("button",{className:"category-nav-btn",onClick:()=>v("right"),title:"Scroll Right",children:P.jsx(eX,{size:16})})]}),P.jsx("div",{className:"panel-scroll-area",ref:m,onScroll:x,children:P.jsxs("div",{className:"elements-grid-flat",children:[F.map(($,M)=>P.jsx("button",{className:"btn-element-flat",onClick:()=>A($),title:$.label,children:P.jsx("img",{src:$.icon||$.src,alt:$.label,loading:"lazy"})},M)),F.length===0&&P.jsx("div",{className:"empty-state",style:{textAlign:"center",padding:"20px",color:"#888"},children:"No elements found"})]})})]})}function nje({canvasManager:n}){const[e,t]=ct.useState("presets"),[s,r]=ct.useState([]),[a,o]=ct.useState([]),[l,c]=ct.useState("All"),[u,d]=ct.useState(""),p=ct.useRef(null),m=k=>{p.current&&p.current.scrollBy({left:k==="left"?-150:150,behavior:"smooth"})};ct.useEffect(()=>{fetch("data/templates.json").then(k=>k.json()).then(k=>r(k)).catch(k=>console.error("Error loading templates:",k)),g()},[]);const g=()=>{try{const k=localStorage.getItem("canvas_pro_my_templates");k&&o(JSON.parse(k))}catch(k){console.error("Failed to load custom templates",k)}},b=["All",...new Set(s.map(k=>k.category).filter(Boolean))],x=(e==="presets"?s:a).filter(O=>{const F=e==="custom"||l==="All"||O.category===l,$=O.title.toLowerCase().includes(u.toLowerCase());return F&&$}),S=async k=>{if(n&&confirm("Load template? Unsaved changes will be replaced."))try{if(e==="presets"&&k.file){const F=await(await fetch(k.file)).json();n.loadProject(F)}else e==="custom"&&k.data&&n.loadProject(k.data)}catch(O){console.error("Failed to load template",O),alert("Failed to load template.")}},C=()=>{if(!n)return;const k=prompt("Enter a name for your template:","My New Design");if(k)try{const O=n.canvas.toDataURL({format:"jpeg",quality:.7,multiplier:.2}),F=n.canvas.toJSON(),M=[{id:Date.now().toString(),title:k,thumbnail:O,data:F,createdAt:Date.now(),category:"Custom"},...a];o(M),localStorage.setItem("canvas_pro_my_templates",JSON.stringify(M)),t("custom")}catch(O){console.error("Failed to save template",O),O.name==="QuotaExceededError"?alert("Storage full! Please delete some old templates."):alert("Failed to save template.")}},A=(k,O)=>{if(k.stopPropagation(),confirm("Delete this template?")){const F=a.filter($=>$.id!==O);o(F),localStorage.setItem("canvas_pro_my_templates",JSON.stringify(F))}};return P.jsxs("div",{className:"templates-panel",children:[P.jsxs("div",{className:"panel-tabs-segment",children:[P.jsx("button",{className:`tab-segment-btn ${e==="presets"?"active":""}`,onClick:()=>t("presets"),children:"Presets"}),P.jsx("button",{className:`tab-segment-btn ${e==="custom"?"active":""}`,onClick:()=>t("custom"),children:"My Templates"})]}),P.jsxs("div",{className:"panel-search-box",children:[P.jsx(lX,{className:"search-icon-sm"}),P.jsx("input",{type:"text",placeholder:e==="presets"?"Search presets...":"Search my templates...",value:u,onChange:k=>d(k.target.value)})]}),e==="presets"&&P.jsxs("div",{className:"panel-category-wrapper",children:[P.jsx("button",{className:"category-nav-btn",onClick:()=>m("left"),title:"Scroll Left",children:P.jsx(Qq,{size:16})}),P.jsx("div",{className:"panel-filter-bar",ref:p,children:b.map(k=>P.jsx("button",{className:`filter-chip ${l===k?"active":""}`,onClick:()=>c(k),children:k},k))}),P.jsx("button",{className:"category-nav-btn",onClick:()=>m("right"),title:"Scroll Right",children:P.jsx(eX,{size:16})})]}),P.jsxs("div",{className:"templates-grid panel-scroll-area",children:[e==="custom"&&!u&&P.jsxs("div",{className:"template-card add-new-card",onClick:C,title:"Save current design",children:[P.jsx("div",{className:"add-btn-circle",children:P.jsx(aX,{size:24,color:"white"})}),P.jsx("span",{className:"add-new-text",children:"Save Current"})]}),x.length===0&&!(!u&&e==="custom")&&P.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#888",gridColumn:"1 / -1"},children:e==="custom"?"No saved templates yet.":"No templates found."}),x.map(k=>P.jsxs("div",{className:"template-card",onClick:()=>S(k),children:[P.jsx("div",{className:"template-thumb",children:P.jsx("img",{src:k.thumbnail||"placeholder.png",alt:k.title,loading:"lazy"})}),P.jsxs("div",{className:"template-info",children:[P.jsx("h4",{children:k.title}),P.jsx("span",{className:"template-cat",children:e==="presets"?k.category:new Date(k.createdAt).toLocaleDateString()})]}),e==="custom"&&P.jsx("button",{className:"btn-delete-template",onClick:O=>A(O,k.id),title:"Delete Template",children:P.jsx(NN,{size:14})})]},k.id))]})]})}function sje(){const{canvasManager:n}=TN(),e=ct.useRef(null),[t,s]=ct.useState(!1),[r,a]=ct.useState({x:0,y:0}),[o,l]=ct.useState(null);ct.useEffect(()=>{if(!n)return;const g=b=>{const v=document.getElementById("canvas-wrapper");if(v&&v.contains(b.target)){b.preventDefault();const x=n.canvas.findTarget(b);x?(n.canvas.setActiveObject(x),n.canvas.requestRenderAll(),l(x),a({x:b.clientX,y:b.clientY}),s(!0)):s(!1)}};return document.addEventListener("contextmenu",g),()=>{document.removeEventListener("contextmenu",g)}},[n]),ct.useEffect(()=>{const g=b=>{e.current&&!e.current.contains(b.target)&&s(!1)};return t&&document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[t]);const c=async g=>{if(n){switch(g){case"duplicate":n.duplicateActiveObject();break;case"delete":n.removeActiveObject();break;case"layer-up":n.layerActiveObject("up");break;case"layer-down":n.layerActiveObject("down");break;case"group":n.group();break;case"ungroup":n.ungroup();break;case"lock":n.toggleLockActiveObject();break;case"flip-h":n.flipActiveObject("horizontal");break;case"flip-v":n.flipActiveObject("vertical");break;case"start-crop":n.startCropMode(),s(!1);break;case"remove-bg":s(!1),Bn.info("Removing background...",2e3);try{const b=o.getSrc(),v=await SF.removeBackground(b),x=URL.createObjectURL(v);await n.replaceImage(o,x),Bn.success("Background removed!")}catch(b){console.error("BG Removal error:",b),Bn.error("Failed to remove background")}return;case"vectorize":s(!1),await n.vectorizeActiveImage();break}s(!1)}};if(!t)return null;const u=o?.lockMovementX,d=o?.type==="group",p=o?.type==="activeSelection",m=o&&(o.type==="image"||o.type==="fabric-image");return P.jsxs("div",{ref:e,className:"context-menu",style:{top:r.y,left:r.x},children:[m&&P.jsxs(P.Fragment,{children:[P.jsx(oc,{icon:P.jsx(tX,{size:16}),label:"Crop Image",onClick:()=>c("start-crop")}),P.jsx(oc,{icon:P.jsx(fF,{size:16}),label:"Remove Background",onClick:()=>c("remove-bg")}),P.jsx(oc,{icon:P.jsx(vv,{size:16}),label:"Convert to Vector",onClick:()=>c("vectorize")}),P.jsx("div",{className:"menu-divider"})]}),P.jsx(oc,{icon:P.jsx(hF,{size:16}),label:"Duplicate",shortcut:"Ctrl+D",onClick:()=>c("duplicate")}),P.jsx("div",{className:"menu-divider"}),P.jsx(oc,{icon:P.jsx(Yq,{size:16}),label:"Flip Horizontal",onClick:()=>c("flip-h")}),P.jsx(oc,{icon:P.jsx(Kq,{size:16}),label:"Flip Vertical",onClick:()=>c("flip-v")}),P.jsx("div",{className:"menu-divider"}),P.jsx(oc,{icon:P.jsx(uF,{size:16}),label:"Bring Forward",shortcut:"Ctrl+]",onClick:()=>c("layer-up")}),P.jsx(oc,{icon:P.jsx(cF,{size:16}),label:"Send Backward",shortcut:"Ctrl+[",onClick:()=>c("layer-down")}),P.jsx("div",{className:"menu-divider"}),P.jsx(oc,{icon:u?P.jsx(iX,{size:16}):P.jsx(dF,{size:16}),label:u?"Unlock":"Lock",shortcut:"Ctrl+L",onClick:()=>c("lock")}),d&&P.jsx(oc,{icon:P.jsx(vv,{size:16}),label:"Ungroup",onClick:()=>c("ungroup")}),!d&&p&&P.jsx(oc,{icon:P.jsx(vv,{size:16}),label:"Group",shortcut:"Ctrl+G",onClick:()=>c("group")}),P.jsx("div",{className:"menu-divider"}),P.jsx(oc,{icon:P.jsx(NN,{size:16}),label:"Delete",shortcut:"Del",danger:!0,onClick:()=>c("delete")})]})}function oc({icon:n,label:e,shortcut:t,onClick:s,danger:r=!1}){return P.jsxs("button",{className:`menu-item ${r?"danger":""}`,onClick:s,children:[P.jsx("span",{className:"menu-icon",children:n}),P.jsx("span",{className:"menu-label",children:e}),t&&P.jsx("span",{className:"menu-shortcut",children:t})]})}function kj({type:n="horizontal",canvasManager:e}){const t=ct.useRef(null),[s,r]=ct.useState({zoom:1,offset:{x:0,y:0}});ct.useEffect(()=>{if(!e)return;const o=()=>{if(!e.canvas)return;const l=e.canvas.getZoom(),c=e.canvas.viewportTransform;r({zoom:l,offset:{x:c[4],y:c[5]}})};if(o(),!!e.canvas)return e.canvas.on("mouse:wheel",o),e.canvas.on("mouse:move",l=>{e.canvas.isDragging&&o()}),e.canvas.on("mouse:up",o),e.canvas.on("after:render",o),()=>{e.canvas&&(e.canvas.off("mouse:wheel",o),e.canvas.off("after:render",o),e.canvas.off("mouse:move",o),e.canvas.off("mouse:up",o))}},[e]),ct.useEffect(()=>{const o=t.current;if(!o)return;const l=o.getContext("2d"),{zoom:c,offset:u}=s,d=o.getBoundingClientRect();o.width=d.width,o.height=d.height,l.clearRect(0,0,o.width,o.height),l.fillStyle="#f3f4f6",l.fillRect(0,0,o.width,o.height),l.fillStyle="#6b7280",l.strokeStyle="#9ca3af",l.lineWidth=1,l.font="10px Inter, sans-serif";const p=0,m=n==="horizontal"?o.width:o.height;let g=50;c>2&&(g=10),c>5&&(g=5),c<.5&&(g=100),c<.2&&(g=500);const b=n==="horizontal"?(p-u.x)/c:(p-u.y)/c,v=Math.ceil(b/g)*g;let x=n==="horizontal"?v*c+u.x:v*c+u.y;const S=g*c;let C=v;for(l.beginPath();x<m;){const A=C%(g*2)===0?12:6;n==="horizontal"?(l.moveTo(x,o.height-A),l.lineTo(x,o.height),C%(g*2)===0&&l.fillText(Math.round(C),x+2,14)):(l.moveTo(o.width-A,x),l.lineTo(o.width,x),C%(g*2)===0&&(l.save(),l.translate(12,x+10),l.rotate(-Math.PI/2),l.fillText(Math.round(C),0,0),l.restore())),C+=g,x+=S}l.stroke()},[s,n]);const a=o=>{if(!e)return;o.preventDefault();const l=e.canvas.getZoom(),c=e.canvas.viewportTransform,u=(v,x)=>{const S=e.canvas.getElement().getBoundingClientRect(),C=v-S.left,A=x-S.top,k=(C-c[4])/l,O=(A-c[5])/l;return{x:k,y:O}},d=u(o.clientX,o.clientY),p=n==="horizontal"?d.y:d.x,m=e.addGuide(n,p),g=v=>{const x=u(v.clientX,v.clientY);n==="horizontal"?m.set("top",x.y):m.set("left",x.x),m.setCoords(),e.canvas.requestRenderAll()},b=()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",b)};window.addEventListener("mousemove",g),window.addEventListener("mouseup",b)};return P.jsx("canvas",{ref:t,onMouseDown:a,style:{width:"100%",height:"100%",display:"block",background:"var(--bg-tertiary)",cursor:n==="horizontal"?"ns-resize":"ew-resize"}})}const rje=[{category:"General",items:[{keys:["Del"],desc:"Delete"},{keys:["Esc"],desc:"Deselect / Cancel"}]},{category:"Clipboard",items:[{keys:["Ctrl","C"],desc:"Copy"},{keys:["Ctrl","V"],desc:"Paste"},{keys:["Ctrl","D"],desc:"Duplicate"}]},{category:"Manipulation",items:[{keys:["Arrows"],desc:"Nudge Object"},{keys:["Shift","Arrows"],desc:"Nudge x10"},{keys:["Shift","Drag"],desc:"Constrain Rotate/Scale"}]},{category:"View",items:[{keys:["Space","Drag"],desc:"Pan Canvas (Hand Tool)"},{keys:["Alt","Wheel"],desc:"Zoom In/Out"}]}];function ije({isOpen:n,onClose:e}){return n?(ct.useEffect(()=>{const t=s=>{s.key==="Escape"&&e()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),P.jsxs("div",{className:"modal-overlay",onClick:e,children:[P.jsxs("div",{className:"modal-content shortcuts-modal",onClick:t=>t.stopPropagation(),children:[P.jsxs("div",{className:"modal-header",children:[P.jsx("h2",{children:"Keyboard Shortcuts"}),P.jsx("button",{className:"close-btn",onClick:e,children:P.jsx(hx,{size:20})})]}),P.jsx("div",{className:"shortcuts-grid",children:rje.map(t=>P.jsxs("div",{className:"shortcut-category",children:[P.jsx("h3",{children:t.category}),P.jsx("ul",{children:t.items.map((s,r)=>P.jsxs("li",{children:[P.jsx("div",{className:"keys",children:s.keys.map((a,o)=>P.jsxs(Ps.Fragment,{children:[P.jsx("span",{className:"kbd",children:a}),o<s.keys.length-1&&P.jsx("span",{className:"plus",children:"+"})]},a))}),P.jsx("span",{className:"desc",children:s.desc})]},r))})]},t.category))})]}),P.jsx("style",{children:`
                .shortcuts-modal {
                    max-width: 800px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    background: #1e1e1e;
                    color: #fff;
                    border: 1px solid #333;
                }
                .shortcuts-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 24px;
                    padding: 20px;
                }
                .shortcut-category h3 {
                    margin-bottom: 12px;
                    color: #888;
                    font-size: 14px;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    border-bottom: 1px solid #333;
                    padding-bottom: 8px;
                }
                .shortcut-category ul {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                }
                .shortcut-category li {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 8px 0;
                    border-bottom: 1px solid #2a2a2a;
                }
                .shortcut-category li:last-child {
                    border-bottom: none;
                }
                .keys {
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }
                .kbd {
                    background: #333;
                    border: 1px solid #444;
                    border-radius: 4px;
                    padding: 2px 6px;
                    font-family: monospace;
                    font-size: 12px;
                    color: #eee;
                    box-shadow: 0 2px 0 #222;
                }
                .plus {
                    color: #666;
                    font-size: 12px;
                }
                .desc {
                    color: #ccc;
                    font-size: 14px;
                }
            `})]})):null}function aje({isOpen:n,onClose:e,onExport:t}){if(!n)return null;const[s,r]=ct.useState("png"),[a,o]=ct.useState(.8),[l,c]=ct.useState(1),u=()=>{t({format:s,quality:parseFloat(a),multiplier:parseFloat(l)}),e()};return P.jsx("div",{className:"modal-overlay",onClick:e,children:P.jsxs("div",{className:"modal-content export-modal",onClick:d=>d.stopPropagation(),style:{width:"400px"},children:[P.jsxs("div",{className:"modal-header",children:[P.jsx("h2",{children:"Export Design"}),P.jsx("button",{className:"close-btn",onClick:e,children:P.jsx(hx,{size:20})})]}),P.jsxs("div",{className:"export-options",style:{display:"flex",flexDirection:"column",gap:"20px"},children:[P.jsxs("div",{className:"form-group",children:[P.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:"Format"}),P.jsx("div",{className:"tab-group",style:{display:"flex",gap:"8px"},children:["png","jpeg","pdf","json"].map(d=>P.jsx("button",{className:`btn ${s===d?"btn-primary":"btn-secondary"}`,onClick:()=>r(d),style:{flex:1,textTransform:"uppercase"},children:d},d))})]}),s!=="json"&&P.jsxs("div",{className:"form-group",children:[P.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:"Size (Multiplier)"}),P.jsx("div",{className:"scale-options",style:{display:"flex",gap:"8px"},children:[1,2,3,4].map(d=>P.jsxs("button",{className:`btn ${l===d?"btn-primary":"btn-secondary"}`,onClick:()=>c(d),style:{flex:1},children:[d,"x"]},d))}),P.jsxs("small",{className:"text-muted",style:{display:"block",marginTop:"4px",fontSize:"0.85em",color:"#888"},children:["Resulting Resolution: ",800*l," x ",600*l," (Approx)"]})]}),s==="jpeg"&&P.jsxs("div",{className:"form-group",children:[P.jsxs("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:["Quality: ",Math.round(a*100),"%"]}),P.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:a,onChange:d=>o(d.target.value),style:{width:"100%"}})]}),P.jsxs("div",{className:"modal-actions",style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"10px"},children:[P.jsx("button",{className:"btn btn-secondary",onClick:e,children:"Cancel"}),P.jsxs("button",{className:"btn btn-primary",onClick:u,style:{display:"flex",alignItems:"center",gap:"6px"},children:[P.jsx(nX,{size:16}),"Export"]})]})]})]})})}const kf=37.7952755906;function oje({isOpen:n,onClose:e,onApply:t,currentWidth:s,currentHeight:r}){const[a,o]=ct.useState(()=>localStorage.getItem("canvas-unit")||"px"),[l,c]=ct.useState(s),[u,d]=ct.useState(r);ct.useEffect(()=>{n&&(a==="cm"?(c(Number((s/kf).toFixed(2))),d(Number((r/kf).toFixed(2)))):(c(s),d(r)))},[n,s,r,a]);const p=g=>{g!==a&&(g==="cm"?(c(Number((l/kf).toFixed(2))),d(Number((u/kf).toFixed(2)))):(c(Math.round(l*kf)),d(Math.round(u*kf))),o(g),localStorage.setItem("canvas-unit",g))},m=()=>{let g=l,b=u;a==="cm"&&(g=Math.round(l*kf),b=Math.round(u*kf)),t(g,b),e()};return n?P.jsx("div",{className:"modal-overlay",onClick:e,children:P.jsxs("div",{className:"modal-content",onClick:g=>g.stopPropagation(),style:{width:"360px",borderRadius:"16px"},children:[P.jsxs("div",{className:"modal-header",children:[P.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[P.jsx("div",{style:{background:"var(--accent-gradient)",padding:"8px",borderRadius:"10px",display:"flex"},children:P.jsx(oX,{size:20,color:"white"})}),P.jsx("h2",{style:{margin:0,fontSize:"1.2rem"},children:"Resize Canvas"})]}),P.jsx("button",{className:"close-btn",onClick:e,children:P.jsx(hx,{size:20})})]}),P.jsxs("div",{className:"modal-body",style:{display:"flex",flexDirection:"column",gap:"20px",padding:"10px 0"},children:[P.jsxs("div",{className:"input-group",children:[P.jsx("label",{style:{marginBottom:"8px",display:"block",fontWeight:"500"},children:"Measurement Unit"}),P.jsxs("select",{value:a,onChange:g=>p(g.target.value),style:{height:"44px",cursor:"pointer"},children:[P.jsx("option",{value:"px",children:"Pixels (px) - Web Standard"}),P.jsx("option",{value:"cm",children:"Centimeters (cm) - Print Ready"})]})]}),P.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[P.jsxs("div",{className:"input-group",style:{flex:1,minWidth:0},children:[P.jsx("label",{style:{marginBottom:"8px",display:"block",fontWeight:"500",fontSize:"0.8rem"},children:"Width"}),P.jsxs("div",{className:"input-row",style:{height:"40px",padding:"0 8px",display:"flex",alignItems:"center",gap:"4px",minWidth:0},children:[P.jsx("input",{type:"number",value:l,onChange:g=>c(parseFloat(g.target.value)||0),step:a==="cm"?"0.01":"1",style:{textAlign:"left",padding:"0",flex:1,width:"0",minWidth:"0",border:"none",background:"transparent"}}),P.jsx("span",{style:{opacity:.5,fontSize:"0.7rem",flexShrink:0},children:a})]})]}),P.jsx("div",{style:{marginTop:"20px",color:"var(--text-secondary)",fontWeight:"bold",opacity:.4,flexShrink:0},children:""}),P.jsxs("div",{className:"input-group",style:{flex:1,minWidth:0},children:[P.jsx("label",{style:{marginBottom:"8px",display:"block",fontWeight:"500",fontSize:"0.8rem"},children:"Height"}),P.jsxs("div",{className:"input-row",style:{height:"40px",padding:"0 8px",display:"flex",alignItems:"center",gap:"4px",minWidth:0},children:[P.jsx("input",{type:"number",value:u,onChange:g=>d(parseFloat(g.target.value)||0),step:a==="cm"?"0.01":"1",style:{textAlign:"left",padding:"0",flex:1,width:"0",minWidth:"0",border:"none",background:"transparent"}}),P.jsx("span",{style:{opacity:.5,fontSize:"0.7rem",flexShrink:0},children:a})]})]})]})]}),P.jsxs("div",{className:"modal-footer",style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px"},children:[P.jsx("button",{className:"btn",onClick:e,style:{padding:"10px 20px"},children:"Cancel"}),P.jsx("button",{className:"btn btn-primary",onClick:m,style:{padding:"10px 24px",borderRadius:"10px"},children:"Apply Resize"})]})]})}):null}function lje({canvasManager:n}){const[e,t]=ct.useState(!1);return ct.useEffect(()=>{if(!n)return;t(!!n.isCropping);const s=n.onCropModeChange;return n.onCropModeChange=r=>{t(r),s&&s(r)},()=>{}},[n]),e?P.jsxs("div",{className:"crop-toolbar",children:[P.jsx("span",{className:"crop-label",children:"Crop Mode"}),P.jsxs("div",{className:"crop-actions",children:[P.jsx("button",{className:"icon-btn danger",onClick:()=>n.cancelCrop(),title:"Cancel",children:P.jsx(hx,{size:18})}),P.jsx("button",{className:"icon-btn primary",onClick:()=>n.applyCrop(),title:"Apply Crop",children:P.jsx(Jq,{size:18})})]})]}):null}function cje(){const n=ct.useRef(null),{activeTab:e,setActiveTab:t,showRulers:s,setShowRulers:r,showShortcuts:a,setShowShortcuts:o,showExport:l,setShowExport:c,showResize:u,setShowResize:d,colorPickerVisible:p,setColorPickerVisible:m,colorPickerAnchor:g,activeColorProp:b,colorPickerAlign:v}=Hm(),{canvasManager:x,currentColor:S,setCurrentColor:C}=TN();ct.useEffect(()=>{if(!x)return;const O=new URLSearchParams(window.location.search).get("template");O&&fetch(O).then(F=>F.json()).then(F=>x.loadProject(F)).catch(F=>console.error("Failed to load template:",F))},[x]);const A=k=>{C(k),x&&x.updateActiveObject(b||"fill",k)};return P.jsxs("div",{id:"app-react-root",children:[P.jsx(k6e,{canvasManager:x,showRulers:s,setShowRulers:r,onOpenShortcuts:()=>o(!0),onOpenExport:()=>c(!0),onOpenResize:()=>d(!0)}),P.jsxs("div",{className:"workspace",children:[P.jsxs("aside",{className:"sidebar",children:[P.jsxs("div",{className:"panel-tabs-container",children:[P.jsx("button",{className:`panel-tab-btn ${e==="elements"?"active":""}`,onClick:()=>t("elements"),children:"Elements"}),P.jsx("button",{className:`panel-tab-btn ${e==="templates"?"active":""}`,onClick:()=>t("templates"),children:"Templates"})]}),P.jsx("div",{id:"elements-wrapper",children:e==="elements"?P.jsx(tje,{canvasManager:x}):P.jsx(nje,{canvasManager:x})})]}),P.jsxs("div",{id:"ruler-wrapper",children:[s&&P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"ruler-corner-box"}),P.jsx("div",{className:"ruler-horizontal-container",children:P.jsx(kj,{type:"horizontal",canvasManager:x})}),P.jsx("div",{className:"ruler-vertical-container",children:P.jsx(kj,{type:"vertical",canvasManager:x})})]}),P.jsx("main",{className:"canvas-area",id:"canvas-wrapper",children:P.jsx("div",{className:"canvas-container-wrapper",children:P.jsx("canvas",{id:"c",ref:n})})})]}),P.jsxs("aside",{className:"sidebar-right",children:[P.jsx("div",{className:"section-title",children:"Properties"}),P.jsx(eje,{canvasManager:x}),P.jsx("div",{className:"section-divider"}),P.jsxs("div",{className:"section",style:{flex:1,display:"flex",flexDirection:"column"},children:[P.jsx("div",{className:"section-title",children:"Layers"}),P.jsx(qBe,{canvasManager:x})]})]})]}),P.jsx(HBe,{}),P.jsx(lje,{canvasManager:x}),P.jsx(sje,{}),p&&P.jsx(bX,{color:S,onChange:A,onClose:()=>m(!1),anchorEl:g,align:v}),P.jsx(ije,{isOpen:a,onClose:()=>o(!1)}),P.jsx(aje,{isOpen:l,onClose:()=>c(!1),onExport:k=>x?.exportImage(k)}),P.jsx(oje,{isOpen:u,onClose:()=>d(!1),onApply:(k,O)=>x?.resize(k,O),currentWidth:x?.originalWidth||800,currentHeight:x?.originalHeight||600})]})}yK.createRoot(document.getElementById("app")).render(P.jsx(Ps.StrictMode,{children:P.jsx(cMe,{children:P.jsx(cje,{})})}));export{Ns as _,L_ as g};
